"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[1078],{21078:function(e,t,n){n.r(t),n.d(t,{D:function(){return qr},N:function(){return gi},a:function(){return on},b:function(){return Ut},e:function(){return Di},h:function(){return Jt},j:function(){return li},l:function(){return Wt},m:function(){return en},n:function(){return Ti},s:function(){return rn}});var i,r,a=n(44925),o=n(93433),s=n(74165),l=n(15861),u=n(4942),c=n(97326),d=n(11752),h=n(61120),p=n(1413),f=n(37762),v=n(15671),y=n(43144),g=n(60136),m=n(29388),_=n(29439),S=n(48848),w=n(93314),k=n(93661),Z=n(50690),x=n(75016),P=n(52102),M=n(47855),E=n(71802),b=n(8586),C=n(79557),A=n(49228),T=n(64772),D=n(43406),O=n(28390),R=n(95249),L=n(82474),H=n(89794),z=(n(74384),n(1500)),I=n(77956),V=n(24093),F=n(82509),G=n(92251),N=n(32043),q=n(630),Y=n(1797),X=n(41723),j=n(87750),U=n(91386),W=n(70381),Q=n(43345),B=n(29048),J=n(18668),K=n(40114),$=n(52638),ee=n(88856),te=n(91681),ne=n(57791),ie=n(42947),re=n(15132),ae=n(2352),oe=n(13239),se=n(37856),le=n(40345),ue=n(47748),ce=n(25747),de=(n(46737),n(66633)),he=n(65094),pe=n(52113),fe=["dimension"];function ve(e,t,n){var i=function(e,t,n,i){var a=function(e){var t=(0,M.c)(e),n=t===M.I?M.p:t;return(0,R.A)(e,n)?n:e}(n),o=(0,M.Z)(a);if((0,k.t)(o))return null;var s=t[2]-e[2];if(i===r.Vertical)return{verticalSigned:s,unit:o};if(!(0,R.j)(e,n,_e,a)||!(0,R.j)(t,n,Se,a))return null;if(i===r.Direct)return{direct:(0,E.x)(Se,_e),unit:o};if((0,E.o)(we,e[0],e[1],t[2]),!(0,R.j)(we,n,we,a))return null;var l=(0,E.x)(we,Se);return i===r.Horizontal?{horizontal:l,unit:o}:{direct:(0,E.x)(Se,_e),horizontal:l,vertical:Math.abs(s),unit:o}}(e,t,n,r.Direct);return(0,k.r)(i)?(0,b.a)(i.direct,i.unit):null}!function(e){e[e.Direct=0]="Direct",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(r||(r={}));var ye,ge=(0,E.n)(),me=(0,E.n)(),_e=(0,E.n)(),Se=(0,E.n)(),we=(0,E.n)();function ke(e){var t=e.elevationAlignedStartPoint,n=e.elevationAlignedEndPoint,i=e.dimension;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,offset:i.offset,measureType:i.measureType,orientation:i.orientation}}function Ze(e,t){var n=e.elevationAlignedStartPoint,i=e.elevationAlignedEndPoint,r=e.offset,a=e.measureType,o=e.orientation,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,k.t)(n)||(0,k.t)(i))return null;var l=Me((0,k.r)(s)?s.directSegment:new b.l,{elevationAlignedStartPoint:n,elevationAlignedEndPoint:i},t),u=(0,k.r)(s)?s.primaryOffsetAxis:(0,E.n)();Ce(u,{measureType:a,elevationAlignedStartPoint:n,elevationAlignedEndPoint:i,directSegment:l,orientation:o,renderCoordsHelper:t});var c=(0,k.r)(s)?s.dimensionSegment:new b.l;return Te({elevationAlignedStartPoint:n,elevationAlignedEndPoint:i})&&a===P.t.Vertical?((0,E.r)(c.startRenderSpace,l.startRenderSpace),(0,E.r)(c.endRenderSpace,l.endRenderSpace)):De(c,{offsetAxis:u,offset:r,relativeToSegment:l,renderCoordsHelper:t}),{directSegment:l,dimensionSegment:c,primaryOffsetAxis:u,spatialReference:t.spatialReference}}function xe(e,t,n,i){return t===ye.Start?((0,E.r)(e.startRenderSpace,n.startRenderSpace),(0,E.r)(e.endRenderSpace,i.startRenderSpace)):((0,E.r)(e.startRenderSpace,n.endRenderSpace),(0,E.r)(e.endRenderSpace,i.endRenderSpace)),e}function Pe(e,t,n,i){switch(t){case P.t.Direct:return Me(e,n,i);case P.t.Horizontal:case P.t.Vertical:var r,a=n.elevationAlignedStartPoint,o=n.elevationAlignedEndPoint,s=n.dimension,l=n.geometry;s.measureType===P.t.Direct?(r=function(e,t){var n=e.directSegment.eval(.5,T.c.get()),i=t.worldUpAtPosition(n,T.c.get()),r=e.dimensionSegment.eval(.5,T.c.get()),a=(0,E.a0)(T.c.get(),r,n);return!(0,E.a2)(a,E.a7)&&(0,E.P)(a,i)>0}(l,i)===a.z>o.z,t===P.t.Horizontal&&(r=!r)):r=!function(e){var t=e.dimensionSegment,n=t.startRenderSpace,i=t.endRenderSpace,r=e.directSegment,a=r.startRenderSpace,o=r.endRenderSpace;return(0,E.a3)(a,n)<(0,E.a3)(o,i)}(l);var u=r?[a,o]:[o,a],c=(0,_.Z)(u,2),d=c[0],h=c[1],p=(0,O.aa)(h,Ee);return t===P.t.Horizontal?p.z=d.z:(p.x=d.x,p.y=d.y),i.toRenderCoords(d,e.startRenderSpace),i.toRenderCoords(p,e.endRenderSpace),e}}function Me(e,t,n){return n.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),n.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(ye||(ye={}));var Ee=(0,D.v)(0,0,0,null);var be=new b.l;function Ce(e,t){var n=t.measureType,i=t.elevationAlignedStartPoint,r=t.elevationAlignedEndPoint,a=t.directSegment,o=a.startRenderSpace,s=a.endRenderSpace,l=t.directSegment,u=t.renderCoordsHelper,c=l.eval(.5,T.c.get()),d=u.worldUpAtPosition(c,T.c.get()),h=u.worldBasisAtPosition(c,T.n.Y,T.c.get());switch(n){case P.t.Horizontal:(0,E.r)(e,d);break;case P.t.Vertical:(0,E.P)(o,d)<(0,E.P)(s,d)?(0,E.a0)(e,s,o):(0,E.a0)(e,o,s),(0,E._)(e,e,d),(0,E._)(e,e,d);break;case P.t.Direct:var p=(0,k.v)(t.orientation,0);if(Te({elevationAlignedStartPoint:i,elevationAlignedEndPoint:r}))(0,C.g)(Ae,-(0,E.m)(p),d),(0,E.O)(e,h,Ae);else{var f=(0,E.a0)(T.c.get(),s,o),v=(0,E._)(T.c.get(),f,d);(0,E._)(v,v,f),(0,C.g)(Ae,(0,E.m)(p),f),(0,E.O)(e,v,Ae)}}return(0,E.a2)(e,E.a7)?(0,E.r)(e,h):(0,E.z)(e,e)}var Ae=(0,A.e)();function Te(e){var t=e.elevationAlignedStartPoint,n=e.elevationAlignedEndPoint;return(0,k.r)(t)&&(0,k.r)(n)&&t.x===n.x&&t.y===n.y}function De(e,t){var n=t.offsetAxis,i=t.offset,r=t.relativeToSegment,a=r.startRenderSpace,o=r.endRenderSpace,s=t.relativeToSegment,l=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=(0,E.P)(t,n),a=(0,E.P)(e,n),o=Math.abs(r-a)+i;return r>a?[o,i]:[i,o]}(a,o,n,i/t.renderCoordsHelper.unitInMeters),u=(0,_.Z)(l,2),c=u[0],d=u[1];return(0,E.ab)(e.startRenderSpace,s.startRenderSpace,n,c),(0,E.ab)(e.endRenderSpace,s.endRenderSpace,n,d),e}function Oe(e,t,n){var i=t.directSegment.eval(.5,T.c.get());return n.worldUpAtPosition(i,e)}function Re(e,t){var n=t.directSegment,i=n.startRenderSpace,r=n.endRenderSpace;return(0,E.a0)(e,r,i)}function Le(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{invert:!1},i=t.dimensionSegment,r=i.startRenderSpace,a=i.endRenderSpace;return n.invert?(0,E.a0)(e,r,a):(0,E.a0)(e,a,r)}function He(e,t){var n=e.directSegment.eval(.5,T.c.get());return t.headingAtPosition(n,e.primaryOffsetAxis)}var ze=(0,E.n)();function Ie(e){var t=e.elevationAlignedStartPoint,n=e.elevationAlignedEndPoint;if((0,k.t)(t)||(0,k.t)(n))return!1;var i=function(e,t){var n=e.spatialReference;return(0,L.E)(n,t.spatialReference)?(ge[0]=e.x,ge[1]=e.y,ge[2]=e.hasZ?e.z:0,me[0]=t.x,me[1]=t.y,me[2]=t.hasZ?t.z:0,ve(ge,me,n)):null}(t,n);return(0,k.r)(i)&&(0,b.v)(i,"meters").value>Ve}var Ve=1e5;function Fe(e){return(0,k.r)(e.geometry)}var Ge=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e))._handles=new S.X,i}return(0,y.Z)(n,[{key:"initialize",value:function(){var e,t=this,n=this.analysisViewData.computations,i=(0,f.Z)(n);try{for(i.s();!(e=i.n()).done;){var r=e.value;this._addComputation(r)}}catch(a){i.e(a)}finally{i.f()}this.addHandles(n.on("change",(function(e){var n,i=e.added,r=e.removed,o=(0,f.Z)(r);try{for(o.s();!(n=o.n()).done;){var s=n.value;t._removeComputation(s)}}catch(a){o.e(a)}finally{o.f()}var l,u=(0,f.Z)(i);try{for(u.s();!(l=u.n()).done;){var c=l.value;t._addComputation(c)}}catch(a){u.e(a)}finally{u.f()}})))}},{key:"destroy",value:function(){this._handles=(0,k.g)(this._handles)}},{key:"analysis",get:function(){return this.analysisViewData.analysis}},{key:"_defaultUnit",get:function(){return(0,M.d)(this.view)}},{key:"_addComputation",value:function(e){var t=this;this._handles.has(e)||this._handles.add((0,Z.l)((function(){return ke(e)}),(function(n){var i=n.measureType;if(Ie(n)&&i!==P.t.Direct){var r=Math.round((0,M.a)(Ve,"meters","kilometers"));return S.a.getLogger(t.declaredClass).warnOnce("A ".concat(i," dimension in the analysis (id: '").concat(t.analysis.id,"') will not display, because only direct dimensions can measure lengths greater than ").concat(r,' km. Update the measureType of the affected dimension to "direct" to display it.')),void(e.geometry=null)}var a=Ze(n,t.view.renderCoordsHelper,e.geometry);e.geometry=a,e.result.length=function(e,t,n){if((0,k.t)(e))return null;var i=ve(e.dimensionSegment.startRenderSpace,e.dimensionSegment.endRenderSpace,e.spatialReference);if((0,k.t)(i))return null;var r=t===P.t.Vertical?(0,M.v)(i.value,i.unit,n):(0,M.N)(i.value,i.unit,n);return(0,b.v)(i,r)}(a,i,t._defaultUnit)}),Z.w),e)}},{key:"_removeComputation",value:function(e){this._handles.remove(e)}}]),n}(S.m);(0,S.e)([(0,S.y)({constructOnly:!0})],Ge.prototype,"analysisViewData",void 0),(0,S.e)([(0,S.y)({constructOnly:!0})],Ge.prototype,"view",void 0),(0,S.e)([(0,S.y)()],Ge.prototype,"analysis",null),(0,S.e)([(0,S.y)()],Ge.prototype,"_defaultUnit",null),Ge=(0,S.e)([(0,S.n)("esri.views.3d.analysis.Dimension.support.DimensionController")],Ge);var Ne={main:new H.l([255,127,0])},qe=(0,y.Z)((function e(){(0,v.Z)(this,e),this.color=Ne.main,this.opacity=.5,this.radius=5})),Ye=(0,y.Z)((function e(){(0,v.Z)(this,e),this.color=new H.l([127,127,127]),this.opacity=.5,this.radius=5})),Xe=(0,y.Z)((function e(){(0,v.Z)(this,e),this.lineSizeFraction=.8})),je=(0,y.Z)((function e(){(0,v.Z)(this,e),this.color=Ne.main,this.opacity=.5,this.linePaddingPx=4,this.focusedLinePaddingPx=6,this.lengthFraction=.5,this.minLengthMeters=.1})),Ue=(0,y.Z)((function e(){(0,v.Z)(this,e),this.calloutOffsetPx=18,this.calloutOpacity=.5,this.calloutWidth=2,this.discScale=.3,this.focusMultiplier=2})),We=(0,y.Z)((function e(){(0,v.Z)(this,e),this.lineSizeFraction=.25})),Qe=(0,y.Z)((function e(){(0,v.Z)(this,e),this.marginPx=20,this.minScreenLengthFontSizeFactor=5})),Be=(0,y.Z)((function e(){(0,v.Z)(this,e),this.color=new H.l([255,127,0,.5])})),Je=new((0,y.Z)((function e(){(0,v.Z)(this,e),this.pointManipulators=new qe,this.offsetManipulator=new je,this.orientationManipulator=new Ue,this.markers=new Xe,this.labels=new Qe,this.offsetLine=new We,this.constraint=new Be,this.constraintThresholdPx=10,this.initialOffsetPx=50,this.orientationSnapThresholdDegrees=5,this.disabledPointIndicator=new Ye,this.smallScreenLengthLineSizeFactor=2,this.pointerMoveTimeoutMs=2500}))),Ke=function(){function e(t){(0,v.Z)(this,e),this.start=t.start,this.end=t.end,this.offset=t.offset,this.heading=t.heading,this.rotation=t.rotation,this.direct=t.direct,this.horizontal=t.horizontal,this.vertical=t.vertical}return(0,y.Z)(e,[{key:"manipulatorName",value:function(e){var t=this;return Object.keys(this).find((function(n){return t.hasOwnProperty(n)&&e===t[n]}))}},{key:"values",value:function(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}},{key:"forEachMeasureTypeManipulator",value:function(e){var t,n=(0,f.Z)(P.r);try{for(n.s();!(t=n.n()).done;){var i=t.value;e(this.manipulatorForMeasureType(i),i)}}catch(r){n.e(r)}finally{n.f()}}},{key:"manipulatorForMeasureType",value:function(e){switch(e){case P.t.Direct:return this.direct;case P.t.Horizontal:return this.horizontal;case P.t.Vertical:return this.vertical}}}]),e}();function $e(e,t){var n=t.lineSizePt,i=t.material,r=Je.orientationManipulator,a=r.calloutOffsetPx,o=r.calloutOpacity,s=r.calloutWidth,l=r.discScale,u=r.focusMultiplier;return{calloutLength:.25*O.ac*Je.markers.lineSizeFraction*(0,I.u)(n)+a,calloutOpacity:o,calloutWidth:s,customStateMask:St,discScale:l,focusMultiplier:u,material:i,metadata:e}}function et(e,t){return(0,F.R)(e,$e(t.metadata,t))}function tt(e,t){(0,F.T)(e,$e(e.metadata,t))}function nt(e,t){var n=t.computation,i=t.view;return[(0,F.d)(e,(function(e,t,r){it({cancel:r,computation:n,settingHeading:!1,steps:t,view:i})})),e.events.on("immediate-click",(function(e){!function(e,t,n){var i=t.dimension,r=t.geometry;if(90===i.orientation||270===i.orientation)return i.orientation=0,void e.stopPropagation();if((0,k.t)(r))return;var a=n.renderCoordsHelper,o=Ze((0,p.Z)((0,p.Z)({},ke(t)),{},{orientation:90}),a),s=Ze((0,p.Z)((0,p.Z)({},ke(t)),{},{orientation:270}),a);if((0,k.t)(o)||(0,k.t)(s))return;var l=He(o,a),u=He(s,a),c=ot(r,n),d=z.s.shortestSignedDiff(c,l),h=z.s.shortestSignedDiff(c,u);i.orientation=Math.abs(d)<Math.abs(h)?90:270,e.stopPropagation()}(e,n,i)}))]}function it(e){var t=e.cancel,n=e.computation,i=e.settingHeading,r=e.steps,a=e.view;if(Fe(n)){var o=a.renderCoordsHelper,s=n.dimension,l=n.geometry,u=(0,E.n)(),c=ft((0,E.n)(),l,l.directSegment,o),d=vt(T.c.get(),{forHeading:i,geometry:l,renderCoordsHelper:o}),h=(0,V._)(c,d,(0,V.p)()),p=(0,k.v)(s.orientation,i?function(){return He(l,a.renderCoordsHelper)}:0);r.next((0,G.C)(a,h)).next((function(e){"start"===e.action&&(0,E.r)(u,e.renderStart);var t=(0,V.Y)(h),n=(0,F.z)(u,e.renderEnd,c,t),r=p-(0,E.b)(n);i||(r=function(e){var t=z.s.normalize(e)%90;return t<Je.orientationSnapThresholdDegrees?e-t:90-t<Je.orientationSnapThresholdDegrees?e+(90-t):e}(r)),s.orientation=r})),t.next((0,F.w)(s,["orientation"]))}}function rt(e,t){var n=t.computation,i=t.manipulatorMeasureType,r=t.view,a=P.t.Direct,o=0,s=0;return[e.events.on("grab-changed",(function(t){if("start"===t.action&&Fe(n)){var l=n.dimension,u=n.geometry;a=l.measureType,o=l.offset,s=l.orientation;var c=(0,E.r)(T.c.get(),e.renderLocation);l.measureType=i,l.offset=function(e,t,n,i){var r=n.directSegment,a=Ce(T.c.get(),{measureType:t,directSegment:r,renderCoordsHelper:i}),o=De(be,{offsetAxis:a,offset:0,relativeToSegment:r,renderCoordsHelper:i}).eval(.5,T.c.get()),s=(0,E.a0)(T.c.get(),e,o);return(0,E.P)(s,a)*i.unitInMeters}(c,i,u,r.renderCoordsHelper),l.orientation=0}})),(0,F.d)(e,(function(e,t,l){if(Fe(n)){var u=n.geometry,c=n.dimension,d=r.renderCoordsHelper,h=Pe(xt,i,n,d),p=Ce(T.c.get(),{measureType:i,directSegment:u.directSegment,renderCoordsHelper:d}),f=(0,G.z)(e);t.next(f).next(at(r,c,h,p)),l.next(f).next((function(e){return c.measureType=a,c.offset=o,c.orientation=s,e}))}}))]}function at(e,t,n,i){var r=(0,E.e)(T.c.get(),n.endRenderSpace,n.startRenderSpace);(0,E._)(r,r,i);var a,o=(0,V._)(n.startRenderSpace,r,(0,V.p)()),s=(0,V._)(n.startRenderSpace,i,(0,V.p)()),l=t.offset,u=0,c=new F.G;return c.next((0,G.C)(e,o)).next((function(n){"start"===n.action&&(u=(0,V.R)(s,n.renderStart));var i=((0,V.R)(s,n.renderEnd)-u)*e.renderCoordsHelper.unitInMeters;t.offset=l+i,a=n})),function(e){return c.execute(e),a}}function ot(e,t){var n=e.directSegment,i=t.renderCoordsHelper,r=Oe(T.c.get(),e,i),a=Re(T.c.get(),e),o=(0,E._)(T.c.get(),a,r),s=t.state.camera.viewForward;(0,E.P)(o,s)>0&&(0,E.g)(o,o,-1);var l=n.eval(.5,T.c.get());return i.headingAtPosition(l,o)}function st(e,t,n){var i=t.dimensionSegment,r=t.primaryOffsetAxis,a=Le(wt,t),o=(0,E.F)(a,E.a7)?(0,C.r)(Zt):(0,F.D)(a,r,E.a7,Zt),s=Math.max((0,E.s)(a),Je.offsetManipulator.minLengthMeters/n.unitInMeters);(0,C.i)(o,o,(0,E.o)(wt,s,s,s)),e.modelTransform=o,e.renderLocation=i.eval(.5,wt)}function lt(e,t,n){ct(e,t,n,{forHeading:!0})}function ut(e,t,n){ct(e,t,n,{forHeading:!1})}function ct(e,t,n,i){var r=i.forHeading,a=t.dimension,o=t.geometry,s=o.primaryOffsetAxis,l=(0,E.g)(dt,s,a.offset>=0?1:-1),u=vt(ht,{forHeading:r,geometry:o,renderCoordsHelper:n});(0,E._)(u,u,l);var c=(0,F.D)(l,u,E.a7,Zt);e.modelTransform=c,e.renderLocation=ft(wt,o,o.dimensionSegment,n)}var dt=(0,E.n)(),ht=(0,E.n)();function pt(e,t,n,i){var r=t.geometry,a=Pe(xt,n,t,i),o=Ce(wt,{measureType:n,directSegment:r.directSegment,renderCoordsHelper:i}),s=(0,E.a0)(kt,a.endRenderSpace,a.startRenderSpace),l=(0,F.D)(s,o,E.a7,Zt),u=(0,E.s)(s);(0,C.i)(l,l,(0,E.o)(kt,u,u,u)),e.modelTransform=l,e.renderLocation=a.eval(.5,kt)}function ft(e,t,n,i){var r=n.startRenderSpace,a=n.endRenderSpace,o=function(e,t){var n=Re(yt,e),i=Oe(gt,e,t);return(0,E.P)(n,i)>0}(t,i)?r:a;return(0,E.r)(e,o)}function vt(e,t){var n=t.forHeading,i=t.geometry,r=t.renderCoordsHelper;return n?Oe(e,i,r):Le(e,i,{invert:!0})}var yt=(0,E.n)(),gt=(0,E.n)();function mt(e){return(0,I.u)(e)+Je.offsetManipulator.focusedLinePaddingPx}var _t,St=N.a5.Custom1,wt=(0,E.n)(),kt=(0,E.n)(),Zt=(0,A.e)(),xt=new b.l;function Pt(e,t){if(Ie(e))return _t.Direct;var n=e.geometry;if((0,k.t)(n)||(0,E.F)(n.directSegment.startRenderSpace,n.directSegment.endRenderSpace))return null;var i=Je.constraintThresholdPx,r=t.state.camera,a=Oe(T.c.get(),n,t.renderCoordsHelper),o=Re(T.c.get(),n),s=(0,E.g)(T.c.get(),a,(0,E.P)(o,a)),l=(0,E.e)(T.c.get(),o,s),u=(0,E.v)(l),c=(0,E.v)(s),d=n.directSegment,h=d.startRenderSpace,p=d.endRenderSpace,f=Math.pow(Math.max(r.computeRenderPixelSizeAt(h)*i,r.computeRenderPixelSizeAt(p)*i),2);return u<f?_t.Vertical:c<f?_t.Horizontal:null}!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(_t||(_t={}));var Mt,Et=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e))._ray=(0,T.d)(),i._externalResources=null,i._handles=new S.X,i._isWorldDown=!1,i._start=(0,E.n)(),i._end=(0,E.c)(1,0,0),i._width=1,i._color=(0,Y.r)(1,0,1,1),i._polygonOffset=!1,i._writeDepthEnabled=!0,i._innerWidth=0,i._innerColor=(0,Y.r)(1,1,1,1),i._stipplePattern=null,i._stippleOffColor=null,i._stipplePreferContinuous=!0,i._falloff=0,i._extensionType=Mt.LINE,i._laserlineStyle=null,i._laserlineEnabled=!1,i._renderOccluded=W.ah.OccludeAndTransparent,i._fadedExtensions=Ot,i.applyProps(e),i}return(0,y.Z)(n,[{key:"createExternalResources",value:function(){var e=this,t=new O.a7(this.materialParameters);this._handles.add((0,Z.l)((function(){return e.view.state.camera}),(function(){e._updateGeometry()})));var n=new U.d({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:t,laserline:n}}},{key:"destroyExternalResources",value:function(){(0,k.r)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){(0,k.r)(this._externalResources)&&e(this._externalResources.material)}},{key:"createGeometries",value:function(e){var t=[(0,E.n)(),(0,E.n)()],n=this.extensionType===Mt.FADED;n&&t.push((0,E.n)(),(0,E.n)());var i=n?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,r=(0,O.ab)(t,null,i);e.addGeometry(r,(0,k.e)(this._externalResources).material),this._updateVertices(e)}},{key:"updateVisibility",value:function(e){(0,d.Z)((0,h.Z)(n.prototype),"updateVisibility",this).call(this,e),(0,k.r)(this._externalResources)&&(this._externalResources.laserline.visible=e)}},{key:"setStartEndFromWorldDownAtLocation",value:function(e){this._isWorldDown=!0,(0,E.r)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,E.e)(this._end,e,this._end),(0,T.h)(this._start,this._end,this._ray),this._updateGeometry()}},{key:"start",get:function(){return this._start},set:function(e){this._isWorldDown=!1,(0,E.F)(this._start,e)||((0,E.r)(this._start,e),(0,T.h)(this._start,this._end,this._ray),this._updateGeometry())}},{key:"end",get:function(){return this._end},set:function(e){this._isWorldDown=!1,(0,E.F)(this._end,e)||((0,E.r)(this._end,e),(0,T.h)(this._start,this._end,this._ray),this._updateGeometry())}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,E.Q)(e,this._color)||((0,E.B)(this._color,e),this._updateMaterial())}},{key:"polygonOffset",get:function(){return this._polygonOffset},set:function(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}},{key:"writeDepthEnabled",get:function(){return this._writeDepthEnabled},set:function(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){(0,E.Q)(e,this._innerColor)||((0,E.B)(this._innerColor,e),this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=(0,k.r)(e)!==(0,k.r)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){((0,k.t)(e)||(0,k.t)(this._stippleOffColor)||!(0,E.Q)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,k.r)(e)?(0,Y.d)(e):null,this._updateMaterial())}},{key:"stipplePreferContinuous",get:function(){return this._stipplePreferContinuous},set:function(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}},{key:"extensionType",get:function(){return this._extensionType},set:function(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}},{key:"_laserlineAttached",get:function(){return this._laserlineEnabled&&(0,k.r)(this._laserlineStyle)}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,(0,k.r)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,k.r)(e)&&(this._externalResources.laserline.style=e))}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,(0,k.r)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"fadedExtensions",get:function(){return this._fadedExtensions},set:function(e){this._fadedExtensions=(0,k.v)(e,Ot),this.recreateGeometry()}},{key:"_updateMaterial",value:function(){(0,k.t)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}},{key:"_updateGeometry",value:function(){(0,k.r)(this.object)&&this._updateVertices(this.object)}},{key:"_updateVertices",value:function(e){var t=this._extensionType===Mt.FADED?this._updateLineSegmentFinite(Tt):this._updateLineSegmentInfinite(this._extensionType,Tt);this._updateVertexAttributes(e,t),(0,k.r)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}},{key:"_updateLineSegmentFinite",value:function(e){return(0,j.b)(this._start,this._end,e)}},{key:"_updateLineSegmentInfinite",value:function(e,t){var n=this.view.state.camera;switch((0,X.a)(this._ray,bt),e){case Mt.LINE:bt.c0=-Number.MAX_VALUE;break;case Mt.RAY:case Mt.GROUND_RAY:var i=this._ray.origin,r=(0,k.v)(this.view.elevationProvider.getElevation(i[0],i[1],i[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),a=this.view.renderCoordsHelper.getAltitude(i);this._isWorldDown&&a<r&&(0,E.q)(bt.ray.direction,bt.ray.direction),this._extensionType===Mt.GROUND_RAY&&null!=r&&(bt.c1=Math.abs(a-r))}if(!(0,X.b)(n.frustum,bt))return(0,j.b)(this._start,this._end,t);var o=(0,X.c)(bt,Ct),s=(0,X.A)(bt,At);return(0,j.b)(o,s,t)}},{key:"_updateVertexAttributes",value:function(e,t){var n=e.geometries[0].getMutableAttribute(Q.O.POSITION).data;if(this.extensionType===Mt.FADED){var i=(0,j.n)(t,-this.fadedExtensions.start,Ct);n[0]=i[0],n[1]=i[1],n[2]=i[2];var r=(0,j.n)(t,0,Ct);n[3]=r[0],n[4]=r[1],n[5]=r[2];var a=(0,j.n)(t,1,Ct);n[6]=a[0],n[7]=a[1],n[8]=a[2];var o=(0,j.n)(t,1+this.fadedExtensions.end,Ct);n[9]=o[0],n[10]=o[1],n[11]=o[2]}else{var s=(0,j.n)(t,0,Ct);n[0]=s[0],n[1]=s[1],n[2]=s[2];var l=(0,j.n)(t,1,Ct);n[3]=l[0],n[4]=l[1],n[5]=l[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}]),n}(x.n),bt=(0,X.d)(),Ct=(0,E.n)(),At=(0,E.n)(),Tt=(0,j.v)();!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(Mt||(Mt={}));var Dt=1/3,Ot={start:Dt,end:Dt},Rt=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e))._handles=new S.X,i._location=(0,E.n)(),i._direction=(0,E.c)(1,0,0),i._width=1,i._offset=1,i._length=18,i._color=(0,Y.r)(1,0,1,1),i._renderOccluded=W.ah.OccludeAndTransparent,i.applyProps(e),i}return(0,y.Z)(n,[{key:"location",get:function(){return this._location},set:function(e){(0,E.F)(this._location,e)||((0,E.r)(this._location,e),this._updateGeometry())}},{key:"direction",get:function(){return this._direction},set:function(e){(0,E.F)(this._direction,e)||((0,E.r)(this._direction,e),this._updateGeometry())}},{key:"setDirectionFromPoints",value:function(e,t){(0,E.z)(this._direction,(0,E.e)(this._direction,t,e)),this._updateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"offset",get:function(){return this._offset},set:function(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}},{key:"length",get:function(){return this._length},set:function(e){e!==this._length&&(this._length=e,this._updateGeometry())}},{key:"color",get:function(){return this._color},set:function(e){(0,E.Q)(e,this._color)||((0,E.B)(this._color,e),this._updateMaterial())}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"createExternalResources",value:function(){var e=this,t=new O.a7(this.materialParameters);this._handles.add((0,Z.l)((function(){return e.view.state.camera}),(function(){e._updateGeometry()}))),this._externalResources={material:t}}},{key:"destroyExternalResources",value:function(){this._handles.removeAll(),this._externalResources=null}},{key:"createGeometries",value:function(e){var t=(0,O.ab)([(0,E.n)(),(0,E.n)()]),n=(0,O.ab)([(0,E.n)(),(0,E.n)()]),i=(0,k.e)(this._externalResources).material;e.addGeometry(t,i),e.addGeometry(n,i),this._updateVertices(e)}},{key:"forEachExternalMaterial",value:function(e){(0,k.r)(this._externalResources)&&e(this._externalResources.material)}},{key:"_updateMaterial",value:function(){(0,k.t)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}},{key:"_updateGeometry",value:function(){var e=this.object;(0,k.t)(e)||this._updateVertices(e)}},{key:"_updateVertices",value:function(e){var t=this.view.state.camera;t.projectToScreen(this.location,Ht),(0,E.u)(Lt,this.location,this.direction),t.projectToScreen(Lt,zt),(0,B.v)(zt,(0,B.o)(zt,zt,Ht)),this._updateVertexAttributes(t,e,0,Ht,zt,1),this._updateVertexAttributes(t,e,1,Ht,zt,-1)}},{key:"_updateVertexAttributes",value:function(e,t,n,i,r,a){var o=t.geometryRecords[n],s=o.geometry.getMutableAttribute(Q.O.POSITION).data,l=(0,B.l)(It,(0,B.r)(It,r[1]*a,r[0]*-a),this.offset+this.width/2),u=(0,B.s)(Vt,(0,B.s)(Vt,(0,B.s)(Vt,i,(0,B.l)(Vt,r,this.length/2)),l),l),c=(0,B.s)(Ft,u,(0,B.l)(Ft,r,-this.length));e.unprojectFromScreen(u,Lt),s[0]=Lt[0],s[1]=Lt[1],s[2]=Lt[2],e.unprojectFromScreen(c,Lt),s[3]=Lt[0],s[4]=Lt[1],s[5]=Lt[2],t.geometryVertexAttrsUpdated(o)}}]),n}(x.n),Lt=(0,E.n)(),Ht=(0,I.i)(),zt=(0,I.i)(),It=(0,I.i)(),Vt=(0,I.i)(),Ft=(0,I.i)(),Gt=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(){var e;return(0,v.Z)(this,n),(e=t.apply(this,arguments)).enabled=!0,e}return(0,y.Z)(n)}(K.l);(0,S.e)([(0,S.y)({type:Boolean})],Gt.prototype,"enabled",void 0),Gt=(0,S.e)([(0,S.n)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Gt);var Nt=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).lineSnapper=new Gt,i.parallelLineSnapper=new Gt,i.rightAngleSnapper=new Gt,i.rightAngleTriangleSnapper=new Gt,i.shortLineThreshold=15,i.distance=5,i.pointThreshold=1e-6,i.intersectionParallelLineThreshold=1e-6,i.parallelLineThreshold=1e-6,i.touchSensitivityMultiplier=1.5,i.pointOnLineThreshold=1e-6,i.orange=new H.l([255,127,0]),i.lineHintWidthReference=3,i.lineHintWidthTarget=3,i.lineHintFadedExtensions=.3,i.parallelLineHintWidth=2,i.parallelLineHintLength=24,i.parallelLineHintOffset=1.5,i.rightAngleHintSize=24,i.rightAngleHintOutlineSize=1.5,i}return(0,y.Z)(n)}(K.l);(0,S.e)([(0,S.y)({type:Gt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Nt.prototype,"lineSnapper",void 0),(0,S.e)([(0,S.y)({type:Gt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Nt.prototype,"parallelLineSnapper",void 0),(0,S.e)([(0,S.y)({type:Gt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Nt.prototype,"rightAngleSnapper",void 0),(0,S.e)([(0,S.y)({type:Gt,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Nt.prototype,"rightAngleTriangleSnapper",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],Nt.prototype,"shortLineThreshold",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],Nt.prototype,"distance",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Nt.prototype,"pointThreshold",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Nt.prototype,"intersectionParallelLineThreshold",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Nt.prototype,"parallelLineThreshold",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Nt.prototype,"touchSensitivityMultiplier",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Nt.prototype,"pointOnLineThreshold",void 0),(0,S.e)([(0,S.y)({type:H.l,nonNullable:!0})],Nt.prototype,"orange",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Nt.prototype,"lineHintWidthReference",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Nt.prototype,"lineHintWidthTarget",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Nt.prototype,"lineHintFadedExtensions",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Nt.prototype,"parallelLineHintWidth",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],Nt.prototype,"parallelLineHintLength",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],Nt.prototype,"parallelLineHintOffset",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],Nt.prototype,"rightAngleHintSize",void 0),(0,S.e)([(0,S.y)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],Nt.prototype,"rightAngleHintOutlineSize",void 0);var qt,Yt=new(Nt=(0,S.e)([(0,S.n)("esri.views.interactive.snapping.Settings.Defaults")],Nt));function Xt(e,t){var n=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return n;case 3:return n&&e[2]===t[2];case 4:return n&&e[2]===t[2]&&e[3]===t[3]}return!1}function jt(e,t){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function Ut(e,t,n){var i=n.toXYZ(e,Qt);t.sort((function(e,t){var r=n.toXYZ(e.targetPoint,Bt),a=(0,E.p)(r,i),o=n.toXYZ(t.targetPoint,Bt);return a-(0,E.p)(o,i)}))}!function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(qt||(qt={}));var Wt,Qt=(0,E.n)(),Bt=(0,E.n)();function Jt(e,t){return{point:e.coordinateHelper.vectorToPoint(e.point).toJSON(),distance:e.distance,types:e.types,query:(0,k.r)(t)?t.toJSON():{where:"1=1"}}}function Kt(e,t,n,i){var r=n.coordinateHelper,a=n.elevationInfo;if(!r.hasZ()||(0,k.t)(t)||"3d"!==t.type||(0,k.t)(e)||(0,$.x)(a,i))return e;var o=(0,$.h)(t,e,r.spatialReference,a,i),s=r.clone(e);return s[2]=o,s}function $t(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:$.E;return{left:Kt(e.leftVertex.pos,t,n,i),right:Kt(e.rightVertex.pos,t,n,i)}}function en(e){return e.createQuery()}!function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(Wt||(Wt={}));var tn=(0,y.Z)((function e(t,n){(0,v.Z)(this,e),this.elevationInfo=t,this.domain=n})),nn=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qt.ALL;return(0,v.Z)(this,n),(r=t.call(this,i,a)).intersectionPoint=e,r}return(0,y.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&Xt(this.intersectionPoint,e.intersectionPoint)}}]),n}(tn),rn=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r,a){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:qt.ALL,l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return(0,v.Z)(this,n),(o=t.call(this,a,s)).type=e,o.lineStart=i,o.lineEnd=r,o.fadeLeft=l,o.fadeRight=u,o}return(0,y.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&this.type===e.type&&Xt(this.lineStart,e.lineStart)&&Xt(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}}]),n}(tn),an=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:qt.ALL;return(0,v.Z)(this,n),(a=t.call(this,r,o)).lineStart=e,a.lineEnd=i,a}return(0,y.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&Xt(this.lineStart,e.lineStart)&&Xt(this.lineEnd,e.lineEnd)}}]),n}(tn),on=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r){var a;return(0,v.Z)(this,n),(a=t.call(this,i,r)).point=e,a}return(0,y.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&Xt(this.point,e.point)}}]),n}(tn),sn=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r,a){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:qt.ALL;return(0,v.Z)(this,n),(o=t.call(this,a,s)).previousVertex=e,o.centerVertex=i,o.nextVertex=r,o}return(0,y.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&Xt(this.previousVertex,e.previousVertex)&&Xt(this.centerVertex,e.centerVertex)&&Xt(this.nextVertex,e.nextVertex)}}]),n}(tn),ln=function(){function e(){(0,v.Z)(this,e)}return(0,y.Z)(e,[{key:"draw",value:function(e,t){var n,i=this._getUniqueHints(e),r=[],a=(0,f.Z)(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;o instanceof nn&&r.push(this.visualizeIntersectionPoint(o,t)),o instanceof rn&&r.push(this.visualizeLine(o,t)),o instanceof an&&r.push(this.visualizeParallelSign(o,t)),o instanceof sn&&r.push(this.visualizeRightAngleQuad(o,t)),o instanceof on&&r.push(this.visualizePoint(o,t))}}catch(s){a.e(s)}finally{a.f()}return(0,S.F)(r)}},{key:"_getUniqueHints",value:function(e){var t,n=[],i=(0,f.Z)(e);try{for(i.s();!(t=i.n()).done;){var r,a=t.value,o=!0,s=(0,f.Z)(n);try{for(s.s();!(r=s.n()).done;){var l=r.value;if(a.equals(l)){o=!1;break}}}catch(u){s.e(u)}finally{s.f()}o&&n.push(a)}}catch(u){i.e(u)}finally{i.f()}return n}}]),e}(),un=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,y.Z)(n,[{key:"visualizeIntersectionPoint",value:function(e,t){var n=t.coordinateHelper,i=t.view;return(0,S.aF)(new U.S({view:i,primitive:"circle",geometry:n.vectorToPoint(e.intersectionPoint),elevationInfo:(0,k.v)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:H.l.toUnitRGBA(Yt.orange),pixelSnappingEnabled:!1}))}},{key:"visualizePoint",value:function(e,t){var n=t.view,i=t.coordinateHelper,r=this._alignPoint(e.point,e.domain,t);return(0,S.aF)(new U.S({view:n,primitive:"circle",geometry:i.vectorToPoint(r),elevationInfo:this._hintElevationInfo(e,t),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:H.l.toUnitRGBA(Yt.orange),pixelSnappingEnabled:!1}))}},{key:"visualizeLine",value:function(e,t){var n=t.view,i=t.coordinateHelper,r=this._alignPoint(e.lineStart,e.domain,t),a=this._alignPoint(e.lineEnd,e.domain,t);return(0,S.aF)(this._createLineSegmentHintFromMap(e.type,r,a,i,this._hintElevationInfo(e,t),n,e.fadeLeft,e.fadeRight))}},{key:"visualizeParallelSign",value:function(e,t){var n=t.view,i=t.coordinateHelper,r=this._hintElevationInfo(e,t),a=this._alignPoint(e.lineStart,e.domain,t),o=this._alignPoint(e.lineEnd,e.domain,t),s=(0,b.f)(a,i,r,n),l=(0,b.f)(o,i,r,n),u=(0,E.A)(l,s,l,.5),c=new Rt({view:n,attached:!1,offset:Yt.parallelLineHintOffset,length:Yt.parallelLineHintLength,width:Yt.parallelLineHintWidth,color:H.l.toUnitRGBA(Yt.orange),location:u,renderOccluded:W.ah.Opaque});return c.setDirectionFromPoints(s,u),c.attached=!0,(0,S.aF)(c)}},{key:"visualizeRightAngleQuad",value:function(e,t){var n=t.view,i=t.coordinateHelper,r=this._hintElevationInfo(e,t),a=this._alignPoint(e.previousVertex,e.domain,t),o=this._alignPoint(e.centerVertex,e.domain,t),s=this._alignPoint(e.nextVertex,e.domain,t);return(0,S.aF)(new J.S({view:n,attached:!0,color:H.l.toUnitRGBA(Yt.orange),renderOccluded:W.ah.Transparent,outlineRenderOccluded:W.ah.Opaque,outlineColor:H.l.toUnitRGBA(Yt.orange),outlineSize:Yt.rightAngleHintOutlineSize,size:Yt.rightAngleHintSize,geometry:{previous:(0,b.f)(a,i,r,n),center:(0,b.f)(o,i,r,n),next:(0,b.f)(s,i,r,n)}}))}},{key:"_createLineSegmentHintFromMap",value:function(e,t,n,i,r,a){var o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=(0,E.n)(),u=(0,E.n)();return(0,b.c)(t,n,i,r,a,l,u),this._createLineSegmentHint(e,a,l,u,o,s)}},{key:"_createLineSegmentHint",value:function(e,t,n,i){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=new Et({view:t,extensionType:Mt.FADED,start:n,end:i,color:H.l.toUnitRGBA(Yt.orange),renderOccluded:W.ah.Opaque});switch(e){case Wt.TARGET:o.width=Yt.lineHintWidthTarget,o.fadedExtensions={start:0,end:Yt.lineHintFadedExtensions};break;case Wt.REFERENCE_EXTENSION:o.width=Yt.lineHintWidthReference,o.fadedExtensions={start:0,end:0};break;case Wt.REFERENCE:o.width=Yt.lineHintWidthReference,o.fadedExtensions={start:r?Yt.lineHintFadedExtensions:0,end:a?Yt.lineHintFadedExtensions:0}}return o.attached=!0,o}},{key:"_alignPoint",value:function(e,t,n){var i=this._getSelfSnappingZ(t,n);if((0,k.t)(i))return e;var r=n.coordinateHelper,a=r.vectorToPoint(e,cn);return a.z=i,r.pointToVector(a)}},{key:"_hintElevationInfo",value:function(e,t){return(0,k.r)(this._getSelfSnappingZ(e.domain,t))?(0,k.e)(t.selfSnappingZ).elevationInfo:(0,k.v)(e.elevationInfo,t.elevationInfo)}},{key:"_getSelfSnappingZ",value:function(e,t){var n=t.selfSnappingZ;return e===qt.SELF&&(0,k.r)(n)?n.value:null}}]),n}(ln),cn=new L.w,dn={main:new H.l([255,127,0]),selected:new H.l([255,255,255]),staged:new H.l([12,207,255]),outline:new H.l([0,0,0,.5]),selectedOutline:new H.l([255,255,255])},hn=.3;function pn(e,t){var n=e.clone();return n.a*=t,n}function fn(e,t){var n=e.clone(),i=(0,ee.y)(n);i.s*=t;var r=(0,ee.p)(i);return n.r=r.r,n.g=r.g,n.b=r.b,n}function vn(e,t){if(t)for(var n in t)e[n]=t[n]}var yn=(0,y.Z)((function e(t){(0,v.Z)(this,e),this.color=dn.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=W.ah.Opaque,vn(this,t)})),gn=function(){function e(t){(0,v.Z)(this,e),this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=dn.main,this.outlineColor=dn.outline,this.renderOccluded=W.ah.Opaque,this.hoverOutlineColor=dn.selectedOutline,vn(this,t)}return(0,y.Z)(e,[{key:"apply",value:function(e,t){var n=this[e];t.setParameters({color:bn(n),transparent:"color"!==e||n.a<1,renderOccluded:this.renderOccluded})}}]),e}(),mn=function(){function e(t){(0,v.Z)(this,e),this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=pn(dn.main,.5),this.hoverColor=dn.main,this.renderOccluded=W.ah.Transparent,this.minSquaredEdgeLength=900,vn(this,t)}return(0,y.Z)(e,[{key:"apply",value:function(e,t){var n=this[e];t.setParameters({color:bn(n),transparent:n.a<1,renderOccluded:this.renderOccluded})}}]),e}(),_n=(0,y.Z)((function e(t){(0,v.Z)(this,e),this.vertex=new gn({color:dn.main,outlineColor:dn.outline}),this.edge=new gn({color:fn(pn(dn.main,2/3),.5),outlineColor:pn(dn.outline,.5),size:8,collisionPadding:8}),this.selected=new gn({color:dn.selected,outlineColor:dn.outline}),this.edgeOffset=new mn,vn(this,t)})),Sn=function(){function e(t){(0,v.Z)(this,e),this.color=dn.selected,this.width=1.5,this.stipplePattern=(0,O.a5)(5),this.stippleOffColor=dn.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=dn.selected,this.renderOccluded=W.ah.OccludeAndTransparent,vn(this,t)}return(0,y.Z)(e,[{key:"apply",value:function(e){e.color=bn(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=bn(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=bn(this.innerColor),e.renderOccluded=this.renderOccluded}}]),e}(),wn=function(){function e(t){(0,v.Z)(this,e),this.color=dn.selected,this.size=4,this.outlineSize=1,this.outlineColor=dn.outline,this.shape="square",vn(this,t)}return(0,y.Z)(e,[{key:"apply",value:function(e){e.color=bn(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=bn(this.outlineColor),e.primitive=this.shape}}]),e}(),kn=function(){function e(t){(0,v.Z)(this,e),this.innerColor=dn.selected,this.innerWidth=1,this.glowColor=dn.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=hn,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=dn.main,vn(this,t)}return(0,y.Z)(e,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n={glowColor:H.l.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:H.l.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=n:e.laserlineStyle=n}}]),e}(),Zn=(0,y.Z)((function e(t){(0,v.Z)(this,e),this.outline=new Sn({color:dn.outline,renderOccluded:W.ah.OccludeAndTransparentStencil,stippleOffColor:dn.selected,stipplePattern:(0,O.a5)(5),width:1.5,innerWidth:0}),this.staged=new Sn({color:dn.selected,renderOccluded:W.ah.OccludeAndTransparentStencil,innerColor:dn.staged,stippleOffColor:dn.outline,stipplePattern:(0,O.a5)(5),width:1.5}),this.shadowStyle=new kn({globalAlpha:hn,glowColor:dn.main,glowFalloff:8,glowWidth:8,innerColor:dn.selected,innerWidth:1}),vn(this,t)})),xn=(0,y.Z)((function e(t){(0,v.Z)(this,e),this.outline=new wn({color:dn.selected,outlineColor:dn.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new kn({globalAlpha:hn,glowColor:dn.main,glowFalloff:1.5,glowWidth:6,innerColor:dn.selected,innerWidth:1,radius:2}),vn(this,t)})),Pn=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this)).extensionType=Mt.GROUND_RAY,vn((0,c.Z)(i),e),i}return(0,y.Z)(n)}(Sn),Mn=(0,y.Z)((function e(t){(0,v.Z)(this,e),this.lineGraphics=new Zn,this.pointGraphics=new xn,this.heightPlane=new kn({globalAlpha:hn,glowColor:dn.main,glowFalloff:8,glowWidth:8,innerColor:dn.selected,innerWidth:1}),this.heightBox=new kn({globalAlpha:hn,glowColor:dn.main,glowFalloff:8,glowWidth:8,innerColor:dn.selected,innerWidth:0,heightFillColor:dn.main}),this.zVerticalLine=new Pn({color:pn(dn.main,.5),falloff:2,innerColor:pn(dn.selected,0),renderOccluded:W.ah.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:Mt.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,vn(this,t)})),En=function(){function e(t){(0,v.Z)(this,e),this.visualElements=new Mn,this.reshapeManipulators=new _n,this.zManipulator=new yn,vn(this,t)}return(0,y.Z)(e,[{key:"colorToVec4",value:function(e){return bn(e)}}]),e}();function bn(e){return(0,te.e)(H.l.toUnitRGBA(e))}var Cn=new En;var An=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).view=null,i._renderOccluded=W.ah.OccludeAndTransparent,i._vertices=null,i._spatialReference=null,i._color=Cn.colorToVec4(Cn.reshapeManipulators.vertex.color),i._size=Cn.reshapeManipulators.vertex.size,i._outlineColor=Cn.colorToVec4(Cn.reshapeManipulators.vertex.outlineColor),i._outlineSize=Cn.reshapeManipulators.vertex.outlineSize,i._elevationInfo=null,i.applyProps(e),i}return(0,y.Z)(n,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}},{key:"vertices",get:function(){return this._vertices},set:function(e){this._vertices=e,this.recreateGeometry()}},{key:"spatialReference",get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.recreateGeometry()}},{key:"color",get:function(){return this._color},set:function(e){(0,E.Q)(e,this._color)||((0,E.B)(this._color,e),this._updateMaterial())}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,E.Q)(e,this._outlineColor)||((0,E.B)(this._outlineColor,e),this._updateOutlineMaterial())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"_vertexMaterialParameters",get:function(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}},{key:"_vertexOutlineMaterialParameters",get:function(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}},{key:"_updateMaterial",value:function(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}},{key:"_updateOutlineMaterial",value:function(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}},{key:"_createRenderGeometries",value:function(){var e=this.vertices;if((0,k.t)(e)||0===e.length)return[];for(var t=function(e,t,n,i,r){var a=new Float64Array(3*e.length),o=new Float64Array(a.length);e.forEach((function(e,t){a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0}));var s=(0,O.ad)(a,t,0,o,0,a,0,a.length/3,n,i,r),l=null!=s;return{numVertices:e.length,position:a,mapPosition:o,projectionSuccess:l,sampledElevation:s}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,O.M.fromElevationInfo(this.elevationInfo)),n=[],i=t.numVertices,r=t.position,a=0;a<i;++a){var o=(0,E.o)(Tn,r[3*a+0],r[3*a+1],r[3*a+2]),s=Dn(.5,o),l=Dn(.5,o);n.push({vertexGeometry:s,vertexOutlineGeometry:l})}return n}},{key:"createGeometries",value:function(e){var t,n=this._createRenderGeometries(),i=(0,f.Z)(n);try{for(i.s();!(t=i.n()).done;){var r=t.value,a=r.vertexGeometry,o=r.vertexOutlineGeometry;e.addGeometry(a,this._vertexMaterial),e.addGeometry(o,this._vertexOutlineMaterial)}}catch(s){i.e(s)}finally{i.f()}}},{key:"createExternalResources",value:function(){this._vertexMaterial=new F.v((0,p.Z)((0,p.Z)({},this._vertexMaterialParameters),{},{writeDepth:!0,cullFace:ne.n.Back,screenSizeEnabled:!0})),this._vertexOutlineMaterial=new F.v((0,p.Z)((0,p.Z)({},this._vertexOutlineMaterialParameters),{},{transparent:!0,writeDepth:!0,cullFace:ne.n.Front,screenSizeEnabled:!0,shadingEnabled:!1}))}},{key:"destroyExternalResources",value:function(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}},{key:"forEachExternalMaterial",value:function(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}]),n}(x.n),Tn=(0,E.n)();function Dn(e,t){return(0,O.ae)(e,16,16,{offset:t})}var On=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).layer=null,i.enabled=!0,i.updating=!1,i.availability=1,i}return(0,y.Z)(n)}(S.m);(0,S.e)([(0,S.y)({constructOnly:!0})],On.prototype,"layer",void 0),(0,S.e)([(0,S.y)()],On.prototype,"enabled",void 0),(0,S.e)([(0,S.y)()],On.prototype,"updating",void 0),(0,S.e)([(0,S.y)()],On.prototype,"availability",void 0);var Rn=On=(0,S.e)([(0,S.n)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],On),Ln=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).enabled=!1,i.enabledToggled=!1,i.selfEnabled=!0,i.featureEnabled=!0,i.featureSources=new w.j,i.distance=Yt.distance,i.touchSensitivityMultiplier=Yt.touchSensitivityMultiplier,i}return(0,y.Z)(n,[{key:"effectiveEnabled",get:function(){return this.enabledToggled?!this.enabled:this.enabled}},{key:"effectiveSelfEnabled",get:function(){return this.effectiveEnabled&&this.selfEnabled}},{key:"effectiveFeatureEnabled",get:function(){return this.effectiveEnabled&&this.featureEnabled}}]),n}(S.m);(0,S.e)([(0,S.y)()],Ln.prototype,"enabled",void 0),(0,S.e)([(0,S.y)()],Ln.prototype,"enabledToggled",void 0),(0,S.e)([(0,S.y)()],Ln.prototype,"selfEnabled",void 0),(0,S.e)([(0,S.y)()],Ln.prototype,"featureEnabled",void 0),(0,S.e)([(0,S.y)({type:w.j.ofType(Rn)})],Ln.prototype,"featureSources",void 0),(0,S.e)([(0,S.y)()],Ln.prototype,"distance",void 0),(0,S.e)([(0,S.y)()],Ln.prototype,"touchSensitivityMultiplier",void 0),(0,S.e)([(0,S.y)({readOnly:!0})],Ln.prototype,"effectiveEnabled",null),(0,S.e)([(0,S.y)({readOnly:!0})],Ln.prototype,"effectiveSelfEnabled",null),(0,S.e)([(0,S.y)({readOnly:!0})],Ln.prototype,"effectiveFeatureEnabled",null);var Hn,zn=Ln=(0,S.e)([(0,S.n)("esri.views.interactive.snapping.SnappingOptions")],Ln);function In(e,t,n){var i=e.start,r=e.end,a=e.type,o=[],s=t,l=(0,B.o)(Kn,r,i),u=(0,B.o)($n,i,s),c=(0,B.p)(l),d=2*(0,B.j)(l,u),h=d*d-4*c*((0,B.p)(u)-n*n);if(0===h){var p=-d/(2*c);(a===Hn.PLANE||p>=0)&&o.push((0,B.d)((0,E.c)(0,0,t[2]),i,l,p))}else if(h>0){var f=Math.sqrt(h),v=(-d+f)/(2*c);(a===Hn.PLANE||v>=0)&&o.push((0,B.d)((0,E.c)(0,0,t[2]),i,l,v));var y=(-d-f)/(2*c);(a===Hn.PLANE||y>=0)&&o.push((0,B.d)((0,E.c)(0,0,t[2]),i,l,y))}return o}function Vn(e,t){var n=e.start,i=e.end,r=(0,B.o)(Kn,i,n),a=(0,E.o)($n,-r[1],r[0],0),o=t.start,s=t.end,l=(0,E.a0)(ei,s,o),u=(0,E.P)(l,a),c=(0,E.o)(ti,n[0],n[1],0),d=(0,E.a0)(ni,c,o),h=(0,E.P)(d,a);if(Math.abs(u)<Jn)return[];var p=(0,E.ab)(ii,o,l,h/u);if(t.type===re.b.RAY){var f=(0,E.a0)(ri,p,o);if((0,E.P)(f,l)<-Jn)return[]}if(e.type===Hn.HALF_PLANE){var v=(0,B.C)(ri,p,n);if((0,B.j)(v,r)<-Jn)return[]}return[(0,E.t)(p)]}function Fn(e,t){return Un(Qn(ai,t[2],e),t)}function Gn(e,t){var n,i=jn(Qn(ai,0,e),Qn(oi,0,t)),r=[],a=(0,f.Z)(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;r.push((0,oe.t)(o))}}catch(s){a.e(s)}finally{a.f()}return r}function Nn(e,t){return qn(e,Qn(ai,e[2],t))}function qn(e,t){var n=t.start,i=t.end,r=t.type,a=(0,E.a0)(Kn,e,n),o=(0,E.a0)($n,i,n),s=(0,E.P)(a,o)/(0,E.P)(o,o);return(0,E.ab)((0,E.n)(),n,o,r===re.b.RAY?Math.max(s,0):s)}function Yn(e,t){var n=e.start,i=e.end,r=e.type,a=(0,E.a0)(Kn,t,n),o=(0,E.a0)($n,i,n);if(r===re.b.RAY&&(0,E.P)(o,a)<-Jn)return(0,E.x)(n,t);var s=(0,E._)(ei,o,a);return(0,E.Y)(s)/(0,E.Y)(o)}function Xn(e,t,n){var i=e.start,r=e.end,a=e.type,o=[];if((0,E.T)(i[2],t[2],Jn)&&(0,E.T)(r[2],t[2],Jn)){var s=i,l=t,u=(0,B.o)(Kn,r,s),c=(0,B.o)($n,s,l),d=(0,B.p)(u),h=2*(0,B.j)(u,c),p=h*h-4*d*((0,B.p)(c)-n*n);if(0===p){var v=-h/(2*d);(a===re.b.LINE||v>=0)&&o.push((0,B.d)((0,E.c)(0,0,t[2]),s,u,v))}else if(p>0){var y=Math.sqrt(p),g=(-h+y)/(2*d);(a===re.b.LINE||g>=0)&&o.push((0,B.d)((0,E.c)(0,0,t[2]),s,u,g));var m=(-h-y)/(2*d);(a===re.b.LINE||m>=0)&&o.push((0,B.d)((0,E.c)(0,0,t[2]),s,u,m))}}else{var _=(0,E.a0)(Kn,r,i);if((0,E.T)(_[2],0,Jn))return o;var S=(t[2]-i[2])/_[2],w=(0,E.ab)($n,i,_,S);if(a===re.b.RAY){var k=(0,E.a0)(ei,w,i);if((0,E.P)(_,k)<-Jn)return o}var Z,x=(0,f.Z)(Wn(t,n,w));try{for(x.s();!(Z=x.n()).done;){var P=Z.value;o.push(P)}}catch(M){x.e(M)}finally{x.f()}}return o}function jn(e,t){var n=e.start,i=e.end,r=t.start,a=t.end,o=(0,E.a0)(Kn,i,n),s=(0,E.a0)($n,a,r),l=(0,E.a0)(ei,r,n),u=(0,E._)(ti,o,s),c=(0,E.P)(l,u);if(!(0,E.T)(c,0,Jn))return[];var d=(0,E.a5)(u);if((0,E.T)(d,0,Jn))return[];var h=(0,E._)(ni,l,s),p=(0,E.P)(h,u)/d,f=(0,E.ab)(ii,n,o,p);if(e.type===re.b.RAY){var v=(0,E.a0)(ri,f,n);if((0,E.P)(o,v)<-Jn)return[]}if(t.type===re.b.RAY){var y=(0,E.a0)(ri,f,r);if((0,E.P)(s,y)<-Jn)return[]}return[(0,E.t)(f)]}function Un(e,t){var n=e.start,i=e.end,r=e.type,a=(0,E.a0)(Kn,t,n),o=(0,E.a0)($n,i,n),s=(0,E._)(ei,o,a);if((0,E.a5)(s)/(0,E.a5)(o)<Jn)switch(r){case re.b.LINE:return[(0,E.t)(t)];case re.b.RAY:return(0,E.P)(o,a)<-Jn?[]:[(0,E.t)(t)]}return[]}function Wn(e,t,n){return(0,E.T)(e[2],n[2],Jn)&&(0,E.T)((0,E.p)(n,e),t*t,Jn)?[(0,E.t)(n)]:[]}function Qn(e,t,n){var i=n.start,r=n.end,a=n.type;return(0,E.o)(e.start,i[0],i[1],t),(0,E.o)(e.end,r[0],r[1],t),e.type=Bn[a],e}!function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"}(Hn||(Hn={}));var Bn=(i={},(0,u.Z)(i,Hn.PLANE,re.b.LINE),(0,u.Z)(i,Hn.HALF_PLANE,re.b.RAY),i),Jn=1e-6,Kn=(0,E.n)(),$n=(0,E.n)(),ei=(0,E.n)(),ti=(0,E.n)(),ni=(0,E.n)(),ii=(0,E.n)(),ri=(0,E.n)(),ai={start:(0,E.n)(),end:(0,E.n)(),type:re.b.LINE},oi={start:(0,E.n)(),end:(0,E.n)(),type:re.b.LINE},si=function(){function e(t){(0,v.Z)(this,e),this.coordinateHelper=t}return(0,y.Z)(e,[{key:"intersect",value:function(e){return function(e,t){var n=[];if(Si(e)){var i=e.pointXYZ;wi(t)?n=Un(t.lineLike,i):ki(t)?n=Wn(t.centerXYZ,t.radius,i):Zi(t)?n=Fn(t.planeLike,i):xi(t)&&(n=_i(t,e))}else if(wi(e)){var r=e.lineLike;Si(t)?n=Un(r,t.pointXYZ):wi(t)?n=jn(r,t.lineLike):ki(t)?n=Xn(r,t.centerXYZ,t.radius):Zi(t)?n=Vn(t.planeLike,r):xi(t)&&(n=_i(t,e))}else if(ki(e)){var a=e.centerXYZ,o=e.radius;wi(t)?n=Xn(t.lineLike,a,o):Si(t)?n=Wn(a,o,t.pointXYZ):Zi(t)?n=In(t.planeLike,a,o):xi(t)&&(n=_i(t,e))}else if(Zi(e)){var s=e.planeLike,l=e.coordinateHelper;if(Zi(t))return Gn(s,t.planeLike).map((function(n){return new hi(l,l.fromXYZ(n),e,t)}));Si(t)?n=Fn(s,t.pointXYZ):wi(t)?n=Vn(s,t.lineLike):ki(t)?n=In(s,t.centerXYZ,t.radius):xi(t)&&(n=_i(t,e))}else xi(e)&&(n=_i(e,t));return function(e,t,n){var i=t.coordinateHelper;return e.map((function(e){return new di(i,i.fromXYZ(e),t,n)}))}(n,e,t)}(this,e)}}]),e}(),li=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i){var r;return(0,v.Z)(this,n),(r=t.call(this,e)).point=i,r.pointXYZ=e.toXYZ(i),r}return(0,y.Z)(n,[{key:"equals",value:function(e){return Si(e)&&Xt(this.point,e.point)}},{key:"check",value:function(e){var t=this.coordinateHelper.toXYZ(e,Mi);return(0,E.p)(t,this.pointXYZ)<Yt.pointThreshold}},{key:"closestTo",value:function(){return this.coordinateHelper.clone(this.point)}}]),n}(si),ui=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r,a){var o;return(0,v.Z)(this,n),(o=t.call(this,e)).start=i,o.end=r,o.type=a,o.startXYZ=e.toXYZ(i),o.endXYZ=e.toXYZ(r),o.lineLike={start:o.startXYZ,end:o.endXYZ,type:o.type},o}return(0,y.Z)(n,[{key:"equals",value:function(e){return wi(e)&&this.type===e.type&&Xt(this.start,e.start)&&Xt(this.end,e.end)}},{key:"check",value:function(e){var t=this.coordinateHelper.toXYZ(e,Mi);return Yn(this.lineLike,t)<Yt.pointOnLineThreshold}},{key:"closestTo",value:function(e){var t=this.coordinateHelper,n=qn(t.toXYZ(e,Mi),this.lineLike);return t.fromXYZ(n)}}]),n}(si),ci=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r){return(0,v.Z)(this,n),t.call(this,e,i,r,re.b.LINE)}return(0,y.Z)(n)}(ui),di=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r,a){var o;return(0,v.Z)(this,n),(o=t.call(this,e)).intersection=i,o.first=r,o.second=a,o}return(0,y.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&this.first.equals(e.first)&&this.second.equals(e.second)}},{key:"check",value:function(){return!1}},{key:"closestTo",value:function(){return this.coordinateHelper.clone(this.intersection)}}]),n}(si),hi=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r,a){var o;return(0,v.Z)(this,n),(o=t.call(this,e)).basePoint=i,o.first=r,o.second=a,o}return(0,y.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&this.first.equals(e.first)&&this.second.equals(e.second)}},{key:"check",value:function(){return!1}},{key:"closestTo",value:function(e){var t=this.basePoint,n=this.coordinateHelper,i=n.toXYZ(e,Mi),r=(0,E.o)(Ei,t[0],t[1],i[2]);return n.fromXYZ(r)}}]),n}(si),pi=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r){var a;return(0,v.Z)(this,n),(a=t.call(this,e)).center=i,a.radius=r,a.centerXYZ=e.toXYZ(i),a}return(0,y.Z)(n,[{key:"equals",value:function(e){return ki(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}},{key:"check",value:function(){return!1}},{key:"closestTo",value:function(e){var t=this.coordinateHelper,n=function(e,t,n){var i=(0,E.o)(Kn,e[0],e[1],t[2]),r=(0,E.e)($n,i,t),a=n/(0,E.s)(r);return(0,E.ab)((0,E.n)(),t,r,a)}(t.toXYZ(e,Mi),this.centerXYZ,this.radius);return n[2]=t.getZ(e,this.centerXYZ[2]),t.fromXYZ(n)}}]),n}(si),fi=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r,a){var o;return(0,v.Z)(this,n),(o=t.call(this,e)).start=i,o.end=r,o.type=a,o.planeLike={start:i,end:r,type:a},o}return(0,y.Z)(n,[{key:"equals",value:function(e){return Zi(e)&&this.type===e.type&&Xt(this.start,e.start)&&Xt(this.end,e.end)}},{key:"check",value:function(e){return function(e,t){return Yn(Qn(ai,e[2],t),e)}(this.coordinateHelper.toXYZ(e,Mi),this.planeLike)<Yt.pointOnLineThreshold}},{key:"closestTo",value:function(e){var t=this.coordinateHelper,n=Nn(t.toXYZ(e,Mi),this.planeLike);return t.fromXYZ(n)}},{key:"closestEndTo",value:function(e){var t=this.start,n=this.end;return Math.sign((0,B.j)((0,B.o)(bi,n,t),(0,B.o)(Ci,e,t)))>0?n:t}}]),n}(si),vi=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r){return(0,v.Z)(this,n),t.call(this,e,i,r,Hn.HALF_PLANE)}return(0,y.Z)(n)}(fi),yi=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r){return(0,v.Z)(this,n),t.call(this,e,i,r,Hn.PLANE)}return(0,y.Z)(n)}(fi),gi=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r,a){var o;return(0,v.Z)(this,n),(o=t.call(this,e)).start=i,o.end=r,o.getZ=a,o.planeLike={start:i,end:r,type:Hn.HALF_PLANE},o}return(0,y.Z)(n,[{key:"equals",value:function(e){return xi(e)&&Xt(this.start,e.start)&&Xt(this.end,e.end)&&this.getZ===e.getZ}},{key:"check",value:function(e){var t=this.coordinateHelper.toXYZ(e,Mi),n=mi(this,t);return(0,E.p)(t,n)<Yt.pointThreshold}},{key:"closestTo",value:function(e){var t=this.coordinateHelper,n=mi(this,t.toXYZ(e,Mi));return t.fromXYZ(n)}},{key:"addIfOnTheGround",value:function(e,t){var n,i=(0,f.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=this.getZ(r[0],r[1],r[2]);(0,k.r)(a)&&Math.abs(r[2]-a)<Jn&&(r[2]=a,e.push(r))}}catch(o){i.e(o)}finally{i.f()}}}]),n}(si);function mi(e,t){var n=Nn(t,e.planeLike),i=e.getZ(t[0],t[1],t[2]);return(0,k.r)(i)&&(n[2]=i),n}function _i(e,t){var n=e.planeLike,i=e.getZ,r=[];if(Si(t))e.addIfOnTheGround(r,Fn(n,t.pointXYZ));else if(wi(t))e.addIfOnTheGround(r,Vn(n,t.lineLike));else if(ki(t))e.addIfOnTheGround(r,In(n,t.centerXYZ,t.radius));else if(Zi(t)||xi(t)){var a,o=(0,f.Z)(Gn(n,t.planeLike));try{for(o.s();!(a=o.n()).done;){var s=(0,_.Z)(a.value,2),l=s[0],u=s[1],c=i(l,u,0);(0,k.r)(c)&&r.push((0,E.c)(l,u,c))}}catch(d){o.e(d)}finally{o.f()}}return r}function Si(e){return e instanceof li}function wi(e){return e instanceof ui}function ki(e){return e instanceof pi}function Zi(e){return e instanceof fi}function xi(e){return e instanceof gi}var Pi,Mi=(0,E.n)(),Ei=(0,E.n)(),bi=(0,oe.n)(),Ci=(0,oe.n)(),Ai=(0,y.Z)((function e(t,n,i,r,a){(0,v.Z)(this,e),this.coordinateHelper=t,this.targetPoint=n,this.constraint=i,this.elevationInfo=r,this.domain=a})),Ti=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.targetPoint,o=e.objectId,s=e.constraint,l=e.elevationInfo;return(0,v.Z)(this,n),(i=t.call(this,r,a,s,l,qt.FEATURE)).objectId=o,i}return(0,y.Z)(n)}(Ai),Di=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){return(0,v.Z)(this,n),t.call(this,(0,p.Z)((0,p.Z)({},e),{},{constraint:new ci(e.coordinateHelper,e.edgeStart,e.edgeEnd)}))}return(0,y.Z)(n,[{key:"hints",get:function(){return[new rn(Wt.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo,this.domain)]}}]),n}(Ti),Oi=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.targetPoint,o=e.constraint,s=e.previousVertex,l=e.otherVertex,u=e.otherVertexType,c=e.objectId,d=e.elevationInfo;return(0,v.Z)(this,n),(i=t.call(this,r,a,o,d,qt.SELF)).previousVertex=s,i.otherVertex=l,i.otherVertexType=u,i.objectId=c,i}return(0,y.Z)(n,[{key:"hints",get:function(){var e=this.previousVertex,t=this.otherVertexType===Pi.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===Pi.CENTER?this.targetPoint:this.otherVertex,i=this.elevationInfo;return[new rn(Wt.TARGET,t,n,i,this.domain),new rn(Wt.REFERENCE,e,t,i,this.domain),new sn(this.previousVertex,t,n,i,this.domain)]}}]),n}(Ai);!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(Pi||(Pi={}));var Ri=function(e){(0,g.Z)(i,e);var t=(0,m.Z)(i);function i(e){var n;return(0,v.Z)(this,i),(n=t.call(this,e)).options=null,n._domain=qt.FEATURE,n._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}},n}return(0,y.Z)(i,[{key:"updating",get:function(){return(0,S.a9)(this.snappingSources,(function(e){return e.snappingSource.updating}))||this.updatingHandles.updating}},{key:"snappingSources",get:function(){var e=this._get("snappingSources")||new Map,t=new Map;if((0,k.r)(this.options)&&(0,k.r)(this.options.featureSources)){var n,i=(0,f.Z)(this.options.featureSources.items);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=r.layer.uid,o=e.get(a);if(o)e.delete(a),t.set(a,o);else if(r.layer.loaded){var s=this._createSourceInfo(r);(0,k.r)(s)&&t.set(a,s)}else this.updatingHandles.addPromise(r.layer.load())}}catch(c){i.e(c)}finally{i.f()}}var l,u=(0,f.Z)(e);try{for(u.s();!(l=u.n()).done;){(0,_.Z)(l.value,2)[1].destroy()}}catch(c){u.e(c)}finally{u.f()}return t}},{key:"initialize",value:function(){var e=this;this.updatingHandles.add((function(){return e.snappingSources}),(function(){return e.notifyChange("updating")}),Z.U),(0,k.r)(this.view)&&this.handles.add([this.view.on("layerview-create",(function(t){return e._updateLayerView(t.layer,t.layerView)})),this.view.on("layerview-destroy",(function(t){return e._updateLayerView(t.layer,null)}))])}},{key:"_updateLayerView",value:function(e,t){var n,i=(0,f.Z)(this.snappingSources);try{for(i.s();!(n=i.n()).done;){var r=(0,_.Z)(n.value,2)[1];r.snappingSource.layerSource.layer===e&&(r.layerView=t)}}catch(a){i.e(a)}finally{i.f()}}},{key:"destroy",value:function(){this._set("options",null);var e,t=(0,f.Z)(this.snappingSources);try{for(t.s();!(e=t.n()).done;){(0,_.Z)(e.value,2)[1].destroy()}}catch(n){t.e(n)}finally{t.f()}}},{key:"fetchCandidates",value:function(){var e=(0,l.Z)((0,s.Z)().mark((function e(t,n,i,r){var a,o,l,u,c,d,h,p=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&this._domain&&!(0,k.t)(this.options)&&this.options.effectiveFeatureEnabled){e.next=2;break}return e.abrupt("return",[]);case 2:a=[],o=this._computeScreeenSizeDistanceParameters(t,i),l={distance:o,point:t,coordinateHelper:i.coordinateHelper,types:this._types},u=(0,f.Z)(this.snappingSources);try{for(d=function(){var e=(0,_.Z)(c.value,2)[1],t=e.snappingSource,n=e.layerView;!t.layerSource.enabled||(0,k.r)(n)&&n.suspended||a.push(t.fetchCandidates(l,r).then((function(e){return e.filter((function(e){return!p._candidateIsExcluded(t,e,i.excludeFeature)}))})))},u.s();!(c=u.n()).done;)d()}catch(s){u.e(s)}finally{u.f()}return e.next=7,(0,S.ah)(a);case 7:return h=e.sent.flat(),e.abrupt("return",(this._addRightAngleCandidates(h,t,o,i),(0,S.f)(r),Ut(t,h,i.coordinateHelper),h));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,i,r){return e.apply(this,arguments)}}()},{key:"_addRightAngleCandidates",value:function(e,t,n,i){for(var r,a,o,s,l,u,c,d,h=(0,k.r)(i.vertexHandle)?null===(r=i.vertexHandle.rightEdge)||void 0===r||null===(a=r.rightVertex)||void 0===a?void 0:a.pos:(0,k.r)(i.editGeometryOperations)&&"polygon"===i.editGeometryOperations.data.type?null===(o=(0,k.e)(null===(s=i.editGeometryOperations.data.components[0])||void 0===s?void 0:s.getFirstVertex()))||void 0===o?void 0:o.pos:null,p=(0,k.r)(i.vertexHandle)?null===(l=i.vertexHandle.leftEdge)||void 0===l||null===(u=l.leftVertex)||void 0===u?void 0:u.pos:(0,k.r)(i.editGeometryOperations)?null===(c=(0,k.e)(null===(d=i.editGeometryOperations.data.components[0])||void 0===d?void 0:d.getLastVertex()))||void 0===c?void 0:c.pos:null,f=this.view,v=Kt(h,f,i),y=Kt(p,f,i),g=e.length,m=0;m<g;m++)this._addRightAngleCandidate(e[m],y,t,n,i,e),this._addRightAngleCandidate(e[m],v,t,n,i,e)}},{key:"_addRightAngleCandidate",value:function(e,t,n,i,r,a){var o=e instanceof Di,s=o&&(0,B.k)(e.constraint.start,e.constraint.end);if(!(0,k.t)(t)&&o&&!s){var l=e.constraint.closestTo(t),u=(l[0]-n[0])/i.x,c=(l[1]-n[1])/i.y;if(u*u+c*c<=1){var d=r.coordinateHelper,h=new Oi({coordinateHelper:d,targetPoint:l,otherVertex:t,otherVertexType:Pi.NEXT,previousVertex:e.constraint.start,constraint:new vi(d,t,l),objectId:e.objectId,elevationInfo:e.elevationInfo});a.push(h)}}}},{key:"_computeScreeenSizeDistanceParameters",value:function(e,t){var n=(0,k.r)(this.options)?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return(0,k.t)(this.view)?{x:n,y:n,z:n,distance:n}:"2d"===this.view.type?{x:n*=this.view.resolution,y:n,z:n,distance:n}:this._computeScreenSizeDistanceParameters3D(e,n,this.view,t)}},{key:"_computeScreenSizeDistanceParameters3D",value:function(e,t,n,i){var r=i.coordinateHelper,a=i.elevationInfo,o=r.spatialReference,s=r.hasZ()?$.E:a,l=r.toXYZ(e,zi);l[2]=(0,$.h)(n,l,o,s,$.E),n.renderCoordsHelper.toRenderCoords(l,o,Ii);var u=n.state.camera.computeScreenPixelSizeAt(Ii),c=u*n.renderCoordsHelper.unitInMeters/n.mapCoordsHelper.unitInMeters,d=t*c,h=(0,b.u)(l,o,$.E,n),p=Hi(h,l,c,0,0,n,i),f=Hi(h,l,0,c,0,n,i),v=Hi(h,l,0,0,c,n,i);return{x:0===p?0:d/p,y:0===f?0:d/f,z:0===v?0:d/v,distance:u*t}}},{key:"_types",get:function(){return ae.q.EDGE|ae.q.VERTEX}},{key:"_candidateIsExcluded",value:function(e,t,n){if((0,k.t)(n))return!1;var i=this._getCandidateObjectId(t);if((0,k.t)(i))return!1;var r=e.layerSource.layer;return"graphics"===r.type?n.uid===i:n.sourceLayer===r&&!(!n.attributes||!("objectIdField"in r))&&n.attributes[r.objectIdField]===i}},{key:"_getCandidateObjectId",value:function(e){return e instanceof Ti?e.objectId:null}},{key:"_createSourceInfo",value:function(e){var t=this,n=this._createFeatureSnappingSourceType(e);if((0,k.t)(n))return null;if("loading"in n)return this.updatingHandles.addPromise(n.loading.then((function(){t.destroyed||t.notifyChange("snappingSources")}))),null;var i=(0,k.r)(this.view)?this.view.allLayerViews.find((function(t){return t.layer===e.layer})):null;return new Li(n.source,i)}},{key:"_createFeatureSnappingSourceType",value:function(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}},{key:"_createFeatureSnappingSourceSceneLayer",value:function(e){var t=this.view;if((0,k.t)(t)||"3d"!==t.type)return null;var n=this._getSourceModule("scene");return(0,k.r)(n.module)?{source:new n.module.SceneLayerSnappingSource({layerSource:e,view:t})}:{loading:n.loader}}},{key:"_createFeatureSnappingSourceFeatureLayer",value:function(e){switch(e.layer.source.type){case"feature-layer":case"oriented-imagery":var t=this._getSourceModule("featureService");return(0,k.r)(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader};case"memory":case"csv":case"geojson":case"wfs":if("mesh"===e.layer.geometryType)return null;var n=this._getSourceModule("featureCollection");return(0,k.r)(n.module)?{source:new n.module.FeatureCollectionSnappingSource({layerSource:e,view:this.view})}:{loading:n.loader}}return null}},{key:"_createFeatureSnappingSourceGraphicsLayer",value:function(e){var t=this._getSourceModule("graphics");return(0,k.r)(t.module)?{source:new t.module.GraphicsSnappingSource({getGraphicsLayers:function(){return[e.layer]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}},{key:"_createFeatureSnappingSourceMapNotesLayer",value:function(e){var t=this._getSourceModule("notes");return(0,k.r)(t.module)?{source:new t.module.GraphicsSnappingSource({getGraphicsLayers:function(){return(0,k.r)(e.layer.sublayers)?e.layer.sublayers.toArray():[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}},{key:"_getSourceModule",value:function(e){var t=this._sourceModules[e];if((0,k.t)(t.loader)){var n=this._loadSourceModule(e).then((function(e){t.module=e}));return t.loader=n,{module:t.module,loader:n}}return{module:t.module,loader:t.loader}}},{key:"_loadSourceModule",value:function(e){var t=this.updatingHandles;switch(e){case"featureService":return t.addPromise(n.e(4694).then(n.bind(n,44694)));case"featureCollection":return t.addPromise(n.e(8190).then(n.bind(n,28190)));case"graphics":case"notes":return t.addPromise(Promise.all([n.e(8420),n.e(6593),n.e(5836)]).then(n.bind(n,95836)));case"scene":return t.addPromise(n.e(8442).then(n.bind(n,58442)))}return null}}]),i}(q.d);(0,S.e)([(0,S.y)({constructOnly:!0})],Ri.prototype,"spatialReference",void 0),(0,S.e)([(0,S.y)({constructOnly:!0})],Ri.prototype,"view",void 0),(0,S.e)([(0,S.y)()],Ri.prototype,"options",void 0),(0,S.e)([(0,S.y)({readOnly:!0})],Ri.prototype,"updating",null),(0,S.e)([(0,S.y)({readOnly:!0})],Ri.prototype,"snappingSources",null),Ri=(0,S.e)([(0,S.n)("esri.views.interactive.snapping.FeatureSnappingEngine")],Ri);var Li=function(){function e(t,n){(0,v.Z)(this,e),this.snappingSource=t,this.layerView=n,this.handles=new S.X;var i=this.snappingSource.layerSource.layer;if("refresh"in i){var r=i;this.handles.add(r.on("refresh",(function(){return t.refresh()})))}this.handles.add([(0,Z.l)((function(){return t.updating}),(function(e){return t.layerSource.updating=e}),Z.w),(0,Z.l)((function(){return t.availability}),(function(e){return t.layerSource.availability=e}),Z.w)])}return(0,y.Z)(e,[{key:"destroy",value:function(){this.snappingSource.destroy(),this.handles.destroy()}}]),e}();function Hi(e,t,n,i,r,a,o){var s=o.coordinateHelper,l=(0,E.r)(Vi,t);return l[0]+=n,l[1]+=i,l[2]+=r,function(e,t){return Math.sqrt(jt(e,t))}((0,b.u)(l,s.spatialReference,$.E,a),e)}var zi=(0,E.n)(),Ii=(0,E.n)(),Vi=(0,E.n)(),Fi=function(){function e(t,n){(0,v.Z)(this,e),this.view=t,this.options=n,this.squaredShortLineThreshold=Yt.shortLineThreshold*Yt.shortLineThreshold}return(0,y.Z)(e,[{key:"snap",value:function(e,t){return(0,k.r)(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}},{key:"edgeExceedsShortLineThreshold",value:function(e,t){return this.exceedsShortLineThreshold(e.leftVertex.pos,e.rightVertex.pos,t)}},{key:"exceedsShortLineThreshold",value:function(e,t,n){var i=n.elevationInfo,r=n.editGeometryOperations.data.coordinateHelper;return 0===this.squaredShortLineThreshold||jt((0,b.d)(t,r,i,this.view),(0,b.d)(e,r,i,this.view))>this.squaredShortLineThreshold}},{key:"squaredProximityThreshold",value:function(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}},{key:"_squaredMouseProximityTreshold",get:function(){return this.options.distance*this.options.distance}},{key:"_squaredTouchProximityThreshold",get:function(){var e=this.options,t=e.distance*e.touchSensitivityMultiplier;return t*t}}]),e}(),Gi=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.lineStart,o=e.lineEnd,s=e.targetPoint,l=e.elevationInfo;return(0,v.Z)(this,n),(i=t.call(this,r,s,new yi(r,a,o),l,qt.SELF))._referenceLineHint=new rn(Wt.REFERENCE_EXTENSION,a,o,l,i.domain),i}return(0,y.Z)(n,[{key:"hints",get:function(){return[this._referenceLineHint,new rn(Wt.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo,this.domain)]}},{key:"_lineEndClosestToTarget",value:function(){return this.constraint.closestEndTo(this.targetPoint)}}]),n}(Ai),Ni=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,y.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=[];if(i<1)return r;var a=t.coordinateHelper,o=(0,b.d)(e,a,$.E,this.view),s=this.view,l=n.edges[i-1],u=l;do{if(this.edgeExceedsShortLineThreshold(u,t)){var c=$t(u,s,t);this._processCandidateProposal(c.left,c.right,e,o,t,r)}u=u.leftVertex.leftEdge}while(u&&u!==l);return r}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,k.e)(t.vertexHandle),r=i.component;if(r.edges.length<2)return n;var a=this.view,o=t.coordinateHelper,s=(0,b.d)(e,o,$.E,a),l=i.leftEdge,u=i.rightEdge;l&&u&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(u,t)&&this._processCandidateProposal(Kt(l.leftVertex.pos,a,t),Kt(u.rightVertex.pos,a,t),e,s,t,n);var c=r.edges[0],d=c;do{if(d!==i.leftEdge&&d!==i.rightEdge&&this.edgeExceedsShortLineThreshold(d,t)){var h=$t(d,a,t);this._processCandidateProposal(h.left,h.right,e,s,t,n)}d=d.rightVertex.rightEdge}while(d&&d!==c);return n}},{key:"_processCandidateProposal",value:function(e,t,n,i,r,a){var o=r.coordinateHelper,s=r.pointer;o.toXYZ(e,qi),o.toXYZ(t,Yi);var l=qn(o.toXYZ(n,ji),Xi),u=o.fromXYZ(l);jt(i,(0,b.d)(u,o,$.E,this.view))<this.squaredProximityThreshold(s)&&a.push(new Gi({coordinateHelper:o,lineStart:e,lineEnd:t,targetPoint:u,elevationInfo:o.hasZ()?$.E:null}))}}]),n}(Fi),qi=(0,E.n)(),Yi=(0,E.n)(),Xi={start:qi,end:Yi,type:re.b.LINE},ji=(0,E.n)(),Ui=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.referenceLine,o=e.lineStart,s=e.targetPoint,l=e.elevationInfo;(0,v.Z)(this,n);var u=r.toXYZ(o,Wi),c=r.toXYZ(a.left,Qi),d=r.toXYZ(a.right,Bi);return(0,E.e)(u,(0,E.u)(u,u,d),c),(i=t.call(this,r,s,new yi(r,o,r.fromXYZ(u)),l,qt.SELF))._referenceLines=[{edge:a,fadeLeft:!0,fadeRight:!0}],i}return(0,y.Z)(n,[{key:"hints",get:function(){var e=this,t=this.elevationInfo;return[new rn(Wt.TARGET,this.constraint.start,this.targetPoint,t,this.domain),new an(this.constraint.start,this.targetPoint,t,this.domain)].concat((0,o.Z)(this._referenceLines.map((function(n){return new rn(Wt.REFERENCE,n.edge.left,n.edge.right,t,e.domain,n.fadeLeft,n.fadeRight)}))))}},{key:"addReferenceLine",value:function(e){var t={edge:e,fadeLeft:!0,fadeRight:!0},n=this.coordinateHelper;this._referenceLines.forEach((function(i){n.equals(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),n.equals(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),n.equals(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),n.equals(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}]),n}(Ai),Wi=(0,E.n)(),Qi=(0,E.n)(),Bi=(0,E.n)(),Ji=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,y.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=n.vertices.length,a=[];if(i<2)return a;var o=this.view,s=(0,b.d)(e,t.coordinateHelper,$.E,o),l=Kt(n.vertices[r-1].pos,o,t),u=Kt(n.vertices[0].pos,o,t),c=n.edges[i-1],d=c;do{if(this.edgeExceedsShortLineThreshold(d,t)){var h=$t(d,o,t);this._checkEdgeForParalleLines(h,l,e,s,t,a),this._checkEdgeForParalleLines(h,u,e,s,t,a)}d=d.leftVertex.leftEdge}while(d&&d!==c);return a}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,k.e)(t.vertexHandle),r=i.component;if(r.edges.length<3)return n;var a=this.view,o=(0,b.d)(e,t.coordinateHelper,$.E,a),s=i.leftEdge,l=i.rightEdge,u=r.vertices[0],c=Kt(u.pos,a,t),d=r.vertices.length,h=r.vertices[d-1],p=Kt(h.pos,a,t),f=r.edges[0],v=f;do{if(v!==s&&v!==l&&this.edgeExceedsShortLineThreshold(v,t)){var y=$t(v,a,t);s&&this._checkEdgeForParalleLines(y,Kt(s.leftVertex.pos,a,t),e,o,t,n),l&&this._checkEdgeForParalleLines(y,Kt(l.rightVertex.pos,a,t),e,o,t,n),i===u?this._checkEdgeForParalleLines(y,p,e,o,t,n):i===h&&this._checkEdgeForParalleLines(y,c,e,o,t,n)}v=v.rightVertex.rightEdge}while(v&&v!==f);return n}},{key:"_checkEdgeForParalleLines",value:function(e,t,n,i,r,a){var o=e.left,s=e.right;if((0,re.L)(Ki,t,o,s),!((0,B.b)(Ki,t)<Yt.parallelLineThreshold)){(0,re.L)(Ki,n,o,s,t);var l=r.coordinateHelper,u=r.pointer,c=l.fromXYZ(Ki,l.getZ(n,0));if(jt(i,(0,b.d)(c,l,$.E,this.view))<this.squaredProximityThreshold(u)){if(this._parallelToPreviousCandidate(e,a))return;a.push(new Ui({coordinateHelper:l,referenceLine:e,lineStart:t,targetPoint:c,elevationInfo:l.hasZ()?$.E:null}))}}}},{key:"_parallelToPreviousCandidate",value:function(e,t){var n,i=e.left,r=e.right,a=(0,f.Z)(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;if((0,re.L)(Ki,r,o.constraint.start,o.constraint.end,i),(0,B.b)(Ki,r)<Yt.parallelLineThreshold)return o.addReferenceLine(e),!0}}catch(s){a.e(s)}finally{a.f()}return!1}}]),n}(Fi),Ki=(0,oe.n)(),$i=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,y.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=n.vertices.length,r=[];if(i<2)return r;var a=this.view,o=(0,b.d)(e,t.coordinateHelper,$.E,a),s=n.vertices[i-1];if(this.edgeExceedsShortLineThreshold(s.leftEdge,t)){var l=Kt(s.pos,a,t),u=$t(s.leftEdge,a,t);this._checkForSnappingCandidate(r,u,l,e,u.left,l,t,e,o)}var c=n.vertices[0];if(this.edgeExceedsShortLineThreshold(c.rightEdge,t)){var d=Kt(c.pos,a,t),h=$t(c.rightEdge,a,t);this._checkForSnappingCandidate(r,h,d,e,h.right,d,t,e,o)}return r}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,k.e)(t.vertexHandle),r=i.component,a=r.vertices.length;if(a<3)return n;var o=this.view,s=(0,b.d)(e,t.coordinateHelper,$.E,o),l=i.leftEdge,u=i.rightEdge,c=r.vertices[0],d=r.vertices[a-1];if(!l){var h=c.rightEdge.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(h,t)){var p=$t(h,o,t),f=Kt(c.rightEdge.rightVertex.pos,o,t);this._checkForSnappingCandidate(n,p,f,e,p.right,f,t,e,s)}return n}if(!u){var v=d.leftEdge.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(v,t)){var y=$t(v,o,t),g=Kt(d.leftEdge.leftVertex.pos,o,t);this._checkForSnappingCandidate(n,y,g,e,y.left,g,t,e,s)}return n}if(l&&l.leftVertex.leftEdge){var m=l.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(m,t)){var _=$t(m,o,t),S=Kt(l.leftVertex.pos,o,t);this._checkForSnappingCandidate(n,_,S,e,_.left,S,t,e,s)}}if(u&&u.rightVertex.rightEdge){var w=u.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(w,t)){var Z=$t(w,o,t),x=Kt(u.rightVertex.pos,o,t);this._checkForSnappingCandidate(n,Z,x,e,Z.right,x,t,e,s)}}return n}},{key:"_checkForSnappingCandidate",value:function(e,t,n,i,r,a,o,s,l){var u=o.coordinateHelper,c=o.pointer;(0,B.o)(er,t.right,t.left);var d=(0,E.o)(ir,er[1],-er[0],0),h=(0,B.j)(d,(0,B.o)(er,i,n))/(0,B.p)(d),p=u.fromXYZ((0,B.d)(er,a,d,h),u.getZ(s,0));if(jt(l,(0,b.d)(p,u,$.E,this.view))<this.squaredProximityThreshold(c)){var f=u.toXYZ(a,tr),v=(0,E.ab)(nr,f,d,Math.sign(h)),y=u.fromXYZ(v);e.push(new Oi({coordinateHelper:u,targetPoint:p,constraint:new vi(u,a,y),previousVertex:r,otherVertex:a,otherVertexType:Pi.CENTER,elevationInfo:u.hasZ()?$.E:null}))}}}]),n}(Fi),er=(0,oe.n)(),tr=(0,E.n)(),nr=(0,E.n)(),ir=(0,E.n)(),rr=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.targetPoint,o=e.point1,s=e.point2,l=e.elevationInfo;return(0,v.Z)(this,n),(i=t.call(this,r,a,new pi(r,r.arrayToVector((0,B.A)(ar,o,s,.5)),.5*(0,B.m)(o,s)),l,qt.SELF))._p1=o,i._p2=s,i}return(0,y.Z)(n,[{key:"hints",get:function(){var e=this.elevationInfo;return[new rn(Wt.REFERENCE,this.targetPoint,this._p1,e,this.domain),new rn(Wt.REFERENCE,this.targetPoint,this._p2,e,this.domain),new sn(this._p1,this.targetPoint,this._p2,e,this.domain)]}}]),n}(Ai),ar=(0,oe.n)(),or=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(){return(0,v.Z)(this,n),t.apply(this,arguments)}return(0,y.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=[],r=n.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return i;var a=this.view,o=n.vertices[0],s=n.vertices[r-1],l=Kt(o.pos,a,t),u=Kt(s.pos,a,t);return this._processCandidateProposal(l,u,e,t,i),i}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,k.e)(t.vertexHandle),r=i.component;if(r.edges.length<2)return n;if("polyline"===t.editGeometryOperations.data.type&&(0===i.index||i.index===r.vertices.length-1))return n;var a=this.view,o=Kt(i.leftEdge.leftVertex.pos,a,t),s=Kt(i.rightEdge.rightVertex.pos,a,t);return this._processCandidateProposal(o,s,e,t,n),n}},{key:"_processCandidateProposal",value:function(e,t,n,i,r){if(this.exceedsShortLineThreshold(e,t,i)){var a=(0,B.A)(sr,e,t,.5),o=.5*(0,B.m)(e,t),s=(0,re.m)(lr,n,a,o),l=i.coordinateHelper,u=i.pointer,c=l.fromXYZ(s,l.getZ(n,0));jt((0,b.d)(n,l,$.E,this.view),(0,b.d)(c,l,$.E,this.view))<this.squaredProximityThreshold(u)&&r.push(new rr({coordinateHelper:l,targetPoint:c,point1:e,point2:t,elevationInfo:l.hasZ()?$.E:null}))}}}]),n}(Fi),sr=(0,oe.n)(),lr=(0,oe.n)(),ur=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).updating=!1,i._snappers=new w.j,i._domain=qt.SELF,i}return(0,y.Z)(n,[{key:"initialize",value:function(){this._snappers.push(new Ji(this.view,this.options),new Ni(this.view,this.options),new $i(this.view,this.options),new or(this.view,this.options))}},{key:"options",set:function(e){this._set("options",e);var t,n=(0,f.Z)(this._snappers);try{for(n.s();!(t=n.n()).done;){t.value.options=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"fetchCandidates",value:function(){var e=(0,l.Z)((0,s.Z)().mark((function e(t,n,i){var r,a,o,l,u,c,d;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&this._domain&&this.options.effectiveSelfEnabled){e.next=2;break}return e.abrupt("return",[]);case 2:r=[],a=(0,f.Z)(this._snappers.items);try{for(a.s();!(o=a.n()).done;){l=o.value,u=(0,f.Z)(l.snap(t,i));try{for(u.s();!(c=u.n()).done;)d=c.value,r.push(d)}catch(s){u.e(s)}finally{u.f()}}}catch(s){a.e(s)}finally{a.f()}return e.abrupt("return",(Ut(t,r,i.coordinateHelper),r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()}]),n}(S.m);function cr(e,t){return[new ur({view:e,options:t}),new Ri({view:e,options:t,spatialReference:e.spatialReference})]}(0,S.e)([(0,S.y)({readOnly:!0})],ur.prototype,"updating",void 0),(0,S.e)([(0,S.y)({constructOnly:!0})],ur.prototype,"view",void 0),(0,S.e)([(0,S.y)()],ur.prototype,"options",null),ur=(0,S.e)([(0,S.n)("esri.views.interactive.snapping.SelfSnappingEngine")],ur);var dr,hr=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i,r,a,o){var s;return(0,v.Z)(this,n),(s=t.call(this,e,i,new di(e,i,r.constraint,a.constraint),o,qt.ALL)).first=r,s.second=a,s}return(0,y.Z)(n,[{key:"hints",get:function(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[].concat((0,o.Z)(this.first.hints),(0,o.Z)(this.second.hints),[new nn(this.targetPoint,this.elevationInfo,this.domain)])}}]),n}(Ai),pr=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).options=new zn,i.snappingEnginesFactory=cr,i._engines=[],i._currentMainCandidate=null,i._currentOtherActiveCandidates=[],i._currentSnappedType=dr.MAIN,i}return(0,y.Z)(n,[{key:"initialize",value:function(){var e=this;this.handles.add([(0,Z.l)((function(){var t=e.options;return{effectiveFeatureEnabled:t.effectiveFeatureEnabled,effectiveSelfEnabled:t.effectiveSelfEnabled,touchSensitivityMultiplier:t.touchSensitivityMultiplier,distance:t.distance}}),(function(){e.doneSnapping(),e.emit("changed")}),Z.U),(0,Z.l)((function(){return e.options}),(function(t){var n,i=(0,f.Z)(e._engines);try{for(i.s();!(n=i.n()).done;){n.value.options=t}}catch(r){i.e(r)}finally{i.f()}}),Z.U),(0,Z.l)((function(){return{viewReady:e.view.ready,viewSpatialReference:e.view.spatialReference,snappingEnginesFactory:e.snappingEnginesFactory}}),(function(t){var n=t.viewReady,i=t.snappingEnginesFactory;return e._recreateEngines(n,i)}),Z.w)])}},{key:"destroy",value:function(){this._destroyEngines()}},{key:"updating",get:function(){return this._engines.some((function(e){return e.updating}))}},{key:"_recreateEngines",value:function(e,t){if(this._destroyEngines(),e){var n=this.view,i=this.options;this._engines=t(n,i)}}},{key:"_destroyEngines",value:function(){var e,t=(0,f.Z)(this._engines);try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}this._engines=[]}},{key:"_squaredMouseProximityTreshold",get:function(){return this.options.distance*this.options.distance}},{key:"_squaredTouchProximityThreshold",get:function(){var e=this.options,t=e.distance*e.touchSensitivityMultiplier;return t*t}},{key:"snap",value:function(){var e=(0,l.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",vr(t)?this._snapMultiPoint(t):this._snapSinglePoint(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(e){var t=e.point,n=e.context;this._removeVisualization();var i=this._currentMainCandidate;if((0,k.t)(i))return t;var r=this._selectUpdateInput(e);if((0,k.t)(r))return t;var a=n.coordinateHelper.spatialReference,s=(0,R.r)(this._convertPointElevation(r,n),a);if((0,k.t)(s))return t;var l=this.view,u=n.coordinateHelper,c=n.elevationInfo,d=n.visualizer,h=[],p=u.pointToVector(s),v=i.constraint.closestTo(p);if(!this._arePointsWithinScreenThreshold(p,v,n))return this._resetSnappingState(),t;i.targetPoint=v,h.push.apply(h,(0,o.Z)(i.hints));var y,g=(0,f.Z)(this._currentOtherActiveCandidates);try{for(g.s();!(y=g.n()).done;){var m=y.value;m.targetPoint=v,h.push.apply(h,(0,o.Z)(m.hints))}}catch(S){g.e(S)}finally{g.f()}(0,k.r)(d)&&this.handles.add(d.draw(h,{coordinateHelper:u,elevationInfo:yr(n),view:l,selfSnappingZ:n.selfSnappingZ}),fr);var _=u.vectorToDehydratedPoint(v);return this._convertPointElevation(_,n,$.E,c)}},{key:"doneSnapping",value:function(){this._removeVisualization(),this._resetSnappingState()}},{key:"_selectUpdateInput",value:function(e){var t=e.point,n=e.scenePoint;switch(this._currentSnappedType){case dr.MAIN:return t;case dr.SCENE:return n}}},{key:"_resetSnappingState",value:function(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=dr.MAIN}},{key:"_removeVisualization",value:function(){this.handles.remove(fr)}},{key:"_snapSinglePoint",value:function(){var e=(0,l.Z)((0,s.Z)().mark((function e(t){var n,i,r,a,o,l,u,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.point,i=t.context,r=t.signal,a=i.coordinateHelper,o=this.view,l=this._convertPointElevation(n,i),u=a.pointToVector(l),e.next=7,this._fetchCandidates(u,qt.ALL,i,r);case 7:return c=e.sent,e.abrupt("return",this._createSnapResult(u,dr.MAIN,c,o,i,r));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_snapMultiPoint",value:function(){var e=(0,l.Z)((0,s.Z)().mark((function e(t){var n,i,r,a,l,u,c,d,h,p,f,v,y,g;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.point,i=t.scenePoint,r=t.context,a=t.signal,l=this.view,u=r.coordinateHelper,c=u.spatialReference,e.next=4,(0,R._)(i.spatialReference,c);case 4:return d=(0,R.r)(this._convertPointElevation(i,r),c),h=u.pointToVector(d),e.next=8,this._fetchCandidates(h,qt.FEATURE,r,a);case 8:if(!((p=e.sent).length>0)){e.next=14;break}return e.next=12,this._fetchCandidates(h,qt.SELF,r,a);case 12:return f=e.sent,e.abrupt("return",this._createSnapResult(h,dr.SCENE,[].concat((0,o.Z)(p),(0,o.Z)(f)),l,r,a));case 14:return v=this._convertPointElevation(n,r),y=u.pointToVector(v),e.next=18,this._fetchCandidates(y,qt.SELF,r,a);case 18:return g=e.sent,e.abrupt("return",this._createSnapResult(y,dr.MAIN,g,l,r,a));case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchCandidates",value:function(){var e=(0,l.Z)((0,s.Z)().mark((function e(t,n,i,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this._engines.map((function(e){return e.fetchCandidates(t,n,i,r)})));case 2:return e.abrupt("return",e.sent.flat());case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,i,r){return e.apply(this,arguments)}}()},{key:"_createSnapResult",value:function(e,t,n,i,r,a){var o=this;return{get valid(){return!(0,S.p)(a)},apply:function(){var a=r.elevationInfo,s=r.coordinateHelper,l=o._processCandidates(e,t,n,r),u=l.snappedPoint,c=l.hints;return o._removeVisualization(),(0,k.r)(r.visualizer)&&o.handles.add(r.visualizer.draw(c,{coordinateHelper:s,elevationInfo:yr(r),view:i,selfSnappingZ:r.selfSnappingZ}),fr),o._convertPointElevation(u,r,$.E,a)}}}},{key:"_processCandidates",value:function(e,t,n,i){var r=i.coordinateHelper;if(n.length<1)return this.doneSnapping(),{snappedPoint:r.vectorToDehydratedPoint(e),hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Ut(e,n,r);var a=this._currentMainCandidate;if((0,k.r)(a)){var o=this._findOldConstraintInNewCandidates(a,n);if(o>=0){if(!(n[o]instanceof hr))return this._intersectWithOtherCandidates(o,n,e,t,i);if(this._arePointsWithinScreenThreshold(e,a.targetPoint,i))return this._updateSnappingCandidate(a,t,n,i)}}return this._intersectWithOtherCandidates(0,n,e,t,i)}},{key:"_findOldConstraintInNewCandidates",value:function(e,t){return e instanceof hr?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}},{key:"_intersectWithOtherCandidates",value:function(e,t,n,i,r){for(var a=r.coordinateHelper,o=t[e],s=[],l=0;l<t.length;++l)if(l!==e){var u,c=t[l],d=(0,f.Z)(o.constraint.intersect(c.constraint));try{for(d.s();!(u=d.n()).done;){var h=u.value,p=a.fromXYZ(h.closestTo(o.targetPoint),o.targetPoint[2]);s.push([new hr(a,p,o,c,c.elevationInfo),this._squaredScreenDistance(n,p,a)])}}catch(v){d.e(v)}finally{d.f()}}return s.length>0&&(s.sort((function(e,t){return e[1]-t[1]})),s[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(s[0][0],i,t,r):this._updateSnappingCandidate(o,i,t,r)}},{key:"_updateSnappingCandidate",value:function(e,t,n,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;var r=this._currentMainCandidate.targetPoint,a=[];a.push.apply(a,(0,o.Z)(e.hints));var s,l=(0,f.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;if(e instanceof hr){if(u.constraint.equals(e.first.constraint)||u.constraint.equals(e.second.constraint))continue}else if(u.constraint.equals(e.constraint))continue;u.constraint.check(r)&&(u.targetPoint=r,this._currentOtherActiveCandidates.push(u),a.push.apply(a,(0,o.Z)(u.hints)))}}catch(c){l.e(c)}finally{l.f()}return{snappedPoint:i.coordinateHelper.vectorToDehydratedPoint(r),hints:a}}},{key:"_squaredPointProximityThreshold",value:function(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}},{key:"_arePointsWithinScreenThreshold",value:function(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}},{key:"_squaredScreenDistance",value:function(e,t,n){return jt(this._toScreen(e,n),this._toScreen(t,n))}},{key:"_toScreen",value:function(e,t){return(0,b.d)(e,t,$.E,this.view)}},{key:"_findOldCandidateIndex",value:function(e,t){for(var n=-1,i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){n=i;break}return n}},{key:"_convertPointElevation",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.elevationInfo,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:$.E,r=this.view;if(!((0,k.r)(e)&&t.coordinateHelper.hasZ()&&(0,k.r)(r)&&"3d"===r.type))return e;var a=(0,k.y)(e);return a.z=(0,$.g)(r,a,n,i),a}},{key:"test",get:function(){return{visualizationsActive:this.handles.has(fr),engines:this._engines}}}]),n}(se.n.EventedMixin(q.d));(0,S.e)([(0,S.y)({constructOnly:!0})],pr.prototype,"view",void 0),(0,S.e)([(0,S.y)()],pr.prototype,"options",void 0),(0,S.e)([(0,S.y)({readOnly:!0})],pr.prototype,"updating",null),(0,S.e)([(0,S.y)()],pr.prototype,"snappingEnginesFactory",void 0),(0,S.e)([(0,S.y)()],pr.prototype,"_engines",void 0),(0,S.e)([(0,S.y)()],pr.prototype,"_squaredMouseProximityTreshold",null),(0,S.e)([(0,S.y)()],pr.prototype,"_squaredTouchProximityThreshold",null),pr=(0,S.e)([(0,S.n)("esri.views.interactive.snapping.SnappingManager")],pr),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(dr||(dr={}));var fr="visualization-handle";function vr(e){return(0,k.r)(e.scenePoint)}function yr(e){var t=e.coordinateHelper,n=e.elevationInfo;return t.hasZ()?$.E:n}var gr=new Map;function mr(e){if(!gr.has(e)){var t=function(e,t){var n,i,r=new zn({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:null!==(n=null===t||void 0===t?void 0:t.distance)&&void 0!==n?n:Yt.distance,touchSensitivityMultiplier:null!==(i=null===t||void 0===t?void 0:t.touchSensitivityMultiplier)&&void 0!==i?i:Yt.touchSensitivityMultiplier});return(0,p.Z)((0,p.Z)({},(0,Z.l)((function(){var t,n,i;return null!==(t=null===(n=e.map)||void 0===n||null===(i=n.allLayers)||void 0===i?void 0:i.toArray())&&void 0!==t?t:[]}),(function(e){r.featureSources=new w.j(e.map((function(e){return new Rn({layer:e,enabled:!0})})))}),Z.h)),{},{options:r})}(e,{distance:10}),n=function(e,t){return new pr({view:e,options:t,snappingEnginesFactory:function(t,n){return[new Ri({view:e,spatialReference:e.spatialReference,options:n})]}})}(e,t.options);gr.set(e,{referenceCount:0,snappingManager:n,remove:function(){t.remove(),n.destroy()}})}var i=gr.get(e);i.referenceCount++;var r=(0,S.D)((function(){return function(e,t){t.referenceCount--,t.referenceCount>0||(0,S.a5)((function(){0===t.referenceCount&&(t.remove(),gr.delete(e))}))}(e,i)}));return(0,p.Z)({snappingManager:i.snappingManager},r)}var _r=function(){function e(t){(0,v.Z)(this,e),this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=t.editGeometryOperations,this.elevationInfo=t.elevationInfo,this.pointer=t.pointer,this.vertexHandle=t.vertexHandle,this.excludeFeature=t.excludeFeature,this.visualizer=t.visualizer,this.selfSnappingZ=t.selfSnappingZ}return(0,y.Z)(e,[{key:"coordinateHelper",get:function(){return this.editGeometryOperations.data.coordinateHelper}}]),e}(),Sr=function(){function e(){(0,v.Z)(this,e),this.next=new F.G}return(0,y.Z)(e,[{key:"createSnapDragEventPipelineStep",value:function(e){var t=this,n=e.predicate,i=void 0===n?function(){return!0}:n,r=e.cancel,a=e.snappingManager,o=e.snappingContext,s=e.updatingHandles,l=e.useZ,u=void 0===l||l;if((0,k.t)(a))return function(e){return e};var c=null,d=null,h=function(){c=(0,k.l)(c),a.doneSnapping(),(0,k.r)(d)&&d.frameTask.remove(),d=null};r.next((function(e){return h(),e})),this.next=new F.G;var f=this._createSnapFunction(a,u),v=null,y=null,g=null;return function(e){if(!i(e))return e;if("start"===e.action){var n=t._createFrameTask(a.view);if((d=t._createSnappingInfo(o,e,n)).context.selfSnappingZ=null,!u&&(0,k.r)(e.info)){var r=t._extractSelfSnappingZ(o.coordinateHelper,e.info.handle.component);(0,k.r)(r)&&(d.context.selfSnappingZ={value:r,elevationInfo:o.elevationInfo})}}if((0,k.r)(d)){var l=d,m=l.context,_=l.originalScenePos,w=l.originalPos,Z=e.mapEnd,x=e.mapStart,P=e.action,M=e.scenePoints,E=t._updatePosition(w,t._computeMapDelta(Z,x)),b=t._computeMapDelta(x,w),C=(0,p.Z)((0,p.Z)({},e),{},{action:"update"}),A=d.context,T=t._updateScenePosition(_,M),D=a.update({point:E,scenePoint:T,context:m});if(g=D,t._applySnappedUpdate(Z,D,b,u),v=E,y=T,"end"!==P){var O=d.frameTask;(0,k.t)(c)&&(c=new AbortController),s.addPromise((0,S.a2)(f({frameTask:O,event:C,context:A,point:E,scenePoint:T,delta:b,lastPos:v,lastScenePos:y,lastUpdate:g},c.signal)))}}return"end"===e.action&&h(),e}}},{key:"_createSnapFunction",value:function(e,t){var n=this;return(0,S.a1)(function(){var i=(0,l.Z)((0,s.Z)().mark((function i(r,a){var o,l,u,c,d,h,p,f,v,y,g;return(0,s.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o=r.frameTask,l=r.point,u=r.scenePoint,c=r.context,d=r.event,h=r.delta,p=r.lastPos,f=r.lastScenePos,v=r.lastUpdate,i.next=3,o.schedule((function(){return e.snap({point:l,scenePoint:u,context:c,signal:a})}),a);case 3:if(!(y=i.sent).valid){i.next=9;break}return i.next=7,o.schedule((function(){return y.apply()}),a);case 7:g=i.sent,l!==p&&(0,k.r)(p)&&(g=e.update({point:p,scenePoint:f,context:c})),(0,le.i)(g,v)||(n._applySnappedUpdate(d.mapEnd,g,h,t),n.next.execute(d));case 9:case"end":return i.stop()}}),i)})));return function(e,t){return i.apply(this,arguments)}}())}},{key:"_createFrameTask",value:function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(ue.I.SNAPPING):ue.y}},{key:"_createSnappingInfo",value:function(e,t,n){return{context:new _r({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:(0,k.r)(t.info)?t.info.handle:null,excludeFeature:e.excludeFeature,visualizer:e.visualizer}),originalPos:(0,k.r)(t.snapOrigin)?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:(0,k.r)(t.scenePoints)?t.scenePoints.sceneStart:null,frameTask:n}}},{key:"_updatePosition",value:function(e,t){var n=(0,_.Z)(t,3),i=n[0],r=n[1],a=n[2],o=(0,O.aa)(e);return o.x+=i,o.y+=r,o.hasZ&&(o.z+=a),o}},{key:"_updateScenePosition",value:function(e,t){return(0,k.t)(e)||(0,k.t)(t)?null:this._updatePosition(e,this._computeMapDelta(t.sceneEnd,t.sceneStart))}},{key:"_computeMapDelta",value:function(e,t){var n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}},{key:"_applySnappedUpdate",value:function(e,t,n,i){var r=(0,_.Z)(n,3),a=r[0],o=r[1],s=r[2];e.x=t.x+a,e.y=t.y+o,i&&e.hasZ&&t.hasZ&&(e.z=t.z+s)}},{key:"_extractSelfSnappingZ",value:function(e,t){if(!e.hasZ())return null;var n,i=t.vertices,r=null,a=(0,f.Z)(i);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=e.getZ(o.pos);if((0,k.r)(r)&&Math.abs(s-r)>1e-6)return null;(0,k.t)(r)&&(r=s)}}catch(l){a.e(l)}finally{a.f()}return r}}]),e}(),wr=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).constrainResult=function(e){return e},i._snapPoints=null,i._abortController=null,i._stagedPoint=null,i._snap=(0,S.a1)(function(){var e=(0,l.Z)((0,s.Z)().mark((function e(t,n,r,a){var o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i._frameTask.schedule((function(){return n.snap((0,p.Z)((0,p.Z)({},t),{},{context:r,signal:a}))}),a);case 2:if(o=e.sent,e.t0=o.valid,!e.t0){e.next=7;break}return e.next=7,i._frameTask.schedule((function(){i.stagedPoint=o.apply(),t!==i._snapPoints&&(0,k.r)(i._snapPoints)&&(i.stagedPoint=n.update((0,p.Z)((0,p.Z)({},i._snapPoints),{},{context:r})))}),a);case 7:case"end":return e.stop()}}),e)})));return function(t,n,i,r){return e.apply(this,arguments)}}()),i}return(0,y.Z)(n,[{key:"stagedPoint",get:function(){return this._stagedPoint},set:function(e){this._stagedPoint=this.constrainResult(e)}},{key:"initialize",value:function(){var e,t,n="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(t=e.resourceController)||void 0===t?void 0:t.scheduler:null;this._frameTask=(0,k.r)(n)?n.registerTask(ue.I.SNAPPING):ue.y}},{key:"destroy",value:function(){this._abortController=(0,k.l)(this._abortController),this._frameTask=(0,k.f)(this._frameTask)}},{key:"snap",value:function(){var e=(0,l.Z)((0,s.Z)().mark((function e(t,n,i){var r,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.point,a=t.scenePoint,e.abrupt("return",(this.stagedPoint=n.update({point:r,scenePoint:a,context:i}),this._snapPoints=t,(0,k.t)(this._abortController)&&(this._abortController=new AbortController),this._snap(t,n,i,this._abortController.signal)));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"abort",value:function(){this._abortController=(0,k.l)(this._abortController)}}]),n}(S.m);(0,S.e)([(0,S.y)({constructOnly:!0})],wr.prototype,"view",void 0),(0,S.e)([(0,S.y)()],wr.prototype,"stagedPoint",null),(0,S.e)([(0,S.y)()],wr.prototype,"constrainResult",void 0),(0,S.e)([(0,S.y)()],wr.prototype,"_stagedPoint",void 0),wr=(0,S.e)([(0,S.n)("esri.views.interactive.snapping.SnappingOperation")],wr);var kr=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;(0,v.Z)(this,n),(i=t.call(this,e))._stagedDimension=null,i._computationManipulators=new Map,i._computationHandles=new S.X,i._snappingPipeline=new Sr,i._snappingManagerResult=mr(e.view),i.addHandles(i._snappingManagerResult),i._unfocusedOffsetManipulatorMaterial=Zr(),i._focusedOffsetManipulatorMaterial=Zr(),i._thinOffsetManipulatorMaterial=Zr(),i._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,O.a5)(2)}),i._constraintSnappingIndicator=new x.c({view:e.view,attached:!0,width:1,color:H.l.toUnitRGBA(Je.constraint.color),renderOccluded:W.ah.OccludeAndTransparent,stipplePattern:(0,O.a5)(5)});var r=H.l.toUnitRGBA(Je.disabledPointIndicator.color);return r[3]*=Je.disabledPointIndicator.opacity,i._stagedStartIndicator=new An({view:e.view,attached:!1,color:r,size:2*Je.disabledPointIndicator.radius,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,outlineSize:0,renderOccluded:W.ah.OccludeAndTransparent}),i}return(0,y.Z)(n,[{key:"initialize",value:function(){var e=this;this._snappingOperation=new wr({view:this.view}),this._orientationManipulatorTexture=(0,G.o)(this.view.toolViewManager.textures),this._orientationManipulatorMaterial=new ie.p({transparent:!0,writeDepth:!1,textureId:this._orientationManipulatorTexture.texture.id,renderOccluded:W.ah.Opaque});var t,n=this.analysisViewData.computations,i=(0,f.Z)(n);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._addComputation(r)}}catch(a){i.e(a)}finally{i.f()}this.addHandles([n.on("after-add",(function(t){return e._addComputation(t.item)})),n.on("after-remove",(function(t){return e._removeComputation(t.item)}))]),this.addHandles([(0,Z.l)((function(){return{stagedPoint:e._snappingOperation.stagedPoint,stagedComputation:e._stagedComputation}}),(function(t){var n=t.stagedPoint,i=t.stagedComputation;if(!(0,k.t)(i)&&!(0,k.t)(n)){var r=(0,O.aa)(n,new L.w);e._applyPointUpdate(i,{endPoint:r})}}),Z.U),(0,Z.l)((function(){return{stagedDimension:e._stagedDimension,selectedComputation:e.analysisViewData.selectedComputation,firstGrabbedManipulator:e.firstGrabbedManipulator}}),(function(t,n){var i=t.stagedDimension,r=t.selectedComputation,o=t.firstGrabbedManipulator;if(i===n.stagedDimension&&o===n.firstGrabbedManipulator)for(var s=0,l=[r,n.selectedComputation];s<l.length;s++){var u=l[s];if((0,k.r)(u)){var c=e._computationManipulators.get(u);e._updateManipulators(u,c,t)}}else{var d,h=(0,f.Z)(e._computationManipulators);try{for(h.s();!(d=h.n()).done;){var p=(0,_.Z)(d.value,2),v=p[0],y=p[1];e._updateManipulators(v,y,t)}}catch(a){h.e(a)}finally{h.f()}}}),Z.w),(0,Z.l)((function(){return e.analysis.style.lineSize}),(function(t){e._updateManipulatorStyle(t)}),Z.h),(0,Z.l)((function(){return e.view.state.camera}),(function(){(0,k.r)(e._stagedComputation)&&e._updateStagedDimensionOffset(e._stagedComputation)})),(0,Z.l)((function(){return(0,k.n)(e._stagedComputation,(function(t){var n=t.elevationAlignedStartPoint,i=(0,E.n)();return(0,k.r)(n)&&e.view.renderCoordsHelper.toRenderCoords(n,i)?i:null}))}),(function(t){(0,k.r)(t)?(e._stagedStartIndicator.vertices=[t],e._stagedStartIndicator.attached=!0):e._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles)}},{key:"destroy",value:function(){this._snappingOperation=(0,k.g)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose(),this._orientationManipulatorTexture.release()}},{key:"updating",get:function(){return this.updatingHandles.updating||this._snappingManager.updating}},{key:"firstGrabbedManipulator",get:function(){return this.parentTool.firstGrabbedManipulator}},{key:"hasGrabbedManipulators",get:function(){return this.parentTool.hasGrabbedManipulators}},{key:"_snappingManager",get:function(){return this._snappingManagerResult.snappingManager}},{key:"_activeComputation",get:function(){if((0,k.r)(this._stagedComputation))return this._stagedComputation;var e=this.analysisViewData.selectedComputation;return this.hasGrabbedManipulators&&(0,k.r)(e)?e:null}},{key:"_stagedComputation",get:function(){var e=this._stagedDimension,t=this.analysisViewData.computations.at(-1);return(0,k.t)(e)||(0,k.t)(t)||t.dimension!==e?null:t}},{key:"_constraintHandles",get:function(){var e=this;return[(0,Z.f)((function(){return e.analysisViewData.selectedComputation}),(function(t){t.previousConstraint=Pt(t,e.view)}),(0,p.Z)((0,p.Z)({},Z.w),{},{equals:k.w})),(0,Z.l)((function(){var t=e._activeComputation;if((0,k.t)(t))return null;var n=t.dimension;return{measureType:n.measureType,orientation:n.orientation,computation:t}}),(function(e,t){if((0,k.r)(e)&&(0,k.t)(t)){var n=e.measureType,i=e.orientation,r=e.computation;switch(r.previousConstraint){case _t.Horizontal:r.preConstraintProperties={measureType:P.t.Horizontal,orientation:0};break;case _t.Vertical:r.preConstraintProperties={measureType:P.t.Vertical,orientation:0};break;case _t.Direct:r.preConstraintProperties={measureType:P.t.Direct,orientation:i};break;default:r.preConstraintProperties={measureType:n,orientation:i}}}(0,k.t)(e)&&(0,k.r)(t)&&(t.computation.preConstraintProperties=null)}),Z.U)]}},{key:"_snappingIndicatorHandles",get:function(){var e=this,t="snapping-indicator-event-handles";return[(0,Z.l)((function(){return{stagedComputation:e._stagedComputation,activeComputation:e._activeComputation}}),(function(n){var i=n.stagedComputation,r=n.activeComputation,a=e._constraintSnappingIndicator;if(e.removeHandles(t),(0,k.t)(r))a.attached=!1;else if(r===i)a.attached=!0;else{var o=e._computationManipulators.get(r),s=o.start,l=o.end,u=function(){a.attached=s.grabbing||l.grabbing};u(),e.addHandles([s.events.on("grab-changed",u),l.events.on("grab-changed",u)],t)}})),(0,Z.l)((function(){var t=e._activeComputation;return(0,k.r)(t)?{geometry:t.geometry,constraint:t.previousConstraint}:{}}),(function(t){var n=t.geometry,i=t.constraint,r=e._constraintSnappingIndicator;(0,k.r)(n)&&(0,k.r)(i)&&i!==_t.Direct?(r.visible=!0,r.setGeometryFromSegment(n.directSegment)):r.visible=!1}))]}},{key:"removeStaged",value:function(){return!!(0,k.r)(this._stagedDimension)&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}},{key:"onDeactivate",value:function(){this.removeStaged(),this._resetSnappingState()}},{key:"onClick",value:function(e){var t=this._stagedDimension;if((0,k.t)(t)){var n=this._onUnstagedClick(e);return this.analysis.dimensions.add(n),null}return this._onStagedClick(e),t}},{key:"onPointerMove",value:function(e){var t=e.mapPoint,n=e.pointerType;if("touch"!==n){var i=this._snappingContext(n);this.updatingHandles.addPromise((0,S.a2)(this._snappingOperation.snap({point:t},this._snappingManager,i)))}}},{key:"onManipulatorSelectionChanged",value:function(){(0,k.r)(this.analysisViewData.selectedComputation)&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}},{key:"_onUnstagedClick",value:function(e){var t=e.mapPoint,n=e.pointerType,i=t;if("mouse"===n){var r=this._snappingContext(n);i=this._snappingManager.update({point:t,context:r})}var a=new P.u({startPoint:(0,O.aa)(i,new L.w),endPoint:null,measureType:P.t.Horizontal});return this._stagedDimension=a,this._resetSnappingState(),a}},{key:"_onStagedClick",value:function(e){var t=e.mapPoint,n=e.pointerType,i=this._stagedComputation;if(!(0,k.t)(i)){var r=t;if("mouse"===n){var a=this._snappingContext(n);r=this._snappingManager.update({point:t,context:a})}var o=(0,O.aa)(r,new L.w);this._applyPointUpdate(i,{endPoint:o}),this._stagedDimension=null,this._resetSnappingState()}}},{key:"_resetSnappingState",value:function(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}},{key:"_addComputation",value:function(e){if(!this._computationManipulators.has(e)){var t=this._setupPointManipulator(e,{isStart:!0}),n=this._setupPointManipulator(e,{isStart:!1}),i=this._setupOffsetManipulator(e),r=this._setupHeadingManipulator(e),a=this._setupRotationManipulator(e),o=this._setupMeasureTypeManipulator(e,P.t.Direct),s=this._setupMeasureTypeManipulator(e,P.t.Horizontal),l=this._setupMeasureTypeManipulator(e,P.t.Vertical),u=new Ke({start:t,end:n,offset:i,heading:r,rotation:a,direct:o,horizontal:s,vertical:l});this._setupComputationToManipulatorsSync(e,u),this._computationManipulators.set(e,u),this.manipulators.addMany(u.values())}}},{key:"_removeComputation",value:function(e){var t=this._computationManipulators.get(e);if(!(0,k.t)(t)){this._computationHandles.remove(e),this._computationManipulators.delete(e);var n,i=(0,f.Z)(t.values());try{for(i.s();!(n=i.n()).done;){var r=n.value;this.manipulators.remove(r)}}catch(a){i.e(a)}finally{i.f()}}}},{key:"_setupComputationToManipulatorsSync",value:function(e,t){var n=this;this._computationHandles.add([(0,Z.l)((function(){return e.geometry}),(function(){return n._updateManipulators(e,t)}),(0,p.Z)((0,p.Z)({},Z.w),{},{equals:k.w}))],e)}},{key:"_setupPointManipulator",value:function(e,t){var n=this,i=this.view,r=e.dimension,a=function(e,t){var n=(0,F.U)(e,H.l.toUnitRGB(Je.pointManipulators.color),Je.pointManipulators.opacity,St);return n.available=!1,n.grabCursor="crosshair",n.radius=Je.pointManipulators.radius,n.metadata=t.metadata,n.collisionPriority=1,n}(i,{metadata:r}),o=function(e,t){var n=t.isStart,i=t.createSnappingPipelineStep,r=t.dimension,a=t.onUpdate,o=t.snappingPipeline,s=t.view,l=n?"startPoint":"endPoint",u=(0,F.d)(e,(function(e,t,n,u){var c=(0,G.z)(e);n=n.next(c).next((0,F.w)(r,[l,"measureType","orientation"])),t.next(c).next((0,G.B)(s)).next(i(n,u),o.next).next((function(e){var t=(0,O.aa)(e.mapEnd,new L.w);a("startPoint"===l?{startPoint:t}:{endPoint:t})}))}));return[u]}(a,{isStart:t.isStart,createSnappingPipelineStep:function(e,t){return n._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:n._snappingContext(t),snappingManager:n._snappingManager,updatingHandles:n.updatingHandles,cancel:e})},dimension:r,onUpdate:function(t){n._applyPointUpdate(e,t)},snappingPipeline:this._snappingPipeline,view:i});return this._computationHandles.add(o,e),a}},{key:"_setupOffsetManipulator",value:function(e){var t=this.view,n=function(e,t){var n=[(0,E.c)(-.5,0,0),(0,E.c)(.5,0,0)],i=Je.offsetManipulator.lengthFraction,r=(0,O.ab)(n.map((function(e){return(0,E.g)((0,E.n)(),e,i)})));return new F.i((0,p.Z)({view:e,renderObjects:[{geometry:r,material:t.unfocusedMaterial,stateMask:N.a4.Unfocused|N.a4.Selected|St},{geometry:r,material:t.focusedMaterial,stateMask:N.a4.Focused|St}],collisionType:{type:"line",paths:[n]},radius:mt(t.lineSizePt)/2,metadata:t.metadata,available:!1},F.x))}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),i=function(e,t){var n=t.computation,i=t.view;return[(0,F.d)(e,(function(e,t,r){if(Fe(n)&&e.selected){var a=n.geometry,o=n.dimension,s=(0,G.z)(e);t.next(s).next(at(i,o,a.dimensionSegment,a.primaryOffsetAxis)),r.next(s).next((0,F.w)(o,["offset"]))}}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}},{key:"_setupHeadingManipulator",value:function(e){var t=this.view,n=et(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=function(e,t){var n=t.computation,i=t.view;return[(0,F.d)(e,(function(e,t,r){it({cancel:r,computation:n,settingHeading:!0,steps:t,view:i})}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}},{key:"_setupRotationManipulator",value:function(e){var t=this.view,n=et(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=nt(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}},{key:"_setupMeasureTypeManipulator",value:function(e,t){var n=this.view,i=function(e,t){var n=[(0,E.c)(-.5,0,0),(0,E.c)(.5,0,0)],i=Je.offsetManipulator.lengthFraction,r=(0,O.ab)(n),a=(0,O.ab)(n.map((function(e){return(0,E.g)((0,E.n)(),e,i)})));return new F.i((0,p.Z)({view:e,renderObjects:[{geometry:a,material:t.unfocusedMaterial,stateMask:N.a4.Unfocused|St},{geometry:a,material:t.focusedMaterial,stateMask:N.a4.Focused|St},{geometry:r,material:t.thinOffsetManipulatorMaterial,stateMask:St}],collisionType:{type:"line",paths:[n]},radius:mt(t.lineSizePt)/2,available:!1,metadata:t.metadata},F.x))}(n,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),r=rt(i,{computation:e,manipulatorMeasureType:t,view:n});return this._computationHandles.add(r,e),i}},{key:"_updateManipulators",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator},r=i.stagedDimension,a=i.selectedComputation,o=i.firstGrabbedManipulator,s=t.start,l=t.end,u=t.offset,c=t.heading,d=t.rotation,h=a===e,p=Fe(e),v=e.dimension,y=(0,f.Z)(t.values());try{for(y.s();!(n=y.n()).done;){var g=n.value,m=p&&(0,k.t)(r)&&((0,k.t)(o)||g===o);g===u?(g.available=m,g.selected=h):g.available=m&&h}}catch(M){y.e(M)}finally{y.f()}if(p){(0,k.r)(Pt(e,this.view))?t.forEachMeasureTypeManipulator((function(e){return e.available=!1})):t.manipulatorForMeasureType(v.measureType).available=!1;for(var _=0,S=[c,d];_<S.length;_++){var w=S[_];v.measureType===P.t.Direct&&0!==v.offset||(w.available=!1)}Te(e)?d.available=!1:c.available=!1;var Z=e.geometry;s.renderLocation=Z.directSegment.startRenderSpace,l.renderLocation=Z.directSegment.endRenderSpace;var x=this.view.renderCoordsHelper;st(u,Z,x),c.available&&lt(c,e,x),d.available&&ut(d,e,x),t.forEachMeasureTypeManipulator((function(t,n){t.available&&pt(t,e,n,x)}))}}},{key:"_updateManipulatorStyle",value:function(e){var t,n=function(e){return(0,I.u)(e)+Je.offsetManipulator.linePaddingPx}(e),i=mt(e),r={lineSizePt:e,material:this._orientationManipulatorMaterial},a=(0,f.Z)(this._computationManipulators.values());try{for(a.s();!(t=a.n()).done;){var o=t.value,s=o.offset,l=o.heading,u=o.rotation;s.radius=i/2,tt(l,r),tt(u,r)}}catch(c){a.e(c)}finally{a.f()}this._unfocusedOffsetManipulatorMaterial.setParameters({width:n}),this._focusedOffsetManipulatorMaterial.setParameters({width:i})}},{key:"_snappingContext",value:function(e){return new _r({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new re.V(new re.g("point",(0,re.w)(!0,!1,this.view.spatialReference))),visualizer:new un})}},{key:"_applyPointUpdate",value:function(e,t){var n=this.view,i=ke(e);"startPoint"in t&&(i.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(i.elevationAlignedEndPoint=t.endPoint);var r=Ze(i,n.renderCoordsHelper);if(!(0,k.t)(r)){var a=Pt((0,p.Z)((0,p.Z)({},i),{},{geometry:r}),n);(function(e,t,n){var i=n.constraint,r=n.elevationAlignedStartPoint,a=n.elevationAlignedEndPoint,o=n.unconstrainedGeometry,s=n.view,l=e.dimension,u=e.previousConstraint,c=e.preConstraintProperties;if(!(0,k.t)(r)&&!(0,k.t)(a)){var d=function(){"startPoint"in t?l.startPoint=t.startPoint:"endPoint"in t&&(l.endPoint=t.endPoint)};if((0,k.t)(i))d(),(0,k.r)(u)&&(0,k.r)(c)&&(l.measureType=c.measureType,l.orientation=c.orientation);else switch(l.measureType=P.t.Direct,i){case _t.Horizontal:if(i!==u&&(l.orientation=0),"startPoint"in t){var h=t.startPoint;(0,k.r)(h)&&(h.z=a.z),l.startPoint=h}else if("endPoint"in t){var p=t.endPoint;(0,k.r)(p)&&(p.z=r.z),l.endPoint=p}break;case _t.Vertical:if(i!==u&&(l.orientation=ot(o,s)),"startPoint"in t){var f=t.startPoint;(0,k.r)(f)&&(f.x=a.x,f.y=a.y),l.startPoint=f}else if("endPoint"in t){var v=t.endPoint;(0,k.r)(v)&&(v.x=r.x,v.y=r.y),l.endPoint=v}break;case _t.Direct:i!==u&&(0,k.r)(c)&&(l.orientation=c.orientation),d()}e.previousConstraint=i}})(e,t,(0,p.Z)((0,p.Z)({},i),{},{constraint:a,unconstrainedGeometry:r,view:n})),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}}},{key:"_updateStagedDimensionOffset",value:function(e){if(!(0,k.t)(e.geometry)){e.geometry.directSegment.eval(.5,Pr);var t=this.view.state.camera.computeRenderPixelSizeAt(Pr);e.dimension.offset=Je.initialOffsetPx*t}}},{key:"testInfo",get:function(){var e=this,t=function(t){return e.analysisViewData.computations.find((function(e){return e.dimension===t}))};return{getManipulatorsForDimension:function(n){return e._computationManipulators.get(t(n))},getComputationForDimension:function(e){return t(e)},getConstraintForDimension:function(n){var i=t(n);return(0,k.r)(i)?Pt(i,e.view):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}}]),n}(q.d);function Zr(){var e=Je.offsetManipulator,t=e.color,n=e.opacity;return new O.a7({color:[].concat((0,o.Z)(H.l.toUnitRGB(t)),[n]),width:1,renderOccluded:W.ah.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0})}(0,S.e)([(0,S.y)({constructOnly:!0})],kr.prototype,"analysis",void 0),(0,S.e)([(0,S.y)({constructOnly:!0})],kr.prototype,"analysisViewData",void 0),(0,S.e)([(0,S.y)({constructOnly:!0})],kr.prototype,"manipulators",void 0),(0,S.e)([(0,S.y)({constructOnly:!0})],kr.prototype,"parentTool",void 0),(0,S.e)([(0,S.y)({constructOnly:!0,nonNullable:!0})],kr.prototype,"view",void 0),(0,S.e)([(0,S.y)({readOnly:!0})],kr.prototype,"updating",null),(0,S.e)([(0,S.y)()],kr.prototype,"firstGrabbedManipulator",null),(0,S.e)([(0,S.y)()],kr.prototype,"hasGrabbedManipulators",null),(0,S.e)([(0,S.y)()],kr.prototype,"_stagedDimension",void 0),(0,S.e)([(0,S.y)()],kr.prototype,"_activeComputation",null),(0,S.e)([(0,S.y)()],kr.prototype,"_stagedComputation",null),kr=(0,S.e)([(0,S.n)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],kr);var xr,Pr=(0,E.n)(),Mr={redo:"r",undo:"z",center:"Alt",constraint:"Shift",snappingToggle:"Control",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "};!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(xr||(xr={}));var Er=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).automaticManipulatorSelection=!1,i.removeIncompleteOnCancel=!1,i._pointerMoveTimerMs=Je.pointerMoveTimeoutMs,i._prevPointerMoveTimeout=null,i}return(0,y.Z)(n,[{key:"initialize",value:function(){var e=this;this._intersector=(0,ce.g)(this.view.state.viewingMode),this._intersector.options.store=ce.J.MIN,this._lengthDimensionSubTool=new kr({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,S.aF)(this._lengthDimensionSubTool),(0,S.D)((function(){return e._clearPointerMoveTimeout()})),(0,Z.l)((function(){return e.state}),(function(t){t===xr.Created&&e.finishToolCreation()}),Z.w),(0,Z.f)((function(){return e.firstGrabbedManipulator}),(function(t){e.selectedDimension=t.metadata}),Z.w),(0,Z.l)((function(){return e.selectedDimension}),(function(){return e._resetPointerMoveTimeout()}),Z.w)])}},{key:"state",get:function(){return this.analysis.dimensions.some((function(e){return"length"===e.type}))?(0,k.r)(this._activeSubTool)?xr.Creating:xr.Created:xr.Ready}},{key:"updating",get:function(){return this._lengthDimensionSubTool.updating}},{key:"cursor",get:function(){return this.active?"crosshair":null}},{key:"selectedDimension",get:function(){return this.analysisViewData.selectedDimension},set:function(e){this.analysisViewData.selectedDimension=e}},{key:"onInputEvent",value:function(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":if(Mr.cancel===e.key){if((0,k.r)(this._activeSubTool)&&this._activeSubTool.removeStaged())return void e.stopPropagation();this.active||(this.selectedDimension=null)}else Mr.delete.includes(e.key)&&this._deleteKeyHandler()}}},{key:"onActivate",value:function(){this._activeSubTool=this._lengthDimensionSubTool}},{key:"onDeactivate",value:function(){(0,k.r)(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}},{key:"onShow",value:function(){this._resetPointerMoveTimeout()}},{key:"onManipulatorSelectionChanged",value:function(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}},{key:"onHide",value:function(){this.selectedDimension=null}},{key:"_clickHandler",value:function(e){if(this.hasFocusedManipulators)e.stopPropagation();else if(!(0,k.t)(this._activeSubTool)){var t=this._intersectScreen(e);(0,k.t)(t)||(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),e.stopPropagation())}}},{key:"_doubleClickHandler",value:function(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}},{key:"_pointerMoveHandler",value:function(e){if(this._resetPointerMoveTimeout(),!(0,k.t)(this._activeSubTool)&&!this.hasFocusedManipulators){var t=this._intersectScreen(e);(0,k.t)(t)||this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}}},{key:"_deleteKeyHandler",value:function(){(0,k.r)(this._activeSubTool)&&this._activeSubTool.removeStaged(),this._removeSelected()}},{key:"_intersectScreen",value:function(e){var t=(0,N.a6)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);var n=this._intersector.results.min,i=T.c.get();return n.getIntersectionPoint(i)?this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference):null}},{key:"_removeSelected",value:function(){(0,k.r)(this.selectedDimension)&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}},{key:"_clearPointerMoveTimeout",value:function(){this._prevPointerMoveTimeout=(0,k.f)(this._prevPointerMoveTimeout)}},{key:"_resetPointerMoveTimeout",value:function(){var e=this;this._clearPointerMoveTimeout(),this.manipulators.forEach((function(e){e.manipulator.state|=St})),this._prevPointerMoveTimeout=S.a8.setTimeout((function(){e.manipulators.forEach((function(e){e.manipulator.state&=~St}))}),this._pointerMoveTimerMs)}},{key:"testInfo",get:function(){var e=this;return(0,p.Z)((0,p.Z)({},this._lengthDimensionSubTool.testInfo),{},{setManipulatorAutoHideDelay:function(t){e._pointerMoveTimerMs=t,e._resetPointerMoveTimeout()}})}}]),n}(F.a);(0,S.e)([(0,S.y)({constructOnly:!0})],Er.prototype,"view",void 0),(0,S.e)([(0,S.y)({constructOnly:!0})],Er.prototype,"analysis",void 0),(0,S.e)([(0,S.y)({readOnly:!0})],Er.prototype,"state",null),(0,S.e)([(0,S.y)({readOnly:!0})],Er.prototype,"updating",null),(0,S.e)([(0,S.y)({readOnly:!0})],Er.prototype,"cursor",null),(0,S.e)([(0,S.y)({constructOnly:!0})],Er.prototype,"analysisViewData",void 0),(0,S.e)([(0,S.y)()],Er.prototype,"selectedDimension",null),(0,S.e)([(0,S.y)()],Er.prototype,"automaticManipulatorSelection",void 0),(0,S.e)([(0,S.y)()],Er.prototype,"_activeSubTool",void 0),(0,S.e)([(0,S.y)()],Er.prototype,"_lengthDimensionSubTool",void 0),Er=(0,S.e)([(0,S.n)("esri.views.3d.analysis.Dimension.DimensionTool")],Er);var br=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e,i){var r;return(0,v.Z)(this,n),(r=t.call(this,e))._hasExternalMaterial=!1,r._renderOccluded=W.ah.OccludeAndTransparent,r._width=1,r._color=(0,Y.r)(1,0,1,1),r._placement="end",r._textureId=null,r._material=i,r._hasExternalMaterial=(0,k.r)(i),r.applyProps(e),r}return(0,y.Z)(n,[{key:"setGeometryFromSegment",value:function(e,t){var n=e.endRenderSpace;this.transform=(0,C.x)(Cr,n),this._normal=t;var i=e.createRenderGeometry(n,this.view.renderCoordsHelper).points;this.geometry=[i]}},{key:"renderOccluded",get:function(){return(0,k.r)(this._material)?this._material.parameters.renderOccluded:this._renderOccluded},set:function(e){this._renderOccluded=e,(0,k.r)(this._material)&&this._material.setParameters({renderOccluded:e})}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.recreateGeometry()}},{key:"normal",get:function(){return this._normal},set:function(e){this._normal=e,this.recreateGeometry()}},{key:"width",get:function(){return(0,k.r)(this._material)?this._material.parameters.width:this._width},set:function(e){this._width=e,(0,k.r)(this._material)&&this._material.setParameters({width:e})}},{key:"color",get:function(){return(0,k.r)(this._material)?this._material.parameters.color:this._color},set:function(e){this._color=(0,Y.d)(e),(0,k.r)(this._material)&&this._material.setParameters({color:this._color})}},{key:"placement",get:function(){return(0,k.r)(this._material)?this._material.parameters.placement:this._placement},set:function(e){this._placement=e,(0,k.r)(this._material)&&this._material.setParameters({placement:this._placement})}},{key:"textureId",get:function(){return(0,k.r)(this._material)?this._material.parameters.textureId:this._textureId},set:function(e){this._textureId=e,(0,k.r)(this._material)&&this._material.setParameters({textureId:e})}},{key:"createExternalResources",value:function(){this._hasExternalMaterial||(this._material=new O.af({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,textureId:this._textureId}))}},{key:"destroyExternalResources",value:function(){this._hasExternalMaterial||(this._material=null)}},{key:"createGeometries",value:function(e){var t,n=(0,f.Z)((0,O.a8)(this.geometry,this.normal));try{for(n.s();!(t=n.n()).done;){var i=t.value,r=(0,O.a9)(i);e.addGeometry(r,(0,k.e)(this._material))}}catch(a){n.e(a)}finally{n.f()}}},{key:"forEachExternalMaterial",value:function(e){this._hasExternalMaterial||e((0,k.e)(this._material))}}]),n}(x.n),Cr=(0,A.e)(),Ar=function(){function e(t){var n=this;(0,v.Z)(this,e),this.destroyed=!1,this._handles=new S.X,this._messages=null,this._labelSegment=new b.l;var i=t.analysis,r=t.computation,a=t.view,o=t.messages;this.analysis=i,this.computation=r,this.view=a,this._messages=o;var s=t.visible,l={view:a,attached:s},u=i.style,c=u.fontSize,d=u.textColor,h=u.textBackgroundColor;this._visualElements=new Rr({marker:new br(l,t.markerMaterial),dimension:new x.c(l,t.dimensionLineMaterial),startOffset:new x.c(l,t.offsetLineMaterial),endOffset:new x.c(l,t.offsetLineMaterial),dimensionSmall:new x.c(l,t.smallDimensionLineMaterial),startOffsetSmall:new x.c(l,t.smallOffsetLineMaterial),endOffsetSmall:new x.c(l,t.smallOffsetLineMaterial),label:new b.g({view:a,attached:s,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,I.u)(c),textColor:d.clone(),backgroundColor:h.clone()})}),this._handles.add([(0,Z.l)((function(){return r.geometry}),(function(e){n.updateCameraDependentElements(a.state.camera,e,i.style),(0,k.r)(r.geometry)&&n._updateLines(r.geometry)}),(0,p.Z)((0,p.Z)({},Z.h),{},{equals:k.w})),(0,Z.l)((function(){return r.length}),(function(e){return n._updateLabelContent(e)}),Z.h)])}return(0,y.Z)(e,[{key:"visible",set:function(e){var t,n=(0,f.Z)(this._visualElements.values());try{for(n.s();!(t=n.n()).done;){t.value.attached=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"destroy",value:function(){this.destroyed=!0,this._handles=(0,k.g)(this._handles);var e,t=(0,f.Z)(this._visualElements.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}}},{key:"testInfo",get:function(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}},{key:"_updateLines",value:function(e){var t=xe(Tr,ye.Start,e.directSegment,e.dimensionSegment),n=xe(Dr,ye.End,e.directSegment,e.dimensionSegment),i=this._visualElements;i.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),i.dimension.setGeometryFromSegment(e.dimensionSegment),i.startOffset.setGeometryFromSegment(t),i.endOffset.setGeometryFromSegment(n),i.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),i.startOffsetSmall.setGeometryFromSegment(t),i.endOffsetSmall.setGeometryFromSegment(n)}},{key:"updateCameraDependentElements",value:function(e,t,n){var i=this._visualElements;if((0,k.t)(t)){var r,a=(0,f.Z)(i.values());try{for(a.s();!(r=a.n()).done;){r.value.visible=!1}}catch(g){a.e(g)}finally{a.f()}}else{var o=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,Or)),s=function(e,t){return(0,E.v)(Le(ze,e))/Math.pow(t,2)}(t,o),l=s<Math.pow((0,I.u)(n.lineSize)*Je.smallScreenLengthLineSizeFactor,2),u=!l;i.marker.visible=u,i.dimension.visible=u,i.startOffset.visible=u,i.endOffset.visible=u,i.dimensionSmall.visible=l,i.startOffsetSmall.visible=l,i.endOffsetSmall.visible=l;var c=(0,I.u)(n.fontSize)*Je.labels.minScreenLengthFontSizeFactor,d=i.label;if(s<Math.pow(c,2))d.visible=!1;else{d.visible=!0;var h=t.dimensionSegment,p=t.primaryOffsetAxis,v=this.computation.dimension.offset,y=(Math.sign(v)>=0?1:-1)*function(e){return 1.5*(0,I.u)(e.fontSize)+Je.labels.marginPx+(0,I.u)(e.lineSize/2)}(n)*o;(function(e,t,n,i){(0,E.ab)(e.startRenderSpace,t.startRenderSpace,n,i),(0,E.ab)(e.endRenderSpace,t.endRenderSpace,n,i)})(this._labelSegment,h,p,y),d.updateLabelPosition()}}}},{key:"updateLabelStyle",value:function(e){var t=this._visualElements.label;t.fontSize=(0,I.u)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}},{key:"updateUnitsMessages",value:function(e){this._messages=e;var t=this.computation.length;this._updateLabelContent(t)}},{key:"_updateLabelContent",value:function(e){var t=this._visualElements.label;(0,k.t)(e)||(0,k.t)(this._messages)?t.text="":t.text=(0,b.b)(this._messages,e,e.unit)}}]),e}();var Tr=new b.l,Dr=new b.l,Or=(0,E.n)(),Rr=function(){function e(t){(0,v.Z)(this,e),this.marker=t.marker,this.dimension=t.dimension,this.startOffset=t.startOffset,this.endOffset=t.endOffset,this.dimensionSmall=t.dimensionSmall,this.startOffsetSmall=t.startOffsetSmall,this.endOffsetSmall=t.endOffsetSmall,this.label=t.label}return(0,y.Z)(e,[{key:"values",value:function(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}]),e}(),Lr=function(){function e(t,n){(0,v.Z)(this,e),this._textures=t,this._textureRepository=n,this._texturesByPrimitive=new Map}return(0,y.Z)(e,[{key:"acquire",value:function(e){if(!this._texturesByPrimitive.has(e)){var t=(0,O.ag)(this._textures,e),n=new de.r(this._textureRepository,t.texture.id);return this._texturesByPrimitive.set(e,{result:t,reference:n}),t.texture}return this._texturesByPrimitive.get(e).result.texture}},{key:"destroy",value:function(){this._texturesByPrimitive.forEach((function(e){var t=e.result;e.reference.dispose(),t.release()})),this._texturesByPrimitive.clear()}}]),e}(),Hr=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).loadingMessages=!1,i._messages=null,i._dimensionVisualizations=new Map,i._markerMaterial=new O.af({width:1,anchor:O.ah.Tip,color:te.l,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:W.ah.OccludeAndTransparent}),i._dimensionLineMaterial=new O.a7({width:1,color:te.l,renderOccluded:W.ah.OccludeAndTransparent,markerParameters:i._markerMaterial.parameters}),i._offsetLineMaterial=new O.a7({width:1,color:te.l,renderOccluded:W.ah.OccludeAndTransparent,stipplePattern:(0,O.a5)(5),stippleScaleWithLineWidth:!0}),i._smallDimensionLineMaterial=new O.a7({width:1,color:te.l,renderOccluded:W.ah.OccludeAndTransparent}),i._smallOffsetLineMaterial=new O.a7({width:1,color:te.l,renderOccluded:W.ah.OccludeAndTransparent,stipplePattern:(0,O.a5)(5),stippleScaleWithLineWidth:!0}),i}return(0,y.Z)(n,[{key:"analysis",get:function(){return this.analysisViewData.analysis}},{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"initialize",value:function(){var e=this,t=this.view.sharedSymbolResources.textures;if((0,k.r)(t)){var n=this.view._stage.renderView.textureRepository,i=new Lr(t,n),r=i.acquire("triangle");this.addHandles((0,S.D)((function(){return i.destroy()}))),this._markerMaterial.setParameters({textureId:r.id})}var a,o=(0,f.Z)(this._lineMaterials());try{var s=function(){var t=a.value;e.view._stage.add(t),e.addHandles((0,S.D)((function(){e.view._stage.remove(t),t.dispose()})))};for(o.s();!(a=o.n()).done;)s()}catch(h){o.e(h)}finally{o.f()}var l,u=this.analysisViewData.computations,c=(0,f.Z)(u);try{for(c.s();!(l=c.n()).done;){var d=l.value;this._addComputation(d)}}catch(h){c.e(h)}finally{c.f()}this.addHandles([u.on("change",(function(t){var n,i=t.added,r=t.removed,a=(0,f.Z)(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;e._removeComputation(o)}}catch(h){a.e(h)}finally{a.f()}var s,l=(0,f.Z)(i);try{for(l.s();!(s=l.n()).done;){var u=s.value;e._addComputation(u)}}catch(h){l.e(h)}finally{l.f()}})),(0,Z.l)((function(){return H.l.toUnitRGBA(e.analysis.style.color)}),(function(t){var n,i=(0,f.Z)(e._lineMaterials());try{for(i.s();!(n=i.n()).done;){n.value.setParameters({color:t})}}catch(h){i.e(h)}finally{i.f()}}),Z.w),(0,Z.l)((function(){return e.analysis.style.lineSize}),(function(t){var n=(0,I.u)(t);e._markerMaterial.setParameters({width:n*Je.markers.lineSizeFraction}),e._dimensionLineMaterial.setParameters({width:n,markerParameters:e._markerMaterial.parameters});var i=Math.max(n*Je.offsetLine.lineSizeFraction,1);e._offsetLineMaterial.setParameters({width:i})}),Z.w),(0,Z.l)((function(){return{camera:e.view.state.camera,style:zr(e.analysis)}}),(function(t){var n,i=t.camera,r=t.style,a=(0,f.Z)(e._dimensionVisualizations);try{for(a.s();!(n=a.n()).done;){var o=(0,_.Z)(n.value,2),s=o[0],l=o[1];l.updateCameraDependentElements(i,s.geometry,r),l.updateLabelStyle(r)}}catch(h){a.e(h)}finally{a.f()}})),(0,Z.l)((function(){return e.visible}),(function(t){var n,i=(0,f.Z)(e._dimensionVisualizations.values());try{for(i.s();!(n=i.n()).done;){n.value.visible=t}}catch(h){i.e(h)}finally{i.f()}}))]),this.addHandles([(0,he.s)((function(){return e._updateMessageBundle()})),(0,Z.f)((function(){return!e.loadingMessages}),(function(){var t,n=(0,f.Z)(e._dimensionVisualizations.values());try{for(n.s();!(t=n.n()).done;){t.value.updateUnitsMessages(e._messages)}}catch(h){n.e(h)}finally{n.f()}}),Z.U)]),this._updateMessageBundle()}},{key:"destroy",value:function(){this._dimensionVisualizations.forEach((function(e){e.destroy()})),this._dimensionVisualizations.clear()}},{key:"testInfo",get:function(){var e=this;return{visualizations:Array.from(this._dimensionVisualizations.values()),disablePartialOcclusion:function(){var t,n=(0,f.Z)(e._lineMaterials());try{for(n.s();!(t=n.n()).done;){t.value.setParameters({renderOccluded:W.ah.Occlude})}}catch(i){n.e(i)}finally{n.f()}}}}},{key:"_addComputation",value:function(e){this._dimensionVisualizations.has(e)||this._dimensionVisualizations.set(e,new Ar({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages}))}},{key:"_removeComputation",value:function(e){var t=this._dimensionVisualizations.get(e);(0,k.t)(t)||(t.destroy(),this._dimensionVisualizations.delete(e))}},{key:"_lineMaterials",value:function(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}},{key:"_updateMessageBundle",value:function(){var e=(0,l.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingMessages=!0,e.prev=1,e.next=4,(0,pe.u)("esri/core/t9n/Units");case 4:this._messages=e.sent;case 5:return e.prev=5,this.loadingMessages=!1,e.finish(5);case 8:case"end":return e.stop()}}),e,this,[[1,,5,8]])})));return function(){return e.apply(this,arguments)}}()}]),n}(S.m);function zr(e){var t=e.style,n=t.fontSize,i=t.lineSize,r=t.textColor;return{fontSize:n,lineSize:i,textBackgroundColor:t.textBackgroundColor.clone(),textColor:r.clone()}}(0,S.e)([(0,S.y)({constructOnly:!0})],Hr.prototype,"analysisViewData",void 0),(0,S.e)([(0,S.y)({constructOnly:!0,nonNullable:!0})],Hr.prototype,"view",void 0),(0,S.e)([(0,S.y)()],Hr.prototype,"analysis",null),(0,S.e)([(0,S.y)()],Hr.prototype,"visible",null),(0,S.e)([(0,S.y)()],Hr.prototype,"loadingMessages",void 0),Hr=(0,S.e)([(0,S.n)("esri.views.3d.analysis.Dimension.DimensionVisualization")],Hr);var Ir=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).dimension=null,i.length=null,i}return(0,y.Z)(n)}(S.m);(0,S.e)([(0,S.y)({constructOnly:!0,nonNullable:!0})],Ir.prototype,"dimension",void 0),(0,S.e)([(0,S.y)()],Ir.prototype,"length",void 0);var Vr=Ir=(0,S.e)([(0,S.n)("esri.views.3d.analysis.LengthDimensionResult")],Ir),Fr=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).geometry=null,i.elevationAlignedStartPoint=null,i.elevationAlignedEndPoint=null,i}return(0,y.Z)(n,[{key:"normalizeCtorArgs",value:function(e){var t=e.dimension,n=(0,a.Z)(e,fe);return(0,p.Z)({result:new Vr({dimension:t})},n)}},{key:"initialize",value:function(){var e=this;this.addHandles([(0,Z.l)((function(){return e.dimension.startPoint}),(function(t){return e.elevationAlignedStartPoint=e.projectAndAlignPoint(t)}),Z.w),(0,Z.l)((function(){return e.dimension.endPoint}),(function(t){return e.elevationAlignedEndPoint=e.projectAndAlignPoint(t)}),Z.w)])}},{key:"dimension",get:function(){return this.result.dimension}},{key:"length",get:function(){return this.result.length}}]),n}(S.m);(0,S.e)([(0,S.y)({constructOnly:!0,nonNullable:!0})],Fr.prototype,"result",void 0),(0,S.e)([(0,S.y)({constructOnly:!0,nonNullable:!0})],Fr.prototype,"projectAndAlignPoint",void 0),(0,S.e)([(0,S.y)()],Fr.prototype,"dimension",null),(0,S.e)([(0,S.y)()],Fr.prototype,"length",null),(0,S.e)([(0,S.y)()],Fr.prototype,"geometry",void 0),(0,S.e)([(0,S.y)()],Fr.prototype,"elevationAlignedStartPoint",void 0),(0,S.e)([(0,S.y)()],Fr.prototype,"elevationAlignedEndPoint",void 0),(0,S.e)([(0,S.y)()],Fr.prototype,"preConstraintProperties",void 0),(0,S.e)([(0,S.y)()],Fr.prototype,"previousConstraint",void 0),Fr=(0,S.e)([(0,S.n)("esri.views.3d.analysis.LengthDimensionComputation")],Fr);var Gr=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(e){var i;return(0,v.Z)(this,n),(i=t.call(this,e)).type="dimension-view-3d",i.tool=null,i.computations=new w.j,i.selectedDimension=null,i._dimensionsToComputations=new Map,i._placementTask=null,i._projectAndAlignPoint=null,i}return(0,y.Z)(n,[{key:"initialize",value:function(){var e=this;this._projectAndAlignPoint=function(t){if((0,k.t)(t))return null;var n=e.view,i=n.spatialReference,r=n.elevationProvider,a=(0,x.d)(t,i,r);return(0,k.t)(a)&&(0,x.a)(e.analysis,t.spatialReference,S.a.getLogger(e.declaredClass)),a},this.addHandles([(0,F.s)(this,Er),(0,Z.a)((function(){return e.analysis.dimensions}),"after-add",(function(t){return e._onDimensionAdd(t.item)}),{onListenerAdd:function(t){var n,i=(0,f.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._onDimensionAdd(r)}}catch(a){i.e(a)}finally{i.f()}},onListenerRemove:function(){e._onDimensionsClear()}}),(0,Z.a)((function(){return e.analysis.dimensions}),"after-remove",(function(t){return e._onDimensionRemove(t.item)}))]),this._analysisVisualization=new Hr({analysisViewData:this,view:this.view}),this._analysisController=new Ge({analysisViewData:this,view:this.view})}},{key:"destroy",value:function(){this._placementTask=(0,k.l)(this._placementTask),this._analysisVisualization=(0,k.g)(this._analysisVisualization),(0,F.m)(this)}},{key:"updating",get:function(){var e,t;return null!==(e=null===(t=this._analysisVisualization)||void 0===t?void 0:t.loadingMessages)&&void 0!==e&&e}},{key:"results",get:function(){var e=this;return this.analysis.dimensions.map((function(t){return e._dimensionsToComputations.get(t).result}))}},{key:"selectedComputation",get:function(){var e=this.selectedDimension;return(0,k.t)(e)?null:this._dimensionsToComputations.get(e)}},{key:"testInfo",get:function(){return{visualization:this._analysisVisualization,controller:this._analysisController}}},{key:"createLengthDimensions",value:function(){var e=(0,l.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.selectedDimension=null,this._placementTask=(0,k.l)(this._placementTask),this._placementTask=(0,F.c)(this,t),this._placementTask.promise));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_onDimensionAdd",value:function(e){var t=this.computations,n=this._dimensionsToComputations;if(!n.has(e)){var i=new Fr({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});t.add(i),n.set(e,i)}}},{key:"_onDimensionRemove",value:function(e){var t=this.computations,n=this._dimensionsToComputations,i=t.findIndex((function(t){return t.dimension===e})),r=t.getItemAt(i);r.dimension===this.selectedDimension&&(this.selectedDimension=null),t.removeAt(i),n.delete(e),(0,k.g)(r)}},{key:"_onDimensionsClear",value:function(){this.computations.drain((function(e){return e.destroy()})),this._dimensionsToComputations.clear()}}]),n}(function(e){var t=function(e){(0,g.Z)(n,e);var t=(0,m.Z)(n);function n(){var e;(0,v.Z)(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).analysis=null,e.tool=null,e.selectedDimension=null,e.interactive=!1,e.visible=null,e}return(0,y.Z)(n,[{key:"results",get:function(){return new w.j}},{key:"createLengthDimensions",value:function(e){throw new Error("Method not implemented.")}}]),n}(e);return(0,S.e)([(0,S.y)({constructOnly:!0})],t.prototype,"view",void 0),(0,S.e)([(0,S.y)({constructOnly:!0,nonNullable:!0})],t.prototype,"analysis",void 0),(0,S.e)([(0,S.y)()],t.prototype,"tool",void 0),(0,S.e)([(0,S.y)({readOnly:!0})],t.prototype,"results",null),(0,S.e)([(0,S.y)()],t.prototype,"selectedDimension",void 0),(0,S.e)([(0,S.y)()],t.prototype,"interactive",void 0),(0,S.e)([(0,S.y)()],t.prototype,"visible",void 0),t=(0,S.e)([(0,S.n)("esri.views.analysis.DimensionAnalysisView")],t)}((0,x.b)(S.m)));(0,S.e)([(0,S.y)({readOnly:!0})],Gr.prototype,"type",void 0),(0,S.e)([(0,S.y)()],Gr.prototype,"tool",void 0),(0,S.e)([(0,S.y)()],Gr.prototype,"updating",null),(0,S.e)([(0,S.y)({readOnly:!0})],Gr.prototype,"results",null),(0,S.e)([(0,S.y)({readOnly:!0})],Gr.prototype,"computations",void 0),(0,S.e)([(0,S.y)()],Gr.prototype,"selectedDimension",void 0),(0,S.e)([(0,S.y)()],Gr.prototype,"selectedComputation",null),(0,S.e)([(0,S.y)()],Gr.prototype,"_analysisVisualization",void 0),(0,S.e)([(0,S.y)()],Gr.prototype,"_analysisController",void 0),(0,S.e)([(0,S.y)()],Gr.prototype,"_dimensionsToComputations",void 0),(0,S.e)([(0,S.y)()],Gr.prototype,"_placementTask",void 0);var Nr=Gr=(0,S.e)([(0,S.n)("esri.views.3d.analysis.DimensionAnalysisView3D")],Gr),qr=Object.freeze({__proto__:null,default:Nr})},92251:function(e,t,n){n.d(t,{B:function(){return g},C:function(){return v},i:function(){return Z},o:function(){return k},z:function(){return y}});var i,r,a=n(1413),o=n(93661),s=n(77956),l=n(71802),u=(n(95249),n(24093)),c=n(64772),d=(n(15529),n(28390)),h=n(25747),p=n(20846),f=(n(74384),n(64998),n(46817),n(82474),n(43955),n(69641),n(17332),n(70381));function v(e,t){return function(e,t){var n=(0,l.n)(),i=(0,l.n)(),r=!1;return function(l){var h=t(l);if("start"===l.action){var p=(0,s.d)(l.screenStart,(0,s.l)(c.t.get())),f=(0,d.ak)(e.state.camera,p,m);(0,o.r)(f)&&(r=(0,u.q)(h,f,n))}if(!r)return null;var v=(0,s.d)(l.screenEnd,(0,s.l)(c.t.get())),y=(0,d.ak)(e.state.camera,v,m);return(0,o.t)(y)?null:(0,u.q)(h,y,i)?(0,a.Z)((0,a.Z)({},l),{},{renderStart:n,renderEnd:i,plane:h,ray:y}):null}}(e,(function(){return t}))}function y(e){var t=null;return function(n){switch(n.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,o.r)(t)&&(t.remove(),t=null)}return n}}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=(0,h.g)(e.state.viewingMode);n.options.selectionMode=!0,n.options.store=h.J.MIN,n.options.hud=!1;var r,u=(0,s.i)(),c={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},d=(0,l.n)(),f=(0,o.v)(t,e.spatialReference),v=function(t){e.map.ground&&e.map.ground.opacity<1?c.exclude.add(p.j):c.exclude.delete(p.j),e.sceneIntersectionHelper.intersectIntersectorScreen((0,s.d)(t,u),n,c);var r,a=n.results.min;if(a.getIntersectionPoint(d))r=a.intersector===h.M.TERRAIN?i.GROUND:i.OTHER;else{if(!n.results.ground.getIntersectionPoint(d))return null;r=i.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(d,f),surfaceType:r}};return function(e){if("start"===e.action){var t=v(e.screenStart);r=(0,o.r)(t)?t.location:null}if((0,o.t)(r))return null;var n=v(e.screenEnd);return(0,o.r)(n)&&(0,o.r)(n.location)?(0,a.Z)((0,a.Z)({},e),{},{mapStart:r,mapEnd:n.location,surfaceType:n.surfaceType}):null}}(r=i||(i={}))[r.GROUND=0]="GROUND",r[r.OTHER=1]="OTHER";var m=(0,c.d)(),_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",S="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAACtVBMVEUAAAD/AAD/gAD/VQD/gAD/gAD/bQD/gAD/cQD/gAD/dAD/gAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/fAD/gAD/gAD/fAD/gAD/fQD/fQD/gAD/fQD/egD/fQD/gAD/egD/fQD/gAD/ewD/gAD/ewD/gAD/ewD/fQD/fQD/gAD/ewD/fQD/gAD/fAD/gAD/fAD/fgD/gAD/fAD/fgD/fAD/fgD/gAD/fAD/fgD/fAD/fgD/fQD/fQD/fgD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fQD/fgD/gAL/fgD/gAb/gAT/gwr/hAz/hxH/hQ//iBX/iBP/ixn/iRf/jBr/jR7/jyP/jyL/kif/kCX/kyr/lS7/lCz/ljH/li//mTX/nDr/mjn/nTz/oEL/okf/o0r/pU3/pU7/qFL/plH/qFX/q1j/q1r/rl7/sGL/rmH/s2v/tW//tW7/t3L/uHL/unb/unf/vHv/vX3/v4D/vX7/v4D/wYT/v4L/wYX/x4//x5H/yZX/y5n/zZv/y5n/zJv/zZ3/zp//0aL/z6H/1Kr/1av/06r/1q//17H/2bT/2LP/2rb/27n/3bz/3r7/37//4MH/38D/4ML/4sX/4sb/4sf/48n/5cv/48r/5cz/5s7/6dT/6tb/69j/69n/7Nn/7dv/7dz/7t7/7t3/7+H/7+D/7+H/8eL/8uX/8uX/8ub/8+j/8+f/9On/9er/9Or/9ez/9e3/9ez/9u7/9e3/9+//9+7/+PD/+PH/+fT/+fL/+vb/+vX/+vb/+/f/+vb//Pn/+/j//Pr//Pn//fv//Pr//fv//v3//fz//////v7//v3///8ZYzD6AAAA5nRSTlMAAQIDBAYHCAkKCwwQERITGBkaGyUmKCkqKy0uLzAxMjIzNDQ2Njg4OTs+Pj9AQEJCQ0RERUZHUlJTVFVWWFlfYGFiY2RlZmdoaWprbG1ucHFyc3R1dnd4eXp8f4CAgYGCg4SEhYWGhoeIiYmKiouMjI2Nj5CQkZOUlZaXmJiZmpudnp6io6OkpaanqKmqqqusrK2xs7W2t7e4ubq7u7/AwMLExcXGyMrLzM3NztDR0tPU1NXW29zd3t/g4eLi5OTl5ufo6erq6+zs7e7u7+/w8PHy9PT29vf4+Pn5+vr7+/z9/f7+/pNrFTEAAAO8SURBVHjaldf5W1RVGAfwl4kGxa2yIDPbF82EJhkVUEOiUiDMcJa482XCijStNLLVpoWCbLHFaZUoMSkq2wgtW8mobFcryiiWkffv6J557jh3zj33zvD56f3h3vM873nP+z7nkJ3cPE9JxdX+OgSWX15aMG0CjcnUoiuRSls2byplyH1eDZSqZrkz+d0ThC1/QQ45c521Eo58p5GTSZcirbIpZGtGEBkI5pNaVhEyo3mzSCF7ITJW7CKLYxbDTsPG5qe33QezxdkkySqGndYY615CilI5Cy9sRVjYgVRzKcXJGmzdwsKHkEwnkylB2AsNse5zSIITKWkJnPzCut8gW5IsxRlw9CnrRuohO5MM43xw9D4Lt0JWm2jOOXD2Ogv3w6LQaGA/nL3AwuOwCLpJmIU0nmDheVidQ0IV0niAhQ5YVcfnH2zcCMNtLLwHheOJaB5s7OxuQlx4hHV7oeAhokrYaOeBjkYIv7LuJyhUEU3QYONFZj4YrQfwGeuGQrDSxtM0KK2N7h5koa8V+ICFdVA4SX2Kbt5xmA2j7SHsZGETFOZQqarwhzjhUAuAl1nYDIUFdAVkoe0s/LiLmT9eD91TLDwHhXJaDtmbrPvyEWzg4dfCEB5kYTsUrqIgJK8w8/C2MHDDgWYgromFXVDwkQbDRsRFhpkHWyHcBMO1oyzSgcI1VGdEd8V6o6uA8D7m2BZIDrJuPxTqKGBEnczc33nHFmZ+A7IvWDegTmEF4lb1s3Dk+wH+oxGyj1hYC6saqkDcVk74u6cJsk4W7oXVZVSCuK84aXTP5pBcGeFRWM2nQmMPOw+zyQ9t62DyLAtRWM2mPBgao1+zyVD3wyEkPMTCq7DKo/Gmdo50DbDJd22JbbudhXdgoeUSVcNkTfRbNvnv3U0QGmKs2w2LpUR0MVI1d4+wSW/0egC/i7APFkXKobq+7Wc2+avrHvSK4B/1UKUaWNQ/1nOEk2Kf7GdhNSTLSDgfKhvaDrDsbkhmkuAOQKnhmb2cqkVuBDfFeWDnzo4/2WQrUl2QuB7XwtZ1T+7ho9qRYmUOGc6Gk8hb/xoLvI0Up1KCqxyOVkf3sdADs0soaVIQaUS6Bpm/gUlgMplMR1pron39SNLyKcVcpBduCQMJXpLMx5gsdJEkexHGYJGLLFzFyFhJNilkeTVkxkM28oPIQOAUsjW5DGmVTSQnM3xwVHt6FjnLudAPW4GLMnq7zqyEUvW5x1KGTvAulSqiVRYeR2OSmz+7uKLGpwX8K8oXFJw4zu67/wFaspwc84wT2QAAAABJRU5ErkJggg==",w={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function k(e){return e.fromData(_,(function(){return new f.Y(_,w)}))}function Z(e){return e.fromData(S,(function(){return new f.Y(S,w)}))}},52102:function(e,t,n){n.d(t,{r:function(){return p},t:function(){return i},u:function(){return v}});var i,r=n(43144),a=n(15671),o=n(60136),s=n(29388),l=n(48848),u=(n(74384),n(62610)),c=n(1500),d=n(40114),h=(n(93661),n(82474));!function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(i||(i={}));var p=[i.Horizontal,i.Vertical,i.Direct],f=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,a.Z)(this,n),(r=t.call(this,e)).type="length",r.startPoint=null,r.endPoint=null,r.measureType=i.Direct,r.offset=0,r.orientation=0,r}return(0,r.Z)(n)}((0,d.u)(u.l));(0,l.e)([(0,l.y)({type:["length"],json:{write:{isRequired:!0}}})],f.prototype,"type",void 0),(0,l.e)([(0,l.y)({type:h.w,json:{write:!0}})],f.prototype,"startPoint",void 0),(0,l.e)([(0,l.y)({type:h.w,json:{write:!0}})],f.prototype,"endPoint",void 0),(0,l.e)([(0,l.y)({type:p,nonNullable:!0,json:{write:{isRequired:!0}}})],f.prototype,"measureType",void 0),(0,l.e)([(0,l.y)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],f.prototype,"offset",void 0),(0,l.e)([(0,l.y)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,l.c)((function(e){return c.s.normalize((0,l.g)(e),0,!0)}))],f.prototype,"orientation",void 0);var v=f=(0,l.e)([(0,l.n)("esri.analysis.LengthDimension")],f)},66633:function(e,t,n){n.d(t,{r:function(){return s}});var i=n(15671),r=n(43144),a=n(93661),o=n(48848),s=function(){function e(t,n){var r=this;(0,i.Z)(this,e),this._textureRep=t,this._disposed=!1;var s=this._textureRep.acquire(n);(0,o.V)(s)?(s.then((function(e){r._disposed?(0,a.F)(e):r._textureRef=e})),this.loadPromise=s):this._textureRef=s}return(0,r.Z)(e,[{key:"dispose",value:function(){this._textureRef=(0,a.F)(this._textureRef),this._disposed=!0}},{key:"glTexture",get:function(){return(0,a.r)(this._textureRef)?this._textureRef.glTexture:null}}]),e}()},18668:function(e,t,n){n.d(t,{S:function(){return S}});var i=n(93433),r=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(48848),u=n(93661),c=n(50690),d=n(79557),h=n(49228),p=n(71802),f=n(1797),v=n(64772),y=n(75016),g=n(70381),m=n(28390),_=n(43345),S=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e))._handles=new l.X,i._quadMaterial=null,i._outlineMaterial=null,i._maxSize=0,i._position=(0,p.n)(),i._up=(0,p.n)(),i._right=(0,p.n)(),i._renderOccluded=g.ah.OccludeAndTransparent,i._color=(0,f.r)(1,0,0,1),i._outlineColor=(0,f.r)(0,0,0,1),i._outlineSize=0,i._size=32,i._outlineRenderOccluded=g.ah.Opaque,i.applyProps(e),i}return(0,a.Z)(n,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,p.B)(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,p.B)(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){var t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function(e){var t=e.previous,n=e.center,i=e.next;this._maxSize=Math.min((0,p.x)(n,t),(0,p.x)(n,i))/3,(0,p.z)(this._up,(0,p.e)(this._up,t,n)),(0,p.z)(this._right,(0,p.e)(this._right,i,n)),(0,p.r)(this._position,n),this.recreateGeometry()}},{key:"createExternalResources",value:function(){var e=this;this._quadMaterial=new m.al(this._quadMaterialParameters),this._outlineMaterial=new m.a7(this._outlineMaterialParameters),this._handles.add((0,c.l)((function(){return e.view.state.camera}),(function(){return e._updateTransform()})))}},{key:"destroyExternalResources",value:function(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){e(this._quadMaterial),e(this._outlineMaterial)}},{key:"createGeometries",value:function(e){(0,p.F)(this._up,p.a7)&&(0,p.F)(this._right,p.a7)||(this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e))}},{key:"_createQuadGeometry",value:function(e){var t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}},{key:"_createOutlineGeometry",value:function(e){if(0!==this._outlineSize){var t=(0,p.u)(v.c.get(),this._up,this._right),n=(0,m.ab)([this._up,t,this._right]);e.addGeometry(n,this._outlineMaterial)}}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object,t=this.view.state.camera,n=this._size*t.computeScreenPixelSizeAt(this._position),i=Math.min(this._maxSize,n);(0,d.x)(w,this._position),(0,d.i)(w,w,[i,i,i]),(0,u.r)(e)&&(e.transformation=w)}},{key:"_quadGeometryData",value:function(e,t){var n=(0,p.u)(v.c.get(),e,t);return new g.M([[_.O.POSITION,{size:3,data:[0,0,0].concat((0,i.Z)(t),(0,i.Z)(e),(0,i.Z)(n)),exclusive:!0}]],[[_.O.POSITION,[0,1,2,1,2,3]]])}},{key:"_quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"_updateQuadMaterial",value:function(){this._quadMaterial&&this._quadMaterial.setParameters(this._quadMaterialParameters)}},{key:"_outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}},{key:"_updateOutlineMaterial",value:function(){this._outlineMaterial&&this._outlineMaterial.setParameters(this._outlineMaterialParameters)}}]),n}(y.n),w=(0,h.e)()},40345:function(e,t,n){n.d(t,{h:function(){return u},i:function(){return s}});var i=n(93661),r=n(82474);function a(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++){var i=e[n],r=t[n];if(i.length!==r.length)return!1;for(var a=0;a<i.length;a++)if(i[a]!==r[a])return!1}return!0}function o(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!a(e[n],t[n]))return!1;return!0}function s(e,t){return e===t||(0,i.r)(e)&&(0,i.r)(t)&&(0,r.E)(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function l(e,t){if(e===t)return!0;if((0,i.t)(e)||(0,i.t)(t))return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return s(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,r.E)(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,r.E)(e.spatialReference,t.spatialReference)&&o(e.paths,t.paths)}(e,t);case"polygon":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,r.E)(e.spatialReference,t.spatialReference)&&o(e.rings,t.rings)}(e,t);case"multipoint":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!(0,r.E)(e.spatialReference,t.spatialReference)&&a(e.points,t.points)}(e,t);case"mesh":return!1;default:return}}function u(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!l(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(var r=0,a=n;r<a.length;r++){var o=a[r];if(e[o]!==t[o])return!1}return!0}(e.attributes,t.attributes)}}}]);
//# sourceMappingURL=1078.7173167b.chunk.js.map