"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[8196],{68741:function(e,t,r){r.d(t,{S:function(){return q}});var i=r(74165),n=r(37762),a=r(15861),o=r(15671),s=r(43144),u=r(60136),l=r(29388),c=r(29439),h=r(50165),d=r(96263),p=r(79146),y=r(77322),v=r(57405),f=r(73151),m=r(22494),g=r(49510),x=Math.PI/180;function w(e){return e*x}function b(e,t){var r=w(t.rotation),i=Math.abs(Math.cos(r)),n=Math.abs(Math.sin(r)),a=(0,c.Z)(t.size,2),o=a[0],s=a[1];return e[0]=Math.round(s*n+o*i),e[1]=Math.round(s*i+o*n),e}function k(e,t,r,i){var n=(0,c.Z)(t,2),a=n[0],o=n[1],s=(0,c.Z)(i,2),u=s[0],l=s[1],h=.5*r;return e[0]=a-h*u,e[1]=o-h*l,e[2]=a+h*u,e[3]=o+h*l,e}var _=(0,p.u)(),Z=[0,0],R=new g.e(0,0,0,0),P=2048,S=2048,E=!1,M=!1,V=!1,T=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e){var s;return(0,o.Z)(this,r),(s=t.call(this,e))._imagePromise=null,s.bitmaps=[],s.hidpi=V,s.imageMaxWidth=P,s.imageMaxHeight=S,s.imageRotationSupported=E,s.imageNormalizationSupported=M,s.update=(0,h.B)(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var o,u,l,c,h,d,p,v,f,m,g;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stationary&&!s.destroyed){e.next=2;break}return e.abrupt("return",null);case 2:return o=t.state,u=(0,y.b)(o.spatialReference),l=s.hidpi?t.pixelRatio:1,(c=s.imageNormalizationSupported&&o.worldScreenWidth&&o.worldScreenWidth<o.size[0])?(Z[0]=o.worldScreenWidth,Z[1]=o.size[1]):s.imageRotationSupported?(Z[0]=o.size[0],Z[1]=o.size[1]):b(Z,o),h=Math.floor(Z[0]*l)>s.imageMaxWidth||Math.floor(Z[1]*l)>s.imageMaxHeight,d=u&&(o.extent.xmin<u.valid[0]||o.extent.xmax>u.valid[1]),p=!s.imageNormalizationSupported&&d,v=!h&&!p,f=s.imageRotationSupported?o.rotation:0,v?(m=c?o.paddedViewState.center:o.center,s._imagePromise=s._singleExport(o,Z,m,o.resolution,f,l,r)):(g=Math.min(s.imageMaxWidth,s.imageMaxHeight),p&&(g=Math.min(o.worldScreenWidth,g)),s._imagePromise=s._tiledExport(o,g,l,r)),e.abrupt("return",s._imagePromise.then(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,a,o,u,l,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s._imagePromise=null,!s.destroyed){s.bitmaps=null!==t&&void 0!==t?t:[],r=(0,n.Z)(s.container.children);try{for(o=function(){var e=a.value;t.includes(e)||e.fadeOut().then((function(){e.remove()}))},r.s();!(a=r.n()).done;)o()}catch(i){r.e(i)}finally{r.f()}u=(0,n.Z)(t);try{for(u.s();!(l=u.n()).done;)c=l.value,s.container.addChild(c),c.fadeIn()}catch(i){u.e(i)}finally{u.f()}}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){throw s._imagePromise=null,e})));case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),5e3),s}return(0,s.Z)(r,[{key:"destroy",value:function(){this.bitmaps=[]}},{key:"updating",get:function(){return!this.destroyed&&null!==this._imagePromise}},{key:"updateExports",value:function(e){var t,r=(0,n.Z)(this.container.children);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(!i.visible||!i.stage)return;e(i),i.invalidateTexture(),i.requestRender()}}catch(a){r.e(a)}finally{r.f()}}},{key:"_export",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n,a,o,s){var u,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchSource(t,Math.floor(r*o),Math.floor(n*o),{rotation:a,pixelRatio:o,signal:s});case 2:return u=e.sent,l=new f.v(u,"additive"),e.abrupt("return",(l.x=t.xmin,l.y=t.ymax,l.resolution=t.width/r,l.rotation=a,l.pixelRatio=o,l));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,o){return e.apply(this,arguments)}}()},{key:"_singleExport",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n,a,o,s,u){var l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k(_,n,a,r),l=new d.M(_[0],_[1],_[2],_[3],t.spatialReference),e.next=4,this._export(l,r[0],r[1],o,s,u);case 4:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,o,s){return e.apply(this,arguments)}}()},{key:"_tiledExport",value:function(e,t,r,i){var n=this,a=v.S.create({size:t,spatialReference:e.spatialReference,scales:[e.scale]}),o=new m.h(a),s=o.getTileCoverage(e);if(!s)return null;var u=[];return s.forEach((function(a,s,l,c){R.set(a,s,l,c),o.getTileBounds(_,R);var h=new d.M(_[0],_[1],_[2],_[3],e.spatialReference);u.push(n._export(h,t,t,0,r,i))})),Promise.all(u)}}]),r}(h.y);(0,h.e)([(0,h.d)()],T.prototype,"_imagePromise",void 0),(0,h.e)([(0,h.d)()],T.prototype,"bitmaps",void 0),(0,h.e)([(0,h.d)()],T.prototype,"container",void 0),(0,h.e)([(0,h.d)()],T.prototype,"fetchSource",void 0),(0,h.e)([(0,h.d)()],T.prototype,"hidpi",void 0),(0,h.e)([(0,h.d)()],T.prototype,"imageMaxWidth",void 0),(0,h.e)([(0,h.d)()],T.prototype,"imageMaxHeight",void 0),(0,h.e)([(0,h.d)()],T.prototype,"imageRotationSupported",void 0),(0,h.e)([(0,h.d)()],T.prototype,"imageNormalizationSupported",void 0),(0,h.e)([(0,h.d)()],T.prototype,"requestUpdate",void 0),(0,h.e)([(0,h.d)()],T.prototype,"updating",null);var q=T=(0,h.e)([(0,h.n)("esri.views.2d.layers.support.ExportStrategy")],T)},73001:function(e,t,r){r.d(t,{n:function(){return y}});var i=r(15671),n=r(43144),a=r(11752),o=r(61120),s=r(60136),u=r(29388),l=r(50165),c=r(3441),h=r(28372),d=r(6819),p=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,n.Z)(r,[{key:"doRender",value:function(e){e.drawPhase===c.I.HIGHLIGHT&&(0,a.Z)((0,o.Z)(r.prototype),"doRender",this).call(this,e)}},{key:"renderChildren",value:function(e){if(this.attributeView.bindTextures(e.context),this.children.some((function(e){return e.hasData}))){(0,a.Z)((0,o.Z)(r.prototype),"renderChildren",this).call(this,e);var t=e.painter.effects.highlight;t.bind(e),e.context.setColorMask(!0,!0,!0,!0),e.context.clear(d._.COLOR_BUFFER_BIT),this._renderChildren(e,t.defines.concat(["highlightAll"])),t.draw(e),t.unbind()}}}]),r}(h.t),y=p=(0,l.e)([(0,l.n)("esri.views.2d.layers.support.HighlightGraphicContainer")],p)},64339:function(e,t,r){r.d(t,{m:function(){return f}});var i=r(74165),n=r(15861),a=r(15671),o=r(43144),s=r(11752),u=r(61120),l=r(60136),c=r(29388),h=r(50165),d=r(77322),p=r(63334),y=r(53089),v=r(33117),f=function(e){var t=function(e){(0,l.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).view=null,e}return(0,o.Z)(r,[{key:"fetchPopupFeatures",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n,a,o,s,u,l,c,p,f,m,g;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.layer,t){e.next=3;break}throw new h.a("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:n});case 3:if(a=n.popupEnabled,o=(0,v.s)(n,r),a&&!(0,h.t)(o)){e.next=6;break}throw new h.a("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:o});case 6:return e.next=8,o.getRequiredFields();case 8:return s=e.sent,(u=new y.b).timeExtent=this.timeExtent,u.geometry=t,u.outFields=s,u.outSpatialReference=t.spatialReference,l=this.view.resolution,c="2d"===this.view.type?new d.j(l,l,this.view.spatialReference):new d.j(.5*l,.5*l,this.view.spatialReference),p=o.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},f=p.returnTopmostRaster,m=p.showNoDataRecords,g={returnDomainValues:!0,returnTopmostRaster:f,pixelSize:c,showNoDataRecords:m,signal:(0,h.r)(r)?r.signal:null},e.abrupt("return",n.queryVisibleRasters(u,g).then((function(e){return e})));case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){var e;return!!(0,s.Z)((0,u.Z)(r.prototype),"canResume",this).call(this)&&!(null!==(e=this.timeExtent)&&void 0!==e&&e.isEmpty)}}]),r}(e);return(0,h.e)([(0,h.d)()],t.prototype,"layer",void 0),(0,h.e)([(0,h.d)()],t.prototype,"suspended",void 0),(0,h.e)([(0,h.d)(p.g)],t.prototype,"timeExtent",void 0),(0,h.e)([(0,h.d)()],t.prototype,"view",void 0),t=(0,h.e)([(0,h.n)("esri.views.layers.ImageryLayerView")],t)}},48196:function(e,t,r){r.r(t);var i=r(74165),n=r(29439),a=r(15861),o=r(93433),s=r(11752),u=r(61120),l=r(15671),c=r(43144),h=r(60136),d=r(29388),p=r(50165),y=r(89031),v=r(40133),f=r(73627),m=r(42094),g=r(95645),x=r(35744),w=r(28372),b=r(73001),k=r(25346),_=r(34780),Z=r(14527),R=r(73151),P=r(68741),S=r(13994),E=r(22984),M=r(96263),V=r(4806),T=r(60866),q=r(35341),I=r(3441),z=r(48308),B=r(64339),D=r(60470),C=r(1894),F=(r(33530),r(77322),r(32335),r(31278),r(98496),r(4483),r(79747),r(42),r(52155),r(75662),r(17493),r(62980),r(16377),r(9887),r(88406),r(66307),r(2760),r(42488),r(9330),r(79146),r(3029),r(42687),r(78330),r(78697),r(78664),r(48968),r(6819),r(47692),r(26995),r(96401),r(68634),r(69738),r(73393),r(87110),r(72577),r(61772),r(92870),r(26079),r(15508),r(17691),r(48561),r(55269),r(73428),r(86931),r(51613),r(80392),r(10489),r(62298),r(2815),r(2326),r(90339),r(76375),r(82046),r(49961),r(31412),r(53089),r(83172),r(66270),r(60418),r(84539),r(75366),r(5233),r(36235),r(61340),r(57439),r(59075),r(97823),r(49350),r(89354),r(16897),r(47642),r(63334),r(38419),r(84231),r(38665),r(32717),r(39853),r(94872),r(3969),r(43895),r(30594),r(73267),r(22628),r(24982),r(46584),r(7093),r(85966),r(28003),r(49796),r(58428),r(8049),r(80933),r(40858),r(95076),r(56389),r(86738),r(69205),r(50338),r(33074),r(31134),r(41524),r(68668),r(55916),r(66319),r(24781),r(2329),r(37243),r(97345),r(39001),r(84913),r(84823),r(9411),r(14826),r(64620),r(22225),r(75272),r(4197),r(86905),r(64997),r(26208),r(2816),r(46237),r(98428),r(5792),r(67871),r(75097),r(47672),r(98643),r(83745),r(87833),r(21523),r(84192),r(99057),r(99797),r(33265),r(20592),r(44365),r(45578),r(77372),r(77006),r(29648),r(35650),r(7513),r(48606),r(68792),r(49510),r(6927),r(82909),r(95734),r(66281),r(27969),r(25593),r(69379),r(22494),r(18392),r(89324),r(6283),r(98057),r(38802),r(20422),r(38969),r(75105),r(66156),r(25715),r(51386),r(81044),r(40100),r(88533),r(77639),r(13089),r(49862),r(37783),r(3096),r(57405),r(50463),r(94640),r(14023),r(69754),r(33117),p.s.getLogger("esri.views.2d.layers.imagery.ImageryView2D")),U=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,l.Z)(this,r),(e=t.apply(this,arguments)).attached=!1,e.container=new Z.s,e.updateRequested=!1,e.type="imagery",e._bitmapView=new _.t,e}return(0,c.Z)(r,[{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||this.isUpdating()}},{key:"update",value:function(e){this.strategy.update(e).catch((function(e){(0,p.I)(e)||F.error(e)}))}},{key:"hitTest",value:function(e){return new y.g({attributes:{},geometry:e.clone(),layer:this.layer})}},{key:"attach",value:function(){var e=this;this.container.addChild(this._bitmapView);var t=this.layer.version>=10,r=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,i=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this.strategy=new P.S({container:this._bitmapView,imageNormalizationSupported:t,imageMaxHeight:r,imageMaxWidth:i,fetchSource:this._fetchImage.bind(this),requestUpdate:function(){return e.requestUpdate()}})}},{key:"detach",value:function(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren(),this.updateRequested=!1}},{key:"redraw",value:function(){var e=this;this.strategy.updateExports((function(t){t.source instanceof HTMLImageElement?t.requestRender():e.layer.applyRenderer({pixelBlock:t.source.pixelBlock}).then((function(r){var i=t.source;i.pixelBlock=r.pixelBlock,i.filter=function(t){return e.layer.applyFilter(t)},e.container.requestRender()}))}))}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}},{key:"isUpdating",value:function(){return this.strategy.updating||this.updateRequested}},{key:"getPixelData",value:function(){if(this.updating)return null;var e=this.strategy.bitmaps;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){var t=this.view.extent,r=e.map((function(e){return e.source})).filter((function(e){return e.extent&&e.extent.intersects(t)})).map((function(e){return{extent:e.extent,pixelBlock:e.originalPixelBlock}})),i=(0,k.f)(r,t);return(0,p.r)(i)?{extent:i.extent,pixelBlock:i.pixelBlock}:null}return null}},{key:"_fetchImage",value:function(e,t,r,i){var n=this;return(i=i||{}).timeExtent=this.timeExtent,i.requestAsImageElement=!0,this.layer.fetchImage(e,t,r,i).then((function(e){return e.imageElement?e.imageElement:n.layer.applyRenderer(e.pixelData,{signal:i.signal}).then((function(t){var r=new R.i(t.pixelBlock,t.extent.clone(),e.pixelData.pixelBlock);return r.filter=function(e){return n.layer.applyFilter(e)},r}))}))}}]),r}(p.y);(0,p.e)([(0,p.d)()],U.prototype,"attached",void 0),(0,p.e)([(0,p.d)()],U.prototype,"container",void 0),(0,p.e)([(0,p.d)()],U.prototype,"layer",void 0),(0,p.e)([(0,p.d)()],U.prototype,"strategy",void 0),(0,p.e)([(0,p.d)()],U.prototype,"timeExtent",void 0),(0,p.e)([(0,p.d)()],U.prototype,"view",void 0),(0,p.e)([(0,p.d)()],U.prototype,"updateRequested",void 0),(0,p.e)([(0,p.d)()],U.prototype,"updating",null),(0,p.e)([(0,p.d)()],U.prototype,"type",void 0);var A=U=(0,p.e)([(0,p.n)("esri.views.2d.layers.imagery.ImageryView2D")],U),O=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,l.Z)(this,r),(e=t.apply(this,arguments)).symbolTypes=["triangle"],e}return(0,c.Z)(r,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"imagery (vf)",brushes:[q.m],target:function(){return t.children},drawPhase:I.I.MAP});return[].concat((0,o.Z)((0,s.Z)((0,u.Z)(r.prototype),"prepareRenderPasses",this).call(this,e)),[i])}},{key:"doRender",value:function(e){var t=this;this.visible&&e.drawPhase===I.I.MAP&&this.symbolTypes.forEach((function(i){e.renderPass=i,(0,s.Z)((0,u.Z)(r.prototype),"doRender",t).call(t,e)}))}}]),r}(z.a),H=p.s.getLogger("esri.views.2d.layers.imagery.VectorFieldView2D"),N=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var i;return(0,l.Z)(this,r),(i=t.call(this,e)).update=(0,p.B)((function(e,t){return i._update(e,t).catch((function(e){(0,p.I)(e)||H.error(e)}))})),i}return(0,c.Z)(r,[{key:"updating",get:function(){return!!this._loading}},{key:"redraw",value:function(e){if(this.container.children.length){var t=this.container.children[0];t.symbolizerParameters=e,t.invalidateVAO(),this.container.symbolTypes="wind_speed"===e.style?["scalar","triangle"]:"simple_scalar"===e.style?["scalar"]:["triangle"],this.container.requestRender()}}},{key:"_update",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var o,s,u,l,c,h,d,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stationary){e.next=2;break}return e.abrupt("return");case 2:return o=t.state,s=o.extent,u=o.spatialReference,l=new M.M({xmin:s.xmin,ymin:s.ymin,xmax:s.xmax,ymax:s.ymax,spatialReference:u}),c=(0,n.Z)(t.state.size,2),h=c[0],d=c[1],this._loading=this.fetchPixels(l,h,d,a),e.next=6,this._loading;case 6:p=e.sent,this._addToDisplay(p,r,t.state),this._loading=null;case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_addToDisplay",value:function(e,t,r){if((0,p.t)(e.pixelBlock))return this.container.children.forEach((function(e){return e.destroy()})),void this.container.removeAllChildren();var i=e.extent,n=e.pixelBlock,a=new g.y(n);a.offset=[0,0],a.symbolizerParameters=t,a.rawPixelData=e,a.invalidateVAO(),a.x=i.xmin,a.y=i.ymax,a.pixelRatio=r.pixelRatio,a.rotation=r.rotation,a.resolution=r.resolution,a.width=n.width*t.symbolTileSize,a.height=n.height*t.symbolTileSize,this.container.children.forEach((function(e){return e.destroy()})),this.container.removeAllChildren(),this.container.symbolTypes="wind_speed"===t.style?["scalar","triangle"]:"simple_scalar"===t.style?["scalar"]:["triangle"],this.container.addChild(a)}}]),r}(p.y);(0,p.e)([(0,p.d)()],N.prototype,"fetchPixels",void 0),(0,p.e)([(0,p.d)()],N.prototype,"container",void 0),(0,p.e)([(0,p.d)()],N.prototype,"_loading",void 0),(0,p.e)([(0,p.d)()],N.prototype,"updating",null);var W=N=(0,p.e)([(0,p.n)("esri.views.2d.layers.imagery.ImageryVFStrategy")],N),j=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,l.Z)(this,r),(e=t.apply(this,arguments)).attached=!1,e.container=new O,e.type="imageryVF",e._dataParameters={exportParametersVersion:0,bbox:"",symbolTileSize:0,time:""},e._fetchpixels=function(){var t=(0,a.Z)((0,i.Z)().mark((function t(r,n,a,o){var s,u,l,c,h,d,y,v,f,m;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._projectFullExtentPromise;case 2:if(s=t.sent,u=e.layer.renderer.symbolTileSize,l=(0,T.M)(r,n,a,u,s),c=l.extent,h=l.width,d=l.height,!(0,p.r)(s)||s.intersects(r)){t.next=10;break}return t.abrupt("return",{extent:c,pixelBlock:null});case 10:if(y={bbox:"".concat(c.xmin,", ").concat(c.ymin,", ").concat(c.xmax,", ").concat(c.ymax),exportParametersVersion:e.layer.exportImageServiceParameters.version,symbolTileSize:u,time:JSON.stringify(e.timeExtent||"")},!e._canReuseVectorFieldData(y)){t.next=16;break}if(v=e.getPixelData(),!(0,p.r)(v)){t.next=16;break}if("".concat(v.extent.xmin,", ").concat(v.extent.ymin,", ").concat(v.extent.xmax,", ").concat(v.extent.ymax)!==y.bbox){t.next=16;break}return t.abrupt("return",v);case 16:return t.next=18,e.layer.fetchImage(c,h,d,{timeExtent:e.timeExtent,requestAsImageElement:!1,signal:o});case 18:if(f=t.sent,m=f.pixelData,e._dataParameters=y,!(0,p.t)(m.pixelBlock)){t.next=22;break}return t.abrupt("return",{extent:c,pixelBlock:null});case 22:return t.abrupt("return",{extent:c,pixelBlock:"vector-uv"===e.layer.rasterInfo.dataType?(0,p.g)((0,T.m)(m.pixelBlock,"vector-uv")):m.pixelBlock});case 23:case"end":return t.stop()}}),t)})));return function(e,r,i,n){return t.apply(this,arguments)}}(),e}return(0,c.Z)(r,[{key:"updating",get:function(){return!this.attached||this._strategy.updating}},{key:"attach",value:function(){var e=this;this._projectFullExtentPromise=this._getProjectedFullExtent(this.view.spatialReference),this._strategy=new W({container:this.container,fetchPixels:this._fetchpixels}),this.handles.add((0,f.l)((function(){return e.layer.renderer}),(function(t){return e._updateSymbolizerParams(t)}),f.w),"vector-field-view-update")}},{key:"detach",value:function(){this._strategy.destroy(),this.container.children.forEach((function(e){return e.destroy()})),this.container.removeAllChildren(),this.handles.remove("vector-field-view-update"),this._strategy=this.container=this._projectFullExtentPromise=null}},{key:"getPixelData",value:function(){if(this.updating||!this.container.children.length)return null;var e=this.container.children[0].rawPixelData;return{extent:e.extent,pixelBlock:e.pixelBlock}}},{key:"hitTest",value:function(e){return new y.g({attributes:{},geometry:e.clone(),layer:this.layer})}},{key:"update",value:function(e){this._strategy.update(e,this._symbolizerParams)}},{key:"redraw",value:function(){this._updateSymbolizerParams(this.layer.renderer),this._strategy.redraw(this._symbolizerParams)}},{key:"_canReuseVectorFieldData",value:function(e){var t=this._dataParameters.exportParametersVersion===e.exportParametersVersion,r=this._dataParameters.time===e.time,i=this._dataParameters.symbolTileSize===e.symbolTileSize,n=this._dataParameters.bbox===e.bbox;return t&&r&&i&&n}},{key:"_getProjectedFullExtent",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,V.F)(this.layer.fullExtent,t);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.prev=8,e.next=11,(0,S.U)(this.layer.url,{query:{option:"footprints",outSR:t.wkid||JSON.stringify(t.toJSON()),f:"json"}});case 11:return r=e.sent.data.featureCollection.layers[0].layerDefinition.extent,e.abrupt("return",r?M.M.fromJSON(r):null);case 15:return e.prev=15,e.t1=e.catch(8),e.abrupt("return",null);case 18:case"end":return e.stop()}}),e,this,[[0,6],[8,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateSymbolizerParams",value:function(e){"vector-field"===e.type&&(this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null}))}}]),r}(E.d);(0,p.e)([(0,p.d)()],j.prototype,"attached",void 0),(0,p.e)([(0,p.d)()],j.prototype,"container",void 0),(0,p.e)([(0,p.d)()],j.prototype,"layer",void 0),(0,p.e)([(0,p.d)()],j.prototype,"timeExtent",void 0),(0,p.e)([(0,p.d)()],j.prototype,"type",void 0),(0,p.e)([(0,p.d)()],j.prototype,"view",void 0),(0,p.e)([(0,p.d)()],j.prototype,"updating",null);var G=j=(0,p.e)([(0,p.n)("esri.views.2d.layers.imagery.VectorFieldView2D")],j),L=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,l.Z)(this,r),(e=t.apply(this,arguments))._exportImageVersion=-1,e._highlightGraphics=new m.c,e.subview=null,e}return(0,c.Z)(r,[{key:"pixelData",get:function(){return this.updating?null:"getPixelData"in this.subview?this.subview.getPixelData():null}},{key:"updating",get:function(){return!!(!this.subview||"updating"in this.subview&&this.subview.updating)}},{key:"hitTest",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.subview?[{type:"graphic",graphic:this.subview.hitTest(t),layer:this.layer,mapPoint:t}]:null);case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"update",value:function(e){var t;null===(t=this.subview)||void 0===t||t.update(e)}},{key:"attach",value:function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.view&&(this._highlightView=new w.a({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:function(){return e.requestUpdate()},container:new b.n(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container)),this.handles.add([(0,f.l)((function(){var t;return null!==(t=e.layer.blendMode)&&void 0!==t?t:"normal"}),(function(t){return e.subview.container.blendMode=t}),f.w),(0,f.l)((function(){var t;return null!==(t=e.layer.effect)&&void 0!==t?t:null}),(function(t){return e.subview.container.effect=t}),f.w),(0,f.l)((function(){return e.layer.exportImageServiceParameters.version}),(function(t){t&&e._exportImageVersion!==t&&(e._exportImageVersion=t,e.requestUpdate())}),f.U),(0,f.l)((function(){return e.timeExtent}),(function(t){e.subview.timeExtent=t,"redraw"in e.subview?e.requestUpdate():e.subview.redrawOrRefetch()}),f.U),this.layer.on("redraw",(function(){"redraw"in e.subview?e.subview.redraw():e.subview.redrawOrRefetch()})),(0,f.l)((function(){return e.layer.renderer}),(function(){return e._setSubView()}))],"imagerylayerview-update")}},{key:"detach",value:function(){var e,t;this.layer.decreaseRasterJobHandlerUsage(),this.container.removeAllChildren(),this._detachSubview(this.subview),null!==(e=this.subview)&&void 0!==e&&e.destroy(),this.handles.remove("imagerylayerview-update"),this.subview=null,null!==(t=this._highlightView)&&void 0!==t&&t.destroy(),this._exportImageVersion=-1}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"highlight",value:function(e,t){var r=this;if(!((Array.isArray(e)?e[0]:v.j.isCollection(e)?e.getItemAt(0):e)instanceof y.g))return{remove:function(){}};var i=[];return Array.isArray(e)||v.j.isCollection(e)?i=e.map((function(e){return e.clone()})):e instanceof y.g&&(i=[e.clone()]),this._highlightGraphics.addMany(i),{remove:function(){r._highlightGraphics.removeMany(i)}}}},{key:"doRefresh",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.requestUpdate();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return!this.subview||this.subview.updating}},{key:"_setSubView",value:function(){var e;if(this.view){var t=null===(e=this.layer.renderer)||void 0===e?void 0:e.type,r="imagery";if("vector-field"===t?r="imageryVF":"flow"===t&&(r="flow"),this.subview){var i;if(this.subview.type===r)return this._attachSubview(this.subview),void("flow"===this.subview.type&&this.subview.redrawOrRefetch());this._detachSubview(this.subview),null===(i=this.subview)||void 0===i||i.destroy()}this.subview="imagery"===r?new A({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"imageryVF"===r?new G({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new g.d({layer:this.layer,layerView:this}),this._attachSubview(this.subview),this.requestUpdate()}}},{key:"_attachSubview",value:function(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0),e.container.blendMode=this.layer.blendMode,e.container.effect=this.layer.effect)}},{key:"_detachSubview",value:function(e){(null===e||void 0===e?void 0:e.attached)&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}}]),r}((0,B.m)((0,C.i)((0,x.f)(D.u))));(0,p.e)([(0,p.d)()],L.prototype,"pixelData",null),(0,p.e)([(0,p.d)({readOnly:!0})],L.prototype,"updating",null),(0,p.e)([(0,p.d)()],L.prototype,"subview",void 0);var J=L=(0,p.e)([(0,p.n)("esri.views.2d.layers.ImageryLayerView2D")],L);t.default=J}}]);
//# sourceMappingURL=8196.8e768272.chunk.js.map