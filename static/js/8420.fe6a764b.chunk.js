"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[8420],{69838:function(e,t,r){r.d(t,{Y:function(){return A}});var n=r(1413),i=r(37762),u=r(74165),s=r(15861),a=r(15671),o=r(43144),c=r(93661),l=r(48848),f=r(6762),p=r(47855),h=r(93209),d=r(25456),y=r(74384),v=r(56162),m=r(63212),x=r(82474),g=r(52559),b=r(2352),S=r(62753),_=r(67477),k=r(78413),I=r(94663),w=r(77755),R=r(59984),Z=r(47748);var F="feature-store:unsupported-query",Q=new f.h(2e6),E=0,A=function(){function e(t){var r=this;(0,a.Z)(this,e),this.capabilities={query:_.t},this.geometryType=t.geometryType,this.hasM=t.hasM,this.hasZ=t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(function(){return r.clearCache()})),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new f.r(E+++"$$",Q)),this.fieldsIndex=new w.r(t.fields),t.scheduler&&t.priority&&(this._frameTask=t.scheduler.registerTask(t.priority))}return(0,o.Z)(e,[{key:"destroy",value:function(){this._frameTask=(0,c.f)(this._frameTask),this.clearCache(),(0,c.g)(this._geometryQueryCache),this._changeHandle=(0,c.f)(this._changeHandle),(0,c.g)(this.fieldsIndex)}},{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"fullExtent",get:function(){var e=this.featureStore.fullBounds;return(0,c.t)(e)?null:{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:(0,I.E)(this.spatialReference)}}},{key:"timeExtent",get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=(0,k.t)(this.timeInfo,this.featureStore)),this._timeExtent):null}},{key:"clearCache",value:function(){var e;null!==(e=this._geometryQueryCache)&&void 0!==e&&e.clear(),this._allItems=null,this._timeExtent=null}},{key:"executeQuery",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._executeQuery(t,{},r);case 3:return e.abrupt("return",e.sent.createQueryResponse());case 6:if(e.prev=6,e.t0=e.catch(0),e.t0===I.F){e.next=10;break}throw e.t0;case 10:return e.abrupt("return",new b.A([],t,this).createQueryResponse());case 11:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForCount",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(){var t,r,n=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1?n[1]:void 0,e.prev=2,e.next=5,this._executeQuery(t,{returnGeometry:!1,returnCentroid:!1,outSR:null},r);case 5:return e.abrupt("return",e.sent.createQueryResponseForCount());case 8:if(e.prev=8,e.t0=e.catch(2),e.t0===I.F){e.next=12;break}throw e.t0;case 12:return e.abrupt("return",0);case 13:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForExtent",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r){var n,i,s,a,o,c,l,f;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.outSR,e.prev=1,e.next=4,this._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},r);case 4:if(i=e.sent,s=i.size){e.next=8;break}return e.abrupt("return",{count:0,extent:null});case 8:return(0,h.w)(N,h.C),this.featureStore.forEachBounds(i.items,(function(e){return(0,h.f)(N,e)}),T),a={xmin:N[0],ymin:N[1],xmax:N[3],ymax:N[4],spatialReference:(0,I.E)(this.spatialReference)},this.hasZ&&isFinite(N[2])&&isFinite(N[5])&&(a.zmin=N[2],a.zmax=N[5]),(o=(0,S.g)(a,i.spatialReference,n)).spatialReference=(0,I.E)(n||this.spatialReference),o.xmax-o.xmin==0&&(c=(0,p.$)(o.spatialReference),o.xmin-=c,o.xmax+=c),o.ymax-o.ymin==0&&(l=(0,p.$)(o.spatialReference),o.ymin-=l,o.ymax+=l),this.hasZ&&null!=o.zmin&&null!=o.zmax&&o.zmax-o.zmin==0&&(f=(0,p.$)(o.spatialReference),o.zmin-=f,o.zmax+=f),e.abrupt("return",{count:s,extent:o});case 18:if(e.prev=18,e.t0=e.catch(1),e.t0!==I.F){e.next=22;break}return e.abrupt("return",{count:0,extent:null});case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,this,[[1,18]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForIds",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.executeQueryForIdSet(t,r).then((function(e){return Array.from(e)})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForIdSet",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r){var n,s,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},r);case 3:return n=e.sent,s=n.items,a=new Set,e.next=8,this._reschedule((function(){var e,t=(0,i.Z)(s);try{for(t.s();!(e=t.n()).done;){var r=e.value;a.add(n.featureAdapter.getObjectId(r))}}catch(u){t.e(u)}finally{t.f()}}),r);case 8:return e.abrupt("return",a);case 11:if(e.prev=11,e.t0=e.catch(0),e.t0!==I.F){e.next=15;break}return e.abrupt("return",new Set);case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForSnapping",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r){var i,s,a,o,l,f,p,h,d,y,g,_,k,I,w=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.point,s=t.distance,t.types!==b.q.NONE){e.next=3;break}return e.abrupt("return",{candidates:[]});case 3:return e.next=5,this._reschedule((function(){return w._checkQuerySupport(t.query)}),r);case 5:if(a=e.sent,o=!(0,x.E)(i.spatialReference,this.spatialReference),e.t0=o,!e.t0){e.next=11;break}return e.next=11,(0,S.f)(i.spatialReference,this.spatialReference);case 11:if(l="number"==typeof s?s:s.x,f="number"==typeof s?s:s.y,p={xmin:i.x-l,xmax:i.x+l,ymin:i.y-f,ymax:i.y+f,spatialReference:i.spatialReference},h=o?(0,S.g)(p,this.spatialReference):p){e.next=14;break}return e.abrupt("return",{candidates:[]});case 14:return e.next=16,(0,m.v)((0,v.v)(i),null,{signal:r});case 16:return d=e.sent[0],e.next=19,(0,m.v)((0,v.v)(h),null,{signal:r});case 19:if(y=e.sent[0],!(0,c.t)(d)&&!(0,c.t)(y)){e.next=22;break}return e.abrupt("return",{candidates:[]});case 22:return g=new b.A(this._searchFeatures(this._getQueryBBoxes(y.toJSON())),a,this),e.next=25,this._reschedule((function(){return w._executeObjectIdsQuery(g)}),r);case 25:return e.next=27,this._reschedule((function(){return w._executeTimeQuery(g)}),r);case 27:return e.next=29,this._reschedule((function(){return w._executeAttributesQuery(g)}),r);case 29:return _=d.toJSON(),k=o?(0,S.g)(_,this.spatialReference):_,I=o?Math.max(h.xmax-h.xmin,h.ymax-h.ymin)/2:s,e.abrupt("return",g.createSnappingResponse((0,n.Z)((0,n.Z)({},t),{},{point:k,distance:I}),i.spatialReference));case 31:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForLatestObservations",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r){var n,i=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.timeInfo&&this.timeInfo.trackIdField){e.next=2;break}throw new l.s(F,"Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:this.timeInfo});case 2:return e.prev=2,e.next=5,this._executeQuery(t,{},r);case 5:return n=e.sent,e.next=8,this._reschedule((function(){return i._filterLatest(n)}),r);case 8:return e.abrupt("return",n.createQueryResponse());case 11:if(e.prev=11,e.t0=e.catch(2),e.t0===I.F){e.next=15;break}throw e.t0;case 15:return e.abrupt("return",new b.A([],t,this).createQueryResponse());case 16:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForSummaryStatistics",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(){var t,r,n,i,s,a,o=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},r=o.length>1?o[1]:void 0,n=o.length>2?o[2]:void 0,i=r.field,s=r.normalizationField,a=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:s,valueExpression:a},n);case 6:return e.abrupt("return",e.sent.createSummaryStatisticsResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForUniqueValues",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(){var t,r,n,i,s,a,o,c=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},r=c.length>1?c[1]:void 0,n=c.length>2?c[2]:void 0,i=r.field,s=r.field2,a=r.field3,o=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,field2:s,field3:a,valueExpression:o},n);case 6:return e.abrupt("return",e.sent.createUniqueValuesResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForClassBreaks",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(){var t,r,n,i,s,a,o=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},r=o.length>1?o[1]:void 0,n=o.length>2?o[2]:void 0,i=r.field,s=r.normalizationField,a=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:s,valueExpression:a},n);case 6:return e.abrupt("return",e.sent.createClassBreaksResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForHistogram",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(){var t,r,n,i,s,a,o=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},r=o.length>1?o[1]:void 0,n=o.length>2?o[2]:void 0,i=r.field,s=r.normalizationField,a=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:s,valueExpression:a},n);case 6:return e.abrupt("return",e.sent.createHistogramResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_schedule",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.r)(this._frameTask)?this._frameTask.schedule(t,r):t(Z.F));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_reschedule",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.r)(this._frameTask)?this._frameTask.reschedule(t,r):t(Z.F));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getAll",value:function(e){return(0,c.t)(this._allItems)&&(this._allItems=this.featureStore.toArray()),new b.A(this._allItems,e,this)}},{key:"_executeQuery",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r,i){var s,a,o=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,c.y)(t),e.next=3,this._schedule((function(){return(0,I.z)(t,o.definitionExpression,o.spatialReference)}),i);case 3:return t=e.sent,e.next=6,this._reschedule((function(){return o._checkQuerySupport(t)}),i);case 6:return t=e.sent,t=(0,n.Z)((0,n.Z)({},t),r),e.next=10,this._reschedule((function(){return o._executeSceneFilterQuery(t,i)}),i);case 10:return s=e.sent,e.next=13,this._reschedule((function(){return o._executeGeometryQuery(t,s,i)}),i);case 13:return a=e.sent,e.next=16,this._reschedule((function(){return o._executeAggregateIdsQuery(a)}),i);case 16:return e.next=18,this._reschedule((function(){return o._executeObjectIdsQuery(a)}),i);case 18:return e.next=20,this._reschedule((function(){return o._executeTimeQuery(a)}),i);case 20:return e.next=22,this._reschedule((function(){return o._executeAttributesQuery(a)}),i);case 22:return e.abrupt("return",a);case 23:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_executeSceneFilterQuery",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r){var n,a,o,l,f,p,h,d,y,v,m,g,_,I,w,R,Z,F,Q=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,c.t)(t.sceneFilter)){e.next=2;break}return e.abrupt("return",null);case 2:if(n=t.outSR,a=t.returnGeometry,o=t.returnCentroid,l=this.featureStore.featureSpatialReference,f=t.sceneFilter.geometry,p=(0,c.t)(l)||(0,x.E)(l,f.spatialReference)?f:(0,S.g)(f,l)){e.next=5;break}return e.abrupt("return",null);case 5:if(h=a||o,d=(0,x.I)(n)&&!(0,x.E)(this.spatialReference,n)&&h?function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Q._project(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}():function(e){return e},y=this.featureAdapter,v=this._searchFeatures(this._getQueryBBoxes(p)),"disjoint"!==t.sceneFilter.spatialRelationship){e.next=19;break}if(v.length){e.next=9;break}return e.abrupt("return",null);case 9:m=new Set,g=(0,i.Z)(v);try{for(g.s();!(_=g.n()).done;)I=_.value,m.add(y.getObjectId(I))}catch(E){g.e(E)}finally{g.f()}return e.next=14,this._reschedule((function(){return Q.featureStore.toArray()}),r);case 14:return w=e.sent,e.next=17,this._reschedule((0,s.Z)((0,u.Z)().mark((function e(){var n,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,k.v)("esriSpatialRelDisjoint",p,Q.geometryType,Q.hasZ,Q.hasM);case 2:return n=e.sent,i=function(e){return!m.has(y.getObjectId(e))||n(y.getGeometry(e))},e.next=6,Q._runSpatialFilter(w,i,r);case 6:return s=e.sent,e.abrupt("return",new b.A(s,t,Q));case 8:case"end":return e.stop()}}),e)}))),r);case 17:return R=e.sent,e.abrupt("return",d(R));case 19:if(v.length){e.next=21;break}return e.abrupt("return",new b.A([],t,this));case 21:if(!this._canExecuteSinglePass(p,t)){e.next=23;break}return e.abrupt("return",d(new b.A(v,t,this)));case 23:return e.next=25,(0,k.v)("esriSpatialRelContains",p,this.geometryType,this.hasZ,this.hasM);case 25:return Z=e.sent,e.next=28,this._runSpatialFilter(v,(function(e){return Z(y.getGeometry(e))}),r);case 28:return F=e.sent,e.abrupt("return",d(new b.A(F,t,this)));case 30:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_executeGeometryQuery",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r,n){var a,o,l,f,p,h,d,y,v,m,g,_,I,w,R,Z,F,Q,E,A,T,N,P,C,G,M=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,c.r)(r)||0!==r.items.length){e.next=2;break}return e.abrupt("return",r);case 2:if(t=(0,c.r)(r)?r.query:t,o=(a=t).geometry,l=a.outSR,f=a.spatialRel,p=a.returnGeometry,h=a.returnCentroid,d=this.featureStore.featureSpatialReference,y=!o||(0,c.t)(d)||(0,x.E)(d,o.spatialReference)?o:(0,S.g)(o,d),v=p||h,m=(0,x.I)(l)&&!(0,x.E)(this.spatialReference,l),g=this._geometryQueryCache&&(0,c.t)(r)?m&&v?JSON.stringify({originalFilterGeometry:o,spatialRelationship:f,outSpatialReference:l}):JSON.stringify({originalFilterGeometry:o,spatialRelationship:f}):null,_=g?this._geometryQueryCache.get(g):null,!(0,c.r)(_)){e.next=6;break}return e.abrupt("return",new b.A(_,t,this));case 6:if(I=function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=m&&v,!e.t0){e.next=4;break}return e.next=4,M._project(t,l);case 4:return g&&M._geometryQueryCache.put(g,t.items,t.items.length+1),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y){e.next=9;break}return e.abrupt("return",I((0,c.r)(r)?r:this._getAll(t)));case 9:if(w=this.featureAdapter,R=this._searchFeatures(this._getQueryBBoxes(o)),"esriSpatialRelDisjoint"!==f){e.next=29;break}if(R.length){e.next=14;break}return e.abrupt("return",I((0,c.r)(r)?r:this._getAll(t)));case 14:Z=new Set,F=(0,i.Z)(R);try{for(F.s();!(Q=F.n()).done;)E=Q.value,Z.add(w.getObjectId(E))}catch(q){F.e(q)}finally{F.f()}if(!(0,c.r)(r)){e.next=21;break}e.t0=r.items,e.next=24;break;case 21:return e.next=23,this._reschedule((function(){return M.featureStore.toArray()}),n);case 23:e.t0=e.sent;case 24:return A=e.t0,e.next=27,this._reschedule((0,s.Z)((0,u.Z)().mark((function e(){var r,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,k.v)(f,y,M.geometryType,M.hasZ,M.hasM);case 2:return r=e.sent,i=function(e){return!Z.has(w.getObjectId(e))||r(w.getGeometry(e))},e.next=6,M._runSpatialFilter(A,i,n);case 6:return s=e.sent,e.abrupt("return",new b.A(s,t,M));case 8:case"end":return e.stop()}}),e)}))),n);case 27:return T=e.sent,e.abrupt("return",I(T));case 29:if((0,c.r)(r)&&(N=new c.b,R=R.filter((function(e){return(0,c.c)(r.items,e,r.items.length,N)>=0}))),R.length){e.next=33;break}return P=new b.A([],t,this),e.abrupt("return",(g&&this._geometryQueryCache.put(g,P.items,1),P));case 33:if(!this._canExecuteSinglePass(y,t)){e.next=35;break}return e.abrupt("return",I(new b.A(R,t,this)));case 35:return e.next=37,(0,k.v)(f,y,this.geometryType,this.hasZ,this.hasM);case 37:return C=e.sent,e.next=40,this._runSpatialFilter(R,(function(e){return C(w.getGeometry(e))}),n);case 40:return G=e.sent,e.abrupt("return",I(new b.A(G,t,this)));case 42:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_executeAggregateIdsQuery",value:function(e){if(0!==e.items.length&&e.query.aggregateIds&&e.query.aggregateIds.length&&!(0,c.t)(this.aggregateAdapter)){var t,r=new Set,n=(0,i.Z)(e.query.aggregateIds);try{for(n.s();!(t=n.n()).done;){var u=t.value;this.aggregateAdapter.getFeatureObjectIds(u).forEach((function(e){return r.add(e)}))}}catch(a){n.e(a)}finally{n.f()}var s=this.featureAdapter.getObjectId;e.items=e.items.filter((function(e){return r.has(s(e))}))}}},{key:"_executeObjectIdsQuery",value:function(e){if(0!==e.items.length&&e.query.objectIds&&e.query.objectIds.length){var t=new Set(e.query.objectIds),r=this.featureAdapter.getObjectId;e.items=e.items.filter((function(e){return t.has(r(e))}))}}},{key:"_executeTimeQuery",value:function(e){if(0!==e.items.length){var t=(0,k.n)(this.timeInfo,e.query.timeExtent,this.featureAdapter);(0,c.t)(t)||(e.items=e.items.filter(t))}}},{key:"_executeAttributesQuery",value:function(e){var t=this;if(0!==e.items.length){var r=(0,b.l)(e.query.where,this.fieldsIndex);if(r){if(!r.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter((function(e){return r.testFeature(e,t.featureAdapter)}))}}}},{key:"_runSpatialFilter",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r,n){var i,a,o,l=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t);case 2:if(!(0,c.t)(this._frameTask)){e.next=4;break}return e.abrupt("return",t.filter((function(e){return r(e)})));case 4:return i=0,a=new Array,o=function(){var e=(0,s.Z)((0,u.Z)().mark((function e(s){var c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i<t.length)){e.next=9;break}if(c=t[i++],r(c)&&(a.push(c),s.madeProgress()),e.t0=s.done,!e.t0){e.next=7;break}return e.next=7,l._reschedule((function(e){return o(e)}),n);case 7:e.next=0;break;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",this._reschedule((function(e){return o(e)}),n).then((function(){return a})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_filterLatest",value:function(e){var t,r=this.timeInfo,n=r.trackIdField,u=r.startTimeField,s=r.endTimeField||u,a=new Map,o=this.featureAdapter.getAttribute,c=(0,i.Z)(e.items);try{for(c.s();!(t=c.n()).done;){var l=t.value,f=o(l,n),p=o(l,s),h=a.get(f);(!h||p>o(h,s))&&a.set(f,l)}}catch(d){c.e(d)}finally{c.f()}e.items=Array.from(a.values())}},{key:"_canExecuteSinglePass",value:function(e,t){var r=t.spatialRel;return(0,k.I)(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r||"esriSpatialRelWithin"===r))}},{key:"_project",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r){var n,i,s=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&!(0,x.E)(this.spatialReference,r)){e.next=2;break}return e.abrupt("return",t);case 2:return n=this.featureAdapter,e.next=5,(0,S.M)(t.items.map((function(e){return(0,I.v)(s.geometryType,s.hasZ,s.hasM,n.getGeometry(e))})),this.spatialReference,r);case 5:return i=e.sent,e.abrupt("return",(t.items=i.map((function(e,r){return n.cloneWithGeometry(t.items[r],(0,g.n)(e,s.hasZ,s.hasM))})),t));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getQueryBBoxes",value:function(e){if((0,k.I)(e)){if((0,v.u)(e))return[(0,d.o)(e.xmin,e.ymin,e.xmax,e.ymax)];if((0,v.y)(e))return e.rings.map((function(e){return(0,d.o)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[(0,y.e)((0,d.u)(),e)]}},{key:"_searchFeatures",value:function(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.featureStore.forEachInBounds(n,(function(e){return P.add(e)}))}}catch(s){r.e(s)}finally{r.f()}var u=Array.from(P.values());return P.clear(),u}},{key:"_checkStatisticsSupport",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text||t.outStatistics||t.groupByFieldsForStatistics||t.having||t.orderByFields)){e.next=2;break}throw new l.s(F,"Unsupported query options",{query:t});case 2:return e.abrupt("return",(this._checkAttributesQuerySupport(t),Promise.all([this._checkStatisticsParamsSupport(r),(0,k.P)(t,this.geometryType,this.spatialReference),(0,S.f)(this.spatialReference,t.outSR)]).then((function(){return t}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_checkStatisticsParamsSupport",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){var r,n,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],!t.valueExpression){e.next=7;break}return e.next=4,(0,R.i)();case 4:n=e.sent,i=n.arcadeUtils,r=i.extractFieldNames(t.valueExpression);case 7:if(t.field&&r.push(t.field),t.field2&&r.push(t.field2),t.field3&&r.push(t.field3),t.normalizationField&&r.push(t.normalizationField),r.length){e.next=9;break}throw new l.s(F,"params should have at least a field or valueExpression",{params:t});case 9:(0,b.c)(this.fieldsIndex,r,"params contains missing fields");case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkQuerySupport",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text)){e.next=2;break}throw new l.s(F,"Unsupported query options",{query:t});case 2:return e.abrupt("return",(this._checkAttributesQuerySupport(t),this._checkStatisticsQuerySupport(t),Promise.all([(0,k.P)(t,this.geometryType,this.spatialReference),(0,S.f)(this.spatialReference,t.outSR)]).then((function(){return t}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkAttributesQuerySupport",value:function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues,i=e.outStatistics,u=i?i.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})).filter(Boolean):[];if(r&&r.length>0){var s=" asc",a=" desc",o=r.map((function(e){var t=e.toLowerCase();return t.includes(s)?t.split(s)[0]:t.includes(a)?t.split(a)[0]:e})).filter((function(e){return!u.includes(e)}));(0,b.c)(this.fieldsIndex,o,"orderByFields contains missing fields")}if(t&&t.length>0)(0,b.c)(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new l.s(F,"outFields should be specified for returnDistinctValues",{query:e});(0,b.o)(this.fieldsIndex,e.where)}},{key:"_checkStatisticsQuerySupport",value:function(e){var t=e.outStatistics,r=e.groupByFieldsForStatistics,n=e.having,u=r&&r.length,s=t&&t.length;if(n){if(!u||!s)throw new l.s(F,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});(0,b.a)(this.fieldsIndex,n,t)}if(s){if(!function(e){return e.every((function(e){return"exceedslimit"!==e.statisticType}))}(t))return;var a=t.map((function(e){return e.onStatisticField})).filter(Boolean);(0,b.c)(this.fieldsIndex,a,"onStatisticFields contains missing fields"),u&&(0,b.c)(this.fieldsIndex,r,"groupByFieldsForStatistics contains missing fields");var o,c=(0,i.Z)(t);try{for(c.s();!(o=c.n()).done;){var f=o.value,p=f.onStatisticField,h=f.statisticType;if("percentile_disc"!==h&&"percentile_cont"!==h||!("statisticParameters"in f)){if("count"!==h&&p&&(0,b.f)(p,this.fieldsIndex))throw new l.s(F,"outStatistics contains non-numeric fields",{definition:f,query:e})}else if(!f.statisticParameters)throw new l.s(F,"statisticParamters should be set for percentile type",{definition:f,query:e})}}catch(d){c.e(d)}finally{c.f()}}}},{key:"_getQueryEngineResultForStats",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,r,n){var i,s,a=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,c.y)(t),e.prev=1,e.next=4,this._schedule((function(){return(0,I.z)(t,a.definitionExpression,a.spatialReference)}),n);case 4:return t=e.sent,e.next=7,this._reschedule((function(){return a._checkStatisticsSupport(t,r)}),n);case 7:return t=e.sent,e.next=10,this._reschedule((function(){return a._executeSceneFilterQuery(t,n)}),n);case 10:return i=e.sent,e.next=13,this._reschedule((function(){return a._executeGeometryQuery(t,i,n)}),n);case 13:return s=e.sent,e.next=16,this._reschedule((function(){return a._executeAggregateIdsQuery(s)}),n);case 16:return e.next=18,this._reschedule((function(){return a._executeObjectIdsQuery(s)}),n);case 18:return e.next=20,this._reschedule((function(){return a._executeTimeQuery(s)}),n);case 20:return e.next=22,this._reschedule((function(){return a._executeAttributesQuery(s)}),n);case 22:return e.abrupt("return",s);case 25:if(e.prev=25,e.t0=e.catch(1),e.t0===I.F){e.next=29;break}throw e.t0;case 29:return e.abrupt("return",new b.A([],t,this));case 30:case"end":return e.stop()}}),e,this,[[1,25]])})));return function(t,r,n){return e.apply(this,arguments)}}()}]),e}(),T=(0,h.a)(),N=(0,h.a)(),P=new Set},67477:function(e,t,r){r.d(t,{t:function(){return n}});var n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},44513:function(e,t,r){r.d(t,{e:function(){return s}});var n=r(37762),i=r(93661);function u(e,t){return e?t?4:3:t?3:2}function s(e,t,r,s,c){if((0,i.t)(t)||!t.lengths.length)return null;var l="upperLeft"===(null===c||void 0===c?void 0:c.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);var f,p=e.coords,h=[],d=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],y=t.lengths,v=t.coords,m=u(r,s),x=0,g=(0,n.Z)(y);try{for(g.s();!(f=g.n()).done;){var b=f.value,S=a(d,v,x,b,r,s,l);S&&h.push(S),x+=b*m}}catch(I){g.e(I)}finally{g.f()}if(h.sort((function(e,t){var n=l*e[2]-l*t[2];return 0===n&&r&&(n=e[4]-t[4]),n})),h.length){var _=6*h[0][2];p[0]=h[0][0]/_,p[1]=h[0][1]/_,r&&(_=6*h[0][4],p[2]=0!==_?h[0][3]/_:0),(p[0]<d[0]||p[0]>d[1]||p[1]<d[2]||p[1]>d[3]||r&&(p[2]<d[4]||p[2]>d[5]))&&(p.length=0)}if(!p.length){var k=t.lengths[0]?o(v,0,y[0],r,s):null;if(!k)return null;p[0]=k[0],p[1]=k[1],r&&k.length>2&&(p[2]=k[2])}return e}function a(e,t,r,n,i,s){for(var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,o=u(i,s),c=r,l=r+o,f=0,p=0,h=0,d=0,y=0,v=0,m=n-1;v<m;v++,c+=o,l+=o){var x=t[c],g=t[c+1],b=t[c+2],S=t[l],_=t[l+1],k=t[l+2],I=x*_-S*g;d+=I,f+=(x+S)*I,p+=(g+_)*I,i&&(h+=(b+k)*(I=x*k-S*b),y+=I),x<e[0]&&(e[0]=x),x>e[1]&&(e[1]=x),g<e[2]&&(e[2]=g),g>e[3]&&(e[3]=g),i&&(b<e[4]&&(e[4]=b),b>e[5]&&(e[5]=b))}if(d*a>0&&(d*=-1),y*a>0&&(y*=-1),!d)return null;var w=[f,p,.5*d];return i&&(w[3]=h,w[4]=.5*y),w}function o(e,t,r,n,i){for(var s=u(n,i),a=t,o=t+s,h=0,d=0,y=0,v=0,m=0,x=r-1;m<x;m++,a+=s,o+=s){var g=e[a],b=e[a+1],S=e[a+2],_=e[o],k=e[o+1],I=e[o+2],w=n?l(g,b,S,_,k,I):c(g,b,_,k);if(w)if(h+=w,n){var R=p(g,b,S,_,k,I);d+=w*R[0],y+=w*R[1],v+=w*R[2]}else{var Z=f(g,b,_,k);d+=w*Z[0],y+=w*Z[1]}}return h>0?n?[d/h,y/h,v/h]:[d/h,y/h]:r>0?n?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function c(e,t,r,n){var i=r-e,u=n-t;return Math.sqrt(i*i+u*u)}function l(e,t,r,n,i,u){var s=n-e,a=i-t,o=u-r;return Math.sqrt(s*s+a*a+o*o)}function f(e,t,r,n){return[e+.5*(r-e),t+.5*(n-t)]}function p(e,t,r,n,i,u){return[e+.5*(n-e),t+.5*(i-t),r+.5*(u-r)]}},53921:function(e,t,r){r.d(t,{a:function(){return a}});var n,i,u,s={exports:{}};n=s,i=function(){function e(r,n,i,u,s){for(;u>i;){if(u-i>600){var a=u-i+1,o=n-i+1,c=Math.log(a),l=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*l*(a-l)/a)*(o-a/2<0?-1:1);e(r,n,Math.max(i,Math.floor(n-o*l/a+f)),Math.min(u,Math.floor(n+(a-o)*l/a+f)),s)}var p=r[n],h=i,d=u;for(t(r,i,n),s(r[u],p)>0&&t(r,i,u);h<d;){for(t(r,h,d),h++,d--;s(r[h],p)<0;)h++;for(;s(r[d],p)>0;)d--}0===s(r[i],p)?t(r,i,d):t(r,++d,u),d<=n&&(i=d+1),n<=d&&(u=d-1)}}function t(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function r(e,t){return e<t?-1:e>t?1:0}return function(t,n,i,u,s){e(t,n,i||0,u||t.length-1,s||r)}},void 0!==(u=i())&&(n.exports=u);var a=s.exports},78413:function(e,t,r){r.d(t,{I:function(){return F},P:function(){return R},n:function(){return E},t:function(){return Q},v:function(){return w}});var n=r(74165),i=r(15861),u=r(37762),s=r(48848),a=r(46817),o=r(56162),c=r(82474),l=r(52559),f=r(62466),p=r(62753),h=r(94663);function d(e,t){return e?t?4:3:t?3:2}function y(e,t,r,n,i){if(!e)return!1;var s,a=d(t,r),o=e.coords,c=e.lengths,l=!1,f=0,p=(0,u.Z)(c);try{for(p.s();!(s=p.n()).done;){var h=s.value;l=v(l,o,a,f,h,n,i),f+=h*a}}catch(y){p.e(y)}finally{p.f()}return l}function v(e,t,r,n,i,u,s){for(var a=e,o=n,c=n,l=n+i*r;c<l;c+=r){(o=c+r)===l&&(o=n);var f=t[c],p=t[c+1],h=t[o],d=t[o+1];(p<s&&d>=s||d<s&&p>=s)&&f+(s-p)/(d-p)*(h-f)<u&&(a=!a)}return a}var m="feature-store:unsupported-query",x={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},g={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},b={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},S={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function _(e){return null!=e&&!0===g[e]}function k(e){return null!=e&&!0===b[(0,o.c)(e)]}function I(e){return null!=e&&!0===S[e]}function w(e,t,n,i,u){if((0,o.y)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var s=(0,l.J)(new f.t,t,!1,!1);return Promise.resolve((function(e){return function(e,t,r,n){return y(e,t,r,n.coords[0],n.coords[1])}(s,!1,!1,e)}))}if((0,o.y)(t)&&"esriGeometryMultipoint"===n){var c=(0,l.J)(new f.t,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((function(e){return function(e,t,r,n,i,u){var s=d(i,u),a=n.coords,o=n.lengths;if(!o)return!1;for(var c=0,l=0;c<o.length;c++,l+=s)if(!y(e,t,r,a[l],a[l+1]))return!1;return!0}(c,!1,!1,e,i,u)}))}if((0,o.u)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((function(e){return(0,a.r)(t,(0,h.v)(n,i,u,e))}));if((0,o.u)(t)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===e)return Promise.resolve((function(e){return(0,a.i)(t,(0,h.v)(n,i,u,e))}));if((0,o.u)(t)&&"esriSpatialRelIntersects"===e){var p=function(e){return"mesh"===e?a.o:(0,a.Z)(e)}(n);return Promise.resolve((function(e){return p(t,(0,h.v)(n,i,u,e))}))}return Promise.all([r.e(6951),r.e(9009)]).then(r.bind(r,79009)).then((function(r){var s=r[x[e]].bind(null,t.spatialReference,t);return function(e){return s((0,h.v)(n,i,u,e))}}))}function R(e,t,r){return Z.apply(this,arguments)}function Z(){return Z=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var u,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=t.spatialRel,!(a=t.geometry)){e.next=11;break}if(_(u)){e.next=4;break}throw new s.s(m,"Unsupported query spatial relationship",{query:t});case 4:if(!(0,c.I)(a.spatialReference)||!(0,c.I)(i)){e.next=11;break}if(k(a)){e.next=7;break}throw new s.s(m,"Unsupported query geometry type",{query:t});case 7:if(I(r)){e.next=9;break}throw new s.s(m,"Unsupported layer geometry type",{query:t});case 9:if(!t.outSR){e.next=11;break}return e.abrupt("return",(0,p.f)(t.geometry&&t.geometry.spatialReference,t.outSR));case 11:case"end":return e.stop()}}),e)}))),Z.apply(this,arguments)}function F(e){if((0,o.u)(e))return!0;if((0,o.y)(e)){var t,r=(0,u.Z)(e.rings);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(5!==n.length)return!1;if(n[0][0]!==n[1][0]||n[0][0]!==n[4][0]||n[2][0]!==n[3][0]||n[0][1]!==n[3][1]||n[0][1]!==n[4][1]||n[1][1]!==n[2][1])return!1}}catch(i){r.e(i)}finally{r.f()}return!0}return!1}function Q(e,t){if(!e)return null;var r=t.featureAdapter,n=e.startTimeField,i=e.endTimeField,u=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;if(n&&i)t.forEach((function(e){var t=r.getAttribute(e,n),a=r.getAttribute(e,i);null==t||isNaN(t)||(u=Math.min(u,t)),null==a||isNaN(a)||(s=Math.max(s,a))}));else{var a=n||i;t.forEach((function(e){var t=r.getAttribute(e,a);null==t||isNaN(t)||(u=Math.min(u,t),s=Math.max(s,t))}))}return{start:u,end:s}}function E(e,t,r){if(!t||!e)return null;var n=e.startTimeField,i=e.endTimeField;if(!n&&!i)return null;var u=t.start,s=t.end;return null===u&&null===s?null:void 0===u&&void 0===s?function(){return!1}:n&&i?function(e,t,r,n,i){return null!=n&&null!=i?function(u){var s=e.getAttribute(u,t),a=e.getAttribute(u,r);return(null==s||s<=i)&&(null==a||a>=n)}:null!=n?function(t){var i=e.getAttribute(t,r);return null==i||i>=n}:null!=i?function(r){var n=e.getAttribute(r,t);return null==n||n<=i}:void 0}(r,n,i,u,s):function(e,t,r,n){return null!=r&&null!=n&&r===n?function(n){return e.getAttribute(n,t)===r}:null!=r&&null!=n?function(i){var u=e.getAttribute(i,t);return u>=r&&u<=n}:null!=r?function(n){return e.getAttribute(n,t)>=r}:null!=n?function(r){return e.getAttribute(r,t)<=n}:void 0}(r,n||i,u,s)}}}]);
//# sourceMappingURL=8420.fe6a764b.chunk.js.map