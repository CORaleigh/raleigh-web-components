"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[360],{86420:function(e,t,n){n.d(t,{f:function(){return b},l:function(){return h},u:function(){return m}});var i=n(15671),r=n(43144),o=n(60136),a=n(29388),s=n(23132),l=n(2157),u=n(70441),c=n(75610),d=n(16936),v=n(30709),p=n(18411);function f(e,t){return h(e)===h(t)}function h(e){if((0,c.t)(e))return null;var t,n=null!=e.layer?e.layer.id:"";return null==(t=null!=e.objectId?e.objectId:null!=e.layer&&"objectIdField"in e.layer&&null!=e.layer.objectIdField&&null!=e.attributes?e.attributes[e.layer.objectIdField]:e.uid)?null:"o-".concat(n,"-").concat(t)}var y={json:{write:{writer:function(e,t){var n;(0,c.t)(e)||null==(null===(n=e.layer)||void 0===n?void 0:n.objectIdField)||null==e.attributes||(t.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})},target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:function(e){if(null!=e.layerId&&null!=e.objectId)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}}}}};var g=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).position=null,r.elevationInfo=null,r.feature=null,r}return(0,r.Z)(n,[{key:"equals",value:function(e){return(0,c.w)(this.position,e.position)&&(0,c.w)(this.elevationInfo,e.elevationInfo)&&f(this.feature,e.feature)}}]),n}((0,u.u)((0,l.l)(s.y)));(0,s.e)([(0,s.d)({type:v.j}),(0,d.w)()],g.prototype,"position",void 0),(0,s.e)([(0,s.d)({type:p.x}),(0,d.w)()],g.prototype,"elevationInfo",void 0),(0,s.e)([(0,s.d)(y)],g.prototype,"feature",void 0);var m=g=(0,s.e)([(0,s.n)("esri.analysis.LineOfSightAnalysisObserver")],g),_=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).position=null,r.elevationInfo=null,r.feature=null,r}return(0,r.Z)(n,[{key:"equals",value:function(e){return(0,c.w)(this.position,e.position)&&(0,c.w)(this.elevationInfo,e.elevationInfo)&&f(this.feature,e.feature)}}]),n}((0,u.u)(l.a));(0,s.e)([(0,s.d)({type:v.j}),(0,d.w)()],_.prototype,"position",void 0),(0,s.e)([(0,s.d)({type:p.x}),(0,d.w)()],_.prototype,"elevationInfo",void 0),(0,s.e)([(0,s.d)(y)],_.prototype,"feature",void 0);var b=_=(0,s.e)([(0,s.n)("esri.analysis.LineOfSightAnalysisTarget")],_)},80360:function(e,t,n){n.r(t);var i=n(1413),r=n(74165),o=n(15861),a=n(37762),s=n(43144),l=n(15671),u=n(60136),c=n(29388),d=n(23132),v=n(80175),p=n(75610),f=n(2760),h=n(80584),y=n(78674),g=(n(91204),n(86420)),m=n(77470),_=n(36551),b=n(97033),C=n(63022),w=n(78311),O=n(55806),k=n(33898),I=n(78880),T=n(44344),L=n(86148),S=n(58687),V=n(97627),R=n(30917),Z=n(14181),P=n(30709),A=n(64296),E=n(18411),M=n(35773),D=n(40273),z=n(34284),F=n(57952),j=(n(21583),n(43920),n(61340),n(90584),n(84192),n(45332),n(6819),n(90138),n(97566),n(45414),n(57714),n(91309),n(25715),n(96401),n(71573),n(72820),n(80262),n(83262),n(87833),n(2822),n(61349),n(32990),n(38304),n(48889),n(52376),n(6243),n(74021),n(3969),n(94867),n(33703),n(47672),n(50982),n(37783),n(14432),n(56864),n(83024),n(66307),n(36460),n(2157),n(70441),n(16936),n(92870),n(96349),n(44455),n(69953),n(48561),n(60912),n(30604),n(43124),n(50448),n(69797),n(10815),n(55269),n(83822),n(51451),n(50526),n(41742),n(1773),n(77196),n(24980),n(3114),n(22144),n(88370),n(9055),n(79611),n(84538),n(49580),n(54841),n(6794),n(81663),n(83996),n(64004),n(83059),n(4720),n(21523),n(21165),n(21984),n(58394),n(48373),n(61473),n(14946),n(44365),n(98907),n(19967),n(61495),n(33642),n(66156),n(67154),n(96636),n(79054),n(29709),n(47642),n(43782),n(33976),n(10534),n(25459),n(78556),n(25316),n(30664),n(47626),n(77787),n(85511),n(87603),n(22051),n(69202),n(30150),n(77389),n(12158),n(21924),n(46123),n(75777),n(76071),n(42446),n(59819),n(64571),n(34860),n(36638),n(38425),n(72692),n(32568),n(27597),n(1241),n(67417),n(15181),n(28999),n(15612),n(10590),n(19948),n(407),n(28210),n(17436),n(53373),n(94872),n(79042),n(16485),n(92029),n(74575),n(9575),n(53249),n(72763),n(28681),n(38929),n(97866),n(68890),n(31513),n(25838),n(54539),n(50338),n(28623),n(10312),n(95254),n(61099),n(93874),n(62446),n(27264),n(50905),n(78945),n(55827),n(70516),n(25279),n(22268),n(40452),n(60424),n(22225),n(42471),n(78470),n(1665),n(38843),n(24892),n(53647),n(86270),n(71710),function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).innerWidth=2,i.outerWidth=8,i.visibleInnerColor=new y.l([3,252,111,1]),i.visibleOuterColor=new y.l([3,252,111,.15]),i.occludedInnerColor=new y.l([252,3,69,1]),i.occludedOuterColor=new y.l([252,3,69,.1]),i.undefinedInnerColor=new y.l([255,255,255,1]),i.undefinedOuterColor=new y.l([127,127,127,.2]),i}return(0,s.Z)(n)}(d.y));(0,d.e)([(0,d.d)({type:Number})],j.prototype,"innerWidth",void 0),(0,d.e)([(0,d.d)({type:Number})],j.prototype,"outerWidth",void 0),(0,d.e)([(0,d.d)({type:y.l})],j.prototype,"visibleInnerColor",void 0),(0,d.e)([(0,d.d)({type:y.l})],j.prototype,"visibleOuterColor",void 0),(0,d.e)([(0,d.d)({type:y.l})],j.prototype,"occludedInnerColor",void 0),(0,d.e)([(0,d.d)({type:y.l})],j.prototype,"occludedOuterColor",void 0),(0,d.e)([(0,d.d)({type:y.l})],j.prototype,"undefinedInnerColor",void 0),(0,d.e)([(0,d.d)({type:y.l})],j.prototype,"undefinedOuterColor",void 0),j=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightConfiguration")],j);var H=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).target=null,i.intersectedGraphic=null,i.intersectedLocation=null,i.elevationAlignedTargetLocation=null,i.visible=void 0,i}return(0,s.Z)(n)}(d.y);(0,d.e)([(0,d.d)()],H.prototype,"target",void 0),(0,d.e)([(0,d.d)()],H.prototype,"intersectedGraphic",void 0),(0,d.e)([(0,d.d)()],H.prototype,"intersectedLocation",void 0),(0,d.e)([(0,d.d)()],H.prototype,"elevationAlignedTargetLocation",void 0),(0,d.e)([(0,d.d)({type:Boolean})],H.prototype,"visible",void 0),H=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSightAnalysisResult")],H);var x,N=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).elevationAlignedTargetLocation=null,i.inputPoints={isValid:!1,observer:(0,f.n)(),observerSurfaceNormal:null,observerFeatureId:null,target:(0,f.n)(),targetSurfaceNormal:null,targetFeatureId:null,observerAdjusted:(0,f.n)(),targetAdjusted:(0,f.n)()},i.computationResult={start:(0,f.n)(),end:(0,f.n)(),intersection:(0,f.n)(),isValid:!1,isTargetVisible:!1},i.result=null,i}return(0,s.Z)(n,[{key:"notifyResultChanged",value:function(){this.notifyChange("computationResult")}},{key:"notifyInputPointsChanged",value:function(){this.notifyChange("inputPoints")}}]),n}(d.y);(0,d.e)([(0,d.d)()],N.prototype,"target",void 0),(0,d.e)([(0,d.d)()],N.prototype,"elevationAlignedTargetLocation",void 0),(0,d.e)([(0,d.d)()],N.prototype,"inputPoints",void 0),(0,d.e)([(0,d.d)()],N.prototype,"computationResult",void 0),(0,d.e)([(0,d.d)()],N.prototype,"result",void 0),N=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightComputation")],N);var U=x=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){return(0,l.Z)(this,n),t.call(this,e)}return(0,s.Z)(n,[{key:"clone",value:function(){return new x({type:this.type,id:(0,p.m)(this.id),point:(0,p.m)(this.point),normal:(0,p.m)(this.normal),ray:(0,p.m)(this.ray),graphic:this.graphic})}},{key:"equals",value:function(e){return this.type===e.type&&this.id===e.id&&(0,p.w)(this.point,e.point)&&(0,p.k)(this.normal,e.normal)&&(0,O.m)(this.ray,e.ray)&&this.graphic===e.graphic}}]),n}(d.y);(0,d.e)([(0,d.d)()],U.prototype,"type",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],U.prototype,"id",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],U.prototype,"point",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],U.prototype,"normal",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],U.prototype,"graphic",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],U.prototype,"ray",void 0),U=x=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],U);var G=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e))._terrainIntersectionOptionsLayerUids=new Set(["terrain"]),i}return(0,s.Z)(n,[{key:"initialize",value:function(){this.intersector=(0,V.g)(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=V.w.MIN}},{key:"getScreenPointIntersection",value:function(e){var t=(0,I.d)(e,T.t.get()),n=(0,S.aY)(this.view.state.camera,t,K);return this._getRayIntersection(n)}},{key:"_getRayIntersection",value:function(e,t){if((0,p.t)(e)||(0,p.t)(this.view.sceneIntersectionHelper))return null;this.intersector.options.store=V.w.MIN,this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,this.intersector,t);var n=this.intersector.results.min;if(!n.getIntersectionPoint(B))return null;var i=this.view.renderCoordsHelper.fromRenderCoords(B,this.view.spatialReference),r=(0,f.a6)(n.normal);if((0,S.b5)(n))return new U({type:V.A.OBJECT,id:"".concat(n.target.layerUid,"/").concat(n.target.nodeIndex,"/").concat(n.target.componentIndex),point:i,normal:r,ray:(0,O.l)(e),graphic:null});if((0,S.b6)(n))return new U({type:V.A.TERRAIN,id:n.target.lij.slice(),point:i,normal:r,ray:(0,O.l)(e),graphic:null});var o=(0,S.b7)(n,this.view);if((0,p.r)(o)){var a,s=o.layer,l=o.sourceLayer;return a=l&&"scene"===l.type?(0,L.O)(o,l.objectIdField):o.uid,new U({type:V.A.OBJECT,id:"".concat(s.uid,"/").concat(a),point:i,normal:r,ray:(0,O.l)(e),graphic:o})}return null}},{key:"updateFromGroundIntersection",value:function(e,t,n){var i=B,r=W,o=q,a=X,s=J;(0,f.a)(r,e),this.view.renderCoordsHelper.worldUpAtPosition(r,o),(0,f.z)(o,o);var l=this.view.basemapTerrain.elevationBounds,u=this.view.renderCoordsHelper.getAltitude(r),c=l?Math.abs(l.max-l.min):100,d=u>0?1:-1;(0,f.q)(a,o,d*(c+Math.abs(t))),(0,f.u)(i,r,a),(0,O.p)(i,r,K);var v=this._getRayIntersection(K,{include:this._terrainIntersectionOptionsLayerUids});return(0,p.r)(v)&&(0,p.r)(v.point)?(this.view.renderCoordsHelper.toRenderCoords(v.point,s),(0,f.q)(a,o,d*t),(0,f.u)(n,s,a),(0,f.h)(v.normal)):((0,f.a)(n,e),null)}}]),n}(d.y);(0,d.e)([(0,d.d)()],G.prototype,"view",void 0),(0,d.e)([(0,d.d)()],G.prototype,"intersector",void 0),G=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],G);var B=(0,f.n)(),W=(0,f.n)(),q=(0,f.n)(),X=(0,f.n)(),J=(0,f.n)(),K=(0,O.d)(),Q=d.s.getLogger("esri.views.3d.analysis.LineOfSight.LineOfSightController"),Y=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).updateOnCameraChange=!0,i._effectiveObserverElevationMode="absolute-height",i._observerFeatureId=null,i._updatingHandles=new b.c,i._frameTask=Z.Q,i._handles=new m.u,i._computationHandles=new m.u,i._externalObserverUpdate=!0,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e,t=null===(e=this.view.resourceController)||void 0===e?void 0:e.scheduler;this._frameTask=t?t.registerTask(Z.L.LINE_OF_SIGHT_TOOL):Z.Q,this._intersector=new G({view:this.view}),this._handles.add([this._connectObserver(),this._connectComputations(),this._connectTargets()])}},{key:"destroy",value:function(){this._handles.destroy(),this._computationHandles.destroy(),this._computations.removeAll(),this._updatingHandles.destroy()}},{key:"updating",get:function(){return this._frameTask.updating||this._updatingHandles.updating}},{key:"priority",get:function(){return this._frameTask.priority},set:function(e){this._frameTask.priority=e}},{key:"_computations",get:function(){return this.analysisViewData.computations}},{key:"_elevationAlignedObserverPositionRenderSpace",get:function(){return this.analysisViewData.observerEngineLocation},set:function(e){this.analysisViewData.observerEngineLocation=e}},{key:"_screenPixelSize",get:function(){return this.view.state.camera.computeScreenPixelSizeAt(this._elevationAlignedObserverPositionRenderSpace)}},{key:"getLineOfSightComputationDependencies",value:function(e){return{inputPoints:e.inputPoints}}},{key:"_computeResult",value:function(e){var t=e.computation,n=t.inputPoints,i=t.computationResult,r=n.observerAdjusted,o=n.targetAdjusted,a=i.start,s=i.end;(0,f.a)(a,r),(0,f.a)(s,o),this._canCompute(t)?this._computeIntersection(e):this._interpolateIntersection(e),t.notifyResultChanged(),this.emit("result-changed",{target:e.computation.target,result:t.result})}},{key:"_updateAdjustedPointsFromFeatures",value:function(e){var t=this.view,n=t.sceneIntersectionHelper,i=e.inputPoints,r=i.observerAdjusted,o=i.observerFeatureId,s=i.targetFeatureId,l=i.targetAdjusted;if(!(0,p.t)(o)||!(0,p.t)(s)){var u=(0,f.x)(r,l),c=this._intersector.intersector,d=(0,O.p)(i.observer,i.target,te);c.options.store=V.w.ALL,n.intersectToolIntersectorRay(d,c);var v,h=null,y=null,m=null,_=null,b=(0,a.Z)(c.results.all);try{for(b.s();!(v=b.n()).done;){var C=v.value,w=(0,S.b7)(C,this.view);if(!(0,p.t)(w)&&!(0,p.t)(C.distanceInRenderSpace)){var k=(0,g.l)(w);(0,p.t)(k)||((0,p.r)(o)&&k===o&&((0,p.t)(h)&&(h=this._getFeatureDistanceThreshold(C,t,u)),C.distanceInRenderSpace<h&&(m=C)),(0,p.r)(s)&&k===s&&((0,p.t)(y)&&(y=this._getFeatureDistanceThreshold(C,t,u)),(0,p.t)(_)&&C.distanceInRenderSpace<u&&u-C.distanceInRenderSpace<y&&(_=C)))}}}catch(I){b.e(I)}finally{b.f()}(0,p.r)(m)&&m.getIntersectionPoint(r)&&(i.observerSurfaceNormal=m.getTransformedNormal((0,f.n)())),(0,p.r)(_)&&_.getIntersectionPoint(l)&&(i.targetSurfaceNormal=_.getTransformedNormal((0,f.n)()))}}},{key:"_getFeatureDistanceThreshold",value:function(e,t,n){if((0,S.b8)(e)){var i=(0,S.b9)(e,t);if((0,p.r)(i))return Math.min(i*ie,n)}return 1e-5*n}},{key:"_adjustStartEndPositions",value:function(e){var t=this._screenPixelSize,n=this.view,i=e.inputPoints,r=i.observer,o=i.observerSurfaceNormal,a=i.target,s=i.targetSurfaceNormal,l=i.observerAdjusted,u=i.targetAdjusted,c=ee;(0,f.a)(l,r),(0,f.a)(u,a),this._updateAdjustedPointsFromFeatures(e),(0,p.r)(o)?(0,f.a)(c,o):(0,f.e)(c,u,l);var d=t;(0,f.z)(c,c),(0,f.q)(c,c,Math.min(d,1)),(0,f.u)(l,l,c),(0,p.r)(s)?(0,f.a)(c,s):(0,f.e)(c,l,u);var v=n.state.camera.computeScreenPixelSizeAt(u);(0,f.z)(c,c),(0,f.q)(c,c,Math.min(v,1)),(0,f.u)(u,u,c)}},{key:"_computeIntersection",value:function(e){var t=e.computation,n=e.interpolationInfo,i=this.view,r=i.sceneIntersectionHelper,o=i.renderCoordsHelper;if(!(0,p.t)(r)){var a=this._intersector.intersector,s=t.computationResult,l=t.inputPoints,u=l.observer,c=l.target,d=s.start,v=s.end,h=(0,O.p)(d,v,te);a.options.store=V.w.MIN,r.intersectToolIntersectorRay(h,a);var y=a.results.min,g=s.intersection,m=ee,_=!0;if((0,p.r)(y)&&y.getIntersectionPoint(g)){(0,f.a)(n.originalIntersection,g),(0,f.a)(n.originalObserver,d),(0,f.a)(n.originalTarget,v),o.fromRenderCoords(g,m,i.spatialReference);var b=1-(0,f.U)(v,c)/(0,f.U)(d,c);_=(0,f.U)(u,g)>=b*(0,f.U)(u,c)}var C=new P.j(m,i.spatialReference),w=t.result,k=t.target;(0,p.r)(w)?(w.target=k,w.intersectedGraphic=_?null:(0,S.b7)(y,i),w.intersectedLocation=_?null:C,w.visible=_):t.result=new H({target:k,elevationAlignedTargetLocation:t.elevationAlignedTargetLocation,intersectedGraphic:_?null:(0,S.b7)(y,i),intersectedLocation:_?null:C,visible:_}),s.isValid=l.isValid=!0,s.isTargetVisible=_}}},{key:"_interpolateIntersection",value:function(e){var t=e.computation,n=e.interpolationInfo,i=t.computationResult,r=t.inputPoints,o=i.start,a=i.end,s=i.intersection,l=n.originalIntersection,u=n.originalObserver,c=n.originalTarget;if((0,f.a)(s,l),r.isValid){var d=ee,v=(0,f.U)(u,l)/(0,f.U)(u,c);(0,f.a1)(d,o,u),(0,f.q)(d,d,1-v),(0,f.u)(s,s,d),(0,f.a1)(d,a,c),(0,f.q)(d,d,v),(0,f.u)(s,s,d),i.isValid=!0}else t.result=null,i.isValid=!1,i.isTargetVisible=!1}},{key:"_canCompute",value:function(e){var t=this.analysisViewData.elevationAlignedObserver,n=this.view.frustum;if((0,p.t)(t)||(0,p.t)(e.elevationAlignedTargetLocation)||(0,p.t)(n))return!1;var i=e.inputPoints,r=i.observerAdjusted,o=i.targetAdjusted,a=n.intersectsPoint(r),s=n.intersectsPoint(o);return a&&s}},{key:"_onObserverPositionChange",value:function(e,t,n,i,r){if(this._externalObserverUpdate=r,(0,p.t)(e))return this.analysisViewData.elevationAlignedObserver=null,void(this._observerFeatureId=null);if((0,p.t)(t))return(0,R.a)(this.analysis,e.spatialReference,Q),void(this.analysisViewData.elevationAlignedObserver=null);var o=this._getEffectiveElevationInfo(t,n),a=(0,k.d)(t.x,t.y,t.z,this.view.spatialReference,this.view,o),s=a.absoluteZ,l=a.elevation,u=t.clone();u.z=s,this._effectiveObserverElevationMode=o.mode,this.analysisViewData.elevationAlignedObserver=u;var c=(0,f.n)();this.view.renderCoordsHelper.toRenderCoords(u,c),this._elevationAlignedObserverPositionRenderSpace=c,this._observerGroundOffsetRenderSpace=s-l,this._observerFeatureId=(0,g.l)(i),this.priority=Z.L.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_onObserverRenderSpacePositionChangeForComputation",value:function(e,t,n,i,r){var o=e.inputPoints;switch((0,f.a)(o.observer,t),o.observerFeatureId=r,o.observerSurfaceNormal=null,i){case"on-the-ground":case"relative-to-ground":var a=this._intersector.updateFromGroundIntersection(o.observer,n,o.observer);(0,p.t)(o.observerFeatureId)&&(o.observerSurfaceNormal=a)}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=Z.L.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_onTargetPositionChange",value:function(e,t,n,i,r){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=e.inputPoints;if(o&&(a.isValid=!1),(0,p.t)(n))return(0,p.r)(t)&&(0,R.a)(this.analysis,t.spatialReference,Q),e.elevationAlignedTargetLocation=null,void e.notifyInputPointsChanged();var s=this._getEffectiveElevationInfo(n,i),l=(0,k.d)(n.x,n.y,n.z,this.view.spatialReference,this.view,s),u=l.absoluteZ,c=l.elevation,d=n.clone();switch(d.z=u,e.elevationAlignedTargetLocation=d,this.view.renderCoordsHelper.toRenderCoords(e.elevationAlignedTargetLocation,a.target),a.targetFeatureId=(0,g.l)(r),a.targetSurfaceNormal=null,s.mode){case"on-the-ground":case"relative-to-ground":var v=this._intersector.updateFromGroundIntersection(a.target,u-c,a.target);(0,p.t)(a.targetFeatureId)&&(a.targetSurfaceNormal=v)}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=Z.L.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_connectComputationToTarget",value:function(e){var t=this;return(0,d.h)([(0,_.l)((function(){return{computation:e,targetPosition:e.target.position,targetElevationInfo:e.target.elevationInfo,targetFeatureInfo:e.target.feature,projectedTargetPosition:(0,C.u)(e.target.position,t.view.spatialReference)}}),(function(e){var n=e.computation,i=e.targetPosition,r=e.targetElevationInfo,o=e.targetFeatureInfo,a=e.projectedTargetPosition;(0,p.r)(a.pending)?t._updatingHandles.addPromise(a.pending):t._onTargetPositionChange(n,i,a.geometry,r,o)}),_.w)])}},{key:"_connectComputationToObserver",value:function(e){var t=this;return(0,_.l)((function(){return{computation:e,observer:t.analysisViewData.elevationAlignedObserver}}),(function(e){var n=e.computation;t._externalObserverUpdate&&(n.inputPoints.isValid=!1,n.notifyInputPointsChanged())}),_.w)}},{key:"_connectComputationToRenderSpaceObserver",value:function(e){var t=this;return(0,_.l)((function(){return{computation:e,observer:t._elevationAlignedObserverPositionRenderSpace,observerGroundOffset:t._observerGroundOffsetRenderSpace,observerElevationMode:t._effectiveObserverElevationMode,observerFeatureId:t._observerFeatureId}}),(function(e){var n=e.computation,i=e.observer,r=e.observerGroundOffset,o=e.observerElevationMode,a=e.observerFeatureId;t._onObserverRenderSpacePositionChangeForComputation(n,i,r,o,a)}),_.w)}},{key:"_connectComputationToCamera",value:function(e){var t=this;return(0,_.l)((function(){return{camera:t.view.state.camera,isDirty:t._isCameraDirty}}),(function(n){var i=n.isDirty;!t.updateOnCameraChange||e.inputPoints.isValid&&!i||e.notifyInputPointsChanged()}),_.U)}},{key:"_connectComputationToSlicePlane",value:function(e){var t=this;return(0,_.l)((function(){return t.view.slicePlane}),(function(){e.inputPoints.isValid=!1,e.notifyInputPointsChanged()}))}},{key:"_connectComputationToElevation",value:function(e){var t=this,n=function n(i,r){var o=t.analysis.observer,a=e.target,s=null,l=null,u=null,c=null,d=null,v=null;if((0,p.r)(o)&&(0,p.r)(o.position)){var f=(0,C.u)(o.position,t.view.spatialReference);if((0,p.r)(f.pending))return t._updatingHandles.addPromise(f.pending),void f.pending.finally((function(){return n(i,r)}));s=f.geometry,l=o.elevationInfo,u=o.feature}if((0,p.r)(a.position)){var h=(0,C.u)(a.position,t.view.spatialReference);if((0,p.r)(h.pending))return t._updatingHandles.addPromise(h.pending),void h.pending.finally((function(){return n(i,r)}));c=h.geometry,d=a.elevationInfo,v=a.feature}(0,p.t)(s)&&(0,p.t)(c)||((0,C.z)(i,r,ne,t.view.spatialReference),(0,p.r)(s)&&(0,w.F)(ne,s)&&t._onObserverPositionChange((0,p.r)(o)?o.position:null,s,l,u,!1),(0,p.r)(c)&&(0,w.F)(ne,c)&&t._onTargetPositionChange(e,a.position,c,d,v,!1),(0,p.r)(s)&&(0,p.r)(c)&&(0,w.j)(ne,s,c)&&e.notifyInputPointsChanged())};return this.view.elevationProvider.on("elevation-change",(function(e){return n(e.extent,e.spatialReference)}))}},{key:"_connectComputationToTask",value:function(e){var t=this,n=p.L,i={computation:e,interpolationInfo:{originalIntersection:(0,f.n)(),originalObserver:(0,f.n)(),originalTarget:(0,f.n)()}};return(0,d.h)([(0,_.l)((function(){return t.getLineOfSightComputationDependencies(e)}),(function(){n=(0,p.C)(n),n=(0,d.al)(function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.a9)(t._frameTask.schedule((function(){return t._computeResult(i)}),n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),{sync:!0,initial:!0,equals:p.f}),(0,d.g)((function(){return n=(0,p.C)(n)}))])}},{key:"_connectComputation",value:function(e){var t=this._computationHandles;t.has(e)||t.add([this._connectComputationToTarget(e),this._connectComputationToObserver(e),this._connectComputationToRenderSpaceObserver(e),this._connectComputationToCamera(e),this._connectComputationToSlicePlane(e),this._connectComputationToElevation(e),this._connectComputationToTask(e)],e)}},{key:"_disconnectComputation",value:function(e){this._computationHandles.remove(e)}},{key:"_onComputationCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,a.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(c){r.e(c)}finally{r.f()}var s,l=(0,a.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._connectComputation(u)}}catch(c){l.e(c)}finally{l.f()}}},{key:"_onTargetCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,a.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._removeTarget(o)}}catch(c){r.e(c)}finally{r.f()}var s,l=(0,a.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._addTarget(u)}}catch(c){l.e(c)}finally{l.f()}}},{key:"_onCursorTargetChange",value:function(e,t){(0,p.r)(t)&&this._removeTarget(t),(0,p.r)(e)&&this._addTarget(e)}},{key:"_addTarget",value:function(e){this._computations.some((function(t){return t.target===e}))||this._computations.add(new N({target:e}))}},{key:"_removeTarget",value:function(e){var t=this._computations.findIndex((function(t){return t.target===e}));this._computations.removeAt(t)}},{key:"_connectObserver",value:function(){var e=this;return(0,d.h)([(0,_.l)((function(){return{observerPosition:(0,p.r)(e.analysis.observer)?e.analysis.observer.position:null,projectedObserverPosition:(0,C.u)((0,p.r)(e.analysis.observer)?e.analysis.observer.position:null,e.view.spatialReference),observerElevationInfo:(0,p.r)(e.analysis.observer)?e.analysis.observer.elevationInfo:null,observerFeatureInfo:(0,p.r)(e.analysis.observer)?e.analysis.observer.feature:null}}),(function(t){var n=t.observerPosition,i=t.projectedObserverPosition,r=t.observerElevationInfo,o=t.observerFeatureInfo;(0,p.r)(i.pending)?e._updatingHandles.addPromise(i.pending):e._onObserverPositionChange(n,i.geometry,r,o,!0)}),_.w)])}},{key:"_connectComputations",value:function(){var e=this;return(0,_.a)((function(){return e._computations}),"change",(function(t){return e._onComputationCollectionChange(t)}),{onListenerAdd:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._connectComputation(r)}}catch(o){i.e(o)}finally{i.f()}},onListenerRemove:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._disconnectComputation(r)}}catch(o){i.e(o)}finally{i.f()}},sync:!0})}},{key:"_connectTargets",value:function(){var e=this;return(0,d.h)([this._updatingHandles.addOnCollectionChange((function(){return e.analysis.targets}),(function(t){return e._onTargetCollectionChange(t)}),{initial:!0,final:!0}),(0,_.l)((function(){return e.analysisViewData.cursorTarget}),(function(t,n){e._onCursorTargetChange(t,n)}))])}},{key:"_isCameraDirty",get:function(){var e=this.analysisViewData.elevationAlignedObserver,t=this.view,n=t.renderCoordsHelper;if((0,p.t)(e)||(0,p.t)(n))return!1;var i=ee;n.toRenderCoords(e,i);var r=t.state.camera.computeScreenPixelSizeAt(i);return Math.abs((r-this._screenPixelSize)/this._screenPixelSize)>$}},{key:"_getEffectiveElevationInfo",value:function(e,t){return e.hasZ?(0,p.n)(t,{mode:"absolute-height",offset:0}):{mode:"on-the-ground",offset:0}}}]),n}(v.n.EventedMixin(d.y));(0,d.e)([(0,d.d)({constructOnly:!0})],Y.prototype,"analysis",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],Y.prototype,"analysisViewData",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],Y.prototype,"view",void 0),(0,d.e)([(0,d.d)()],Y.prototype,"updating",null),(0,d.e)([(0,d.d)()],Y.prototype,"priority",null),(0,d.e)([(0,d.d)()],Y.prototype,"updateOnCameraChange",void 0),(0,d.e)([(0,d.d)()],Y.prototype,"_computations",null),(0,d.e)([(0,d.d)()],Y.prototype,"_elevationAlignedObserverPositionRenderSpace",null),(0,d.e)([(0,d.d)()],Y.prototype,"_observerGroundOffsetRenderSpace",void 0),(0,d.e)([(0,d.d)()],Y.prototype,"_effectiveObserverElevationMode",void 0),(0,d.e)([(0,d.d)()],Y.prototype,"_observerFeatureId",void 0),(0,d.e)([(0,d.d)()],Y.prototype,"_screenPixelSize",null),(0,d.e)([(0,d.d)({readOnly:!0})],Y.prototype,"_updatingHandles",void 0),(0,d.e)([(0,d.d)()],Y.prototype,"_frameTask",void 0),(0,d.e)([(0,d.d)()],Y.prototype,"_isCameraDirty",null),Y=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightController")],Y);var $=.1,ee=(0,f.n)(),te=(0,O.d)(),ne=(0,w.D)(),ie=.05,re=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).enabled=!0,i.glowColor=new y.l([255,127,0]),i.glowWidth=8,i.innerColor=new y.l([255,255,255]),i.innerWidth=.75,i.globalAlpha=.75,i}return(0,s.Z)(n)}(d.y);(0,d.e)([(0,d.d)({type:Boolean})],re.prototype,"enabled",void 0),(0,d.e)([(0,d.d)({type:y.l})],re.prototype,"glowColor",void 0),(0,d.e)([(0,d.d)({type:Number})],re.prototype,"glowWidth",void 0),(0,d.e)([(0,d.d)({type:y.l})],re.prototype,"innerColor",void 0),(0,d.e)([(0,d.d)({type:Number})],re.prototype,"innerWidth",void 0),(0,d.e)([(0,d.d)({type:Number})],re.prototype,"globalAlpha",void 0),re=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightLaserLineConfiguration")],re);var oe=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).size=.5,i.color=new y.l([255,127,0,.75]),i}return(0,s.Z)(n)}(d.y);(0,d.e)([(0,d.d)({type:Number})],oe.prototype,"size",void 0),(0,d.e)([(0,d.d)({type:y.l})],oe.prototype,"color",void 0),oe=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightObserverConfiguration")],oe);var ae=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).size=.5,i.visibleColor=new y.l([3,252,111,.75]),i.occludedColor=new y.l([252,3,69,.75]),i.undefinedColor=new y.l([127,127,127,.75]),i}return(0,s.Z)(n)}(d.y);(0,d.e)([(0,d.d)({type:Number})],ae.prototype,"size",void 0),(0,d.e)([(0,d.d)({type:y.l})],ae.prototype,"visibleColor",void 0),(0,d.e)([(0,d.d)({type:y.l})],ae.prototype,"occludedColor",void 0),(0,d.e)([(0,d.d)({type:y.l})],ae.prototype,"undefinedColor",void 0),ae=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTargetConfiguration")],ae);var se=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).innerWidth=2,i.outerWidth=8,i.visibleInnerColor=new y.l([3,252,111,1]),i.visibleOuterColor=new y.l([3,252,111,.15]),i.occludedInnerColor=new y.l([252,3,69,1]),i.occludedOuterColor=new y.l([252,3,69,.1]),i.undefinedInnerColor=new y.l([255,255,255,1]),i.undefinedOuterColor=new y.l([127,127,127,.2]),i}return(0,s.Z)(n)}(d.y);(0,d.e)([(0,d.d)({type:Number})],se.prototype,"innerWidth",void 0),(0,d.e)([(0,d.d)({type:Number})],se.prototype,"outerWidth",void 0),(0,d.e)([(0,d.d)({type:y.l})],se.prototype,"visibleInnerColor",void 0),(0,d.e)([(0,d.d)({type:y.l})],se.prototype,"visibleOuterColor",void 0),(0,d.e)([(0,d.d)({type:y.l})],se.prototype,"occludedInnerColor",void 0),(0,d.e)([(0,d.d)({type:y.l})],se.prototype,"occludedOuterColor",void 0),(0,d.e)([(0,d.d)({type:y.l})],se.prototype,"undefinedInnerColor",void 0),(0,d.e)([(0,d.d)({type:y.l})],se.prototype,"undefinedOuterColor",void 0);var le,ue,ce=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).laserLine=new re,i.observer=new oe,i.target=new ae,i.lineOfSight=new se,i}return(0,s.Z)(n)}(d.y);function de(e,t,n){return{geometry:S.T.createSphereGeometry(e,32,32),material:(0,M.w)(y.l.toUnitRGBA(t)),stateMask:n}}function ve(e){var t=[];return e.customColor1&&t.push(de(e.size,e.customColor1,D.X.Custom1)),e.customColor2&&t.push(de(e.size,e.customColor2,D.X.Custom2)),e.customColor3&&t.push(de(e.size,e.customColor3,D.X.Custom3)),e.color&&t.push(de(e.size,e.color)),t}function pe(e,t){var n=ve(t),i=new M.t({view:e,renderObjects:n,elevationInfo:{mode:"absolute-height",offset:0}});return function(e,t){var n=null,i=e.events.on("grab-changed",(function(i){(0,p.r)(n)&&(n.remove(),n=null),"start"===i.action?(n=e.disableDisplay(),t&&t(i)):t&&t(i)}))}(i),i}(0,d.e)([(0,d.d)({type:re})],ce.prototype,"laserLine",void 0),(0,d.e)([(0,d.d)({type:oe})],ce.prototype,"observer",void 0),(0,d.e)([(0,d.d)({type:ae})],ce.prototype,"target",void 0),(0,d.e)([(0,d.d)({type:se})],ce.prototype,"lineOfSight",void 0),ce=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightToolConfiguration")],ce),(ue=le||(le={})).Ready="ready",ue.Creating="creating",ue.Created="created",v.j.ofType(g.f);var fe=d.s.getLogger("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool"),he=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).preferManipulatorCursor=!0,i.removeIncompleteOnCancel=!1,i.configuration=new ce,i.analysisViewData=null,i._laserlineVisualElement=null,i._grabbedManipulator=null,i._analysisHandles=new m.u,i._handles=new m.u,i._manipulatorHandles=new m.u,i._targetTrackerManipulator=null,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this._intersector=new G({view:this.view}),this._handles.add((0,_.l)((function(){return e.state}),(function(t){t===le.Created&&e.finishToolCreation()}),_.w)),this._observerManipulator=this._createObserverManipulator(),this._handles.add([(0,_.l)((function(){return(0,i.Z)({},e.configuration.observer)}),(function(){return e._updateObserverManipulatorStyle()}),_.U),(0,_.l)((function(){return e.analysisViewData.elevationAlignedObserver}),(function(t){return e._onObserverLocationChange(t)}),_.w),(0,_.l)((function(){return(0,i.Z)({},e.configuration.laserLine)}),(function(){return e._createVisualElements()}),_.w),(0,_.l)((function(){return e._laserLineRendererDependencies()}),(function(t){return e._updateLaserLineRenderer(t)})),this._connectComputations()])}},{key:"destroy",value:function(){this._handles=(0,p.l)(this._handles),this._manipulatorHandles=(0,p.l)(this._manipulatorHandles),this._analysisHandles=(0,p.l)(this._analysisHandles),this._observerManipulator=null,this._clearCursorTracker(),this._removeVisualElements(),this._intersector=null,this._set("analysis",null)}},{key:"state",get:function(){return this.active?(0,p.r)(this._grabbedManipulator)?le.Created:le.Creating:(0,p.r)(this.analysis.observer)&&(0,p.r)(this.analysis.observer.position)?le.Created:le.Ready}},{key:"cursor",get:function(){return this.active&&this._showTracker?"crosshair":null}},{key:"updating",get:function(){return!!(0,p.r)(this.analysisViewData)&&this.analysisViewData.updating}},{key:"_showTracker",get:function(){return this.active&&"mouse"===this._latestPointerMovePointerType}},{key:"_shouldRenderTracker",get:function(){return this._showTracker&&(0,p.r)(this.analysis.observer)&&(0,p.r)(this.analysis.observer.position)&&!this.hasFocusedManipulators}},{key:"continue",value:function(){this.view.activeTool=this}},{key:"stop",value:function(){this.view.activeTool=null}},{key:"onEditableChange",value:function(){this.analysisViewData.editable=this.internallyEditable}},{key:"onInputEvent",value:function(e){switch(e.type){case"immediate-double-click":this._doubleClickHandler(e);break;case"key-down":this._keyDownHandler(e);break;case"pointer-move":this._pointerMoveHandler(e)}}},{key:"onInputEventAfter",value:function(e){"immediate-click"===e.type&&this._clickHandler(e)}},{key:"onShow",value:function(){}},{key:"onHide",value:function(){this._grabbedManipulator=null}},{key:"onDeactivate",value:function(){this._clearCursorTracker()}},{key:"_connectComputations",value:function(){var e=this;return(0,_.a)((function(){return e.analysisViewData.computations}),"change",(function(t){return e._onComputationsCollectionChange(t)}),{onListenerAdd:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._connectComputation(r)}}catch(o){i.e(o)}finally{i.f()}},onListenerRemove:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._disconnectComputation(r)}}catch(o){i.e(o)}finally{i.f()}},sync:!0})}},{key:"_onComputationsCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,a.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(c){r.e(c)}finally{r.f()}var s,l=(0,a.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._connectComputation(u)}}catch(c){l.e(c)}finally{l.f()}}},{key:"_connectComputation",value:function(e){var t=this;if(this.destroyed)fe.warn("Attempting to connect an analysis to a destroyed LineOfSight tool. Ignoring.");else{var n=this._analysisHandles;if(!n.has(e)){var i=this._createTargetManipulator(e.target);(0,p.t)(this._targetTrackerManipulator)&&i.metadata.target===this.analysisViewData.cursorTarget&&(this._targetTrackerManipulator=i,this._targetTrackerManipulator.available=!1,this._targetTrackerManipulator.interactive=!1,this._updateLaserLineRenderer()),n.add([(0,_.l)((function(){return t._getLineOfSightManipulatorStateDependencies(e)}),(function(){return t._updateManipulatorState(i,e)}),_.w),(0,_.l)((function(){return e.elevationAlignedTargetLocation}),(function(e){return t._onTargetLocationChange(e,i)}),_.w)],e)}}}},{key:"_disconnectComputation",value:function(e){if(this.destroyed)fe.warn("Attempting to disconnect an analysis from a destroyed LineOfSight tool. Ignoring.");else{this._analysisHandles.remove(e);var t=this._getTargetManipulator(e.target);(0,p.r)(t)&&(this.manipulators.remove(t),this._manipulatorHandles.remove(t),(0,p.r)(this._targetTrackerManipulator)&&this._targetTrackerManipulator===t&&(this._targetTrackerManipulator=null))}}},{key:"_clearCursorTracker",value:function(){this.analysisViewData.cursorTarget=(0,p.l)(this.analysisViewData.cursorTarget)}},{key:"_createManipulator",value:function(e,t,n){var i=this,r=pe(this.view,e);return r.metadata=n,this._manipulatorHandles.add([t(r),r.events.on("grab-changed",(function(e){return i._manipulatorGrabChanged(r,e)})),r.events.on("immediate-click",(function(e){return i._manipulatorClick(r,e)}))],r),this.manipulators.add(r),r}},{key:"_createTargetManipulator",value:function(e){var t=this,n=this.configuration,i={size:n.target.size,customColor1:n.target.visibleColor,customColor2:n.target.occludedColor,customColor3:n.target.undefinedColor,visible:!0},r={target:e,type:"target"},o=this._createManipulator(i,(function(e){return t._createTargetManipulatorDragPipeline(e)}),r);return(0,p.r)(e.position)?o.elevationAlignedLocation=e.position:o.available=!1,o}},{key:"_getTargetManipulator",value:function(e){var t=null;return this.manipulators.forEach((function(n){var i=n.manipulator;(0,p.t)(t)&&"target"===i.metadata.type&&i.metadata.target===e&&(t=i)})),t}},{key:"_createObserverManipulator",value:function(){var e=this,t=this.configuration,n={size:t.observer.size,color:t.observer.color,visible:!0};return this._createManipulator(n,(function(t){return e._createObserverManipulatorDragPipeline(t)}),{type:"observer",intersection:null})}},{key:"_updateObserverManipulatorStyle",value:function(){var e=this._observerManipulator,t=this.configuration.observer,n={size:t.size,color:t.color,visible:e.available};e.renderObjects=ve(n)}},{key:"_screenToIntersection",value:function(){var e=this;return function(t){var n=e._intersector.getScreenPointIntersection(t.screenEnd);return(0,p.t)(n)?null:(0,i.Z)((0,i.Z)({},t),{},{intersection:n})}}},{key:"_createTargetManipulatorDragPipeline",value:function(e){var t=this;return(0,M.p)(e,(function(n,i,r){i.next(t._screenToIntersection()).next(t._updateTargetDragStep(e)).next((function(){return t._updateLaserLineRenderer()})),r.next(t._cancelTargetDragStep(e.metadata.target)).next((function(){return t._updateLaserLineRenderer()}))}))}},{key:"_createObserverManipulatorDragPipeline",value:function(e){var t=this;return(0,M.p)(e,(function(e,n,i){n.next(t._screenToIntersection()).next(t._updateObserverDragStep()).next((function(){return t._updateLaserLineRenderer()})),i.next(t._cancelObserverDragStep()).next((function(){return t._updateLaserLineRenderer()}))}))}},{key:"_updateObserverDragStep",value:function(){var e=this;return function(t){return(0,p.r)(t.intersection.point)?((0,p.t)(e.analysis.observer)&&(e.analysis.observer=new g.u),e._updateFromIntersection(e.analysis.observer,t.intersection)):e.analysis.observer=null,t}}},{key:"_cancelObserverDragStep",value:function(){var e=this,t=(0,p.r)(this.analysis.observer)&&(0,p.r)(this.analysis.observer.position)?this.analysis.observer.clone():null;return function(n){return e.analysis.observer=t,n}}},{key:"_updateTargetDragStep",value:function(e){var t=this;return function(n){t._updateFromIntersection(e.metadata.target,n.intersection);var i=n.intersection.point;return(0,p.r)(i)&&(e.elevationAlignedLocation=i),n}}},{key:"_cancelTargetDragStep",value:function(e){var t=(0,p.h)(e.position,(function(e){return e.clone()}));return function(n){return e.position=t,n}}},{key:"_manipulatorGrabChanged",value:function(e,t){switch(t.action){case"start":this._grabbedManipulator=e;break;case"end":this._grabbedManipulator===e&&(this._grabbedManipulator=null)}}},{key:"_updateManipulatorState",value:function(e,t){var n=t.computationResult,i=n.isValid,r=n.isTargetVisible;e.state=i?r?D.X.Custom1:D.X.Custom2:D.X.Custom3}},{key:"_getLineOfSightManipulatorStateDependencies",value:function(e){var t=e.computationResult;return{isValid:t.isValid,isTargetVisible:t.isTargetVisible}}},{key:"_laserLineRendererDependencies",value:function(){return{laserlineVisualElement:this._laserlineVisualElement,grabbedManipulator:this._grabbedManipulator,shouldRenderTracker:this._shouldRenderTracker,observerPosition:(0,p.r)(this.analysis.observer)?this.analysis.observer.position:null,visible:this.visible}}},{key:"_updateLaserLineRenderer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._laserLineRendererDependencies(),t=e.laserlineVisualElement,n=e.grabbedManipulator,i=e.shouldRenderTracker,r=e.observerPosition,o=e.visible;if(!(0,p.t)(t)){var a=(0,p.r)(n)?n:i&&(0,p.r)(r)?this._targetTrackerManipulator:null;this.configuration.laserLine.enabled&&(0,p.r)(a)&&o?(t.visible=!0,t.heightManifoldTarget=a.renderLocation,a!==this._observerManipulator?t.lineVerticalPlaneSegment=(0,A.l)(this._observerManipulator.renderLocation,a.renderLocation,ye):t.lineVerticalPlaneSegment=null):(t.visible=!1,t.heightManifoldTarget=null,t.lineVerticalPlaneSegment=null)}}},{key:"_createVisualElements",value:function(){var e=this.configuration.laserLine;this._removeVisualElements(),this._laserlineVisualElement=new z._({view:this.view,attached:!0,visible:this.visible,style:{glowColor:y.l.toUnitRGB(e.glowColor),glowWidth:e.glowWidth,innerColor:y.l.toUnitRGB(e.innerColor),innerWidth:e.innerWidth,globalAlpha:e.globalAlpha}})}},{key:"_removeVisualElements",value:function(){(0,p.r)(this._laserlineVisualElement)&&(this._laserlineVisualElement.destroy(),this._laserlineVisualElement=null)}},{key:"_onObserverLocationChange",value:function(e){(0,p.t)(e)?this._observerManipulator.available=!1:(this._observerManipulator.metadata.intersection=null,this._observerManipulator.available=!0,this._observerManipulator.elevationAlignedLocation=e)}},{key:"_onTargetLocationChange",value:function(e,t){(0,p.r)(e)?(t.elevationAlignedLocation=e,t!==this._targetTrackerManipulator&&(t.available=!0)):t.available=!1}},{key:"_addPointFromClickEvent",value:function(e){var t=this._intersector.getScreenPointIntersection(e);if(!(0,p.t)(t)&&!(0,p.t)(t.point))if((0,p.r)(this.analysis.observer)&&(0,p.r)(this.analysis.observer.position)){this._clearCursorTracker();var n=new g.f;this._updateFromIntersection(n,t),this.analysis.targets.add(n)}else{var i=new g.u;this._updateFromIntersection(i,t),this.analysis.observer=i}}},{key:"_clickHandler",value:function(e){this.active&&e.button!==D.a3.Right&&(this._addPointFromClickEvent((0,D.a4)(e)),e.stopPropagation())}},{key:"_doubleClickHandler",value:function(e){this.active&&e.button!==D.a3.Right&&(this.stop(),e.stopPropagation())}},{key:"_keyDownHandler",value:function(e){this.active&&"Escape"===e.key&&(this.stop(),e.stopPropagation())}},{key:"_pointerMoveHandler",value:function(e){if(!this.hasFocusedManipulators&&(this._latestPointerMovePointerType=e.pointerType,this._updateLaserLineRenderer(),this._showTracker&&!(0,p.t)(this.analysis.observer)&&!(0,p.t)(this.analysis.observer.position))){var t=(0,D.a4)(e),n=this._intersector.getScreenPointIntersection(t);(0,p.r)(n)&&(0,p.r)(n.point)&&((0,p.t)(this.analysisViewData.cursorTarget)&&(this.analysisViewData.cursorTarget=new g.f),this._updateFromIntersection(this.analysisViewData.cursorTarget,n),this._updateLaserLineRenderer())}}},{key:"_updateFromIntersection",value:function(e,t){if((0,p.t)(t.point))return e.position=null,e.elevationInfo=null,void(e.feature=null);switch(t.type){case V.A.OBJECT:if((0,p.r)(t.graphic)){var n=t.graphic,i=(0,k.u)(n);"on-the-ground"===i.mode&&(i.mode="relative-to-ground",i.offset=0),e.elevationInfo=new E.x(i),e.feature=n}else e.elevationInfo=null,e.feature=null;break;case V.A.TERRAIN:case V.A.I3S:e.elevationInfo=new E.x({mode:"on-the-ground"}),e.feature=null;break;default:e.elevationInfo=null,e.feature=null}var r=t.point.clone();r.z=(0,k.f)(this.view,r,{mode:"absolute-height",offset:0},e.elevationInfo),e.position=r}},{key:"_manipulatorClick",value:function(e,t){if(!("observer"===e.metadata.type||e.grabbing||e.dragging||t.button!==D.a3.Right||this.analysis.targets.length<=1)){var n=e.metadata.target;this.analysis.targets.remove(n),t.stopPropagation()}}},{key:"testInfo",get:function(){return{laserLineVisualElement:this._laserlineVisualElement}}}]),n}(M.a);(0,d.e)([(0,d.d)({constructOnly:!0})],he.prototype,"view",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],he.prototype,"analysis",void 0),(0,d.e)([(0,d.d)({readOnly:!0})],he.prototype,"state",null),(0,d.e)([(0,d.d)({readOnly:!0})],he.prototype,"cursor",null),(0,d.e)([(0,d.d)({readOnly:!0})],he.prototype,"preferManipulatorCursor",void 0),(0,d.e)([(0,d.d)()],he.prototype,"removeIncompleteOnCancel",void 0),(0,d.e)([(0,d.d)({readOnly:!0})],he.prototype,"updating",null),(0,d.e)([(0,d.d)({type:ce})],he.prototype,"configuration",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],he.prototype,"analysisViewData",void 0),(0,d.e)([(0,d.d)({readOnly:!0})],he.prototype,"_showTracker",null),(0,d.e)([(0,d.d)()],he.prototype,"_latestPointerMovePointerType",void 0),(0,d.e)([(0,d.d)()],he.prototype,"_shouldRenderTracker",null),(0,d.e)([(0,d.d)()],he.prototype,"_laserlineVisualElement",void 0),(0,d.e)([(0,d.d)()],he.prototype,"_grabbedManipulator",void 0),he=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool")],he);var ye=(0,A.v)(),ge=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e))._lineOfSightVisualizations=[],i._computationHandles=new m.u,i}return(0,s.Z)(n,[{key:"initialize",value:function(){this.own(this._connectComputations()),this._createObserverVisualization()}},{key:"destroy",value:function(){this._computationHandles=(0,p.l)(this._computationHandles),this._observerVisualElement=(0,p.l)(this._observerVisualElement)}},{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"interactiveAndEditable",get:function(){return this.analysisViewData.interactive&&this.analysisViewData.editable}},{key:"testInfo",get:function(){return{visualizations:this._lineOfSightVisualizations}}},{key:"_configuration",get:function(){return this.analysisViewData.configuration}},{key:"_createLineOfSightVisualization",value:function(){var e=this._configuration,t=this.view,n={view:t,attached:!0,width:e.outerWidth,innerWidth:e.innerWidth},r=y.l.toUnitRGBA(e.visibleOuterColor),o=y.l.toUnitRGBA(e.visibleInnerColor),a=y.l.toUnitRGBA(e.occludedOuterColor),s=y.l.toUnitRGBA(e.occludedInnerColor),l=y.l.toUnitRGBA(e.undefinedOuterColor),u=y.l.toUnitRGBA(e.undefinedInnerColor),c={visibleLineVisualElement:new h.C((0,i.Z)((0,i.Z)({},n),{},{color:r,innerColor:o})),occludedLineVisualElement:new h.C((0,i.Z)((0,i.Z)({},n),{},{color:a,innerColor:s})),undefinedLineVisualElement:new h.C((0,i.Z)((0,i.Z)({},n),{},{color:l,innerColor:u})),targetVisualElement:new z.S((0,i.Z)((0,i.Z)({view:t,attached:!0},me),{},{size:8}))};return this._lineOfSightVisualizations.push(c),c}},{key:"_destroyLineOfSightVisualization",value:function(e){e.visibleLineVisualElement=(0,p.l)(e.visibleLineVisualElement),e.occludedLineVisualElement=(0,p.l)(e.occludedLineVisualElement),e.undefinedLineVisualElement=(0,p.l)(e.undefinedLineVisualElement),e.targetVisualElement=(0,p.l)(e.targetVisualElement),this._lineOfSightVisualizations.splice(this._lineOfSightVisualizations.indexOf(e),1)}},{key:"_updateLineOfSightVisualization",value:function(e,t,n){var i=this._configuration,r=e.computationResult,o=e.inputPoints,a=r.start,s=r.end,l=r.intersection,u=r.isValid,c=r.isTargetVisible,d=o.observer,v=we;v[12]=d[0],v[13]=d[1],v[14]=d[2];var h=(0,f.e)(_e,a,d),g=(0,f.e)(be,s,d),m=(0,f.e)(Ce,l,d),_=t.visibleLineVisualElement,b=t.occludedLineVisualElement,C=t.undefinedLineVisualElement,w=t.targetVisualElement,O=(0,p.t)(this.analysisViewData.elevationAlignedObserver)||(0,p.t)(e.elevationAlignedTargetLocation),k=this.visible&&!O;_.visible=k,b.visible=k,C.visible=k,w.visible=k,w.attached=!n.interactiveAndEditable,k&&(_.geometry=null,b.geometry=null,C.geometry=null,w.geometry=e.elevationAlignedTargetLocation,u?c?(_.geometry=[[(0,f.a6)(h),(0,f.a6)(g)]],_.transform=v,_.color=y.l.toUnitRGBA(i.visibleOuterColor),w.color=y.l.toUnitRGBA(i.visibleInnerColor)):(_.geometry=[[(0,f.a6)(h),(0,f.a6)(m)]],_.transform=v,_.color=y.l.toUnitRGBA(i.occludedOuterColor),b.geometry=[[(0,f.a6)(m),(0,f.a6)(g)]],b.transform=v,w.color=y.l.toUnitRGBA(i.occludedInnerColor)):(C.geometry=[[(0,f.a6)(h),(0,f.a6)(g)]],C.transform=v,w.color=y.l.toUnitRGBA(i.undefinedInnerColor)))}},{key:"_getLineOfSightVisualizationDependencies",value:function(e){var t=e.computationResult,n=this._configuration;return{computationResult:t,occludedOuterColor:n.occludedOuterColor,visibleOuterColor:n.visibleOuterColor,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}}},{key:"_connectComputation",value:function(e){var t=this,n=this._computationHandles;if(!n.has(e)){var i=this._createLineOfSightVisualization();n.add([(0,_.l)((function(){return t._getLineOfSightVisualizationDependencies(e)}),(function(n){return t._updateLineOfSightVisualization(e,i,n)}),{sync:!0,initial:!0,equals:p.f}),(0,d.g)((function(){return t._destroyLineOfSightVisualization(i)}))],e)}}},{key:"_disconnectComputation",value:function(e){this._computationHandles.remove(e)}},{key:"_connectComputations",value:function(){var e=this;return(0,_.a)((function(){return e.analysisViewData.computations}),"change",(function(t){return e._onComputationsCollectionChange(t)}),{sync:!0,onListenerAdd:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._connectComputation(r)}}catch(o){i.e(o)}finally{i.f()}},onListenerRemove:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._disconnectComputation(r)}}catch(o){i.e(o)}finally{i.f()}}})}},{key:"_onComputationsCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,a.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(c){r.e(c)}finally{r.f()}var s,l=(0,a.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._connectComputation(u)}}catch(c){l.e(c)}finally{l.f()}}},{key:"_createObserverVisualization",value:function(){var e=this,t=y.l.toUnitRGBA(this._configuration.visibleInnerColor),n=new z.S((0,i.Z)({view:this.view,attached:!1,color:t},me));this._observerVisualElement=n,this.own((0,_.l)((function(){return{observer:e.analysisViewData.elevationAlignedObserver,interactiveAndEditable:e.interactiveAndEditable,visible:e.visible}}),(function(t){var i=t.observer,r=t.interactiveAndEditable,o=t.visible;(0,p.t)(i)||r||!o?n.attached=!1:(n.geometry=i,e._observerVisualElement.attached=!0)}),_.h))}}]),n}(d.y);(0,d.e)([(0,d.d)({constructOnly:!0})],ge.prototype,"analysis",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],ge.prototype,"analysisViewData",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],ge.prototype,"view",void 0),(0,d.e)([(0,d.d)({readOnly:!0})],ge.prototype,"visible",null),(0,d.e)([(0,d.d)()],ge.prototype,"interactiveAndEditable",null),(0,d.e)([(0,d.d)()],ge.prototype,"testInfo",null),(0,d.e)([(0,d.d)()],ge.prototype,"_configuration",null),ge=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],ge);var me={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},_e=(0,f.n)(),be=(0,f.n)(),Ce=(0,f.n)(),we=(0,F.e)(),Oe=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).type="line-of-sight-view-3d",i.analysis=null,i.tool=null,i.computations=new v.j,i.elevationAlignedObserver=null,i.configuration=new j,i.observerEngineLocation=(0,f.n)(),i.cursorTarget=null,i.editable=!0,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.view,n=this.analysis;this._analysisController=new Y({analysis:n,analysisViewData:this,view:t}),this._analysisVisualization=new ge({analysis:n,analysisViewData:this,view:t}),this.own([this._analysisController.on("result-changed",(function(t){t.target!==e.cursorTarget&&e.emit("result-changed",t)})),(0,M.c)(this,he)])}},{key:"destroy",value:function(){(0,M.m)(this),this._analysisController=(0,p.l)(this._analysisController),this._analysisVisualization=(0,p.l)(this._analysisVisualization)}},{key:"results",get:function(){return this.computations.map((function(e){return e.result}))}},{key:"priority",get:function(){return this._analysisController.priority},set:function(e){this._analysisController.priority=e}},{key:"updating",get:function(){return(0,p.r)(this._analysisController)&&this._analysisController.updating}},{key:"getResultForTarget",value:function(e){var t=this.computations.find((function(t){return t.target===e}));return(0,p.h)(t,(function(e){return e.result}))}},{key:"testInfo",get:function(){return{visualization:this._analysisVisualization,controller:this._analysisController}}}]),n}((0,h.a)(v.n.EventedMixin(d.y)));(0,d.e)([(0,d.d)({readOnly:!0})],Oe.prototype,"type",void 0),(0,d.e)([(0,d.d)({constructOnly:!0,nonNullable:!0})],Oe.prototype,"analysis",void 0),(0,d.e)([(0,d.d)()],Oe.prototype,"tool",void 0),(0,d.e)([(0,d.d)({readOnly:!0})],Oe.prototype,"results",null),(0,d.e)([(0,d.d)()],Oe.prototype,"priority",null),(0,d.e)([(0,d.d)()],Oe.prototype,"computations",void 0),(0,d.e)([(0,d.d)()],Oe.prototype,"elevationAlignedObserver",void 0),(0,d.e)([(0,d.d)()],Oe.prototype,"configuration",void 0),(0,d.e)([(0,d.d)()],Oe.prototype,"observerEngineLocation",void 0),(0,d.e)([(0,d.d)()],Oe.prototype,"cursorTarget",void 0),(0,d.e)([(0,d.d)()],Oe.prototype,"updating",null),(0,d.e)([(0,d.d)()],Oe.prototype,"editable",void 0),(0,d.e)([(0,d.d)()],Oe.prototype,"_analysisController",void 0),(0,d.e)([(0,d.d)()],Oe.prototype,"_analysisVisualization",void 0);var ke=Oe=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSightAnalysisView3D")],Oe);t.default=ke},33898:function(e,t,n){n.d(t,{d:function(){return c},f:function(){return s},m:function(){return v},s:function(){return o},u:function(){return a},v:function(){return l}});var i=n(75610),r=n(18411);function o(e,t){return function(e,t){return(0,i.t)(t)||!t.mode?e?"absolute-height":"on-the-ground":t.mode}(!!(0,i.r)(e)&&e.hasZ,t)}function a(e){var t=function(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}(e),n=o(e.geometry,t);return{mode:n,offset:(0,i.r)(t)&&"on-the-ground"!==n?(0,i.n)(t.offset,0)*(0,r.r)((0,i.n)(t.unit,"meters")):0}}function s(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return u(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,n,i)}function l(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return u(e,t[0],t[1],t.length>2?t[2]:0,n,i,r)}function u(e,t,n,r,o,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(!(0,i.t)(a)){var l=(0,i.r)(s)?s.mode:"absolute-height";if("on-the-ground"===l)return 0;var u=c(t,n,r,o,e,a),v=u.absoluteZ;return d(v,t,n,r,o,e,s,l)}}function c(e,t,n,r,o,a){var s=(0,i.r)(a.offset)?a.offset:0;switch(a.mode){case"absolute-height":return{absoluteZ:n+s,elevation:0};case"on-the-ground":var l=(0,i.n)(o.elevationProvider.getElevation(e,t,0,r,"ground"),0);return{absoluteZ:l,elevation:l};case"relative-to-ground":var u=(0,i.n)(o.elevationProvider.getElevation(e,t,n,r,"ground"),0);return{absoluteZ:n+u+s,elevation:u};case"relative-to-scene":var c=(0,i.n)(o.elevationProvider.getElevation(e,t,n,r,"scene"),0);return{absoluteZ:n+c+s,elevation:c}}}function d(e,t,n,r,o,a,s,l){var u=(0,i.r)(s)&&(0,i.r)(s.offset)?s.offset:0;switch(l){case"absolute-height":return e-u;case"relative-to-ground":return e-((0,i.n)(a.elevationProvider.getElevation(t,n,r,o,"ground"),0)+u);case"relative-to-scene":return e-((0,i.n)(a.elevationProvider.getElevation(t,n,r,o,"scene"),0)+u)}}var v={mode:"absolute-height",offset:0}},98805:function(e,t,n){function i(e){return e&&"getAtOrigin"in e&&"originOf"in e}n.d(t,{i:function(){return i}})},16936:function(e,t,n){n.d(t,{w:function(){return _}});var i=n(74165),r=n(15861),o=n(1413),a=n(37762),s=n(75610),l=n(98805),u=n(57714),c=n(92870),d=n(23132),v=n(96349);function p(e){return f[function(e){return e instanceof Blob?e.type:function(e){var t=(0,u.k)(e);return g[t]||h}(e.url)}(e)]||y}var f={},h="text/plain",y=f[h],g={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(var m in g)f[g[m]]=m;function _(e){var t=(0,s.r)(e)&&e.origins?e.origins:[void 0];return function(n,i){var r,c=function(e,t,n){if((0,s.r)(e)&&"resource"===e.type)return function(e,t,n){var i=(0,d.aD)(t,n);return{type:String,read:function(e,t,n){var r=(0,v.m)(e,t,n);return i.type===String?r:"function"==typeof i.type?new i.type({url:r}):void 0},write:{writer:function(t,r,a,c){if(!c||!c.resources)return"string"==typeof t?void(r[a]=(0,v.c)(t,c)):void(r[a]=t.write({},c));var p=function(e){return(0,s.t)(e)?null:"string"==typeof e?e:e.url}(t),f=p?(0,v.c)(p,(0,o.Z)((0,o.Z)({},c),{},{verifyItemRelativeUrls:c&&c.verifyItemRelativeUrls?{writtenUrls:c.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}),v.I.NO):null,h=i.type!==String&&(!(0,l.i)(this)||c&&c.origin&&this.originIdOf(n)>(0,d.X)(c.origin));c&&c.portalItem&&(0,s.r)(f)&&!(0,u.K)(f)?h?C(this,n,t,f,r,a,c,e):function(e,t,n,i){i.resources.toKeep.push({resource:i.portalItem.resourceFromPath(e)}),t[n]=e}(f,r,a,c):c&&c.portalItem&&((0,s.t)(f)||(0,s.r)((0,v.h)(f))||(0,u.V)(f)||h)?b(this,n,t,f,r,a,c,e):r[a]=f}}}}(e,t,n);switch((0,s.r)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":return{read:v.R.read,write:v.R.write}}}(e,n,i),p=(0,a.Z)(t);try{for(p.s();!(r=p.n()).done;){var f=r.value,h=(0,d.J)(n,f,i);for(var y in c)h[y]=c[y]}}catch(g){p.e(g)}finally{p.f()}}}function b(e,t,n,i,r,o,a,l){var d=(0,c.t)(),v=O(n,i,a),f=(0,u.G)((0,s.p)(l,"prefix"),d),h="".concat(f,".").concat(p(v)),y=a.portalItem.resourceFromPath(h);(0,u.V)(i)&&a.resources.pendingOperations.push(function(e){return k.apply(this,arguments)}(i).then((function(e){y.path="".concat(f,".").concat(p(e)),r[o]=y.itemRelativeUrl})).catch((function(){}))),w(e,t,y,v,a.resources.toAdd),r[o]=y.itemRelativeUrl}function C(e,t,n,i,r,o,a,s){var l=a.portalItem.resourceFromPath(i),c=O(n,i,a);p(c)===(0,u.k)(l.path)?(w(e,t,l,c,a.resources.toUpdate),r[o]=i):b(e,t,n,i,r,o,a,s)}function w(e,t,n,i,r){r.push({resource:n,content:i,finish:function(n){!function(e,t,n){"string"==typeof e[t]?e[t]=n.url:e[t].url=n.url}(e,t,n)}})}function O(e,t,n){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(n))],{type:"application/json"})}function k(){return k=(0,r.Z)((0,i.Z)().mark((function e(t){var r,o,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(n,57714)).then((function(e){return e.D}));case 2:return r=e.sent.default,e.next=5,r(t,{responseType:"blob"});case 5:return o=e.sent,a=o.data,e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}},30917:function(e,t,n){n.d(t,{a:function(){return s},n:function(){return a}});var i=n(75610),r=n(63022),o=n(97627);function a(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=(0,r.k)(e,t);return(0,i.t)(s)?null:(s.hasZ&&!a||!(0,i.r)(n)||(s.z=(0,i.n)((0,o.q)(n,s),0)),s)}function s(e,t,n){n.warnOnce("Failed to project analysis geometry (id: '".concat(e.id,"'), projection from spatial reference (wkid: '").concat(t.wkid,"') to view spatial reference is not supported. Projection may be possible after calling projection.load()."))}}}]);
//# sourceMappingURL=360.bdf6e7b7.chunk.js.map