"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[1633,8999],{28681:function(e,t,r){r.d(t,{i:function(){return l}});var n=r(15671),a=r(43144),i=r(60136),s=r(29388),u=r(23132);r(75610);var l=function(e){var t=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"apiKey",get:function(){var e;return this._isOverridden("apiKey")?this._get("apiKey"):"portalItem"in this?null===(e=this.portalItem)||void 0===e?void 0:e.apiKey:null},set:function(e){null!=e?this._override("apiKey",e):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}}]),r}(e);return(0,u.e)([(0,u.d)({type:String})],t.prototype,"apiKey",null),t=(0,u.e)([(0,u.n)("esri.layers.mixins.APIKeyMixin")],t)}},50905:function(e,t,r){r.d(t,{n:function(){return v},p:function(){return p}});var n=r(43144),a=r(15671),i=r(60136),s=r(29388),u=r(23132),l=r(2157),o=r(70441),c=(r(75610),r(30709)),d=r(43124),h=new(r(57714).s)({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"}),f=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,a.Z)(this,r),(n=t.call(this,e)).name=null,n.description=null,n.drawingTool=null,n.prototype=null,n.thumbnail=null,n}return(0,n.Z)(r)}((0,l.l)(o.l));(0,u.e)([(0,u.d)({json:{write:!0}})],f.prototype,"name",void 0),(0,u.e)([(0,u.d)({json:{write:!0}})],f.prototype,"description",void 0),(0,u.e)([(0,u.d)({json:{read:h.read,write:h.write}})],f.prototype,"drawingTool",void 0),(0,u.e)([(0,u.d)({json:{write:!0}})],f.prototype,"prototype",void 0),(0,u.e)([(0,u.d)({json:{write:!0}})],f.prototype,"thumbnail",void 0);var p=f=(0,u.e)([(0,u.n)("esri.layers.support.FeatureTemplate")],f),y=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,a.Z)(this,r),(n=t.call(this,e)).id=null,n.name=null,n.domains=null,n.templates=null,n}return(0,n.Z)(r,[{key:"readDomains",value:function(e){for(var t={},r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];t[a]=(0,d.t)(e[a])}return t}},{key:"writeDomains",value:function(e,t){for(var r={},n=0,a=Object.keys(e);n<a.length;n++){var i,s=a[n];e[s]&&(r[s]=null===(i=e[s])||void 0===i?void 0:i.toJSON())}t.domains=r}}]),r}((0,l.l)(o.l));(0,u.e)([(0,u.d)({json:{write:!0}})],y.prototype,"id",void 0),(0,u.e)([(0,u.d)({json:{write:!0}})],y.prototype,"name",void 0),(0,u.e)([(0,u.d)({json:{write:!0}})],y.prototype,"domains",void 0),(0,u.e)([(0,c.o)("domains")],y.prototype,"readDomains",null),(0,u.e)([(0,c.r)("domains")],y.prototype,"writeDomains",null),(0,u.e)([(0,u.d)({type:[p],json:{write:!0}})],y.prototype,"templates",void 0);var v=y=(0,u.e)([(0,u.n)("esri.layers.support.FeatureType")],y)},97033:function(e,t,r){r.d(t,{a:function(){return y},c:function(){return d},d:function(){return v}});var n=r(15671),a=r(43144),i=r(60136),s=r(29388),u=r(23132),l=r(77470),o=r(75610),c=r(36551),d=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).updating=!1,e.handleId=0,e.handles=new l.u,e.scheduleHandleId=0,e.pendingPromises=new Set,e}return(0,a.Z)(r,[{key:"destroy",value:function(){this.removeAll(),this.handles.destroy()}},{key:"add",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,r,c.l)}},{key:"addWhen",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,r,c.f)}},{key:"addOnCollectionChange",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.initial,i=void 0!==a&&a,s=n.final,u=void 0!==s&&s,l=++this.handleId;return this.handles.add([(0,c.a)(e,"after-changes",this._createSyncUpdatingCallback(),c.U),(0,c.a)(e,"change",t,{onListenerAdd:i?function(e){return t({added:e.toArray(),removed:[]})}:void 0,onListenerRemove:u?function(e){return t({added:[],removed:e.toArray()})}:void 0})],l),{remove:function(){return r.handles.remove(l)}}}},{key:"addPromise",value:function(e){var t=this;if((0,o.t)(e))return e;var r=++this.handleId;this.handles.add({remove:function(){t.pendingPromises.delete(e)&&(0!==t.pendingPromises.size||t.handles.has(p)||t._set("updating",!1))}},r),this.pendingPromises.add(e),this._set("updating",!0);var n=function(){return t.handles.remove(r)};return e.then(n,n),e}},{key:"removeAll",value:function(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}},{key:"_installWatch",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,i=++this.handleId;n.sync||this._installSyncUpdatingWatch(e,i);var s=a(e,t,n);return this.handles.add(s,i),{remove:function(){return r.handles.remove(i)}}}},{key:"_installSyncUpdatingWatch",value:function(e,t){var r=this._createSyncUpdatingCallback(),n=(0,c.l)(e,r,{sync:!0,equals:function(){return!1}});return this.handles.add(n,t),n}},{key:"_createSyncUpdatingCallback",value:function(){var e=this;return function(){e.handles.remove(p),++e.scheduleHandleId;var t=e.scheduleHandleId;e._get("updating")||e._set("updating",!0),e.handles.add((0,u.B)((function(){t===e.scheduleHandleId&&(e._set("updating",e.pendingPromises.size>0),e.handles.remove(p))})),p)}}}]),r}(u.y);(0,u.e)([(0,u.d)({readOnly:!0})],d.prototype,"updating",void 0),d=(0,u.e)([(0,u.n)("esri.core.support.WatchUpdatingTracking")],d);var h,f,p=-42;(f=h||(h={}))[f.NONE=0]="NONE",f[f.SYNC=1]="SYNC",f[f.INIT=2]="INIT";var y=function(e){var t=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"destroy",value:function(){var e,t;this.destroyed||(null!==(e=this._get("handles"))&&void 0!==e&&e.destroy(),null===(t=this._get("updatingHandles"))||void 0===t||t.destroy())}},{key:"handles",get:function(){return this._get("handles")||new l.u}},{key:"updatingHandles",get:function(){return this._get("updatingHandles")||new d}}]),r}(e);return(0,u.e)([(0,u.d)({readOnly:!0})],t.prototype,"handles",null),(0,u.e)([(0,u.d)({readOnly:!0})],t.prototype,"updatingHandles",null),t=(0,u.e)([(0,u.n)("esri.core.HandleOwner")],t),t},v=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r)}(y(u.y));v=(0,u.e)([(0,u.n)("esri.core.HandleOwner")],v)},77470:function(e,t,r){r.d(t,{u:function(){return d}});var n=r(15671),a=r(43144),i=r(60136),s=r(29388),u=r(23132),l=r(80175),o=r(75610),c=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var a;return(0,n.Z)(this,r),(a=t.call(this,e))._groups=new Map,a}return(0,a.Z)(r,[{key:"destroy",value:function(){this.removeAll()}},{key:"size",get:function(){var e=0;return this._groups.forEach((function(t){e+=t.length})),e}},{key:"add",value:function(e,t){var r=this;if(!this._isHandle(e)&&!Array.isArray(e)&&!l.j.isCollection(e))return this;var n=this._getOrCreateGroup(t);return Array.isArray(e)||l.j.isCollection(e)?e.forEach((function(e){return r._isHandle(e)&&n.push(e)})):n.push(e),this.notifyChange("size"),this}},{key:"forEach",value:function(e,t){if("function"==typeof e)this._groups.forEach((function(t){return t.forEach(e)}));else{var r=this._getGroup(e);r&&t&&r.forEach(t)}}},{key:"has",value:function(e){return this._groups.has(this._ensureGroupKey(e))}},{key:"remove",value:function(e){if(Array.isArray(e)||l.j.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;for(var t=this._getGroup(e),r=0;r<t.length;r++)t[r].remove();return this._deleteGroup(e),this.notifyChange("size"),this}},{key:"removeAll",value:function(){return this._groups.forEach((function(e){for(var t=0;t<e.length;t++)e[t].remove()})),this._groups.clear(),this.notifyChange("size"),this}},{key:"_isHandle",value:function(e){return e&&!!e.remove}},{key:"_getOrCreateGroup",value:function(e){if(this.has(e))return this._getGroup(e);var t=[];return this._groups.set(this._ensureGroupKey(e),t),t}},{key:"_getGroup",value:function(e){return(0,o.q)(this._groups.get(this._ensureGroupKey(e)))}},{key:"_deleteGroup",value:function(e){return this._groups.delete(this._ensureGroupKey(e))}},{key:"_ensureGroupKey",value:function(e){return e||"_default_"}}]),r}(u.y);(0,u.e)([(0,u.d)({readOnly:!0})],c.prototype,"size",null);var d=c=(0,u.e)([(0,u.n)("esri.core.Handles")],c)},70516:function(e,t,r){r.d(t,{p:function(){return h}});var n,a=r(15671),i=r(43144),s=r(60136),u=r(29388),l=r(23132),o=r(80175),c=r(70441),d=(r(75610),n=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,a.Z)(this,r),(n=t.call(this,e)).floorField=null,n.viewAllMode=!1,n.viewAllLevelIds=new o.j,n}return(0,i.Z)(r,[{key:"clone",value:function(){return new n({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}}]),r}(c.l));(0,l.e)([(0,l.d)({type:String,json:{write:!0}})],d.prototype,"floorField",void 0),(0,l.e)([(0,l.d)({json:{read:!1,write:!1}})],d.prototype,"viewAllMode",void 0),(0,l.e)([(0,l.d)({json:{read:!1,write:!1}})],d.prototype,"viewAllLevelIds",void 0);var h=d=n=(0,l.e)([(0,l.n)("esri.layers.support.LayerFloorInfo")],d)},40100:function(e,t,r){r.d(t,{n:function(){return n},x:function(){return y}});var n={Base64:0,Hex:1,String:2,Raw:3};function a(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function i(e){for(var t=[],r=0,n=8*e.length;r<n;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function s(e){for(var t=[],r=0,n=32*e.length;r<n;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}function u(e){for(var t="0123456789abcdef",r=[],n=0,a=4*e.length;n<a;n++)r.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return r.join("")}function l(e){for(var t=[],r=0,n=4*e.length;r<n;r+=3)for(var a=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255,i=0;i<4;i++)8*r+6*i>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>6*(3-i)&63));return t.join("")}function o(e,t,r,n,i,s){return a(function(e,t){return e<<t|e>>>32-t}(a(a(t,e),a(n,s)),i),r)}function c(e,t,r,n,a,i,s){return o(t&r|~t&n,e,t,a,i,s)}function d(e,t,r,n,a,i,s){return o(t&n|r&~n,e,t,a,i,s)}function h(e,t,r,n,a,i,s){return o(t^r^n,e,t,a,i,s)}function f(e,t,r,n,a,i,s){return o(r^(t|~n),e,t,a,i,s)}function p(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,n=-271733879,i=-1732584194,s=271733878,u=0;u<e.length;u+=16){var l=r,o=n,p=i,y=s;r=c(r,n,i,s,e[u+0],7,-680876936),s=c(s,r,n,i,e[u+1],12,-389564586),i=c(i,s,r,n,e[u+2],17,606105819),n=c(n,i,s,r,e[u+3],22,-1044525330),r=c(r,n,i,s,e[u+4],7,-176418897),s=c(s,r,n,i,e[u+5],12,1200080426),i=c(i,s,r,n,e[u+6],17,-1473231341),n=c(n,i,s,r,e[u+7],22,-45705983),r=c(r,n,i,s,e[u+8],7,1770035416),s=c(s,r,n,i,e[u+9],12,-1958414417),i=c(i,s,r,n,e[u+10],17,-42063),n=c(n,i,s,r,e[u+11],22,-1990404162),r=c(r,n,i,s,e[u+12],7,1804603682),s=c(s,r,n,i,e[u+13],12,-40341101),i=c(i,s,r,n,e[u+14],17,-1502002290),r=d(r,n=c(n,i,s,r,e[u+15],22,1236535329),i,s,e[u+1],5,-165796510),s=d(s,r,n,i,e[u+6],9,-1069501632),i=d(i,s,r,n,e[u+11],14,643717713),n=d(n,i,s,r,e[u+0],20,-373897302),r=d(r,n,i,s,e[u+5],5,-701558691),s=d(s,r,n,i,e[u+10],9,38016083),i=d(i,s,r,n,e[u+15],14,-660478335),n=d(n,i,s,r,e[u+4],20,-405537848),r=d(r,n,i,s,e[u+9],5,568446438),s=d(s,r,n,i,e[u+14],9,-1019803690),i=d(i,s,r,n,e[u+3],14,-187363961),n=d(n,i,s,r,e[u+8],20,1163531501),r=d(r,n,i,s,e[u+13],5,-1444681467),s=d(s,r,n,i,e[u+2],9,-51403784),i=d(i,s,r,n,e[u+7],14,1735328473),r=h(r,n=d(n,i,s,r,e[u+12],20,-1926607734),i,s,e[u+5],4,-378558),s=h(s,r,n,i,e[u+8],11,-2022574463),i=h(i,s,r,n,e[u+11],16,1839030562),n=h(n,i,s,r,e[u+14],23,-35309556),r=h(r,n,i,s,e[u+1],4,-1530992060),s=h(s,r,n,i,e[u+4],11,1272893353),i=h(i,s,r,n,e[u+7],16,-155497632),n=h(n,i,s,r,e[u+10],23,-1094730640),r=h(r,n,i,s,e[u+13],4,681279174),s=h(s,r,n,i,e[u+0],11,-358537222),i=h(i,s,r,n,e[u+3],16,-722521979),n=h(n,i,s,r,e[u+6],23,76029189),r=h(r,n,i,s,e[u+9],4,-640364487),s=h(s,r,n,i,e[u+12],11,-421815835),i=h(i,s,r,n,e[u+15],16,530742520),r=f(r,n=h(n,i,s,r,e[u+2],23,-995338651),i,s,e[u+0],6,-198630844),s=f(s,r,n,i,e[u+7],10,1126891415),i=f(i,s,r,n,e[u+14],15,-1416354905),n=f(n,i,s,r,e[u+5],21,-57434055),r=f(r,n,i,s,e[u+12],6,1700485571),s=f(s,r,n,i,e[u+3],10,-1894986606),i=f(i,s,r,n,e[u+10],15,-1051523),n=f(n,i,s,r,e[u+1],21,-2054922799),r=f(r,n,i,s,e[u+8],6,1873313359),s=f(s,r,n,i,e[u+15],10,-30611744),i=f(i,s,r,n,e[u+6],15,-1560198380),n=f(n,i,s,r,e[u+13],21,1309151649),r=f(r,n,i,s,e[u+4],6,-145523070),s=f(s,r,n,i,e[u+11],10,-1120210379),i=f(i,s,r,n,e[u+2],15,718787259),n=f(n,i,s,r,e[u+9],21,-343485551),r=a(r,l),n=a(n,o),i=a(i,p),s=a(s,y)}return[r,n,i,s]}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Hex,r=t||n.Base64,a=p(i(e),8*e.length);switch(r){case n.Raw:return a;case n.Hex:return u(a);case n.String:return s(a);case n.Base64:return l(a)}}},97866:function(e,t,r){r.d(t,{I:function(){return k},L:function(){return m},S:function(){return g},b:function(){return b},d:function(){return h},g:function(){return _},h:function(){return y},j:function(){return w},m:function(){return f},w:function(){return p},y:function(){return v}});var n=r(29439),a=r(75610),i=r(57714),s=r(96349),u={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},l=Object.values(u),o=new RegExp("^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(".concat(l.join("|"),"))(?:\\/(?:layers\\/)?(\\d+))?"),"i"),c=new RegExp("^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(".concat(l.join("|"),"))(?:\\/(?:layers\\/)?(\\d+))?"),"i"),d=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function h(e){return!!o.test(e)}function f(e){if((0,a.t)(e))return null;var t=(0,i.j)(e),r=t.path.match(o)||t.path.match(c);if(!r)return null;var s=(0,n.Z)(r,5),l=s[1],d=s[2],h=s[3],f=s[4],p=d.indexOf("/");return{title:y(-1!==p?d.slice(p+1):d),serverType:u[h.toLowerCase()],sublayer:null!=f&&""!==f?parseInt(f,10):null,url:{path:l}}}function p(e){var t=(0,i.j)(e).path.match(d);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function y(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function v(e,t){var r=[];if(e){var n=f(e);(0,a.r)(n)&&n.title&&r.push(n.title)}if(t){var i=y(t);r.push(i)}if(2===r.length){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function _(e){if(!e)return!1;var t=(e=e.toLowerCase()).includes(".arcgis.com/"),r=e.includes("//services")||e.includes("//tiles")||e.includes("//features");return t&&r}function g(e,t){return e?(0,i.C)((0,i.A)(e,t)):e}function m(e){var t=e.url;if(!t)return{url:t};t=(0,i.A)(t,e.logger);var r,n=(0,i.j)(t),s=f(n.path);if((0,a.r)(s))null!=s.sublayer&&null==e.layer.layerId&&(r=s.sublayer),t=s.url.path;else if(e.nonStandardUrlAllowed){var u=p(n.path);(0,a.r)(u)&&(t=u.serviceUrl,r=u.sublayerId)}return{url:(0,i.C)(t),layerId:r}}function b(e,t,r,n,a){(0,s.p)(t,n,"url",a),n.url&&null!=e.layerId&&(n.url=(0,i.G)(n.url,r,e.layerId.toString()))}function k(e){if(!e)return!1;var t=e.toLowerCase(),r=t.includes("/services/"),n=t.includes("/mapserver/wmsserver"),a=t.includes("/imageserver/wmsserver"),i=t.includes("/wmsserver");return r&&(n||a||i)}function w(e){if(!e)return!1;var t=new i.y((0,i.Q)(e)).authority.toLowerCase();return"server.arcgisonline.com"===t||"services.arcgisonline.com"===t}},38304:function(e,t,r){r.d(t,{a:function(){return c},e:function(){return l},i:function(){return p},n:function(){return u},u:function(){return h}});var n=r(74165),a=r(15861),i=r(75610),s=r(23132);function u(e,t,r){return(0,s.E)(e.map((function(e,n){return t.apply(r,[e,n])})))}function l(e,t,r){return o.apply(this,arguments)}function o(){return o=(0,a.Z)((0,n.Z)().mark((function e(t,r,a){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.E)(t.map((function(e,t){return r.apply(a,[e,t])})));case 2:return e.abrupt("return",e.sent.map((function(e){return e.value})));case 3:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function c(e){return d.apply(this,arguments)}function d(){return(d=(0,a.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,i.t)(t)){e.next=2;break}return e.abrupt("return",{ok:!1,error:new Error("no promise provided")});case 2:return e.prev=2,e.t0=!0,e.next=6,t;case 6:return e.t1=e.sent,e.abrupt("return",{ok:e.t0,value:e.t1});case 10:return e.prev=10,e.t2=e.catch(2),e.abrupt("return",{ok:!1,error:e.t2});case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function h(e){return f.apply(this,arguments)}function f(){return(f=(0,a.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=!0,e.next=4,t;case 4:return e.t1=e.sent,e.abrupt("return",{ok:e.t0,value:e.t1});case 8:return e.prev=8,e.t2=e.catch(0),e.abrupt("return",((0,s.M)(e.t2),{ok:!1,error:e.t2}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function p(e){if(!0===e.ok)return e.value;throw e.error}},50338:function(e,t,r){r.d(t,{S:function(){return u},e:function(){return n},i:function(){return a},l:function(){return i},o:function(){return s},r:function(){return o},s:function(){return c},t:function(){return l},y:function(){return d}});var n=[252,146,31,255],a=[153,153,153,255],i={type:"esriSMS",style:"esriSMSCircle",size:6,color:n,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},s={type:"esriSLS",style:"esriSLSSolid",width:.75,color:n},u={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},o={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},c={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},d={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},23190:function(e,t,r){r.d(t,{n:function(){return o},s:function(){return d}});var n=r(74165),a=r(1413),i=r(15861),s=r(69202),u=r(27597),l=r(34860);function o(e,t,r){return c.apply(this,arguments)}function c(){return c=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(0,s.n)(t),e.abrupt("return",(0,u.S)(o,l.b.from(r),(0,a.Z)({},i)).then((function(e){return e.data.count})));case 2:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function d(e,t,r){return h.apply(this,arguments)}function h(){return h=(0,i.Z)((0,n.Z)().mark((function e(t,r,i){var o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(0,s.n)(t),e.abrupt("return",(0,u.p)(o,l.b.from(r),(0,a.Z)({},i)).then((function(e){return e.data.objectIds})));case 2:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}},32568:function(e,t,r){r.d(t,{a:function(){return x},l:function(){return b},s:function(){return k}});var n,a=r(1413),i=r(74165),s=r(15861),u=r(15671),l=r(43144),o=r(60136),c=r(29388),d=r(23132),h=r(70441),f=(r(75610),r(69202)),p=r(27597),y=r(15612),v=r(34860);function _(e){var t=e.exifInfo,r=e.exifName,n=e.tagName;if(!t||!r||!n)return null;var a=t.find((function(e){return e.name===r}));return a?function(e){var t=e.tagName,r=e.tags;if(!r||!t)return null;var n=r.find((function(e){return e.name===t}));return n&&n.value||null}({tagName:n,tags:a.tags}):null}var g={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}},m=n=function(e){(0,o.Z)(r,e);var t=(0,c.Z)(r);function r(e){var n;return(0,u.Z)(this,r),(n=t.call(this,e)).contentType=null,n.exifInfo=null,n.id=null,n.globalId=null,n.keywords=null,n.name=null,n.parentGlobalId=null,n.parentObjectId=null,n.size=null,n.url=null,n}return(0,l.Z)(r,[{key:"orientationInfo",get:function(){var e=_({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:this.exifInfo});return g[e]||null}},{key:"clone",value:function(){return new n({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}}]),r}(h.l);(0,d.e)([(0,d.d)({type:String})],m.prototype,"contentType",void 0),(0,d.e)([(0,d.d)()],m.prototype,"exifInfo",void 0),(0,d.e)([(0,d.d)({readOnly:!0})],m.prototype,"orientationInfo",null),(0,d.e)([(0,d.d)({type:d.S})],m.prototype,"id",void 0),(0,d.e)([(0,d.d)({type:String})],m.prototype,"globalId",void 0),(0,d.e)([(0,d.d)({type:String})],m.prototype,"keywords",void 0),(0,d.e)([(0,d.d)({type:String})],m.prototype,"name",void 0),(0,d.e)([(0,d.d)({json:{read:!1}})],m.prototype,"parentGlobalId",void 0),(0,d.e)([(0,d.d)({json:{read:!1}})],m.prototype,"parentObjectId",void 0),(0,d.e)([(0,d.d)({type:d.S})],m.prototype,"size",void 0),(0,d.e)([(0,d.d)({json:{read:!1}})],m.prototype,"url",void 0);var b=m=n=(0,d.e)([(0,d.n)("esri.layers.support.AttachmentInfo")],m);function k(e,t,r){return w.apply(this,arguments)}function w(){return w=(0,s.Z)((0,i.Z)().mark((function e(t,r,n){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(t,r,n);case 2:return a=e.sent,e.abrupt("return",y.default.fromJSON(a));case 4:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)}function x(e,t,r){return S.apply(this,arguments)}function S(){return S=(0,s.Z)((0,i.Z)().mark((function e(t,r,n){var s,u,l,o,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,f.n)(t),u=(0,a.Z)({},n),l=v.b.from(r),e.next=5,(0,p.c)(s,l,l.sourceSpatialReference,u);case 5:return o=e.sent,c=o.data,e.abrupt("return",c);case 8:case"end":return e.stop()}}),e)}))),S.apply(this,arguments)}},7206:function(e,t,r){r.r(t),r.d(t,{A:function(){return de},C:function(){return B},D:function(){return ge},E:function(){return ye},I:function(){return ee},S:function(){return re},a:function(){return W},b:function(){return ve},c:function(){return z},d:function(){return P},e:function(){return A},f:function(){return ke},g:function(){return oe},h:function(){return L},m:function(){return q},q:function(){return me},s:function(){return M},v:function(){return G},w:function(){return j},y:function(){return H}});var n=r(1413),a=r(37762),i=r(60136),s=r(29388),u=r(74165),l=r(15861),o=r(15671),c=r(43144),d=r(57714),h=r(37116),f=r(16485),p=(r(75610),r(23132),r(81019)),y=r(30709),v=r(83822),_=r(28969),g=r(40100),m=r(43124),b=r(55827),k=r(30604),w=r(74575),x=r(61495),S=r(34860),F=r(32568),Z=(r(44455),r(27597)),I=r(15612),C=r(10590),D=r(23190),T=(r(91204),r(1241),r(67417)),R=r(50905),E=r(79611),N=r(61099),A=function(){function e(){(0,o.Z)(this,e),this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}return(0,c.Z)(e,[{key:"add",value:function(e,t,r){this._layerById[t]=r,this._layerByName[e]=r}},{key:"featureSetByName",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!(r.length>1&&void 0!==r[1])||r[1],r.length>2&&void 0!==r[2]?r[2]:["*"],e.abrupt("return",void 0===this._layerByName[t]?null:this._layerByName[t]);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"featureSetById",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!(r.length>1&&void 0!==r[1])||r[1],r.length>2&&void 0!==r[2]?r[2]:["*"],e.abrupt("return",void 0===this._layerById[t]?null:this._layerById[t]);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"castToText",value:function(){return"object, FeatureSetCollection"}}]),e}(),L=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).declaredClass="esri.arcade.featureset.actions.AttributeFilter",n._maxProcessing=1e3,n._parent=e.parentfeatureset,e.whereclause instanceof p.WhereClause?(n._whereclause=e.whereclause,n._whereClauseFunction=null):(n._whereClauseFunction=e.whereclause,n._whereclause=null),n}return(0,c.Z)(r,[{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new y.k({wkid:4326}),this.geometryType=f.a1.point)}},{key:"_getSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._parent._getFilteredSet("",null,this._whereclause,null,t);case 5:return r=e.sent,e.abrupt("return",(this._checkCancelled(t),null!==this._whereClauseFunction?this._wset=new h.t(r._candidates.slice(0).concat(r._known.slice(0)),[],r._ordered,this._clonePageDefinition(r.pagesDefinition)):this._wset=new h.t(r._candidates.slice(0),r._known.slice(0),r._ordered,this._clonePageDefinition(r.pagesDefinition)),this._wset));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);return t===f.a2.NotInFeatureSet?t:void 0===(t=this._idstates[e])?f.a2.Unknown:t}},{key:"_getFeature",value:function(e,t,r){return this._parent._getFeature(e,t,r)}},{key:"_getFeatures",value:function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}},{key:"_featureFromCache",value:function(e){return this._parent._featureFromCache(e)}},{key:"executeWhereClause",value:function(e){return this._whereclause.testFeature(e)}},{key:"executeWhereClauseDeferred",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this._whereClauseFunction){e.next=3;break}return r=this._whereClauseFunction(t),e.abrupt("return",r);case 3:return e.abrupt("return",this.executeWhereClause(t));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchAndRefineFeatures",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var a,i,s,l,o,c,d,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new h.t([],t,!1,null),i=Math.min(r,t.length),e.next=3,this._parent._getFeatures(a,-1,i,n);case 3:if(this._checkCancelled(n),null!=this._whereClauseFunction){e.next=7;break}for(s=0;s<i;s++)l=this._parent._featureFromCache(t[s]),!0===this.executeWhereClause(l)?this._idstates[t[s]]=f.a2.InFeatureSet:this._idstates[t[s]]=f.a2.NotInFeatureSet;return e.abrupt("return","success");case 7:o=[],c=0;case 9:if(!(c<i)){e.next=19;break}return d=this._parent._featureFromCache(t[c]),e.t0=o,e.next=14,this.executeWhereClauseDeferred(d);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:c++,e.next=9;break;case 19:for(p=0;p<r;p++)!0===o[p]?this._idstates[t[p]]=f.a2.InFeatureSet:this._idstates[t[p]]=f.a2.NotInFeatureSet;return e.abrupt("return","success");case 21:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i){var s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!==this._whereClauseFunction||(null!==n?null!==this._whereclause&&(n=(0,h.o)(this._whereclause,n)):n=this._whereclause),e.next=3,this._ensureLoaded();case 3:return e.next=5,this._parent._getFilteredSet(t,r,n,a,i);case 5:return s=e.sent,e.abrupt("return",(this._checkCancelled(i),null!==this._whereClauseFunction?new h.t(s._candidates.slice(0).concat(s._known.slice(0)),[],s._ordered,this._clonePageDefinition(s.pagesDefinition)):new h.t(s._candidates.slice(0),s._known.slice(0),s._ordered,this._clonePageDefinition(s.pagesDefinition))));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"_stat",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i,s,l){var o,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this._whereClauseFunction){e.next=2;break}return e.abrupt("return",null===i&&""===n&&null===a?this._manualStat(t,r,s,l):{calculated:!1});case 2:return o=this._whereclause,null!==i&&null!==this._whereclause&&(o=(0,h.o)(this._whereclause,i)),e.next=6,this._parent._stat(t,r,n,a,o,s,l);case 6:return c=e.sent,e.abrupt("return",!1===c.calculated?null===i&&""===n&&null===a?this._manualStat(t,r,s,l):{calculated:!1}:c);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i,s,u){return e.apply(this,arguments)}}()},{key:"_canDoAggregates",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null===this._whereClauseFunction&&(null!==i?null!==this._whereclause&&(i=(0,h.o)(this._whereclause,i)):i=this._whereclause,null!==this._parent&&this._parent._canDoAggregates(t,r,n,a,i)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"_getAggregatePagesDataSourceDefinition",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i,s,l){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._parent){e.next=2;break}throw new Error("Should never be called");case 2:return e.abrupt("return",(null!==i?null!==this._whereclause&&(i=(0,h.o)(this._whereclause,i)):i=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(t,r,n,a,i,s,l)));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i,s,u){return e.apply(this,arguments)}}()}],[{key:"registerAction",value:function(){h.k._featuresetFunctions.filter=function(e){if("function"==typeof e)return new r({parentfeatureset:this,whereclause:e});var t=null;return e instanceof p.WhereClause&&(t=e),new r({parentfeatureset:this,whereclause:t})}}}]),r}(h.k),O=function(){function e(t){(0,o.Z)(this,e),this.field=t,this.sqlRewritable=!1}return(0,c.Z)(e,[{key:"postInitialization",value:function(e,t){}}]),e}(),P=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).sqlRewritable=!0,n}return(0,c.Z)(r,[{key:"extractValue",value:function(e){return e.attributes[this.field.name]}},{key:"rewriteSql",value:function(e){return{rewritten:this.sqlRewritable,where:e}}}]),r}(O),j=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e,n,a){var i;return(0,o.Z)(this,r),(i=t.call(this,(0,f.a3)(e))).originalField=e,i.sqlRewritable=!0,i.field.name=n,i.field.alias=a,i}return(0,c.Z)(r,[{key:"rewriteSql",value:function(e,t){return{rewritten:this.sqlRewritable,where:(0,h.s)(e,this.field.name,this.originalField.name,t.getFieldsIndex())}}},{key:"extractValue",value:function(e){return e.attributes[this.originalField.name]}}]),r}(O),q=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e,n,a){var i;for(var s in(0,o.Z)(this,r),(i=t.call(this,e)).codefield=n,i.lkp=a,i.reverseLkp={},a)i.reverseLkp[a[s]]=s;return i.sqlRewritable=!0,i}return(0,c.Z)(r,[{key:"rewriteSql",value:function(e,t){var n=this.evaluateNodeToWhereClause(e.parseTree,f.a4.Standardised,this.field.name,this.codefield instanceof p.WhereClause?(0,h.n)(this.codefield,f.a4.Standardised):this.codefield,e.parameters);return n.includes(r.BADNESS)?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:p.WhereClause.create(n,t._parent.getFieldsIndex())}}},{key:"evaluateNodeToWhereClause",value:function(e,t){var n,i,s,u,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4?arguments[4]:void 0;switch(e.type){case"interval":return(0,h.T)(this.evaluateNodeToWhereClause(e.value,t,l,o,c),e.qualifier,e.op);case"case-expression":var d=" CASE ";"simple"===e.format&&(d+=this.evaluateNodeToWhereClause(e.operand,t,l,r.BADNESS,c));for(var f=0;f<e.clauses.length;f++)d+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[f].operand,t,l,r.BADNESS,c)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[f].value,t,l,r.BADNESS,c);return null!==e.else&&(d+=" ELSE "+this.evaluateNodeToWhereClause(e.else,t,l,r.BADNESS,c)),d+=" END ";case"parameter":var p=c[e.value.toLowerCase()];if("string"==typeof p)return"'"+c[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(p instanceof Date)return(0,h.i)(p,t);if(p instanceof Array){for(var y=[],v=0;v<p.length;v++)"string"==typeof p[v]?y.push("'"+p[v].toString().replace(/'/g,"''")+"'"):p[v]instanceof Date?y.push((0,h.i)(p[v],t)):y.push(p[v].toString());return y}return p.toString();case"expression-list":i=[];var _,g=(0,a.Z)(e.value);try{for(g.s();!(_=g.n()).done;){var m=_.value;i.push(this.evaluateNodeToWhereClause(m,t,l,o,c))}}catch(R){g.e(R)}finally{g.f()}return i;case"unary-expression":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,t,l,r.BADNESS,c)+" ) ";case"binary-expression":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" AND "+this.evaluateNodeToWhereClause(e.right,t,l,o,c)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" OR "+this.evaluateNodeToWhereClause(e.right,t,l,o,c)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IS NOT NULL )";case"IN":if(n=[],"expression-list"===e.right.type){if("column-reference"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){var b,k=[],w=!0,x=(0,a.Z)(e.right.value);try{for(x.s();!(b=x.n()).done;){var S=b.value;if("string"!==S.type){w=!1;break}if(void 0===this.lkp[S.value]){w=!1;break}k.push(this.lkp[S.value].toString())}}catch(R){x.e(R)}finally{x.f()}if(w)return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+k.join(",")+")) "}return n=this.evaluateNodeToWhereClause(e.right,t,l,o,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+n.join(",")+")) "}return(u=this.evaluateNodeToWhereClause(e.right,t,l,o,c))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+u.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" IN ("+u+")) ";case"NOT IN":if(n=[],"expression-list"===e.right.type){if("column-reference"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){var F,Z=[],I=!0,C=(0,a.Z)(e.right.value);try{for(C.s();!(F=C.n()).done;){var D=F.value;if("string"!==D.type){I=!1;break}if(void 0===this.lkp[D.value]){I=!1;break}Z.push(this.lkp[D.value].toString())}}catch(R){C.e(R)}finally{C.f()}if(I)return" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+Z.join(",")+")) "}return n=this.evaluateNodeToWhereClause(e.right,t,l,o,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+n.join(",")+")) "}return(u=this.evaluateNodeToWhereClause(e.right,t,l,o,c))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+u.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,o,c)+" NOT IN ("+u+")) ";case"BETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"NOTBETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)," ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" NOT BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") ";case"<>":case"=":if("column-reference"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+o+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column-reference"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+o+") ";return" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,t,l,r.BADNESS,c)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,l,r.BADNESS,c)+") "}case"null":return"null";case"boolean":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return(0,h.i)(e.value,t);case"number":return e.value.toString();case"current-time":return(0,h.u)("date"===e.mode,t);case"column-reference":return l&&l.toLowerCase()===e.column.toLowerCase()?"("+o+")":e.column;case"function":var T=this.evaluateNodeToWhereClause(e.args,t,l,r.BADNESS,c);return(0,h.l)(e.name,T,t)}throw new Error("Unsupported sql syntax "+e.type)}},{key:"extractValue",value:function(e){return this.codefield instanceof p.WhereClause?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:this.reverseLkp[e.attributes[this.codefield]]}}]),r}(O);q.BADNESS="_!!!_BAD_LKP_!!!!";var G=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e,n){var a;return(0,o.Z)(this,r),(a=t.call(this,e)).sql=n,a}return(0,c.Z)(r,[{key:"rewriteSql",value:function(e,t){return{rewritten:!0,where:(0,h.s)(e,this.field.name,(0,h.n)(this.sql,f.a4.Standardised),t.getFieldsIndex())}}},{key:"extractValue",value:function(e){return this.sql.calculateValueCompiled(e)}}]),r}(O),B=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e))._calcFunc=null,n.declaredClass="esri.arcade.featureset.actions.Adapted",n.adaptedFields=null,n._extraFilter=null,n._extraFilter=e.extraFilter,n._parent=e.parentfeatureset,n._maxProcessing=30,n.adaptedFields=e.adaptedFields,n}return(0,c.Z)(r,[{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new y.k({wkid:4326}),this.objectIdField="",this.globalIdField="",this.geometryType=f.a1.point,this.typeIdField="",this.types=null),this.fields=[];var e,t=(0,a.Z)(this.adaptedFields);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.postInitialization(this,this._parent),this.fields.push(r.field)}}catch(n){t.e(n)}finally{t.f()}}},{key:"_getSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=17;break}return e.next=3,this._ensureLoaded();case 3:if(r=null,!this._extraFilter){e.next=10;break}return e.next=7,this._getFilteredSet("",null,null,null,t);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,this._parent._getSet(t);case 12:e.t0=e.sent;case 13:return r=e.t0,this._checkCancelled(t),this._wset=new h.t(r._candidates.slice(0),r._known.slice(0),r._ordered,this._clonePageDefinition(r.pagesDefinition)),e.abrupt("return",this._wset);case 17:return e.abrupt("return",this._wset);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isInFeatureSet",value:function(e){return this._parent._isInFeatureSet(e)}},{key:"_getFeatures",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,i){var s,l,o,c,d,f,p,y,g,m,b,k,w,x,S;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=[],-1!==r&&void 0===this._featureCache[r]&&s.push(r),l=this._maxQueryRate(),!0!==this._checkIfNeedToExpandKnownPage(t,l)){e.next=7;break}return e.next=6,this._expandPagedSet(t,l,0,0,i);case 6:return e.abrupt("return",this._getFeatures(t,r,n,i));case 7:for(o=0,c=t._lastFetchedIndex;c<t._known.length&&(++o<=n&&(t._lastFetchedIndex+=1),!(void 0===this._featureCache[t._known[c]]&&(t._known[c]!==r&&s.push(t._known[c]),s.length>=l)));c++);if(0!==s.length){e.next=11;break}return e.abrupt("return","success");case 11:return t=new h.t([],s,t._ordered,null),d=Math.min(s.length,n),e.next=15,this._parent._getFeatures(t,-1,d,i);case 15:for(this._checkCancelled(i),f=[],p=0;p<d;p++)void 0!==(y=this._parent._featureFromCache(s[p]))&&f.push({geometry:y.geometry,attributes:y.attributes,id:s[p]});for(g=0,m=f;g<m.length;g++){b=m[g],k=[],w=(0,a.Z)(this.adaptedFields);try{for(w.s();!(x=w.n()).done;)S=x.value,k[S.field.name]=S.extractValue(b)}catch(u){w.e(u)}finally{w.f()}this._featureCache[b.id]=new v.g({attributes:k,geometry:(0,_.c)(b.geometry)})}return e.abrupt("return","success");case 20:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"_fetchAndRefineFeatures",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Fetch and Refine should not be called in this featureset");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,i,s){var l,o,c,d,f,p,y,v;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=!1,o=this._reformulateWithoutAdaptions(n),l=o.cannot,n=o.where,c=!1,null===i){e.next=28;break}c=!0,d=[],f=(0,a.Z)(this.adaptedFields),e.prev=8,f.s();case 10:if((p=f.n()).done){e.next=19;break}if((y=p.value)instanceof P||!0!==i.scanForField(y.field.name)){e.next=17;break}if(y instanceof j){e.next=16;break}return i=null,c=!1,e.abrupt("break",19);case 16:d.push({field:y.field.name,newfield:y.originalField.name});case 17:e.next=10;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(8),f.e(e.t0);case 24:return e.prev=24,f.f(),e.finish(24);case 27:i&&d.length>0&&(i=i.replaceFields(d));case 28:return null!==n?null!==this._extraFilter&&(n=(0,h.o)(this._extraFilter,n)):n=this._extraFilter,e.next=31,this._ensureLoaded();case 31:return e.next=33,this._parent._getFilteredSet(t,r,n,i,s);case 33:return v=e.sent,e.abrupt("return",(this._checkCancelled(s),!0===l?new h.t(v._candidates.slice(0).concat(v._known.slice(0)),[],!0===c&&v._ordered,this._clonePageDefinition(v.pagesDefinition)):new h.t(v._candidates.slice(0),v._known.slice(0),!0===c&&v._ordered,this._clonePageDefinition(v.pagesDefinition))));case 35:case"end":return e.stop()}}),e,this,[[8,21,24,27]])})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"_reformulateWithoutAdaptions",value:function(e){var t={cannot:!1,where:e};if(null!==e){var r,n=(0,a.Z)(this.adaptedFields);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(!0===(0,h.h)(e,i.field.name)){var s=i.rewriteSql(e,this);if(!0!==s.rewritten){t.cannot=!0,t.where=null;break}t.where=s.where}}}catch(u){n.e(u)}finally{n.f()}}return t}},{key:"_stat",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i,s,l){var o,c,d;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=!1,c=this._reformulateWithoutAdaptions(r),o=c.cannot,r=c.where,c=this._reformulateWithoutAdaptions(i),o=o||c.cannot,null!==(i=c.where)?null!==this._extraFilter&&(i=(0,h.o)(this._extraFilter,i)):i=this._extraFilter,!0!==o){e.next=3;break}return e.abrupt("return",null===i&&""===n&&null===a?this._manualStat(t,r,s,l):{calculated:!1});case 3:return e.next=5,this._parent._stat(t,r,n,a,i,s,l);case 5:return d=e.sent,e.abrupt("return",!1===d.calculated?null===i&&""===n&&null===a?this._manualStat(t,r,s,l):{calculated:!1}:d);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i,s,u){return e.apply(this,arguments)}}()},{key:"_canDoAggregates",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,i,s){var l,o,c,d,f,p,y,v,_,g;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._parent){e.next=2;break}return e.abrupt("return",!1);case 2:l=0;case 3:if(!(l<t.length)){e.next=24;break}o=(0,a.Z)(this.adaptedFields),e.prev=5,o.s();case 7:if((c=o.n()).done){e.next=13;break}if(d=c.value,t[l].toLowerCase()!==d.field.name.toLowerCase()||d instanceof P){e.next=11;break}return e.abrupt("return",!1);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),o.e(e.t0);case 18:return e.prev=18,o.f(),e.finish(18);case 21:l++,e.next=3;break;case 24:f=[],p=0;case 26:if(!(p<r.length)){e.next=40;break}if(null===(y=r[p]).workingexpr){e.next=36;break}if(!(v=this._reformulateWithoutAdaptions(y.workingexpr)).cannot){e.next=32;break}return e.abrupt("return",!1);case 32:(_=y.clone()).workingexpr=v.where,f.push(_),e.next=37;break;case 36:f.push(y);case 37:p++,e.next=26;break;case 40:return g=this._reformulateWithoutAdaptions(s),e.abrupt("return",!g.cannot&&(null!==(s=g.where)?null!==this._extraFilter&&(s=(0,h.o)(this._extraFilter,s)):s=this._extraFilter,this._parent._canDoAggregates(t,f,n,i,s)));case 42:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"_getAggregatePagesDataSourceDefinition",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i,s,l){var o,c,d,f,p,y;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._parent){e.next=2;break}throw new Error("Should never be called");case 2:o=[],c=0;case 4:if(!(c<r.length)){e.next=18;break}if(null===(d=r[c]).workingexpr){e.next=14;break}if(!(f=this._reformulateWithoutAdaptions(d.workingexpr)).cannot){e.next=10;break}throw new Error("Should never be called");case 10:(p=d.clone()).workingexpr=f.where,o.push(p),e.next=15;break;case 14:o.push(d);case 15:c++,e.next=4;break;case 18:if(!(y=this._reformulateWithoutAdaptions(i)).cannot){e.next=21;break}throw new Error("Should never be called");case 21:return e.abrupt("return",(null!==(i=y.where)?null!==this._extraFilter&&(i=(0,h.o)(this._extraFilter,i)):i=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(t,o,n,a,i,s,l)));case 22:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i,s,u){return e.apply(this,arguments)}}()}],[{key:"findField",value:function(e,t){var r,n=(0,a.Z)(e);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(i.name.toLowerCase()===t.toString().toLowerCase())return i}}catch(s){n.e(s)}finally{n.f()}return null}}]),r}(h.k);function U(e,t){return e===t?0:null===e?-1:null===t?1:e<t?-1:1}var W=function(){function e(t){(0,o.Z)(this,e);var r=t.split(",");this._fields=[],this._directions=[];for(var n=0;n<r.length;n++){var a=r[n].match(/\S+/g);this._fields.push(a[0]),2===a.length?"asc"===a[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}return(0,c.Z)(e,[{key:"constructClause",value:function(){for(var e="",t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e}},{key:"order",value:function(e){var t=this;e.sort((function(e,r){for(var n=0;n<t._fields.length;n++){var a,i=t.featureValue(e.feature,t._fields[n],n),s=t.featureValue(r.feature,t._fields[n],n);if(0!==(a=1===t._directions[n]?U(i,s):-1*U(i,s)))return a}return 0}))}},{key:"scanForField",value:function(e){for(var t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1}},{key:"replaceFields",value:function(t){for(var r="",n=0;n<this._fields.length;n++){0!==n&&(r+=",");var i,s=this._fields[n],u=(0,a.Z)(t);try{for(u.s();!(i=u.n()).done;){var l=i.value;if(s.toLowerCase()===l.field.toLowerCase()){s=l.newfield;break}}}catch(o){u.e(o)}finally{u.f()}r+=s,1===this._directions[n]?r+=" ASC":r+=" DESC"}return new e(r)}},{key:"featureValue",value:function(e,t,r){var n=e.attributes[t];if(void 0!==n)return n;for(var a in e.attributes)if(t.toLowerCase()===a.toLowerCase())return this._fields[r]=a,e.attributes[a];return null}}]),e}(),M=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e))._orderbyclause=null,n.declaredClass="esri.arcade.featureset.actions.OrderBy",n._maxProcessing=100,n._orderbyclause=e.orderbyclause,n._parent=e.parentfeatureset,n}return(0,c.Z)(r,[{key:"_getSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._getFilteredSet("",null,null,this._orderbyclause,t);case 5:return r=e.sent,e.abrupt("return",(this._checkCancelled(t),this._wset=r,this._wset));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"manualOrderSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r){var n,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getIdColumnDictionary(t,[],-1,r);case 2:for(n=e.sent,this._orderbyclause.order(n),a=new h.t([],[],!0,null),i=0;i<n.length;i++)a._known.push(n[i].id);return e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getIdColumnDictionary",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,i){var s,l,o,c,d,h,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n<t._known.length-1)){e.next=17;break}if(s=this._maxQueryRate(),"GETPAGES"!==t._known[n+1]){e.next=6;break}return e.next=5,(0,f.a5)(this._parent._expandPagedSet(t,s,0,0,i));case 5:return e.abrupt("return",this.getIdColumnDictionary(t,r,n,i));case 6:for(l=n+1,o=[];l<t._known.length&&"GETPAGES"!==t._known[l];)o.push(t._known[l]),l++;return n+=o.length,e.next=12,(0,f.a5)(this._parent._getFeatureBatch(o,i));case 12:c=e.sent,this._checkCancelled(i),d=(0,a.Z)(c);try{for(d.s();!(h=d.n()).done;)p=h.value,r.push({id:p.attributes[this.objectIdField],feature:p})}catch(u){d.e(u)}finally{d.f()}return e.abrupt("return",this.getIdColumnDictionary(t,r,n,i));case 17:if(!(t._candidates.length>0)){e.next=24;break}return e.next=20,(0,f.a5)(this._refineSetBlock(t,this._maxProcessingRate(),i));case 20:this._checkCancelled(i),e.t0=this.getIdColumnDictionary(t,r,n,i),e.next=25;break;case 24:e.t0=r;case 25:return e.abrupt("return",e.t0);case 26:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"_isInFeatureSet",value:function(e){return this._parent._isInFeatureSet(e)}},{key:"_getFeatures",value:function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)}},{key:"_featureFromCache",value:function(e){if(void 0===this._featureCache[e]){var t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]}},{key:"_fetchAndRefineFeatures",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Fetch and Refine should not be called in this featureset");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i){var s,l,o,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return e.next=4,this._parent._getFilteredSet(t,r,n,null===a?this._orderbyclause:a,i);case 4:if(s=e.sent,this._checkCancelled(i),l=new h.t(s._candidates.slice(0),s._known.slice(0),s._ordered,this._clonePageDefinition(s.pagesDefinition)),o=!0,s._candidates.length>0&&(o=!1),!1!==l._ordered){e.next=13;break}return e.next=11,this.manualOrderSet(l,i);case 11:return c=e.sent,e.abrupt("return",(!1===o&&(null===r&&null===n||(c=new h.t(c._candidates.slice(0).concat(c._known.slice(0)),[],c._ordered,this._clonePageDefinition(c.pagesDefinition)))),c));case 13:return e.abrupt("return",l);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()}],[{key:"registerAction",value:function(){h.k._featuresetFunctions.orderBy=function(e){return""===e?this:new r({parentfeatureset:this,orderbyclause:new W(e)})}}}]),r}(h.k);var Q=function(){function e(){(0,o.Z)(this,e)}return(0,c.Z)(e,[{key:"clone",value:function(){var t=new e;return t.field=this.field,t.tofieldname=this.tofieldname,t.typeofstat=this.typeofstat,t.workingexpr=this.workingexpr,t}},{key:"toStatisticsName",value:function(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":default:return"count";case"VAR":return"var";case"STDDEV":return"stddev";case"AVG":return"avg"}}}],[{key:"parseStatField",value:function(t,r,n){var a=new e;a.field=t;var i=p.WhereClause.create(r,n),s=function(e){if("function"===e.parseTree.type){if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(e.parseTree.args.value.length>1)throw new Error("Statistic does not have 1 or 0 Parameters");var t=p.WhereClause.create((0,h.a)(e.parseTree.args.value[0],f.a4.Standardised,e.parameters),e.fieldsIndex);return{name:e.parseTree.name,expr:t}}return null}(i);if(null===s)throw new Error("Invalid Statistic Function");var u=s.name.toUpperCase().trim();if("MIN"===u){if(a.typeofstat="MIN",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("MAX"===u){if(a.typeofstat="MAX",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("COUNT"===u)a.typeofstat="COUNT",a.workingexpr=s.expr;else if("STDEV"===u){if(a.typeofstat="STDDEV",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("SUM"===u){if(a.typeofstat="SUM",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("MEAN"===u){if(a.typeofstat="AVG",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else if("AVG"===u){if(a.typeofstat="AVG",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}else{if("VAR"!==u)throw new Error("Invalid Statistic Function");if(a.typeofstat="VAR",a.workingexpr=s.expr,null===i)throw new Error("Invalid Statistic Function Parameters")}return a}}]),e}();function K(e){if(!e)return"COUNT";switch(e.toLowerCase()){case"max":return"MAX";case"var":case"variance":return"VAR";case"avg":case"average":case"mean":return"AVG";case"min":return"MIN";case"sum":return"SUM";case"stdev":case"stddev":return"STDDEV";case"count":return"COUNT"}return"COUNT"}var V=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e))._decodedStatsfield=[],n._decodedGroupbyfield=[],n._candosimplegroupby=!0,n.phsyicalgroupbyfields=[],n.objectIdField="ROW__ID",n._internalObjectIdField="ROW__ID",n._adaptedFields=[],n.declaredClass="esri.arcade.featureset.actions.Aggregate",n._uniqueIds=1,n._maxQuery=10,n._maxProcessing=10,n._parent=e.parentfeatureset,n._config=e,n}return(0,c.Z)(r,[{key:"isTable",value:function(){return!0}},{key:"_getSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=5;break}return e.next=3,this._getFilteredSet("",null,null,null,t);case 3:return r=e.sent,e.abrupt("return",(this._wset=r,this._wset));case 5:return e.abrupt("return",this._wset);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isInFeatureSet",value:function(){return f.a2.InFeatureSet}},{key:"_nextUniqueName",value:function(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;var t="T"+this._uniqueIds.toString();return e[t]=1,t}},{key:"_convertToEsriFieldType",value:function(e){return e}},{key:"_initialiseFeatureSet",value:function(){var e={},t=!1,r=1,n=this._parent?this._parent.getFieldsIndex():new b.d([]);for(this.objectIdField="ROW__ID",this.globalIdField="";!1===t;){for(var i=!1,s=0;s<this._config.groupbyfields.length;s++)if(this._config.groupbyfields[s].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}if(!1===i)for(var u=0;u<this._config.statsfields.length;u++)if(this._config.statsfields[u].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}!1===i?t=!0:(this.objectIdField="ROW__ID"+r.toString(),r++)}var l,o=(0,a.Z)(this._config.statsfields);try{for(o.s();!(l=o.n()).done;){var c=l.value,d=new Q;d.field=c.name,d.tofieldname=c.name,d.workingexpr=c.expression instanceof p.WhereClause?c.expression:p.WhereClause.create(c.expression,n),d.typeofstat=K(c.statistic),this._decodedStatsfield.push(d)}}catch(B){o.e(B)}finally{o.f()}this._decodedGroupbyfield=[];var v,_=(0,a.Z)(this._config.groupbyfields);try{for(_.s();!(v=_.n()).done;){var g=v.value,k={name:g.name,singlefield:null,tofieldname:g.name,expression:g.expression instanceof p.WhereClause?g.expression:p.WhereClause.create(g.expression,n)};this._decodedGroupbyfield.push(k)}}catch(B){_.e(B)}finally{_.f()}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";var w,x=(0,a.Z)(this._parent.fields);try{for(x.s();!(w=x.n()).done;){e[w.value.name.toUpperCase()]=1}}catch(B){x.e(B)}finally{x.f()}this.types=null}else this.geometryType=f.a1.point,this.typeIdField="",this.types=null,this.spatialReference=new y.k({wkid:4326});this.fields=[];var S=new Q;S.field=this._nextUniqueName(e),S.tofieldname=this.objectIdField,S.workingexpr=p.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex()),S.typeofstat="MIN",this._decodedStatsfield.push(S);var F,Z=(0,a.Z)(this._decodedGroupbyfield);try{for(Z.s();!(F=Z.n()).done;){var I=F.value,C=new m.y;if(I.name=this._nextUniqueName(e),C.name=I.tofieldname,C.alias=C.name,(0,h.E)(I.expression)){var D=this._parent.getField((0,h.n)(I.expression,f.a4.Standardised));if(!D)throw new Error("Field is not present for Aggregation");I.name=D.name,I.singlefield=D.name,this.phsyicalgroupbyfields.push(D.name),C.type=D.type}else{C.type=this._convertToEsriFieldType((0,h.f)(I.expression,this._parent.fields));var T=new m.y;T.name=I.name,T.alias=T.name,this.phsyicalgroupbyfields.push(I.name),this._adaptedFields.push(new G(T,I.expression)),this._candosimplegroupby=!1}this.fields.push(C)}}catch(B){Z.e(B)}finally{Z.f()}if(this._adaptedFields.length>0){var R,E=(0,a.Z)(this._parent.fields);try{for(E.s();!(R=E.n()).done;){var N=R.value;this._adaptedFields.push(new P(N))}}catch(B){E.e(B)}finally{E.f()}}for(var A=0;A<this._decodedStatsfield.length;A++){var L=new m.y,O=null,j=this._decodedStatsfield[A];j.field=this._nextUniqueName(e),j.tofieldname===this.objectIdField&&(this._internalObjectIdField=j.field),L.name=j.tofieldname,L.alias=L.name;var q=null!==j.workingexpr&&(0,h.E)(j.workingexpr)?(0,h.n)(j.workingexpr,f.a4.Standardised):"";switch(this._decodedStatsfield[A].typeofstat){case"SUM":if(""!==q){if(!(O=this._parent.getField(q)))throw new Error("Field is not present for Aggregation");L.type=O.type}else L.type="double";break;case"MIN":case"MAX":if(""!==q){if(!(O=this._parent.getField(q)))throw new Error("Field is not present for Aggregation");L.type=O.type}else L.type="double";break;case"COUNT":L.type="integer";break;case"STDDEV":case"VAR":case"AVG":if(""!==q&&!(O=this._parent.getField(q)))throw new Error("Field is not present for Aggregation");L.type="double"}this.fields.push(L)}}},{key:"_canDoAggregates",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFeatures",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a){var i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._maxQuery,!0!==this._checkIfNeedToExpandKnownPage(t,i)){e.next=7;break}return e.next=4,this._expandPagedSet(t,i,0,0,a);case 4:e.t0=this._getFeatures(t,r,n,a),e.next=8;break;case 7:e.t0="success";case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,i,s){var l,o,c,d,f,p,y,v,_,g,m,b,k;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""===t){e.next=2;break}return e.abrupt("return",new h.t([],[],!0,null));case 2:return l=null,o={ordered:!1,nowhereclause:!1},e.next=6,this._ensureLoaded();case 6:if(null===n){e.next=15;break}c=0;case 8:if(!(c<this._decodedStatsfield.length)){e.next=15;break}if(!0!==(0,h.h)(n,this._decodedStatsfield[c].tofieldname)){e.next=12;break}return o.nowhereclause=!0,n=null,e.abrupt("break",15);case 12:c++,e.next=8;break;case 15:if(null===i){e.next=44;break}o.ordered=!0,d=0;case 18:if(!(d<this._decodedStatsfield.length)){e.next=25;break}if(!0!==i.scanForField(this._decodedStatsfield[d].tofieldname)){e.next=22;break}return i=null,o.ordered=!1,e.abrupt("break",25);case 22:d++,e.next=18;break;case 25:if(null===i){e.next=44;break}f=(0,a.Z)(this._decodedGroupbyfield),e.prev=27,f.s();case 29:if((p=f.n()).done){e.next=36;break}if(null!==(y=p.value).singlefield||!0!==i.scanForField(y.tofieldname)){e.next=34;break}return i=null,o.ordered=!1,e.abrupt("break",36);case 34:e.next=29;break;case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(27),f.e(e.t0);case 41:return e.prev=41,f.f(),e.finish(41);case 44:if(e.t1=!1!==this._candosimplegroupby,!e.t1){e.next=49;break}return e.next=48,this._parent._canDoAggregates(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,null);case 48:e.t1=e.sent;case 49:if(!e.t1){e.next=58;break}return v=null,n&&(v=this._reformulateWhereClauseWithoutGroupByFields(n)),_=null,i&&(_=this._reformulateOrderClauseWithoutGroupByFields(i)),e.next=56,this._parent._getAggregatePagesDataSourceDefinition(this.phsyicalgroupbyfields,this._decodedStatsfield,"",null,v,_,this._internalObjectIdField);case 56:return g=e.sent,e.abrupt("return",(this._checkCancelled(s),l=!0===o.nowhereclause?new h.t(g._candidates.slice(0).concat(g._known.slice(0)),[],!0===o.ordered&&g._ordered,this._clonePageDefinition(g.pagesDefinition)):new h.t(g._candidates.slice(0),g._known.slice(0),!0===o.ordered&&g._ordered,this._clonePageDefinition(g.pagesDefinition))));case 58:return m=this._parent,this._adaptedFields.length>0&&(m=new B({parentfeatureset:this._parent,adaptedFields:this._adaptedFields,extraFilter:null})),!0===o.nowhereclause?l=new h.t(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new M({parentfeatureset:m,orderbyclause:new W(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}}):(b=m,null!==n&&(k=null,n&&(k=this._reformulateWhereClauseWithoutGroupByFields(n)),b=new L({parentfeatureset:b,whereclause:k})),l=new h.t(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:this._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new M({parentfeatureset:b,orderbyclause:new W(this.phsyicalgroupbyfields.join(",")+","+this._parent.objectIdField+" ASC")})}})),e.abrupt("return",l);case 61:case"end":return e.stop()}}),e,this,[[27,38,41,44]])})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"_reformulateWhereClauseWithoutStatsFields",value:function(e){var t,r=(0,a.Z)(this._decodedStatsfield);try{for(r.s();!(t=r.n()).done;){var n=t.value;e=(0,h.s)(e,n.tofieldname,(0,h.n)(n.workingexpr,f.a4.Standardised),this._parent.getFieldsIndex())}}catch(i){r.e(i)}finally{r.f()}return e}},{key:"_reformulateWhereClauseWithoutGroupByFields",value:function(e){var t,r=(0,a.Z)(this._decodedGroupbyfield);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.tofieldname!==n.name&&(e=(0,h.s)(e,n.tofieldname,(0,h.n)(n.expression,f.a4.Standardised),this._parent.getFieldsIndex()))}}catch(i){r.e(i)}finally{r.f()}return e}},{key:"_reformulateOrderClauseWithoutGroupByFields",value:function(e){var t,r=[],n=(0,a.Z)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.tofieldname!==i.name&&r.push({field:i.tofieldname,newfield:i.name})}}catch(s){n.e(s)}finally{n.f()}return r.length>0?e.replaceFields(r):e}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)}},{key:"_refineSetBlock",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this._checkIfNeedToExpandCandidatePage(t,this._maxQuery)){e.next=4;break}return e.next=3,this._expandPagedSet(t,this._maxQuery,0,0,n);case 3:return e.abrupt("return",this._refineSetBlock(t,r,n));case 4:return this._checkCancelled(n),this._refineKnowns(t,r),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_expandPagedSet",value:function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}},{key:"_getPhysicalPage",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var i,s,l,o,c,d,h,f,p,y,_;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==t.pagesDefinition.aggregatefeaturesetpagedefinition){e.next=2;break}return e.abrupt("return",this._sequentialGetPhysicalItem(t,t.pagesDefinition.resultRecordCount,n,[]));case 2:return e.next=4,this._getAgregagtePhysicalPage(t,r,n);case 4:i=e.sent,s=(0,a.Z)(i);try{for(s.s();!(l=s.n()).done;){o=l.value,c={geometry:o.geometry,attributes:{}},d=(0,a.Z)(this._decodedGroupbyfield);try{for(d.s();!(h=d.n()).done;)f=h.value,c.attributes[f.tofieldname]=o.attributes[f.name]}catch(u){d.e(u)}finally{d.f()}p=(0,a.Z)(this._decodedStatsfield);try{for(p.s();!(y=p.n()).done;)_=y.value,c.attributes[_.tofieldname]=o.attributes[_.field]}catch(u){p.e(u)}finally{p.f()}this._featureCache[c.attributes[this.objectIdField]]=new v.g(c)}}catch(u){s.e(u)}finally{s.f()}return e.abrupt("return",i.length);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_sequentialGetPhysicalItem",value:function(e,t,r,n){var a=this;return new Promise((function(i,s){null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved||0===t?i(n.length):a._nextAggregateItem(e,t,r,n,(function(s){null===s?i(n.length):(t-=1,i(a._sequentialGetPhysicalItem(e,t,r,n)))}),s)}))}},{key:"_nextAggregateItem",value:function(e,t,r,n,a,i){var s=this;try{(0,f.a5)(e.pagesDefinition.internal.iterator.next()).then((function(u){if(null===u)if(null!==e.pagesDefinition.internal.workingItem){var l=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);n.push(l),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(l.attributes[s.objectIdField]),e.pagesDefinition.internal.fullyResolved=!0,a(null)}else e.pagesDefinition.internal.fullyResolved=!0,a(null);else{var o=s._generateAggregateHash(u);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[u],id:o};else{if(o!==e.pagesDefinition.internal.workingItem.id){var c=s._calculateAndAppendAggregateItem(e.pagesDefinition.internal.workingItem);return n.push(c),e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(c.attributes[s.objectIdField]),t-=1,e.pagesDefinition.internal.workingItem={features:[u],id:o},void a(c)}e.pagesDefinition.internal.workingItem.features.push(u)}s._nextAggregateItem(e,t,r,n,a,i)}}),i)}catch(u){i(u)}}},{key:"_calculateFieldStat",value:function(e,t,r){for(var n=[],a=0;a<e.features.length;a++)if(null!==t.workingexpr){var i=t.workingexpr.calculateValue(e.features[a]);null!==i&&n.push(i)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=(0,h.b)("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=(0,h.b)("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=(0,h.b)("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VAR":r.attributes[t.tofieldname]=(0,h.b)("var",n,-1);break;case"STDDEV":r.attributes[t.tofieldname]=(0,h.b)("stddev",n,-1);break;case"AVG":r.attributes[t.tofieldname]=(0,h.b)("avg",n,-1)}return!0}},{key:"_calculateAndAppendAggregateItem",value:function(e){var t,r={attributes:{},geometry:null},n=(0,a.Z)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var i=t.value,s=i.singlefield?e.features[0].attributes[i.singlefield]:i.expression.calculateValue(e.features[0]);r.attributes[i.tofieldname]=s}}catch(h){n.e(h)}finally{n.f()}var u,l=(0,a.Z)(this._decodedStatsfield);try{for(l.s();!(u=l.n()).done;){var o=u.value;this._calculateFieldStat(e,o,r)}}catch(h){l.e(h)}finally{l.f()}for(var c=[],d=0;d<this._decodedStatsfield.length;d++)c.push(this._calculateFieldStat(e,this._decodedStatsfield[d],r));return this._featureCache[r.attributes[this.objectIdField]]=new v.g({attributes:r.attributes,geometry:r.geometry}),r}},{key:"_generateAggregateHash",value:function(e){var t,r="",n=(0,a.Z)(this._decodedGroupbyfield);try{for(n.s();!(t=n.n()).done;){var i=t.value,s=i.singlefield?e.attributes[i.singlefield]:i.expression.calculateValue(e);r+=null==s?":":":"+s.toString()}}catch(u){n.e(u)}finally{n.f()}return(0,g.x)(r,g.n.String)}},{key:"_stat",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{calculated:!1});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatureByObjectId",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}],[{key:"registerAction",value:function(){h.k._featuresetFunctions.groupby=function(e,t){return new r({parentfeatureset:this,groupbyfields:e,statsfields:t})}}}]),r}(h.k),z=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e))._topnum=0,n.declaredClass="esri.arcade.featureset.actions.Top",n._countedin=0,n._maxProcessing=100,n._topnum=e.topnum,n._parent=e.parentfeatureset,n}return(0,c.Z)(r,[{key:"_getSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._parent._getSet(t);case 5:return r=e.sent,e.abrupt("return",(this._wset=new h.t(r._candidates.slice(0),r._known.slice(0),!1,this._clonePageDefinition(r.pagesDefinition)),this._setKnownLength(this._wset)>this._topnum&&(this._wset._known=this._wset._known.slice(0,this._topnum)),this._setKnownLength(this._wset)>=this._topnum&&(this._wset._candidates=[]),this._wset));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setKnownLength",value:function(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);if(t===f.a2.NotInFeatureSet)return t;var r=this._idstates[e];return r===f.a2.InFeatureSet||r===f.a2.NotInFeatureSet?r:t===f.a2.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=f.a2.InFeatureSet,this._countedin++,f.a2.InFeatureSet):(this._idstates[e]=f.a2.NotInFeatureSet,f.a2.NotInFeatureSet):f.a2.Unknown}},{key:"_expandPagedSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i){var s,l;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._parent){e.next=2;break}throw new Error("Parent Paging not implemented");case 2:if(r>this._topnum&&(r=this._topnum),!(this._countedin>=this._topnum&&t.pagesDefinition.internal.set.length<=t.pagesDefinition.resultOffset)){e.next=5;break}return s=t._known.length,e.abrupt("return",(s>0&&"GETPAGES"===t._known[s-1]&&(t._known.length=s-1),(s=t._candidates.length)>0&&"GETPAGES"===t._candidates[s-1]&&(t._candidates.length=s-1),"success"));case 5:return e.next=7,this._parent._expandPagedSet(t,r,n,a,i);case 7:return l=e.sent,e.abrupt("return",(this._setKnownLength(t)>this._topnum&&(t._known.length=this._topnum),this._setKnownLength(t)>=this._topnum&&(t._candidates.length=0),l));case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"_getFeatures",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a){var i,s,l,o,c,d,f,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],s=this._maxQueryRate(),!0!==this._checkIfNeedToExpandKnownPage(t,s)){e.next=5;break}return e.next=4,this._expandPagedSet(t,s,0,0,a);case 4:return e.abrupt("return",this._getFeatures(t,r,n,a));case 5:for(-1!==r&&void 0===this._featureCache[r]&&i.push(r),l=0,o=t._lastFetchedIndex;o<t._known.length&&(++l<=n&&(t._lastFetchedIndex+=1),!(void 0===this._featureCache[t._known[o]]&&(t._known[o]!==r&&i.push(t._known[o]),i.length>s)));o++);if(0!==i.length){e.next=10;break}return e.abrupt("return","success");case 10:return c=new h.t([],i,!1,null),d=Math.min(i.length,n),e.next=13,this._parent._getFeatures(c,-1,d,a);case 13:for(f=0;f<d;f++)void 0!==(p=this._parent._featureFromCache(i[f]))&&(this._featureCache[i[f]]=p);return e.abrupt("return","success");case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"_getFilteredSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i){var s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return e.next=4,this._getSet(i);case 4:return s=e.sent,e.abrupt("return",new h.t(s._candidates.slice(0).concat(s._known.slice(0)),[],!1,this._clonePageDefinition(s.pagesDefinition)));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"_refineKnowns",value:function(e,t){for(var r=0,n=null,a=[],i=0;i<e._candidates.length;i++){var s=this._isInFeatureSet(e._candidates[i]);if(s===f.a2.InFeatureSet){if(e._known.push(e._candidates[i]),r+=1,null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),e._known.length>=this._topnum)break}else if(s===f.a2.NotInFeatureSet)null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),r+=1;else if(s===f.a2.Unknown)break;if(r>=t)break}null!==n&&a.push(n);for(var u=a.length-1;u>=0;u--)e._candidates.splice(a[u].start,a[u].end-a[u].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])}},{key:"_stat",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{calculated:!1});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_canDoAggregates",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}],[{key:"registerAction",value:function(){h.k._featuresetFunctions.top=function(e){return new r({parentfeatureset:this,topnum:e})}}}]),r}(h.k),J=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",n._removeGeometry=!1,n._overrideFields=null,n.formulaCredential=null,n._pageJustIds=!1,n._requestStandardised=!1,n._useDefinitionExpression=!0,e.spatialReference&&(n.spatialReference=e.spatialReference),n._transparent=!0,n._maxProcessing=1e3,n._layer=e.layer,n._wset=null,void 0!==e.outFields&&(n._overrideFields=e.outFields),void 0!==e.includeGeometry&&(n._removeGeometry=!1===e.includeGeometry),n}return(0,c.Z)(r,[{key:"_maxQueryRate",value:function(){return f.a6}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(e){this._pageJustIds=e}},{key:"convertQueryToLruCacheKey",value:function(e){var t=(0,f.a7)(e.toJSON());return(0,g.x)(t,g.n.String)}},{key:"loadImpl",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this._layer.loaded){e.next=4;break}e.t0=(this._initialiseFeatureSet(),this),e.next=8;break;case 4:return e.next=6,this._layer.load();case 6:this._initialiseFeatureSet(),e.t0=this;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{var e,t=[],r=(0,a.Z)(this.fields);try{for(r.s();!(e=r.n()).done;){var n=e.value;if("oid"===n.type)t.push(n);else{var i,s=(0,a.Z)(this._layer.outFields);try{for(s.s();!(i=s.n()).done;){if(i.value.toLowerCase()===n.name.toLowerCase()){t.push(n);break}}}catch(m){s.e(m)}finally{s.f()}}}}catch(m){r.e(m)}finally{r.f()}this.fields=t}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var u,l=[],o=[],c=(0,a.Z)(this.fields);try{for(c.s();!(u=c.n()).done;){var d=u.value;if("oid"===d.type)l.push(d),o.push(d.name);else{var h,p=(0,a.Z)(this._overrideFields);try{for(p.s();!(h=p.n()).done;){if(h.value.toLowerCase()===d.name.toLowerCase()){l.push(d),o.push(d.name);break}}}catch(m){p.e(m)}finally{p.f()}}}}catch(m){c.e(m)}finally{c.f()}this.fields=l,this._overrideFields=o}if(this._layer.source&&this._layer.source.sourceJSON){var y=this._layer.source.sourceJSON.currentVersion;!0===this._layer.source.sourceJSON.useStandardizedQueries?(this._databaseType=f.a4.StandardisedNoInterval,null!=y&&y>=10.61&&(this._databaseType=f.a4.Standardised)):null!=y&&(y>=10.5&&(this._databaseType=f.a4.StandardisedNoInterval,this._requestStandardised=!0),y>=10.61&&(this._databaseType=f.a4.Standardised))}this.objectIdField=this._layer.objectIdField;var v,_=(0,a.Z)(this.fields);try{for(_.s();!(v=_.n()).done;){var g=v.value;"global-id"===g.type&&(this.globalIdField=g.name)}}catch(m){_.e(m)}finally{_.f()}this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}},{key:"_isInFeatureSet",value:function(){return f.a2.InFeatureSet}},{key:"_refineSetBlock",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._getFilteredSet("",null,null,null,t);case 5:return r=e.sent,e.abrupt("return",(this._wset=r,r));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_runDatabaseProbe",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return(r=new S.b).where=t.replace("OBJECTID",this._layer.objectIdField),e.prev=4,e.next=7,this._layer.queryObjectIds(r);case 7:return e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[4,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_canUsePagination",value:function(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)}},{key:"_cacheableFeatureSetSourceKey",value:function(){return this._layer.url}},{key:"pbfSupportedForQuery",value:function(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF&&!0===this._layer.capabilities.query.supportsQuantizationEditMode}},{key:"queryPBF",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.quantizationParameters={mode:"edit"},e.next=3,(0,Z.d)(this._layer.parsedUrl,t,new T.a({}));case 3:return r=e.sent,e.abrupt("return",I.default.fromJSON((0,x.s)(r.data)).unquantize());case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"gdbVersion",get:function(){return this._layer&&this._layer.capabilities&&this._layer.capabilities.data&&this._layer.capabilities.data.isVersioned?this._layer.gdbVersion?this._layer.gdbVersion:"SDE.DEFAULT":""}},{key:"nativeCapabilities",value:function(){return{title:this._layer.title,source:this,canQueryRelated:!0,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:this._requestStandardised}}},{key:"executeQuery",value:function(e,t){var r=this,n="execute"===t?F.s:"executeForCount"===t?D.n:D.s,a="execute"===t&&this.pbfSupportedForQuery(e),i=null;if(this.recentlyUsedQueries){var s=this.convertQueryToLruCacheKey(e);null===(i=this.recentlyUsedQueries.getFromCache(s))&&(i=!0!==a?n(this._layer.parsedUrl.path,e):this.queryPBF(e),this.recentlyUsedQueries.addToCache(s,i),i=i.catch((function(e){throw r.recentlyUsedQueries.removeFromCache(s),e})))}return this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:e,method:t}),null===i&&(i=!0!==a?n(this._layer.parsedUrl.path,e):this.queryPBF(e)),i}},{key:"_getFilteredSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i){var s,l,o,c,d;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseType();case 2:if(s=e.sent,!this.isTable()||!r||null===t||""===t){e.next=5;break}return e.abrupt("return",new h.t([],[],!0,null));case 5:if(!this._canUsePagination()){e.next=7;break}return e.abrupt("return",this._getFilteredSetUsingPaging(t,r,n,a,i));case 7:return l="",o=!1,null!==a&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(l=a.constructClause(),o=!0),(c=new S.b).where=null===n?null===r?"1=1":"":(0,h.n)(n,s),this._requestStandardised&&(c.sqlFormat="standard"),c.spatialRelationship=this._makeRelationshipEnum(t),c.outSpatialReference=this.spatialReference,c.orderByFields=""!==l?l.split(","):null,c.geometry=null===r?null:r,c.relationParameter=this._makeRelationshipParam(t),e.next=13,this.executeQuery(c,"executeForIds");case 13:return null===(d=e.sent)&&(d=[]),this._checkCancelled(i),e.abrupt("return",new h.t([],d,o,null));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"_expandPagedSet",value:function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}},{key:"_getFilteredSetUsingPaging",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i){var s,l,o,c,d,f,p,y,v;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="",l=!1,null!==a&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(s=a.constructClause(),l=!0),e.next=4,this.databaseType();case 4:return o=e.sent,c=null===n?null===r?"1=1":"":(0,h.n)(n,o),this._layer.definitionExpression&&this._useDefinitionExpression&&(c=""!==c?"(("+this._layer.definitionExpression+") AND ("+c+"))":this._layer.definitionExpression),d=this._maxQueryRate(),void 0!==(f=this._layer.capabilities.query.maxRecordCount)&&f<d&&(d=f),p=null,!0===this._pageJustIds?p=new h.t([],["GETPAGES"],l,{spatialRel:this._makeRelationshipEnum(t),relationParam:this._makeRelationshipParam(t),outFields:this._layer.objectIdField,resultRecordCount:d,resultOffset:0,geometry:null===r?null:r,where:c,orderByFields:s,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}):(y=!0,!0===this._removeGeometry&&(y=!1),v=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),p=new h.t([],["GETPAGES"],l,{spatialRel:this._makeRelationshipEnum(t),relationParam:this._makeRelationshipParam(t),outFields:v.join(","),resultRecordCount:d,resultOffset:0,geometry:null===r?null:r,where:c,orderByFields:s,returnGeometry:y,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}})),e.next=14,this._expandPagedSet(p,d,0,1,i);case 14:return e.abrupt("return",p);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}},{key:"_getPhysicalPage",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var a,i,s,l,o,c,d;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.pagesDefinition.internal.lastRetrieved,i=a,s=t.pagesDefinition.internal.lastPage,l=new S.b,this._requestStandardised&&(l.sqlFormat="standard"),l.spatialRelationship=t.pagesDefinition.spatialRel,l.relationParameter=t.pagesDefinition.relationParam,l.outFields=t.pagesDefinition.outFields.split(","),l.num=t.pagesDefinition.resultRecordCount,l.start=t.pagesDefinition.internal.lastPage,l.geometry=t.pagesDefinition.geometry,l.where=t.pagesDefinition.where,l.orderByFields=""!==t.pagesDefinition.orderByFields?t.pagesDefinition.orderByFields.split(","):null,l.returnGeometry=t.pagesDefinition.returnGeometry,l.outSpatialReference=this.spatialReference,e.next=4,this.executeQuery(l,"execute");case 4:if(o=e.sent,this._checkCancelled(n),t.pagesDefinition.internal.lastPage===s){e.next=7;break}return e.abrupt("return","done");case 7:for(c=0;c<o.features.length;c++)t.pagesDefinition.internal.set[i+c]=o.features[c].attributes[this._layer.objectIdField];if(!1===this._pageJustIds)for(d=0;d<o.features.length;d++)this._featureCache[o.features[d].attributes[this._layer.objectIdField]]=o.features[d];return e.abrupt("return",((void 0===o.exceededTransferLimit&&o.features.length!==t.pagesDefinition.resultRecordCount||!1===o.exceededTransferLimit)&&(t.pagesDefinition.internal.fullyResolved=!0),t.pagesDefinition.internal.lastRetrieved=a+o.features.length,t.pagesDefinition.internal.lastPage+=t.pagesDefinition.resultRecordCount,"done"));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_fieldsIncludingObjectId",value:function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.includes("*"))return t;var r,n=!1,i=(0,a.Z)(t);try{for(i.s();!(r=i.n()).done;){if(r.value.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}}}catch(s){i.e(s)}finally{i.f()}return!1===n&&t.push(this.objectIdField),t}},{key:"_getFeatures",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a){var i,s,l,o,c,d,h,f,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],-1!==r&&void 0===this._featureCache[r]&&i.push(r),!0!==this._checkIfNeedToExpandKnownPage(t,this._maxProcessingRate())){e.next=5;break}return e.next=4,this._expandPagedSet(t,this._maxProcessingRate(),0,0,a);case 4:return e.abrupt("return",this._getFeatures(t,r,n,a));case 5:s=0,l=t._lastFetchedIndex;case 7:if(!(l<t._known.length)){e.next=18;break}if(t._lastFetchedIndex+=1,s++,void 0!==this._featureCache[t._known[l]]){e.next=13;break}if(o=!1,null!==this._layer._mode&&void 0!==this._layer._mode&&void 0!==(c=this._layer._mode)._featureMap[t._known[l]]&&null!==(d=c._featureMap[t._known[l]])&&(o=!0,this._featureCache[t._known[l]]=d),!(!1===o&&(t._known[l]!==r&&i.push(t._known[l]),i.length>=this._maxProcessingRate()-1))){e.next=13;break}return e.abrupt("break",18);case 13:if(!(s>=n&&0===i.length)){e.next=15;break}return e.abrupt("break",18);case 15:l++,e.next=7;break;case 18:if(0!==i.length){e.next=20;break}return e.abrupt("return","success");case 20:return h=new S.b,this._requestStandardised&&(h.sqlFormat="standard"),h.objectIds=i,h.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),h.returnGeometry=!0,!0===this._removeGeometry&&(h.returnGeometry=!1),h.outSpatialReference=this.spatialReference,e.next=24,this.executeQuery(h,"execute");case 24:if(f=e.sent,this._checkCancelled(a),void 0===f.error){e.next=27;break}throw new Error(f.error);case 27:for(p=0;p<f.features.length;p++)this._featureCache[f.features[p].attributes[this._layer.objectIdField]]=f.features[p];return e.abrupt("return","success");case 29:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"_getDistinctPages",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i,s,l,o,c){var d,f,p,y,v,_,g,m,b,k;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return e.next=4,this.databaseType();case 4:d=e.sent,f=n.parseTree.column,p=0;case 7:if(!(p<this._layer.fields.length)){e.next=14;break}if(this._layer.fields[p].name.toLowerCase()!==f.toLowerCase()){e.next=11;break}return f=this._layer.fields[p].name,e.abrupt("break",14);case 11:p++,e.next=7;break;case 14:return y=new S.b,this._requestStandardised&&(y.sqlFormat="standard"),v=null===s?null===i?"1=1":"":(0,h.n)(s,d),this._layer.definitionExpression&&this._useDefinitionExpression&&(v=""!==v?"(("+this._layer.definitionExpression+") AND ("+v+"))":this._layer.definitionExpression),y.where=v,y.spatialRelationship=this._makeRelationshipEnum(a),y.relationParameter=this._makeRelationshipParam(a),y.geometry=null===i?null:i,y.returnDistinctValues=!0,y.returnGeometry=!1,y.outFields=[f],e.next=20,this.executeQuery(y,"execute");case 20:if(_=e.sent,this._checkCancelled(c),_.hasOwnProperty("features")){e.next=23;break}throw new Error("Unnexected Result querying statistics from layer");case 23:g=!1,m=0;case 25:if(!(m<this._layer.fields.length)){e.next=32;break}if(this._layer.fields[m].name!==f){e.next=29;break}return"date"===this._layer.fields[m].type&&(g=!0),e.abrupt("break",32);case 29:m++,e.next=25;break;case 32:b=0;case 33:if(!(b<_.features.length)){e.next=40;break}if(g?null!==(k=_.features[b].attributes[f])?o.push(new Date(k)):o.push(k):o.push(_.features[b].attributes[f]),!(o.length>=l)){e.next=37;break}return e.abrupt("break",40);case 37:b++,e.next=33;break;case 40:if(0!==_.features.length){e.next=42;break}return e.abrupt("return",o);case 42:if(!(_.features.length===this._layer.capabilities.query.maxRecordCount&&o.length<l)){e.next=48;break}return e.t0=!0,e.next=46,this._getDistinctPages(t+_.features.length,r,n,a,i,s,l,o,c);case 46:return e.t1=e.sent,e.abrupt("return",{calculated:e.t0,result:e.t1});case 48:return e.abrupt("return",o);case 49:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i,s,u,l,o){return e.apply(this,arguments)}}()},{key:"_distinctStat",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i,s,l){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=!0,e.next=3,this._getDistinctPages(0,t,r,n,a,i,s,[],l);case 3:return e.t1=e.sent,e.abrupt("return",{calculated:e.t0,result:e.t1});case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i,s,u){return e.apply(this,arguments)}}()},{key:"isTable",value:function(){return this._layer.isTable||null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType}},{key:"_countstat",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a){var i,s,l;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseType();case 2:if(i=e.sent,s=new S.b,this._requestStandardised&&(s.sqlFormat="standard"),!this.isTable()||!n||null===r||""===r){e.next=6;break}return e.abrupt("return",{calculated:!0,result:0});case 6:return l=null===a?null===n?"1=1":"":(0,h.n)(a,i),this._layer.definitionExpression&&this._useDefinitionExpression&&(l=""!==l?"(("+this._layer.definitionExpression+") AND ("+l+"))":this._layer.definitionExpression),s.where=l,s.where=l,s.spatialRelationship=this._makeRelationshipEnum(r),s.relationParameter=this._makeRelationshipParam(r),s.geometry=null===n?null:n,s.returnGeometry=!1,e.t0=!0,e.next=11,this.executeQuery(s,"executeForCount");case 11:return e.t1=e.sent,e.abrupt("return",{calculated:e.t0,result:e.t1});case 13:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"_stats",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i,s,l){var o,c,d,f,p,y,v,_,g,m,b,k;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:if(o=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression,c=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics,d=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsDistinct,"count"!==t){e.next=5;break}return e.abrupt("return",d?this._countstat(t,n,a,i):{calculated:!1});case 5:if(!1!==c&&(!1!==(0,h.E)(r)||!1!==o)&&!1!==r.isStandardized){e.next=7;break}return e.abrupt("return",""!==n||null!==i?{calculated:!1}:this._manualStat(t,r,s,l));case 7:if("distinct"!==t){e.next=9;break}return e.abrupt("return",!1===d?""!==n||null!==i?{calculated:!1}:this._manualStat(t,r,s,l):this._distinctStat(t,r,n,a,i,s,l));case 9:return e.next=11,this.databaseType();case 11:if(f=e.sent,!this.isTable()||!a||null===n||""===n){e.next=14;break}return e.abrupt("return",{calculated:!0,result:null});case 14:return p=new S.b,this._requestStandardised&&(p.sqlFormat="standard"),y=null===i?null===a?"1=1":"":(0,h.n)(i,f),this._layer.definitionExpression&&this._useDefinitionExpression&&(y=""!==y?"(("+this._layer.definitionExpression+") AND ("+y+"))":this._layer.definitionExpression),p.where=y,p.spatialRelationship=this._makeRelationshipEnum(n),p.relationParameter=this._makeRelationshipParam(n),p.geometry=null===a?null:a,(v=new S.m).statisticType=(0,h.c)(t),v.onStatisticField=(0,h.n)(r,f),v.outStatisticFieldName="ARCADE_STAT_RESULT",p.returnGeometry=!1,_="ARCADE_STAT_RESULT",p.outStatistics=[v],e.next=24,this.executeQuery(p,"execute");case 24:if((g=e.sent).hasOwnProperty("features")&&0!==g.features.length){e.next=27;break}throw new Error("Unnexected Result querying statistics from layer");case 27:m=!1,b=0;case 29:if(!(b<g.fields.length)){e.next=36;break}if("ARCADE_STAT_RESULT"!==g.fields[b].name.toUpperCase()){e.next=33;break}return _=g.fields[b].name,"date"===g.fields[b].type&&(m=!0),e.abrupt("break",36);case 33:b++,e.next=29;break;case 36:if(!m){e.next=39;break}return k=g.features[0].attributes[_],e.abrupt("return",(null!==k&&(k=new Date(g.features[0].attributes[_])),{calculated:!0,result:k}));case 39:return e.abrupt("return",{calculated:!0,result:g.features[0].attributes[_]});case 40:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i,s,u){return e.apply(this,arguments)}}()},{key:"_stat",value:function(e,t,r,n,a,i,s){return this._stats(e,t,r,n,a,i,s)}},{key:"_canDoAggregates",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r){var n,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:if(n=!1,a=this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsSqlExpression,void 0!==this._layer.capabilities&&null!==this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsStatistics&&!0===this._layer.capabilities.query.supportsOrderBy&&(n=!0),n)for(i=0;i<r.length-1;i++)null!==r[i].workingexpr&&(!1===r[i].workingexpr.isStandardized||!1===(0,h.E)(r[i].workingexpr)&&!1===a)&&(n=!1);return e.abrupt("return",!1!==n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_makeRelationshipEnum",value:function(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}},{key:"_makeRelationshipParam",value:function(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}},{key:"_getAggregatePagesDataSourceDefinition",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i,s,l){var o,c,d,f,p,y,v,_,g,m;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._ensureLoaded();case 2:return e.next=4,this.databaseType();case 4:for(o=e.sent,c="",d=!1,f=!1,null!==s&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(c=s.constructClause(),f=!0),this._layer.capabilities&&this._layer.capabilities.query&&!1===this._layer.capabilities.query.supportsPagination&&(f=!1,d=!0,c=this._layer.objectIdField),p=[],y=0;y<r.length;y++)(v=new S.m).onStatisticField=null!==r[y].workingexpr?(0,h.n)(r[y].workingexpr,o):"",v.outStatisticFieldName=r[y].field,v.statisticType=r[y].toStatisticsName(),p.push(v);return""===c&&(c=t.join(",")),_=this._maxQueryRate(),void 0!==(g=this._layer.capabilities.query.maxRecordCount)&&g<_&&(_=g),m=null===i?null===a?"1=1":"":(0,h.n)(i,o),this._layer.definitionExpression&&this._useDefinitionExpression&&(m=""!==m?"(("+this._layer.definitionExpression+") AND ("+m+"))":this._layer.definitionExpression),e.abrupt("return",new h.t([],["GETPAGES"],f,{groupbypage:!0,spatialRel:this._makeRelationshipEnum(n),relationParam:this._makeRelationshipParam(n),outFields:["*"],useOIDpagination:d,generatedOid:l,resultRecordCount:_,resultOffset:0,groupByFieldsForStatistics:t,outStatistics:p,geometry:null===a?null:a,where:m,orderByFields:c,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i,s,u){return e.apply(this,arguments)}}()},{key:"_getAgregagtePhysicalPage",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var a,i,s,l,o,c,d,h,f;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.pagesDefinition.where,!0===t.pagesDefinition.useOIDpagination&&(a=""!==a?"("+a+") AND ("+t.pagesDefinition.generatedOid+">"+t.pagesDefinition.internal.lastMaxId.toString()+")":t.pagesDefinition.generatedOid+">"+t.pagesDefinition.internal.lastMaxId.toString()),i=t.pagesDefinition.internal.lastRetrieved,s=i,l=t.pagesDefinition.internal.lastPage,o=new S.b,this._requestStandardised&&(o.sqlFormat="standard"),o.where=a,o.spatialRelationship=t.pagesDefinition.spatialRel,o.relationParameter=t.pagesDefinition.relationParam,o.outFields=t.pagesDefinition.outFields,o.outStatistics=t.pagesDefinition.outStatistics,o.geometry=t.pagesDefinition.geometry,o.groupByFieldsForStatistics=t.pagesDefinition.groupByFieldsForStatistics,o.num=t.pagesDefinition.resultRecordCount,o.start=t.pagesDefinition.internal.lastPage,o.returnGeometry=t.pagesDefinition.returnGeometry,o.orderByFields=""!==t.pagesDefinition.orderByFields?t.pagesDefinition.orderByFields.split(","):null,!(this.isTable()&&o.geometry&&o.spatialRelationship)){e.next=5;break}return e.abrupt("return",[]);case 5:return e.next=7,this.executeQuery(o,"execute");case 7:if(c=e.sent,this._checkCancelled(n),c.hasOwnProperty("features")){e.next=10;break}throw new Error("Unnexected Result querying aggregates from layer");case 10:if(d=[],t.pagesDefinition.internal.lastPage===l){e.next=13;break}return e.abrupt("return",[]);case 13:for(h=0;h<c.features.length;h++)t.pagesDefinition.internal.set[s+h]=c.features[h].attributes[t.pagesDefinition.generatedOid];for(f=0;f<c.features.length;f++)d.push(new v.g({attributes:c.features[f].attributes,geometry:null}));return e.abrupt("return",(!0===t.pagesDefinition.useOIDpagination?0===c.features.length?t.pagesDefinition.internal.fullyResolved=!0:t.pagesDefinition.internal.lastMaxId=c.features[c.features.length-1].attributes[t.pagesDefinition.generatedOid]:(void 0===c.exceededTransferLimit&&c.features.length!==t.pagesDefinition.resultRecordCount||!1===c.exceededTransferLimit)&&(t.pagesDefinition.internal.fullyResolved=!0),t.pagesDefinition.internal.lastRetrieved=i+c.features.length,t.pagesDefinition.internal.lastPage+=t.pagesDefinition.resultRecordCount,d));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"relationshipMetaData",value:function(){return this._layer&&this._layer.source&&this._layer.source.sourceJSON&&this._layer.source.sourceJSON.relationships?this._layer.source.sourceJSON.relationships:[]}},{key:"serviceUrl",value:function(){return(0,f.a8)(this._layer.parsedUrl.path)}},{key:"queryAttachments",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i){var s,l,o,c=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._layer.capabilities.data.supportsAttachment||!this._layer.capabilities.operations.supportsQueryAttachments){e.next=8;break}return s={objectIds:[t],returnMetadata:i},(r&&r>0||n&&n>0)&&(s.size=[r&&r>0?r:0,n&&n>0?n:r+1]),a&&a.length>0&&(s.attachmentTypes=a),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:s,method:"attachments"}),e.next=5,this._layer.queryAttachments(s);case 5:return l=e.sent,o=[],e.abrupt("return",(l&&l[t]&&l[t].forEach((function(e){var r=c._layer.parsedUrl.path+"/"+t.toString()+"/attachments/"+e.id.toString(),n=null;i&&e.exifInfo&&(n=_.d.convertJsonToArcade(e.exifInfo,!0)),o.push(new _.e(e.id,e.name,e.contentType,e.size,r,n))})),o));case 8:return e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"queryRelatedFeatures",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r,n,i,s,l,o,c,h,f,p,y,_,g,m;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={f:"json",relationshipId:t.relationshipId.toString(),definitionExpression:t.where,outFields:t.outFields.join(","),returnGeometry:t.returnGeometry.toString()},void 0!==t.resultOffset&&null!==t.resultOffset&&(r.resultOffset=t.resultOffset.toString()),void 0!==t.resultRecordCount&&null!==t.resultRecordCount&&(r.resultRecordCount=t.resultRecordCount.toString()),t.orderByFields&&(r.orderByFields=t.orderByFields.join(",")),t.objectIds.length>0&&(r.objectIds=t.objectIds.join(",")),t.outSpatialReference&&(r.outSR=JSON.stringify(t.outSpatialReference.toJSON())),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preRequestCallback({layer:this._layer,queryPayload:r,method:"relatedrecords",url:this._layer.parsedUrl.path+"/queryRelatedRecords"}),e.next=4,(0,d.U)(this._layer.parsedUrl.path+"/queryRelatedRecords",{responseType:"json",query:r});case 4:if(!(n=e.sent).data){e.next=9;break}if(i={},(s=n.data)&&s.relatedRecordGroups){l=s.spatialReference,o=(0,a.Z)(s.relatedRecordGroups);try{for(o.s();!(c=o.n()).done;){h=c.value,f=h.objectId,p=[],y=(0,a.Z)(h.relatedRecords);try{for(y.s();!(_=y.n()).done;)(g=_.value).geometry&&(g.geometry.spatialReference=l),m=new v.g({geometry:g.geometry?(0,k.d)(g.geometry):null,attributes:g.attributes}),p.push(m)}catch(u){y.e(u)}finally{y.f()}i[f]={features:p,exceededTransferLimit:!0===s.exceededTransferLimit}}}catch(u){o.e(u)}finally{o.f()}}return e.abrupt("return",i);case 9:throw new Error("Invalid Request");case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFeatureByObjectId",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r){var n,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new S.b).outFields=r,n.returnGeometry=!1,n.outSpatialReference=this.spatialReference,n.where=this.objectIdField+"="+t.toString(),this.featureSetQueryInterceptor&&this.featureSetQueryInterceptor.preLayerQueryCallback({layer:this._layer,query:n,method:"execute"}),e.next=4,(0,F.s)(this._layer.parsedUrl.path,n);case 4:return a=e.sent,e.abrupt("return",1===a.features.length?a.features[0]:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getIdentityUser",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){var t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return t=null===d.a||void 0===d.a?void 0:d.a.findCredential(this._layer.url),e.abrupt("return",t?t.userId:null);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getOwningSystemUrl",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){var t,r,n,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:if(!(t=null===d.a||void 0===d.a?void 0:d.a.findServerInfo(this._layer.url))){e.next=5;break}return e.abrupt("return",t.owningSystemUrl);case 5:if(r=this._layer.url,n=r.toLowerCase().indexOf("/rest/services"),!(r=n>-1?r.substring(0,n):r)){e.next=20;break}return r+="/rest/info",e.prev=9,e.next=12,(0,d.U)(r,{query:{f:"json"}});case 12:return a=e.sent,i="",e.abrupt("return",(a.data&&a.data.owningSystemUrl&&(i=a.data.owningSystemUrl),i));case 17:return e.prev=17,e.t0=e.catch(9),e.abrupt("return","");case 20:return e.abrupt("return","");case 21:case"end":return e.stop()}}),e,this,[[9,17]])})));return function(){return e.apply(this,arguments)}}()},{key:"getDataSourceFeatureSet",value:function(){var e=new r({layer:this._layer,spatialReference:this.spatialReference,outFields:this._overrideFields,includeGeometry:!this._removeGeometry,lrucache:this.recentlyUsedQueries,interceptor:this.featureSetQueryInterceptor});return e._useDefinitionExpression=!1,e}}],[{key:"create",value:function(e,t,n,a,i){return new r({layer:new w.K({url:e,outFields:null===t?["*"]:t}),spatialReference:n,lrucache:a,interceptor:i})}}]),r}(h.k),H=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",n._removeGeometry=!1,n._overrideFields=null,n._forceIsTable=!1,e.spatialReference&&(n.spatialReference=e.spatialReference),n._transparent=!0,n._maxProcessing=1e3,n._layer=e.layer,n._wset=null,!0===e.isTable&&(n._forceIsTable=!0),void 0!==e.outFields&&(n._overrideFields=e.outFields),void 0!==e.includeGeometry&&(n._removeGeometry=!1===e.includeGeometry),n}return(0,c.Z)(r,[{key:"_maxQueryRate",value:function(){return f.a6}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"loadImpl",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this._layer.loaded){e.next=4;break}e.t0=(this._initialiseFeatureSet(),this),e.next=8;break;case 4:return e.next=6,this._layer.load();case 6:this._initialiseFeatureSet(),e.t0=this;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"gdbVersion",get:function(){return""}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{var e,t=[],r=(0,a.Z)(this.fields);try{for(r.s();!(e=r.n()).done;){var n=e.value;if("oid"===n.type)t.push(n);else{var i,s=(0,a.Z)(this._layer.outFields);try{for(s.s();!(i=s.n()).done;){if(i.value.toLowerCase()===n.name.toLowerCase()){t.push(n);break}}}catch(g){s.e(g)}finally{s.f()}}}}catch(g){r.e(g)}finally{r.f()}this.fields=t}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var u,l=[],o=[],c=(0,a.Z)(this.fields);try{for(c.s();!(u=c.n()).done;){var d=u.value;if("oid"===d.type)l.push(d),o.push(d.name);else{var h,p=(0,a.Z)(this._overrideFields);try{for(p.s();!(h=p.n()).done;){if(h.value.toLowerCase()===d.name.toLowerCase()){l.push(d),o.push(d.name);break}}}catch(g){p.e(g)}finally{p.f()}}}}catch(g){c.e(g)}finally{c.f()}this.fields=l,this._overrideFields=o}this.objectIdField=this._layer.objectIdField;var y,v=(0,a.Z)(this.fields);try{for(v.s();!(y=v.n()).done;){var _=y.value;"global-id"===_.type&&(this.globalIdField=_.name)}}catch(g){v.e(g)}finally{v.f()}this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=f.a4.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types}},{key:"isTable",value:function(){return this._forceIsTable||this._layer.isTable||"table"===this._layer.type||!this._layer.geometryType}},{key:"_isInFeatureSet",value:function(){return f.a2.InFeatureSet}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._getFilteredSet("",null,null,null,t);case 5:return r=e.sent,e.abrupt("return",(this._wset=r,r));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_changeFeature",value:function(e){var t,r={},n=(0,a.Z)(this.fields);try{for(n.s();!(t=n.n()).done;){var i=t.value;r[i.name]=e.attributes[i.name]}}catch(s){n.e(s)}finally{n.f()}return new v.g({geometry:!0===this._removeGeometry?null:e.geometry,attributes:r})}},{key:"_getFilteredSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i){var s,l,o,c,d,p=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="",l=!1,null!==a&&(s=a.constructClause(),l=!0),!this.isTable()||!r||null===t||""===t){e.next=3;break}return e.abrupt("return",new h.t([],[],!0,null));case 3:return(o=new S.b).where=null===n?null===r?"1=1":"":(0,h.n)(n,f.a4.Standardised),o.spatialRelationship=this._makeRelationshipEnum(t),o.outSpatialReference=this.spatialReference,o.orderByFields=""!==s?s.split(","):null,o.geometry=null===r?null:r,o.returnGeometry=!0,o.relationParameter=this._makeRelationshipParam(t),e.next=7,this._layer.queryFeatures(o);case 7:if(null!==(c=e.sent)){e.next=10;break}return e.abrupt("return",new h.t([],[],l,null));case 10:return this._checkCancelled(i),d=[],c.features.forEach((function(e){var t=e.attributes[p._layer.objectIdField];d.push(t),p._featureCache[t]=p._changeFeature(e)})),e.abrupt("return",new h.t([],d,l,null));case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"_makeRelationshipEnum",value:function(e){if(e.includes("esriSpatialRelRelation"))return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e}},{key:"_makeRelationshipParam",value:function(e){return e.includes("esriSpatialRelRelation")?e.split(":")[1]:""}},{key:"_queryAllFeatures",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){var t,r,n,a,i=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._wset){e.next=2;break}return e.abrupt("return",this._wset);case 2:return(t=new S.b).where="1=1",e.next=6,this._ensureLoaded();case 6:if(!this._layer.source||!this._layer.source.items){e.next=9;break}return r=[],e.abrupt("return",(this._layer.source.items.forEach((function(e){var t=e.attributes[i._layer.objectIdField];r.push(t),i._featureCache[t]=i._changeFeature(e)})),this._wset=new h.t([],r,!1,null),this._wset));case 9:return e.next=11,this._layer.queryFeatures(t);case 11:return n=e.sent,a=[],e.abrupt("return",(n.features.forEach((function(e){var t=e.attributes[i._layer.objectIdField];a.push(t),i._featureCache[t]=i._changeFeature(e)})),this._wset=new h.t([],a,!1,null),this._wset));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getFeatures",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=[],-1!==r&&void 0===this._featureCache[r]&&a.push(r),i=t._lastFetchedIndex;i<t._known.length&&(t._lastFetchedIndex+=1,!(void 0===this._featureCache[t._known[i]]&&(t._known[i]!==r&&a.push(t._known[i]),a.length>n)));i++);if(0!==a.length){e.next=5;break}return e.abrupt("return","success");case 5:throw new Error("Unaccounted for Features. Not in Feature Collection");case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_refineSetBlock",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_stat",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{calculated:!1});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_canDoAggregates",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"relationshipMetaData",value:function(){return[]}},{key:"nativeCapabilities",value:function(){return{title:this._layer.title,canQueryRelated:!1,source:this,capabilities:this._layer.capabilities,databaseType:this._databaseType,requestStandardised:!0}}},{key:"queryAttachments",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[]);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getFeatureByObjectId",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new S.b).where=this.objectIdField+"="+t.toString(),e.next=4,this._layer.queryFeatures(r);case 4:return n=e.sent,e.abrupt("return",1===n.features.length?n.features[0]:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getOwningSystemUrl",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"getIdentityUser",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}],[{key:"_cloneAttr",value:function(e){var t={};for(var r in e)t[r]=e[r];return t}},{key:"create",value:function(e,t){var n=e.layerDefinition.objectIdField,i=e.layerDefinition.typeIdField?e.layerDefinition.typeIdField:"",s=[];if(e.layerDefinition.types){var u,l=(0,a.Z)(e.layerDefinition.types);try{for(l.s();!(u=l.n()).done;){var o=u.value;s.push(R.n.fromJSON(o))}}catch(j){l.e(j)}finally{l.f()}}var c=e.layerDefinition.geometryType;void 0===c&&(c=e.featureSet.geometryType||"");var d=e.featureSet.features,h=t.toJSON();if(""===n||void 0===n){var f,p=!1,v=(0,a.Z)(e.layerDefinition.fields);try{for(v.s();!(f=v.n()).done;){var _=f.value;if("oid"===_.type||"esriFieldTypeOID"===_.type){n=_.name,p=!0;break}}}catch(j){v.e(j)}finally{v.f()}if(!1===p){for(var g="FID",b=!0,k=0;b;){var x,S=!0,F=(0,a.Z)(e.layerDefinition.fields);try{for(F.s();!(x=F.n()).done;){if(x.value.name===g){S=!1;break}}}catch(j){F.e(j)}finally{F.f()}!0===S?b=!1:g="FID"+(++k).toString()}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:g,alias:g});for(var Z=[],I=0;I<d.length;I++)Z.push({geometry:e.featureSet.features[I].geometry,attributes:e.featureSet.features[I].attributes?this._cloneAttr(e.featureSet.features[I].attributes):{}}),Z[I].attributes[g]=I;d=Z,n=g}}var C,D=[],T=(0,a.Z)(e.layerDefinition.fields);try{for(T.s();!(C=T.n()).done;){var E=C.value;E instanceof m.y?D.push(E):D.push(m.y.fromJSON(E))}}catch(j){T.e(j)}finally{T.f()}var N=c;switch(N){case"esriGeometryPoint":N="point";break;case"esriGeometryPolyline":N="polyline";break;case"esriGeometryPolygon":N="polygon";break;case"esriGeometryExtent":N="extent";break;case"esriGeometryMultipoint":N="multipoint"}var A,L=(0,a.Z)(d);try{for(L.s();!(A=L.n()).done;){var O=A.value;O.geometry&&O.geometry instanceof y.p==0&&(O.geometry.type=N,void 0===O.geometry.spatialReference&&(O.geometry.spatialReference=h))}}catch(j){L.e(j)}finally{L.f()}var P={outFields:["*"],source:d,fields:D,types:s,typeIdField:i,objectIdField:n,spatialReference:t};return P.geometryType=N||"point",new r({layer:new w.K(P),spatialReference:t,isTable:null===N||""===N})}}]),r}(h.k),X=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",n._findObjectId=-1,n._requestStandardised=!1,n._removeGeometry=!1,n._overrideFields=null,n.featureObjectId=null,n.relatedLayer=null,n.relationship=null,e.spatialReference&&(n.spatialReference=e.spatialReference),n._transparent=!0,n._maxProcessing=1e3,n._layer=e.layer,n._wset=null,n._findObjectId=e.objectId,n.featureObjectId=e.objectId,n.relationship=e.relationship,n.relatedLayer=e.relatedLayer,void 0!==e.outFields&&(n._overrideFields=e.outFields),void 0!==e.includeGeometry&&(n._removeGeometry=!1===e.includeGeometry),n}return(0,c.Z)(r,[{key:"_maxQueryRate",value:function(){return f.a6}},{key:"end",value:function(){return this._layer}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"loadImpl",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._layer.load(),this.relatedLayer.load()]);case 2:return this._initialiseFeatureSet(),e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"nativeCapabilities",value:function(){return this.relatedLayer.nativeCapabilities()}},{key:"_initialiseFeatureSet",value:function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this.relatedLayer.geometryType,this.fields=this.relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{var e,t=[],r=[],n=(0,a.Z)(this.fields);try{for(n.s();!(e=n.n()).done;){var i=e.value;if("oid"===i.type)t.push(i),r.push(i.name);else{var s,u=(0,a.Z)(this._overrideFields);try{for(u.s();!(s=u.n()).done;){if(s.value.toLowerCase()===i.name.toLowerCase()){t.push(i),r.push(i.name);break}}}catch(o){u.e(o)}finally{u.f()}}}}catch(o){n.e(o)}finally{n.f()}this.fields=t,this._overrideFields=r}var l=this._layer.nativeCapabilities();l&&(this._databaseType=l.databaseType,this._requestStandardised=l.requestStandardised),this.objectIdField=this.relatedLayer.objectIdField,this.globalIdField=this.relatedLayer.globalIdField,this.hasM=this.relatedLayer.supportsM,this.hasZ=this.relatedLayer.supportsZ,this.typeIdField=this.relatedLayer.typeIdField,this.types=this.relatedLayer.types}},{key:"databaseType",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.relatedLayer.databaseType();case 2:return this._databaseType=this.relatedLayer._databaseType,e.abrupt("return",this._databaseType);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isTable",value:function(){return this.relatedLayer.isTable()}},{key:"_isInFeatureSet",value:function(){return f.a2.InFeatureSet}},{key:"_candidateIdTransform",value:function(e){return e}},{key:"_getSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._wset){e.next=7;break}return e.next=3,this._ensureLoaded();case 3:return e.next=5,this._getFilteredSet("",null,null,null,t);case 5:return r=e.sent,e.abrupt("return",(this._wset=r,r));case 7:return e.abrupt("return",this._wset);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_changeFeature",value:function(e){var t,r={},n=(0,a.Z)(this.fields);try{for(n.s();!(t=n.n()).done;){var i=t.value;r[i.name]=e.attributes[i.name]}}catch(s){n.e(s)}finally{n.f()}return new v.g({geometry:!0===this._removeGeometry?null:e.geometry,attributes:r})}},{key:"_getFilteredSet",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i){var s,l,o,c,d,f,p,y,v,_,g,m;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.databaseType();case 2:if(!this.isTable()||!r||null===t||""===t){e.next=4;break}return e.abrupt("return",new h.t([],[],!0,null));case 4:if(!1!==(s=this._layer.nativeCapabilities()).canQueryRelated){e.next=7;break}return e.abrupt("return",new h.t([],[],!0,null));case 7:if(!s.capabilities.queryRelated||!s.capabilities.queryRelated.supportsPagination){e.next=9;break}return e.abrupt("return",this._getFilteredSetUsingPaging(t,r,n,a,i));case 9:return l="",o=!1,null!==a&&s.capabilities&&s.capabilities.queryRelated&&!0===s.capabilities.queryRelated.supportsOrderBy&&(l=a.constructClause(),o=!0),(c=new C.d).objectIds=[this._findObjectId],d=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this.relatedLayer.fields?this.relatedLayer.fields.map((function(e){return e.name})):["*"]),c.outFields=d,c.relationshipId=this.relationship.id,c.where="1=1",f=!0,!0===this._removeGeometry&&(f=!1),c.returnGeometry=f,this._requestStandardised&&(c.sqlFormat="standard"),c.outSpatialReference=this.spatialReference,c.orderByFields=""!==l?l.split(","):null,e.next=19,s.source.queryRelatedFeatures(c);case 19:for(p=e.sent,this._checkCancelled(i),y=p[this._findObjectId]?p[this._findObjectId].features:[],v=[],_=0;_<y.length;_++)this._featureCache[y[_].attributes[this.relatedLayer.objectIdField]]=y[_],v.push(y[_].attributes[this.relatedLayer.objectIdField]);return g=r&&null!==t&&""!==t,m=null!=n,e.abrupt("return",new h.t(g||m?v:[],g||m?[]:v,o,null));case 25:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"_fieldsIncludingObjectId",value:function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.includes("*"))return t;var r,n=!1,i=(0,a.Z)(t);try{for(i.s();!(r=i.n()).done;){if(r.value.toUpperCase()===this.objectIdField.toUpperCase()){n=!0;break}}}catch(s){i.e(s)}finally{i.f()}return!1===n&&t.push(this.objectIdField),t}},{key:"_getFilteredSetUsingPaging",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i){var s,l,o,c,d,f,p,y,v,_;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="",l=!1,o=this._layer.nativeCapabilities(),null!==a&&o&&o.capabilities.queryRelated&&!0===o.capabilities.queryRelated.supportsOrderBy&&(s=a.constructClause(),l=!0),e.next=5,this.databaseType();case 5:return"1=1",c=this._maxQueryRate(),void 0!==(d=o.capabilities.query.maxRecordCount)&&d<c&&(c=d),f=r&&null!==t&&""!==t,p=null!=n,y=null,v=!0,!0===this._removeGeometry&&(v=!1),_=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this.relatedLayer.fields?this.relatedLayer.fields.map((function(e){return e.name})):["*"]),y=new h.t(f||p?["GETPAGES"]:[],f||p?[]:["GETPAGES"],l,{outFields:_.join(","),resultRecordCount:c,resultOffset:0,objectIds:[this._findObjectId],where:"1=1",orderByFields:s,returnGeometry:v,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,lastPage:0,fullyResolved:!1}}),e.next=16,this._expandPagedSet(y,c,0,0,i);case 16:return e.abrupt("return",y);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"_expandPagedSet",value:function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)}},{key:"_clonePageDefinition",value:function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}}},{key:"_getPhysicalPage",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var a,i,s,l,o,c,d,h,f,p;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.pagesDefinition.internal.lastRetrieved,i=a,s=t.pagesDefinition.internal.lastPage,l=this._layer.nativeCapabilities(),o=new C.d,!0===this._requestStandardised&&(o.sqlFormat="standard"),o.relationshipId=this.relationship.id,o.objectIds=t.pagesDefinition.objectIds,o.resultOffset=t.pagesDefinition.internal.lastPage,o.resultRecordCount=t.pagesDefinition.resultRecordCount,o.outFields=t.pagesDefinition.outFields.split(","),o.where=t.pagesDefinition.where,o.orderByFields=""!==t.pagesDefinition.orderByFields?t.pagesDefinition.orderByFields.split(","):null,o.returnGeometry=t.pagesDefinition.returnGeometry,o.outSpatialReference=this.spatialReference,e.next=4,l.source.queryRelatedFeatures(o);case 4:if(c=e.sent,this._checkCancelled(n),t.pagesDefinition.internal.lastPage===s){e.next=7;break}return e.abrupt("return",0);case 7:for(d=c[this._findObjectId]?c[this._findObjectId].features:[],h=0;h<d.length;h++)t.pagesDefinition.internal.set[i+h]=d[h].attributes[this.relatedLayer.objectIdField];for(f=0;f<d.length;f++)this._featureCache[d[f].attributes[this.relatedLayer.objectIdField]]=d[f];return p=!c[this._findObjectId]||!1===c[this._findObjectId].exceededTransferLimit,e.abrupt("return",(d.length!==t.pagesDefinition.resultRecordCount&&p&&(t.pagesDefinition.internal.fullyResolved=!0),t.pagesDefinition.internal.lastRetrieved=a+d.length,t.pagesDefinition.internal.lastPage+=t.pagesDefinition.resultRecordCount,d.length));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_getFeatures",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a){var i,s,l,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],-1!==r&&void 0===this._featureCache[r]&&i.push(r),s=this._maxQueryRate(),!0!==this._checkIfNeedToExpandKnownPage(t,s)){e.next=7;break}return e.next=6,this._expandPagedSet(t,s,0,0,a);case 6:return e.abrupt("return",this._getFeatures(t,r,n,a));case 7:for(l=0,o=t._lastFetchedIndex;o<t._known.length&&(++l<=n&&(t._lastFetchedIndex+=1),!("GETPAGES"!==t._known[o]&&void 0===this._featureCache[t._known[o]]&&(t._known[o]!==r&&i.push(t._known[o]),i.length>n)))&&!(l>=n&&0===i.length);o++);if(0!==i.length){e.next=11;break}return e.abrupt("return","success");case 11:throw new Error("Unaccounted for Features. Not in Feature Collection");case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"_refineSetBlock",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_stat",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i,s,l){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{calculated:!1});case 1:case"end":return e.stop()}}),e)})));return function(t,r,n,a,i,s,u){return e.apply(this,arguments)}}()},{key:"gdbVersion",get:function(){return this.relatedLayer.gdbVersion}},{key:"_canDoAggregates",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"relationshipMetaData",value:function(){return this.relatedLayer.relationshipMetaData()}},{key:"serviceUrl",value:function(){return this.relatedLayer.serviceUrl()}},{key:"queryAttachments",value:function(e,t,r,n,a){return this.relatedLayer.queryAttachments(e,t,r,n,a)}},{key:"getFeatureByObjectId",value:function(e,t){return this.relatedLayer.getFeatureByObjectId(e,t)}},{key:"getOwningSystemUrl",value:function(){return this.relatedLayer.getOwningSystemUrl()}},{key:"getIdentityUser",value:function(){return this.relatedLayer.getIdentityUser()}},{key:"getDataSourceFeatureSet",value:function(){return this.relatedLayer}}]),r}(h.k);function Y(e,t){return $.apply(this,arguments)}function $(){return $=(0,l.Z)((0,u.Z)().mark((function e(t,r){var n,a,i,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!h.e.applicationCache){e.next=22;break}if(!(n=h.e.applicationCache.getLayerInfo(t))){e.next=7;break}return e.next=5,n;case 5:return a=e.sent,e.abrupt("return",new w.K({url:t,outFields:r,sourceJSON:a}));case 7:if(i=new w.K({url:t,outFields:r}),s=(0,l.Z)((0,u.Z)().mark((function e(){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.load();case 2:return e.abrupt("return",i.sourceJSON);case 3:case"end":return e.stop()}}),e)})))(),!h.e.applicationCache){e.next=19;break}return h.e.applicationCache.setLayerInfo(t,s),e.prev=10,e.next=13,s;case 13:case 21:return e.abrupt("return",i);case 16:throw e.prev=16,e.t0=e.catch(10),h.e.applicationCache.clearLayerInfo(t),e.t0;case 19:return e.next=21,s;case 22:return e.abrupt("return",new w.K({url:t,outFields:r}));case 23:case"end":return e.stop()}}),e,null,[[10,16]])}))),$.apply(this,arguments)}function ee(e,t,r,n,a){return te.apply(this,arguments)}function te(){return te=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i){var s,l=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=l.length>5&&void 0!==l[5]?l[5]:null,e.t0=re,e.next=4,Y(t,["*"]);case 4:return e.t1=e.sent,e.t2=r,e.t3=n,e.t4=a,e.t5=i,e.t6=s,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3,e.t4,e.t5,e.t6));case 11:case"end":return e.stop()}}),e)}))),te.apply(this,arguments)}function re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return!0===e._hasMemorySource()?new H({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a,interceptor:i}):new J({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a,interceptor:i})}function ne(e){return ae.apply(this,arguments)}function ae(){return ae=(0,l.Z)((0,u.Z)().mark((function e(t){var r,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===h.e.applicationCache){e.next=4;break}if(null===(r=h.e.applicationCache.getLayerInfo(t))){e.next=4;break}return e.abrupt("return",r);case 4:if(n=(0,l.Z)((0,u.Z)().mark((function e(){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.U)(t,{responseType:"json",query:{f:"json"}});case 2:return r=e.sent,e.abrupt("return",r.data?r.data:null);case 4:case"end":return e.stop()}}),e)})))(),null===h.e.applicationCache){e.next=16;break}return h.e.applicationCache.setLayerInfo(t,n),e.prev=7,e.next=10,n;case 10:return e.abrupt("return",e.sent);case 13:throw e.prev=13,e.t0=e.catch(7),h.e.applicationCache.clearLayerInfo(t),e.t0;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,null,[[7,13]])}))),ae.apply(this,arguments)}function ie(e,t){return se.apply(this,arguments)}function se(){return se=(0,l.Z)((0,u.Z)().mark((function e(t,r){var n,a,i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="QUERYDATAELEMTS:"+r.toString()+":"+t,null===h.e.applicationCache){e.next=5;break}if(null===(a=h.e.applicationCache.getLayerInfo(n))){e.next=5;break}return e.abrupt("return",a);case 5:if(i=(0,l.Z)((0,u.Z)().mark((function e(){var n,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.U)(t+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([r.toString()]),f:"json"}});case 2:if(!(n=e.sent).data){e.next=7;break}if(!(a=n.data).layerDataElements||!a.layerDataElements[0]){e.next=7;break}return e.abrupt("return",a.layerDataElements[0]);case 7:throw new Error("Not Found");case 8:case"end":return e.stop()}}),e)})))(),null===h.e.applicationCache){e.next=17;break}return h.e.applicationCache.setLayerInfo(n,i),e.prev=8,e.next=11,i;case 11:return e.abrupt("return",e.sent);case 14:throw e.prev=14,e.t0=e.catch(8),h.e.applicationCache.clearLayerInfo(n),e.t0;case 17:return e.abrupt("return",i);case 18:case"end":return e.stop()}}),e,null,[[8,14]])}))),se.apply(this,arguments)}function ue(e){return le.apply(this,arguments)}function le(){return le=(0,l.Z)((0,u.Z)().mark((function e(t){var r,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===h.e.applicationCache){e.next=4;break}if(null===(r=h.e.applicationCache.getLayerInfo(t))){e.next=4;break}return e.abrupt("return",r);case 4:if(n=(0,l.Z)((0,u.Z)().mark((function e(){var r,n;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.U)(t,{responseType:"json",query:{f:"json"}});case 2:if(!(r=e.sent).data){e.next=6;break}return n=r.data,e.abrupt("return",(n.layers||(n.layers=[]),n.tables||(n.tables=[]),n));case 6:return e.abrupt("return",{layers:[],tables:[]});case 7:case"end":return e.stop()}}),e)})))(),null===h.e.applicationCache){e.next=16;break}return h.e.applicationCache.setLayerInfo(t,n),e.prev=7,e.next=10,n;case 10:return e.abrupt("return",e.sent);case 13:throw e.prev=13,e.t0=e.catch(7),h.e.applicationCache.clearLayerInfo(t),e.t0;case 16:return e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,null,[[7,13]])}))),le.apply(this,arguments)}function oe(e,t){return ce.apply(this,arguments)}function ce(){return ce=(0,l.Z)((0,u.Z)().mark((function e(t,r){var n,i,s,l,o,c,d,h,f,y,v,_,g,m,b,k,w,x,S,F,Z,I,C,D,T,R,E,N,A,L;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null},e.next=3,ue(t);case 3:if(i=e.sent,n.metadata=i,!i.controllerDatasetLayers||void 0===i.controllerDatasetLayers.utilityNetworkLayerId||null===i.controllerDatasetLayers.utilityNetworkLayerId){e.next=36;break}if(i.layers){s=(0,a.Z)(i.layers);try{for(s.s();!(l=s.n()).done;)o=l.value,n.layerNameLkp[o.id]=o.name}catch(u){s.e(u)}finally{s.f()}}if(i.tables){c=(0,a.Z)(i.tables);try{for(c.s();!(d=c.n()).done;)h=d.value,n.layerNameLkp[h.id]=h.name}catch(u){c.e(u)}finally{c.f()}}return f=i.controllerDatasetLayers.utilityNetworkLayerId,n.networkId=f,e.next=11,ie(t,f);case 11:if(!(y=e.sent)){e.next=35;break}n.queryelem=y,n.queryelem&&n.queryelem.dataElement&&void 0!==n.queryelem.dataElement.schemaGeneration&&(n.unVersion=n.queryelem.dataElement.schemaGeneration),n.lkp={},n.queryelem.dataElement.domainNetworks||(n.queryelem.dataElement.domainNetworks=[]),v=(0,a.Z)(n.queryelem.dataElement.domainNetworks);try{for(v.s();!(_=v.n()).done;){g=_.value,m=(0,a.Z)(g.edgeSources?g.edgeSources:[]);try{for(m.s();!(b=m.n()).done;)k=b.value,(w={layerId:k.layerId,sourceId:k.sourceId,className:n.layerNameLkp[k.layerId]?n.layerNameLkp[k.layerId]:null}).className&&(n.lkp[w.className]=w)}catch(u){m.e(u)}finally{m.f()}x=(0,a.Z)(g.junctionSources?g.junctionSources:[]);try{for(x.s();!(S=x.n()).done;)F=S.value,(Z={layerId:F.layerId,sourceId:F.sourceId,className:n.layerNameLkp[F.layerId]?n.layerNameLkp[F.layerId]:null}).className&&(n.lkp[Z.className]=Z)}catch(u){x.e(u)}finally{x.f()}}}catch(u){v.e(u)}finally{v.f()}if(n.queryelem.dataElement.terminalConfigurations){I=(0,a.Z)(n.queryelem.dataElement.terminalConfigurations);try{for(I.s();!(C=I.n()).done;){D=C.value,T=(0,a.Z)(D.terminals);try{for(T.s();!(R=T.n()).done;)E=R.value,n.terminals.push({terminalId:E.terminalId,terminalName:E.terminalName})}catch(u){T.e(u)}finally{T.f()}}}catch(u){I.e(u)}finally{I.f()}}return e.next=19,ne(t+"/"+f);case 19:if(!(N=e.sent).systemLayers||void 0===N.systemLayers.associationsTableId||null===N.systemLayers.associationsTableId){e.next=34;break}return A=[],n.unVersion>=4&&(A.push("STATUS"),A.push("PERCENTALONG")),e.next=25,ee(t+"/"+N.systemLayers.associationsTableId.toString(),r,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID"].concat(A),!1,null,null);case 25:return L=e.sent,e.next=28,L.load();case 28:if(e.t0=n.unVersion>=4,!e.t0){e.next=33;break}return L=L.filter(p.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",L.getFieldsIndex())),e.next=33,L.load();case 33:return e.abrupt("return",{lkp:n.lkp,associations:L,unVersion:n.unVersion,terminals:n.terminals});case 34:case 35:case 36:return e.abrupt("return",{associations:null,unVersion:n.unVersion,lkp:null,terminals:[]});case 37:case"end":return e.stop()}}),e)}))),ce.apply(this,arguments)}function de(e,t,r){return he.apply(this,arguments)}function he(){return he=(0,l.Z)((0,u.Z)().mark((function e(t,r,n){var a,i,s,l,o,c,d,h=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=h.length>3&&void 0!==h[3]?h[3]:null,i=h.length>4&&void 0!==h[4]?h[4]:null,s=!(h.length>5&&void 0!==h[5])||h[5],l=h.length>6&&void 0!==h[6]?h[6]:null,o=h.length>7&&void 0!==h[7]?h[7]:null,c=t.serviceUrl()){e.next=8;break}return e.abrupt("return",null);case 8:return c="/"===c.charAt(c.length-1)?c+r.relatedTableId.toString():c+"/"+r.relatedTableId.toString(),e.next=11,ee(c,a,i,s,l,o);case 11:return d=e.sent,e.abrupt("return",new X({layer:t,relatedLayer:d,relationship:r,objectId:n,spatialReference:a,outFields:i,includeGeometry:s,lrucache:l,interceptor:o}));case 13:case"end":return e.stop()}}),e)}))),he.apply(this,arguments)}L.registerAction(),V.registerAction(),M.registerAction(),h.d.registerAction(),z.registerAction();var fe=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return(0,o.Z)(this,r),(n=t.call(this))._map=e,n._overridespref=a,n.lrucache=i,n.interceptor=s,n._instantLayers=[],n}return(0,c.Z)(r,[{key:"_makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=re(e,this._overridespref,null===r?["*"]:r,t,this.lrucache,this.interceptor);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}},{key:"featureSetByName",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r,a,i,s,l,o,c,d,h=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(h.length>1&&void 0!==h[1])||h[1],a=h.length>2&&void 0!==h[2]?h[2]:null,void 0===this._map.loaded||void 0===this._map.load||!1!==this._map.loaded){e.next=6;break}return e.next=5,this._map.load();case 5:return e.abrupt("return",this.featureSetByName(t,r,a));case 6:null===a&&(a=["*"]),a=(a=a.slice(0)).sort(),i=JSON.stringify(a),s=0;case 9:if(!(s<this._instantLayers.length)){e.next=16;break}if((l=this._instantLayers[s]).opitem.title!==t||l.includeGeometry!==r||l.outFields!==i){e.next=13;break}return e.abrupt("return",this._instantLayers[s].featureset);case 13:s++,e.next=9;break;case 16:if(o=this._map.allLayers.find((function(e){return e instanceof w.K&&e.title===t})),!o){e.next=19;break}return e.abrupt("return",this._makeAndAddFeatureSet(o,r,a));case 19:if(!this._map.tables){e.next=28;break}if(c=this._map.tables.find((function(e){return!!(e.title&&e.title===t||e.title&&e.title===t)})),!c){e.next=28;break}if(!(c instanceof w.K)){e.next=24;break}return e.abrupt("return",this._makeAndAddFeatureSet(c,r,a));case 24:return c._materializedTable||(d=c.outFields?c:(0,n.Z)((0,n.Z)({},c),{},{outFields:["*"]}),c._materializedTable=new w.K(d)),e.next=27,c._materializedTable.load();case 27:return e.abrupt("return",this._makeAndAddFeatureSet(c._materializedTable,r,a));case 28:return e.abrupt("return",null);case 29:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"featureSetById",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r,a,i,s,l,o,c,d,h=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(h.length>1&&void 0!==h[1])||h[1],a=h.length>2&&void 0!==h[2]?h[2]:["*"],void 0===this._map.loaded||void 0===this._map.load||!1!==this._map.loaded){e.next=6;break}return e.next=5,this._map.load();case 5:return e.abrupt("return",this.featureSetById(t,r,a));case 6:null===a&&(a=["*"]),a=(a=a.slice(0)).sort(),i=JSON.stringify(a),s=0;case 9:if(!(s<this._instantLayers.length)){e.next=16;break}if((l=this._instantLayers[s]).opitem.id!==t||l.includeGeometry!==r||l.outFields!==i){e.next=13;break}return e.abrupt("return",this._instantLayers[s].featureset);case 13:s++,e.next=9;break;case 16:if(o=this._map.allLayers.find((function(e){return e instanceof w.K&&e.id===t})),!o){e.next=19;break}return e.abrupt("return",this._makeAndAddFeatureSet(o,r,a));case 19:if(!this._map.tables){e.next=28;break}if(c=this._map.tables.find((function(e){return e.id===t})),!c){e.next=28;break}if(!(c instanceof w.K)){e.next=24;break}return e.abrupt("return",this._makeAndAddFeatureSet(c,r,a));case 24:return c._materializedTable||(d=(0,n.Z)((0,n.Z)({},c),{},{outFields:["*"]}),c._materializedTable=new w.K(d)),e.next=27,c._materializedTable.load();case 27:return e.abrupt("return",this._makeAndAddFeatureSet(c._materializedTable,r,a));case 28:return e.abrupt("return",null);case 29:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(A),pe=function(e){(0,i.Z)(r,e);var t=(0,s.Z)(r);function r(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return(0,o.Z)(this,r),(n=t.call(this))._url=e,n._overridespref=a,n.lrucache=i,n.interceptor=s,n.metadata=null,n._instantLayers=[],n}return(0,c.Z)(r,[{key:"url",get:function(){return this._url}},{key:"_makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=re(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}},{key:"_loadMetaData",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(){var t;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue(this._url);case 2:return t=e.sent,e.abrupt("return",(this.metadata=t,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"load",value:function(){return this._loadMetaData()}},{key:"clone",value:function(){return new r(this._url,this._overridespref,this.lrucache,this.interceptor)}},{key:"featureSetByName",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r,n,i,s,l,o,c,d,h,f,p,y,v,_,g=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!(g.length>1&&void 0!==g[1])||g[1],null===(n=g.length>2&&void 0!==g[2]?g[2]:null)&&(n=["*"]),n=(n=n.slice(0)).sort(),i=JSON.stringify(n),s=0;case 5:if(!(s<this._instantLayers.length)){e.next=12;break}if((l=this._instantLayers[s]).opitem.title!==t||l.includeGeometry!==r||l.outFields!==i){e.next=9;break}return e.abrupt("return",this._instantLayers[s].featureset);case 9:s++,e.next=5;break;case 12:return e.next=14,this._loadMetaData();case 14:o=e.sent,c=null,d=(0,a.Z)(o.layers?o.layers:[]);try{for(d.s();!(h=d.n()).done;)(f=h.value).name===t&&(c=f)}catch(u){d.e(u)}finally{d.f()}if(!c){p=(0,a.Z)(o.tables?o.tables:[]);try{for(p.s();!(y=p.n()).done;)(v=y.value).name===t&&(c=v)}catch(u){p.e(u)}finally{p.f()}}if(!c){e.next=24;break}return e.next=22,Y(this._url+"/"+c.id,["*"]);case 22:return _=e.sent,e.abrupt("return",this._makeAndAddFeatureSet(_,r,n));case 24:return e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"featureSetById",value:function(){var e=(0,l.Z)((0,u.Z)().mark((function e(t){var r,n,i,s,l,o,c,d,h,f,p,y,v,_,g=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!(g.length>1&&void 0!==g[1])||g[1],null===(n=g.length>2&&void 0!==g[2]?g[2]:["*"])&&(n=["*"]),n=(n=n.slice(0)).sort(),i=JSON.stringify(n),t=null!=t?t.toString():"",s=0;case 6:if(!(s<this._instantLayers.length)){e.next=13;break}if((l=this._instantLayers[s]).opitem.id!==t||l.includeGeometry!==r||l.outFields!==i){e.next=10;break}return e.abrupt("return",this._instantLayers[s].featureset);case 10:s++,e.next=6;break;case 13:return e.next=15,this._loadMetaData();case 15:o=e.sent,c=null,d=(0,a.Z)(o.layers?o.layers:[]);try{for(d.s();!(h=d.n()).done;)null!==(f=h.value).id&&void 0!==f.id&&f.id.toString()===t&&(c=f)}catch(u){d.e(u)}finally{d.f()}if(!c){p=(0,a.Z)(o.tables?o.tables:[]);try{for(p.s();!(y=p.n()).done;)null!==(v=y.value).id&&void 0!==v.id&&v.id.toString()===t&&(c=v)}catch(u){p.e(u)}finally{p.f()}}if(!c){e.next=25;break}return e.next=23,Y(this._url+"/"+c.id,["*"]);case 23:return _=e.sent,e.abrupt("return",this._makeAndAddFeatureSet(_,r,n));case 25:return e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(A);function ye(e,t){return null===e?t:new E.B({url:e.field("url")})}function ve(e,t,r){return _e.apply(this,arguments)}function _e(){return _e=(0,l.Z)((0,u.Z)().mark((function e(t,r,a){var i,s,l,o;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d.a.findCredential(t.restUrl)){e.next=2;break}return e.abrupt("return",null);case 2:if("loaded"!==t.loadStatus||""!==r||!t.user||!t.user.sourceJSON||!1!==a){e.next=4;break}return e.abrupt("return",t.user.sourceJSON);case 4:if(""!==r){e.next=13;break}return e.next=7,(0,d.U)(t.restUrl+"/community/self",{responseType:"json",query:(0,n.Z)({f:"json"},!1===a?{}:{returnUserLicenseTypeExtensions:!0})});case 7:if(!(i=e.sent).data){e.next=12;break}if(!(s=i.data)||!s.username){e.next=12;break}return e.abrupt("return",s);case 12:case 19:return e.abrupt("return",null);case 13:return e.next=15,(0,d.U)(t.restUrl+"/community/users/"+r,{responseType:"json",query:{f:"json"}});case 15:if(!(l=e.sent).data){e.next=19;break}return o=l.data,e.abrupt("return",o.error?null:o);case 20:case"end":return e.stop()}}),e)}))),_e.apply(this,arguments)}function ge(e,t,r,n,a){if(null===e)return null;if(e instanceof w.K){switch(t){case"datasource":return re(e,a,e.outFields,!0,r,n).getDataSourceFeatureSet();case"parent":case"root":return re(e,a,e.outFields,!0,r,n)}return null}if(e instanceof h.k)switch(t){case"datasource":return e.getDataSourceFeatureSet();case"parent":return e;case"root":return e.getRootFeatureSet()}return null}function me(e,t,r,n,a,i,s){return be.apply(this,arguments)}function be(){return be=(0,l.Z)((0,u.Z)().mark((function e(t,r,n,a,i,s,l){var o,c,d,p,y,v=arguments;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=v.length>7&&void 0!==v[7]?v[7]:null,!h.e.applicationCache){e.next=8;break}if(!(c=h.e.applicationCache.getLayerInfo(t+":"+s.url))){e.next=8;break}return e.next=6,c;case 6:return d=e.sent,e.abrupt("return",re(new w.K({url:(0,f.a8)(d.url)+"/"+r,outFields:["*"]}),n,a,i,l,o));case 8:return p=new N.default({id:t,portal:s}).load(),h.e.applicationCache&&h.e.applicationCache.setLayerInfo(t+":"+s.url,p),e.prev=10,e.next=13,p;case 13:return y=e.sent,e.abrupt("return",re(new w.K({url:(0,f.a8)(y.url)+"/"+r,outFields:["*"]}),n,a,i,l,o));case 17:throw e.prev=17,e.t0=e.catch(10),h.e.applicationCache&&h.e.applicationCache.clearLayerInfo(t+":"+s.url),e.t0;case 20:case"end":return e.stop()}}),e,null,[[10,17]])}))),be.apply(this,arguments)}var ke=Object.freeze({__proto__:null,constructAssociationMetaDataFeatureSetFromUrl:oe,constructFeatureSet:re,constructFeatureSetFromPortalItem:me,constructFeatureSetFromRelationship:de,constructFeatureSetFromUrl:ee,convertToFeatureSet:ge,createFeatureSetCollectionFromMap:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new fe(e,t,r,n)},createFeatureSetCollectionFromService:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new pe(e,t,r,n)},getPortal:ye,initialiseMetaDataCache:function(){null===h.e.applicationCache&&(h.e.applicationCache=new h.e)},lookupUser:ve})},28999:function(e,t,r){r.d(t,{r:function(){return s}});var n=r(37762),a=r(75610),i=r(69953);function s(e,t,r){if(r&&r.features&&r.hasZ){var s=(0,i.o)(r.geometryType,t,e.outSpatialReference);if(!(0,a.t)(s)){var u,l=(0,n.Z)(r.features);try{for(l.s();!(u=l.n()).done;){s(u.value.geometry)}}catch(o){l.e(o)}finally{l.f()}}}}},36551:function(e,t,r){r.d(t,{P:function(){return h},U:function(){return f},a:function(){return l},f:function(){return s},h:function(){return p},j:function(){return o},l:function(){return i},w:function(){return y}});var n=r(23132),a=r(75610);function i(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u(e,t,r,c)}function s(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return u(e,t,r,d)}function u(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,s=null,u=r.once?function(e,r){i(e)&&((0,a.d)(s),t(e,r))}:function(e,r){i(e)&&t(e,r)};if(s=(0,n.P)(e,u,r.sync,r.equals),r.initial){var l=e();u(l,l)}return s}function l(e,t,r){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=null,l=null,o=null;function c(){var e;u&&l&&(l.remove(),null!==(e=s.onListenerRemove)&&void 0!==e&&e.call(s,u),u=null,l=null)}function d(e){s.once&&s.once&&(0,a.d)(o),r(e)}var h=i(e,(function(e,r){var a;c(),(0,n.c)(e)&&(u=e,l=(0,n.f)(e,t,d),null===(a=s.onListenerAdd)||void 0===a||a.call(s,e))}),{sync:s.sync,initial:!0});return o=(0,n.g)((function(){h.remove(),c()}))}function o(e,t){return function(e,t,r){if((0,n.p)(r))return Promise.reject((0,n.m)());var i=e();if(null!==t&&void 0!==t&&t(i))return Promise.resolve(i);var s=null;function l(){s=(0,a.d)(s)}return new Promise((function(a,i){s=(0,n.h)([(0,n.v)(r,(function(){l(),i((0,n.m)())})),u(e,(function(e){l(),a(e)}),{sync:!1,once:!0},null!==t&&void 0!==t?t:c)])}))}(e,d,t)}function c(e){return!0}function d(e){return!!e}function h(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=!1,a=i(e,(function(e,r){n||t(e,r)}),r);return{remove:function(){a.remove()},pause:function(){n=!0},resume:function(){n=!1}}}var f={sync:!0},p={initial:!0},y={sync:!0,initial:!0}},53249:function(e,t,r){r.d(t,{r:function(){return s},t:function(){return l}});var n=r(74165),a=r(15861),i=r(75610);function s(e,t){return u.apply(this,arguments)}function u(){return u=(0,a.Z)((0,n.Z)().mark((function e(t,a){var i,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e(1019).then(r.bind(r,81019));case 2:return i=e.sent,s=i.WhereClause,e.abrupt("return",s.create(t,a));case 5:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}function l(e,t){return(0,i.r)(e)?(0,i.r)(t)?"(".concat(e,") AND (").concat(t,")"):e:t}},69202:function(e,t,r){r.d(t,{e:function(){return s},n:function(){return u},o:function(){return l}});var n=r(1413),a=r(75610),i=r(57714);function s(e,t){return t?(0,n.Z)((0,n.Z)({},t),{},{query:(0,n.Z)((0,n.Z)({},e),t.query)}):{query:e}}function u(e){return"string"==typeof e?(0,i.j)(e):(0,a.m)(e)}function l(e,t,r){var n={};for(var a in e)if("declaredClass"!==a){var i=e[a];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){n[a]=[];for(var s=0;s<i.length;s++)n[a][s]=l(i[s])}else if("object"==typeof i)if(i.toJSON){var u=i.toJSON(r&&r[a]);n[a]=t?u:JSON.stringify(u)}else n[a]=t?i:JSON.stringify(i);else n[a]=i}return n}},69953:function(e,t,r){r.d(t,{o:function(){return u}});var n=r(37762),a=r(75610),i=r(44455),s=r(30709);function u(e,t,r){if((0,a.t)(t)||(0,a.t)(r)||r.vcsWkid||(0,s.E)(t,r))return null;var u=(0,i.W)(t)/(0,i.W)(r);if(1===u)return null;switch(e){case"point":case"esriGeometryPoint":return function(e){return function(e,t){e&&null!=e.z&&(e.z*=t)}(e,u)};case"polyline":case"esriGeometryPolyline":return function(e){return function(e,t){if(e){var r,a=(0,n.Z)(e.paths);try{for(a.s();!(r=a.n()).done;){var i,s=r.value,u=(0,n.Z)(s);try{for(u.s();!(i=u.n()).done;){var l=i.value;l.length>2&&(l[2]*=t)}}catch(o){u.e(o)}finally{u.f()}}}catch(o){a.e(o)}finally{a.f()}}}(e,u)};case"polygon":case"esriGeometryPolygon":return function(e){return function(e,t){if(e){var r,a=(0,n.Z)(e.rings);try{for(a.s();!(r=a.n()).done;){var i,s=r.value,u=(0,n.Z)(s);try{for(u.s();!(i=u.n()).done;){var l=i.value;l.length>2&&(l[2]*=t)}}catch(o){u.e(o)}finally{u.f()}}}catch(o){a.e(o)}finally{a.f()}}}(e,u)};case"multipoint":case"esriGeometryMultipoint":return function(e){return function(e,t){if(e){var r,a=(0,n.Z)(e.points);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.length>2&&(i[2]*=t)}}catch(s){a.e(s)}finally{a.f()}}}(e,u)};case"extent":case"esriGeometryExtent":return function(e){return function(e,t){e&&null!=e.zmin&&null!=e.zmax&&(e.zmin*=t,e.zmax*=t)}(e,u)};default:return null}}}}]);
//# sourceMappingURL=1633.92e9b7e2.chunk.js.map