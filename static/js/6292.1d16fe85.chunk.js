"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[6292],{56292:function(e,t,n){n.r(t),n.d(t,{D:function(){return Yt},a:function(){return Oe},e:function(){return Qe},r:function(){return Je}});var i=n(29439),r=n(74165),a=n(15861),o=n(1413),s=n(93433),l=n(37762),u=n(11752),c=n(61120),d=n(15671),h=n(43144),p=n(60136),f=n(29388),v=n(23132),y=n(80175),g=n(75610),_=n(36551),m=n(80584),w=n(44344),x=n(78674),k=(n(91204),n(2157)),Z=n(55269),S=n(80262),E=n(30709),b=n(97033),P=n(77470),T=n(58687),R=n(78880),O=n(35773),C=n(2760),M=n(90584),V=n(58394),H=n(64296),L=n(55806),I=n(34284),z=n(91309),D=n(94867),N=n(87833),A=n(28194),F=n(70441),j=n(23218),G=n(42860),q=n(68433),W=n(73554),U=n(21924),Y=n(33898),B=n(84192),X=n(29009),Q=n(14181),J=n(97627),K=n(40273),$=n(3969),ee=n(41742),te=n(44455),ne=n(63022);var ie=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).type="length",i.startPoint=null,i.endPoint=null,i.axis="horizontal",i.offset=0,i.heading=0,i}return(0,h.Z)(n,[{key:"extent",get:function(){if((0,g.t)(this.startPoint))return null;var e=S.M.fromPoint(this.startPoint);return(0,g.r)(this.endPoint)&&e.union(S.M.fromPoint(this.endPoint)),e}}]),n}(k.a);(0,v.e)([(0,v.d)({type:["length"]})],ie.prototype,"type",void 0),(0,v.e)([(0,v.d)({type:E.j})],ie.prototype,"startPoint",void 0),(0,v.e)([(0,v.d)({type:E.j})],ie.prototype,"endPoint",void 0),(0,v.e)([(0,v.d)({type:["horizontal","vertical","direct"],nonNullable:!0})],ie.prototype,"axis",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0})],ie.prototype,"offset",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0}),(0,v.q)((function(e){return Z.s.normalize((0,v.F)(e),0,!0)}))],ie.prototype,"heading",void 0),(0,v.e)([(0,v.d)({readOnly:!0})],ie.prototype,"extent",null);var re,ae=ie=(0,v.e)([(0,v.n)("esri.analysis.LengthDimension")],ie),oe={main:new x.l([255,127,0])},se=(0,h.Z)((function e(){(0,d.Z)(this,e),this.color=oe.main,this.opacity=.5,this.radius=5})),le=function(){function e(){(0,d.Z)(this,e),this.fontSize=14}return(0,h.Z)(e,[{key:"height",get:function(){return 1.5*(0,R.u)(this.fontSize)}},{key:"offset",get:function(){return this.height+20}}]),e}(),ue=new((0,h.Z)((function e(){(0,d.Z)(this,e),this.pointManipulators=new se,this.labels=new le}))),ce=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e))._ray=(0,L.d)(),i._externalResources=null,i._handles=new P.u,i._isWorldDown=!1,i._start=(0,C.n)(),i._end=(0,C.r)(1,0,0),i._width=1,i._color=(0,M.r)(1,0,1,1),i._polygonOffset=!1,i._writeDepthEnabled=!0,i._innerWidth=0,i._innerColor=(0,M.r)(1,1,1,1),i._stipplePattern=null,i._stippleOffColor=null,i._stipplePreferContinuous=!0,i._falloff=0,i._extensionType=re.LINE,i._laserlineStyle=null,i._laserlineEnabled=!1,i._renderOccluded=z.a9.OccludeAndTransparent,i._fadedExtensions=ye,i.applyProps(e),i}return(0,h.Z)(n,[{key:"createExternalResources",value:function(){var e=this,t=new T.aS(this.materialParameters);this._handles.add((0,_.l)((function(){return e.view.state.camera}),(function(){e._updateGeometry()})));var n=new I._({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:t,laserline:n}}},{key:"destroyExternalResources",value:function(){(0,g.r)(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){(0,g.r)(this._externalResources)&&e(this._externalResources.material)}},{key:"createGeometries",value:function(e){var t=[(0,C.n)(),(0,C.n)()],n=this.extensionType===re.FADED;n&&t.push((0,C.n)(),(0,C.n)());var i=n?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,r=T.T.createPolylineGeometry(t,null,i);e.addGeometry(r,(0,g.e)(this._externalResources).material),this._updateVertices(e)}},{key:"updateVisibility",value:function(e){(0,u.Z)((0,c.Z)(n.prototype),"updateVisibility",this).call(this,e),(0,g.r)(this._externalResources)&&(this._externalResources.laserline.visible=e)}},{key:"setStartEndFromWorldDownAtLocation",value:function(e){this._isWorldDown=!0,(0,C.a)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,C.e)(this._end,e,this._end),(0,L.p)(this._start,this._end,this._ray),this._updateGeometry()}},{key:"start",get:function(){return this._start},set:function(e){this._isWorldDown=!1,(0,C.F)(this._start,e)||((0,C.a)(this._start,e),(0,L.p)(this._start,this._end,this._ray),this._updateGeometry())}},{key:"end",get:function(){return this._end},set:function(e){this._isWorldDown=!1,(0,C.F)(this._end,e)||((0,C.a)(this._end,e),(0,L.p)(this._start,this._end,this._ray),this._updateGeometry())}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,C.Q)(e,this._color)||((0,C.B)(this._color,e),this._updateMaterial())}},{key:"polygonOffset",get:function(){return this._polygonOffset},set:function(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}},{key:"writeDepthEnabled",get:function(){return this._writeDepthEnabled},set:function(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){(0,C.Q)(e,this._innerColor)||((0,C.B)(this._innerColor,e),this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=(0,g.r)(e)!==(0,g.r)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){((0,g.t)(e)||(0,g.t)(this._stippleOffColor)||!(0,C.Q)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,g.r)(e)?(0,M.b)(e):null,this._updateMaterial())}},{key:"stipplePreferContinuous",get:function(){return this._stipplePreferContinuous},set:function(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}},{key:"extensionType",get:function(){return this._extensionType},set:function(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}},{key:"_laserlineAttached",get:function(){return this._laserlineEnabled&&(0,g.r)(this._laserlineStyle)}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,(0,g.r)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,(0,g.r)(e)&&(this._externalResources.laserline.style=e))}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,(0,g.r)(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"fadedExtensions",get:function(){return this._fadedExtensions},set:function(e){this._fadedExtensions=(0,g.n)(e,ye),this.recreateGeometry()}},{key:"_updateMaterial",value:function(){(0,g.t)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}},{key:"_updateGeometry",value:function(){(0,g.r)(this.object)&&this._updateVertices(this.object)}},{key:"_updateVertices",value:function(e){var t=this._extensionType===re.FADED?this._updateLineSegmentFinite(fe):this._updateLineSegmentInfinite(this._extensionType,fe);this._updateVertexAttributes(e,t),(0,g.r)(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}},{key:"_updateLineSegmentFinite",value:function(e){return(0,H.l)(this._start,this._end,e)}},{key:"_updateLineSegmentInfinite",value:function(e,t){var n=this.view.state.camera;switch((0,V.m)(this._ray,de),e){case re.LINE:de.c0=-Number.MAX_VALUE;break;case re.RAY:case re.GROUND_RAY:var i=this._ray.origin,r=(0,g.n)(this.view.elevationProvider.getElevation(i[0],i[1],i[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),a=this.view.renderCoordsHelper.getAltitude(i);this._isWorldDown&&a<r&&(0,C.k)(de.ray.direction,de.ray.direction),this._extensionType===re.GROUND_RAY&&null!=r&&(de.c1=Math.abs(a-r))}if(!(0,V.n)(n.frustum,de))return(0,H.l)(this._start,this._end,t);var o=(0,V.o)(de,he),s=(0,V.r)(de,pe);return(0,H.l)(o,s,t)}},{key:"_updateVertexAttributes",value:function(e,t){var n=e.geometries[0].getMutableAttribute(D.O.POSITION).data;if(this.extensionType===re.FADED){var i=(0,H.j)(t,-this.fadedExtensions.start,he);n[0]=i[0],n[1]=i[1],n[2]=i[2];var r=(0,H.j)(t,0,he);n[3]=r[0],n[4]=r[1],n[5]=r[2];var a=(0,H.j)(t,1,he);n[6]=a[0],n[7]=a[1],n[8]=a[2];var o=(0,H.j)(t,1+this.fadedExtensions.end,he);n[9]=o[0],n[10]=o[1],n[11]=o[2]}else{var s=(0,H.j)(t,0,he);n[0]=s[0],n[1]=s[1],n[2]=s[2];var l=(0,H.j)(t,1,he);n[3]=l[0],n[4]=l[1],n[5]=l[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}}]),n}(m.n),de=(0,V.t)(),he=(0,C.n)(),pe=(0,C.n)(),fe=(0,H.v)();!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(re||(re={}));var ve=1/3,ye={start:ve,end:ve},ge=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e))._handles=new P.u,i._location=(0,C.n)(),i._direction=(0,C.r)(1,0,0),i._width=1,i._offset=1,i._length=18,i._color=(0,M.r)(1,0,1,1),i._renderOccluded=z.a9.OccludeAndTransparent,i.applyProps(e),i}return(0,h.Z)(n,[{key:"location",get:function(){return this._location},set:function(e){(0,C.F)(this._location,e)||((0,C.a)(this._location,e),this._updateGeometry())}},{key:"direction",get:function(){return this._direction},set:function(e){(0,C.F)(this._direction,e)||((0,C.a)(this._direction,e),this._updateGeometry())}},{key:"setDirectionFromPoints",value:function(e,t){(0,C.z)(this._direction,(0,C.e)(this._direction,t,e)),this._updateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"offset",get:function(){return this._offset},set:function(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}},{key:"length",get:function(){return this._length},set:function(e){e!==this._length&&(this._length=e,this._updateGeometry())}},{key:"color",get:function(){return this._color},set:function(e){(0,C.Q)(e,this._color)||((0,C.B)(this._color,e),this._updateMaterial())}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"createExternalResources",value:function(){var e=this,t=new T.aS(this.materialParameters);this._handles.add((0,_.l)((function(){return e.view.state.camera}),(function(){e._updateGeometry()}))),this._externalResources={material:t}}},{key:"destroyExternalResources",value:function(){this._handles.removeAll(),this._externalResources=null}},{key:"createGeometries",value:function(e){var t=T.T.createPolylineGeometry([(0,C.n)(),(0,C.n)()]),n=T.T.createPolylineGeometry([(0,C.n)(),(0,C.n)()]),i=(0,g.e)(this._externalResources).material;e.addGeometry(t,i),e.addGeometry(n,i),this._updateVertices(e)}},{key:"forEachExternalMaterial",value:function(e){(0,g.r)(this._externalResources)&&e(this._externalResources.material)}},{key:"_updateMaterial",value:function(){(0,g.t)(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}},{key:"_updateGeometry",value:function(){var e=this.object;(0,g.t)(e)||this._updateVertices(e)}},{key:"_updateVertices",value:function(e){var t=this.view.state.camera;t.projectToScreen(this.location,me),(0,C.u)(_e,this.location,this.direction),t.projectToScreen(_e,we),(0,N.v)(we,(0,N.o)(we,we,me)),this._updateVertexAttributes(t,e,0,me,we,1),this._updateVertexAttributes(t,e,1,me,we,-1)}},{key:"_updateVertexAttributes",value:function(e,t,n,i,r,a){var o=t.geometryRecords[n],s=o.geometry.getMutableAttribute(D.O.POSITION).data,l=(0,N.l)(xe,(0,N.r)(xe,r[1]*a,r[0]*-a),this.offset+this.width/2),u=(0,N.s)(ke,(0,N.s)(ke,(0,N.s)(ke,i,(0,N.l)(ke,r,this.length/2)),l),l),c=(0,N.s)(Ze,u,(0,N.l)(Ze,r,-this.length));e.unprojectFromScreen(u,_e),s[0]=_e[0],s[1]=_e[1],s[2]=_e[2],e.unprojectFromScreen(c,_e),s[3]=_e[0],s[4]=_e[1],s[5]=_e[2],t.geometryVertexAttrsUpdated(o)}}]),n}(m.n),_e=(0,C.n)(),me=(0,R.i)(),we=(0,R.i)(),xe=(0,R.i)(),ke=(0,R.i)(),Ze=(0,R.i)(),Se=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,d.Z)(this,n),(e=t.apply(this,arguments)).enabled=!0,e}return(0,h.Z)(n)}(F.l);(0,v.e)([(0,v.d)({type:Boolean})],Se.prototype,"enabled",void 0),Se=(0,v.e)([(0,v.n)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Se);var Ee=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).lineSnapper=new Se,i.parallelLineSnapper=new Se,i.rightAngleSnapper=new Se,i.rightAngleTriangleSnapper=new Se,i.shortLineThreshold=15,i.distance=5,i.pointThreshold=1e-6,i.intersectionParallelLineThreshold=1e-6,i.parallelLineThreshold=1e-6,i.touchSensitivityMultiplier=1.5,i.pointOnLineThreshold=1e-6,i.orange=new x.l([255,127,0]),i.lineHintWidthReference=3,i.lineHintWidthTarget=3,i.lineHintFadedExtensions=.3,i.parallelLineHintWidth=2,i.parallelLineHintLength=24,i.parallelLineHintOffset=1.5,i.rightAngleHintSize=24,i.rightAngleHintOutlineSize=1.5,i}return(0,h.Z)(n)}(F.l);(0,v.e)([(0,v.d)({type:Se,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Ee.prototype,"lineSnapper",void 0),(0,v.e)([(0,v.d)({type:Se,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Ee.prototype,"parallelLineSnapper",void 0),(0,v.e)([(0,v.d)({type:Se,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Ee.prototype,"rightAngleSnapper",void 0),(0,v.e)([(0,v.d)({type:Se,constructOnly:!0,nonNullable:!0,json:{write:!0}})],Ee.prototype,"rightAngleTriangleSnapper",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],Ee.prototype,"shortLineThreshold",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],Ee.prototype,"distance",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Ee.prototype,"pointThreshold",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Ee.prototype,"intersectionParallelLineThreshold",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Ee.prototype,"parallelLineThreshold",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Ee.prototype,"touchSensitivityMultiplier",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],Ee.prototype,"pointOnLineThreshold",void 0),(0,v.e)([(0,v.d)({type:x.l,nonNullable:!0})],Ee.prototype,"orange",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Ee.prototype,"lineHintWidthReference",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Ee.prototype,"lineHintWidthTarget",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Ee.prototype,"lineHintFadedExtensions",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],Ee.prototype,"parallelLineHintWidth",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],Ee.prototype,"parallelLineHintLength",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],Ee.prototype,"parallelLineHintOffset",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],Ee.prototype,"rightAngleHintSize",void 0),(0,v.e)([(0,v.d)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],Ee.prototype,"rightAngleHintOutlineSize",void 0);var be,Pe=new(Ee=(0,v.e)([(0,v.n)("esri.views.interactive.snapping.Settings.Defaults")],Ee));function Te(e,t){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function Re(e,t){var n=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return n;case 3:return n&&e[2]===t[2];case 4:return n&&e[3]===t[3]}return!1}function Oe(e,t){t.sort((function(t,n){return(0,N.b)(t.targetPoint,e)-(0,N.b)(n.targetPoint,e)}))}!function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(be||(be={}));var Ce=(0,h.Z)((function e(t){(0,d.Z)(this,e),this.elevationInfo=t})),Me=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){var r;return(0,d.Z)(this,n),(r=t.call(this,i)).intersectionPoint=e,r}return(0,h.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&Re(this.intersectionPoint,e.intersectionPoint)}}]),n}(Ce);v.s.getLogger("esri.views.interactive.snapping.hints.LineSnappingHint");var Ve=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a){var o,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];return(0,d.Z)(this,n),(o=t.call(this,a)).type=e,o.lineStart=i,o.lineEnd=r,o.fadeLeft=s,o.fadeRight=l,o}return(0,h.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&this.type===e.type&&Re(this.lineStart,e.lineStart)&&Re(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}}]),n}(Ce);v.s.getLogger("esri.views.interactive.snapping.hints.ParallelSnappingHint");var He=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r){var a;return(0,d.Z)(this,n),(a=t.call(this,r)).lineStart=e,a.lineEnd=i,a}return(0,h.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&Re(this.lineStart,e.lineStart)&&Re(this.lineEnd,e.lineEnd)}}]),n}(Ce),Le=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){var r;return(0,d.Z)(this,n),(r=t.call(this,i)).point=e,r}return(0,h.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&Re(this.point,e.point)}}]),n}(Ce);v.s.getLogger("esri.views.interactive.snapping.hints.RightAngleSnappingHint");var Ie=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a){var o;return(0,d.Z)(this,n),(o=t.call(this,a)).previousVertex=e,o.centerVertex=i,o.nextVertex=r,o}return(0,h.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&Re(this.previousVertex,e.previousVertex)&&Re(this.centerVertex,e.centerVertex)&&Re(this.nextVertex,e.nextVertex)}}]),n}(Ce),ze=function(){function e(){(0,d.Z)(this,e)}return(0,h.Z)(e,[{key:"draw",value:function(e,t){var n,i=this._getUniqueHints(e),r=[],a=(0,l.Z)(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;o instanceof Me&&r.push(this.visualizeIntersectionPoint(o,t)),o instanceof Ve&&r.push(this.visualizeLine(o,t)),o instanceof He&&r.push(this.visualizeParallelSign(o,t)),o instanceof Ie&&r.push(this.visualizeRightAngleQuad(o,t)),o instanceof Le&&r.push(this.visualizePoint(o,t))}}catch(s){a.e(s)}finally{a.f()}return(0,v.h)(r)}},{key:"_getUniqueHints",value:function(e){var t,n=[],i=(0,l.Z)(e);try{for(i.s();!(t=i.n()).done;){var r,a=t.value,o=!0,s=(0,l.Z)(n);try{for(s.s();!(r=s.n()).done;){var u=r.value;if(a.equals(u)){o=!1;break}}}catch(c){s.e(c)}finally{s.f()}o&&n.push(a)}}catch(c){i.e(c)}finally{i.f()}return n}}]),e}(),De=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,d.Z)(this,n),t.apply(this,arguments)}return(0,h.Z)(n,[{key:"visualizeIntersectionPoint",value:function(e,t){var n=t.coordinateHelper,i=t.view;return(0,v.aF)(new I.S({view:i,primitive:"circle",geometry:n.vectorToPoint(e.intersectionPoint),elevationInfo:(0,g.n)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:x.l.toUnitRGBA(Pe.orange),pixelSnappingEnabled:!1}))}},{key:"visualizePoint",value:function(e,t){var n=t.coordinateHelper,i=t.view;return(0,v.aF)(new I.S({view:i,primitive:"circle",geometry:n.vectorToPoint(e.point),elevationInfo:(0,g.n)(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:x.l.toUnitRGBA(Pe.orange),pixelSnappingEnabled:!1}))}},{key:"visualizeLine",value:function(e,t){var n=t.coordinateHelper,i=t.view;return(0,v.aF)(this._createLineSegmentHintFromMap(e.type,e.lineStart,e.lineEnd,n,(0,g.n)(e.elevationInfo,t.elevationInfo),i,e.fadeLeft,e.fadeRight))}},{key:"visualizeParallelSign",value:function(e,t){var n=t.coordinateHelper,i=t.view,r=(0,g.n)(e.elevationInfo,t.elevationInfo),a=(0,j.c)(e.lineStart,n,r,t.view),o=(0,j.c)(e.lineEnd,n,r,t.view),s=(0,C.A)(o,a,o,.5),l=new ge({view:i,attached:!1,offset:Pe.parallelLineHintOffset,length:Pe.parallelLineHintLength,width:Pe.parallelLineHintWidth,color:x.l.toUnitRGBA(Pe.orange),location:s,renderOccluded:z.a9.Opaque});return l.setDirectionFromPoints(a,s),l.attached=!0,(0,v.aF)(l)}},{key:"visualizeRightAngleQuad",value:function(e,t){var n=t.coordinateHelper,i=t.view,r=(0,g.n)(e.elevationInfo,t.elevationInfo);return(0,v.aF)(new A.j({view:i,attached:!0,color:x.l.toUnitRGBA(Pe.orange),renderOccluded:z.a9.Transparent,outlineRenderOccluded:z.a9.Opaque,outlineColor:x.l.toUnitRGBA(Pe.orange),outlineSize:Pe.rightAngleHintOutlineSize,size:Pe.rightAngleHintSize,geometry:{previous:(0,j.c)(e.previousVertex,n,r,i),center:(0,j.c)(e.centerVertex,n,r,i),next:(0,j.c)(e.nextVertex,n,r,i)}}))}},{key:"_createLineSegmentHintFromMap",value:function(e,t,n,i,r,a){var o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=(0,C.n)(),u=(0,C.n)();return(0,j.j)(t,n,i,r,a,l,u),this._createLineSegmentHint(e,a,l,u,o,s)}},{key:"_createLineSegmentHint",value:function(e,t,n,i){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=new ce({view:t,extensionType:re.FADED,start:n,end:i,color:x.l.toUnitRGBA(Pe.orange),renderOccluded:z.a9.Opaque});switch(e){case be.TARGET:o.width=Pe.lineHintWidthTarget,o.fadedExtensions={start:0,end:Pe.lineHintFadedExtensions};break;case be.REFERENCE_EXTENSION:o.width=Pe.lineHintWidthReference,o.fadedExtensions={start:0,end:0};break;case be.REFERENCE:o.width=Pe.lineHintWidthReference,o.fadedExtensions={start:r?Pe.lineHintFadedExtensions:0,end:a?Pe.lineHintFadedExtensions:0}}return o.attached=!0,o}}]),n}(ze),Ne=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).layer=null,i.enabled=!0,i.updating=!1,i.availability=1,i}return(0,h.Z)(n)}(v.y);(0,v.e)([(0,v.d)({constructOnly:!0})],Ne.prototype,"layer",void 0),(0,v.e)([(0,v.d)()],Ne.prototype,"enabled",void 0),(0,v.e)([(0,v.d)()],Ne.prototype,"updating",void 0),(0,v.e)([(0,v.d)()],Ne.prototype,"availability",void 0);var Ae=Ne=(0,v.e)([(0,v.n)("esri.views.interactive.snapping.SnappingLayerSource")],Ne),Fe=(0,h.Z)((function e(t){(0,d.Z)(this,e),this.coordinateHelper=t})),je=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){var r;return(0,d.Z)(this,n),(r=t.call(this,e)).point=i,r}return(0,h.Z)(n,[{key:"objectEqual",value:function(e){return e instanceof n&&Re(this.point,e.point)}},{key:"check",value:function(e){return(0,N.b)(e,this.point)<Pe.pointThreshold}},{key:"closestTo",value:function(){return this.coordinateHelper.clone(this.point)}},{key:"intersect",value:function(e){var t=this,n=[];return e instanceof Ge?n.push.apply(n,(0,s.Z)((0,q.y)({start:e.start,end:e.end,type:e instanceof We?q.b.LINE:q.b.RAY},this.point))):e instanceof Ye&&n.push.apply(n,(0,s.Z)((0,q.d)(e.center,e.radius,this.point))),n.map((function(n){return new Ue(t.coordinateHelper,n,t,e)}))}}]),n}(Fe),Ge=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r){var a;return(0,d.Z)(this,n),(a=t.call(this,e)).start=i,a.end=r,a}return(0,h.Z)(n,[{key:"objectEqual",value:function(e){return e instanceof n&&Re(this.start,e.start)&&Re(this.end,e.end)}},{key:"intersect",value:function(e){var t=this,i=[];return e instanceof je?i.push.apply(i,(0,s.Z)((0,q.y)({start:this.start,end:this.end,type:this instanceof We?q.b.LINE:q.b.RAY},e.point))):e instanceof n?i.push.apply(i,(0,s.Z)((0,q.j)({start:this.start,end:this.end,type:this instanceof We?q.b.LINE:q.b.RAY},{start:e.start,end:e.end,type:e instanceof We?q.b.LINE:q.b.RAY}))):e instanceof Ye&&i.push.apply(i,(0,s.Z)((0,q.v)({start:this.start,end:this.end,type:this instanceof We?q.b.LINE:q.b.RAY},e.center,e.radius))),i.map((function(n){return new Ue(t.coordinateHelper,n,t,e)}))}}]),n}(Fe),qe=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r){var a;return(0,d.Z)(this,n),(a=t.call(this,e,i,r)).dir=(0,B.n)(),a.p=(0,B.n)(),a}return(0,h.Z)(n,[{key:"objectEqual",value:function(e){return e instanceof n&&(0,u.Z)((0,c.Z)(n.prototype),"objectEqual",this).call(this,e)}},{key:"check",value:function(e){return(0,N.o)(this.dir,this.end,this.start),(0,N.o)(this.p,e,this.start),(0,N.j)(this.dir,this.p)>=0&&(0,q.E)(e,this.start,this.end)<Pe.pointOnLineThreshold}},{key:"closestTo",value:function(e){var t=this.coordinateHelper.clone(e);return(0,q.N)(t,e,this.start,this.end),t}}]),n}(Ge),We=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r){return(0,d.Z)(this,n),t.call(this,e,i,r)}return(0,h.Z)(n,[{key:"objectEqual",value:function(e){return e instanceof n&&(0,u.Z)((0,c.Z)(n.prototype),"objectEqual",this).call(this,e)}},{key:"check",value:function(e){return(0,q.E)(e,this.start,this.end)<Pe.pointOnLineThreshold}},{key:"closestTo",value:function(e){var t=this.coordinateHelper.clone(e);return(0,q.L)(t,e,this.start,this.end),t}}]),n}(Ge),Ue=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a){var o;return(0,d.Z)(this,n),(o=t.call(this,e)).intersection=i,o.first=r,o.second=a,o}return(0,h.Z)(n,[{key:"objectEqual",value:function(e){return e instanceof n&&this.first.objectEqual(e.first)&&this.second.objectEqual(e.second)}},{key:"check",value:function(){return!1}},{key:"closestTo",value:function(e){var t=this.coordinateHelper.clone(e);return(0,N.a)(t,this.intersection),t}},{key:"intersect",value:function(){return[]}}]),n}(Fe),Ye=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r){var a;return(0,d.Z)(this,n),(a=t.call(this,e)).center=i,a.radius=r,a}return(0,h.Z)(n,[{key:"objectEqual",value:function(e){return e instanceof n&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}},{key:"check",value:function(){return!1}},{key:"closestTo",value:function(e){var t=this.coordinateHelper.clone(e);return(0,q.m)(t,e,this.center,this.radius),t}},{key:"intersect",value:function(e){var t=this,n=[];return e instanceof Ge?n.push.apply(n,(0,s.Z)((0,q.v)({start:e.start,end:e.end,type:e instanceof We?q.b.LINE:q.b.RAY},this.center,this.radius))):e instanceof je&&n.push.apply(n,(0,s.Z)((0,q.d)(this.center,this.radius,e.point))),n.map((function(n){return new Ue(t.coordinateHelper,n,t,e)}))}}]),n}(Fe),Be=(0,h.Z)((function e(t,n,i,r){(0,d.Z)(this,e),this.coordinateHelper=t,this.targetPoint=n,this.constraint=i,this.elevationInfo=r})),Xe=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.targetPoint,o=e.objectId,s=e.constraint,l=e.elevationInfo;return(0,d.Z)(this,n),(i=t.call(this,r,a,s,l)).objectId=o,i}return(0,h.Z)(n)}(Be),Qe=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,d.Z)(this,n),t.call(this,(0,o.Z)((0,o.Z)({},e),{},{constraint:new We(e.coordinateHelper,e.edgeStart,e.edgeEnd)}))}return(0,h.Z)(n,[{key:"hints",get:function(){return[new Ve(be.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo)]}}]),n}(Xe),Je=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,d.Z)(this,n),t.call(this,(0,o.Z)((0,o.Z)({},e),{},{constraint:new je(e.coordinateHelper,e.targetPoint)}))}return(0,h.Z)(n,[{key:"hints",get:function(){return[new Le(this.targetPoint,this.elevationInfo)]}}]),n}(Xe),Ke=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).availability=0,i._ids=new Set,i.tmpP=(0,C.n)(),i}return(0,h.Z)(n,[{key:"destroy",value:function(){this.workerHandle.destroy(),this.workerHandle=null}},{key:"initialize",value:function(){var e=this;this.workerHandle=new $e(this.schedule,{fetchAllEdgeLocations:function(t,n){return e._fetchAllEdgeLocations(t,n)}})}},{key:"fetchCandidates",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i,a,o,s,l=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.coordinateHelper.toXYZ(t.point),this.view.renderCoordsHelper.toRenderCoords(i,t.coordinateHelper.spatialReference,i),a="number"==typeof t.distance?t.distance:t.distance.pixelSize,e.next=5,this.workerHandle.invoke({bounds:(0,L.L)(i[0],i[1],i[2],a),types:t.types},n);case 5:return o=e.sent,s=t.coordinateHelper,e.abrupt("return",(o.candidates.sort((function(e,t){return e.distance-t.distance})),o.candidates.map((function(e){return l._convertCandidate(s,e)}))));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._ids.add(t.id),e.next=3,this.workerHandle.invokeMethod("add",t,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._ids.delete(t.id),e.next=3,this.workerHandle.invokeMethod("remove",t,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_convertCandidate",value:function(e,t){switch(t.type){case"edge":return new Qe({coordinateHelper:e,objectId:t.objectId,targetPoint:this._convertRenderCoordinate(e,t.target),edgeStart:this._convertRenderCoordinate(e,t.start),edgeEnd:this._convertRenderCoordinate(e,t.end),elevationInfo:Y.m});case"vertex":return new Je({coordinateHelper:e,objectId:t.objectId,targetPoint:this._convertRenderCoordinate(e,t.target),elevationInfo:Y.m})}}},{key:"_convertRenderCoordinate",value:function(e,t){return this.view.renderCoordsHelper.fromRenderCoords(t,this.tmpP,e.spatialReference),e.fromXYZ(this.tmpP)}},{key:"_fetchAllEdgeLocations",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i,o,s,u,c,d=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],o=[],s=(0,l.Z)(t.components);try{for(c=function(){var e=u.value,t=e.id,s=e.uid;d._ids.has(t)&&i.push((0,a.Z)((0,r.Z)().mark((function e(){var i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.fetchEdgeLocations(t,n.signal);case 2:return i=e.sent,e.abrupt("return",(o.push(i.locations.buffer),{id:t,uid:s,objectIds:i.objectIds,locations:i.locations.buffer,origin:i.origin,type:i.type}));case 4:case"end":return e.stop()}}),e)})))())},s.s();!(u=s.n()).done;)c()}catch(h){s.e(h)}finally{s.f()}return e.next=5,Promise.all(i);case 5:return e.t0=e.sent.filter((function(e){var t=e.id;return d._ids.has(t)})),e.t1={components:e.t0},e.t2=o,e.abrupt("return",{result:e.t1,transferList:e.t2});case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(b.d);(0,v.e)([(0,v.d)({constructOnly:!0})],Ke.prototype,"view",void 0),(0,v.e)([(0,v.d)({constructOnly:!0})],Ke.prototype,"fetchEdgeLocations",void 0),(0,v.e)([(0,v.d)({constructOnly:!0})],Ke.prototype,"schedule",void 0),(0,v.e)([(0,v.d)({readOnly:!0})],Ke.prototype,"availability",void 0),Ke=(0,v.e)([(0,v.n)("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],Ke);var $e=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e,i){return(0,d.Z)(this,n),t.call(this,"SceneLayerSnappingSourceWorker","fetchCandidates",{},e,{strategy:"dedicated",client:i})}return(0,h.Z)(n)}(U.a),et=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).availability=1,i.abortController=new AbortController,i}return(0,h.Z)(n,[{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"layer",get:function(){return this.layerSource.layer}},{key:"destroy",value:function(){this.abortController=(0,g.C)(this.abortController)}},{key:"initialize",value:function(){var e=this,t=this.view.resourceController;this.edgeWorker=new T.aV((function(e){return t.schedule(e)})),this.workerHandle=new Ke({view:this.view,schedule:function(e){return t.schedule(e)},fetchEdgeLocations:function(){var t=(0,a.Z)((0,r.Z)().mark((function t(n,i){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(0,g.t)(e.tracker)){t.next=2;break}throw new Error("tracker-not-initialized");case 2:return t.abrupt("return",e.tracker.fetchEdgeLocations(n,e.edgeWorker,i));case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}),this.updatingHandles.addPromise(this._setupLayerView()),this.handles.add([(0,v.aF)(this.workerHandle),(0,v.aF)(this.edgeWorker)])}},{key:"fetchCandidates",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.workerHandle.fetchCandidates(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){}},{key:"_setupLayerView",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,i=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.view.whenLayerView(this.layer);case 2:if("scene-layer-graphics-3d"!==(t=e.sent).type){e.next=5;break}return e.abrupt("return");case 5:n={add:function(e,t){return i.updatingHandles.addPromise(i.workerHandle.add({id:e,bounds:t},i.abortController.signal))},remove:function(e){return i.updatingHandles.addPromise(i.workerHandle.remove({id:e},i.abortController.signal))}},this.tracker=t.trackSnappingSources(n),this.handles.add(this.tracker);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(b.d);(0,v.e)([(0,v.d)({constructOnly:!0})],et.prototype,"layerSource",void 0),(0,v.e)([(0,v.d)({constructOnly:!0})],et.prototype,"view",void 0),(0,v.e)([(0,v.d)({readOnly:!0})],et.prototype,"updating",null),(0,v.e)([(0,v.d)({readOnly:!0})],et.prototype,"availability",void 0),et=(0,v.e)([(0,v.n)("esri.views.interactive.snapping.featureSources.SceneLayerSnappingSource")],et);var tt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).options=null,i._snappingSources=new y.j,i}return(0,h.Z)(n,[{key:"initialize",value:function(){var e=this;this.own([this.view.on("layerview-create",(function(t){var n=t.layerView;return e._createSource(n)})),this.view.on("layerview-destroy",(function(t){var n=t.layerView;return e._removeSource(n)}))]);var t,n=(0,l.Z)(this.view.allLayerViews.items);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._createSource(i)}}catch(r){n.e(r)}finally{n.f()}}},{key:"destroy",value:function(){this.options=null,this._snappingSources.drain((function(e){return e.destroy()}))}},{key:"updating",get:function(){return this._snappingSources.some((function(e){return e.updating}))}},{key:"_types",get:function(){return W.E.EDGE|W.E.VERTEX}},{key:"fetchCandidates",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,i){var a,o,s,l,u,c,d,h,p,f;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.view,o=this.options,s=n.coordinateHelper,l=n.elevationInfo,u=(0,g.r)(o)?o.distance:1,c=(0,j.c)(t,s,l,a,w.c.get()),d=u*a.state.camera.computeScreenPixelSizeAt(c),h=this._types,p=this._snappingSources.items.map((function(e){return e.fetchCandidates({point:t,coordinateHelper:s,distance:d,types:h},i)})),e.next=11,Promise.all(p);case 11:return f=e.sent.flat(),e.abrupt("return",(Oe(t,f),f));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"_createSource",value:function(e){if("scene-layer-3d"===e.type){var t=new et({layerSource:new Ae({layer:e.layer}),view:this.view});this._snappingSources.push(t)}}},{key:"_removeSource",value:function(e){var t=this._snappingSources.findIndex((function(t){return t.layerSource.layer===e.layer}));-1!==t&&this._snappingSources.removeAt(t).destroy()}}]),n}(v.y);(0,v.e)([(0,v.d)({constructOnly:!0})],tt.prototype,"view",void 0),(0,v.e)([(0,v.d)()],tt.prototype,"updating",null),(0,v.e)([(0,v.d)()],tt.prototype,"options",void 0),(0,v.e)([(0,v.d)()],tt.prototype,"_snappingSources",void 0),tt=(0,v.e)([(0,v.n)("esri.views.interactive.snapping.SceneSnappingEngine")],tt);var nt,it=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.targetPoint,o=e.constraint,s=e.previousVertex,l=e.otherVertex,u=e.otherVertexType,c=e.objectId,h=e.elevationInfo;return(0,d.Z)(this,n),(i=t.call(this,r,a,o,h)).previousVertex=s,i.otherVertex=l,i.otherVertexType=u,i.objectId=c,i}return(0,h.Z)(n,[{key:"hints",get:function(){var e=this.previousVertex,t=this.otherVertexType===nt.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===nt.CENTER?this.targetPoint:this.otherVertex,i=this.elevationInfo;return[new Ve(be.TARGET,t,n,i),new Ve(be.REFERENCE,e,t,i),new Ie(this.previousVertex,t,n,i)]}}]),n}(Be);!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(nt||(nt={}));var rt=function(e){(0,p.Z)(o,e);var t=(0,f.Z)(o);function o(e){var n;return(0,d.Z)(this,o),(n=t.call(this,e)).options=null,n.sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null}},n}return(0,h.Z)(o,[{key:"updating",get:function(){return(0,v.af)(this.snappingSources,(function(e){return e.snappingSource.updating}))||this.updatingHandles.updating}},{key:"snappingSources",get:function(){var e=this._get("snappingSources")||new Map,t=new Map;if((0,g.r)(this.options)&&(0,g.r)(this.options.featureSources)){var n,r=(0,l.Z)(this.options.featureSources.items);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=a.layer.uid,s=e.get(o);if(s)e.delete(o),t.set(o,s);else if(a.layer.loaded){var u=this._createSourceInfo(a);(0,g.r)(u)&&t.set(o,u)}else this.updatingHandles.addPromise(a.layer.load())}}catch(h){r.e(h)}finally{r.f()}}var c,d=(0,l.Z)(e);try{for(d.s();!(c=d.n()).done;){(0,i.Z)(c.value,2)[1].destroy()}}catch(h){d.e(h)}finally{d.f()}return t}},{key:"initialize",value:function(){var e=this;this.updatingHandles.add((function(){return e.snappingSources}),(function(){return e.notifyChange("updating")}),_.U),(0,g.r)(this.view)&&this.handles.add([this.view.on("layerview-create",(function(t){return e._updateLayerView(t.layer,t.layerView)})),this.view.on("layerview-destroy",(function(t){return e._updateLayerView(t.layer,null)}))])}},{key:"_updateLayerView",value:function(e,t){var n,r=(0,l.Z)(this.snappingSources);try{for(r.s();!(n=r.n()).done;){var a=(0,i.Z)(n.value,2)[1];a.snappingSource.layerSource.layer===e&&(a.layerView=t)}}catch(o){r.e(o)}finally{r.f()}}},{key:"destroy",value:function(){this._set("options",null);var e,t=(0,l.Z)(this.snappingSources);try{for(t.s();!(e=t.n()).done;){(0,i.Z)(e.value,2)[1].destroy()}}catch(n){t.e(n)}finally{t.f()}}},{key:"fetchCandidates",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,a){var o,s,u,c,d,h,p,f=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,g.t)(this.options)&&this.options.effectiveFeatureEnabled){e.next=2;break}return e.abrupt("return",[]);case 2:o=[],s=this._computeScreeenSizeDistanceParameters(t,n),u={distance:s,point:t,coordinateHelper:n.coordinateHelper,types:this.types,filter:null},c=(0,l.Z)(this.snappingSources);try{for(h=function(){var e=(0,i.Z)(d.value,2)[1],t=e.snappingSource,r=e.layerView;!t.layerSource.enabled||(0,g.r)(r)&&r.suspended||o.push(t.fetchCandidates(u,a).then((function(e){return e.filter((function(e){return!f._candidateIsExcluded(t,e,n.excludeFeature)}))})))},c.s();!(d=c.n()).done;)h()}catch(r){c.e(r)}finally{c.f()}return e.next=7,(0,v.ak)(o);case 7:return p=e.sent.flat(),e.abrupt("return",(this._addRightAngleCandidates(p,t,s,n),(0,v.H)(a),Oe(t,p),p));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"_addRightAngleCandidates",value:function(e,t,n,i){for(var r,a,o,s,l,u,c,d,h=(0,g.r)(i.vertexHandle)?null===(r=i.vertexHandle.rightEdge)||void 0===r||null===(a=r.rightVertex)||void 0===a?void 0:a.pos:(0,g.r)(i.editGeometryOperations)&&"polygon"===i.editGeometryOperations.data.type?null===(o=(0,g.e)(null===(s=i.editGeometryOperations.data.components[0])||void 0===s?void 0:s.getFirstVertex()))||void 0===o?void 0:o.pos:null,p=(0,g.r)(i.vertexHandle)?null===(l=i.vertexHandle.leftEdge)||void 0===l||null===(u=l.leftVertex)||void 0===u?void 0:u.pos:(0,g.r)(i.editGeometryOperations)?null===(c=(0,g.e)(null===(d=i.editGeometryOperations.data.components[0])||void 0===d?void 0:d.getLastVertex()))||void 0===c?void 0:c.pos:null,f=e.length,v=0;v<f;v++)this._addRightAngleCandidate(e[v],p,t,n,i,e),this._addRightAngleCandidate(e[v],h,t,n,i,e)}},{key:"_addRightAngleCandidate",value:function(e,t,n,i,r,a){if(!(0,g.t)(t)&&e instanceof Qe){var o=e.constraint.closestTo(t),s=(o[0]-n[0])/i.x,l=(o[1]-n[1])/i.y;if(s*s+l*l<=1){var u=r.coordinateHelper;a.push(new it({coordinateHelper:u,targetPoint:o,otherVertex:t,otherVertexType:nt.NEXT,previousVertex:e.constraint.start,constraint:new qe(u,t,o),objectId:e.objectId,elevationInfo:e.elevationInfo}))}}}},{key:"_computeScreeenSizeDistanceParameters",value:function(e,t){var n=(0,g.r)(this.options)?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;if((0,g.t)(this.view))return{x:n,y:n,pixelSize:n};if("2d"===this.view.type){var i=n*this.view.resolution;return{x:i,y:i,pixelSize:i}}return this._computeScreenSizeDistanceParameters3D(e,n,this.view,t)}},{key:"_computeScreenSizeDistanceParameters3D",value:function(e,t,n,i){var r=i.coordinateHelper,a=i.elevationInfo,o=n.state.camera.computeScreenPixelSizeAt((0,j.c)(e,r,a,n,ot)),s=o*n.renderCoordsHelper.unitInMeters/n.mapCoordsHelper.unitInMeters,l=t*s;return{x:l/this._computeScreenMagnitudeOfMapOffset(e,s,0,n,i),y:l/this._computeScreenMagnitudeOfMapOffset(e,0,s,n,i),pixelSize:o}}},{key:"_computeScreenMagnitudeOfMapOffset",value:function(e,t,n,i,r){var a=r.coordinateHelper,o=r.elevationInfo,s=a.clone(e);s[0]+=t,s[1]+=n;var l=(0,j.R)(e,a,o,i),u=(0,j.R)(s,a,o,i),c=u.x-l.x,d=u.y-l.y;return Math.sqrt(c*c+d*d)}},{key:"types",get:function(){return W.E.EDGE|W.E.VERTEX}},{key:"_candidateIsExcluded",value:function(e,t,n){if((0,g.t)(n))return!1;var i=this._getCandidateObjectId(t);if((0,g.t)(i))return!1;var r=e.layerSource.layer;return"graphics"===r.type?n.uid===i:n.sourceLayer===r&&!(!n.attributes||!("objectIdField"in r))&&n.attributes[r.objectIdField]===i}},{key:"_getCandidateObjectId",value:function(e){return e instanceof Xe?e.objectId:null}},{key:"_createSourceInfo",value:function(e){var t=this,n=this._createFeatureSnappingSourceType(e);if((0,g.t)(n))return null;if("loading"in n)return this.updatingHandles.addPromise(n.loading.then((function(){t.destroyed||t.notifyChange("snappingSources")}))),null;var i=(0,g.r)(this.view)?this.view.allLayerViews.find((function(t){return t.layer===e.layer})):null;return new at(n.source,i)}},{key:"_createFeatureSnappingSourceType",value:function(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e)}return null}},{key:"_createFeatureSnappingSourceFeatureLayer",value:function(e){switch(e.layer.source.type){case"feature-layer":var t=this._getSourceModule("featureService");return(0,g.r)(t.module)?{source:new t.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader};case"memory":case"csv":case"geojson":case"wfs":if("mesh"===e.layer.geometryType)return null;var n=this._getSourceModule("featureCollection");return(0,g.r)(n.module)?{source:new n.module.FeatureCollectionSnappingSource({layerSource:e})}:{loading:n.loader}}return null}},{key:"_createFeatureSnappingSourceGraphicsLayer",value:function(e){var t=this._getSourceModule("graphics");return(0,g.r)(t.module)?{source:new t.module.GraphicsSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}},{key:"_getSourceModule",value:function(e){var t=this.sourceModules[e];if((0,g.t)(t.loader)){var n=this._loadSourceModule(e).then((function(e){t.module=e}));return t.loader=n,{module:t.module,loader:n}}return{module:t.module,loader:t.loader}}},{key:"_loadSourceModule",value:function(e){switch(e){case"featureService":return this.updatingHandles.addPromise(n.e(5787).then(n.bind(n,45787)));case"featureCollection":return this.updatingHandles.addPromise(n.e(178).then(n.bind(n,40178)));case"graphics":return this.updatingHandles.addPromise(Promise.all([n.e(881),n.e(4054)]).then(n.bind(n,44054)))}return null}}]),o}(b.d);(0,v.e)([(0,v.d)({constructOnly:!0})],rt.prototype,"spatialReference",void 0),(0,v.e)([(0,v.d)({constructOnly:!0})],rt.prototype,"view",void 0),(0,v.e)([(0,v.d)()],rt.prototype,"options",void 0),(0,v.e)([(0,v.d)({readOnly:!0})],rt.prototype,"updating",null),(0,v.e)([(0,v.d)({readOnly:!0})],rt.prototype,"snappingSources",null),rt=(0,v.e)([(0,v.n)("esri.views.interactive.snapping.FeatureSnappingEngine")],rt);var at=function(){function e(t,n){(0,d.Z)(this,e),this.snappingSource=t,this.layerView=n,this.handles=new P.u;var i=this.snappingSource.layerSource.layer;if("refresh"in i){var r=i;this.handles.add(r.on("refresh",(function(){return t.refresh()})))}this.handles.add([(0,_.l)((function(){return t.updating}),(function(e){return t.layerSource.updating=e}),_.w),(0,_.l)((function(){return t.availability}),(function(e){return t.layerSource.availability=e}),_.w)])}return(0,h.Z)(e,[{key:"destroy",value:function(){this.snappingSource.destroy(),this.handles.destroy()}}]),e}(),ot=(0,C.n)(),st=function(){function e(t,n){(0,d.Z)(this,e),this.view=t,this.options=n,this.squaredShortLineThreshold=Pe.shortLineThreshold*Pe.shortLineThreshold}return(0,h.Z)(e,[{key:"snap",value:function(e,t){return(0,g.r)(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}},{key:"edgeExceedsShortLineThreshold",value:function(e,t){return this.exceedsShortLineThreshold(e.leftVertex.pos,e.rightVertex.pos,t)}},{key:"exceedsShortLineThreshold",value:function(e,t,n){var i=n.elevationInfo,r=n.editGeometryOperations.data.coordinateHelper;return 0===this.squaredShortLineThreshold||Te((0,j.R)(t,r,i,this.view),(0,j.R)(e,r,i,this.view))>this.squaredShortLineThreshold}},{key:"squaredProximityTreshold",value:function(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}},{key:"squaredMouseProximityTreshold",get:function(){return this.options.distance*this.options.distance}},{key:"squaredTouchProximityThreshold",get:function(){var e=this.options,t=e.distance*e.touchSensitivityMultiplier;return t*t}}]),e}(),lt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.lineStart,o=e.lineEnd,s=e.targetPoint,l=e.elevationInfo;return(0,d.Z)(this,n),(i=t.call(this,r,s,new We(r,a,o),l)).referenceLineHint=new Ve(be.REFERENCE_EXTENSION,a,o,l),i}return(0,h.Z)(n,[{key:"hints",get:function(){return[this.referenceLineHint,new Ve(be.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo)]}},{key:"_lineEndClosestToTarget",value:function(){var e=this.constraint.start,t=this.constraint.end;return Math.sign((0,N.j)((0,N.o)(ct,t,e),(0,N.o)(ut,this.targetPoint,e)))>0?t:e}}]),n}(Be),ut=(0,B.n)(),ct=(0,B.n)(),dt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,d.Z)(this,n),t.apply(this,arguments)}return(0,h.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=[];if(i<1)return r;var a=t.coordinateHelper,o=(0,j.R)(e,a,t.elevationInfo,this.view),s=n.edges[i-1],l=s;do{this.edgeExceedsShortLineThreshold(l,t)&&this._processCandidateProposal(l.leftVertex.pos,l.rightVertex.pos,e,o,t,r),l=l.leftVertex.leftEdge}while(l&&l!==s);return r}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,g.e)(t.vertexHandle),r=i.component;if(r.edges.length<2)return n;var a=t.coordinateHelper,o=(0,j.R)(e,a,t.elevationInfo,this.view),s=i.leftEdge,l=i.rightEdge;s&&l&&this.edgeExceedsShortLineThreshold(s,t)&&this.edgeExceedsShortLineThreshold(l,t)&&this._processCandidateProposal(s.leftVertex.pos,l.rightVertex.pos,e,o,t,n);var u=r.edges[0],c=u;do{c!==i.leftEdge&&c!==i.rightEdge&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal(c.leftVertex.pos,c.rightVertex.pos,e,o,t,n),c=c.rightVertex.rightEdge}while(c&&c!==u);return n}},{key:"_processCandidateProposal",value:function(e,t,n,i,r,a){var o=(0,q.L)((0,B.n)(),n,e,t),s=r.coordinateHelper,l=r.elevationInfo,u=r.pointer,c=s.fromXYZ(o,s.getZ(n,0));Te(i,(0,j.R)(c,s,l,this.view))<this.squaredProximityTreshold(u)&&a.push(new lt({coordinateHelper:s,lineStart:e,lineEnd:t,targetPoint:c,elevationInfo:l}))}}]),n}(st),ht=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.referenceLine,o=e.lineStart,s=e.targetPoint,l=e.elevationInfo;(0,d.Z)(this,n);var u=r.clone(o);return(0,N.o)(u,(0,N.s)(u,u,a.rightVertex.pos),a.leftVertex.pos),(i=t.call(this,r,s,new We(r,o,u),l))._referenceLines=[{edge:a,fadeLeft:!0,fadeRight:!0}],i}return(0,h.Z)(n,[{key:"hints",get:function(){var e=this.elevationInfo;return[new Ve(be.TARGET,this.constraint.start,this.targetPoint,e),new He(this.constraint.start,this.targetPoint,e)].concat((0,s.Z)(this._referenceLines.map((function(t){return new Ve(be.REFERENCE,t.edge.leftVertex.pos,t.edge.rightVertex.pos,e,t.fadeLeft,t.fadeRight)}))))}},{key:"addReferenceLine",value:function(e){var t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((function(n){e.rightVertex.rightEdge===n.edge&&(n.fadeLeft=!1,t.fadeRight=!1),e.leftVertex.leftEdge===n.edge&&(n.fadeRight=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}]),n}(Be),pt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,d.Z)(this,n),(e=t.apply(this,arguments))._tmpProjection=(0,B.n)(),e}return(0,h.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=n.vertices.length,a=[];if(i<2)return a;var o=(0,j.R)(e,t.coordinateHelper,t.elevationInfo,this.view),s=n.vertices[r-1],l=n.vertices[0],u=n.edges[i-1],c=u;do{this.edgeExceedsShortLineThreshold(c,t)&&(this._checkEdgeForParalleLines(c,s.pos,e,o,t,a),this._checkEdgeForParalleLines(c,l.pos,e,o,t,a)),c=c.leftVertex.leftEdge}while(c&&c!==u);return a}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,g.e)(t.vertexHandle),r=i.component;if(r.edges.length<3)return n;var a=(0,j.R)(e,t.coordinateHelper,t.elevationInfo,this.view),o=i.leftEdge,s=i.rightEdge,l=r.vertices[0],u=r.vertices.length,c=r.vertices[u-1],d=r.edges[0],h=d;do{h!==o&&h!==s&&this.edgeExceedsShortLineThreshold(h,t)&&(o&&this._checkEdgeForParalleLines(h,o.leftVertex.pos,e,a,t,n),s&&this._checkEdgeForParalleLines(h,s.rightVertex.pos,e,a,t,n),i===l?this._checkEdgeForParalleLines(h,c.pos,e,a,t,n):i===c&&this._checkEdgeForParalleLines(h,l.pos,e,a,t,n)),h=h.rightVertex.rightEdge}while(h&&h!==d);return n}},{key:"_checkEdgeForParalleLines",value:function(e,t,n,i,r,a){var o=e.leftVertex.pos,s=e.rightVertex.pos;if((0,q.L)(this._tmpProjection,t,o,s),!((0,N.b)(this._tmpProjection,t)<Pe.parallelLineThreshold)){(0,q.L)(this._tmpProjection,n,o,s,t);var l=r.coordinateHelper,u=r.elevationInfo,c=r.pointer,d=l.fromXYZ(this._tmpProjection,l.getZ(n,0));if(Te(i,(0,j.R)(d,l,u,this.view))<this.squaredProximityTreshold(c)){if(this._parallelToPreviousCandidate(e,a))return;a.push(new ht({coordinateHelper:l,referenceLine:e,lineStart:t,targetPoint:d,elevationInfo:u}))}}}},{key:"_parallelToPreviousCandidate",value:function(e,t){var n,i=e.leftVertex.pos,r=e.rightVertex.pos,a=(0,l.Z)(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;if((0,q.L)(this._tmpProjection,r,o.constraint.start,o.constraint.end,i),(0,N.b)(this._tmpProjection,r)<Pe.parallelLineThreshold)return o.addReferenceLine(e),!0}}catch(s){a.e(s)}finally{a.f()}return!1}}]),n}(st),ft=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,d.Z)(this,n),(e=t.apply(this,arguments))._tmp=(0,B.n)(),e}return(0,h.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=n.vertices.length,r=[];if(i<2)return r;var a=(0,j.R)(e,t.coordinateHelper,t.elevationInfo,this.view),o=n.vertices[i-1];this._checkForSnappingCandidate(r,o.leftEdge,o.pos,e,o.leftEdge.leftVertex.pos,o.pos,t,e,a);var s=n.vertices[0];return this._checkForSnappingCandidate(r,s.rightEdge,s.pos,e,s.rightEdge.rightVertex.pos,s.pos,t,e,a),r}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,g.e)(t.vertexHandle),r=i.component,a=r.vertices.length;if(a<3)return n;var o=(0,j.R)(e,t.coordinateHelper,t.elevationInfo,this.view),s=i.leftEdge,l=i.rightEdge,u=r.vertices[0],c=r.vertices[a-1];if(!s)return this._checkForSnappingCandidate(n,u.rightEdge.rightVertex.rightEdge,u.rightEdge.rightVertex.pos,e,u.rightEdge.rightVertex.rightEdge.rightVertex.pos,u.rightEdge.rightVertex.pos,t,e,o),n;if(!l)return this._checkForSnappingCandidate(n,c.leftEdge.leftVertex.leftEdge,c.leftEdge.leftVertex.pos,e,c.leftEdge.leftVertex.leftEdge.leftVertex.pos,c.leftEdge.leftVertex.pos,t,e,o),n;if(s&&s.leftVertex.leftEdge){var d=s.leftVertex.leftEdge;this._checkForSnappingCandidate(n,d,s.leftVertex.pos,e,d.leftVertex.pos,s.leftVertex.pos,t,e,o)}if(l&&l.rightVertex.rightEdge){var h=l.rightVertex.rightEdge;this._checkForSnappingCandidate(n,h,l.rightVertex.pos,e,h.rightVertex.pos,l.rightVertex.pos,t,e,o)}return n}},{key:"_checkForSnappingCandidate",value:function(e,t,n,i,r,a,o,s,l){if(this.edgeExceedsShortLineThreshold(t,o)){(0,N.o)(this._tmp,t.rightVertex.pos,t.leftVertex.pos);var u=(0,B.r)(this._tmp[1],-this._tmp[0]),c=(0,N.j)(u,(0,N.o)(this._tmp,i,n))/(0,N.p)(u),d=o.coordinateHelper,h=o.elevationInfo,p=o.pointer,f=d.fromXYZ((0,N.d)((0,B.n)(),a,u,c),d.getZ(s,0));Te(l,(0,j.R)(f,d,h,this.view))<this.squaredProximityTreshold(p)&&e.push(new it({coordinateHelper:d,targetPoint:f,constraint:new qe(d,a,(0,N.d)(d.createVector(),a,u,Math.sign(c))),previousVertex:r,otherVertex:a,otherVertexType:nt.CENTER,elevationInfo:h}))}}}]),n}(st),vt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i,r=e.coordinateHelper,a=e.targetPoint,o=e.point1,s=e.point2,l=e.elevationInfo;return(0,d.Z)(this,n),(i=t.call(this,r,a,new Ye(r,(0,N.A)(yt,o,s,.5),.5*(0,N.m)(o,s)),l)).p1=o,i.p2=s,i}return(0,h.Z)(n,[{key:"hints",get:function(){var e=this.elevationInfo;return[new Ve(be.REFERENCE,this.targetPoint,this.p1,e),new Ve(be.REFERENCE,this.targetPoint,this.p2,e),new Ie(this.p1,this.targetPoint,this.p2,e)]}}]),n}(Be),yt=(0,B.n)(),gt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,d.Z)(this,n),t.apply(this,arguments)}return(0,h.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=[],r=n.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return i;var a=n.vertices[0],o=n.vertices[r-1];return this._processCandidateProposal(a.pos,o.pos,e,t,i),i}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,g.e)(t.vertexHandle),r=i.component;return r.edges.length<2?n:"polyline"!==t.editGeometryOperations.data.type||0!==i.index&&i.index!==r.vertices.length-1?(this._processCandidateProposal(i.leftEdge.leftVertex.pos,i.rightEdge.rightVertex.pos,e,t,n),n):n}},{key:"_processCandidateProposal",value:function(e,t,n,i,r){if(this.exceedsShortLineThreshold(e,t,i)){var a=(0,N.A)((0,B.n)(),e,t,.5),o=.5*(0,N.m)(e,t),s=(0,q.m)((0,B.n)(),n,a,o),l=i.coordinateHelper,u=i.elevationInfo,c=i.pointer,d=l.fromXYZ(s,l.getZ(n,0));Te((0,j.R)(n,l,u,this.view),(0,j.R)(d,l,u,this.view))<this.squaredProximityTreshold(c)&&r.push(new vt({coordinateHelper:l,targetPoint:d,point1:e,point2:t,elevationInfo:u}))}}}]),n}(st),_t=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).updating=!1,i._snappers=new y.j,i}return(0,h.Z)(n,[{key:"initialize",value:function(){this._snappers.push(new pt(this.view,this.options),new dt(this.view,this.options),new ft(this.view,this.options),new gt(this.view,this.options))}},{key:"options",set:function(e){this._set("options",e);var t,n=(0,l.Z)(this._snappers);try{for(n.s();!(t=n.n()).done;){t.value.options=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"fetchCandidates",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i,a,o,u;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.options.effectiveSelfEnabled){e.next=2;break}return e.abrupt("return",[]);case 2:i=[],a=(0,l.Z)(this._snappers.items);try{for(a.s();!(o=a.n()).done;)u=o.value,i.push.apply(i,(0,s.Z)(u.snap(t,n)))}catch(r){a.e(r)}finally{a.f()}return e.abrupt("return",(Oe(t,i),i));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(v.y);function mt(e,t){return[new _t({view:e,options:t}),new rt({view:e,options:t,spatialReference:e.spatialReference})]}(0,v.e)([(0,v.d)({readOnly:!0})],_t.prototype,"updating",void 0),(0,v.e)([(0,v.d)({constructOnly:!0})],_t.prototype,"view",void 0),(0,v.e)([(0,v.d)()],_t.prototype,"options",null),_t=(0,v.e)([(0,v.n)("esri.views.interactive.snapping.SelfSnappingEngine")],_t);var wt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).enabled=!1,i.enabledToggled=!1,i.selfEnabled=!0,i.featureEnabled=!0,i.featureSources=new y.j,i.distance=Pe.distance,i.touchSensitivityMultiplier=Pe.touchSensitivityMultiplier,i}return(0,h.Z)(n,[{key:"effectiveEnabled",get:function(){return this.enabledToggled?!this.enabled:this.enabled}},{key:"effectiveSelfEnabled",get:function(){return this.effectiveEnabled&&this.selfEnabled}},{key:"effectiveFeatureEnabled",get:function(){return this.effectiveEnabled&&this.featureEnabled}}]),n}(v.y);(0,v.e)([(0,v.d)()],wt.prototype,"enabled",void 0),(0,v.e)([(0,v.d)()],wt.prototype,"enabledToggled",void 0),(0,v.e)([(0,v.d)()],wt.prototype,"selfEnabled",void 0),(0,v.e)([(0,v.d)()],wt.prototype,"featureEnabled",void 0),(0,v.e)([(0,v.d)({type:y.j.ofType(Ae)})],wt.prototype,"featureSources",void 0),(0,v.e)([(0,v.d)()],wt.prototype,"distance",void 0),(0,v.e)([(0,v.d)()],wt.prototype,"touchSensitivityMultiplier",void 0),(0,v.e)([(0,v.d)({readOnly:!0})],wt.prototype,"effectiveEnabled",null),(0,v.e)([(0,v.d)({readOnly:!0})],wt.prototype,"effectiveSelfEnabled",null),(0,v.e)([(0,v.d)({readOnly:!0})],wt.prototype,"effectiveFeatureEnabled",null);var xt=wt=(0,v.e)([(0,v.n)("esri.views.interactive.snapping.SnappingOptions")],wt),kt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e,i,r,a,o){var s;return(0,d.Z)(this,n),(s=t.call(this,e,i,new Ue(e,i,r.constraint,a.constraint),o)).first=r,s.second=a,s}return(0,h.Z)(n,[{key:"hints",get:function(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[].concat((0,s.Z)(this.first.hints),(0,s.Z)(this.second.hints),[new Me(this.targetPoint,this.elevationInfo)])}}]),n}(Be),Zt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).options=new xt,i.snappingEnginesFactory=mt,i._engines=[],i._currentMainCandidate=null,i._currentOtherActiveCandidates=[],i}return(0,h.Z)(n,[{key:"initialize",value:function(){var e=this;this.handles.add([(0,_.l)((function(){var t=e.options;return{effectiveFeatureEnabled:t.effectiveFeatureEnabled,effectiveSelfEnabled:t.effectiveSelfEnabled,touchSensitivityMultiplier:t.touchSensitivityMultiplier,distance:t.distance}}),(function(){e.doneSnapping(),e.emit("changed")}),_.U),(0,_.l)((function(){return e.options}),(function(t){var n,i=(0,l.Z)(e._engines);try{for(i.s();!(n=i.n()).done;){n.value.options=t}}catch(r){i.e(r)}finally{i.f()}}),_.U),(0,_.l)((function(){return{viewReady:e.view.ready,viewSpatialReference:e.view.spatialReference,snappingEnginesFactory:e.snappingEnginesFactory}}),(function(t){var n=t.viewReady,i=t.snappingEnginesFactory;return e._recreateEngines(n,i)}),_.w)])}},{key:"destroy",value:function(){this._destroyEngines()}},{key:"updating",get:function(){return this._engines.some((function(e){return e.updating}))}},{key:"_recreateEngines",value:function(e,t){if(this._destroyEngines(),e){var n=this.view,i=this.options;this._engines=t(n,i)}}},{key:"_destroyEngines",value:function(){var e,t=(0,l.Z)(this._engines);try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}this._engines=[]}},{key:"squaredMouseProximityTreshold",get:function(){return this.options.distance*this.options.distance}},{key:"squaredTouchProximityThreshold",get:function(){var e=this.options,t=e.distance*e.touchSensitivityMultiplier;return t*t}},{key:"snap",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,i){var a,o,s=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.coordinateHelper.pointToVector(t),e.next=3,this._fetchCandidates(a,n,i);case 3:return o=e.sent,e.t0=function(){var e=s._processCandidates(a,o,n),t=e.snappedPoint,i=e.hints;return s._removeVisualization(),(0,g.r)(n.visualizer)&&s.handles.add(n.visualizer.draw(i,{coordinateHelper:n.coordinateHelper,elevationInfo:n.elevationInfo,view:s.view}),St),t},e.abrupt("return",{get valid(){return!(0,v.p)(i)},apply:e.t0});case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"update",value:function(e,t){this._removeVisualization();var n=e,i=[];if((0,g.r)(this._currentMainCandidate)){var r=t.coordinateHelper,a=r.pointToVector(e),o=this._currentMainCandidate.constraint.closestTo(a);if(Te((0,j.R)(a,r,t.elevationInfo,this.view),(0,j.R)(o,r,t.elevationInfo,this.view))<this._squaredPointProximityThreshold(t.pointer)){n=r.vectorToDehydratedPoint(o),this._currentMainCandidate.targetPoint=o,i.push.apply(i,(0,s.Z)(this._currentMainCandidate.hints));var u,c=(0,l.Z)(this._currentOtherActiveCandidates);try{for(c.s();!(u=c.n()).done;){var d=u.value;d.targetPoint=o,i.push.apply(i,(0,s.Z)(d.hints))}}catch(h){c.e(h)}finally{c.f()}}else this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}return(0,g.r)(t.visualizer)&&this.handles.add(t.visualizer.draw(i,{coordinateHelper:t.coordinateHelper,elevationInfo:t.elevationInfo,view:this.view}),St),n}},{key:"doneSnapping",value:function(){this._removeVisualization(),this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}},{key:"_removeVisualization",value:function(){this.handles.remove(St)}},{key:"_fetchCandidates",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this._engines.map((function(e){return e.fetchCandidates(t,n,i)})));case 2:return e.abrupt("return",e.sent.flat());case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"_processCandidates",value:function(e,t,n){if(t.length<1)return this.doneSnapping(),{snappedPoint:n.coordinateHelper.vectorToDehydratedPoint(e),hints:[]};Oe(e,t);var i=this._currentMainCandidate;if((0,g.r)(i)){var r=this._findOldConstraintInNewCandidates(i,t);if(r>=0){if(!(t[r]instanceof kt))return this._intersectWithOtherCandidates(r,t,e,n);if((0,N.b)(e,i.targetPoint)<this._squaredPointProximityThreshold(n.pointer))return this._updateSnappingCandidate(i,t,n)}}return this._intersectWithOtherCandidates(0,t,e,n)}},{key:"_findOldConstraintInNewCandidates",value:function(e,t){return e instanceof kt?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}},{key:"_intersectWithOtherCandidates",value:function(e,t,n,i){for(var r=t[e],a=[],o=i.coordinateHelper,s=0;s<t.length;++s)if(s!==e){var u,c=t[s],d=(0,l.Z)(r.constraint.intersect(c.constraint));try{for(d.s();!(u=d.n()).done;){var h=u.value,p=o.fromXYZ(h.intersection,r.targetPoint[2]);a.push([new kt(o,p,r,c,c.elevationInfo),Te((0,j.R)(n,i.coordinateHelper,i.elevationInfo,this.view),(0,j.R)(p,i.coordinateHelper,i.elevationInfo,this.view))])}}catch(f){d.e(f)}finally{d.f()}}return a.length>0&&(a.sort((function(e,t){return e[1]-t[1]})),a[0][1]<this._squaredPointProximityThreshold(i.pointer))?this._updateSnappingCandidate(a[0][0],t,i):this._updateSnappingCandidate(r,t,i)}},{key:"_updateSnappingCandidate",value:function(e,t,n){this.doneSnapping(),this._currentMainCandidate=e;var i=this._currentMainCandidate.targetPoint,r=[];r.push.apply(r,(0,s.Z)(e.hints));var a,o=(0,l.Z)(t);try{for(o.s();!(a=o.n()).done;){var u=a.value;if(e instanceof kt){if(u.constraint.objectEqual(e.first.constraint)||u.constraint.objectEqual(e.second.constraint))continue}else if(u.constraint.objectEqual(e.constraint))continue;u.constraint.check(i)&&(u.targetPoint=i,this._currentOtherActiveCandidates.push(u),r.push.apply(r,(0,s.Z)(u.hints)))}}catch(c){o.e(c)}finally{o.f()}return{snappedPoint:n.coordinateHelper.vectorToDehydratedPoint(i),hints:r}}},{key:"_squaredPointProximityThreshold",value:function(e){return"touch"===e?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}},{key:"_findOldCandidateIndex",value:function(e,t){for(var n=-1,i=0;i<e.length;++i)if(t.constraint.objectEqual(e[i].constraint)){n=i;break}return n}},{key:"test",get:function(){return{visualizationsActive:this.handles.has(St),engines:this._engines}}}]),n}(y.n.EventedMixin(b.d));(0,v.e)([(0,v.d)({constructOnly:!0})],Zt.prototype,"view",void 0),(0,v.e)([(0,v.d)()],Zt.prototype,"options",void 0),(0,v.e)([(0,v.d)({readOnly:!0})],Zt.prototype,"updating",null),(0,v.e)([(0,v.d)()],Zt.prototype,"snappingEnginesFactory",void 0),(0,v.e)([(0,v.d)()],Zt.prototype,"_engines",void 0),(0,v.e)([(0,v.d)()],Zt.prototype,"squaredMouseProximityTreshold",null),(0,v.e)([(0,v.d)()],Zt.prototype,"squaredTouchProximityThreshold",null),Zt=(0,v.e)([(0,v.n)("esri.views.interactive.snapping.SnappingManager")],Zt);var St="visualization-handle",Et=new Map;function bt(e){Et.has(e)||Et.set(e,{referenceCount:0,snappingManager:Pt(e)});var t=Et.get(e);t.referenceCount++;var n=(0,v.g)((function(){return function(e,t){t.referenceCount--,t.referenceCount>0||(0,v.aa)((function(){0===t.referenceCount&&(t.snappingManager.destroy(),Et.delete(e))}))}(e,t)}));return(0,o.Z)({snappingManager:t.snappingManager},n)}function Pt(e){return new Zt({view:e,snappingEnginesFactory:function(t,n){return[new tt({view:e,options:n})]}})}var Tt=function(){function e(t){(0,d.Z)(this,e),this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.editGeometryOperations=t.editGeometryOperations,this.elevationInfo=t.elevationInfo,this.pointer=t.pointer,this.vertexHandle=t.vertexHandle,this.excludeFeature=t.excludeFeature,this.visualizer=t.visualizer}return(0,h.Z)(e,[{key:"coordinateHelper",get:function(){return this.editGeometryOperations.data.coordinateHelper}}]),e}(),Rt=function(){function e(){(0,d.Z)(this,e),this.next=new O.G}return(0,h.Z)(e,[{key:"createSnapDragEventPipelineStep",value:function(e){var t=this,n=e.predicate,i=void 0===n?function(){return!0}:n,s=e.cancel,l=e.snappingManager,u=e.snappingContext,c=e.updatingHandles;if((0,g.t)(l))return function(e){return e};var d=null,h=null,p=function(){d=(0,g.C)(d),l.doneSnapping(),(0,g.r)(h)&&h.frameTask.remove(),h=null};s.next((function(e){return p(),e})),this.next=new O.G;var f,y,_=(0,v.x)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n,i){var a,o,s,u,c,d,h,p;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.frameTask,o=n.point,s=n.context,u=n.event,c=n.dx,d=n.dy,e.next=3,a.schedule((function(){return l.snap(o,s,i)}),i);case 3:if(!(h=e.sent).valid){e.next=9;break}return e.next=7,a.schedule((function(){return h.apply()}),i);case 7:p=e.sent,o!==f&&(p=l.update(f,s)),(0,X.r)(p,y)||(u.mapEnd.x=p.x+c,u.mapEnd.y=p.y+d,t.next.execute(u));case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());return function(e){if(!i(e))return e;if("start"===e.action){var t="3d"===l.view.type?l.view.resourceController.scheduler.registerTask(Q.L.SNAPPING):Q.Q;h={context:new Tt({editGeometryOperations:u.editGeometryOperations,elevationInfo:u.elevationInfo,pointer:u.pointer,vertexHandle:(0,g.r)(e.info)?e.info.handle:null,excludeFeature:u.excludeFeature,visualizer:u.visualizer}),originalPos:(0,g.r)(e.snapOrigin)?u.coordinateHelper.vectorToDehydratedPoint(e.snapOrigin):e.mapStart,frameTask:t}}if((0,g.r)(h)){var n=h.context.coordinateHelper.vectorToDehydratedPoint(h.context.coordinateHelper.arrayToVector([h.originalPos.x,h.originalPos.y,h.originalPos.z]));n.x+=e.mapEnd.x-e.mapStart.x,n.y+=e.mapEnd.y-e.mapStart.y;var r=e.mapStart.x-h.originalPos.x,a=e.mapStart.y-h.originalPos.y,s=(0,o.Z)((0,o.Z)({},e),{},{action:"update"}),m=h.context,w=l.update(n,h.context);if(y=w,e.mapEnd.x=w.x+r,e.mapEnd.y=w.y+a,f=n,"end"!==e.action){var x=h.frameTask;(0,g.r)(d)||(d=new AbortController),c.addPromise((0,v.a9)(_({frameTask:x,event:s,context:m,point:n,dx:r,dy:a},d.signal)))}}return"end"===e.action&&p(),e}}}]),e}(),Ot=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).stagedPoint=null,i._abortController=null,i._snap=(0,v.x)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,a,o){var s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i._frameTask.schedule((function(){return n.snap(t,a,o)}),o);case 2:if(s=e.sent,e.t0=s.valid,!e.t0){e.next=7;break}return e.next=7,i._frameTask.schedule((function(){i.stagedPoint=s.apply(),t!==i._snapMapPoint&&(i.stagedPoint=n.update(i._snapMapPoint,a))}),o);case 7:case"end":return e.stop()}}),e)})));return function(t,n,i,r){return e.apply(this,arguments)}}()),i}return(0,h.Z)(n,[{key:"initialize",value:function(){var e,t,n="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(t=e.resourceController)||void 0===t?void 0:t.scheduler:null;this._frameTask=(0,g.r)(n)?n.registerTask(Q.L.SNAPPING):Q.Q}},{key:"destroy",value:function(){this._abortController=(0,g.C)(this._abortController),this._frameTask=(0,g.d)(this._frameTask)}},{key:"snap",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.stagedPoint=n.update(t,i),this._snapMapPoint=t,(0,g.t)(this._abortController)&&(this._abortController=new AbortController),this._snap(t,n,i,this._abortController.signal)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"abort",value:function(){this._abortController=(0,g.C)(this._abortController)}}]),n}(v.y);(0,v.e)([(0,v.d)({constructOnly:!0})],Ot.prototype,"view",void 0),(0,v.e)([(0,v.d)()],Ot.prototype,"stagedPoint",void 0),Ot=(0,v.e)([(0,v.n)("esri.views.interactive.snapping.SnappingOperation")],Ot);var Ct,Mt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).stagedDimension=null,i._dimensionManipulators=new Map,i._dimensionHandles=new P.u,i._snappingPipeline=new Rt,i._snappingManagerResult=bt(e.view),i.own(i._snappingManagerResult),i}return(0,h.Z)(n,[{key:"initialize",value:function(){var e=this;this._snappingOperation=new Ot({view:this.view}),this.own([this._dimensionHandles,(0,_.l)((function(){return e._snappingOperation.stagedPoint}),(function(t){(0,g.r)(e.stagedDimension)&&(e.stagedDimension.endPoint=(0,g.h)(t,(function(e){return(0,T.aW)(e,new E.j)})))}),_.U)])}},{key:"destroy",value:function(){this._snappingOperation=(0,g.l)(this._snappingOperation)}},{key:"updating",get:function(){return this.updatingHandles.updating||this._snappingManager.updating}},{key:"_snappingManager",get:function(){return this._snappingManagerResult.snappingManager}},{key:"addDimension",value:function(e,t){if(!this._dimensionManipulators.has(e)){var n=this._createPointManipulator(e,{isStart:!0}),i=this._createPointManipulator(e,{isStart:!1}),r={startManipulator:n,endManipulator:i};this._setupDimensionToManipulatorsSync(e,r),this._dimensionManipulators.set(e,r),t.add(n),t.add(i)}}},{key:"removeDimension",value:function(e,t){var n=this._dimensionManipulators.get(e);if(!(0,g.t)(n)){this._dimensionHandles.remove(e);var i=n.startManipulator,r=n.endManipulator;this._dimensionManipulators.delete(e),t.remove(i),t.remove(r)}}},{key:"getManipulatorsForDimension",value:function(e){return this._dimensionManipulators.get(e)}},{key:"onDeactivate",value:function(){this._snappingManager.doneSnapping()}},{key:"onUnstagedClick",value:function(e){var t=e.mapPoint,n=e.pointerType,i=this._snappingContext(n),r=(0,T.aW)(this._snappingManager.update(t,i),new E.j),a=new ae({startPoint:r,endPoint:null});return this.stagedDimension=a,this._snappingManager.doneSnapping(),a}},{key:"onStagedClick",value:function(e){var t=e.mapPoint,n=e.pointerType;if(!(0,g.t)(this.stagedDimension)){var i=this._snappingContext(n),r=(0,T.aW)(this._snappingManager.update(t,i),new E.j);this.stagedDimension.endPoint=r,this.stagedDimension=null,this._snappingManager.doneSnapping()}}},{key:"onPointerMove",value:function(e){var t=e.mapPoint,n=e.pointerType,i=this._snappingContext(n);this.updatingHandles.addPromise((0,v.a9)(this._snappingOperation.snap(t,this._snappingManager,i)))}},{key:"_setupDimensionToManipulatorsSync",value:function(e,t){var n=this,i=t.startManipulator,r=t.endManipulator;this._dimensionHandles.add([(0,_.l)((function(){return{startPoint:e.startPoint,endPoint:e.endPoint,stagedDimension:n.stagedDimension}}),(function(t){var n=t.startPoint,a=t.endPoint,o=t.stagedDimension;(0,g.r)(n)?(i.available=(0,g.t)(o)||o===e,i.location=n):i.available=!1,(0,g.r)(a)?(r.available=(0,g.t)(o),r.location=a):r.available=!1}),_.w)],e)}},{key:"_createPointManipulator",value:function(e,t){var n=this,i=t.isStart?"startPoint":"endPoint",r=(0,O.y)(this.view,x.l.toUnitRGB(ue.pointManipulators.color),ue.pointManipulators.opacity);r.available=!1,r.radius=ue.pointManipulators.radius;var a=(0,O.p)(r,(function(t,r,a,o){var s=(0,G.z)(t);r.next(s).next((0,G.B)(n.view)).next(n._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:n._snappingContext(o),snappingManager:n._snappingManager,cancel:a,updatingHandles:n.updatingHandles}),n._snappingPipeline.next).next((function(t){var n=(0,T.aW)(t.mapEnd,new E.j);e[i]=n})),a.next(s).next((0,O.z)(e,[i]))}));return this._dimensionHandles.add(a,e),r}},{key:"_snappingContext",value:function(e){return new Tt({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new q.S(new q.g("point",(0,q.x)(!0,!1,this.view.spatialReference))),visualizer:new De})}}]),n}(b.d);(0,v.e)([(0,v.d)({constructOnly:!0,nonNullable:!0})],Mt.prototype,"view",void 0),(0,v.e)([(0,v.d)({readOnly:!0})],Mt.prototype,"updating",null),(0,v.e)([(0,v.d)()],Mt.prototype,"stagedDimension",void 0),Mt=(0,v.e)([(0,v.n)("esri.views.3d.analysis.Dimensioning.LengthDimensionSubTool")],Mt),function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(Ct||(Ct={}));var Vt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).preferManipulatorCursor=!0,i.analysisViewData=null,i}return(0,h.Z)(n,[{key:"initialize",value:function(){var e=this;this._intersector=(0,J.g)(this.view.state.viewingMode),this._intersector.options.store=J.w.MIN,this._lengthDimensionSubTool=new Mt({view:this.view}),this.own((0,v.aF)(this._lengthDimensionSubTool));var t,n=(0,l.Z)(this.analysis.dimensions.items);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._addDimension(i)}}catch(r){n.e(r)}finally{n.f()}this.own(this.analysis.dimensions.on("change",(function(t){var n,i=(0,l.Z)(t.added);try{for(i.s();!(n=i.n()).done;){var a=n.value;e._addDimension(a)}}catch(r){i.e(r)}finally{i.f()}var o,s=(0,l.Z)(t.removed);try{for(s.s();!(o=s.n()).done;){var u=o.value;e._removeDimension(u)}}catch(r){s.e(r)}finally{s.f()}}))),this.own((0,_.l)((function(){return e.state}),(function(t){t===Ct.Created&&e.finishToolCreation()}),_.w))}},{key:"state",get:function(){return this.analysis.dimensions.some((function(e){return"length"===e.type}))?(0,g.r)(this._activeSubTool)?Ct.Creating:Ct.Created:Ct.Ready}},{key:"updating",get:function(){return this._lengthDimensionSubTool.updating}},{key:"cursor",get:function(){return this.active?"crosshair":null}},{key:"getManipulatorsForDimension",value:function(e){return this._lengthDimensionSubTool.getManipulatorsForDimension(e)}},{key:"onInputEvent",value:function(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e)}}},{key:"onActivate",value:function(){this._activeSubTool=this._lengthDimensionSubTool}},{key:"onDeactivate",value:function(){(0,g.r)(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),(0,g.r)(this._activeSubTool.stagedDimension)&&(this.analysis.dimensions.remove(this._activeSubTool.stagedDimension),this._activeSubTool.stagedDimension=null),this._activeSubTool=null)}},{key:"_clickHandler",value:function(e){if(!(0,g.t)(this._activeSubTool)){var t=this._intersectScreen(e);if(!(0,g.t)(t)){if((0,g.t)(this._activeSubTool.stagedDimension)){var n=this._activeSubTool.onUnstagedClick({mapPoint:t,pointerType:e.pointerType});this.analysis.dimensions.add(n)}else this._activeSubTool.onStagedClick({mapPoint:t,pointerType:e.pointerType});e.stopPropagation()}}}},{key:"_doubleClickHandler",value:function(e){this.view.activeTool=null,e.stopPropagation()}},{key:"_pointerMoveHandler",value:function(e){if(!(0,g.t)(this._activeSubTool)&&!this.hasFocusedManipulators){var t=this._intersectScreen(e);(0,g.t)(t)||this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}}},{key:"_intersectScreen",value:function(e){var t=(0,K.W)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);var n=this._intersector.results.min,i=w.c.get();return n.getIntersectionPoint(i)?this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference):null}},{key:"_addDimension",value:function(e){this._lengthDimensionSubTool.addDimension(e,this.manipulators)}},{key:"_removeDimension",value:function(e){this._lengthDimensionSubTool.removeDimension(e,this.manipulators)}}]),n}(O.a);(0,v.e)([(0,v.d)({constructOnly:!0})],Vt.prototype,"view",void 0),(0,v.e)([(0,v.d)({constructOnly:!0})],Vt.prototype,"analysis",void 0),(0,v.e)([(0,v.d)({readOnly:!0})],Vt.prototype,"state",null),(0,v.e)([(0,v.d)({readOnly:!0})],Vt.prototype,"updating",null),(0,v.e)([(0,v.d)({readOnly:!0})],Vt.prototype,"cursor",null),(0,v.e)([(0,v.d)({readOnly:!0})],Vt.prototype,"preferManipulatorCursor",void 0),(0,v.e)([(0,v.d)({constructOnly:!0})],Vt.prototype,"analysisViewData",void 0),(0,v.e)([(0,v.d)()],Vt.prototype,"_activeSubTool",void 0),(0,v.e)([(0,v.d)()],Vt.prototype,"_lengthDimensionSubTool",void 0),Vt=(0,v.e)([(0,v.n)("esri.views.3d.analysis.Dimensioning.DimensioningTool")],Vt);var Ht=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;(0,d.Z)(this,n),(i=t.call(this,e))._directSegment=new j.l,i._dimensionSegment=new j.l,i._offsetAxis=(0,C.n)(),i._startOffsetSegment=new j.l(i._directSegment.startRenderSpace,i._dimensionSegment.startRenderSpace),i._endOffsetSegment=new j.l(i._directSegment.endRenderSpace,i._dimensionSegment.endRenderSpace),i._labelSegment=new j.l,i._hasValidGeometry=!1;var r={view:e.view,attached:!0,width:1,color:(0,$.r)(1,.5,0,1),renderOccluded:z.a9.OccludeAndTransparent},a=(0,o.Z)((0,o.Z)({},r),{},{stipplePattern:(0,T.aQ)(5)});return i._dimensionVisualElement=new m.C(r),i._startOffsetVisualElement=new m.C(a),i._endOffsetVisualElement=new m.C(a),i._label=new j.v({view:e.view,attached:!0,distance:0,fontSize:ue.labels.fontSize}),i}return(0,h.Z)(n,[{key:"initialize",value:function(){var e=this;this.own([(0,v.aF)(this._dimensionVisualElement),(0,v.aF)(this._startOffsetVisualElement),(0,v.aF)(this._endOffsetVisualElement),(0,v.aF)(this._label)]);var t=this.computation,n=this.view,i=t.dimension;this.own([(0,_.l)((function(){return{startPoint:i.startPoint,endPoint:i.endPoint,offset:i.offset,axis:i.axis,heading:i.heading}}),(function(t){e._updateGeometry(t),e._updateLines(),e._updateLabelGeometry(n.state.camera)}),_.h),(0,_.l)((function(){return t.length}),(function(t){return e._updateLabelContent(t)}),_.h),(0,_.l)((function(){return n.state.camera}),(function(t){return e._updateLabelGeometry(t)}),_.h)])}},{key:"testInfo",get:function(){return{dimensionVisualElement:this._dimensionVisualElement,label:this._label}}},{key:"_updateGeometry",value:function(e){var t=e.startPoint,n=e.endPoint,r=e.offset,a=e.axis,o=this.view.renderCoordsHelper,s=this._directSegment;if(!(0,g.t)(t)&&!(0,g.t)(n)&&o.toRenderCoords(t,s.startRenderSpace)&&o.toRenderCoords(n,s.endRenderSpace)){var l=s.startRenderSpace,u=s.endRenderSpace,c=s.eval(.5,w.c.get()),d=o.worldUpAtPosition(c,w.c.get()),h=o.worldBasisAtPosition(c,L.n.X,w.c.get()),p=this._offsetAxis;!function(e,t,n,i,r,a){switch(r){case"horizontal":return(0,C.a)(e,i);case"vertical":return(0,C.P)(t,i)<(0,C.P)(n,i)?(0,C.a1)(e,n,t):(0,C.a1)(e,t,n),(0,C._)(e,e,i),(0,C.a0)(e,C.a5)?(0,C.a)(e,a):((0,C._)(e,e,i),(0,C.z)(e,e),e);case"direct":(0,C.P)(t,a)>(0,C.P)(n,a)?(0,C.a1)(e,n,t):(0,C.a1)(e,t,n),(0,C._)(e,e,i),(0,C.a0)(e,C.a5)?(0,C.a)(e,a):(0,C.z)(e,e)}}(p,l,u,d,a,h);var f=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=(0,C.P)(t,n),a=(0,C.P)(e,n),o=Math.abs(r-a)+i;return r>a?[o,i]:[i,o]}(l,u,p,r/o.unitInMeters),v=(0,i.Z)(f,2),y=v[0],_=v[1],m=this._dimensionSegment;(0,C.aa)(m.startRenderSpace,s.startRenderSpace,p,y),(0,C.aa)(m.endRenderSpace,s.endRenderSpace,p,_),this._hasValidGeometry=!0}else this._hasValidGeometry=!1}},{key:"_updateLines",value:function(){if(!this._hasValidGeometry)return this._dimensionVisualElement.visible=!1,this._startOffsetVisualElement.visible=!1,void(this._endOffsetVisualElement.visible=!1);this._dimensionVisualElement.setGeometryFromSegment(this._dimensionSegment),this._startOffsetVisualElement.setGeometryFromSegment(this._startOffsetSegment),this._endOffsetVisualElement.setGeometryFromSegment(this._endOffsetSegment),this._dimensionVisualElement.visible=!0,this._startOffsetVisualElement.visible=!0,this._endOffsetVisualElement.visible=!0}},{key:"_updateLabelContent",value:function(e){if((0,g.t)(e)||!this._hasValidGeometry)return this._label.text="",void(this._label.visible=!1);var t=(0,j.b)(e,"meters").value;this._label.text="".concat((0,ee.m)(t,{minimumFractionDigits:2,maximumFractionDigits:2})," m"),this._label.visible=!0}},{key:"_updateLabelGeometry",value:function(e){if(this._hasValidGeometry){var t=this.computation.dimension.offset,n=e.computeRenderPixelSizeAt(this._dimensionSegment.eval(.5,w.c.get())),i=(Math.sign(t)>=0?1:-1)*ue.labels.offset*n;(function(e,t,n,i){(0,C.aa)(e.startRenderSpace,t.startRenderSpace,n,i),(0,C.aa)(e.endRenderSpace,t.endRenderSpace,n,i)})(this._labelSegment,this._dimensionSegment,this._offsetAxis,i),this._label.geometry={type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1}}else this._label.visible=!1}}]),n}(v.y);(0,v.e)([(0,v.d)({constructOnly:!0,nonNullable:!0})],Ht.prototype,"computation",void 0),(0,v.e)([(0,v.d)({constructOnly:!0,nonNullable:!0})],Ht.prototype,"view",void 0),Ht=(0,v.e)([(0,v.n)("esri.views.3d.analysis.Dimensioning.LengthDimensionVisualization")],Ht);var Lt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e))._dimensionVisualizations=new Map,i}return(0,h.Z)(n,[{key:"initialize",value:function(){var e,t=this,n=(0,l.Z)(this.computations);try{for(n.s();!(e=n.n()).done;){var i=e.value;this._addComputation(i)}}catch(r){n.e(r)}finally{n.f()}this.own(this.computations.on("change",(function(e){var n,i=e.added,a=e.removed,o=(0,l.Z)(a);try{for(o.s();!(n=o.n()).done;){var s=n.value;t._removeComputation(s)}}catch(r){o.e(r)}finally{o.f()}var u,c=(0,l.Z)(i);try{for(c.s();!(u=c.n()).done;){var d=u.value;t._addComputation(d)}}catch(r){c.e(r)}finally{c.f()}})))}},{key:"destroy",value:function(){this._dimensionVisualizations.forEach((function(e){e.destroy()})),this._dimensionVisualizations.clear()}},{key:"testInfo",get:function(){return{visualizations:Array.from(this._dimensionVisualizations.values())}}},{key:"_addComputation",value:function(e){this._dimensionVisualizations.has(e)||this._dimensionVisualizations.set(e,new Ht({computation:e,view:this.view}))}},{key:"_removeComputation",value:function(e){var t=this._dimensionVisualizations.get(e);(0,g.t)(t)||(t.destroy(),this._dimensionVisualizations.delete(e))}}]),n}(v.y);(0,v.e)([(0,v.d)({constructOnly:!0,nonNullable:!0})],Lt.prototype,"view",void 0),(0,v.e)([(0,v.d)({constructOnly:!0,nonNullable:!0})],Lt.prototype,"computations",void 0),Lt=(0,v.e)([(0,v.n)("esri.views.3d.analysis.Dimensioning.DimensioningVisualization")],Lt);var It=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).dimension=null,i}return(0,h.Z)(n)}(v.y);(0,v.e)([(0,v.d)({constructOnly:!0,nonNullable:!0})],It.prototype,"dimension",void 0);var zt=It=(0,v.e)([(0,v.n)("esri.views.3d.analysis.LengthDimensionResult")],It);function Dt(e,t){var n=e.spatialReference;return(0,E.E)(n,t.spatialReference)?(Nt[0]=e.x,Nt[1]=e.y,Nt[2]=e.hasZ?e.z:0,At[0]=t.x,At[1]=t.y,At[2]=t.hasZ?t.z:0,function(e,t,n){var i=function(e,t,n,i){var r=function(e){var t=(0,te.O)(e),n=t===te.G?te.R:t;return(0,ne.A)(e,n)?n:e}(n),a=(0,te.e)(r);if((0,g.t)(a))return null;var o=t[2]-e[2];if("vertical"===i)return{verticalSigned:o,unit:a};if(!(0,ne.B)(e,n,Ft,r)||!(0,ne.B)(t,n,jt,r))return null;if("direct"===i)return{direct:(0,C.x)(jt,Ft),unit:a};if((0,C.f)(Gt,e[0],e[1],t[2]),!(0,ne.B)(Gt,n,Gt,r))return null;var s=(0,C.x)(Gt,jt);return"horizontal"===i?{horizontal:s,unit:a}:{direct:(0,C.x)(jt,Ft),horizontal:s,vertical:Math.abs(o),unit:a}}(e,t,n);return(0,g.r)(i)?{direct:(0,j.o)(i.direct,i.unit),horizontal:(0,j.o)(i.horizontal,i.unit),vertical:(0,j.o)(i.vertical,i.unit)}:null}(Nt,At,n)):null}var Nt=(0,C.n)(),At=(0,C.n)(),Ft=(0,C.n)(),jt=(0,C.n)(),Gt=(0,C.n)(),qt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,d.Z)(this,n),t.call(this,e)}return(0,h.Z)(n,[{key:"initialize",value:function(){this._set("result",new zt({dimension:this.dimension}))}},{key:"length",get:function(){var e=this.dimension,t=e.startPoint,n=e.endPoint,i=e.axis;if((0,g.t)(t)||(0,g.t)(n))return null;var r=Dt(t,n);return(0,g.t)(r)?null:r[i]}}]),n}(v.y);(0,v.e)([(0,v.d)({constructOnly:!0,nonNullable:!0})],qt.prototype,"dimension",void 0),(0,v.e)([(0,v.d)({constructOnly:!0,nonNullable:!0})],qt.prototype,"result",void 0),(0,v.e)([(0,v.d)()],qt.prototype,"length",null),qt=(0,v.e)([(0,v.n)("esri.views.3d.analysis.LengthDimensionComputation")],qt);var Wt=function(e){(0,p.Z)(n,e);var t=(0,f.Z)(n);function n(e){var i;return(0,d.Z)(this,n),(i=t.call(this,e)).type="dimensioning-view-3d",i.tool=null,i._computations=new y.j,i._dimensionsToResults=new Map,i._placementTask=null,i}return(0,h.Z)(n,[{key:"initialize",value:function(){var e=this;this.own([(0,O.c)(this,Vt),(0,_.a)((function(){return e.analysis.dimensions}),"change",(function(t){var n,i=t.added,r=t.removed,a=(0,l.Z)(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;e._removeDimension(o)}}catch(d){a.e(d)}finally{a.f()}var s,u=(0,l.Z)(i);try{for(u.s();!(s=u.n()).done;){var c=s.value;e._addDimension(c)}}catch(d){u.e(d)}finally{u.f()}}),{onListenerAdd:function(t){var n,i=(0,l.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._addDimension(r)}}catch(a){i.e(a)}finally{i.f()}},onListenerRemove:function(t){var n,i=(0,l.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._removeDimension(r)}}catch(a){i.e(a)}finally{i.f()}}})]),this._analysisVisualization=new Lt({view:this.view,computations:this._computations})}},{key:"destroy",value:function(){this._placementTask=(0,g.C)(this._placementTask),this._analysisVisualization=(0,g.l)(this._analysisVisualization),this._computations.drain((function(e){return e.destroy()})),(0,O.m)(this)}},{key:"results",get:function(){var e=this;return this.analysis.dimensions.map((function(t){return e._dimensionsToResults.get(t)}))}},{key:"testInfo",get:function(){return{visualization:this._analysisVisualization}}},{key:"createLengthDimensions",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this._placementTask=(0,g.C)(this._placementTask),this._placementTask=(0,O.s)(this,Vt,t),this._placementTask.promise));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_addDimension",value:function(e){var t=this._dimensionsToResults;if(!t.has(e)){var n=this._computations,i=new qt({dimension:e});n.add(i),t.set(e,i.result)}}},{key:"_removeDimension",value:function(e){var t=this._computations,n=this._dimensionsToResults,i=t.findIndex((function(t){return t.dimension===e})),r=t.removeAt(i);n.delete(e),(0,g.l)(r)}}]),n}((0,m.a)(v.y));(0,v.e)([(0,v.d)({readOnly:!0})],Wt.prototype,"type",void 0),(0,v.e)([(0,v.d)({constructOnly:!0,nonNullable:!0})],Wt.prototype,"analysis",void 0),(0,v.e)([(0,v.d)()],Wt.prototype,"tool",void 0),(0,v.e)([(0,v.d)({readOnly:!0})],Wt.prototype,"results",null),(0,v.e)([(0,v.d)()],Wt.prototype,"_analysisVisualization",void 0),(0,v.e)([(0,v.d)()],Wt.prototype,"_computations",void 0),(0,v.e)([(0,v.d)()],Wt.prototype,"_dimensionsToResults",void 0),(0,v.e)([(0,v.d)()],Wt.prototype,"_placementTask",void 0);var Ut=Wt=(0,v.e)([(0,v.n)("esri.views.3d.analysis.DimensioningAnalysisView3D")],Wt),Yt=Object.freeze({__proto__:null,default:Ut})},28194:function(e,t,n){n.d(t,{j:function(){return w}});var i=n(93433),r=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(77470),u=n(75610),c=n(36551),d=n(61340),h=n(57952),p=n(2760),f=n(90584),v=n(44344),y=n(80584),g=n(91309),_=n(58687),m=n(94867),w=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e))._handles=new l.u,i._quadMaterial=null,i._outlineMaterial=null,i._maxSize=0,i._position=(0,p.n)(),i._up=(0,p.n)(),i._right=(0,p.n)(),i._renderOccluded=g.a9.OccludeAndTransparent,i._color=(0,f.r)(1,0,0,1),i._outlineColor=(0,f.r)(0,0,0,1),i._outlineSize=0,i._size=32,i._outlineRenderOccluded=g.a9.Opaque,i.applyProps(e),i}return(0,a.Z)(n,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,p.B)(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,p.B)(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){var t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function(e){var t=e.previous,n=e.center,i=e.next;this._maxSize=Math.min((0,p.x)(n,t),(0,p.x)(n,i))/3,(0,p.z)(this._up,(0,p.e)(this._up,t,n)),(0,p.z)(this._right,(0,p.e)(this._right,i,n)),(0,p.a)(this._position,n),this.recreateGeometry()}},{key:"createExternalResources",value:function(){var e=this;this._quadMaterial=new _.aZ(this.quadMaterialParameters),this._outlineMaterial=new _.aS(this.outlineMaterialParameters),this._handles.add((0,c.l)((function(){return e.view.state.camera}),(function(){return e._updateTransform()})))}},{key:"destroyExternalResources",value:function(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){e(this._quadMaterial),e(this._outlineMaterial)}},{key:"createGeometries",value:function(e){this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e)}},{key:"_createQuadGeometry",value:function(e){var t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}},{key:"_createOutlineGeometry",value:function(e){if(0!==this._outlineSize){var t=(0,p.u)(v.c.get(),this._up,this._right),n=_.T.createPolylineGeometry([this._up,t,this._right]);e.addGeometry(n,this._outlineMaterial)}}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object,t=this.view.state.camera,n=this._size*t.computeScreenPixelSizeAt(this._position),i=Math.min(this._maxSize,n);(0,d.x)(x,this._position),(0,d.i)(x,x,[i,i,i]),(0,u.r)(e)&&(e.transformation=x)}},{key:"_quadGeometryData",value:function(e,t){var n=(0,p.u)(v.c.get(),e,t);return new g.I([[m.O.POSITION,{size:3,data:[0,0,0].concat((0,i.Z)(t),(0,i.Z)(e),(0,i.Z)(n)),exclusive:!0}]],[[m.O.POSITION,new Uint16Array([0,1,2,1,2,3])]])}},{key:"quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"_updateQuadMaterial",value:function(){this._quadMaterial&&this._quadMaterial.setParameters(this.quadMaterialParameters)}},{key:"outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}},{key:"_updateOutlineMaterial",value:function(){this._outlineMaterial&&this._outlineMaterial.setParameters(this.outlineMaterialParameters)}}]),n}(y.n),x=(0,h.e)()},29009:function(e,t,n){n.d(t,{o:function(){return h},r:function(){return o}});var i=n(75610);function r(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++){var i=e[n],r=t[n];if(i.length!==r.length)return!1;for(var a=0;a<i.length;a++)if(i[a]!==r[a])return!1}return!0}function a(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1;return!0}function o(e,t){return!!c(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function s(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!c(e.spatialReference,t.spatialReference)&&a(e.paths,t.paths)}function l(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!c(e.spatialReference,t.spatialReference)&&a(e.rings,t.rings)}function u(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!c(e.spatialReference,t.spatialReference)&&r(e.points,t.points)}function c(e,t){return e===t||e&&t&&e.equals(t)}function d(e,t){if(e===t)return!0;if((0,i.t)(e)||(0,i.t)(t))return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return o(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!c(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return s(e,t);case"polygon":return l(e,t);case"multipoint":return u(e,t);case"mesh":return!1;default:return}}function h(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!d(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(var r=0,a=n;r<a.length;r++){var o=a[r];if(e[o]!==t[o])return!1}return!0}(e.attributes,t.attributes)}},42860:function(e,t,n){n.d(t,{B:function(){return g},C:function(){return v},z:function(){return y}});var i,r,a=n(1413),o=n(75610),s=n(78880),l=n(2760),u=(n(63022),n(58394)),c=n(55806),d=n(44344),h=(n(18411),n(58687)),p=n(97627),f=n(14432);n(91204),n(47672),n(80262),n(30709);function v(e,t){return function(e,t){var n=(0,l.n)(),i=(0,l.n)(),r=!1;return function(l){var c=t(l);if("start"===l.action){var p=(0,s.d)(l.screenStart,(0,s.l)(d.t.get())),f=(0,h.aY)(e.state.camera,p,_);(0,o.r)(f)&&(r=(0,u.q)(c,f,n))}if(!r)return null;var v=(0,s.d)(l.screenEnd,(0,s.l)(d.t.get())),y=(0,h.aY)(e.state.camera,v,_);return(0,o.t)(y)?null:(0,u.q)(c,y,i)?(0,a.Z)((0,a.Z)({},l),{},{renderStart:n,renderEnd:i,plane:c,ray:y}):null}}(e,(function(){return t}))}function y(e){var t=null;return function(n){switch(n.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,o.r)(t)&&(t.remove(),t=null)}return n}}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=(0,p.g)(e.state.viewingMode);n.options.selectionMode=!0,n.options.store=p.w.MIN,n.options.hud=!1;var r,u=(0,s.i)(),c={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},d=(0,l.n)(),h=(0,o.n)(t,e.spatialReference),v=function(t){e.map.ground&&e.map.ground.opacity<1?c.exclude.add(f.j):c.exclude.delete(f.j),e.sceneIntersectionHelper.intersectIntersectorScreen((0,s.d)(t,u),n,c);var r,a=n.results.min;if(a.getIntersectionPoint(d))r=a.intersector===p.A.TERRAIN?i.GROUND:i.OTHER;else{if(!n.results.ground.getIntersectionPoint(d))return null;r=i.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(d,h),surfaceType:r}};return function(e){if("start"===e.action){var t=v(e.screenStart);r=(0,o.r)(t)?t.location:null}if((0,o.t)(r))return null;var n=v(e.screenEnd);return(0,o.r)(n)&&(0,o.r)(n.location)?(0,a.Z)((0,a.Z)({},e),{},{mapStart:r,mapEnd:n.location,surfaceType:n.surfaceType}):null}}(r=i||(i={}))[r.GROUND=0]="GROUND",r[r.OTHER=1]="OTHER";var _=(0,c.d)()}}]);
//# sourceMappingURL=6292.1d16fe85.chunk.js.map