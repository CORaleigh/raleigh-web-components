"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[6296],{6133:function(e,t,n){n.d(t,{f:function(){return b},l:function(){return h},u:function(){return m}});var i=n(15671),r=n(43144),o=n(60136),a=n(29388),s=n(48848),l=n(62610),u=n(40114),c=n(93661),d=n(18395),v=n(82474),p=n(15529);function y(e,t){return h(e)===h(t)}function h(e){if((0,c.t)(e))return null;var t,n=null!=e.layer?e.layer.id:"";return null==(t=null!=e.objectId?e.objectId:null!=e.layer&&"objectIdField"in e.layer&&null!=e.layer.objectIdField&&null!=e.attributes?e.attributes[e.layer.objectIdField]:e.uid)?null:"o-".concat(n,"-").concat(t)}var f={json:{write:{writer:function(e,t){var n;(0,c.t)(e)||null==(null===(n=e.layer)||void 0===n?void 0:n.objectIdField)||null==e.attributes||(t.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})},target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:function(e){if(null!=e.layerId&&null!=e.objectId)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}}}}};var g=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).position=null,r.elevationInfo=null,r.feature=null,r}return(0,r.Z)(n,[{key:"equals",value:function(e){return(0,c.B)(this.position,e.position)&&(0,c.B)(this.elevationInfo,e.elevationInfo)&&y(this.feature,e.feature)}}]),n}((0,u.u)((0,l.i)(s.m)));(0,s.e)([(0,s.y)({type:v.w}),(0,d.g)()],g.prototype,"position",void 0),(0,s.e)([(0,s.y)({type:p.x}),(0,d.g)()],g.prototype,"elevationInfo",void 0),(0,s.e)([(0,s.y)(f)],g.prototype,"feature",void 0);var m=g=(0,s.e)([(0,s.n)("esri.analysis.LineOfSightAnalysisObserver")],g),_=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).position=null,r.elevationInfo=null,r.feature=null,r}return(0,r.Z)(n,[{key:"equals",value:function(e){return(0,c.B)(this.position,e.position)&&(0,c.B)(this.elevationInfo,e.elevationInfo)&&y(this.feature,e.feature)}}]),n}((0,u.u)(l.l));(0,s.e)([(0,s.y)({type:v.w}),(0,d.g)()],_.prototype,"position",void 0),(0,s.e)([(0,s.y)({type:p.x}),(0,d.g)()],_.prototype,"elevationInfo",void 0),(0,s.e)([(0,s.y)(f)],_.prototype,"feature",void 0);var b=_=(0,s.e)([(0,s.n)("esri.analysis.LineOfSightAnalysisTarget")],_)},56296:function(e,t,n){n.r(t);var i=n(1413),r=n(74165),o=n(15861),a=n(37762),s=n(43144),l=n(15671),u=n(60136),c=n(29388),d=n(48848),v=n(93314),p=n(37856),y=n(93661),h=n(71802),f=n(75016),g=n(89794),m=(n(74384),n(6133)),_=n(59389),b=n(50690),C=n(630),w=n(95249),I=n(25456),O=n(64772),k=n(52638),T=n(77956),P=n(43406),S=n(28390),V=n(25747),L=n(47748),R=n(82474),Z=n(87750),E=n(15529),A=n(82509),H=n(32043),M=n(91386),z=n(49228),D=(n(15751),n(65094),n(79557),n(1797),n(13239),n(27205),n(93122),n(75833),n(57791),n(70381),n(20675),n(26313),n(37077),n(93209),n(46817),n(85026),n(29048),n(33973),n(42233),n(40558),n(70288),n(67430),n(76291),n(43066),n(68136),n(43955),n(95414),n(43345),n(91681),n(75255),n(31698),n(17332),n(94777),n(87424),n(20846),n(10464),n(33795),n(48200),n(4937),n(62610),n(40114),n(18395),n(42667),n(46337),n(47855),n(65415),n(45184),n(56162),n(69641),n(20302),n(15436),n(17455),n(1500),n(64998),n(25577),n(59984),n(53586),n(60369),n(92072),n(37944),n(86086),n(21385),n(85253),n(81556),n(93116),n(42467),n(46737),n(52113),n(61118),n(85113),n(23585),n(82396),n(6189),n(16263),n(3356),n(87440),n(21744),n(24093),n(18936),n(32161),n(37686),n(8141),n(16641),n(21015),n(62642),n(90316),n(19891),n(45999),n(41723),n(4397),n(25217),n(72361),n(90442),n(22159),n(73911),n(35237),n(89181),n(69768),n(52559),n(62466),n(87917),n(2821),n(66577),n(33794),n(71147),n(84186),n(70449),n(22603),n(46018),n(70863),n(62312),n(24648),n(6762),n(95643),n(43976),n(63999),n(5526),n(2473),n(39994),n(69717),n(23341),n(59929),n(2467),n(75257),n(26789),n(64095),n(51732),n(2851),n(70285),n(85700),n(42947),n(98598),n(19941),n(49871),n(63212),n(53409),n(35182),n(51816),n(68781),n(35865),n(51219),n(2959),n(56546),n(39926),n(26151),n(90429),n(95399),n(98987),n(99795),n(87753),n(29130),n(1685),n(12953),n(74797),n(72973),n(62710),n(52721),n(61903),n(23444),n(40811),n(51920),n(63393),n(64854),n(24623),n(64264),n(6379),n(41820),n(20086),n(92982),n(61416),n(77880),n(74494),n(77755),n(71645),n(89311),n(67066),n(39769),n(70607),n(3719),n(70522),n(50253),function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).innerWidth=2,i.outerWidth=8,i.visibleInnerColor=new g.l([3,252,111,1]),i.visibleOuterColor=new g.l([3,252,111,.15]),i.occludedInnerColor=new g.l([252,3,69,1]),i.occludedOuterColor=new g.l([252,3,69,.1]),i.undefinedInnerColor=new g.l([255,255,255,1]),i.undefinedOuterColor=new g.l([127,127,127,.2]),i}return(0,s.Z)(n)}(d.m));(0,d.e)([(0,d.y)({type:Number})],D.prototype,"innerWidth",void 0),(0,d.e)([(0,d.y)({type:Number})],D.prototype,"outerWidth",void 0),(0,d.e)([(0,d.y)({type:g.l})],D.prototype,"visibleInnerColor",void 0),(0,d.e)([(0,d.y)({type:g.l})],D.prototype,"visibleOuterColor",void 0),(0,d.e)([(0,d.y)({type:g.l})],D.prototype,"occludedInnerColor",void 0),(0,d.e)([(0,d.y)({type:g.l})],D.prototype,"occludedOuterColor",void 0),(0,d.e)([(0,d.y)({type:g.l})],D.prototype,"undefinedInnerColor",void 0),(0,d.e)([(0,d.y)({type:g.l})],D.prototype,"undefinedOuterColor",void 0),D=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightConfiguration")],D);var F=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).target=null,i.intersectedGraphic=null,i.intersectedLocation=null,i.elevationAlignedTargetLocation=null,i.visible=void 0,i}return(0,s.Z)(n)}(d.m);(0,d.e)([(0,d.y)()],F.prototype,"target",void 0),(0,d.e)([(0,d.y)()],F.prototype,"intersectedGraphic",void 0),(0,d.e)([(0,d.y)()],F.prototype,"intersectedLocation",void 0),(0,d.e)([(0,d.y)()],F.prototype,"elevationAlignedTargetLocation",void 0),(0,d.e)([(0,d.y)({type:Boolean})],F.prototype,"visible",void 0),F=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSightAnalysisResult")],F);var x,j=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).elevationAlignedTargetLocation=null,i.inputPoints={isValid:!1,observer:(0,h.n)(),observerSurfaceNormal:null,observerFeatureId:null,target:(0,h.n)(),targetSurfaceNormal:null,targetFeatureId:null,observerAdjusted:(0,h.n)(),targetAdjusted:(0,h.n)()},i.computationResult={start:(0,h.n)(),end:(0,h.n)(),intersection:(0,h.n)(),isValid:!1,isTargetVisible:!1},i.result=null,i}return(0,s.Z)(n,[{key:"notifyResultChanged",value:function(){this.notifyChange("computationResult")}},{key:"notifyInputPointsChanged",value:function(){this.notifyChange("inputPoints")}}]),n}(d.m);(0,d.e)([(0,d.y)()],j.prototype,"target",void 0),(0,d.e)([(0,d.y)()],j.prototype,"elevationAlignedTargetLocation",void 0),(0,d.e)([(0,d.y)()],j.prototype,"inputPoints",void 0),(0,d.e)([(0,d.y)()],j.prototype,"computationResult",void 0),(0,d.e)([(0,d.y)()],j.prototype,"result",void 0),j=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightComputation")],j);var N=x=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){return(0,l.Z)(this,n),t.call(this,e)}return(0,s.Z)(n,[{key:"clone",value:function(){return new x({type:this.type,id:(0,y.y)(this.id),mapPoint:(0,y.y)(this.mapPoint),renderPoint:(0,h.t)(this.renderPoint),normal:(0,y.y)(this.normal),ray:(0,y.y)(this.ray),graphic:this.graphic})}},{key:"equals",value:function(e){return this.type===e.type&&this.id===e.id&&(0,y.B)(this.mapPoint,e.mapPoint)&&(0,h.a2)(this.renderPoint,e.renderPoint)&&(0,y.k)(this.normal,e.normal)&&(0,O.j)(this.ray,e.ray)&&this.graphic===e.graphic}}]),n}(d.m);(0,d.e)([(0,d.y)()],N.prototype,"type",void 0),(0,d.e)([(0,d.y)({constructOnly:!0})],N.prototype,"id",void 0),(0,d.e)([(0,d.y)({constructOnly:!0})],N.prototype,"mapPoint",void 0),(0,d.e)([(0,d.y)({constructOnly:!0})],N.prototype,"renderPoint",void 0),(0,d.e)([(0,d.y)({constructOnly:!0})],N.prototype,"normal",void 0),(0,d.e)([(0,d.y)({constructOnly:!0})],N.prototype,"graphic",void 0),(0,d.e)([(0,d.y)({constructOnly:!0})],N.prototype,"ray",void 0),N=x=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],N);var U=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e))._terrainIntersectionOptionsLayerUids=new Set(["terrain"]),i}return(0,s.Z)(n,[{key:"initialize",value:function(){this.intersector=(0,V.g)(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=V.J.MIN}},{key:"getScreenPointIntersection",value:function(e){var t=(0,T.d)(e,O.t.get()),n=(0,S.ak)(this.view.state.camera,t,X);return this._getRayIntersection(n)}},{key:"_getRayIntersection",value:function(e,t){if((0,y.t)(e)||(0,y.t)(this.view.sceneIntersectionHelper))return null;this.intersector.options.store=V.J.MIN,this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,this.intersector,t);var n=this.intersector.results.min,i=(0,h.n)();if(!n.getIntersectionPoint(i))return null;var r=this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference),o=(0,h.t)(n.normal);if((0,S.ar)(n))return new N({type:V.M.OBJECT,id:"".concat(n.target.layerUid,"/").concat(n.target.nodeIndex,"/").concat(n.target.componentIndex),mapPoint:r,renderPoint:i,normal:o,ray:(0,O.k)(e),graphic:null});if((0,S.as)(n))return new N({type:V.M.TERRAIN,id:n.target.lij.slice(),mapPoint:r,renderPoint:i,normal:o,ray:(0,O.k)(e),graphic:null});var a=(0,S.at)(n,this.view);if((0,y.r)(a)){var s,l=a.layer,u=a.sourceLayer;return s=u&&"scene"===u.type?(0,P.O)(a,u.objectIdField):a.uid,new N({type:V.M.OBJECT,id:"".concat(l.uid,"/").concat(s),mapPoint:r,renderPoint:i,normal:o,ray:(0,O.k)(e),graphic:a})}return null}},{key:"updateFromGroundIntersection",value:function(e,t,n){var i=G,r=B,o=W,a=J;(0,h.r)(r,e),this.view.renderCoordsHelper.worldUpAtPosition(r,o),(0,h.z)(o,o);var s=this.view.basemapTerrain.visibleElevationBounds,l=s?Math.abs(s.max-s.min):100,u=t>=0?1:-1;(0,h.g)(a,o,u*(l+Math.abs(t))),(0,h.u)(i,r,a),(0,O.h)(i,r,X);var c=this._getRayIntersection(X,{include:this._terrainIntersectionOptionsLayerUids});return(0,y.r)(c)?((0,h.g)(a,o,u*t),(0,h.u)(n,c.renderPoint,a),(0,h.t)(c.normal)):((0,h.r)(n,e),null)}}]),n}(d.m);(0,d.e)([(0,d.y)()],U.prototype,"view",void 0),(0,d.e)([(0,d.y)()],U.prototype,"intersector",void 0),U=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],U);var G=(0,h.n)(),B=(0,h.n)(),W=(0,h.n)(),J=(0,h.n)(),X=(0,O.d)(),q="esri.views.3d.analysis.LineOfSight.LineOfSightController",K=d.a.getLogger(q),Q=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).updateOnCameraChange=!0,i._effectiveObserverElevationMode="absolute-height",i._observerFeatureId=null,i._updatingHandles=new C.c,i._frameTask=L.y,i._handles=new d.X,i._computationHandles=new d.X,i._externalObserverUpdate=!0,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e,t=null===(e=this.view.resourceController)||void 0===e?void 0:e.scheduler;this._frameTask=t?t.registerTask(L.I.LINE_OF_SIGHT_TOOL):L.y,this._intersector=new U({view:this.view}),this._handles.add([this._connectObserver(),this._connectComputations(),this._connectTargets()])}},{key:"destroy",value:function(){this._handles.destroy(),this._computationHandles.destroy(),this._computations.removeAll(),this._updatingHandles.destroy()}},{key:"updating",get:function(){return this._frameTask.updating||this._updatingHandles.updating}},{key:"priority",get:function(){return this._frameTask.priority},set:function(e){this._frameTask.priority=e}},{key:"_computations",get:function(){return this.analysisViewData.computations}},{key:"_elevationAlignedObserverPositionRenderSpace",get:function(){return this.analysisViewData.observerEngineLocation},set:function(e){this.analysisViewData.observerEngineLocation=e}},{key:"_screenPixelSize",get:function(){return this.view.state.camera.computeScreenPixelSizeAt(this._elevationAlignedObserverPositionRenderSpace)}},{key:"_computeResult",value:function(e){var t=e.computation,n=t.inputPoints,i=t.computationResult,r=n.observerAdjusted,o=n.targetAdjusted,a=i.start,s=i.end;(0,h.r)(a,r),(0,h.r)(s,o),this._canCompute(t)?this._computeIntersection(e):this._interpolateIntersection(e),t.notifyResultChanged(),this.emit("result-changed",{target:e.computation.target,result:t.result})}},{key:"_updateAdjustedPointsFromFeatures",value:function(e){var t=this.view,n=t.sceneIntersectionHelper,i=e.inputPoints,r=i.observerAdjusted,o=i.observerFeatureId,s=i.targetFeatureId,l=i.targetAdjusted;if(!(0,y.t)(o)||!(0,y.t)(s)){var u=(0,h.x)(r,l),c=this._intersector.intersector,d=(0,O.h)(i.observer,i.target,ee);c.options.store=V.J.ALL,n.intersectToolIntersectorRay(d,c);var v,p=null,f=null,g=null,_=null,b=(0,a.Z)(c.results.all);try{for(b.s();!(v=b.n()).done;){var C=v.value,w=(0,S.at)(C,this.view);if(!(0,y.t)(w)&&!(0,y.t)(C.distanceInRenderSpace)){var I=(0,m.l)(w);(0,y.t)(I)||((0,y.r)(o)&&I===o&&((0,y.t)(p)&&(p=this._getFeatureDistanceThreshold(C,t,u)),C.distanceInRenderSpace<p&&(g=C)),(0,y.r)(s)&&I===s&&((0,y.t)(f)&&(f=this._getFeatureDistanceThreshold(C,t,u)),(0,y.t)(_)&&C.distanceInRenderSpace<u&&u-C.distanceInRenderSpace<f&&(_=C)))}}}catch(k){b.e(k)}finally{b.f()}(0,y.r)(g)&&g.getIntersectionPoint(r)&&(i.observerSurfaceNormal=g.getTransformedNormal((0,h.n)())),(0,y.r)(_)&&_.getIntersectionPoint(l)&&(i.targetSurfaceNormal=_.getTransformedNormal((0,h.n)()))}}},{key:"_getFeatureDistanceThreshold",value:function(e,t,n){if((0,S.au)(e)){var i=(0,S.av)(e,t);if((0,y.r)(i))return Math.min(i*ne,n)}return 1e-5*n}},{key:"_adjustStartEndPositions",value:function(e){var t=this._screenPixelSize,n=this.view,i=e.inputPoints,r=i.observer,o=i.observerSurfaceNormal,a=i.target,s=i.targetSurfaceNormal,l=i.observerAdjusted,u=i.targetAdjusted,c=$;(0,h.r)(l,r),(0,h.r)(u,a),this._updateAdjustedPointsFromFeatures(e),(0,y.r)(o)?(0,h.r)(c,o):(0,h.e)(c,u,l);var d=t;(0,h.z)(c,c),(0,h.g)(c,c,Math.min(d,1)),(0,h.u)(l,l,c),(0,y.r)(s)?(0,h.r)(c,s):(0,h.e)(c,l,u);var v=n.state.camera.computeScreenPixelSizeAt(u);(0,h.z)(c,c),(0,h.g)(c,c,Math.min(v,1)),(0,h.u)(u,u,c)}},{key:"_computeIntersection",value:function(e){var t=e.computation,n=e.interpolationInfo,i=this.view,r=i.sceneIntersectionHelper,o=i.renderCoordsHelper;if(!(0,y.t)(r)){var a=this._intersector.intersector,s=t.computationResult,l=t.inputPoints,u=l.observer,c=l.target,d=s.start,v=s.end,p=(0,O.h)(d,v,ee);a.options.store=V.J.MIN,r.intersectToolIntersectorRay(p,a);var f=a.results.min,g=s.intersection,m=$,_=!0;if((0,y.r)(f)&&f.getIntersectionPoint(g)){(0,h.r)(n.originalIntersection,g),(0,h.r)(n.originalObserver,d),(0,h.r)(n.originalTarget,v),o.fromRenderCoords(g,m,i.spatialReference);var b=1-(0,h.U)(v,c)/(0,h.U)(d,c);_=(0,h.U)(u,g)>=b*(0,h.U)(u,c)}var C=new R.w(m,i.spatialReference),w=t.result,I=t.target;(0,y.r)(w)?(w.target=I,w.intersectedGraphic=_?null:(0,S.at)(f,i),w.intersectedLocation=_?null:C,w.visible=_):t.result=new F({target:I,elevationAlignedTargetLocation:t.elevationAlignedTargetLocation,intersectedGraphic:_?null:(0,S.at)(f,i),intersectedLocation:_?null:C,visible:_}),s.isValid=l.isValid=!0,s.isTargetVisible=_}}},{key:"_interpolateIntersection",value:function(e){var t=e.computation,n=e.interpolationInfo,i=t.computationResult,r=t.inputPoints,o=i.start,a=i.end,s=i.intersection,l=n.originalIntersection,u=n.originalObserver,c=n.originalTarget;if((0,h.r)(s,l),r.isValid){var d=$,v=(0,h.U)(u,l)/(0,h.U)(u,c);(0,h.a0)(d,o,u),(0,h.g)(d,d,1-v),(0,h.u)(s,s,d),(0,h.a0)(d,a,c),(0,h.g)(d,d,v),(0,h.u)(s,s,d),i.isValid=!0}else t.result=null,i.isValid=!1,i.isTargetVisible=!1}},{key:"_canCompute",value:function(e){var t=this.analysisViewData.elevationAlignedObserver,n=this.view.frustum;if((0,y.t)(t)||(0,y.t)(e.elevationAlignedTargetLocation)||(0,y.t)(n))return!1;var i=e.inputPoints,r=i.observerAdjusted,o=i.targetAdjusted,a=n.intersectsPoint(r),s=n.intersectsPoint(o);return a&&s}},{key:"_onObserverPositionChange",value:function(e,t,n,i,r){if(this._externalObserverUpdate=r,(0,y.t)(e))return this.analysisViewData.elevationAlignedObserver=null,void(this._observerFeatureId=null);if((0,y.t)(t))return(0,f.a)(this.analysis,e.spatialReference,K),void(this.analysisViewData.elevationAlignedObserver=null);var o=this._getEffectiveElevationInfo(t,n),a=(0,k.b)(t.x,t.y,t.z,this.view.spatialReference,this.view,o),s=a.absoluteZ,l=a.elevation,u=t.clone();u.z=s,this._effectiveObserverElevationMode=o.mode,this.analysisViewData.elevationAlignedObserver=u;var c=(0,h.n)();this.view.renderCoordsHelper.toRenderCoords(u,c),this._elevationAlignedObserverPositionRenderSpace=c,this._observerGroundOffsetRenderSpace=s-l,this._observerFeatureId=(0,m.l)(i),this.priority=L.I.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_onObserverRenderSpacePositionChangeForComputation",value:function(e,t,n,i,r){var o=e.inputPoints;switch((0,h.r)(o.observer,t),o.observerFeatureId=r,o.observerSurfaceNormal=null,i){case"on-the-ground":case"relative-to-ground":var a=this._intersector.updateFromGroundIntersection(o.observer,n,o.observer);(0,y.t)(o.observerFeatureId)&&(o.observerSurfaceNormal=a)}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=L.I.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_onTargetPositionChange",value:function(e,t,n,i,r){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=e.inputPoints;if(o&&(a.isValid=!1),(0,y.t)(n))return(0,y.r)(t)&&(0,f.a)(this.analysis,t.spatialReference,K),e.elevationAlignedTargetLocation=null,void e.notifyInputPointsChanged();var s=this._getEffectiveElevationInfo(n,i),l=(0,k.b)(n.x,n.y,n.z,this.view.spatialReference,this.view,s),u=l.absoluteZ,c=l.elevation,d=n.clone();switch(d.z=u,e.elevationAlignedTargetLocation=d,this.view.renderCoordsHelper.toRenderCoords(e.elevationAlignedTargetLocation,a.target),a.targetFeatureId=(0,m.l)(r),a.targetSurfaceNormal=null,s.mode){case"on-the-ground":case"relative-to-ground":var v=this._intersector.updateFromGroundIntersection(a.target,u-c,a.target);(0,y.t)(a.targetFeatureId)&&(a.targetSurfaceNormal=v)}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=L.I.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_connectComputationToTarget",value:function(e){var t=this;return(0,d.F)([this._updatingHandles.add((function(){return{computation:e,targetPosition:e.target.position,targetElevationInfo:e.target.elevationInfo,targetFeatureInfo:e.target.feature,projectedTargetPosition:(0,w.u)(e.target.position,t.view.spatialReference)}}),(function(e){var n=e.computation,i=e.targetPosition,r=e.targetElevationInfo,o=e.targetFeatureInfo,a=e.projectedTargetPosition;(0,y.r)(a.pending)?t._updatingHandles.addPromise(a.pending):t._onTargetPositionChange(n,i,a.geometry,r,o)}),b.h)])}},{key:"_connectComputationToObserver",value:function(e){var t=this;return this._updatingHandles.add((function(){return{computation:e,observer:t.analysisViewData.elevationAlignedObserver}}),(function(e){var n=e.computation;t._externalObserverUpdate&&(n.inputPoints.isValid=!1,n.notifyInputPointsChanged())}),b.h)}},{key:"_connectComputationToRenderSpaceObserver",value:function(e){var t=this;return this._updatingHandles.add((function(){return{computation:e,observer:t._elevationAlignedObserverPositionRenderSpace,observerGroundOffset:t._observerGroundOffsetRenderSpace,observerElevationMode:t._effectiveObserverElevationMode,observerFeatureId:t._observerFeatureId}}),(function(e){var n=e.computation,i=e.observer,r=e.observerGroundOffset,o=e.observerElevationMode,a=e.observerFeatureId;t._onObserverRenderSpacePositionChangeForComputation(n,i,r,o,a)}),b.h)}},{key:"_connectComputationToCamera",value:function(e){var t=this;return this._updatingHandles.add((function(){return{camera:t.view.state.camera,isDirty:t._isCameraDirty}}),(function(n){var i=n.isDirty;!t.updateOnCameraChange||e.inputPoints.isValid&&!i||e.notifyInputPointsChanged()}))}},{key:"_connectComputationToSlicePlane",value:function(e){var t=this;return this._updatingHandles.add((function(){return t.view.slicePlane}),(function(){e.inputPoints.isValid=!1,e.notifyInputPointsChanged()}))}},{key:"_connectComputationToElevation",value:function(e){var t=this,n=function n(i,r){var o=t.analysis.observer,a=e.target,s=null,l=null,u=null,c=null,d=null,v=null;if((0,y.r)(o)&&(0,y.r)(o.position)){var p=(0,w.u)(o.position,t.view.spatialReference);if((0,y.r)(p.pending))return t._updatingHandles.addPromise(p.pending),void p.pending.finally((function(){return n(i,r)}));s=p.geometry,l=o.elevationInfo,u=o.feature}if((0,y.r)(a.position)){var h=(0,w.u)(a.position,t.view.spatialReference);if((0,y.r)(h.pending))return t._updatingHandles.addPromise(h.pending),void h.pending.finally((function(){return n(i,r)}));c=h.geometry,d=a.elevationInfo,v=a.feature}(0,y.t)(s)&&(0,y.t)(c)||((0,w.v)(i,r,te,t.view.spatialReference),(0,y.r)(s)&&(0,I.F)(te,s)&&t._onObserverPositionChange((0,y.r)(o)?o.position:null,s,l,u,!1),(0,y.r)(c)&&(0,I.F)(te,c)&&t._onTargetPositionChange(e,a.position,c,d,v,!1),(0,y.r)(s)&&(0,y.r)(c)&&(0,I.j)(te,s,c)&&e.notifyInputPointsChanged())};return this.view.elevationProvider.on("elevation-change",(function(e){return n(e.extent,e.spatialReference)}))}},{key:"_connectComputationToTask",value:function(e){var t=this,n=y.L,i={computation:e,interpolationInfo:{originalIntersection:(0,h.n)(),originalObserver:(0,h.n)(),originalTarget:(0,h.n)()}};return(0,d.F)([this._updatingHandles.add((function(){return e.inputPoints}),(function(){n=(0,y.l)(n),n=(0,_.j)(function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.a2)(t._frameTask.schedule((function(){return t._computeResult(i)}),n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),{initial:!0,equals:function(){return!1}}),(0,d.D)((function(){return n=(0,y.l)(n)}))])}},{key:"_connectComputation",value:function(e){var t=this._computationHandles;t.has(e)||t.add([this._connectComputationToTarget(e),this._connectComputationToObserver(e),this._connectComputationToRenderSpaceObserver(e),this._connectComputationToCamera(e),this._connectComputationToSlicePlane(e),this._connectComputationToElevation(e),this._connectComputationToTask(e)],e)}},{key:"_disconnectComputation",value:function(e){this._computationHandles.remove(e)}},{key:"_onComputationCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,a.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(c){r.e(c)}finally{r.f()}var s,l=(0,a.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._connectComputation(u)}}catch(c){l.e(c)}finally{l.f()}}},{key:"_onTargetCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,a.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._removeTarget(o)}}catch(c){r.e(c)}finally{r.f()}var s,l=(0,a.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._addTarget(u)}}catch(c){l.e(c)}finally{l.f()}}},{key:"_onCursorTargetChange",value:function(e,t){(0,y.r)(t)&&this._removeTarget(t),(0,y.r)(e)&&this._addTarget(e)}},{key:"_addTarget",value:function(e){this._computations.some((function(t){return t.target===e}))||this._computations.add(new j({target:e}))}},{key:"_removeTarget",value:function(e){var t=this._computations.findIndex((function(t){return t.target===e}));this._computations.removeAt(t)}},{key:"_connectObserver",value:function(){var e=this;return(0,d.F)([this._updatingHandles.add((function(){return{observerPosition:(0,y.r)(e.analysis.observer)?e.analysis.observer.position:null,projectedObserverPosition:(0,w.u)((0,y.r)(e.analysis.observer)?e.analysis.observer.position:null,e.view.spatialReference),observerElevationInfo:(0,y.r)(e.analysis.observer)?e.analysis.observer.elevationInfo:null,observerFeatureInfo:(0,y.r)(e.analysis.observer)?e.analysis.observer.feature:null}}),(function(t){var n=t.observerPosition,i=t.projectedObserverPosition,r=t.observerElevationInfo,o=t.observerFeatureInfo;(0,y.r)(i.pending)?e._updatingHandles.addPromise(i.pending):e._onObserverPositionChange(n,i.geometry,r,o,!0)}),b.h)])}},{key:"_connectComputations",value:function(){var e=this;return this._updatingHandles.addOnCollectionChange((function(){return e._computations}),(function(t){return e._onComputationCollectionChange(t)}),{initial:!0,final:!0})}},{key:"_connectTargets",value:function(){var e=this;return(0,d.F)([this._updatingHandles.addOnCollectionChange((function(){return e.analysis.targets}),(function(t){return e._onTargetCollectionChange(t)}),{initial:!0,final:!0}),this._updatingHandles.add((function(){return e.analysisViewData.cursorTarget}),(function(t,n){e._onCursorTargetChange(t,n)}))])}},{key:"_isCameraDirty",get:function(){var e=this.analysisViewData.elevationAlignedObserver,t=this.view,n=t.renderCoordsHelper;if((0,y.t)(e)||(0,y.t)(n))return!1;var i=$;n.toRenderCoords(e,i);var r=t.state.camera.computeScreenPixelSizeAt(i);return Math.abs((r-this._screenPixelSize)/this._screenPixelSize)>Y}},{key:"_getEffectiveElevationInfo",value:function(e,t){return e.hasZ?(0,y.v)(t,{mode:"absolute-height",offset:0}):{mode:"on-the-ground",offset:0}}}]),n}(p.n.EventedMixin(d.m));(0,d.e)([(0,d.y)({constructOnly:!0})],Q.prototype,"analysis",void 0),(0,d.e)([(0,d.y)({constructOnly:!0})],Q.prototype,"analysisViewData",void 0),(0,d.e)([(0,d.y)({constructOnly:!0})],Q.prototype,"view",void 0),(0,d.e)([(0,d.y)()],Q.prototype,"updating",null),(0,d.e)([(0,d.y)()],Q.prototype,"priority",null),(0,d.e)([(0,d.y)()],Q.prototype,"updateOnCameraChange",void 0),(0,d.e)([(0,d.y)()],Q.prototype,"_computations",null),(0,d.e)([(0,d.y)()],Q.prototype,"_elevationAlignedObserverPositionRenderSpace",null),(0,d.e)([(0,d.y)()],Q.prototype,"_observerGroundOffsetRenderSpace",void 0),(0,d.e)([(0,d.y)()],Q.prototype,"_effectiveObserverElevationMode",void 0),(0,d.e)([(0,d.y)()],Q.prototype,"_observerFeatureId",void 0),(0,d.e)([(0,d.y)()],Q.prototype,"_screenPixelSize",null),(0,d.e)([(0,d.y)({readOnly:!0})],Q.prototype,"_updatingHandles",void 0),(0,d.e)([(0,d.y)()],Q.prototype,"_frameTask",void 0),(0,d.e)([(0,d.y)()],Q.prototype,"_isCameraDirty",null),Q=(0,d.e)([(0,d.n)(q)],Q);var Y=.1,$=(0,h.n)(),ee=(0,O.d)(),te=(0,I.D)(),ne=.05,ie=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).enabled=!0,i.glowColor=new g.l([255,127,0]),i.glowWidth=8,i.innerColor=new g.l([255,255,255]),i.innerWidth=.75,i.globalAlpha=.75,i}return(0,s.Z)(n)}(d.m);(0,d.e)([(0,d.y)({type:Boolean})],ie.prototype,"enabled",void 0),(0,d.e)([(0,d.y)({type:g.l})],ie.prototype,"glowColor",void 0),(0,d.e)([(0,d.y)({type:Number})],ie.prototype,"glowWidth",void 0),(0,d.e)([(0,d.y)({type:g.l})],ie.prototype,"innerColor",void 0),(0,d.e)([(0,d.y)({type:Number})],ie.prototype,"innerWidth",void 0),(0,d.e)([(0,d.y)({type:Number})],ie.prototype,"globalAlpha",void 0),ie=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightLaserLineConfiguration")],ie);var re=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).size=.5,i.color=new g.l([255,127,0,.75]),i}return(0,s.Z)(n)}(d.m);(0,d.e)([(0,d.y)({type:Number})],re.prototype,"size",void 0),(0,d.e)([(0,d.y)({type:g.l})],re.prototype,"color",void 0),re=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightObserverConfiguration")],re);var oe=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).size=.5,i.visibleColor=new g.l([3,252,111,.75]),i.occludedColor=new g.l([252,3,69,.75]),i.undefinedColor=new g.l([127,127,127,.75]),i}return(0,s.Z)(n)}(d.m);(0,d.e)([(0,d.y)({type:Number})],oe.prototype,"size",void 0),(0,d.e)([(0,d.y)({type:g.l})],oe.prototype,"visibleColor",void 0),(0,d.e)([(0,d.y)({type:g.l})],oe.prototype,"occludedColor",void 0),(0,d.e)([(0,d.y)({type:g.l})],oe.prototype,"undefinedColor",void 0),oe=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTargetConfiguration")],oe);var ae=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).innerWidth=2,i.outerWidth=8,i.visibleInnerColor=new g.l([3,252,111,1]),i.visibleOuterColor=new g.l([3,252,111,.15]),i.occludedInnerColor=new g.l([252,3,69,1]),i.occludedOuterColor=new g.l([252,3,69,.1]),i.undefinedInnerColor=new g.l([255,255,255,1]),i.undefinedOuterColor=new g.l([127,127,127,.2]),i}return(0,s.Z)(n)}(d.m);(0,d.e)([(0,d.y)({type:Number})],ae.prototype,"innerWidth",void 0),(0,d.e)([(0,d.y)({type:Number})],ae.prototype,"outerWidth",void 0),(0,d.e)([(0,d.y)({type:g.l})],ae.prototype,"visibleInnerColor",void 0),(0,d.e)([(0,d.y)({type:g.l})],ae.prototype,"visibleOuterColor",void 0),(0,d.e)([(0,d.y)({type:g.l})],ae.prototype,"occludedInnerColor",void 0),(0,d.e)([(0,d.y)({type:g.l})],ae.prototype,"occludedOuterColor",void 0),(0,d.e)([(0,d.y)({type:g.l})],ae.prototype,"undefinedInnerColor",void 0),(0,d.e)([(0,d.y)({type:g.l})],ae.prototype,"undefinedOuterColor",void 0);var se,le,ue=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).laserLine=new ie,i.observer=new re,i.target=new oe,i.lineOfSight=new ae,i}return(0,s.Z)(n)}(d.m);function ce(e,t,n){return{geometry:(0,S.ae)(e,32,32),material:(0,A.A)(g.l.toUnitRGBA(t)),stateMask:n}}function de(e){var t=[];return e.customColor1&&t.push(ce(e.size,e.customColor1,H.a5.Custom1)),e.customColor2&&t.push(ce(e.size,e.customColor2,H.a5.Custom2)),e.customColor3&&t.push(ce(e.size,e.customColor3,H.a5.Custom3)),e.color&&t.push(ce(e.size,e.color)),t}function ve(e,t){var n=de(t),i=new A.i({view:e,renderObjects:n,elevationInfo:{mode:"absolute-height",offset:0}});return function(e,t){var n=null,i=e.events.on("grab-changed",(function(i){(0,y.r)(n)&&(n.remove(),n=null),"start"===i.action?(n=e.disableDisplay(),t&&t(i)):t&&t(i)}))}(i),i}(0,d.e)([(0,d.y)({type:ie})],ue.prototype,"laserLine",void 0),(0,d.e)([(0,d.y)({type:re})],ue.prototype,"observer",void 0),(0,d.e)([(0,d.y)({type:oe})],ue.prototype,"target",void 0),(0,d.e)([(0,d.y)({type:ae})],ue.prototype,"lineOfSight",void 0),ue=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightToolConfiguration")],ue),(le=se||(se={})).Ready="ready",le.Creating="creating",le.Created="created";var pe=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).removeIncompleteOnCancel=!1,i.configuration=new ue,i.analysisViewData=null,i._laserlineVisualElement=null,i._grabbedManipulator=null,i._analysisHandles=new d.X,i._handles=new d.X,i._updatingHandles=new C.c,i._manipulatorHandles=new d.X,i._targetTrackerManipulator=null,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this._intersector=new U({view:this.view}),this._handles.add((0,b.l)((function(){return e.state}),(function(t){t===se.Created&&e.finishToolCreation()}),b.w)),this._observerManipulator=this._createObserverManipulator(),this._handles.add([this._updatingHandles.add((function(){return(0,i.Z)({},e.configuration.observer)}),(function(){return e._updateObserverManipulatorStyle()})),this._updatingHandles.add((function(){return e.analysisViewData.elevationAlignedObserver}),(function(t){return e._onObserverLocationChange(t)}),b.h),this._updatingHandles.add((function(){return(0,i.Z)({},e.configuration.laserLine)}),(function(){return e._createVisualElements()}),b.h),this._updatingHandles.add((function(){return e._laserLineRendererDependencies()}),(function(t){return e._updateLaserLineRenderer(t)})),this._connectComputations(),this._updatingHandles.addWhen((function(){return!e._shouldRenderTracker}),(function(){return e._clearCursorTracker()}),b.h)])}},{key:"destroy",value:function(){this._updatingHandles=(0,y.g)(this._updatingHandles),this._handles=(0,y.g)(this._handles),this._manipulatorHandles=(0,y.g)(this._manipulatorHandles),this._analysisHandles=(0,y.g)(this._analysisHandles),this._observerManipulator=null,this._clearCursorTracker(),this._removeVisualElements(),this._intersector=null,this._set("analysis",null)}},{key:"state",get:function(){return this.active?this.hasGrabbedManipulators?se.Created:se.Creating:(0,y.r)(this.analysis.observer)&&(0,y.r)(this.analysis.observer.position)?se.Created:se.Ready}},{key:"cursor",get:function(){return this.active&&this._showTracker?"crosshair":null}},{key:"updating",get:function(){return(0,y.r)(this.analysisViewData)&&this.analysisViewData.updating||this._updatingHandles.updating}},{key:"_showTracker",get:function(){return this.active&&"mouse"===this._latestPointerMovePointerType}},{key:"_shouldRenderTracker",get:function(){return this._showTracker&&(0,y.r)(this.analysis.observer)&&(0,y.r)(this.analysis.observer.position)&&!this.hasGrabbedManipulators}},{key:"continue",value:function(){this.view.activeTool=this}},{key:"stop",value:function(){this.view.activeTool=null}},{key:"onEditableChange",value:function(){this.analysisViewData.editable=this.internallyEditable}},{key:"onInputEvent",value:function(e){switch(e.type){case"immediate-double-click":this._doubleClickHandler(e);break;case"key-down":this._keyDownHandler(e);break;case"pointer-move":this._pointerMoveHandler(e)}}},{key:"onInputEventAfter",value:function(e){"immediate-click"===e.type&&this._clickHandler(e)}},{key:"onShow",value:function(){}},{key:"onHide",value:function(){}},{key:"onDeactivate",value:function(){this._clearCursorTracker()}},{key:"_connectComputations",value:function(){var e=this;return this._updatingHandles.addOnCollectionChange((function(){return e.analysisViewData.computations}),(function(t){return e._onComputationsCollectionChange(t)}),{initial:!0,final:!0})}},{key:"_onComputationsCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,a.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(c){r.e(c)}finally{r.f()}var s,l=(0,a.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._connectComputation(u)}}catch(c){l.e(c)}finally{l.f()}}},{key:"_connectComputation",value:function(e){var t=this;if(this.destroyed)d.a.getLogger(this.declaredClass).warn("Attempting to connect an analysis to a destroyed LineOfSight tool. Ignoring.");else{var n=this._analysisHandles;if(!n.has(e)){var i=this._createTargetManipulator(e.target);(0,y.t)(this._targetTrackerManipulator)&&i.metadata.target===this.analysisViewData.cursorTarget&&(this._targetTrackerManipulator=i,this._targetTrackerManipulator.available=!1,this._targetTrackerManipulator.interactive=!1,this._updateLaserLineRenderer()),n.add([this._updatingHandles.add((function(){return t._getLineOfSightManipulatorStateDependencies(e)}),(function(){return t._updateManipulatorState(i,e)}),b.h),this._updatingHandles.add((function(){return e.elevationAlignedTargetLocation}),(function(e){return t._onTargetLocationChange(e,i)}),b.h)],e)}}}},{key:"_disconnectComputation",value:function(e){if(this.destroyed)d.a.getLogger(this.declaredClass).warn("Attempting to disconnect an analysis from a destroyed LineOfSight tool. Ignoring.");else{this._analysisHandles.remove(e);var t=this._getTargetManipulator(e.target);(0,y.r)(t)&&(this.manipulators.remove(t),this._manipulatorHandles.remove(t),(0,y.r)(this._targetTrackerManipulator)&&this._targetTrackerManipulator===t&&(this._targetTrackerManipulator=null))}}},{key:"_clearCursorTracker",value:function(){this.analysisViewData.cursorTarget=(0,y.g)(this.analysisViewData.cursorTarget)}},{key:"_createManipulator",value:function(e,t,n){var i=this,r=ve(this.view,e);return r.metadata=n,this._manipulatorHandles.add([t(r),r.events.on("grab-changed",(function(e){return i._manipulatorGrabChanged(r,e)})),r.events.on("immediate-click",(function(e){return i._manipulatorClick(r,e)}))],r),this.manipulators.add(r),r}},{key:"_createTargetManipulator",value:function(e){var t=this,n=this.configuration,i={size:n.target.size,customColor1:n.target.visibleColor,customColor2:n.target.occludedColor,customColor3:n.target.undefinedColor,visible:!0},r={target:e,type:"target"},o=this._createManipulator(i,(function(e){return t._createTargetManipulatorDragPipeline(e)}),r);return(0,y.r)(e.position)?o.elevationAlignedLocation=e.position:o.available=!1,o}},{key:"_getTargetManipulator",value:function(e){var t=null;return this.manipulators.forEach((function(n){var i=n.manipulator;(0,y.t)(t)&&"target"===i.metadata.type&&i.metadata.target===e&&(t=i)})),t}},{key:"_createObserverManipulator",value:function(){var e=this,t=this.configuration,n={size:t.observer.size,color:t.observer.color,visible:!0};return this._createManipulator(n,(function(t){return e._createObserverManipulatorDragPipeline(t)}),{type:"observer",intersection:null})}},{key:"_updateObserverManipulatorStyle",value:function(){var e=this._observerManipulator,t=this.configuration.observer,n={size:t.size,color:t.color,visible:e.available};e.renderObjects=de(n)}},{key:"_screenToIntersection",value:function(){var e=this;return function(t){var n=e._intersector.getScreenPointIntersection(t.screenEnd);return(0,y.t)(n)?null:(0,i.Z)((0,i.Z)({},t),{},{intersection:n})}}},{key:"_createTargetManipulatorDragPipeline",value:function(e){var t=this;return(0,A.d)(e,(function(n,i,r){i.next(t._screenToIntersection()).next(t._updateTargetDragStep(e)).next((function(){return t._updateLaserLineRenderer()})),r.next(t._cancelTargetDragStep(e.metadata.target)).next((function(){return t._updateLaserLineRenderer()}))}))}},{key:"_createObserverManipulatorDragPipeline",value:function(e){var t=this;return(0,A.d)(e,(function(e,n,i){n.next(t._screenToIntersection()).next(t._updateObserverDragStep()).next((function(){return t._updateLaserLineRenderer()})),i.next(t._cancelObserverDragStep()).next((function(){return t._updateLaserLineRenderer()}))}))}},{key:"_updateObserverDragStep",value:function(){var e=this;return function(t){return(0,y.r)(t.intersection.mapPoint)?((0,y.t)(e.analysis.observer)&&(e.analysis.observer=new m.u),e._updateFromIntersection(e.analysis.observer,t.intersection)):e.analysis.observer=null,t}}},{key:"_cancelObserverDragStep",value:function(){var e=this,t=(0,y.r)(this.analysis.observer)&&(0,y.r)(this.analysis.observer.position)?this.analysis.observer.clone():null;return function(n){return e.analysis.observer=t,n}}},{key:"_updateTargetDragStep",value:function(e){var t=this;return function(n){t._updateFromIntersection(e.metadata.target,n.intersection);var i=n.intersection.mapPoint;return(0,y.r)(i)&&(e.elevationAlignedLocation=i),n}}},{key:"_cancelTargetDragStep",value:function(e){var t=(0,y.n)(e.position,(function(e){return e.clone()}));return function(n){return e.position=t,n}}},{key:"_manipulatorGrabChanged",value:function(e,t){switch(t.action){case"start":this._grabbedManipulator=e;break;case"end":this._grabbedManipulator===e&&(this._grabbedManipulator=null)}}},{key:"_updateManipulatorState",value:function(e,t){var n=t.computationResult,i=n.isValid,r=n.isTargetVisible;e.state=i?r?H.a5.Custom1:H.a5.Custom2:H.a5.Custom3}},{key:"_getLineOfSightManipulatorStateDependencies",value:function(e){var t=e.computationResult;return{isValid:t.isValid,isTargetVisible:t.isTargetVisible}}},{key:"_laserLineRendererDependencies",value:function(){return{laserlineVisualElement:this._laserlineVisualElement,grabbedManipulator:this._grabbedManipulator,shouldRenderTracker:this._shouldRenderTracker,observerPosition:(0,y.r)(this.analysis.observer)?this.analysis.observer.position:null,visible:this.visible}}},{key:"_updateLaserLineRenderer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._laserLineRendererDependencies(),t=e.laserlineVisualElement,n=e.grabbedManipulator,i=e.shouldRenderTracker,r=e.observerPosition,o=e.visible;if(!(0,y.t)(t)){var a=(0,y.r)(n)?n:i&&(0,y.r)(r)?this._targetTrackerManipulator:null;this.configuration.laserLine.enabled&&(0,y.r)(a)&&o?(t.visible=!0,t.heightManifoldTarget=a.renderLocation,a!==this._observerManipulator?t.lineVerticalPlaneSegment=(0,Z.b)(this._observerManipulator.renderLocation,a.renderLocation,ye):t.lineVerticalPlaneSegment=null):(t.visible=!1,t.heightManifoldTarget=null,t.lineVerticalPlaneSegment=null)}}},{key:"_createVisualElements",value:function(){var e=this.configuration.laserLine;this._removeVisualElements(),this._laserlineVisualElement=new M.d({view:this.view,attached:!0,visible:this.visible,style:{glowColor:g.l.toUnitRGB(e.glowColor),glowWidth:e.glowWidth,innerColor:g.l.toUnitRGB(e.innerColor),innerWidth:e.innerWidth,globalAlpha:e.globalAlpha}})}},{key:"_removeVisualElements",value:function(){(0,y.r)(this._laserlineVisualElement)&&(this._laserlineVisualElement.destroy(),this._laserlineVisualElement=null)}},{key:"_onObserverLocationChange",value:function(e){(0,y.t)(e)?this._observerManipulator.available=!1:(this._observerManipulator.metadata.intersection=null,this._observerManipulator.available=!0,this._observerManipulator.elevationAlignedLocation=e)}},{key:"_onTargetLocationChange",value:function(e,t){(0,y.r)(e)?(t.elevationAlignedLocation=e,t!==this._targetTrackerManipulator&&(t.available=!0)):t.available=!1}},{key:"_addPointFromClickEvent",value:function(e){var t=this._intersector.getScreenPointIntersection(e);if(!(0,y.t)(t)&&!(0,y.t)(t.mapPoint))if((0,y.r)(this.analysis.observer)&&(0,y.r)(this.analysis.observer.position)){this._clearCursorTracker();var n=new m.f;this._updateFromIntersection(n,t),this.analysis.targets.add(n)}else{var i=new m.u;this._updateFromIntersection(i,t),this.analysis.observer=i}}},{key:"_clickHandler",value:function(e){this.active&&e.button!==H.a8.Right&&(this._addPointFromClickEvent((0,H.a9)(e)),e.stopPropagation())}},{key:"_doubleClickHandler",value:function(e){this.active&&e.button!==H.a8.Right&&(this.stop(),e.stopPropagation())}},{key:"_keyDownHandler",value:function(e){this.active&&"Escape"===e.key&&(this.stop(),e.stopPropagation())}},{key:"_pointerMoveHandler",value:function(e){if(!this.hasGrabbedManipulators&&(this._latestPointerMovePointerType=e.pointerType,this._updateLaserLineRenderer(),this._showTracker&&!(0,y.t)(this.analysis.observer)&&!(0,y.t)(this.analysis.observer.position))){var t=(0,H.a9)(e),n=this._intersector.getScreenPointIntersection(t);(0,y.r)(n)&&(0,y.r)(n.mapPoint)&&((0,y.t)(this.analysisViewData.cursorTarget)&&(this.analysisViewData.cursorTarget=new m.f),this._updateFromIntersection(this.analysisViewData.cursorTarget,n),this._updateLaserLineRenderer())}}},{key:"_updateFromIntersection",value:function(e,t){if((0,y.t)(t.mapPoint))return e.position=null,e.elevationInfo=null,void(e.feature=null);switch(t.type){case V.M.OBJECT:if((0,y.r)(t.graphic)){var n=t.graphic,i=(0,k.f)(n);"on-the-ground"===i.mode&&(i.mode="relative-to-ground",i.offset=0),e.elevationInfo=new E.x(i),e.feature=n}else e.elevationInfo=null,e.feature=null;break;case V.M.TERRAIN:case V.M.I3S:e.elevationInfo=new E.x({mode:"on-the-ground"}),e.feature=null;break;default:e.elevationInfo=null,e.feature=null}var r=t.mapPoint.clone();r.z=(0,k.g)(this.view,r,{mode:"absolute-height",offset:0},e.elevationInfo),e.position=r}},{key:"_manipulatorClick",value:function(e,t){if(!("observer"===e.metadata.type||e.grabbing||e.dragging||t.button!==H.a8.Right||this.analysis.targets.length<=1)){var n=e.metadata.target;this.analysis.targets.remove(n),t.stopPropagation()}}},{key:"testInfo",get:function(){return{laserLineVisualElement:this._laserlineVisualElement}}}]),n}(A.a);(0,d.e)([(0,d.y)({constructOnly:!0})],pe.prototype,"view",void 0),(0,d.e)([(0,d.y)({constructOnly:!0})],pe.prototype,"analysis",void 0),(0,d.e)([(0,d.y)({readOnly:!0})],pe.prototype,"state",null),(0,d.e)([(0,d.y)({readOnly:!0})],pe.prototype,"cursor",null),(0,d.e)([(0,d.y)()],pe.prototype,"removeIncompleteOnCancel",void 0),(0,d.e)([(0,d.y)({readOnly:!0})],pe.prototype,"updating",null),(0,d.e)([(0,d.y)({type:ue})],pe.prototype,"configuration",void 0),(0,d.e)([(0,d.y)({constructOnly:!0})],pe.prototype,"analysisViewData",void 0),(0,d.e)([(0,d.y)({readOnly:!0})],pe.prototype,"_showTracker",null),(0,d.e)([(0,d.y)()],pe.prototype,"_latestPointerMovePointerType",void 0),(0,d.e)([(0,d.y)()],pe.prototype,"_shouldRenderTracker",null),(0,d.e)([(0,d.y)()],pe.prototype,"_laserlineVisualElement",void 0),(0,d.e)([(0,d.y)()],pe.prototype,"_grabbedManipulator",void 0),pe=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool")],pe);var ye=(0,Z.v)(),he=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e))._lineOfSightVisualizations=[],i._computationHandles=new d.X,i._updatingHandles=new C.c,i}return(0,s.Z)(n,[{key:"initialize",value:function(){this.addHandles(this._connectComputations()),this._createObserverVisualization()}},{key:"destroy",value:function(){this._updatingHandles=(0,y.g)(this._updatingHandles),this._computationHandles=(0,y.g)(this._computationHandles),this._observerVisualElement=(0,y.g)(this._observerVisualElement)}},{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"interactiveAndEditable",get:function(){return this.analysisViewData.interactive&&this.analysisViewData.editable}},{key:"testInfo",get:function(){return{visualizations:this._lineOfSightVisualizations}}},{key:"_configuration",get:function(){return this.analysisViewData.configuration}},{key:"_createLineOfSightVisualization",value:function(){var e=this._configuration,t=this.view,n={view:t,attached:!0,width:e.outerWidth,innerWidth:e.innerWidth},r=g.l.toUnitRGBA(e.visibleOuterColor),o=g.l.toUnitRGBA(e.visibleInnerColor),a=g.l.toUnitRGBA(e.occludedOuterColor),s=g.l.toUnitRGBA(e.occludedInnerColor),l=g.l.toUnitRGBA(e.undefinedOuterColor),u=g.l.toUnitRGBA(e.undefinedInnerColor),c={visibleLineVisualElement:new f.c((0,i.Z)((0,i.Z)({},n),{},{color:r,innerColor:o})),occludedLineVisualElement:new f.c((0,i.Z)((0,i.Z)({},n),{},{color:a,innerColor:s})),undefinedLineVisualElement:new f.c((0,i.Z)((0,i.Z)({},n),{},{color:l,innerColor:u})),targetVisualElement:new M.S((0,i.Z)((0,i.Z)({view:t,attached:!0},fe),{},{size:8}))};return this._lineOfSightVisualizations.push(c),c}},{key:"_destroyLineOfSightVisualization",value:function(e){e.visibleLineVisualElement=(0,y.g)(e.visibleLineVisualElement),e.occludedLineVisualElement=(0,y.g)(e.occludedLineVisualElement),e.undefinedLineVisualElement=(0,y.g)(e.undefinedLineVisualElement),e.targetVisualElement=(0,y.g)(e.targetVisualElement),this._lineOfSightVisualizations.splice(this._lineOfSightVisualizations.indexOf(e),1)}},{key:"_updateLineOfSightVisualization",value:function(e,t,n){var i=this._configuration,r=e.computationResult,o=e.inputPoints,a=r.start,s=r.end,l=r.intersection,u=r.isValid,c=r.isTargetVisible,d=o.observer,v=be;v[12]=d[0],v[13]=d[1],v[14]=d[2];var p=(0,h.e)(ge,a,d),f=(0,h.e)(me,s,d),m=(0,h.e)(_e,l,d),_=t.visibleLineVisualElement,b=t.occludedLineVisualElement,C=t.undefinedLineVisualElement,w=t.targetVisualElement,I=(0,y.t)(this.analysisViewData.elevationAlignedObserver)||(0,y.t)(e.elevationAlignedTargetLocation),O=this.visible&&!I;_.visible=O,b.visible=O,C.visible=O,w.visible=O,w.attached=!n.interactiveAndEditable,O&&(_.geometry=null,b.geometry=null,C.geometry=null,w.geometry=e.elevationAlignedTargetLocation,u?c?(_.geometry=[[(0,h.a6)(p),(0,h.a6)(f)]],_.transform=v,_.color=g.l.toUnitRGBA(i.visibleOuterColor),w.color=g.l.toUnitRGBA(i.visibleInnerColor)):(_.geometry=[[(0,h.a6)(p),(0,h.a6)(m)]],_.transform=v,_.color=g.l.toUnitRGBA(i.occludedOuterColor),b.geometry=[[(0,h.a6)(m),(0,h.a6)(f)]],b.transform=v,w.color=g.l.toUnitRGBA(i.occludedInnerColor)):(C.geometry=[[(0,h.a6)(p),(0,h.a6)(f)]],C.transform=v,w.color=g.l.toUnitRGBA(i.undefinedInnerColor)))}},{key:"_getLineOfSightVisualizationDependencies",value:function(e){var t=e.computationResult,n=this._configuration;return{computationResult:t,occludedOuterColor:n.occludedOuterColor,visibleOuterColor:n.visibleOuterColor,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}}},{key:"_connectComputation",value:function(e){var t=this,n=this._computationHandles;if(!n.has(e)){var i=this._createLineOfSightVisualization();n.add([this._updatingHandles.add((function(){return t._getLineOfSightVisualizationDependencies(e)}),(function(n){return t._updateLineOfSightVisualization(e,i,n)}),{initial:!0,equals:function(){return!1}}),(0,d.D)((function(){return t._destroyLineOfSightVisualization(i)}))],e)}}},{key:"_disconnectComputation",value:function(e){this._computationHandles.remove(e)}},{key:"_connectComputations",value:function(){var e=this;return this._updatingHandles.addOnCollectionChange((function(){return e.analysisViewData.computations}),(function(t){return e._onComputationsCollectionChange(t)}),{initial:!0,final:!0})}},{key:"_onComputationsCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,a.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(c){r.e(c)}finally{r.f()}var s,l=(0,a.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._connectComputation(u)}}catch(c){l.e(c)}finally{l.f()}}},{key:"_createObserverVisualization",value:function(){var e=this,t=g.l.toUnitRGBA(this._configuration.visibleInnerColor),n=new M.S((0,i.Z)({view:this.view,attached:!1,color:t},fe));this._observerVisualElement=n,this.addHandles(this._updatingHandles.add((function(){return{observer:e.analysisViewData.elevationAlignedObserver,interactiveAndEditable:e.interactiveAndEditable,visible:e.visible}}),(function(t){var i=t.observer,r=t.interactiveAndEditable,o=t.visible;(0,y.t)(i)||r||!o?n.attached=!1:(n.geometry=i,e._observerVisualElement.attached=!0)}),b.h))}}]),n}(d.m);(0,d.e)([(0,d.y)({constructOnly:!0})],he.prototype,"analysis",void 0),(0,d.e)([(0,d.y)({constructOnly:!0})],he.prototype,"analysisViewData",void 0),(0,d.e)([(0,d.y)({constructOnly:!0})],he.prototype,"view",void 0),(0,d.e)([(0,d.y)({readOnly:!0})],he.prototype,"visible",null),(0,d.e)([(0,d.y)()],he.prototype,"updating",null),(0,d.e)([(0,d.y)()],he.prototype,"interactiveAndEditable",null),(0,d.e)([(0,d.y)()],he.prototype,"testInfo",null),(0,d.e)([(0,d.y)()],he.prototype,"_configuration",null),he=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],he);var fe={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},ge=(0,h.n)(),me=(0,h.n)(),_e=(0,h.n)(),be=(0,z.e)(),Ce=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).type="line-of-sight-view-3d",i.analysis=null,i.tool=null,i.computations=new v.j,i.elevationAlignedObserver=null,i.configuration=new D,i.observerEngineLocation=(0,h.n)(),i.cursorTarget=null,i.editable=!0,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.view,n=this.analysis;this._analysisController=new Q({analysis:n,analysisViewData:this,view:t}),this._analysisVisualization=new he({analysis:n,analysisViewData:this,view:t}),this.addHandles([this._analysisController.on("result-changed",(function(t){t.target!==e.cursorTarget&&e.emit("result-changed",t)})),(0,A.s)(this,pe)])}},{key:"destroy",value:function(){(0,A.m)(this),this._analysisController=(0,y.g)(this._analysisController),this._analysisVisualization=(0,y.g)(this._analysisVisualization)}},{key:"results",get:function(){return this.computations.map((function(e){return e.result}))}},{key:"priority",get:function(){return this._analysisController.priority},set:function(e){this._analysisController.priority=e}},{key:"updating",get:function(){return(0,y.r)(this._analysisController)&&this._analysisController.updating||(0,y.r)(this._analysisVisualization)&&this._analysisVisualization.updating}},{key:"getResultForTarget",value:function(e){var t=this.computations.find((function(t){return t.target===e}));return(0,y.n)(t,(function(e){return e.result}))}},{key:"testInfo",get:function(){return{visualization:this._analysisVisualization,controller:this._analysisController}}}]),n}((0,f.b)(p.n.EventedMixin(d.m)));(0,d.e)([(0,d.y)({readOnly:!0})],Ce.prototype,"type",void 0),(0,d.e)([(0,d.y)({constructOnly:!0,nonNullable:!0})],Ce.prototype,"analysis",void 0),(0,d.e)([(0,d.y)()],Ce.prototype,"tool",void 0),(0,d.e)([(0,d.y)({readOnly:!0})],Ce.prototype,"results",null),(0,d.e)([(0,d.y)()],Ce.prototype,"priority",null),(0,d.e)([(0,d.y)()],Ce.prototype,"computations",void 0),(0,d.e)([(0,d.y)()],Ce.prototype,"elevationAlignedObserver",void 0),(0,d.e)([(0,d.y)()],Ce.prototype,"configuration",void 0),(0,d.e)([(0,d.y)()],Ce.prototype,"observerEngineLocation",void 0),(0,d.e)([(0,d.y)()],Ce.prototype,"cursorTarget",void 0),(0,d.e)([(0,d.y)()],Ce.prototype,"updating",null),(0,d.e)([(0,d.y)()],Ce.prototype,"editable",void 0),(0,d.e)([(0,d.y)()],Ce.prototype,"_analysisController",void 0),(0,d.e)([(0,d.y)()],Ce.prototype,"_analysisVisualization",void 0);var we=Ce=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSightAnalysisView3D")],Ce);t.default=we},52638:function(e,t,n){n.d(t,{E:function(){return h},a:function(){return s},b:function(){return v},f:function(){return l},g:function(){return u},h:function(){return c},i:function(){return a},x:function(){return g},y:function(){return y}});var i=n(93661),r=n(15529);function o(e){return e?h:f}function a(e,t){return function(e,t){return(0,i.t)(t)||!t.mode?o(e).mode:t.mode}(!!(0,i.r)(e)&&e.hasZ,t)}function s(e,t){return function(e,t){return(0,i.r)(t)?t:o(e)}(!!(0,i.r)(e)&&e.hasZ,t)}function l(e){var t=function(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}(e),n=a(e.geometry,t);return{mode:n,offset:(0,i.r)(t)&&"on-the-ground"!==n?(0,i.v)(t.offset,0)*(0,r.r)((0,i.v)(t.unit,"meters")):0}}function u(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return d(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,n,i)}function c(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return d(e,t[0],t[1],t.length>2?t[2]:0,n,i,r)}function d(e,t,n,r,o,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(!(0,i.t)(a)){var l=(0,i.r)(s)?s.mode:"absolute-height";if("on-the-ground"===l)return 0;var u=v(t,n,r,o,e,a),c=u.absoluteZ;return p(c,t,n,r,o,e,s,l)}}function v(e,t,n,r,o,a){var s=(0,i.r)(a.offset)?a.offset:0;switch(a.mode){case"absolute-height":return{absoluteZ:n+s,elevation:0};case"on-the-ground":var l=(0,i.v)(o.elevationProvider.getElevation(e,t,0,r,"ground"),0);return{absoluteZ:l,elevation:l};case"relative-to-ground":var u=(0,i.v)(o.elevationProvider.getElevation(e,t,n,r,"ground"),0);return{absoluteZ:n+u+s,elevation:u};case"relative-to-scene":var c=(0,i.v)(o.elevationProvider.getElevation(e,t,n,r,"scene"),0);return{absoluteZ:n+c+s,elevation:c}}}function p(e,t,n,r,o,a,s,l){var u=(0,i.r)(s)&&(0,i.r)(s.offset)?s.offset:0;switch(l){case"absolute-height":return e-u;case"relative-to-ground":return e-((0,i.v)(a.elevationProvider.getElevation(t,n,r,o,"ground"),0)+u);case"relative-to-scene":return e-((0,i.v)(a.elevationProvider.getElevation(t,n,r,o,"scene"),0)+u)}}function y(e,t){if((0,i.t)(t))return!1;var n=t.mode;return(0,i.r)(n)&&("scene"===e&&"relative-to-scene"===n||"ground"===e&&"absolute-height"!==n)}var h={mode:"absolute-height",offset:0},f={mode:"on-the-ground",offset:null};function g(e,t){return e===t||(0,i.r)(e)&&(0,i.r)(t)&&e.mode===t.mode&&e.offset===t.offset}},96516:function(e,t,n){function i(e){return e&&"getAtOrigin"in e&&"originOf"in e}n.d(t,{i:function(){return i}})},18395:function(e,t,n){n.d(t,{g:function(){return m}});var i=n(74165),r=n(15861),o=n(1413),a=n(37762),s=n(96516),l=n(40558),u=n(42667),c=n(48848),d=n(46337);function v(e){return p[function(e){return e instanceof Blob?e.type:function(e){var t=(0,l.k)(e);return f[t]||y}(e.url)}(e)]||h}var p={},y="text/plain",h=p[y],f={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(var g in f)p[f[g]]=g;function m(e){var t,n=null!==(t=null===e||void 0===e?void 0:e.origins)&&void 0!==t?t:[void 0];return function(t,i){var r,u=function(e,t,n){var i;if("resource"===(null===e||void 0===e?void 0:e.type))return function(e,t,n){var i=(0,c.aE)(t,n);return{type:String,read:function(e,t,n){var r=(0,d.p)(e,t,n);return i.type===String?r:"function"==typeof i.type?new i.type({url:r}):void 0},write:{writer:function(t,r,a,u){if(!u||!u.resources)return"string"==typeof t?void(r[a]=(0,d.m)(t,u)):void(r[a]=t.write({},u));var v=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),p=(0,d.m)(v,(0,o.Z)((0,o.Z)({},u),{},{verifyItemRelativeUrls:u&&u.verifyItemRelativeUrls?{writtenUrls:u.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0}),d.R.NO),y=i.type!==String&&(!(0,s.i)(this)||u&&u.origin&&this.originIdOf(n)>(0,c.z)(u.origin)),h={object:this,propertyName:n,value:t,targetUrl:p,dest:r,targetPropertyName:a,context:u,params:e};u&&u.portalItem&&p&&!(0,l.K)(p)?y?b(h):function(e){var t=e.context,n=e.targetUrl,i=e.dest,r=e.targetPropertyName;t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(n),compress:!1}),i[r]=n)}(h):u&&u.portalItem&&(null==p||null!=(0,d.U)(p)||(0,l.V)(p)||y)?_(h):r[a]=p}}}}(e,t,n);switch(null!==(i=null===e||void 0===e?void 0:e.type)&&void 0!==i?i:"other"){case"other":return{read:!0,write:!0};case"url":return{read:d.x.read,write:d.x.write}}}(e,t,i),v=(0,a.Z)(n);try{for(v.s();!(r=v.n()).done;){var p=r.value,y=(0,c.G)(t,p,i);for(var h in u)y[h]=u[h]}}catch(f){v.e(f)}finally{v.f()}}}function _(e){var t,n,i,r=e.targetUrl,a=e.params,s=e.value,c=e.context,p=e.dest,y=e.targetPropertyName;if(c.portalItem){var h=(0,d.d)(r),f=null!==(t=null===h||void 0===h?void 0:h.filename)&&void 0!==t?t:(0,u.n)(),g=null!==(n=null===a||void 0===a?void 0:a.prefix)&&void 0!==n?n:null===h||void 0===h?void 0:h.prefix,m=w(s,r,c),_=(0,l.G)(g,f),b="".concat(_,".").concat(v(m)),O=c.portalItem.resourceFromPath(b);(0,l.V)(r)&&c.resources&&c.resources.pendingOperations.push(function(e){return I.apply(this,arguments)}(r).then((function(e){O.path="".concat(_,".").concat(v(e)),p[y]=O.itemRelativeUrl})).catch((function(){})));var k=null!==(i=null===a||void 0===a?void 0:a.compress)&&void 0!==i&&i;c.resources&&C((0,o.Z)((0,o.Z)({},e),{},{resource:O,content:m,compress:k,updates:c.resources.toAdd})),p[y]=O.itemRelativeUrl}}function b(e){var t,n=e.context,i=e.targetUrl,r=e.params,a=e.value,s=e.dest,u=e.targetPropertyName;if(n.portalItem){var c=n.portalItem.resourceFromPath(i),d=w(a,i,n),p=v(d),y=(0,l.k)(c.path),h=null!==(t=null===r||void 0===r?void 0:r.compress)&&void 0!==t&&t;p===y?(n.resources&&C((0,o.Z)((0,o.Z)({},e),{},{resource:c,content:d,compress:h,updates:n.resources.toUpdate})),s[u]=i):_(e)}}function C(e){var t=e.object,n=e.propertyName,i=e.updates,r=e.resource,o=e.content,a=e.compress;i.push({resource:r,content:o,compress:a,finish:function(e){!function(e,t,n){"string"==typeof e[t]?e[t]=n.url:e[t].url=n.url}(t,n,e)}})}function w(e,t,n){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(n))],{type:"application/json"})}function I(){return I=(0,r.Z)((0,i.Z)().mark((function e(t){var r,o,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(n,40558)).then((function(e){return e.M}));case 2:return r=e.sent.default,e.next=5,r(t,{responseType:"blob"});case 5:return o=e.sent,a=o.data,e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}}}]);
//# sourceMappingURL=6296.66b442ab.chunk.js.map