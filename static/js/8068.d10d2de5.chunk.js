"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[8068],{37661:function(e,t,r){r.d(t,{a:function(){return c},n:function(){return l},t:function(){return p},u:function(){return h}});var i=r(15671),n=r(43144),a=r(60136),o=r(29388),s=r(48848),u=(r(93661),r(62470)),d=r(22159),l="updating";function c(e){return"updating"===e?null:e}function h(e){return"updating"===e}var p=function(e){var t=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments))._definitionExpressionErrors=0,e._maxDefinitionExpressionErrors=20,e.logError=function(t){e._definitionExpressionErrors<e._maxDefinitionExpressionErrors&&s.a.getLogger(e.declaredClass).error("Error while evaluating definitionExpression: "+t),e._definitionExpressionErrors++,e._definitionExpressionErrors===e._maxDefinitionExpressionErrors&&s.a.getLogger(e.declaredClass).error("Further errors are ignored")},e}return(0,n.Z)(r,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{var e=u.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!e.isStandardized)return s.a.getLogger(this.declaredClass).error("definitionExpression is using non standard function"),null;var t=[],r=e.fieldNames;return(0,d.b)(r,this.i3slayer.fields,{missingFields:t}),t.length>0?(s.a.getLogger(this.declaredClass).error("definitionExpression references unknown fields: ".concat(t.join(", "))),null):(this._definitionExpressionErrors=0,e)}catch(e){return s.a.getLogger(this.declaredClass).error("Failed to parse definitionExpression: "+e),null}}},{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null}},{key:"_evaluateClause",value:function(e,t){try{return e.testFeature(t)}catch(r){return this.logError(r),!1}}},{key:"_addDefinitionExpressionToQuery",value:function(e){if(!this.parsedDefinitionExpression)return e;var t=this.i3slayer.definitionExpression,r=e.clone();return r.where?r.where="(".concat(t,") AND (").concat(r.where,")"):r.where=t,r}}]),r}(e);return(0,s.e)([(0,s.y)()],t.prototype,"i3slayer",void 0),(0,s.e)([(0,s.y)({readOnly:!0})],t.prototype,"parsedDefinitionExpression",null),(0,s.e)([(0,s.y)({readOnly:!0})],t.prototype,"definitionExpressionFields",null),t=(0,s.e)([(0,s.n)("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t)}},58068:function(e,t,r){r.r(t);var i=r(37762),n=r(74165),a=r(93433),o=r(15861),s=r(11752),u=r(61120),d=r(43144),l=r(15671),c=r(60136),h=r(29388),p=r(48848),f=r(64998),g=r(93661),y=r(50690),v=r(71802),_=r(95249),b=r(46817),m=r(65415),x=r(32043),E=r(43406),k=r(28390),w=r(60666),I=r(51920),C=r(35237),D=r(59929),S=r(72770),A=r(41896),F=r(69672),O=r(22159),N=r(37661),Z=r(72936),T=r(32161),L=r(57791),M=r(47748),V=(r(74384),r(82474),r(40114),r(40558),r(25577),r(62610),r(93314),r(37856),r(15751),r(59984),r(20302),r(53586),r(65094),r(60369),r(92072),r(37944),r(86086),r(21385),r(89794),r(48200),r(85253),r(93209),r(25456),r(46337),r(81556),r(93116),r(56162),r(47855),r(79557),r(75255),r(42467),r(46737),r(52113),r(42667),r(61118),r(630),r(98598),r(43955),r(1500),r(19941),r(39994),r(49871),r(63212),r(69717),r(53409),r(35182),r(62466),r(51816),r(68781),r(69641),r(15436),r(35865),r(51219),r(66577),r(95643),r(59389),r(33795),r(43976),r(6762),r(2959),r(2821),r(33794),r(71147),r(84186),r(15529),r(70449),r(22603),r(56546),r(39926),r(8141),r(26151),r(91681),r(90429),r(52559),r(95399),r(89181),r(98987),r(99795),r(87753),r(29130),r(82396),r(1685),r(12953),r(74797),r(45999),r(85113),r(72973),r(62710),r(52721),r(61903),r(23444),r(40811),r(24623),r(64264),r(6379),r(21015),r(23341),r(41820),r(20086),r(92982),r(61416),r(77880),r(74494),r(77755),r(63393),r(90442),r(64854),r(71645),r(89311),r(67066),r(69768),r(39769),r(70607),r(85700),r(3719),r(90316),r(23585),r(70522),r(17332),r(17455),r(26313),r(43066),r(29048),r(68136),r(13239),r(50253),r(27205),r(45184),r(25747),r(37077),r(49228),r(41723),r(64772),r(76291),r(24093),r(6189),r(87750),r(20846),r(67430),r(87424),r(10464),r(16263),r(3356),r(70381),r(20675),r(85026),r(33973),r(42233),r(93122),r(70288),r(95414),r(43345),r(75833),r(31698),r(94777),r(4937),r(87440),r(21744),r(18936),r(4397),r(25217),r(72361),r(87917),r(46018),r(70863),r(62312),r(24648),r(63999),r(1797),r(5526),r(2473),r(2467),r(75257),r(26789),r(64095),r(51732),r(2851),r(70285),r(78697),r(73911),r(66633),r(477),r(22862),r(68882),r(81216),r(62004),r(31303),r(52195),r(35264),r(37686),r(16641),r(62642),r(19891),r(40345),r(96278),r(52638),r(76419),r(25874),r(44581),r(44513),r(90325),r(53921),r(69838),r(2352),r(62470),r(54622),r(73679),r(62753),r(83948),r(94663),r(67477),r(78413),r(26593),r(60491),r(3393),function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(e){return(0,l.Z)(this,r),t.call(this,"SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:function(e){return[e.geometryBuffer]}},e,{hasInitialize:!0})}return(0,d.Z)(r)}(D.h)),R=(0,F.b)(),G=function(e){(0,c.Z)(I,e);var t=(0,h.Z)(I);function I(){var e;return(0,l.Z)(this,I),(e=t.apply(this,arguments)).type="scene-layer-graphics-3d",e._nodesAddedToStage=new Map,e._queryEngine=null,e._memCache=null,e._interactiveEditingSessions=new Map,e.loadedGraphics=new w.s,e.holeFilling="always",e.progressiveLoadFactor=1,e.supportsHeightUnitConversion=!0,e._coordinatesOutsideExtentErrors=0,e._maxCoordinatesOutsideExtentErrors=20,e}return(0,d.Z)(I,[{key:"initialize",value:function(){var e,t,i=this,n=this.layer;this.addResolvingPromise(n.indexInfo),this._i3sOverrides=new w.I({view:this.view,layer:this.layer,memoryController:null===(e=this.view.resourceController)||void 0===e?void 0:e.memoryController}),(0,O.R)(n,this.view.spatialReference,this.view.viewingMode),this._fieldsHelper=new F.c({layerView:this}),this.updatingHandles.add((function(){return n.rangeInfos}),(function(e){return i._rangeInfosChanged(e)}),y.h),this.updatingHandles.add((function(){return n.renderer}),(function(e,t){return i._rendererChange(e,t)})),this.updatingHandles.add((function(){return[i.parsedDefinitionExpression,i._excludeObjectIdsSorted]}),(function(){return i._filterChange()})),this.handles.add((0,y.l)((function(){return T.t.I3S_TREE_SHOW_TILES}),(function(e){if(e&&!i._treeDebugger){var t=i._controller.crsIndex;r.e(6347).then(r.bind(r,6347)).then((function(e){var r=e.I3STreeDebugger;!i._treeDebugger&&T.t.I3S_TREE_SHOW_TILES&&(i._treeDebugger=new r({lv:i,view:i.view,nodeSR:t}))}))}else e||!i._treeDebugger||T.t.I3S_TREE_SHOW_TILES||(i._treeDebugger.destroy(),i._treeDebugger=null)}),y.h)),this._set("processor",new A.F({owner:this,preferredUpdatePolicy:L.i.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,setUidToIdOnAdd:!1,dataExtent:n.fullExtent,updateClippingExtent:function(e){return i._updateClippingExtent(e)}})),null!==(t=this.processor.elevationAlignment)&&void 0!==t&&t.events.on("invalidate-elevation",(function(e){return i._controller.updateElevationChanged(e.extent,e.spatialReference)})),this.supportsHeightUnitConversion&&(this._verticalScale=(0,m.o)("point",n.spatialReference,this.view.spatialReference)),this.addResolvingPromise(this.processor.initializePromise),this._memCache=this.view.resourceController.memoryController.newCache(n.uid),this._controller=new w.t({layerView:this,scaleVisibilityEnabled:!1}),(0,O.S)(this.layer.geometryDefinitions)&&(this._worker=new V((function(e){return i.view.resourceController.schedule(e)}))),this.handles.add(this.layer.on("apply-edits",(function(e){return i.updatingHandles.addPromise(e.result)}))),this.handles.add(this.layer.on("edits",(function(e){return i._handleEdits(e)}))),this.when((function(){i._queryEngine=new A.p({context:{spatialReference:i.view.spatialReference,layer:i.layer,scheduler:i.view.resourceController.scheduler,get featureStore(){return i.processor.featureStore},hasZ:i.hasZ,hasM:i.hasM},priority:M.I.FEATURE_QUERY_ENGINE}),i.updatingHandles.add((function(){return i.maximumNumberOfFeatures}),(function(e){return i._controller.featureTarget=e}),y.h),i.updatingHandles.add((function(){return i.suspended}),(function(e){e&&i._removeAllNodeData()}))}))}},{key:"destroy",value:function(){this._treeDebugger=(0,g.g)(this._treeDebugger),this._i3sOverrides=(0,g.g)(this._i3sOverrides),this._set("processor",(0,g.g)(this.processor)),this._controller=(0,g.g)(this._controller),this._queryEngine=(0,g.g)(this._queryEngine),this._worker=(0,g.g)(this._worker),this._memCache=(0,g.g)(this._memCache),this._nodesAddedToStage.clear(),this._fieldsHelper=(0,g.g)(this._fieldsHelper)}},{key:"i3slayer",get:function(){return this.layer}},{key:"updatingProgressValue",get:function(){var e,t;return null!==(e=null===(t=this._controller)||void 0===t?void 0:t.updatingProgress)&&void 0!==e?e:1}},{key:"requiredFields",get:function(){var e,t;return null!==(e=null===(t=this._fieldsHelper)||void 0===t?void 0:t.requiredFields)&&void 0!==e?e:[]}},{key:"maximumNumberOfFeatures",get:function(){var e,t,r,i=null===(e=this.processor)||void 0===e||null===(t=e.graphicsCore)||void 0===t?void 0:t.displayFeatureLimit;return null!==(r=null===i||void 0===i?void 0:i.maximumNumberOfFeatures)&&void 0!==r?r:0},set:function(e){null!=e?(this._override("maximumNumberOfFeatures",e),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){var e;return!this.suspended&&!(null===(e=this._controller)||void 0===e||!e.useMaximumNumberOfFeatures)&&!this._controller.leavesReached}},{key:"_excludeObjectIdsSorted",get:function(){var e=this.layer.excludeObjectIds;return e.length?e.toArray().sort((function(e,t){return e-t})):null}},{key:"lodFactor",get:function(){return"Labels"===this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}},{key:"hasM",get:function(){return!1}},{key:"hasZ",get:function(){return!0}},{key:"whenGraphicAttributes",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r){var i=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,O.u)(this.layer,t,this._getObjectIdField(),r,(function(){return(0,a.Z)(i._nodesAddedToStage.values())})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getHit",value:function(e){if(!this.loadedGraphics)return null;var t=(0,k.f)(this.loadedGraphics.find((function(t){return t.uid===e})),this.layer),r=this._getObjectIdField();return t&&t.attributes&&t.attributes[r]?(t.layer=this.layer,t.sourceLayer=this.layer,{type:"graphic",graphic:t,layer:t.layer}):null}},{key:"whenGraphicBounds",value:function(e,t){return this.processor.whenGraphicBounds(e,t)}},{key:"computeAttachmentOrigin",value:function(e,t){return this.processor.computeAttachmentOrigin(e,t)}},{key:"canResume",value:function(){return(0,s.Z)((0,u.Z)(I.prototype),"canResume",this).call(this)&&(!this._controller||this._controller.rootNodeVisible)}},{key:"isUpdating",value:function(){var e,t,r;return!!(null!==(e=this._controller)&&void 0!==e&&e.updating||null!==(t=this.processor)&&void 0!==t&&t.updating||null!==(r=this._fieldsHelper)&&void 0!==r&&r.updating||this.layerFilterUpdating)}},{key:"highlight",value:function(e){return this.processor.highlight(e,this.layer.objectIdField)}},{key:"updatePolicy",get:function(){return this.processor.graphicsCore.effectiveUpdatePolicy}},{key:"createInteractiveEditSession",value:function(e){return(0,F.i)(this._attributeEditingContext,e)}},{key:"_extractBinaryPointData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r){var i,a=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={geometryBuffer:t.geometryBuffer},e.abrupt("return",((0,g.t)(this._worker)&&(this._worker=new V((function(e){return a.view.resourceController.schedule(e)}))),this._worker.invoke(i,r).then((function(e){if((0,g.r)(e))return{positionData:e.positions,featureIds:e.featureIds};throw new Error("Failed to decompress Draco point data")}))));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_checkExtent",value:function(e,t){e&&!(0,b.e)(e,t)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&p.a.getLogger(this.declaredClass).error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&p.a.getLogger(this.declaredClass).error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++)}},{key:"addNode",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,a){var o,s,u,d,l,c,h,f,y,v;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H(r)||P(r)){e.next=2;break}throw new Error;case 2:if(!this._nodesAddedToStage.has(t.index)){e.next=4;break}return e.abrupt("return",void p.a.getLogger(this.declaredClass).error("I3S node "+t.id+" already added"));case 4:if(o=(0,g.r)(this.layer.fullExtent)?U(this.layer.fullExtent.clone(),.5):null,s=this._controller.crsVertex,u=[],d={graphics:null,featureIds:null,attributeInfo:r.attributeDataInfo,node:t},!H(r)){e.next=10;break}return e.next=8,this._addNodeBinaryPointData(t,d,r,o,u,a);case 8:e.next=11;break;case 10:P(r)&&this._addNodeLegacyPointData(t,d,r,o,u);case 11:return e.next=13,this._i3sOverrides.apply(d.featureIds,r.attributeDataInfo,a);case 13:if(t.numFeatures=d.graphics.length,this._updateNodeMemory(t),q(d),u.length>0&&(this._computeObb(t,u,s),this._controller.updateVisibility(t.index)),this._controller.isGeometryVisible(t)){e.next=19;break}return e.abrupt("return",void this._cacheNodeData(d));case 19:if((0,g.r)(this._verticalScale)){l=(0,i.Z)(d.graphics);try{for(l.s();!(c=l.n()).done;)h=c.value,this._verticalScale(h.geometry)}catch(n){l.e(n)}finally{l.f()}}if(f=this.view._stage.renderView._objectAndLayerIdRenderHelper)for(y=0;y<d.featureIds.length;y++)v=d.featureIds[y],f.setUidToObjectAndLayerId(v,d.graphics[y].uid,this.layer.id,this.layer.uid,this.layer.popupEnabled,d.node.resources.attributes,y);this._nodesAddedToStage.set(t.index,d),this.loadedGraphics.addMany(d.graphics),this._controller.updateLoadStatus(t.index,!0),this._filterNode(d),this._treeDebugger&&this._treeDebugger.update();case 23:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_computeObb",value:function(e,t,r){var i=this._controller.crsIndex,n=i.isGeographic?this.view.renderSpatialReference:i;(0,_.x)(t,r,0,t,n,0,t.length/3);var a={data:t,size:3};e.serviceObb=(0,O.V)(a),i.isGeographic&&(0,_.j)(e.serviceObb.center,n,e.serviceObb.center,i)}},{key:"isNodeLoaded",value:function(e){return this._nodesAddedToStage.has(e)}},{key:"isNodeReloading",value:function(){return!1}},{key:"updateNodeState",value:function(){}},{key:"_addNodeBinaryPointData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,i,a,o,s){var u,d,l,c,h,p,y,b,m,x,k,w,I,C,D,S,A,F,O,N;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._extractBinaryPointData(i,s);case 2:if(null!=(u=e.sent)){e.next=5;break}throw new Error;case 5:for(d=this._getObjectIdField(),l=this._controller.crsVertex,c=this.view.spatialReference,h=this.processor.graphicsCore,p=u.positionData,y=u.featureIds,3,b=p.length/3,m=new Array,x=(0,g.r)(t.serviceObb)?t.serviceObb.center:[0,0,0],k=Math.abs(x[2])*Math.pow(2,-20),w=0;w<b;w++)I=3*w,C=(0,v.c)(p[I+0],p[I+1],p[I+2]),(0,v.u)(C,C,x),Math.abs(C[2])<k&&(C[2]=0),t.serviceObb||o.push(C[0],C[1],C[2]),(0,g.r)(a)&&this._checkExtent(a,C),D=y[w],S={},null!=D&&(S[d]=D),A=null!==D&&void 0!==D?D:f.g.generateUID(),(0,_.x)(C,l,0,B,c,0,1),F=(0,E.v)(B[0],B[1],B[2],c),O=this.loadedGraphics.get(A),(0,g.r)(O)?(O.level<t.level&&(z.property="geometry",z.graphic=O,z.oldValue=(0,g.e)(O.geometry),z.newValue=F,O.geometry=F,h.graphicUpdateHandler(z)),m.push(O)):(N=f.g.generateUID(),m.push({objectId:A,uid:N,geometry:F,attributes:S,visible:!0,level:t.level}));r.graphics=m,r.featureIds=Array.from(y);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,o){return e.apply(this,arguments)}}()},{key:"_addNodeLegacyPointData",value:function(e,t,r,n,a){var o,s=this._getObjectIdField(),u=this._controller.crsVertex,d=this.view.spatialReference,l=[0,0,0],c=new Array,h=new Array,p=(0,i.Z)(r.pointData);try{for(p.s();!(o=p.n()).done;){var y=o.value,v=y.featureDataPosition,b=v.length,m=y.geometries&&y.geometries[0]||Q[b],x=y.featureIds[0];if("points"===m.params.type){(0,g.r)(n)&&this._checkExtent(n,v);var k={};null!=x&&(k[s]=x);var w=null!==x&&void 0!==x?x:f.g.generateUID(),I=void 0;"Embedded"===m.type&&(I=m.params.vertexAttributes.position);for(var C=0;C<I.length;C+=b){for(var D=0;D<b;D++)l[D]=v[D]+I[C+D];var S=3===b;e.serviceObb||a.push(l[0],l[1],S?l[2]:0),(0,_.x)(l,u,0,B,d,0,1);var A=(0,E.v)(B[0],B[1],S?B[2]:void 0,d),F=this.loadedGraphics.get(w);(0,g.r)(F)?h.push(F):h.push({objectId:w,uid:f.g.generateUID(),geometry:A,attributes:k,visible:!0})}c.push(x)}}}catch(O){p.e(O)}finally{p.f()}t.graphics=h,t.featureIds=c}},{key:"_updateNodeMemory",value:function(e){e.memory=4096+((0,g.r)(e.numFeatures)?e.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)}},{key:"_cacheNodeData",value:function(e){var t=e.graphics.reduce((function(e,t){return(0,E.A)(t)+e}),512+8*e.featureIds.length+1024);this._memCache.put(this._getMemCacheKey(e.node),e,t)}},{key:"_getMemCacheKey",value:function(e){return"".concat(e.index)}},{key:"_removeAllNodeData",value:function(){var e=this;this._nodesAddedToStage.forEach((function(t,r){if(t){var i=t.node;e._updateNodeMemory(i),e._cacheNodeData(t)}e._controller.updateLoadStatus(r,!1)})),this._nodesAddedToStage.clear(),this._treeDebugger&&this._treeDebugger.update(),this.loadedGraphics.clear()}},{key:"removeNode",value:function(e){var t=this._removeNodeStageData(e);t&&(this._updateNodeMemory(t.node),this._cacheNodeData(t))}},{key:"_removeNodeStageData",value:function(e){var t=this._nodesAddedToStage.get(e);return t?(this._controller.updateLoadStatus(e,!1),this.loadedGraphics.removeMany(t.graphics),this._nodesAddedToStage.delete(e),this._treeDebugger&&this._treeDebugger.update(),t):null}},{key:"loadCachedNodeData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._memCache.pop(this._getMemCacheKey(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addCachedNodeData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,i,a){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._nodesAddedToStage.has(t.index)){e.next=4;break}p.a.getLogger(this.declaredClass).error("I3S node "+t.id+" already added"),e.next=12;break;case 4:return this.loadedGraphics.addMany(r.graphics),this._nodesAddedToStage.set(t.index,r),this._controller.updateLoadStatus(t.index,!0),this._updateNodeMemory(t),e.next=10,this.updateAttributes(t.index,i,a);case 10:this._filterNode(r),this._treeDebugger&&this._treeDebugger.update();case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n){return e.apply(this,arguments)}}()},{key:"getLoadedNodeIds",value:function(){var e=[];return this._nodesAddedToStage.forEach((function(t){return e.push(t.node.id)})),e.sort()}},{key:"getVisibleNodes",value:function(){var e=new Array;return this._nodesAddedToStage.forEach((function(t){return e.push(t.node)})),e}},{key:"getLoadedNodeIndices",value:function(e){this._nodesAddedToStage.forEach((function(t,r){return e.push(r)}))}},{key:"getLoadedAttributes",value:function(e){var t=this._nodesAddedToStage.get(e);if(t&&(0,g.r)(t.attributeInfo))return t.attributeInfo.loadedAttributes}},{key:"getAttributeData",value:function(e){var t=this._nodesAddedToStage.get(e);if(t&&(0,g.r)(t.attributeInfo))return t.attributeInfo.attributeData}},{key:"_setAttributeData",value:function(e,t){var r=this._nodesAddedToStage.get(e);r&&!(0,g.t)(r.attributeInfo)&&(r.attributeInfo.attributeData=t,this._attributeValuesChanged(r))}},{key:"updateAttributes",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,i){var a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this._nodesAddedToStage.get(t),e.t0=a,!e.t0){e.next=7;break}return e.next=5,this._i3sOverrides.apply(a.featureIds,r,i);case 5:a.attributeInfo=r,this._attributeValuesChanged(a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_attributeValuesChanged",value:function(e){if(q(e),this._filterNode(e),this.processor.graphicsCore.labelsEnabled){var t=e.graphics.map((function(e){return e.uid}));this.processor.graphicsCore.updateLabelingInfo(t)}}},{key:"_updateClippingExtent",value:function(e){return this._controller&&this._controller.updateClippingArea(e),!1}},{key:"_getObjectIdField",value:function(){return this.layer.objectIdField||x.X}},{key:"_rendererChange",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r){var i,a,o,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer.fieldsIndex,a=new Set,!t){e.next=7;break}return e.next=4,t.collectRequiredFields(a,i);case 4:o=Array.from(a).sort(),e.next=8;break;case 7:o=[];case 8:if(a.clear(),!r){e.next=15;break}return e.next=12,r.collectRequiredFields(a,i);case 12:s=Array.from(a).sort(),e.next=16;break;case 15:s=[];case 16:o.length===s.length&&o.every((function(e,t){return o[t]===s[t]}))||this._reloadAllNodes();case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_rangeInfosChanged",value:function(e){null!=e&&e.length>0&&p.a.getLogger(this.declaredClass).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}},{key:"_filterChange",value:function(){var e=this;this._nodesAddedToStage.forEach((function(t){return e._filterNode(t)}))}},{key:"_reloadAllNodes",value:function(){this._removeAllNodeData(),this._controller&&this._controller.restartNodeLoading()}},{key:"_filterNode",value:function(e){var t,r=this.parsedDefinitionExpression,n=this._excludeObjectIdsSorted,a=this._getObjectIdField(),o=(0,i.Z)(e.graphics);try{for(o.s();!(t=o.n()).done;){var s=t.value,u=s.visible,d=!r||this._evaluateClause(r,s),l=(0,g.t)(n)||(0,g.P)(n,s.attributes[a])<0;s.visible=d&&l,u!==s.visible&&(z.graphic=s,z.property="visible",z.oldValue=u,z.newValue=s.visible,this.processor.graphicsCore.graphicUpdateHandler(z))}}catch(c){o.e(c)}finally{o.f()}}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return(0,g.r)(this.filter)?this.filter.createQuery(e):new C.x(e)}},{key:"queryFeatures",value:function(e,t){return this._queryEngine.executeQuery(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryObjectIds",value:function(e,t){return this._queryEngine.executeQueryForIds(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryFeatureCount",value:function(e,t){return this._queryEngine.executeQueryForCount(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryExtent",value:function(e,t){return this._queryEngine.executeQueryForExtent(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"_ensureQuery",value:function(e){return this._addDefinitionExpressionToQuery((0,g.t)(e)?this.createQuery():C.x.from(e))}},{key:"getUsedMemory",value:function(){var e,t,r;return null!==(e=null===(t=this.processor)||void 0===t||null===(r=t.graphicsCore)||void 0===r?void 0:r.usedMemory)&&void 0!==e?e:0}},{key:"getUnloadedMemory",value:function(){var e,t,r,i,n;return.8*((null!==(e=null===(t=this._controller)||void 0===t?void 0:t.unloadedMemoryEstimate)&&void 0!==e?e:0)+(null!==(r=null===(i=this.processor)||void 0===i||null===(n=i.graphicsCore)||void 0===n?void 0:n.unprocessedMemoryEstimate)&&void 0!==r?r:0))}},{key:"ignoresMemoryFactor",value:function(){return this._controller&&this._controller.fixedFeatureTarget}},{key:"_handleEdits",value:function(e){(0,F.u)(this._attributeEditingContext,e)}},{key:"_attributeEditingContext",get:function(){var e=this,t=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:t,forEachNode:function(t){return e._nodesAddedToStage.forEach((function(e){return t(e.node,e.featureIds)}))},attributeStorageInfo:this.i3slayer.attributeStorageInfo,i3sOverrides:this._i3sOverrides,getAttributeData:function(t){return e.getAttributeData(t)},setAttributeData:function(r,i,n){e._setAttributeData(r,i);var a=e._nodesAddedToStage.get(r);if((0,g.r)(n)){var o=e.loadedGraphics.get(n.attributes[t]);(0,g.r)(o)&&e.processor.graphicsCore.recreateGraphics([o])}else(0,g.r)(a)&&e.processor.graphicsCore.recreateGraphics(a.graphics)},clearMemCache:function(){}}}},{key:"performanceInfo",get:function(){var e={displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this._nodesAddedToStage.size,core:this.processor.graphicsCore.performanceInfo};return this._controller&&this._controller.updateStats(e),e}},{key:"test",get:function(){return{controller:this._controller,numNodes:this._nodesAddedToStage.size,loadedGraphics:this.loadedGraphics}}}]),I}((0,N.t)((0,Z.c)((0,S.n)(F.E))));(0,p.e)([(0,p.y)()],G.prototype,"processor",void 0),(0,p.e)([(0,p.y)({type:I.y})],G.prototype,"filter",void 0),(0,p.e)([(0,p.y)()],G.prototype,"loadedGraphics",void 0),(0,p.e)([(0,p.y)()],G.prototype,"i3slayer",null),(0,p.e)([(0,p.y)()],G.prototype,"_controller",void 0),(0,p.e)([(0,p.y)()],G.prototype,"updating",void 0),(0,p.e)([(0,p.y)()],G.prototype,"suspended",void 0),(0,p.e)([(0,p.y)()],G.prototype,"holeFilling",void 0),(0,p.e)([(0,p.y)(k.t)],G.prototype,"updatingProgress",void 0),(0,p.e)([(0,p.y)()],G.prototype,"updatingProgressValue",null),(0,p.e)([(0,p.y)(R.requiredFields)],G.prototype,"requiredFields",null),(0,p.e)([(0,p.y)(R.availableFields)],G.prototype,"availableFields",void 0),(0,p.e)([(0,p.y)()],G.prototype,"_fieldsHelper",void 0),(0,p.e)([(0,p.y)({type:Number})],G.prototype,"maximumNumberOfFeatures",null),(0,p.e)([(0,p.y)({readOnly:!0})],G.prototype,"maximumNumberOfFeaturesExceeded",null),(0,p.e)([(0,p.y)()],G.prototype,"_excludeObjectIdsSorted",null),(0,p.e)([(0,p.y)({readOnly:!0})],G.prototype,"lodFactor",null),(0,p.e)([(0,p.y)({readOnly:!0})],G.prototype,"hasM",null),(0,p.e)([(0,p.y)({readOnly:!0})],G.prototype,"hasZ",null);var j=G=(0,p.e)([(0,p.n)("esri.views.3d.layers.SceneLayerGraphicsView3D")],G);function P(e){return"pointData"in e}function H(e){return"geometryBuffer"in e&&null!==e.geometryBuffer}function q(e){for(var t=e.attributeInfo,r=0;r<e.graphics.length;r++){var n=e.graphics[r];if(n.attributes||(n.attributes={}),(0,g.r)(t)&&(0,g.r)(t.loadedAttributes)){var a,o=(0,i.Z)(t.loadedAttributes);try{for(o.s();!(a=o.n()).done;){var s=a.value.name;t.attributeData[s]&&(n.attributes[s]=(0,O.k)(t.attributeData[s],r))}}catch(u){o.e(u)}finally{o.f()}}}}function U(e,t){return e.xmin-=t,e.ymin-=t,e.xmax+=t,e.ymax+=t,e.hasZ&&(e.zmin-=t,e.zmax+=t),e.hasM&&(e.mmin-=t,e.mmax+=t),e}var Q={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},B=(0,v.n)(),z={graphic:null,property:null,oldValue:null,newValue:null};t.default=j}}]);
//# sourceMappingURL=8068.d10d2de5.chunk.js.map