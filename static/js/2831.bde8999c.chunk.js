"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[2831],{52195:function(e,t,n){n.d(t,{u:function(){return p}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(48848),u=n(37856),l=n(630),d=n(92072),c=n(93661),h=n(65094),f=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).layer=null,i.parent=null,i}return(0,i.Z)(n,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var n=e.layer&&e.layer.id||"no id",r=e.layer&&e.layer.title||"no title";s.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(n,"')"),t)}}))}},{key:"fullOpacity",get:function(){return(0,c.v)(this.get("layer.opacity"),1)*(0,c.v)(this.get("parent.fullOpacity"),1)}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}},{key:"updating",get:function(){var e;return!((null===(e=this.updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)},set:function(e){this._overrideIfSome("visible",e)}},{key:"canResume",value:function(){var e,t,n;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(n=this.view)||void 0===n?void 0:n.ready)||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),n}((0,l.a)((0,d.s)((0,h.m)(u.n.EventedMixin(s.m)))));(0,s.e)([(0,s.y)()],f.prototype,"fullOpacity",null),(0,s.e)([(0,s.y)()],f.prototype,"layer",void 0),(0,s.e)([(0,s.y)()],f.prototype,"parent",void 0),(0,s.e)([(0,s.y)({readOnly:!0})],f.prototype,"suspended",null),(0,s.e)([(0,s.y)({readOnly:!0})],f.prototype,"suspendInfo",null),(0,s.e)([(0,s.y)({readOnly:!0})],f.prototype,"legendEnabled",null),(0,s.e)([(0,s.y)({type:Boolean,readOnly:!0})],f.prototype,"updating",null),(0,s.e)([(0,s.y)({readOnly:!0})],f.prototype,"updatingProgress",null),(0,s.e)([(0,s.y)()],f.prototype,"visible",null),(0,s.e)([(0,s.y)()],f.prototype,"view",void 0);var p=f=(0,s.e)([(0,s.n)("esri.views.layers.LayerView")],f)},72770:function(e,t,n){n.d(t,{n:function(){return p}});var r=n(74165),i=n(15861),a=n(15671),o=n(43144),s=n(11752),u=n(61120),l=n(60136),d=n(29388),c=n(48848),h=n(50690),f=(n(93661),n(70522)),p=function(e){var t=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments)).slicePlaneEnabled=!1,e.supportsHeightUnitConversion=!1,e}return(0,o.Z)(n,[{key:"postscript",value:function(e){(0,s.Z)((0,u.Z)(n.prototype),"postscript",this).call(this,e),(0,f.g)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}},{key:"_validateHeightModelInfo",value:function(){var e=(0,i.Z)((0,r.Z)().mark((function e(){var t,n,i,a=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new AbortController,n=t.signal,this.handles.add((0,c.D)((function(){return t.abort()}))),e.next=4,(0,h.j)((function(){var e;return null===(e=a.view.defaultsFromMap)||void 0===e?void 0:e.heightModelInfoReady}),n);case 4:if((0,c.f)(n),!(i=(0,f.o)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))){e.next=8;break}throw i;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){var e=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,s.Z)((0,u.Z)(n.prototype),"canResume",this).call(this)&&(!e||!e.minScale||!e.maxScale||e.minScale>=e.maxScale)}},{key:"getSuspendInfo",value:function(){var e=(0,s.Z)((0,u.Z)(n.prototype),"getSuspendInfo",this).call(this),t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return t&&t.minScale&&t.maxScale&&t.minScale<t.maxScale&&(e.outsideScaleRange=!0),e}}]),n}(e);return(0,c.e)([(0,c.y)()],t.prototype,"view",void 0),(0,c.e)([(0,c.y)()],t.prototype,"slicePlaneEnabled",void 0),t=(0,c.e)([(0,c.n)("esri.views.3d.layers.LayerView3D")],t)}},22831:function(e,t,n){n.r(t),n.d(t,{F:function(){return Ae},O:function(){return Ie},P:function(){return Ye},_:function(){return Re},y:function(){return Ce}});var r,i,a,o,s,u,l,d,c,h=n(29439),f=n(74165),p=n(15861),v=n(93433),g=n(11752),_=n(61120),y=n(30168),m=n(37762),b=n(15671),x=n(43144),S=n(60136),k=n(29388),P=n(48848),w=n(59389),N=n(93314),Z=n(93661),z=n(50690),C=n(77956),I=n(47855),R=n(71802),A=n(87424),O=n(95249),F=n(93209),E=n(25456),M=n(24093),L=n(43406),V=n(69641),D=n(59984),q=n(47748),H=n(15529),T=n(72770),U=n(59929),Q=n(22159),W=n(1475),B=n(64998),G=n(64772),j=n(57791),J=n(28390),X=n(70381),K=n(25747),Y=n(43345),$=n(79557),ee=n(49228),te=n(29048),ne=n(13239),re=n(93122),ie=n(31698),ae=n(11448),oe=n(72936),se=n(52195),ue=n(85700),le=function(e){(0,S.Z)(n,e);var t=(0,k.Z)(n);function n(e){var r;return(0,b.Z)(this,n),r=t.call(this,"PointCloudWorker","transform",{transform:function(e){return r._getTransferList(e)}},e)}return(0,x.Z)(n,[{key:"_getTransferList",value:function(e){var t=[e.geometryBuffer];if((0,Z.r)(e.primaryAttributeData)&&e.primaryAttributeData.buffer&&t.push(e.primaryAttributeData.buffer),(0,Z.r)(e.modulationAttributeData)&&e.modulationAttributeData.buffer&&t.push(e.modulationAttributeData.buffer),(0,Z.r)(e.filterAttributesData)){var n,r=(0,m.Z)(e.filterAttributesData);try{for(r.s();!(n=r.n()).done;){var i=n.value;(0,Z.r)(i)&&i.buffer&&t.push(i.buffer)}}catch(u){r.e(u)}finally{r.f()}}var a,o=(0,m.Z)(e.userAttributesData);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.buffer&&t.push(s.buffer)}}catch(u){o.e(u)}finally{o.f()}return t}}]),n}(U.h);var de=[!1],ce=[null],he=[!1],fe=[null];function pe(e,t,n){for(var r=e;r>0;){var i=t.indexOf(r);if(i>=0)return i;r=n.getParentId(r)}return t.indexOf(r)}function ve(e,t,n){for(var r=[t.remove[0]],i=[];1===r.length;){var a=r.pop();i.length=0;for(var o=0;o<t.load.length;o++){for(var s=t.load[o],u=n.getParentId(s);u!==a;)s=u,u=n.getParentId(s);var l=r.indexOf(s);l<0&&(l=r.length,r.push(s),i.push([])),i[l].push(t.load[o])}}t.load=r;for(var d=0;d<r.length;d++)i[d].length>1?e.push({remove:[r[d]],load:i[d]}):r[d]=i[d][0]}var ge=function(){function e(t,n,r){(0,b.Z)(this,e),this._pages=[],this.pageSize=0,this._nodeSR=null,this._renderSR=null,this._nodeSR=t,this._renderSR=n,this.pageSize=r}return(0,x.Z)(e,[{key:"addPage",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._pages.length<e;)this._pages.push(null);var r=_e(t,this._nodeSR,this._renderSR,n);this._pages[e]={nodes:t,renderObbs:r,parents:new Uint32Array(this.pageSize)},ye(this._pages,this.pageSize)}},{key:"hasPage",value:function(e){return!!this._pages[e]}},{key:"getNode",value:function(e){var t=this.pageSize;return this._pages[me(e,t)].nodes[be(e,t)]}},{key:"getRenderObb",value:function(e){var t=this.pageSize;return this._pages[me(e,t)].renderObbs[be(e,t)]}},{key:"getRenderCenter",value:function(e){return this.getRenderObb(e).center}},{key:"setRenderObb",value:function(e,t){var n=this.pageSize;(0,Q.G)(t,this._pages[me(e,n)].renderObbs[be(e,n)])}},{key:"getParentId",value:function(e){var t=this.pageSize;return this._pages[me(e,t)].parents[be(e,t)]}},{key:"hasNodes",value:function(e,t){for(var n=me(e,this.pageSize),r=me(e+t-1,this.pageSize),i=n;i<=r;i++)if(null==this._pages[i])return!1;return!0}},{key:"forEachNodeId",value:function(e){for(var t=0;t<this._pages.length;t++){var n=this._pages[t];if(n)for(var r=0;r<n.nodes.length;r++)e(t*this.pageSize+r)}}},{key:"createVisibilityTraverse",value:function(){var e={index:this,queue:[],masks:[],tempAabb:(0,F.a)()};return function(t,n){return function(e,t,n){var r=e.index;if(!r.hasNodes(0,1))return;var i=e.queue;i.length=0,i.push(0);var a=e.masks;for(a.length=0,a.push(0);i.length>0;){var o=i.pop(),s=a.pop(),u=r.getNode(o),l=r.getRenderObb(o),d=!0;if(null!=t.clippingBox){var c=1<<t.frustum.length;if(0==(s&c)){var h=(0,Q.K)(l,e.tempAabb);(0,F.b)(t.clippingBox,h)?s|=c:(0,F.j)(t.clippingBox,h)||(d=!1)}}for(var f=0;f<t.frustum.length&&d;f++){var p=1<<f;if(0==(s&p)){var v=(0,Q.J)(l,t.frustum[f]);v>0?d=!1:v<0&&(s|=p)}}if(n.predicate(o,u,d)){for(var g=u.firstChild,_=u.childCount,y=!1,m=me(g,r.pageSize),b=me(g+_-1,r.pageSize),x=m;x<=b;x++)if(!r.hasPage(x)){n.pageMiss(o,x),y=!0;break}if(!y)for(var S=0;S<_;S++)i.push(g+S),a.push(s)}}}(e,t,n)}}}]),e}();function _e(e,t,n,r){for(var i=new Q.H(e.length),a=0;a<e.length;a++)(0,Q._)(e[a].obb,t,i.obbs[a],n,r);return i.obbs}function ye(e,t){for(var n=[0];n.length;)for(var r=n.pop(),i=e[me(r,t)].nodes[be(r,t)],a=0;a<i.childCount;a++){var o=i.firstChild+a;null!=e[me(o,t)]&&(e[me(o,t)].parents[be(o,t)]=r,n.push(o))}}function me(e,t){return e/t|0}function be(e,t){return e%t}function xe(e){var t=e.renderer,n=t&&t.type,r=t&&e.renderer.toJSON()||null,i=null,a=!1;"point-cloud-unique-value"===n||"point-cloud-stretch"===n||"point-cloud-class-breaks"===n?i=we(e.attributeStorageInfo,t.field):"point-cloud-rgb"===n?a=null!=(i=Pe(e.attributeStorageInfo,t.field)):a=null!=(i=Pe(e.attributeStorageInfo,"RGB"));var o=null;return t&&t.colorModulation&&(o=we(e.attributeStorageInfo,t.colorModulation.field)),{rendererJSON:r,isRGBRenderer:a,primaryAttribute:i,modulationAttribute:o}}function Se(e){var t=e.filters;return t?t.map((function(t){return{filterJSON:t.toJSON(),attributeInfo:we(e.attributeStorageInfo,t.field)}})):[]}function ke(e){var t=e&&e.pointSizeAlgorithm;return t&&"fixed-size"===t.type?t:null}function Pe(e,t){var n,r=(0,m.Z)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.name===t&&null!=i.attributeValues&&"UInt8"===i.attributeValues.valueType&&3===i.attributeValues.valuesPerElement)return{name:t,storageInfo:i,useElevation:!1}}}catch(a){r.e(a)}finally{r.f()}return null}function we(e,t){var n,r=(0,m.Z)(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.name===t){var a="embedded-elevation"===i.encoding;return{name:t,storageInfo:a?null:i,useElevation:a}}}}catch(o){r.e(o)}finally{r.f()}return"elevation"===t.toLowerCase()?{name:t,storageInfo:null,useElevation:!0}:null}var Ne=function(e){(0,S.Z)(n,e);var t=(0,k.Z)(n);function n(e){return(0,b.Z)(this,n),t.call(this,e)}return(0,x.Z)(n)}(B.g);(0,P.e)([(0,P.y)({constructOnly:!0,clonable:"reference"})],Ne.prototype,"pointCloudMetadata",void 0),Ne=(0,P.e)([(0,P.n)("esri.views.3d.layers.i3s.PointGraphic")],Ne);var Ze=function(){function e(t){(0,b.Z)(this,e),this._context=t,this._highlights=new Set}return(0,x.Z)(e,[{key:"hasHighlights",get:function(){return this._highlights.size>0}},{key:"destroy",value:function(){this._highlights=null}},{key:"add",value:function(e){var t=this,n=new ze(e);return this._highlights.add(n),this._enableSet(n),(0,P.D)((function(){return t._removeSet(n)}))}},{key:"_removeSet",value:function(e){this._disableSet(e),this._highlights.delete(e)}},{key:"_enableSet",value:function(e){var t=this;e.enabled||(e.enabled=!0,this._context.forEachNode((function(n){return t._enableSetForNode(e,n)})))}},{key:"_enableSetForNode",value:function(e,t){var n=this;if(e.enabled){var r=e.ids.get(t.id);r&&r.forEach((function(r){return n._context.addHighlight(t,r,e.id)}))}}},{key:"_disableSet",value:function(e){var t=this;e.enabled&&(e.enabled=!1,this._context.forEachNode((function(n){return t._disableSetForNode(e,n)})))}},{key:"_disableSetForNode",value:function(e,t){e.enabled||this._context.removeHighlight(t,e.id)}},{key:"nodeAdded",value:function(e){var t=this;this._highlights.forEach((function(n){return t._enableSetForNode(n,e)}))}},{key:"nodeRemoved",value:function(e){var t=this;this._highlights.forEach((function(n){return t._disableSetForNode(n,e)}))}},{key:"removeAll",value:function(){var e=this;this._highlights.forEach((function(t){return e._disableSet(t)}))}}]),e}(),ze=function(){function e(t){(0,b.Z)(this,e),this.id=new J.a0(j.u.Highlight),this.ids=new Map,this.enabled=!1;var n,r=(0,m.Z)(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;(0,Z.r)(i)&&this._add(i.nodeId,i.pointId)}}catch(a){r.e(a)}finally{r.f()}}return(0,x.Z)(e,[{key:"_add",value:function(e,t){var n=this.ids.get(e);n?n.add(t):this.ids.set(e,new Set([t]))}}]),e}(),Ce=function(e){(0,S.Z)(n,e);var t=(0,k.Z)(n);function n(){var e;return(0,b.Z)(this,n),(e=t.apply(this,arguments)).clipBox=(0,F.a)(F.v),e.useFixedSizes=!1,e.useRealWorldSymbolSizes=!1,e.scaleFactor=1,e.minSizePx=0,e.size=0,e.sizePx=0,e}return(0,x.Z)(n,[{key:"fixedSize",get:function(){return this.drawScreenSpace?this.sizePx:this.size}},{key:"screenMinSize",get:function(){return this.useFixedSizes?0:this.minSizePx}},{key:"drawScreenSpace",get:function(){return this.useFixedSizes&&!this.useRealWorldSymbolSizes}}]),n}(X.t),Ie=function(e){(0,S.Z)(n,e);var t=(0,k.Z)(n);function n(e,r,i){var a;return(0,b.Z)(this,n),(a=t.call(this,e)).origin=e,a.isLeaf=r,a.splatSize=i,a}return(0,x.Z)(n)}(X.bT);function Re(e){var t=new X.o,n=e.output===X.O.Color,h=e.output===X.O.Depth,f=e.output===X.O.Highlight,p=t.vertex,v=t.fragment;return t.extensions.add("GL_OES_standard_derivatives"),t.include(X.a0,e),t.attributes.add(Y.O.POSITION,"vec3"),t.attributes.add(Y.O.COLOR,"vec3"),p.uniforms.add([new X.bg("modelView",(function(e,t){return(0,$.u)(Oe,t.camera.viewMatrix,(0,$.x)(Oe,e.origin))})),new X.e("proj",(function(e,t){return t.camera.projectionMatrix})),new X.bD("screenMinMaxSize",(function(e,t,n){return(0,te.r)(Ee,n.useFixedSizes?0:n.minSizePx*t.camera.pixelRatio,Ae(e.isLeaf)*t.camera.pixelRatio)}))]),p.uniforms.add(e.useFixedSizes?new X.b("pointScale",(function(e,t){return(0,te.r)(Ee,e.fixedSize*t.camera.pixelRatio,t.camera.fullHeight)})):new X.bD("pointScale",(function(e,t,n){return(0,te.r)(Ee,e.splatSize*n.scaleFactor*t.camera.pixelRatio,t.camera.fullHeight/t.camera.pixelRatio)}))),e.clippingEnabled?p.uniforms.add([new X.bN("clipMin",(function(e,t,n){return(0,R.o)(Fe,n.clipBox[0]-e.origin[0],n.clipBox[1]-e.origin[1],n.clipBox[2]-e.origin[2])})),new X.bN("clipMax",(function(e,t,n){return(0,R.o)(Fe,n.clipBox[3]-e.origin[0],n.clipBox[4]-e.origin[1],n.clipBox[5]-e.origin[2])}))]):(p.constants.add("clipMin","vec3",[-R.X,-R.X,-R.X]),p.constants.add("clipMax","vec3",[R.X,R.X,R.X])),h?((0,X.b1)(t),(0,X.av)(t),t.varyings.add("depth","float")):e.output!==X.O.Highlight&&t.varyings.add("vColor","vec3"),p.code.add((0,X.n)(r||(r=(0,y.Z)(["\n    void main(void) {\n      // Move clipped points outside of clipspace\n      if (position.x < clipMin.x || position.y < clipMin.y || position.z < clipMin.z ||\n        position.x > clipMax.x || position.y > clipMax.y || position.z > clipMax.z) {\n        gl_Position = vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize = 0.0;\n        return;\n      }\n\n      if (rejectBySlice(position)) {\n        gl_Position = vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize = 0.0;\n        return;\n      }\n\n      // Position in camera space\n      vec4 camera = modelView * vec4(position, 1.0);\n\n      float pointSize = pointScale.x;\n      vec4 position = proj * camera;\n     ","\n\n     gl_PointSize = clampedScreenSize;\n     gl_Position = position;\n\n     ","\n     ","\n    }\n  "])),e.drawScreenSize?(0,X.n)(i||(i=(0,y.Z)(["\n      float clampedScreenSize = pointSize;"]))):(0,X.n)(a||(a=(0,y.Z)(["\n      float pointRadius = 0.5 * pointSize;\n      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);\n      vec4 positionOffset = proj * cameraOffset;\n      float radius = abs(positionOffset.y - position.y);\n      float viewHeight = pointScale.y;\n      // screen diameter = (2 * r / w) * (h / 2)\n      float screenPointSize = (radius / position.w) * viewHeight;\n      float clampedScreenSize = clamp(screenPointSize, screenMinMaxSize.x, screenMinMaxSize.y);\n      // Shift towards camera, to move rendered point out of terrain i.e. to\n      // the camera-facing end of the virtual point when considering it as a\n      // 3D sphere.\n      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n      position = proj * camera;"]))),h?(0,X.n)(o||(o=(0,y.Z)(["depth = calculateLinearDepth(nearFar, camera.z);"]))):"",n?(0,X.n)(s||(s=(0,y.Z)(["vColor = color;"]))):"")),v.include(X.y,e),f&&t.include(X.a9,e),v.code.add((0,X.n)(u||(u=(0,y.Z)(["\n    void main(void) {\n      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);\n      float r2 = dot(vOffset, vOffset);\n\n      if (r2 > 0.25) {\n        discard;\n      }\n      ","\n      ","\n      ","\n    }\n  "])),h?(0,X.n)(l||(l=(0,y.Z)(["gl_FragColor = float2rgba(depth);"]))):"",f?(0,X.n)(d||(d=(0,y.Z)(["outputHighlight();"]))):"",n?(0,X.n)(c||(c=(0,y.Z)(["gl_FragColor = vec4(vColor, 1.0);"]))):"")),t}function Ae(e){return e?256:64}var Oe=(0,ee.e)(),Fe=(0,R.n)(),Ee=(0,ne.n)(),Me=Object.freeze(Object.defineProperty({__proto__:null,PointRendererPassParameters:Ce,PointRendererDrawParameters:Ie,build:Re,getMaxPointSizeScreenspace:Ae},Symbol.toStringTag,{value:"Module"})),Le=function(e){(0,S.Z)(n,e);var t=(0,k.Z)(n);function n(e,r,i){return(0,b.Z)(this,n),t.call(this,e,r,i)}return(0,x.Z)(n,[{key:"initializeProgram",value:function(e){return new X.l(e.rctx,n.shader.get().build(this.configuration),X.E)}},{key:"initializePipeline",value:function(){return(0,j.W)({depthTest:{func:re.I.LESS},depthWrite:j.b,colorWrite:j._,stencilWrite:this.configuration.hasOccludees?X.ax:null,stencilTest:this.configuration.hasOccludees?X.az:null})}}]),n}(X.k);Le.shader=new X.m(Me,(function(){return n.e(2031).then(n.bind(n,52031))}));var Ve=function(e){(0,S.Z)(n,e);var t=(0,k.Z)(n);function n(){var e;return(0,b.Z)(this,n),(e=t.apply(this,arguments)).output=X.O.Color,e.hasSlicePlane=!1,e.drawScreenSize=!1,e.useFixedSizes=!1,e.hasOccludees=!1,e.clippingEnabled=!1,e}return(0,x.Z)(n)}(X.J);(0,P.e)([(0,X.p)({count:X.O.COUNT})],Ve.prototype,"output",void 0),(0,P.e)([(0,X.p)()],Ve.prototype,"hasSlicePlane",void 0),(0,P.e)([(0,X.p)()],Ve.prototype,"drawScreenSize",void 0),(0,P.e)([(0,X.p)()],Ve.prototype,"useFixedSizes",void 0),(0,P.e)([(0,X.p)()],Ve.prototype,"hasOccludees",void 0),(0,P.e)([(0,X.p)()],Ve.prototype,"clippingEnabled",void 0),(0,P.e)([(0,X.p)({constValue:!0})],Ve.prototype,"hasSliceInVertexProgram",void 0);var De={positions:[new ae.t(Y.O.POSITION,3,re.C.FLOAT,0,12)],colors:[new ae.t(Y.O.COLOR,3,re.C.UNSIGNED_BYTE,0,3,!0)]},qe=function(){function e(t){var n=this;(0,b.Z)(this,e),this._params=t,this.type=K.M.PCL,this.isGround=!1,this._passParameters=new Ce,this._highlights=new Ze({forEachNode:function(e){return n.forEachNode(e)},addHighlight:function(e,t,r){return n._addHighlight(e,t,r)},removeHighlight:function(e,t){return n._removeHighlight(e,t)}}),this.canRender=!0,this.layerUid="",this._slicePlaneEnabled=!1,this._techniqueConfig=new Ve,this._nodes=new P.a6}return(0,x.Z)(e,[{key:"needsHighlight",get:function(){return this._highlights.hasHighlights}},{key:"initializeRenderContext",value:function(e){this._context=e,this._techniqueRep=this._context.shaderTechniqueRepository,e.requestRender()}},{key:"uninitializeRenderContext",value:function(){}},{key:"intersect",value:function(e,t,n,r){var i=this,a=(0,R.n)(),o=(0,R.n)(),s=(0,R.n)(),u=(0,R.n)(),l=(0,M.p)(),d=e.camera.perScreenPixelRatio/2,c=e.camera.near;(0,R.e)(o,r,n);var h=1/(0,R.s)(o);(0,R.g)(o,o,h),(0,R.q)(s,o),(0,R.C)(l,o[0],o[1],o[2],-(0,R.P)(o,n));var f=new We,p=new We,v=new Array,g=(0,F.a)(),_=(0,F.a)(this._passParameters.clipBox);(0,F.V)(_,-n[0],-n[1],-n[2],_),this._nodes.forAll((function(y){var m=y.splatSize*i._passParameters.scaleFactor,b=(0,Q.L)(y.obb,l),x=(0,Q.N)(y.obb,l);b-=Ue(m,b+c,i._passParameters,d,y.isLeaf);var S=(x-=Ue(m,x+c,i._passParameters,d,y.isLeaf))<0,k=null!=f.dist&&null!=p.dist&&f.dist<b*h&&p.dist>x*h;if(!S&&!k){var P=Te(m,x+c,i._passParameters,d,y.isLeaf);if((0,Q.P)(y.obb,n,o,P)){var w=P*P;(0,Q.K)(y.obb,g),(0,F.V)(g,-n[0],-n[1],-n[2],g);var N=!(0,F.b)(_,g);(0,R.e)(u,y.origin,n);for(var z=y.coordinates.length/3,C=function(l){if(a[0]=u[0]+y.coordinates[3*l],a[1]=u[1]+y.coordinates[3*l+1],a[2]=u[2]+y.coordinates[3*l+2],N&&!(0,F.E)(_,a))return"continue";var g=(0,R.P)(a,o),b=(0,R.v)(a)-g*g;if(b>w)return"continue";var x=g+c,S=Ue(m,x,i._passParameters,d,y.isLeaf);if(g-S<0)return"continue";var k=Te(m,x-=S,i._passParameters,d,y.isLeaf);if(b>k*k)return"continue";var P=(g-S)*h,z=function(e){return e.point=function(e,t,n){return(0,Z.t)(n)&&(n=(0,R.n)()),n[0]=e.origin[0]+e.coordinates[3*t],n[1]=e.origin[1]+e.coordinates[3*t+1],n[2]=e.origin[2]+e.coordinates[3*t+2],n}(y,l,e.point),e.dist=P,e.normal=s,e.node=y,e.pointId=l,e.layerUid=i.layerUid,e};if((null==f.dist||P<f.dist)&&(null==t||t(n,r,P))&&z(f),e.options.store!==K.J.MIN&&(null==p.dist||P>p.dist)&&(null==t||t(n,r,P))&&z(p),e.options.store===K.J.ALL&&(null==t||t(n,r,P))){var C=new We;v.push(z(C))}},I=0;I<z;I++)C(I)}}}));var y=function(e,t){var n=function(e){var t=e.layerUid,n=e.node,r=e.pointId;return{point:e.point,layerUid:t,graphicUid:r,createGraphic:function(){return i._params.createGraphic(n,r,e.point)}}}(t);e.set(i.type,n,t.dist,t.normal)};if(Be(f)){var b=e.results.min;(null==b.dist||f.dist<b.dist)&&y(b,f)}if(Be(p)&&e.options.store!==K.J.MIN){var x=e.results.max;(null==x.dist||p.dist>x.dist)&&y(x,p)}if(e.options.store===K.J.ALL){var S,k=(0,G.h)(n,r),P=(0,m.Z)(v);try{for(P.s();!(S=P.n()).done;){var w=S.value,N=(0,K.L)(k);y(N,w),e.results.all.push(N)}}catch(z){P.e(z)}finally{P.f()}}}},{key:"prepareTechnique",value:function(e){var t=this;return 0===this._nodes.length||e.output!==X.O.Color&&e.output!==X.O.Depth&&e.output!==X.O.Highlight?null:(this._nodes.forAll((function(n){null==n.vao&&t._initNode(e,n)})),this._techniqueConfig.drawScreenSize=this._passParameters.drawScreenSpace,this._techniqueConfig.useFixedSizes=this._passParameters.useFixedSizes,this._techniqueConfig.hasSlicePlane=this._slicePlaneEnabled,this._techniqueConfig.hasOccludees=e.bindParameters.hasOccludees,this._techniqueConfig.clippingEnabled=this._clippingEnabled,this._techniqueConfig.output=e.output===X.O.Depth?X.O.Depth:e.output===X.O.Highlight?X.O.Highlight:X.O.Color,this._techniqueRep.releaseAndAcquire(Le,this._techniqueConfig,this._technique))}},{key:"render",value:function(e,t){var n=this,r=e.rctx,i=r.bindTechnique(t,this._passParameters,e.bindParameters),a=e.output===X.O.Highlight;this._nodes.forAll((function(t){0===t.coordinates.length||a&&!t.highlights||(i.bindDraw(t,e.bindParameters,n._passParameters),r.bindVAO(t.vao),a?n._renderHighlightFragments(r,t):r.drawArrays(re.E.POINTS,0,t.coordinates.length/3))}))}},{key:"_renderHighlightFragments",value:function(e,t){var n=t.highlights;if(!(0,Z.t)(n)){for(var r=(0,Z.e)(n[0].component),i=r+1,a=1;a<n.length;a++){var o=(0,Z.e)(n[a].component);if(o!==i){var s=i-r;s>0&&e.drawArrays(re.E.POINTS,r,s),r=o}i=o+1}var u=i-r;u>0&&e.drawArrays(re.E.POINTS,r,u)}}},{key:"useFixedSizes",get:function(){return this._passParameters.useFixedSizes},set:function(e){this._passParameters.useFixedSizes!==e&&(this._passParameters.useFixedSizes=e,this._requestRender())}},{key:"scaleFactor",get:function(){return this._passParameters.scaleFactor},set:function(e){this._passParameters.scaleFactor!==e&&(this._passParameters.scaleFactor=e,this._requestRender())}},{key:"minSizePx",get:function(){return this._passParameters.minSizePx},set:function(e){this._passParameters.minSizePx!==e&&(this._passParameters.minSizePx=e,this._requestRender())}},{key:"useRealWorldSymbolSizes",get:function(){return this._passParameters.useRealWorldSymbolSizes},set:function(e){this._passParameters.useRealWorldSymbolSizes!==e&&(this._passParameters.useRealWorldSymbolSizes=e,this._requestRender())}},{key:"size",get:function(){return this._passParameters.size},set:function(e){this._passParameters.size!==e&&(this._passParameters.size=e,this._requestRender())}},{key:"sizePx",get:function(){return this._passParameters.sizePx},set:function(e){this._passParameters.sizePx!==e&&(this._passParameters.sizePx=e,this._requestRender())}},{key:"clippingBox",set:function(e){(0,F.w)(this._passParameters.clipBox,e||F.v)}},{key:"_clippingEnabled",get:function(){return!(0,F.S)(this._passParameters.clipBox,F.v,(function(e,t){return e===t}))}},{key:"slicePlaneEnabled",get:function(){return this._slicePlaneEnabled},set:function(e){this._slicePlaneEnabled!==e&&(this._slicePlaneEnabled=e,this._requestRender())}},{key:"addNode",value:function(e){this._nodes.push(e),this._highlights.nodeAdded(e),this._requestRender()}},{key:"removeNode",value:function(e){var t=this,n=null;return this._nodes.filterInPlace((function(r){return r.id!==e||(n=r,r.vao=(0,Z.G)(r.vao),t._highlights.nodeRemoved(r),!1)})),this._requestRender(),n}},{key:"forEachNode",value:function(e){this._nodes.forAll(e)}},{key:"removeAll",value:function(){this._nodes.forAll((function(e){return e.vao=(0,Z.G)(e.vao)})),this._highlights.removeAll(),this._nodes.clear(),this._requestRender()}},{key:"highlight",value:function(e){return this._highlights.add(e)}},{key:"_addHighlight",value:function(e,t,n){e.highlights=function(e,t,n){(0,Z.t)(e)&&(e=[]);var r={component:t,id:n};e.push(r);for(var i=Qe(r),a=e.length-1;a>0&&i<Qe(e[a-1]);){var o;o=[e[a],e[a-1]],e[a-1]=o[0],e[a]=o[1],--a}return e}(e.highlights,t,n),this._requestRender()}},{key:"_removeHighlight",value:function(e,t){e.highlights=function(e,t){if((0,Z.t)(e))return e;var n=e.filter((function(e){return e.id!==t}));return 0===n.length?null:n}(e.highlights,t),this._requestRender()}},{key:"_initNode",value:function(e,t){var n=e.rctx;t.vao=new X.N(n,X.E,De,{positions:ie.E.createVertex(n,re.F.STATIC_DRAW,t.coordinates),colors:ie.E.createVertex(n,re.F.STATIC_DRAW,t.rgb)})}},{key:"_requestRender",value:function(){this._context&&this._context.requestRender()}}]),e}(),He=function(e){(0,S.Z)(n,e);var t=(0,k.Z)(n);function n(e,r,i,a,o,s,u,l){var d,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null;return(0,b.Z)(this,n),(d=t.call(this,i,o,r)).id=e,d.obb=a,d.coordinates=s,d.rgb=u,d.attributes=l,d.pointIdFilterMap=c,d.highlights=h,d}return(0,x.Z)(n)}(Ie);function Te(e,t,n,r,i){if(n.drawScreenSpace)return n.fixedSize*t*r;var a=Ae(i)*t*r;return n.useFixedSizes?Math.min(n.fixedSize/2,a):n.screenMinSize>0?Math.min(Math.max(n.screenMinSize*t*r,e/2),a):Math.min(e/2,a)}function Ue(e,t,n,r,i){return n.drawScreenSpace?0:Te(e,t,n,r,i)}function Qe(e){return(0,Z.r)(e.component)?e.component:-1}var We=(0,x.Z)((function e(){(0,b.Z)(this,e),this.node=null,this.pointId=null,this.point=null,this.dist=null,this.normal=null,this.layerUid=""}));function Be(e){return(0,Z.r)(e.dist)&&(0,Z.r)(e.point)&&(0,Z.r)(e.pointId)&&(0,Z.r)(e.node)}var Ge=(0,M.p)(),je=function(e){(0,S.Z)(n,e);var t=(0,k.Z)(n);function n(){var e;return(0,b.Z)(this,n),(e=t.apply(this,arguments)).type="point-cloud-3d",e.maximumPointCount=4e6,e.slicePlaneEnabled=!1,e._renderer=null,e._rendererAdded=!1,e._renderedNodes=new Set,e._nodeScales=new Map,e._updateViewNeeded=!0,e._lodFactor=1,e._maxLoggedBoxWarnings=5,e._pageMultiplier=1,e._nodeLoadEpoch=0,e._indexQueue=[],e._workQueue=new Array,e._idleQueue=new q.n,e._indexPagesLoading=new Map,e._loadingNodes=new Map,e._recalcWork=!0,e._layerIsVisible=!1,e._codedDomainPopulationPromise=null,e._codedDomainPopulationAbortController=null,e._totalWork=0,e._index=null,e._loadingInitNodePage=!1,e._nodeIdArray=[],e}return(0,x.Z)(n,[{key:"baseUrl",get:function(){return this.layer.parsedUrl.path}},{key:"pointScale",get:function(){var e=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"splat"===t.type?t:null}(this.layer&&this.layer.renderer);return e&&null!=e.scaleFactor?e.scaleFactor:1}},{key:"useRealWorldSymbolSizes",get:function(){var e=ke(this.layer&&this.layer.renderer);return!(!e||null==e.useRealWorldSymbolSizes)&&e.useRealWorldSymbolSizes}},{key:"pointSize",get:function(){var e=ke(this.layer&&this.layer.renderer);return e&&null!=e.size?e.size:0}},{key:"inverseDensity",get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5}},{key:"availableFields",get:function(){var e=xe(this.layer),t=new Set;e.primaryAttribute&&t.add(e.primaryAttribute.name),e.modulationAttribute&&t.add(e.primaryAttribute.name);var n=Se(this.layer);if(n){var r,i=(0,m.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;t.add(a.attributeInfo.name)}}catch(l){i.e(l)}finally{i.f()}}if(this.layer.outFields){var o,s=(0,m.Z)((0,D.v)(this.layer.fieldsIndex,this.layer.outFields));try{for(s.s();!(o=s.n()).done;){var u=o.value;t.add(u)}}catch(l){s.e(l)}finally{s.f()}}return Array.from(t)}},{key:"_clippingBox",get:function(){if(!this.view||!this.view.clippingArea)return null;var e=(0,F.a)(),t=this.view.renderSpatialReference;return(0,J.a1)(this.view.clippingArea,e,t)?e:null}},{key:"_elevationOffset",get:function(){var e=this.layer&&this.layer.elevationInfo;if(e&&"absolute-height"===e.mode){var t=(0,I.L)(this.layer.spatialReference),n=(0,H.r)(e.unit);return(0,Z.v)(e.offset,0)*n/t}return 0}},{key:"initialize",value:function(){var e=this,t=this.view.resourceController;this._worker=new le((function(e){return t.schedule(e)})),this.addResolvingPromise(this._worker.promise),this._tmpPoint=(0,L.v)(0,0,0,this.layer.spatialReference),(0,Q.I)(this.layer),(0,Q.Q)(this.layer,this.view),this._indexRequester=t.createStreamDataRequester(J.Q.I3S_INDEX),this._dataRequester=t.createStreamDataRequester(J.Q.I3S_DATA),this._initRenderer();var n=this._initNodePages(),r=this.view.resourceController.memoryController;this._memCache=r.newCache(this.layer.uid),this.updatingHandles.add((function(){return e._clippingBox}),(function(){return e._setUpdateViewNeeded()}),z.h),this.updatingHandles.add((function(){return e._elevationOffset}),(function(){return e._elevationOffsetChanged()}),z.h),this.updatingHandles.add((function(){return e.layer.renderer}),(function(){return e._rendererChanged()}),z.h),this.updatingHandles.add((function(){return e.layer.filters}),(function(){return e._reload()}),z.h),this.updatingHandles.add((function(){return e.layer.outFields}),(function(){return e._reload()}),z.h),this.updatingHandles.add((function(){return e.layer.effectiveScaleRange}),(function(){return e._setUpdateViewNeeded()})),this.updatingHandles.add((function(){return e.view.state.contentCamera}),(function(){return e._setUpdateViewNeeded()})),this.handles.add([this.view.basemapTerrain.on("scale-change",(function(t){return e._scaleUpdateHandler(t)})),(0,z.l)((function(){return r.memoryFactor}),(function(){return e._setUpdateViewNeeded()}),z.U)]),this.addResolvingPromise(n),this.when((function(){e.handles.add([t.scheduler.registerTask(q.I.POINT_CLOUD_LAYER,e),t.scheduler.registerIdleStateCallbacks((function(){return e._idleBegin()}),(function(){return e._idleEnd()})),e.updatingHandles.add((function(){return e.suspended}),(function(t){t?e._clearNodeState():e._setUpdateViewNeeded()}),z.h)])}),(function(){e.updatingHandles.removeAll(),e.handles.removeAll()}))}},{key:"_setUpdateViewNeeded",value:function(){this._updateViewNeeded=!0,this._updateLoading()}},{key:"destroy",value:function(){this.cancelLoading(),this._worker&&(this._worker.destroy(),this._worker=null),this._destroyRenderer(),this._memCache.destroy(),this._memCache=null,this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null),this._codedDomainPopulationPromise=null}},{key:"_initRenderer",value:function(){var e=this;this._renderer=new qe({createGraphic:function(t,n,r){return e._createGraphic(t,n,r)}}),this._renderer.layerUid=this.layer.uid,this.updatingHandles.add((function(){return e._clippingBox}),(function(t){return e._renderer.clippingBox=t}),z.h),this.updatingHandles.add((function(){return e.suspended}),(function(t){return e._setPointsVisible(!t)}),z.h),this.updatingHandles.add((function(){return e.pointScale}),(function(t){return e._renderer.scaleFactor=t}),z.h),this._renderer.minSizePx=Math.sqrt(2),this.updatingHandles.add((function(){return e.useRealWorldSymbolSizes}),(function(t){return e._renderer.useRealWorldSymbolSizes=t}),z.h),this.updatingHandles.add((function(){return e.pointSize}),(function(t){var n=(0,C.u)(t);e._renderer.size=t,e._renderer.sizePx=n}),z.h),this.updatingHandles.add((function(){return e.slicePlaneEnabled}),(function(t){return e._renderer.slicePlaneEnabled=t}),z.h),this.updatingHandles.add((function(){return e.inverseDensity}),(function(){return e._setUpdateViewNeeded()}),z.h),this.updatingHandles.add((function(){return e.maximumPointCount}),(function(){return e._setUpdateViewNeeded()}),z.h),this.updatingHandles.add((function(){return e.view.qualitySettings.sceneService.pointCloud.lodFactor}),(function(t){e._lodFactor=t,e._setUpdateViewNeeded()}),z.h)}},{key:"_destroyRenderer",value:function(){this._renderer.removeAll(),this._setPointsVisible(!1)}},{key:"_createGraphic",value:function(e,t,n){var r=(0,Z.r)(e.pointIdFilterMap)?e.pointIdFilterMap[t]:t,i=this.view.computeMapPointFromVec3d(n),a=this._createGraphicAttributes(e,r);return new Ne({pointCloudMetadata:{nodeId:e.id,pointIndexInNode:t,attributePointIndexInNode:r,epoch:this._nodeLoadEpoch},geometry:i,attributes:a,layer:this.layer,sourceLayer:this.layer})}},{key:"_createGraphicAttributes",value:function(e,t){var n,r={},i=(0,m.Z)(e.attributes);try{for(i.s();!(n=i.n()).done;){var a=n.value;this._encodeGraphicAttribute(a.attributeInfo,a.values,t,r)}}catch(o){i.e(o)}finally{i.f()}return r}},{key:"_encodeGraphicAttribute",value:function(e,t,n,r){var i=e.storageInfo&&e.storageInfo.attributeValues,a=i?i.valuesPerElement:1;if(1===a)r[e.name]=t[n];else if("UInt8"===i.valueType&&a<=4){for(var o=0,s=n*a,u=s;u<s+a;u++)o=(o<<8)+t[u];r[e.name]=o}else r[e.name]=void 0}},{key:"_setPointsVisible",value:function(e){e&&!this._rendererAdded?(this.view._stage.addRenderPlugin([X.H.OPAQUE_MATERIAL],this._renderer),this._rendererAdded=!0):!e&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)}},{key:"_rendererChanged",value:function(){this._renderer.useFixedSizes=function(e){var t=e&&e.pointSizeAlgorithm;return!(!t||!t.type)&&"fixed-size"===t.type}(this.layer.renderer),this._reload()}},{key:"_reload",value:function(){this._clearNodeState(),this._memCache.clear(),this._setUpdateViewNeeded()}},{key:"_elevationOffsetChanged",value:function(){this._clearNodeState(),this._memCache.clear(),this._initNodePages()}},{key:"_scaleUpdateHandler",value:function(e){var t=this,n=this.layer.effectiveScaleRange;(0,ue.o)(n.minScale,n.maxScale)?(0,O.v)(e.extent,e.spatialReference,Xe,this.layer.spatialReference)&&(this._nodeScales.forEach((function(n,r){if(t._renderedNodes.has(r)){var i=t._index.getNode(r);(0,E.b)(Xe,i.obb.center)&&t._nodeScales.set(r,e.scale)}else t._nodeScales.delete(r)})),this._setUpdateViewNeeded()):this._nodeScales.clear()}},{key:"_displayNodes",value:function(e){this._workQueue=function(e,t,n){for(var r=0;r<t.length;r++)he[r]=!1,fe[r]=null;for(var i=0;i<e.length;i++)de[i]=!1,ce[i]=null;for(var a=0;a<t.length;a++){var o=pe(t[a],e,n);o>=0&&(he[a]=!0,null!=ce[o]?ce[o].push(t[a]):ce[o]=[t[a]])}for(var s=0;s<e.length;s++){var u=pe(e[s],t,n);u>=0&&(de[s]=!0,null!=fe[u]?fe[u].push(e[s]):fe[u]=[e[s]])}for(var l=[],d=0;d<e.length;d++)null!=ce[d]||de[d]||l.push({load:[],remove:[e[d]]});for(var c=0;c<t.length;c++)null!=fe[c]||he[c]||l.push({load:[t[c]],remove:[]});for(var h=0;h<t.length;h++)null!=fe[h]&&(fe[h].length>1||fe[h][0]!==t[h])&&l.push({load:[t[h]],remove:fe[h]});for(var f=0;f<e.length;f++)null!=ce[f]&&(ce[f].length>1||ce[f][0]!==e[f])&&l.push({load:ce[f],remove:[e[f]]});return l}((0,v.Z)(this._renderedNodes),e,this._index),function(e,t,n){e.sort((function(e,r){if(0===e.load.length&&0===r.load.length)return 0;if(0===e.load.length)return-1;if(0===r.load.length)return 1;if(0===e.remove.length&&0===r.remove.length){var i=n.getRenderCenter(e.load[0]),a=n.getRenderCenter(r.load[0]);return(0,R.P)(i,t)-(0,R.P)(a,t)}if(0===e.remove.length)return-1;if(0===r.remove.length)return 1;if(1===e.load.length&&1===r.load.length){var o=n.getRenderCenter(e.load[0]),s=n.getRenderCenter(r.load[0]);return(0,R.P)(o,t)-(0,R.P)(s,t)}if(1===e.load.length)return-1;if(1===r.load.length)return 1;var u=n.getRenderCenter(e.remove[0]),l=n.getRenderCenter(r.remove[0]);return(0,R.P)(u,t)-(0,R.P)(l,t)}))}(this._workQueue,this.view.state.contentCamera.viewForward,this._index),function(e,t,n){for(var r=0;r<e.length;++r){var i=e[r];i.load.length>t&&1===i.remove.length&&ve(e,i,n)}}(this._workQueue,8,this._index),this._updateQueues(),this._totalWork=this._computeWork(),this._updateLoading(),this._layerIsVisible=e.length>0||this._loadingInitNodePage,this.notifyChange("suspended")}},{key:"cancelLoading",value:function(){this._cancelNodeLoading(),this._cancelIndexLoading()}},{key:"_cancelNodeLoading",value:function(){var e=new Array;this._loadingNodes.forEach((function(t){var n=t.abortController;return e.push(n)})),this._loadingNodes.clear();for(var t=0,n=e;t<n.length;t++){n[t].abort()}this._workQueue=[],this._idleQueue.cancelAll(),this._totalWork=this._computeWork(),this._updateLoading()}},{key:"_updateQueues",value:function(){var e=this,t=new Set;this._workQueue.forEach((function(e){return e.load.forEach((function(e){return t.add(e)}))}));var n=new Array,r=new Map;this._loadingNodes.forEach((function(e,i){t.has(i)?r.set(i,e):n.push(e)})),this._loadingNodes=r;for(var i=0,a=n;i<a.length;i++){a[i].abortController.abort()}this._workQueue=this._workQueue.filter((function(t){var n,r=(0,m.Z)(t.load);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(e._loadingNodes.has(i))return e._recalcWork=!0,!1}}catch(a){r.e(a)}finally{r.f()}return!0})),this._totalWork=this._computeWork(),this._updateLoading()}},{key:"_cancelIndexLoading",value:function(){this._indexQueue=[],this._indexPagesLoading.forEach((function(e){return e.abortController.abort()})),this._indexPagesLoading.clear(),this._totalWork=this._computeWork(),this._updateLoading()}},{key:"_clearNodeState",value:function(){var e=this;this._nodeLoadEpoch++,this._renderedNodes.forEach((function(t){return e._removeFromRenderer(t)})),this._cancelNodeLoading()}},{key:"_idleBegin",value:function(){this._setUpdateViewNeeded()}},{key:"_idleEnd",value:function(){this._setUpdateViewNeeded()}},{key:"running",get:function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||this._indexQueue.length>0||this._workQueue.length>0||this._idleQueue.running}},{key:"runTask",value:function(e){var t=this;if(this.suspended){if(this._updateViewNeeded){this._updateViewNeeded=!1;var n=this._isRootNodeVisible();n!==this._layerIsVisible&&(this._layerIsVisible=n,this.notifyChange("suspended")),this._updateLoading()}}else{for(e.run((function(){return t._updateWorkQueues()}));this._indexQueue.length>0&&e.run((function(){return t._processIndexQueue()})););this._processWorkQueue(e),this._idleQueue.runTask(e)}}},{key:"_processIndexQueue",value:function(){var e=this,t=this._indexQueue.shift(),n=this._loadNodePage(t);return this._indexPagesLoading.set(t,n),n.promise.then((function(n){e._index.addPage(t,n,e._elevationOffset),e._setUpdateViewNeeded()})).then((function(){e._indexPagesLoading.delete(t)}),(function(){e._indexPagesLoading.delete(t)})),!0}},{key:"_processWorkQueue",value:function(e){for(;!e.done;){var t=this._scheduleWorkEntry();if((0,Z.t)(t))return;this._processWorkEntry(t),e.madeProgress()}}},{key:"_scheduleWorkEntry",value:function(){for(var e=this,t=this._workQueue.length;t--;){var n=this._workQueue.shift();if(!n.remove.find((function(t){return!e._renderedNodes.has(t)})))return n;this._workQueue.push(n)}return null}},{key:"_processWorkEntry",value:function(e){var t=this;if(0!==e.load.length)Promise.all(e.load.map((function(e){var n=new AbortController,r=t._memCache.pop(e.toString());return(0,Z.r)(r)?t._loadingNodes.set(e,{abortController:n,promise:Promise.resolve(r)}):t._loadingNodes.has(e)||t._loadingNodes.set(e,{abortController:n,promise:t._loadNode(e,n.signal)}),t._loadingNodes.get(e).promise}))).then((function(n){for(var r=0;r<e.load.length;r++)if(n[r]){var i=t._setupRendererData(e.load[r],n[r]);t._addToRenderer(i)}var a,o=(0,m.Z)(e.remove);try{for(o.s();!(a=o.n()).done;){var s=a.value;t._removeFromRenderer(s)}}catch(u){o.e(u)}finally{o.f()}})).catch((function(){})).then((function(){var n,r=(0,m.Z)(e.load);try{for(r.s();!(n=r.n()).done;){var i=n.value;t._loadingNodes.delete(i)}}catch(a){r.e(a)}finally{r.f()}t._updateLoading(),t._recalcWork&&!t._idleQueue.running&&0===t._indexQueue.length&&0===t._loadingNodes.size&&(t._recalcWork=!1,t._setUpdateViewNeeded())})),this._updateLoading();else{var n,r=(0,m.Z)(e.remove);try{for(r.s();!(n=r.n()).done;){var i=n.value;this._removeFromRenderer(i)}}catch(a){r.e(a)}finally{r.f()}}}},{key:"_populateClassCodeCodedDomain",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t,n){var r,i,a,o,s;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r="CLASS_CODE",(i=this.layer.fieldsIndex.get(r))&&!i.domain){e.next=3;break}return e.abrupt("return");case 3:if(t.includes(i.name)){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,(0,w.b)(this.layer.queryCachedStatistics(r,{signal:n}));case 7:if(!1!==(a=e.sent).ok){e.next=10;break}return e.abrupt("return");case 10:o=a.value,(s=o&&o.labels&&o.labels.labels)&&Array.isArray(s)&&(i.domain=new V.u({name:"CLASS_CODE",codedValues:s.map((function(e){return new V.p({code:e.value,name:e.label})}))}));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"prepareFetchPopupFeatures",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var n=this;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=new AbortController,this._codedDomainPopulationPromise=this._populateClassCodeCodedDomain(t,this._codedDomainPopulationAbortController.signal).then((function(){n._codedDomainPopulationAbortController=null}))),this._codedDomainPopulationPromise));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"whenGraphicAttributes",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t,n){var r,i,a,o,s,u=this;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._splitGraphicsPerNode(t),i=this.layer.attributeStorageInfo,a=n.map((function(e){return we(i,e)})),o=function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t,n){var r;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u._index.getNode(n),e.next=3,(0,w.c)(a,function(){var e=(0,p.Z)((0,f.Z)().mark((function e(n){var i,a,o,s,l;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.useElevation){e.next=6;break}return e.next=3,u._loadElevationAttributeFromGeometry(r.resourceId);case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,u._loadAndParseAttribute(r,n);case 8:e.t0=e.sent;case 9:if(i=e.t0){a=(0,m.Z)(t);try{for(a.s();!(o=a.n()).done;)s=o.value,u._isValidPointGraphic(s)&&(l=s.pointCloudMetadata.attributePointIndexInNode,u._encodeGraphicAttribute(n,i,l,s.attributes))}catch(d){a.e(d)}finally{a.f()}}case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),s=[],r.forEach((function(e,t){s.push(o(e,t))})),e.next=4,(0,P.E)(s);case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_isValidPointGraphic",value:function(e){return e instanceof Ne&&e.pointCloudMetadata&&e.pointCloudMetadata.epoch===this._nodeLoadEpoch}},{key:"_splitGraphicsPerNode",value:function(e){var t,n=new Map,r=(0,m.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(this._isValidPointGraphic(i)){var a=i.pointCloudMetadata,o=n.get(a.nodeId);o?o.push(i):n.set(a.nodeId,[i])}}}catch(s){r.e(s)}finally{r.f()}return n}},{key:"_loadAndParseAttribute",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t,n){var r;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._loadAttribute(t.resourceId,n,null);case 2:return r=e.sent,e.abrupt("return",(0,Z.r)(r)?(0,W.a)({attributeInfo:n,buffer:r},null,t.vertexCount):null);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_loadElevationAttributeFromGeometry",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var n,r;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.layer.store.defaultGeometrySchema,e.t0=W.c,e.t1=n,e.next=5,this._loadGeometry(t,null);case 5:return e.t2=e.sent,r=(0,e.t0)(e.t1,e.t2),e.abrupt("return",(0,W.d)(r,r.length/3));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"highlight",value:function(e){var t=this;if(!e)return{remove:function(){}};var n=N.j.isCollection(e)?e.toArray():Array.isArray(e)?e:[e];return this._renderer.highlight(n.map((function(e){return t._graphicToPointDefinition(e)})))}},{key:"_graphicToPointDefinition",value:function(e){if(!this._isValidPointGraphic(e))return null;var t=e.pointCloudMetadata,n=t.nodeId,r=t.pointIndexInNode;return null!=n&&null!=r?{nodeId:n,pointId:r}:null}},{key:"_computeWork",value:function(){var e,t=0,n=(0,m.Z)(this._workQueue);try{for(n.s();!(e=n.n()).done;){var r=e.value;t+=r.load.length+r.remove.length}}catch(i){n.e(i)}finally{n.f()}return t+=this._loadingNodes.size,t+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize,t+=this._loadingInitNodePage?100:0,t+=this._updateViewNeeded?100:0}},{key:"updatingProgressValue",get:function(){if(this.suspended)return this._updateViewNeeded?0:1;var e=this._computeWork();return 1-Math.min(this._totalWork,e)/this._totalWork}},{key:"_updateLoading",value:function(){this.notifyChange("updating"),this.notifyChange("updatingProgressValue")}},{key:"canResume",value:function(){return(0,g.Z)((0,_.Z)(n.prototype),"canResume",this).call(this)&&this._layerIsVisible}},{key:"isUpdating",value:function(){return this.suspended?this._updateViewNeeded:this._computeWork()>0}},{key:"_initNodePages",value:function(){var e=this,t=this.layer.store.index,n=t.nodesPerPage||t.nodePerIndexBlock;return this._index=new ge(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,n),this._cancelIndexLoading(),this._traverseVisible=this._index.createVisibilityTraverse(),this._loadingInitNodePage=!0,this._layerIsVisible=!0,this.notifyChange("suspended"),this._updateLoading(),this._pageMultiplier=null!=t.nodesPerPage?1:t.nodePerIndexBlock,this._loadNodePage(0).promise.then((function(t){e._index.addPage(0,t,e._elevationOffset),e._loadingInitNodePage=!1,e._setUpdateViewNeeded()}))}},{key:"_loadNodePage",value:function(e){var t=this,n=new AbortController,r="".concat(this.baseUrl,"/nodepages/").concat(e*this._pageMultiplier);return{promise:this._requestNodePage(r,n.signal).then((function(n){return n.nodes.map((function(n,r){return{resourceId:null!=n.resourceId?n.resourceId:e*t._index.pageSize+r,obb:n.obb,firstChild:n.firstChild,childCount:n.childCount,vertexCount:null!=n.vertexCount?n.vertexCount:n.pointCount,lodThreshold:null!=n.lodThreshold?n.lodThreshold:n.effectiveArea}}))})),abortController:n}}},{key:"_updateWorkQueues",value:function(){if(!this._updateViewNeeded)return!1;for(var e=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),t=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),n=this._computeNodesForMinimumDensity(e),r=this._computePointCount(n),i=Math.sqrt(r/(.75*t));r>t;)e*=i,n=this._computeNodesForMinimumDensity(e),r=this._computePointCount(n),i=Math.sqrt(2);return this._displayNodes(n),this._updateViewNeeded=!1,this._updateLoading(),!0}},{key:"_computePointCount",value:function(e){for(var t=0,n=0;n<e.length;n++){var r=this._index.getNode(e[n]);r&&(t+=r.vertexCount)}return t}},{key:"_getLodMemoryFactor",value:function(){return this.view.resourceController.memoryController.memoryFactor}},{key:"_isRootNodeVisible",value:function(){var e=!1;return this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:function(t,n,r){return e=r,!1},pageMiss:function(){}}),e}},{key:"_computeNodesForMinimumDensity",value:function(e){var t=this,n=this.view.state.contentCamera,r=n.frustum,i=this._clippingBox,a=n.viewForward,o=(0,R.P)(a,n.eye),s=(0,M.T)(a,-o,Ge),u=n.perScreenPixelRatio/2,l=e*e,d=this._nodeIdArray;d.length=0;var c=(0,ue.r)(this.layer),h=c.minScale,f=c.maxScale,p=0===h&&0===f?function(e){return d.push(e)}:function(e){var n=t._getScale(e);(0,ue.c)(n,h,f)&&d.push(e)};return this._traverseVisible({frustum:r,clippingBox:i},{predicate:function(e,n,r){if(!r)return!1;if(0===n.childCount)return p(e),!1;var i=t._index.getRenderObb(e);return!(t._computeAveragePixelArea(i,n.lodThreshold,n.vertexCount,s,u)<=l)||(p(e),!1)},pageMiss:function(e,n){p(e),t._indexQueue.includes(n)||t._indexQueue.push(n)}}),d}},{key:"_getScale",value:function(e){var t=this._nodeScales.get(e);if(null==t){var n=this._index.getNode(e).obb.center;this._tmpPoint.x=n[0],this._tmpPoint.y=n[1],this._tmpPoint.z=n[2],t=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(e,t)}return t}},{key:"_computeAveragePixelArea",value:function(e,t,n,r,i){var a=Math.max(1e-7,(0,Q.L)(e,r));return t/(a*a)/(4*i*i)/n}},{key:"_loadNode",value:function(e,t){try{return this._loadNodeAsync(e,t)}catch(n){throw(0,P.j)(n)||P.a.getLogger(this.declaredClass).error(n),n}}},{key:"_loadAdditionalUserAttributes",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t,n,r){var i,a,o,s,u,l,d,c,h,p;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer.outFields){e.next=3;break}return e.abrupt("return",[]);case 3:a=(0,D.v)(this.layer.fieldsIndex,i),o=new Set(t.map((function(e){return(0,Z.r)(e)?e.name:null}))),s=this.layer.attributeStorageInfo,u=[],l=(0,m.Z)(a),e.prev=5,l.s();case 7:if((d=l.n()).done){e.next=15;break}if(c=d.value,!o.has(c)){e.next=11;break}return e.abrupt("continue",13);case 11:(h=we(s,c))&&u.push(n(h));case 13:e.next=7;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),l.e(e.t0);case 20:return e.prev=20,l.f(),e.finish(20);case 23:return e.next=25,(0,P.ah)(u);case 25:return p=e.sent,e.abrupt("return",((0,P.f)(r),(0,Z.a6)(p,(function(e){return e}))));case 27:case"end":return e.stop()}}),e,this,[[5,17,20,23]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_loadNodeAsync",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t,n){var r,i,a,o,s,u=this;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._index.getNode(t),i=xe(this.layer),a=Se(this.layer),o=r.resourceId,s=function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t){var r;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,Z.t)(t)){e.next=2;break}return e.abrupt("return",null);case 2:if(!t.useElevation){e.next=4;break}return e.abrupt("return",{attributeInfo:t,buffer:null});case 4:return e.next=6,u._loadAttribute(o,t,n);case 6:return r=e.sent,e.abrupt("return",(0,Z.r)(r)?{attributeInfo:t,buffer:r}:null);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",this._idleQueue.push((0,p.Z)((0,f.Z)().mark((function e(){var r,l,d,c,p,g,_,y,m,b,x,S,k,w,N,Z;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u._loadGeometry(o,n),l=i.primaryAttribute,d=i.modulationAttribute,c=s(l),p=s(d),g=a.map((function(e){return e.attributeInfo})),_=g.map((function(e){return s(e)})),y=u._loadAdditionalUserAttributes([l,d].concat((0,v.Z)(g)),s,n),e.next=10,Promise.all([r,c,p,Promise.all(_),y]);case 10:return m=e.sent,b=(0,h.Z)(m,5),x=b[0],S=b[1],k=b[2],w=b[3],N=b[4],(0,P.f)(n),Z={geometryBuffer:x,primaryAttributeData:S,modulationAttributeData:k,filterAttributesData:w,userAttributesData:N,schema:u.layer.store.defaultGeometrySchema,rendererInfo:i,filterInfo:a,obb:u._index.getRenderObb(t),elevationOffset:u._elevationOffset,inSR:u.layer.spatialReference.toJSON(),outSR:u.view.renderCoordsHelper.spatialReference.toJSON()},e.abrupt("return",u._worker.invoke(Z,n));case 20:case"end":return e.stop()}}),e)}))),n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_loadGeometry",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t,n){return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._requestData("".concat(this.baseUrl,"/nodes/").concat(t,"/geometries/0"),n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_loadAttribute",value:function(){var e=(0,p.Z)((0,f.Z)().mark((function e(t,n,r){var i;return(0,f.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,Z.t)(n)&&n.storageInfo){e.next=2;break}return e.abrupt("return",null);case 2:return i=n.storageInfo.key,e.abrupt("return",this._requestData("".concat(this.baseUrl,"/nodes/").concat(t,"/attributes/").concat(i),r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_requestNodePage",value:function(e,t){var n={f:"json",token:this.layer.apiKey};return this._indexRequester.request(e,"json",{query:n,signal:t})}},{key:"_requestData",value:function(e,t){return this._dataRequester.request(e,"binary",{query:{token:this.layer.apiKey},signal:t})}},{key:"_removeFromRenderer",value:function(e){if(this._renderedNodes.has(e)){var t=this._renderer.removeNode(e);this._renderedNodes.delete(e),this._nodeScales.delete(e),this._memCache.put(t.id.toString(),t,function(e){return 5*e.coordinates.length+128}(t))}}},{key:"_addToRenderer",value:function(e){this._renderedNodes.has(e.id)||(this._renderedNodes.add(e.id),this._renderer.addNode(e))}},{key:"_setupRendererData",value:function(e,t){var n=this._index.getNode(e),r=Math.sqrt(n.lodThreshold/n.vertexCount),i=this._index.getRenderObb(e);if(function(e){return e.hasOwnProperty("splatSize")}(t))return t.splatSize=r,t.obb=i,(0,R.r)(t.origin,t.obb.center),t;var a=.01*Math.max(i.halfSize[0],i.halfSize[1],i.halfSize[2]);if(t.obb.halfSize[0]>i.halfSize[0]+a||t.obb.halfSize[1]>i.halfSize[1]+a||t.obb.halfSize[2]>i.halfSize[2]+a){if(this._maxLoggedBoxWarnings>0){var o=function(e){return"[".concat(e.halfSize[0],", ").concat(e.halfSize[1],", ").concat(e.halfSize[2],"]")};P.a.getLogger(this.declaredClass).warn("Node ".concat(e," reported bounding box too small. got ").concat(o(i)," but points cover ").concat(o(t.obb))),0==--this._maxLoggedBoxWarnings&&P.a.getLogger(this.declaredClass).warn("  Too many bounding box errors, stopping reporting for this layer.")}this._index.setRenderObb(e,t.obb)}return new He(e,r,(0,A.t)(i.center),i,0===n.childCount,t.points,t.rgb,t.attributes,t.pointIdFilterMap)}},{key:"getUsedMemory",value:function(){var e=0;return this._renderer.forEachNode((function(t){e+=Ke,e+=(0,Z.T)(t.coordinates);var n,r=(0,m.Z)(t.attributes);try{for(r.s();!(n=r.n()).done;){var i=n.value.values;(0,Z.R)(i.buffer)&&(e+=(0,Z.T)(i))}}catch(a){r.e(a)}finally{r.f()}})),e}},{key:"getUnloadedMemory",value:function(){var e=this,t=this._renderedNodes.size;if(t<4)return 0;for(var n=(0,v.Z)(this._renderedNodes).reduce((function(t,n){return t+e._index.getNode(n).vertexCount})),r=this._loadingNodes.size,i=0;i<this._workQueue.length;i++)r+=this._workQueue[i].load.length,r-=this._workQueue[i].remove.length;return r<0?0:r*n/t*((this.getUsedMemory()-t*Ke)/n)+r*Ke}},{key:"ignoresMemoryFactor",value:function(){return!1}},{key:"performanceInfo",get:function(){var e=this;return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:(0,v.Z)(this._renderedNodes).reduce((function(t,n){return t+e._index.getNode(n).vertexCount}),0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}},{key:"test",get:function(){return{index:this._index,visibleNodes:this._renderedNodes}}}]),n}((0,oe.c)((0,T.n)(se.u)));(0,P.e)([(0,P.y)()],je.prototype,"layer",void 0),(0,P.e)([(0,P.y)()],je.prototype,"baseUrl",null),(0,P.e)([(0,P.y)()],je.prototype,"pointScale",null),(0,P.e)([(0,P.y)()],je.prototype,"useRealWorldSymbolSizes",null),(0,P.e)([(0,P.y)()],je.prototype,"pointSize",null),(0,P.e)([(0,P.y)()],je.prototype,"inverseDensity",null),(0,P.e)([(0,P.y)()],je.prototype,"maximumPointCount",void 0),(0,P.e)([(0,P.y)({readOnly:!0})],je.prototype,"availableFields",null),(0,P.e)([(0,P.y)({readOnly:!0})],je.prototype,"_clippingBox",null),(0,P.e)([(0,P.y)({readOnly:!0})],je.prototype,"_elevationOffset",null),(0,P.e)([(0,P.y)({type:Boolean})],je.prototype,"slicePlaneEnabled",void 0),(0,P.e)([(0,P.y)()],je.prototype,"updating",void 0),(0,P.e)([(0,P.y)(J.t)],je.prototype,"updatingProgress",void 0),(0,P.e)([(0,P.y)({readOnly:!0})],je.prototype,"updatingProgressValue",null);var Je=je=(0,P.e)([(0,P.n)("esri.views.3d.layers.PointCloudLayerView3D")],je);var Xe=(0,E.u)(),Ke=160,Ye=Object.freeze({__proto__:null,default:Je})},72936:function(e,t,n){n.d(t,{c:function(){return v}});var r=n(93433),i=n(37762),a=n(74165),o=n(15861),s=n(15671),u=n(43144),l=n(60136),d=n(29388),c=n(48848),h=n(93661),f=n(59984),p=n(31303),v=function(e){var t=function(e){(0,l.Z)(n,e);var t=(0,d.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,u.Z)(n,[{key:"_validateFetchPopupFeatures",value:function(e){var t=this.layer;return t.popupEnabled?(0,p.s)(t,e)?void 0:new c.s("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new c.s("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t})}},{key:"prepareFetchPopupFeatures",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchPopupFeatures",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(t,n){var o,s,u,l,d,c,v,g,_,y;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=this._validateFetchPopupFeatures(n))){e.next=3;break}throw o;case 3:if((s=(0,h.r)(n)?n.clientGraphics:null)&&0!==s.length){e.next=6;break}return e.abrupt("return",[]);case 6:return u="scene"===this.layer.type&&(0,h.r)(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,e.t0=f.v,e.t1=this.layer.fieldsIndex,e.next=11,(0,p.d)(u,(0,p.s)(this.layer,n));case 11:return e.t2=e.sent,l=(0,e.t0)(e.t1,e.t2),e.next=15,this.prepareFetchPopupFeatures(l);case 15:d=new Set,c=[],v=[],g=(0,i.Z)(s);try{for(g.s();!(_=g.n()).done;)y=_.value,(0,f.g)(l,y,d)?v.push(y):c.push(y)}catch(t){g.e(t)}finally{g.f()}return e.abrupt("return",0===v.length?c:this.whenGraphicAttributes(v,(0,r.Z)(d)).catch((function(){return v})).then((function(e){return c.concat(e)})));case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(e);return t=(0,c.e)([(0,c.n)("esri.views.3d.layers.support.PopupSceneLayerView")],t)}},31303:function(e,t,n){n.d(t,{d:function(){return u},s:function(){return d}});var r=n(74165),i=n(93433),a=n(15861),o=n(93661),s=n(59984);function u(e){return l.apply(this,arguments)}function l(){return l=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,u,l,d,c,h,f,p,v=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=v.length>1&&void 0!==v[1]?v[1]:t.popupTemplate,!(0,o.t)(n)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,n.getRequiredFields(t.fieldsIndex);case 5:if(a=e.sent,u=n.lastEditInfoEnabled,l=t.objectIdField,d=t.typeIdField,c=t.globalIdField,h=t.relationships,!a.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!u){e.next=19;break}return e.next=16,(0,s.C)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return f=e.t0,p=(0,s.T)(t.fieldsIndex,[].concat((0,i.Z)(a),(0,i.Z)(f))),e.abrupt("return",(d&&p.push(d),p&&l&&t.fieldsIndex.has(l)&&!p.includes(l)&&p.push(l),p&&c&&t.fieldsIndex.has(c)&&!p.includes(c)&&p.push(c),h&&h.forEach((function(e){var n=e.keyField;p&&n&&t.fieldsIndex.has(n)&&!p.includes(n)&&p.push(n)})),p));case 23:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function d(e,t){return e.popupTemplate?e.popupTemplate:(0,o.r)(t)&&t.defaultPopupTemplateEnabled&&(0,o.r)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=2831.bde8999c.chunk.js.map