"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[1132],{61132:function(e,t,i){i.r(t),i.d(t,{D:function(){return we},n:function(){return F}});var n,a,r=i(74165),s=i(15861),o=i(1413),l=i(30168),u=i(15671),c=i(43144),d=i(60136),h=i(29388),v=i(48848),g=i(93661),_=i(19109),p=i(75016),y=i(8586),m=i(50690),f=i(71802),w=i(16933),b=i(74384),O=i(95249),P=i(47855),S=i(89794),L=(i(46737),i(77956)),z=i(29048),A=i(49228),M=i(91681),k=i(64772),E=i(28390),C=i(70381),V=i(94777),Z=i(43345),D=i(57791),T=i(93122),x=i(18668),G=i(65094),R=i(52113),j="esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController",N=v.a.getLogger(j),I=function(e){(0,d.Z)(i,e);var t=(0,h.Z)(i);function i(e){var n;return(0,u.Z)(this,i),(n=t.call(this,e))._unitNormalizer=new _.t,n._handles=new v.X,n._tempStartPosition=(0,f.n)(),n._tempEndPosition=(0,f.n)(),n._tempCornerPosition=(0,f.n)(),n}return(0,c.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.view.spatialReference,i=(0,P.c)(t),n=i===P.I?P.p:i;this._sphericalPCPF=n;var a=(0,O.A)(t,n);this._unitNormalizer.spatialReference=a?n:t,this._handles.add([(0,m.l)((function(){return{viewData:e.viewData,startPoint:e.analysis.startPoint}}),(function(t){var i=t.viewData,n=t.startPoint;i.elevationAlignedStartPoint=e._applyProjectionAndElevationAlignment(n)}),m.w),(0,m.l)((function(){return{viewData:e.viewData,endPoint:e.analysis.endPoint}}),(function(t){var i=t.viewData,n=t.endPoint;i.elevationAlignedEndPoint=e._applyProjectionAndElevationAlignment(n)}),m.w),(0,m.l)((function(){return{result:e._computedResult,viewData:e.viewData}}),(function(e){var t=e.result;e.viewData.result=t}),m.w)])}},{key:"destroy",value:function(){this._handles=(0,g.g)(this._handles)}},{key:"_applyProjectionAndElevationAlignment",value:function(e){if((0,g.t)(e))return e;var t=(0,p.d)(e,this.view.spatialReference,this.view.elevationProvider);return(0,g.t)(t)?((0,p.a)(this.analysis,e.spatialReference,N),null):t}},{key:"_computedResult",get:function(){var e=this.viewData,t=e.elevationAlignedStartPoint,i=e.elevationAlignedEndPoint,n=e.measurementMode;if((0,g.t)(t)||(0,g.t)(i))return null;var a=this._euclideanDistances(t,i),r=this._geodesicDistance(t,i,a.horizontal.value),s=n===_.e.Geodesic||n===_.e.Auto&&a.horizontal.value>1e5?"geodesic":"euclidean";return{mode:s,distance:"euclidean"===s?a.direct:r,directDistance:a.direct,horizontalDistance:a.horizontal,verticalDistance:a.vertical,geodesicDistance:r}}},{key:"_euclideanDistances",value:function(e,t){var i=this,n=e.clone();n.z=t.z;var a=this._tempStartPosition,r=this._tempEndPosition,s=this._tempCornerPosition,o=this.view.spatialReference,l=this._sphericalPCPF,u=(0,O.A)(o,l)?l:o;(0,O.g)(e,a,u),(0,O.g)(t,r,u),(0,O.g)(n,s,u);var c=(0,f.x)(a,r),d=(0,f.x)(s,r),h=Math.abs(t.z-e.z),v=function(e){return i._unitNormalizer.normalizeDistance(e)},g=v(c),_=v(d),p=v(h);return{direct:(0,y.r)(g,"meters"),horizontal:(0,y.r)(_,"meters"),vertical:(0,y.r)(p,"meters")}}},{key:"_geodesicDistance",value:function(e,t,i){var n=e.spatialReference,a=new b.m({spatialReference:n});a.addPath([e,t]);var r=n.isGeographic&&(0,_.M)(n)?(0,_.y)([a],"meters")[0]:n.isWebMercator?(0,w.geodesicLength)(a,"meters"):null,s=(0,g.r)(r)?r:this._fallbackGeodesicDistance(e,t,i);return(0,y.r)(s,"meters")}},{key:"_fallbackGeodesicDistance",value:function(e,t,i){if((0,O.y)(e,B)&&(0,O.y)(t,U)){var n=new _.v;return(0,_.b)(n,B,U),n.distance}return i}}]),i}(v.m);(0,v.e)([(0,v.y)()],I.prototype,"view",void 0),(0,v.e)([(0,v.y)()],I.prototype,"analysis",void 0),(0,v.e)([(0,v.y)()],I.prototype,"viewData",void 0),(0,v.e)([(0,v.y)()],I.prototype,"_computedResult",null),I=(0,v.e)([(0,v.n)(j)],I);var q,H,B=(0,f.n)(),U=(0,f.n)();function F(e){var t=new C.o,i=t.vertex,r=t.fragment;(0,C.T)(i,e),i.uniforms.add(new C.g("width",(function(e){return e.width}))),t.attributes.add(Z.O.POSITION,"vec3"),t.attributes.add(Z.O.NORMAL,"vec3"),t.attributes.add(Z.O.UV0,"vec2"),t.attributes.add(Z.O.AUXPOS1,"float"),t.varyings.add("vtc","vec2"),t.varyings.add("vlength","float"),t.varyings.add("vradius","float"),i.code.add((0,C.n)(n||(n=(0,l.Z)(["void main(void) {\nvec3 bitangent = normal;\nvtc = uv0;\nvlength = auxpos1;\nvradius = 0.5 * width;\nvec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);\ngl_Position = proj * pos;\n}"])))),r.uniforms.add([new C.g("outlineSize",(function(e){return e.outlineSize})),new C.f("outlineColor",(function(e){return e.outlineColor})),new C.g("stripeLength",(function(e){return e.stripeLength})),new C.f("stripeEvenColor",(function(e){return e.stripeEvenColor})),new C.f("stripeOddColor",(function(e){return e.stripeOddColor}))]);var s=1/Math.sqrt(2);return r.code.add((0,C.n)(a||(a=(0,l.Z)(["\n    const float INV_SQRT2 = ",";\n\n    vec4 arrowColor(vec2 tc, float len) {\n      float d = INV_SQRT2 * (tc.x - abs(tc.y));\n      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\n      d = min(d, 1.0 - abs(tc.y));\n\n      if (d < 0.0) {\n        return vec4(0.0);\n      } else if (d < outlineSize) {\n        return outlineColor;\n      } else {\n        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;\n      }\n    }\n\n    void main(void) {\n      vec2 ntc = vec2(vtc.x / vradius, vtc.y);\n      vec4 color = arrowColor(ntc, vlength / vradius);\n      if (color.a == 0.0) {\n        discard;\n      }\n      gl_FragColor = color;\n    }\n  "])),C.n.float(s))),t}!function(e){e[e.None=0]="None",e[e.Direct=1]="Direct",e[e.Triangle=2]="Triangle",e[e.ProjectedGeodesic=3]="ProjectedGeodesic"}(q||(q={})),function(e){e[e.Auto=0]="Auto",e[e.AboveSegment=1]="AboveSegment",e[e.BelowSegment=2]="BelowSegment"}(H||(H={}));var Q=Object.freeze(Object.defineProperty({__proto__:null,build:F},Symbol.toStringTag,{value:"Module"})),W=function(e){(0,d.Z)(i,e);var t=(0,h.Z)(i);function i(e,n,a){return(0,u.Z)(this,i),t.call(this,e,n,a)}return(0,c.Z)(i,[{key:"initializeProgram",value:function(e){return new C.l(e.rctx,i.shader.get().build(this.configuration),C.E)}},{key:"_setPipelineState",value:function(e){var t=e===D.o.NONE,i=this.configuration;return(0,D.W)({blending:i.transparent?t?D.d:(0,D.A)(e):null,polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:T.I.LESS},depthWrite:D.b,colorWrite:D._})}},{key:"initializePipeline",value:function(){return this._setPipelineState(this.configuration.transparencyPassType)}},{key:"primitiveType",get:function(){return T.E.TRIANGLE_STRIP}}]),i}(C.k);W.shader=new C.m(Q,(function(){return i.e(8761).then(i.bind(i,78761))}));var X=function(e){(0,d.Z)(i,e);var t=(0,h.Z)(i);function i(){var e;return(0,u.Z)(this,i),(e=t.apply(this,arguments)).polygonOffsetEnabled=!1,e.transparent=!1,e.transparencyPassType=D.o.NONE,e}return(0,c.Z)(i)}(C.J);(0,v.e)([(0,C.p)()],X.prototype,"polygonOffsetEnabled",void 0),(0,v.e)([(0,C.p)()],X.prototype,"transparent",void 0),(0,v.e)([(0,C.p)({count:D.o.COUNT})],X.prototype,"transparencyPassType",void 0);var J=function(e){(0,d.Z)(i,e);var t=(0,h.Z)(i);function i(e){var n;return(0,u.Z)(this,i),(n=t.call(this,e,new Y))._configuration=new X,n}return(0,c.Z)(i,[{key:"getConfiguration",value:function(e,t){return this._configuration.polygonOffsetEnabled=this.parameters.polygonOffset,this._configuration.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration}},{key:"dispose",value:function(){}},{key:"intersect",value:function(){}},{key:"requiresSlot",value:function(e,t){return t===C.O.Color&&e===C.H.OPAQUE_MATERIAL}},{key:"createGLMaterial",value:function(e){return new K(e)}},{key:"createBufferWriter",value:function(){return new re}}]),i}(C.aa),K=function(e){(0,d.Z)(i,e);var t=(0,h.Z)(i);function i(){return(0,u.Z)(this,i),t.apply(this,arguments)}return(0,c.Z)(i,[{key:"beginSlot",value:function(e){return this.ensureTechnique(W,e)}}]),i}(C.aq),Y=function(e){(0,d.Z)(i,e);var t=(0,h.Z)(i);function i(){var e;return(0,u.Z)(this,i),(e=t.apply(this,arguments)).width=32,e.outlineSize=.2,e.outlineColor=(0,M.r)(1,.5,0,1),e.stripeEvenColor=(0,M.r)(1,1,1,1),e.stripeOddColor=(0,M.r)(1,.5,0,1),e.stripeLength=1,e.polygonOffset=!1,e}return(0,c.Z)(i)}(C.ar),$=(0,V.T)().vec3f(Z.O.POSITION).vec3f(Z.O.NORMAL).vec2f(Z.O.UV0).f32(Z.O.AUXPOS1),ee=(0,f.n)(),te=(0,f.n)(),ie=(0,f.n)(),ne=(0,f.n)(),ae=(0,f.n)(),re=function(){function e(){(0,u.Z)(this,e),this.vertexBufferLayout=$}return(0,c.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return 2*(e.indices.get(Z.O.POSITION).length/2+1)}},{key:"write",value:function(e,t,i,n,a){var r=i.vertexAttributes.get(Z.O.POSITION).data,s=i.vertexAttributes.get(Z.O.NORMAL).data,o=r.length/3,l=i&&i.indices&&i.indices.get(Z.O.POSITION);l&&l.length!==2*(o-1)&&console.warn("MeasurementArrowMaterial does not support indices");for(var u=ee,c=te,d=ie,h=ne,v=ae,g=n.position,_=n.normal,p=n.uv0,y=0,m=0;m<o;++m){var w=3*m;if((0,f.o)(u,r[w],r[w+1],r[w+2]),m<o-1){var b=3*(m+1);(0,f.o)(c,r[b],r[b+1],r[b+2]),(0,f.o)(v,s[b],s[b+1],s[b+2]),(0,f.z)(v,v),(0,f.e)(d,c,u),(0,f.z)(d,d),(0,f._)(h,v,d),(0,f.z)(h,h)}var O=(0,f.x)(u,c);e&&t&&((0,f.O)(u,u,e),(0,f.O)(c,c,e),(0,f.O)(h,h,t));var P=a+2*m,S=P+1;g.setVec(P,u),g.setVec(S,u),_.setVec(P,h),_.setVec(S,h),p.set(P,0,y),p.set(P,1,-1),p.set(S,0,y),p.set(S,1,1),m<o-1&&(y+=O)}for(var L=n.auxpos1,z=0;z<2*o;++z)L.set(a+z,y)}}]),e}(),se=function(e){(0,d.Z)(i,e);var t=(0,h.Z)(i);function i(e){var n;return(0,u.Z)(this,i),(n=t.call(this,e))._parameters={arrowWidth:16,arrowOutlineColor:S.l.toUnitRGBA((0,_.i)()),arrowStripeEvenColor:S.l.toUnitRGBA((0,_.u)()),arrowStripeOddColor:S.l.toUnitRGBA((0,_.i)()),arrowSubdivisions:128},n._handles=null,n._origin=(0,f.n)(),n._originTransform=(0,A.e)(),n._arrowCenter=(0,f.n)(),n._renderOccluded=C.ah.OccludeAndTransparent,n._geometry=null,n._stripeLength=1,n._stripesEnabled=!0,n._opacity=1,n.applyProps(e),n}return(0,c.Z)(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:e}))}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this._geometryChanged()}},{key:"stripeLength",get:function(){return this._stripeLength},set:function(e){this._stripeLength=e,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}},{key:"stripesEnabled",get:function(){return this._stripesEnabled},set:function(e){if(this._stripesEnabled=e,this.attached){var t=this.opacity,i=this._parameters,n=i.arrowStripeEvenColor,a=i.arrowStripeOddColor,r=(0,f.an)(oe,this._stripesEnabled?n:a,t);this._arrowMaterial.setParameters({stripeEvenColor:r})}}},{key:"opacity",get:function(){return this._opacity},set:function(e){e!==this._opacity&&(this._opacity=e,this._updateArrowOpacity())}},{key:"createExternalResources",value:function(){var e=this,t=this._parameters,i=t.arrowStripeEvenColor,n=t.arrowStripeOddColor,a=t.arrowOutlineColor,r=this._stripesEnabled?i:n;this._arrowMaterial=new J({outlineColor:a,stripeEvenColor:r,stripeOddColor:n,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new v.X,this._handles.add((0,m.l)((function(){return e.view.state.camera}),(function(){e._viewChanged()})))}},{key:"destroyExternalResources",value:function(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}},{key:"forEachExternalMaterial",value:function(e){e(this._arrowMaterial)}},{key:"createGeometries",value:function(e){if(!((0,g.t)(this._geometry)||(0,g.t)(this._geometry.startRenderSpace)||(0,g.t)(this._geometry.endRenderSpace))){var t=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);e.addGeometry(t,this._arrowMaterial,this._originTransform),this._viewChanged()}}},{key:"_createArrowGeometry",value:function(e,t,i,n){var a=this.view.renderCoordsHelper,r=[],s=[],o=function(e,t){var n=k.c.get();(0,f.e)(n,e,i),r.push(n),s.push(t)};if("euclidean"===n.type){n.eval(.5,this._arrowCenter);var l=k.c.get();a.worldUpAtPosition(this._arrowCenter,l),o(e,l),o(t,l)}else{n.eval(.5,this._arrowCenter);for(var u=this._parameters.arrowSubdivisions+1&-2,c=0;c<u;++c){var d=c/(u-1),h=k.c.get(),v=k.c.get();n.eval(d,h),a.worldUpAtPosition(h,v),o(h,v)}}return(0,E.ab)(r,s)}},{key:"_geometryChanged",value:function(){this.recreateGeometry()}},{key:"_viewChanged",value:function(){if(this.view.ready&&this.attached&&(0,g.r)(this._geometry)){var e=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*e})}}},{key:"_updateArrowOpacity",value:function(){var e=this.opacity,t=this._parameters,i=t.arrowStripeEvenColor,n=t.arrowStripeOddColor,a=t.arrowOutlineColor,r=(0,f.an)(oe,this._stripesEnabled?i:n,e),s=(0,f.an)(le,a,e),o=(0,f.an)(ue,n,e);this._arrowMaterial.setParameters({stripeEvenColor:r,outlineColor:s,stripeOddColor:o})}}]),i}(p.n),oe=(0,M.n)(),le=(0,M.n)(),ue=(0,M.n)(),ce=function(e){(0,d.Z)(i,e);var t=(0,h.Z)(i);function i(e){var n;return(0,u.Z)(this,i),(n=t.call(this,e))._params={triangleColor:new Float32Array(S.l.toUnitRGBA((0,_.i)(.75))),triangleLineWidth:3,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:new Float32Array(S.l.toUnitRGBA((0,_.i)(.75))),guideLineWidth:2,guideStippleLengthPixels:6,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},n._handles=new v.X,n._segmentVisualElement=null,n._triangleVisualElement=null,n._rightAngleQuad=null,n._projectedGeodesicLine=null,n._geodesicStartHint=null,n._geodesicEndHint=null,n._segmentLabel=null,n._verticalLabel=null,n._horizontalLabel=null,n._startPosition=(0,f.n)(),n._endPosition=(0,f.n)(),n._cornerPosition=(0,f.n)(),n._startPositionAtSeaLevel=(0,f.n)(),n._endPositionAtSeaLevel=(0,f.n)(),n._triangleOrientationOverride=null,n.messages=null,n.loadingMessages=!0,n.visualElementOrientation=H.Auto,n.triangleCollapseRatioThreshold=.03,n}return(0,c.Z)(i,[{key:"visible",get:function(){return this.analysisView.visible}},{key:"viewMode",get:function(){var e=this.analysisView,t=e.elevationAlignedStartPoint,i=e.elevationAlignedEndPoint;if((0,g.t)(t)||(0,g.t)(i)||t.equals(i))return q.None;var n=this.analysisView.result;if((0,g.t)(n))return q.Direct;if("geodesic"===n.mode)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?q.ProjectedGeodesic:q.Direct;var a=n.verticalDistance,r=n.horizontalDistance,s=a.value,o=r.value;return Math.min(s/o,o/s)<this.triangleCollapseRatioThreshold?q.Direct:q.Triangle}},{key:"actualVisualizedMeasurement",get:function(){if((0,g.t)(this.analysisView.result))switch(this.analysisView.measurementMode){case _.e.Auto:case _.e.Euclidean:default:return"euclidean";case _.e.Geodesic:return"geodesic"}return this.analysisView.result.mode}},{key:"allowVisualElementsOrientationChange",get:function(){return(0,g.t)(this._triangleOrientationOverride)},set:function(e){(0,g.t)(this._triangleOrientationOverride)!==e&&((0,g.t)(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}},{key:"labels",get:function(){var e="geodesic"===this.actualVisualizedMeasurement;return{direct:this._segmentLabel,horizontal:e?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}},{key:"initialize",value:function(){var e=this,t=this._params,i={attached:!0,view:this.view};this._segmentVisualElement=new se((0,o.Z)((0,o.Z)({},i),{},{geometry:null,renderOccluded:C.ah.OccludeAndTransparent})),this._triangleVisualElement=new p.c((0,o.Z)((0,o.Z)({},i),{},{width:t.triangleLineWidth,color:t.triangleColor,renderOccluded:C.ah.OccludeAndTransparent})),this._rightAngleQuad=new x.S((0,o.Z)((0,o.Z)({},i),{},{color:new Float32Array(S.l.toUnitRGBA((0,_.i)(.75))),renderOccluded:C.ah.OccludeAndTransparent}));var n=(0,o.Z)((0,o.Z)({},i),{},{polygonOffset:!0,renderOccluded:C.ah.OccludeAndTransparent});this._projectedGeodesicLine=new p.c((0,o.Z)((0,o.Z)({},n),{},{width:t.geodesicProjectionLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:(0,E.a5)(t.guideStippleLengthPixels)})),this._geodesicStartHint=new p.c((0,o.Z)((0,o.Z)({},n),{},{width:t.guideLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:(0,E.a5)(t.guideStippleLengthPixels)})),this._geodesicEndHint=new p.c((0,o.Z)((0,o.Z)({},n),{},{width:t.guideLineWidth,color:t.geodesicProjectionLineColor,stipplePattern:(0,E.a5)(t.guideStippleLengthPixels)}));var a=(0,o.Z)((0,o.Z)({},i),{},{backgroundColor:(0,_.s)(.6),textColor:(0,_.a)()});this._segmentLabel=new y.g((0,o.Z)((0,o.Z)({},a),{},{fontSize:t.direcLabelFontSize})),this._verticalLabel=new y.g((0,o.Z)((0,o.Z)({},a),{},{fontSize:t.verticalLabelFontSize})),this._horizontalLabel=new y.g((0,o.Z)((0,o.Z)({},a),{},{fontSize:t.horizontalLabelFontSize})),this._handles.add([(0,m.l)((function(){var t=e.analysisView,i=t.elevationAlignedStartPoint,n=t.elevationAlignedEndPoint,a=e.view;return{view:a,camera:a.state.camera,viewMode:e.viewMode,elevationAlignedStartPoint:i,elevationAlignedEndPoint:n,orientation:e._actualVisualElementsOrientation,visualizedMeasurement:e.actualVisualizedMeasurement,stripeLength:e._measurementArrowStripeLength}}),(function(t){return e._updateGeometryAndViewMode(t)}),m.w),(0,m.l)((function(){return{visible:e.visible,viewMode:e.viewMode}}),(function(t){return e._updateVisualElementVisibility(t)}),m.w),(0,m.l)((function(){return{text:e._labelsText,visualizedMeasurement:e.actualVisualizedMeasurement}}),(function(t){return e._updateLabelText(t)}),m.w),(0,m.l)((function(){return{visible:e.visible,viewMode:e.viewMode}}),(function(t){return e._updateLabelVisibility(t)}),m.w),(0,m.l)((function(){return e._measurementArrowStripeLength}),(function(t){return e._updateSegmentStripeLength(t)}),m.w),(0,G.s)((0,s.Z)((0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._updateMessageBundle());case 1:case"end":return t.stop()}}),t)}))))]),this._updateMessageBundle()}},{key:"destroy",value:function(){this._handles=(0,g.g)(this._handles),this._segmentVisualElement=(0,g.g)(this._segmentVisualElement),this._triangleVisualElement=(0,g.g)(this._triangleVisualElement),this._rightAngleQuad=(0,g.g)(this._rightAngleQuad),this._projectedGeodesicLine=(0,g.g)(this._projectedGeodesicLine),this._geodesicStartHint=(0,g.g)(this._geodesicStartHint),this._geodesicEndHint=(0,g.g)(this._geodesicEndHint),this._segmentLabel=(0,g.g)(this._segmentLabel),this._verticalLabel=(0,g.g)(this._verticalLabel),this._horizontalLabel=(0,g.g)(this._horizontalLabel),this.set("view",null)}},{key:"_updateVisualElementVisibility",value:function(e){var t=e.visible,i=e.viewMode;if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,t)switch(i){case q.None:break;case q.Direct:this._segmentVisualElement.visible=!0;break;case q.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case q.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}},{key:"_updateGeometryAndViewMode",value:function(e){var t=e.view,i=e.camera,n=e.viewMode,a=e.elevationAlignedStartPoint,r=e.elevationAlignedEndPoint,s=e.orientation,o=e.visualizedMeasurement,l=e.stripeLength,u=t.renderCoordsHelper;if(!((0,g.t)(u)||(0,g.t)(a)||(0,g.t)(r)||a.equals(r))){var c=this._startPosition,d=this._endPosition;u.toRenderCoords(a,c),u.toRenderCoords(r,d);var h=s===H.AboveSegment?1:-1,v=h*(u.getAltitude(d)-u.getAltitude(c));v<0&&(c=this._endPosition,d=this._startPosition);var _="geodesic"===o?new y.m(this._startPosition,this._endPosition,u.spatialReference):new y.l(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=_,this._updateSegmentStripeLength(l),n){case q.Direct:this._updateSegment(_,s);break;case q.Triangle:this._updateSegmentAndTriangle({view:t,camera:i,segment:_,orientation:s,startPosition:c,endPosition:d,deltaSign:h,altitudeDelta:v});break;case q.ProjectedGeodesic:this._updateSegmentAndProjection({view:t,orientation:s,startPosition:c,endPosition:d})}}}},{key:"_updateSegment",value:function(e,t){this._segmentLabel.anchor=t===H.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}},{key:"_updateSegmentAndTriangle",value:function(e){var t=e.view.renderCoordsHelper,i=e.camera,n=e.segment,a=e.orientation,r=e.startPosition,s=e.endPosition,o=e.deltaSign,l=e.altitudeDelta,u=this._cornerPosition;t.worldUpAtPosition(r,u),(0,f.g)(u,u,o*Math.abs(l)),(0,f.u)(u,u,r),this._triangleVisualElement.geometry=[[[r[0],r[1],r[2]],[u[0],u[1],u[2]],[s[0],s[1],s[2]]]],this._rightAngleQuad.geometry={previous:r,center:u,next:s};var c=new y.l(r,u),d=new y.l(u,s),h=de(r,s,u,a,i);this._segmentLabel.anchor=h.segment,this._segmentLabel.geometry={type:"segment",segment:n,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:c,sampleLocation:"center"},this._verticalLabel.anchor=h.vertical,this._horizontalLabel.geometry={type:"segment",segment:d,sampleLocation:"center"},this._horizontalLabel.anchor=h.horizontal}},{key:"_updateSegmentAndProjection",value:function(e){var t=e.view.renderCoordsHelper,i=e.orientation,n=e.startPosition,a=e.endPosition;t.setAltitude(this._startPositionAtSeaLevel,0,n),t.setAltitude(this._endPositionAtSeaLevel,0,a);var r=new y.m(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,t.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(r),this._geodesicStartHint.setGeometryFromSegment(new y.l(this._startPositionAtSeaLevel,n)),this._geodesicEndHint.setGeometryFromSegment(new y.l(this._endPositionAtSeaLevel,a)),this._segmentLabel.geometry={type:"segment",segment:r,sampleLocation:"center"},this._segmentLabel.anchor=i===H.AboveSegment?"top":"bottom"}},{key:"_updateLabelText",value:function(e){var t=e.text,i=e.visualizedMeasurement;(0,g.r)(t)?(this._segmentLabel.text="euclidean"===i?t.euclideanDistance:t.geodesicDistance,this._horizontalLabel.text=t.horizontalDistance,this._verticalLabel.text=t.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}},{key:"_updateLabelVisibility",value:function(e){var t=e.visible,i=e.viewMode,n=this._segmentLabel,a=this._horizontalLabel,r=this._verticalLabel;if(n.visible=!1,a.visible=!1,r.visible=!1,t)switch(i){case q.Direct:n.visible=!0;break;case q.Triangle:n.visible=!0,a.visible=!0,r.visible=!0;break;case q.ProjectedGeodesic:n.visible=!0}}},{key:"_labelsText",get:function(){if(this.destroyed)return null;var e=this.messages,t=this.analysisView.result;if((0,g.t)(t)||(0,g.t)(e))return null;var i=t.directDistance,n=t.horizontalDistance,a=t.verticalDistance,r=t.geodesicDistance,s=this.analysisView.unit,l=function(e){return(0,o.Z)({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:""},e)};switch(s){case"metric":return l({euclideanDistance:i&&(0,y.M)(e,i),geodesicDistance:r&&(0,y.M)(e,r),horizontalDistance:n&&(0,y.M)(e,n),verticalDistance:a&&(0,y.w)(e,a)});case"imperial":return l({euclideanDistance:i&&(0,y.y)(e,i),geodesicDistance:r&&(0,y.y)(e,r),horizontalDistance:n&&(0,y.y)(e,n),verticalDistance:a&&(0,y.j)(e,a)});default:return l({euclideanDistance:i&&(0,y.b)(e,i,s),geodesicDistance:r&&(0,y.b)(e,r,s),horizontalDistance:n&&(0,y.b)(e,n,s),verticalDistance:a&&(0,y.b)(e,a,s)})}}},{key:"_updateSegmentStripeLength",value:function(e){var t=this._segmentVisualElement;(0,g.r)(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}},{key:"_actualVisualElementsOrientation",get:function(){if((0,g.r)(this._triangleOrientationOverride))return this._triangleOrientationOverride;var e=this.visualElementOrientation;return e===H.Auto?this.view.state.camera.aboveGround?H.AboveSegment:H.BelowSegment:e}},{key:"_requiresGeodesicGuideAt",value:function(e){var t=this.view;if(null===t||void 0===t||!t.state)return!1;var i=t.state.camera,n=t.renderCoordsHelper,a=i.computeScreenPixelSizeAt(e);return n.getAltitude(e)/a>=10}},{key:"_measurementArrowStripeLength",get:function(){var e=this.analysisView,t=e.result,i=e.unit;if((0,g.t)(t))return null;var n=null,a=t.directDistance;switch(i){case"metric":n=a&&(0,y.v)(a,"meters");break;case"imperial":n=a&&(0,y.v)(a,(0,P.K)(a.value,a.unit));break;default:n=a&&(0,y.v)(a,i)}return(0,g.t)(n)?null:(0,f.am)(n.value/30)*(0,P.a)(1,n.unit,"meters")}},{key:"_updateMessageBundle",value:function(){var e=this;this.loadingMessages=!0,(0,R.u)("esri/core/t9n/Units").then((function(t){e.messages=t})).finally((function(){e.loadingMessages=!1}))}},{key:"testData",get:function(){var e;return{labels:this.labels,stripeLength:null===(e=this._segmentVisualElement)||void 0===e?void 0:e.stripeLength}}}]),i}(v.m);function de(e,t,i,n,a){var r=ve,s=ge;a.projectToRenderScreen(i,r),a.projectToRenderScreen(t,s);var o={segment:"bottom",horizontal:"top",vertical:r[0]<s[0]?"left":"right"},l=_e,u=pe;if((0,_.f)(e,i,l,a),(0,_.f)(e,t,u,a),(0,z.j)(l,u)>=he){var c=Math.sign(l[1])===Math.sign(u[1]);o.segment=c?(0,y.I)(o.vertical):o.vertical}else{var d=ye;(0,_.f)(i,t,d,a),(0,z.j)(d,u)>=he&&(o.segment=Math.sign(d[0])===Math.sign(u[0])?(0,y.I)(o.horizontal):o.horizontal)}if(n===H.BelowSegment){var h=function(e){return"top"===e?"bottom":"top"};o.segment=h(o.segment),o.horizontal=h(o.horizontal),o.vertical=h(o.vertical)}return o}(0,v.e)([(0,v.y)()],ce.prototype,"_triangleOrientationOverride",void 0),(0,v.e)([(0,v.y)()],ce.prototype,"messages",void 0),(0,v.e)([(0,v.y)()],ce.prototype,"view",void 0),(0,v.e)([(0,v.y)()],ce.prototype,"analysis",void 0),(0,v.e)([(0,v.y)()],ce.prototype,"analysisView",void 0),(0,v.e)([(0,v.y)()],ce.prototype,"loadingMessages",void 0),(0,v.e)([(0,v.y)()],ce.prototype,"visible",null),(0,v.e)([(0,v.y)()],ce.prototype,"viewMode",null),(0,v.e)([(0,v.y)()],ce.prototype,"actualVisualizedMeasurement",null),(0,v.e)([(0,v.y)()],ce.prototype,"visualElementOrientation",void 0),(0,v.e)([(0,v.y)()],ce.prototype,"triangleCollapseRatioThreshold",void 0),(0,v.e)([(0,v.y)()],ce.prototype,"allowVisualElementsOrientationChange",null),(0,v.e)([(0,v.y)()],ce.prototype,"labels",null),(0,v.e)([(0,v.y)()],ce.prototype,"_labelsText",null),(0,v.e)([(0,v.y)()],ce.prototype,"_actualVisualElementsOrientation",null),(0,v.e)([(0,v.y)()],ce.prototype,"_measurementArrowStripeLength",null),ce=(0,v.e)([(0,v.n)("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],ce);var he=Math.cos((0,f.m)(12)),ve=(0,L.x)(),ge=(0,L.x)(),_e=(0,L.s)(),pe=(0,L.s)(),ye=(0,L.s)(),me=function(e){(0,d.Z)(i,e);var t=(0,h.Z)(i);function i(e){var n;return(0,u.Z)(this,i),(n=t.call(this,e)).type="direct-line-measurement-view-3d",n.analysis=null,n.result=null,n.measurementMode=_.e.Auto,n.elevationAlignedStartPoint=null,n.elevationAlignedEndPoint=null,n}return(0,c.Z)(i,[{key:"initialize",value:function(){var e=this.view,t=this.analysis;this._analysisVisualization=new ce({view:e,analysis:t,analysisView:this}),this._analysisController=new I({view:e,analysis:t,viewData:this})}},{key:"destroy",value:function(){this._analysisController=(0,g.g)(this._analysisController),this._analysisVisualization=(0,g.g)(this._analysisVisualization)}},{key:"updating",get:function(){var e;return!(null===(e=this._analysisVisualization)||void 0===e||!e.loadingMessages)}},{key:"viewMode",get:function(){return this._analysisVisualization.viewMode}},{key:"actualVisualizedMeasurement",get:function(){return this._analysisVisualization.actualVisualizedMeasurement}},{key:"visualElementOrientation",get:function(){return this._analysisVisualization.visualElementOrientation},set:function(e){this._analysisVisualization.visualElementOrientation=e}},{key:"allowVisualElementsOrientationChange",get:function(){return this._analysisVisualization.allowVisualElementsOrientationChange},set:function(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}},{key:"triangleCollapseRatioThreshold",get:function(){return this._analysisVisualization.triangleCollapseRatioThreshold},set:function(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}},{key:"directLabelText",get:function(){return this._analysisVisualization.labels.direct.text}},{key:"horizontalLabelText",get:function(){return this._analysisVisualization.labels.horizontal.text}},{key:"verticalLabelText",get:function(){return this._analysisVisualization.labels.vertical.text}},{key:"unit",get:function(){return(0,g.v)(this.analysis.unit,this._defaultUnit)}},{key:"testData",get:function(){var e;return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:(0,o.Z)((0,o.Z)({},null===(e=this._analysisVisualization)||void 0===e?void 0:e.testData),{},{visualization:this._analysisVisualization,controller:this._analysisController})}}]),i}((0,p.b)(v.m));(0,v.e)([(0,v.y)()],me.prototype,"updating",null),(0,v.e)([(0,v.y)({readOnly:!0})],me.prototype,"type",void 0),(0,v.e)([(0,v.y)({constructOnly:!0,nonNullable:!0})],me.prototype,"analysis",void 0),(0,v.e)([(0,v.y)()],me.prototype,"result",void 0),(0,v.e)([(0,v.y)()],me.prototype,"measurementMode",void 0),(0,v.e)([(0,v.y)()],me.prototype,"elevationAlignedStartPoint",void 0),(0,v.e)([(0,v.y)()],me.prototype,"elevationAlignedEndPoint",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],me.prototype,"viewMode",null),(0,v.e)([(0,v.y)({readOnly:!0})],me.prototype,"actualVisualizedMeasurement",null),(0,v.e)([(0,v.y)()],me.prototype,"visualElementOrientation",null),(0,v.e)([(0,v.y)()],me.prototype,"allowVisualElementsOrientationChange",null),(0,v.e)([(0,v.y)()],me.prototype,"triangleCollapseRatioThreshold",null),(0,v.e)([(0,v.y)({readOnly:!0})],me.prototype,"directLabelText",null),(0,v.e)([(0,v.y)({readOnly:!0})],me.prototype,"horizontalLabelText",null),(0,v.e)([(0,v.y)({readOnly:!0})],me.prototype,"verticalLabelText",null),(0,v.e)([(0,v.y)()],me.prototype,"_analysisVisualization",void 0),(0,v.e)([(0,v.y)()],me.prototype,"_analysisController",void 0),(0,v.e)([(0,v.y)()],me.prototype,"unit",null),(0,v.e)([(0,v.y)(_.r)],me.prototype,"_defaultUnit",void 0);var fe=me=(0,v.e)([(0,v.n)("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],me),we=Object.freeze({__proto__:null,default:fe})},18668:function(e,t,i){i.d(t,{S:function(){return w}});var n=i(93433),a=i(15671),r=i(43144),s=i(60136),o=i(29388),l=i(48848),u=i(93661),c=i(50690),d=i(79557),h=i(49228),v=i(71802),g=i(1797),_=i(64772),p=i(75016),y=i(70381),m=i(28390),f=i(43345),w=function(e){(0,s.Z)(i,e);var t=(0,o.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._handles=new l.X,n._quadMaterial=null,n._outlineMaterial=null,n._maxSize=0,n._position=(0,v.n)(),n._up=(0,v.n)(),n._right=(0,v.n)(),n._renderOccluded=y.ah.OccludeAndTransparent,n._color=(0,g.r)(1,0,0,1),n._outlineColor=(0,g.r)(0,0,0,1),n._outlineSize=0,n._size=32,n._outlineRenderOccluded=y.ah.Opaque,n.applyProps(e),n}return(0,r.Z)(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,v.B)(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,v.B)(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){var t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function(e){var t=e.previous,i=e.center,n=e.next;this._maxSize=Math.min((0,v.x)(i,t),(0,v.x)(i,n))/3,(0,v.z)(this._up,(0,v.e)(this._up,t,i)),(0,v.z)(this._right,(0,v.e)(this._right,n,i)),(0,v.r)(this._position,i),this.recreateGeometry()}},{key:"createExternalResources",value:function(){var e=this;this._quadMaterial=new m.al(this._quadMaterialParameters),this._outlineMaterial=new m.a7(this._outlineMaterialParameters),this._handles.add((0,c.l)((function(){return e.view.state.camera}),(function(){return e._updateTransform()})))}},{key:"destroyExternalResources",value:function(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}},{key:"forEachExternalMaterial",value:function(e){e(this._quadMaterial),e(this._outlineMaterial)}},{key:"createGeometries",value:function(e){(0,v.F)(this._up,v.a7)&&(0,v.F)(this._right,v.a7)||(this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e))}},{key:"_createQuadGeometry",value:function(e){var t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}},{key:"_createOutlineGeometry",value:function(e){if(0!==this._outlineSize){var t=(0,v.u)(_.c.get(),this._up,this._right),i=(0,m.ab)([this._up,t,this._right]);e.addGeometry(i,this._outlineMaterial)}}},{key:"_updateTransform",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object,t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),n=Math.min(this._maxSize,i);(0,d.x)(b,this._position),(0,d.i)(b,b,[n,n,n]),(0,u.r)(e)&&(e.transformation=b)}},{key:"_quadGeometryData",value:function(e,t){var i=(0,v.u)(_.c.get(),e,t);return new y.M([[f.O.POSITION,{size:3,data:[0,0,0].concat((0,n.Z)(t),(0,n.Z)(e),(0,n.Z)(i)),exclusive:!0}]],[[f.O.POSITION,[0,1,2,1,2,3]]])}},{key:"_quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"_updateQuadMaterial",value:function(){this._quadMaterial&&this._quadMaterial.setParameters(this._quadMaterialParameters)}},{key:"_outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}},{key:"_updateOutlineMaterial",value:function(){this._outlineMaterial&&this._outlineMaterial.setParameters(this._outlineMaterialParameters)}}]),i}(p.n),b=(0,h.e)()}}]);
//# sourceMappingURL=1132.08f7a191.chunk.js.map