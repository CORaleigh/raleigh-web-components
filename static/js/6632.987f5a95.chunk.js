"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[6632],{96632:function(e,t,n){n.r(t),n.d(t,{FeatureServiceSnappingSourceWorker:function(){return K}});var r=n(29439),i=n(1413),a=n(37762),u=n(74165),s=n(15861),o=n(15671),l=n(43144),c=n(60136),h=n(29388),f=n(23132),d=n(80175),v=n(77470),p=n(75610),y=n(36551),m=n(97033),g=n(30709),_=n(86548),x=n(20880),k=n(4720),w=n(27264),b=n(34860),T=n(80262),S=n(78311),E=n(61495),F=n(97866),I=n(67417),M=n(27597),Z=n(38304),C=n(48561),O=(n(21583),n(70441),n(72820),n(62268),n(18392),n(86068),n(75370),n(33642),n(25316),n(44455),n(57714),n(36460),n(30604),n(1241),n(91204),n(73554),n(60912),n(47626),n(81019),n(68826),n(61212),n(29709),n(78674),n(66307),n(2760),n(50448),n(22144),n(83712),n(63022),n(61340),n(33703),n(69953),n(7513),n(75955),n(50526),n(14739),n(10780),n(55827),n(14181),n(36638),n(43124),n(69797),n(96349),n(15181),n(28999),function(e){(0,c.Z)(n,e);var t=(0,h.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).updating=!1,e.pending=[],e}return(0,l.Z)(n,[{key:"push",value:function(e,t){this.pending.push({promise:e,callback:t}),1===this.pending.length&&this._process()}},{key:"_process",value:function(){var e=this;if(this.pending.length){this.updating=!0;var t=this.pending[0];t.promise.then((function(e){return t.callback(e)})).catch((function(){})).then((function(){e.pending.shift(),e._process()}))}else this.updating=!1}}]),n}(f.y));(0,f.e)([(0,f.d)()],O.prototype,"updating",void 0),O=(0,f.e)([(0,f.n)("esri.core.AsyncSequence")],O);var A,D=function(){function e(t,n){(0,o.Z)(this,e),this.data=t,this.resolution=n,this.state={type:A.CREATED},this.alive=!0}return(0,l.Z)(e,[{key:"process",value:function(e){switch(this.state.type){case A.CREATED:return this.state=this._gotoFetchCount(this.state,e),this.state.task.promise.then(e.resume,e.resume);case A.FETCH_COUNT:break;case A.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,e),this.state.task.promise.then(e.resume,e.resume);case A.FETCH_FEATURES:break;case A.FETCHED_FEATURES:this.state=this._goToDone(this.state,e)}return null}},{key:"debugInfo",get:function(){return{data:this.data,featureCount:this.featureCount,state:this.stateToString}}},{key:"featureCount",get:function(){switch(this.state.type){case A.CREATED:case A.FETCH_COUNT:return 0;case A.FETCHED_COUNT:return this.state.featureCount;case A.FETCH_FEATURES:return this.state.previous.featureCount;case A.FETCHED_FEATURES:return this.state.features.length;case A.DONE:return this.state.previous.features.length}}},{key:"stateToString",get:function(){switch(this.state.type){case A.CREATED:return"created";case A.FETCH_COUNT:return"fetch-count";case A.FETCHED_COUNT:return"fetched-count";case A.FETCH_FEATURES:return"fetch-features";case A.FETCHED_FEATURES:return"fetched-features";case A.DONE:return"done"}}},{key:"_gotoFetchCount",value:function(e,t){var n=this;return{type:A.FETCH_COUNT,previous:e,task:(0,f.al)(function(){var e=(0,s.Z)((0,u.Z)().mark((function e(r){var i;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,Z.u)(t.fetchCount(n,r));case 2:i=e.sent,n.state.type===A.FETCH_COUNT&&(n.state=n._gotoFetchedCount(n.state,i.ok?i.value:1/0));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}},{key:"_gotoFetchedCount",value:function(e,t){return{type:A.FETCHED_COUNT,featureCount:t,previous:e}}},{key:"_gotoFetchFeatures",value:function(e,t){var n=this;return{type:A.FETCH_FEATURES,previous:e,task:(0,f.al)(function(){var r=(0,s.Z)((0,u.Z)().mark((function r(i){var a;return(0,u.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,Z.u)(t.fetchFeatures(n,e.featureCount,i));case 2:a=r.sent,n.state.type===A.FETCH_FEATURES&&(n.state=n._gotoFetchedFeatures(n.state,a.ok?a.value:[]));case 4:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}}},{key:"_gotoFetchedFeatures",value:function(e,t){return{type:A.FETCHED_FEATURES,previous:e,features:t}}},{key:"_goToDone",value:function(e,t){return t.finish(this,e.features),{type:A.DONE,previous:e}}},{key:"reset",value:function(){var e=this.state;switch(this.state={type:A.CREATED},e.type){case A.CREATED:case A.FETCHED_COUNT:case A.FETCHED_FEATURES:case A.DONE:break;case A.FETCH_COUNT:case A.FETCH_FEATURES:e.task.abort()}}},{key:"intersects",value:function(e){return!(!(0,p.t)(e)&&this.data.extent)||((0,S.c)(e,B),(0,S.E)(this.data.extent,B))}}]),e}();!function(e){e[e.CREATED=0]="CREATED",e[e.FETCH_COUNT=1]="FETCH_COUNT",e[e.FETCHED_COUNT=2]="FETCHED_COUNT",e[e.FETCH_FEATURES=3]="FETCH_FEATURES",e[e.FETCHED_FEATURES=4]="FETCHED_FEATURES",e[e.DONE=5]="DONE"}(A||(A={}));var B=(0,S.u)(),R=f.s.getLogger("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher"),z=function(e){(0,c.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).tilesOfInterest=[],r.availability=0,r.pendingTiles=new Map,r.pendingEdits=new O,r.pendingEditsAbortController=new AbortController,r}return(0,l.Z)(n,[{key:"minimumVerticesPerFeature",get:function(){var e;switch(null===(e=this.store)||void 0===e?void 0:e.featureStore.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":return 1;case"esriGeometryPolygon":return 4;case"esriGeometryPolyline":return 2}}},{key:"filter",set:function(e){var t=this._get("filter"),n=this._filterProperties(e);JSON.stringify(t)!==JSON.stringify(n)&&this._set("filter",n)}},{key:"customParameters",set:function(e){var t=this._get("customParameters");JSON.stringify(t)!==JSON.stringify(e)&&this._set("customParameters",e)}},{key:"configuration",get:function(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}},{key:"tileInfo",set:function(e){var t=this._get("tileInfo");t!==e&&((0,p.r)(e)&&(0,p.r)(t)&&JSON.stringify(e)===JSON.stringify(t)||(this._set("tileInfo",e),this.store.tileInfo=e))}},{key:"tileSize",set:function(e){this._get("tileSize")!==e&&this._set("tileSize",e)}},{key:"updating",get:function(){return this.updatingHandles.updating||this.pendingEdits.updating}},{key:"initialize",value:function(){var e=this;this._initializeFetchExtent(),this.updatingHandles.add((function(){return e.configuration}),(function(){return e.refresh()})),this.updatingHandles.add((function(){return e.tilesOfInterest}),(function(t,n){(0,p.k)(t,n,(function(e,t){return e.id===t.id}))||e._process()}),y.U)}},{key:"destroy",value:function(){var e=this;this.pendingTiles.forEach((function(t){return e._deletePendingTile(t)})),this.pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this.pendingEditsAbortController.abort(),this.pendingEditsAbortController=null}},{key:"refresh",value:function(){var e=this;this.store.refresh(),this.pendingTiles.forEach((function(t){return e._deletePendingTile(t)})),this._process()}},{key:"applyEdits",value:function(e){var t=this;this.pendingEdits.push(e,function(){var e=(0,s.Z)((0,u.Z)().mark((function e(n){var s,o,l,c;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==n.addedFeatures.length||0!==n.updatedFeatures.length||0!==n.deletedFeatures.length){e.next=2;break}return e.abrupt("return");case 2:s=(0,a.Z)(t.pendingTiles);try{for(s.s();!(o=s.n()).done;)l=(0,r.Z)(o.value,2),l[1].reset()}catch(u){s.e(u)}finally{s.f()}return c=(0,i.Z)((0,i.Z)({},n),{},{deletedFeatures:n.deletedFeatures.map((function(e){var n=e.objectId,r=e.globalId;return n&&-1!==n?n:t._lookupObjectIdByGlobalId(r)}))}),e.next=7,t.updatingHandles.addPromise(t.store.processEdits(c,(function(e,n){return t._queryFeaturesById(e,n)}),t.pendingEditsAbortController.signal));case 7:t._processPendingTiles();case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"_initializeFetchExtent",value:function(){var e=this;if(this.capabilities.query.supportsExtent&&(0,F.g)(this.url)){var t=(0,f.al)(function(){var t=(0,s.Z)((0,u.Z)().mark((function t(n){var r,i;return(0,u.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,M.x)(e.url,new b.b({where:"1=1",outSpatialReference:e.spatialReference,cacheHint:!!e.capabilities.query.supportsCacheHint||void 0}),{query:e.configuration.customParameters,signal:n});case 3:i=t.sent,e.store.extent=T.M.fromJSON(null===(r=i.data)||void 0===r?void 0:r.extent),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),(0,f.M)(t.t0),R.warn("Failed to fetch data extent",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}());this.updatingHandles.addPromise(t.promise.then((function(){return e._process()}))),this.handles.add((0,f.g)((function(){return t.abort()})))}}},{key:"debugInfo",get:function(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this.pendingTiles.values()).map((function(e){return e.debugInfo})),storedTiles:this.store.debugInfo}}},{key:"_process",value:function(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}},{key:"_markTilesNotAlive",value:function(){var e,t=(0,a.Z)(this.pendingTiles);try{for(t.s();!(e=t.n()).done;){(0,r.Z)(e.value,2)[1].alive=!1}}catch(n){t.e(n)}finally{t.f()}}},{key:"_createPendingTiles",value:function(){var e=this._collectMissingTilesInfo();if(this._setAvailability((0,p.t)(e)?1:e.coveredArea/e.fullArea),!(0,p.t)(e)){var t,n=(0,a.Z)(e.missingTiles);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.data,u=r.resolution,s=this.pendingTiles.get(i.id);s?(s.resolution=u,s.alive=!0):this._createPendingTile(i,u)}}catch(o){n.e(o)}finally{n.f()}}}},{key:"_collectMissingTilesInfo",value:function(){for(var e=this,t=null,n=this.tilesOfInterest.length-1;n>=0;n--){var r=this.tilesOfInterest[n],i=this.store.process(r,(function(t,n){return e._verifyTileComplexity(t,n)}));(0,p.t)(t)?t=i:t.prepend(i)}return t}},{key:"_deletePendingTiles",value:function(){var e,t=(0,a.Z)(this.pendingTiles);try{for(t.s();!(e=t.n()).done;){var n=(0,r.Z)(e.value,2)[1];n.alive||this._deletePendingTile(n)}}catch(i){t.e(i)}finally{t.f()}}},{key:"_processPendingTiles",value:function(){var e=this,t={fetchCount:function(t,n){return e._fetchCount(t,n)},fetchFeatures:function(t,n,r){return e._fetchFeatures(t,n,r)},finish:function(t,n){return e._finishPendingTile(t,n)},resume:function(){return e._processPendingTiles()}};if(this._ensureFetchAllCounts(t)){var n,i=(0,a.Z)(this.pendingTiles);try{for(i.s();!(n=i.n()).done;){var u=(0,r.Z)(n.value,2)[1];this._verifyTileComplexity(this.store.getFeatureCount(u.data),u.resolution)&&this.updatingHandles.addPromise(u.process(t))}}catch(s){i.e(s)}finally{i.f()}}}},{key:"_verifyTileComplexity",value:function(e,t){return this._verifyVertexComplexity(e)&&this._verifyFeatureDensity(e,t)}},{key:"_verifyVertexComplexity",value:function(e){return e*this.minimumVerticesPerFeature<H}},{key:"_verifyFeatureDensity",value:function(e,t){if((0,p.t)(this.tileInfo))return!1;var n=this.tileSize*t;return e*(P/(n*n))<U}},{key:"_ensureFetchAllCounts",value:function(e){var t,n=!0,i=(0,a.Z)(this.pendingTiles);try{for(i.s();!(t=i.n()).done;){var u=(0,r.Z)(t.value,2)[1];u.state.type<A.FETCHED_COUNT&&this.updatingHandles.addPromise(u.process(e)),u.state.type<=A.FETCH_COUNT&&(n=!1)}}catch(s){i.e(s)}finally{i.f()}return n}},{key:"_finishPendingTile",value:function(e,t){this.store.add(e.data,t),this._deletePendingTile(e),this._updateAvailability()}},{key:"_updateAvailability",value:function(){var e=this._collectMissingTilesInfo();this._setAvailability((0,p.t)(e)?1:e.coveredArea/e.fullArea)}},{key:"_setAvailability",value:function(e){this._set("availability",e)}},{key:"_createPendingTile",value:function(e,t){var n=new D(e,t);return this.pendingTiles.set(e.id,n),n}},{key:"_deletePendingTile",value:function(e){e.reset(),this.pendingTiles.delete(e.data.id)}},{key:"_fetchCount",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.store.fetchCount(t.data,this.url,this._createCountQuery(t),{query:this.customParameters,timeout:j,signal:n}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_fetchFeatures",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,n,r){var i,a,s,o,l,c,h,f,d;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=0,s=0,o=n;case 1:return l=this._createFeaturesQuery(t),c=this._setPagingParameters(l,a,o),e.next=5,this._queryFeatures(l,r);case 5:if(h=e.sent,f=h.features,d=h.exceededTransferLimit,c&&(a+=(0,p.e)(l.num)),s+=f.length,i=i?i.concat(f):f,o=n-s,c&&d&&!(o<=0)){e.next=10;break}return e.abrupt("return",i);case 10:e.next=1;break;case 12:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_filterProperties",value:function(e){return(0,p.t)(e)?{where:"1=1",gdbVersion:void 0,timeExtent:void 0}:{where:e.where||"1=1",timeExtent:e.timeExtent,gdbVersion:e.gdbVersion}}},{key:"_lookupObjectIdByGlobalId",value:function(e){var t=this.globalIdField,n=this.objectIdField;if((0,p.t)(t))throw new Error("Expected globalIdField to be defined");var r=null;if(this.store.featureStore.forEach((function(i){var a;e===i.attributes[t]&&(r=null!==(a=i.objectId)&&void 0!==a?a:i.attributes[n])})),(0,p.t)(r))throw new Error("Expected to find a feature with globalId ".concat(e));return r}},{key:"_queryFeaturesById",value:function(e,t){var n=this._createFeaturesQuery(null);return n.objectIds=e,this._queryFeatures(n,t)}},{key:"_queryFeatures",value:function(e,t){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(e,t):this._queryFeaturesJSON(e,t)}},{key:"_queryFeaturesPBF",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,n){var r,i,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.sourceSpatialReference,e.next=3,(0,M.d)(this.url,t,new I.a({sourceSpatialReference:r}),{query:this.configuration.customParameters,timeout:j,signal:n});case 3:return i=e.sent,a=i.data,e.abrupt("return",(0,E.l)(a));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_queryFeaturesJSON",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,n){var r,i,a;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.sourceSpatialReference,e.next=3,(0,M.c)(this.url,t,r,{query:this.configuration.customParameters,timeout:j,signal:n});case 3:return i=e.sent,a=i.data,e.abrupt("return",(0,E.c)(a,this.objectIdField));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_createCountQuery",value:function(e){var t=this._createBaseQuery(e);return this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}},{key:"_createFeaturesQuery",value:function(e){var t=this._createBaseQuery(e);return t.outFields=this.globalIdField?[this.globalIdField,this.objectIdField]:[this.objectIdField],t.returnGeometry=!0,(0,p.r)(e)&&(this.capabilities.query.supportsResultType?t.resultType="tile":this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0)),t}},{key:"_createBaseQuery",value:function(e){var t=new b.b({returnZ:!1,returnM:!1,geometry:(0,p.r)(this.tileInfo)&&(0,p.r)(e)?(0,S.f)(e.data.extent,this.tileInfo.spatialReference):void 0}),n=this.configuration.filter;return(0,p.r)(n)&&(t.where=n.where,t.gdbVersion=n.gdbVersion,t.timeExtent=n.timeExtent),t.outSpatialReference=this.spatialReference,t}},{key:"_setPagingParameters",value:function(e,t,n){if(!this.capabilities.query.supportsPagination)return!1;var r=this.capabilities.query,i=r.supportsMaxRecordCountFactor,a=r.supportsCacheHint,u=r.tileMaxRecordCount,s=r.maxRecordCount,o=r.supportsResultType,l=i?b.b.MAX_MAX_RECORD_COUNT_FACTOR:1,c=l*((o||a)&&u?u:s||N);return e.start=t,i?(e.maxRecordCountFactor=Math.min(l,Math.ceil(n/c)),e.num=Math.min(n,e.maxRecordCountFactor*c)):e.num=Math.min(n,c),!0}}]),n}(m.d);(0,f.e)([(0,f.d)({constructOnly:!0})],z.prototype,"url",void 0),(0,f.e)([(0,f.d)({constructOnly:!0})],z.prototype,"objectIdField",void 0),(0,f.e)([(0,f.d)({constructOnly:!0})],z.prototype,"globalIdField",void 0),(0,f.e)([(0,f.d)({constructOnly:!0})],z.prototype,"capabilities",void 0),(0,f.e)([(0,f.d)({constructOnly:!0})],z.prototype,"sourceSpatialReference",void 0),(0,f.e)([(0,f.d)({constructOnly:!0})],z.prototype,"spatialReference",void 0),(0,f.e)([(0,f.d)({constructOnly:!0})],z.prototype,"store",void 0),(0,f.e)([(0,f.d)({readOnly:!0})],z.prototype,"minimumVerticesPerFeature",null),(0,f.e)([(0,f.d)()],z.prototype,"filter",null),(0,f.e)([(0,f.d)()],z.prototype,"customParameters",null),(0,f.e)([(0,f.d)({readOnly:!0})],z.prototype,"configuration",null),(0,f.e)([(0,f.d)()],z.prototype,"tileInfo",null),(0,f.e)([(0,f.d)()],z.prototype,"tileSize",null),(0,f.e)([(0,f.d)()],z.prototype,"tilesOfInterest",void 0),(0,f.e)([(0,f.d)({readOnly:!0})],z.prototype,"updating",null),(0,f.e)([(0,f.d)({readOnly:!0})],z.prototype,"availability",void 0),z=(0,f.e)([(0,f.n)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher")],z);var N=2e3,j=6e5,H=1e6,P=25,U=1,L=function(e){function t(){(0,o.Z)(this,t),this._store=new Map,this._byteSize=0}return(0,l.Z)(t,[{key:"set",value:function(e,t){this.delete(e),this._store.set(e,t),this._byteSize+=t.byteSize}},{key:"delete",value:function(e){var t=this._store.get(e);return!!this._store.delete(e)&&(this._byteSize-=t.byteSize,!0)}},{key:"get",value:function(e){return this._used(e),this._store.get(e)}},{key:"has",value:function(e){return this._used(e),this._store.has(e)}},{key:"clear",value:function(){this._store.clear()}},{key:"applyByteSizeLimit",value:function(e,t){var n,i=(0,a.Z)(this._store);try{for(i.s();!(n=i.n()).done;){var u=(0,r.Z)(n.value,2),s=u[0],o=u[1];if(this._byteSize<=e)break;this.delete(s),t(o)}}catch(l){i.e(l)}finally{i.f()}}},{key:"values",value:function(){return this._store.values()}},{key:e,value:function(){return this._store[Symbol.iterator]()}},{key:"_used",value:function(e){var t=this._store.get(e);t&&(this._store.delete(e),this._store.set(e,t))}}]),t}(Symbol.iterator),Y=function(e){(0,c.Z)(n,e);var t=(0,h.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).tileInfo=null,r.extent=null,r.maximumByteSize=10*C.o.MEGABYTES,r.tileBounds=new _.h,r.tiles=new L,r.refCounts=new Map,r.tileFeatureCounts=new Map,r.tmpBoundingRect=(0,S.u)(),r}return(0,l.Z)(n,[{key:"add",value:function(e,t){var n,r=this,i=[],u=(0,a.Z)(t);try{for(u.s();!(n=u.n()).done;){var s=n.value;this._referenceFeature(s.objectId)===V.ADDED&&i.push(s)}}catch(o){u.e(o)}finally{u.f()}this._addTileStorage(e,new Set(t.map((function(e){return e.objectId}))),function(e){return e.reduce((function(e,t){return e+function(e){return 32+function(e){if((0,p.t)(e))return 0;var t=(0,C.e)(e.lengths,4);return 32+(0,C.e)(e.coords,8)+t}(e.geometry)+(0,C.r)(e.attributes)}(t)}),0)}(t)),this.featureStore.addMany(i),this.tiles.applyByteSizeLimit(this.maximumByteSize,(function(e){return r._removeTileStorage(e)}))}},{key:"destroy",value:function(){this.clear(),this.tileFeatureCounts.clear()}},{key:"clear",value:function(){this.featureStore.clear(),this.tileBounds.clear(),this.tiles.clear(),this.refCounts.clear()}},{key:"refresh",value:function(){this.clear(),this.tileFeatureCounts.clear()}},{key:"processEdits",value:function(e,t,n){return this._processEditsDelete(e.deletedFeatures.concat(e.updatedFeatures)),this._processEditsRefetch(e.addedFeatures.concat(e.updatedFeatures),t,n)}},{key:"_addTileStorage",value:function(e,t,n){this.tiles.set(e.id,new X(e,t,n)),this.tileBounds.set(e.id,e.extent),this.tileFeatureCounts.set(e.id,t.size)}},{key:"_remove",value:function(e){var t=e.id,n=this.tiles.get(t);n&&this._removeTileStorage(n)}},{key:"_removeTileStorage",value:function(e){var t,n=[],r=(0,a.Z)(e.objectIds);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._unreferenceFeature(i)===V.REMOVED&&n.push(i)}}catch(s){r.e(s)}finally{r.f()}this.featureStore.removeManyById(n);var u=e.data.id;this.tiles.delete(u),this.tileBounds.delete(u)}},{key:"_processEditsDelete",value:function(e){this.featureStore.removeManyById(e);var t,n=(0,a.Z)(this.tiles);try{for(n.s();!(t=n.n()).done;){var i,u=(0,r.Z)(t.value,2)[1],s=(0,a.Z)(e);try{for(s.s();!(i=s.n()).done;){var o=i.value;u.objectIds.delete(o)}}catch(f){s.e(f)}finally{s.f()}this.tileFeatureCounts.set(u.data.id,u.objectIds.size)}}catch(f){n.e(f)}finally{n.f()}var l,c=(0,a.Z)(e);try{for(c.s();!(l=c.n()).done;){var h=l.value;this.refCounts.delete(h)}}catch(f){c.e(f)}finally{c.f()}}},{key:"_processEditsRefetch",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,n,r){var i,s,o,l,c,h,f,d=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n(t,r);case 2:i=e.sent.features,s=this.featureStore,o=s.hasZ,l=s.hasM,c=(0,a.Z)(i);try{for(f=function(){var e=h.value,t=(0,E.g)(d.tmpBoundingRect,e.geometry,o,l);(0,p.t)(t)||d.tileBounds.forEachInBounds(t,(function(t){var n=d.tiles.get(t);d.featureStore.add(e),n.objectIds.has(e.objectId)||(n.objectIds.add(e.objectId),d._referenceFeature(e.objectId),d.tileFeatureCounts.set(n.data.id,n.objectIds.size))}))},c.s();!(h=c.n()).done;)f()}catch(u){c.e(u)}finally{c.f()}case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"process",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0};if((0,p.t)(this.tileInfo)||!e.extent||(0,p.r)(this.extent)&&!(0,S.E)((0,S.c)(this.extent,this.tmpBoundingRect),e.extent))return new W(e);if(this.tiles.has(e.id))return new W(e);var n=this._createTileTree(e,this.tileInfo);return this._simplify(n,t,null,0,1),this._collectMissingTiles(e,n,this.tileInfo)}},{key:"debugInfo",get:function(){var e=this;return Array.from(this.tiles.values()).map((function(t){var n=t.data;return{data:n,featureCount:e.tileFeatureCounts.get(n.id)||0}}))}},{key:"getFeatureCount",value:function(e){var t;return null!==(t=this.tileFeatureCounts.get(e.id))&&void 0!==t?t:0}},{key:"fetchCount",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,n,r,i){var a,s;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(a=this.tileFeatureCounts.get(t.id))){e.next=3;break}return e.abrupt("return",a);case 3:return e.next=5,(0,M.S)(n,r,i);case 5:return s=e.sent,e.abrupt("return",(this.tileFeatureCounts.set(t.id,s.data.count),s.data.count));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_createTileTree",value:function(e,t){var n=this,r=new q(e.level,e.row,e.col);return t.updateTileInfo(r,k.S.ExtrapolateOptions.POWER_OF_TWO),this.tileBounds.forEachInBounds(e.extent,(function(i){var a=n.tiles.get(i).data;n._tilesAreRelated(e,a)&&n._populateChildren(r,a,t,n.tileFeatureCounts.get(a.id)||0)})),r}},{key:"_tilesAreRelated",value:function(e,t){if(!e||!t)return!1;if(e.level===t.level)return e.row===t.row&&e.col===t.col;var n=e.level<t.level,r=n?e:t,i=n?t:e,a=1<<i.level-r.level;return Math.floor(i.row/a)===r.row&&Math.floor(i.col/a)===r.col}},{key:"_populateChildren",value:function(e,t,n,r){var i=t.level-e.level-1;if(i<0)e.isLeaf=!0;else{var a=t.row>>i,u=t.col>>i,s=e.row<<1,o=u-(e.col<<1)+(a-s<<1),l=e.children[o];if((0,p.r)(l))this._populateChildren(l,t,n,r);else{var c=new q(e.level+1,a,u);n.updateTileInfo(c,k.S.ExtrapolateOptions.POWER_OF_TWO),e.children[o]=c,this._populateChildren(c,t,n,r)}}}},{key:"_simplify",value:function(e,t,n,r,i){var a=i*i;if(e.isLeaf)return t(this.getFeatureCount(e),i)?0:(this._remove(e),(0,p.r)(n)&&(n.children[r]=null),a);for(var u=i/2,s=u*u,o=0,l=0;l<e.children.length;l++){var c=e.children[l];o+=(0,p.r)(c)?this._simplify(c,t,e,l,u):s}return 0===o?this._mergeChildren(e):1-o/a<Q&&(this._purge(e),(0,p.r)(n)&&(n.children[r]=null),o=a),o}},{key:"_mergeChildren",value:function(e){var t=this,n=new Set,r=0;this._forEachLeaf(e,(function(e){var i=t.tiles.get(e.id);if(i){r+=i.byteSize;var u,s=(0,a.Z)(i.objectIds);try{for(s.s();!(u=s.n()).done;){var o=u.value;n.has(o)||(n.add(o),t._referenceFeature(o))}}catch(l){s.e(l)}finally{s.f()}t._remove(e)}})),this._addTileStorage(e,n,r),e.isLeaf=!0,e.children[0]=e.children[1]=e.children[2]=e.children[3]=null,this.tileFeatureCounts.set(e.id,n.size)}},{key:"_forEachLeaf",value:function(e,t){var n,r=(0,a.Z)(e.children);try{for(r.s();!(n=r.n()).done;){var i=n.value;(0,p.t)(i)||(i.isLeaf?t(i):this._forEachLeaf(i,t))}}catch(u){r.e(u)}finally{r.f()}}},{key:"_purge",value:function(e){if(!(0,p.t)(e))if(e.isLeaf)this._remove(e);else for(var t=0;t<e.children.length;t++){var n=e.children[t];this._purge(n),e.children[t]=null}}},{key:"_collectMissingTiles",value:function(e,t,n){var r=new J(n,e,this.extent);return this._collectMissingTilesRecurse(t,r,1),r.info}},{key:"_collectMissingTilesRecurse",value:function(e,t,n){if(!e.isLeaf)if(e.hasChildren)for(var r=n/2,i=0;i<e.children.length;i++){var a=e.children[i];(0,p.t)(a)?t.addMissing(e.level+1,(e.row<<1)+((2&i)>>1),(e.col<<1)+(1&i),r):this._collectMissingTilesRecurse(a,t,r)}else t.addMissing(e.level,e.row,e.col,n)}},{key:"_referenceFeature",value:function(e){var t=(this.refCounts.get(e)||0)+1;return this.refCounts.set(e,t),1===t?V.ADDED:V.UNCHANGED}},{key:"_unreferenceFeature",value:function(e){var t=(this.refCounts.get(e)||0)-1;return 0===t?(this.refCounts.delete(e),V.REMOVED):(t>0&&this.refCounts.set(e,t),V.UNCHANGED)}},{key:"test",get:function(){var e=this;return{tiles:Array.from(this.tiles.values()).map((function(e){return"".concat(e.data.id,":[").concat(Array.from(e.objectIds),"]")})),featureReferences:Array.from(this.refCounts.keys()).map((function(t){return"".concat(t,":").concat(e.refCounts.get(t))}))}}}]),n}(f.y);(0,f.e)([(0,f.d)({constructOnly:!0})],Y.prototype,"featureStore",void 0),(0,f.e)([(0,f.d)()],Y.prototype,"tileInfo",void 0),(0,f.e)([(0,f.d)()],Y.prototype,"extent",void 0),(0,f.e)([(0,f.d)()],Y.prototype,"maximumByteSize",void 0),Y=(0,f.e)([(0,f.n)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTileStore")],Y);var V,G,X=(0,l.Z)((function e(t,n,r){(0,o.Z)(this,e),this.data=t,this.objectIds=n,this.byteSize=r})),q=function(){function e(t,n,r){(0,o.Z)(this,e),this.level=t,this.row=n,this.col=r,this.isLeaf=!1,this.extent=null,this.children=[null,null,null,null]}return(0,l.Z)(e,[{key:"hasChildren",get:function(){return!this.isLeaf&&((0,p.r)(this.children[0])||(0,p.r)(this.children[1])||(0,p.r)(this.children[2])||(0,p.r)(this.children[3]))}}]),e}(),W=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];(0,o.Z)(this,e),this.missingTiles=n,this.fullArea=0,this.coveredArea=0,this.fullArea=(0,S.y)(t.extent),this.coveredArea=this.fullArea}return(0,l.Z)(e,[{key:"prepend",value:function(e){this.missingTiles=e.missingTiles.concat(this.missingTiles),this.coveredArea+=e.coveredArea,this.fullArea+=e.fullArea}}]),e}(),J=function(){function e(t,n,r){(0,o.Z)(this,e),this.tileInfo=t,this.extent=null,this.info=new W(n),(0,p.r)(r)&&(this.extent=(0,S.c)(r))}return(0,l.Z)(e,[{key:"addMissing",value:function(e,t,n,r){var i={id:null,level:e,row:t,col:n};this.tileInfo.updateTileInfo(i,k.S.ExtrapolateOptions.POWER_OF_TWO),(0,p.t)(i.extent)||(0,p.r)(this.extent)&&!(0,S.E)(this.extent,i.extent)||(this.info.missingTiles.push({data:i,resolution:r}),this.info.coveredArea-=(0,S.y)(i.extent))}}]),e}(),Q=.18751;(G=V||(V={}))[G.ADDED=0]="ADDED",G[G.REMOVED=1]="REMOVED",G[G.UNCHANGED=2]="UNCHANGED";var K=function(e){(0,c.Z)(n,e);var t=(0,h.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).isInitializing=!0,e.whenSetup=(0,f.T)(),e.handles=new v.u,e.updatingHandles=new m.c,e.pendingApplyEdits=new Map,e}return(0,l.Z)(n,[{key:"updating",get:function(){return this.featureFetcher.updating||this.isInitializing||this.updatingHandles.updating}},{key:"destroy",value:function(){this.featureFetcher.destroy(),this.queryEngine.destroy(),this.featureStore.clear(),this.handles.destroy()}},{key:"setup",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){var n,r,a,s,o,l=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.serviceInfo,r=n.geometryType,a=n.objectIdField,s=n.timeInfo,o=n.fields,e.abrupt("return",(this.featureStore=new _.u((0,i.Z)((0,i.Z)({},t.serviceInfo),{},{hasZ:!1,hasM:!1})),this.queryEngine=new x.Y({spatialReference:t.spatialReference,featureStore:this.featureStore,geometryType:r,fields:o,hasZ:!1,hasM:!1,objectIdField:a,timeInfo:s?w.v.fromJSON(s):null}),this.featureFetcher=new z({store:new Y({featureStore:this.featureStore}),url:t.serviceInfo.url,objectIdField:t.serviceInfo.objectIdField,globalIdField:t.serviceInfo.globalIdField,capabilities:t.serviceInfo.capabilities,spatialReference:g.k.fromJSON(t.spatialReference),sourceSpatialReference:g.k.fromJSON(t.serviceInfo.spatialReference)}),this.handles.add([(0,y.l)((function(){return l.featureFetcher.availability}),(function(e){return l.emit("notify-availability",{availability:e})}),y.U),(0,y.l)((function(){return l.updating}),(function(){return l._notifyUpdating()}))]),this.whenSetup.resolve(),this.isInitializing=!1,this.configure(t.configuration)));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"configure",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updatingHandles.addPromise(this.whenSetup.promise);case 2:return this._updateFeatureFetcherConfiguration(t),e.abrupt("return",{result:{}});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchCandidates",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.whenSetup.promise;case 2:return(0,f.H)(n),e.next=5,this.queryEngine.executeQueryForSnapping({point:t.point,distance:t.distance,types:t.types,query:(0,p.r)(t.filter)?t.filter:{where:"1=1"}},(0,p.r)(n)?n.signal:null);case 5:return e.t0=e.sent,e.abrupt("return",{result:e.t0});case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateTiles",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updatingHandles.addPromise(this.whenSetup.promise);case 2:return(0,f.H)(n),this.featureFetcher.tileSize=t.tileSize,this.featureFetcher.tilesOfInterest=t.tiles,this.featureFetcher.tileInfo=(0,p.r)(t.tileInfo)?k.S.fromJSON(t.tileInfo):null,e.abrupt("return",{result:{}});case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updatingHandles.addPromise(this.whenSetup.promise);case 2:return(0,f.H)(n),this.featureFetcher.refresh(),e.abrupt("return",{result:{}});case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"whenNotUpdating",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,n){var r=this;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updatingHandles.addPromise(this.whenSetup.promise);case 2:return(0,f.H)(n),e.next=5,(0,y.j)((function(){return!r.updating}),n);case 5:return(0,f.H)(n),e.abrupt("return",{result:{}});case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDebugInfo",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,n){return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",((0,f.H)(n),{result:this.featureFetcher.debugInfo}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"beginApplyEdits",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,n){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updatingHandles.addPromise(this.whenSetup.promise),(0,f.H)(n),r=(0,f.T)(),e.abrupt("return",(this.pendingApplyEdits.set(t.id,r),this.featureFetcher.applyEdits(r.promise),this.updatingHandles.addPromise(r.promise),{result:{}}));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"endApplyEdits",value:function(){var e=(0,s.Z)((0,u.Z)().mark((function e(t,n){var r;return(0,u.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.pendingApplyEdits.get(t.id),e.abrupt("return",(r&&r.resolve(t.edits),(0,f.H)(n),{result:{}}));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_updateFeatureFetcherConfiguration",value:function(e){this.featureFetcher.filter=(0,p.r)(e.filter)?b.b.fromJSON(e.filter):null,this.featureFetcher.customParameters=e.customParameters}},{key:"_notifyUpdating",value:function(){this.emit("notify-updating",{updating:this.updating})}}]),n}(d.n.EventedAccessor);(0,f.e)([(0,f.d)({readOnly:!0})],K.prototype,"updating",null),(0,f.e)([(0,f.d)()],K.prototype,"isInitializing",void 0),K=(0,f.e)([(0,f.n)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker")],K),t.default=function(){return new K}},86548:function(e,t,n){n.d(t,{h:function(){return y},u:function(){return m}});var r=n(37762),i=n(15671),a=n(43144),u=n(23132),s=n(80175),o=n(75610),l=n(72820),c=n(78311),h=n(61495),f=n(62268),d=n(86068),v={minX:0,minY:0,maxX:0,maxY:0};function p(e,t,n){(function(e){v.minX=e[0],v.minY=e[1],v.maxX=e[2],v.maxY=e[3]})(t),e.search(v,n)}var y=function(){function e(){var t=this;(0,i.Z)(this,e),this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new f.h(9,(0,o.a)("esri-csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(t._indexInvalid){var e=new Array(t._idByBounds.size),n=0;t._idByBounds.forEach((function(t,r){e[n++]=r})),t._indexInvalid=!1,t._index.clear(),t._index.load(e)}else t._boundsToLoad.length&&(t._index.load(t._boundsToLoad.filter((function(e){return t._idByBounds.has(e)}))),t._boundsToLoad.length=0)}}return(0,a.Z)(e,[{key:"fullBounds",get:function(){if(!this._boundsById.size)return null;var e,t=(0,c.D)(),n=(0,r.Z)(this._boundsById.values());try{for(n.s();!(e=n.n()).done;){var i=e.value;i&&(t[0]=Math.min(i[0],t[0]),t[1]=Math.min(i[1],t[1]),t[2]=Math.max(i[2],t[2]),t[3]=Math.max(i[3],t[3]))}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"valid",get:function(){return!this._indexInvalid}},{key:"clear",value:function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}},{key:"delete",value:function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}},{key:"forEachInBounds",value:function(e,t){var n=this;this._loadIndex(),p(this._index,e,(function(e){return t(n._idByBounds.get(e))}))}},{key:"get",value:function(e){return this._boundsById.get(e)}},{key:"has",value:function(e){return this._boundsById.has(e)}},{key:"invalidateIndex",value:function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}},{key:"set",value:function(e,t){if(!this._indexInvalid){var n=this._boundsById.get(e);n&&(this._index.remove(n),this._idByBounds.delete(n))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}]),e}(),m=function(){function e(t){(0,i.Z)(this,e),this.geometryInfo=t,this._boundsStore=new y,this._featuresById=new Map,this._markedIds=new Set,this.events=new s.n,this.featureAdapter=d.i}return(0,a.Z)(e,[{key:"geometryType",get:function(){return this.geometryInfo.geometryType}},{key:"hasM",get:function(){return this.geometryInfo.hasM}},{key:"hasZ",get:function(){return this.geometryInfo.hasZ}},{key:"numFeatures",get:function(){return this._featuresById.size}},{key:"fullBounds",get:function(){return this._boundsStore.fullBounds}},{key:"storeStatistics",get:function(){var e=0;return this._featuresById.forEach((function(t){(0,o.r)(t.geometry)&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}},{key:"add",value:function(e){this._add(e),this._emitChanged()}},{key:"addMany",value:function(e){var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this._add(i)}}catch(a){n.e(a)}finally{n.f()}this._emitChanged()}},{key:"clear",value:function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}},{key:"removeById",value:function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}},{key:"removeManyById",value:function(e){this._boundsStore.invalidateIndex();var t,n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=this._featuresById.get(i);a&&this._remove(a)}}catch(u){n.e(u)}finally{n.f()}this._emitChanged()}},{key:"forEachBounds",value:function(e,t,n){var i,a=(0,r.Z)(e);try{for(a.s();!(i=a.n()).done;){var u=i.value,s=this._boundsStore.get(u.objectId);s&&t((0,l.O)(n,s))}}catch(o){a.e(o)}finally{a.f()}}},{key:"getFeature",value:function(e){return this._featuresById.get(e)}},{key:"has",value:function(e){return this._featuresById.has(e)}},{key:"toArray",value:function(){return Array.from(this._featuresById.values())}},{key:"forEach",value:function(e){this._featuresById.forEach((function(t){return e(t)}))}},{key:"forEachInBounds",value:function(e,t){var n=this;this._boundsStore.forEachInBounds(e,(function(e){t(n._featuresById.get(e))}))}},{key:"startMarkingUsedFeatures",value:function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}},{key:"sweep",value:function(){var e=this,t=!1;this._featuresById.forEach((function(n,r){e._markedIds.has(r)||(t=!0,e._remove(n))})),this._markedIds.clear(),t&&this._emitChanged()}},{key:"_emitChanged",value:function(){this.events.emit("changed",void 0)}},{key:"_add",value:function(e){if(e){var t=e.objectId;if(null!=t){var n,r=this._featuresById.get(t);if(this._markedIds.add(t),r?(e.displayId=r.displayId,n=this._boundsStore.get(t),this._boundsStore.delete(t)):(0,o.r)(this.onFeatureAdd)&&this.onFeatureAdd(e),(0,o.t)(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);n=(0,h.g)((0,o.r)(n)?n:(0,c.u)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),(0,o.r)(n)&&this._boundsStore.set(t,n),this._featuresById.set(t,e)}else u.s.getLogger("esri.layers.graphics.data.FeatureStore").error(new u.a("featurestore:invalid-feature","feature id is missing",{feature:e}))}}},{key:"_remove",value:function(e){return(0,o.r)(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e}}]),e}()},43124:function(e,t,n){n.d(t,{n:function(){return M},p:function(){return p},t:function(){return Z},u:function(){return w},y:function(){return A}});var r,i=n(15671),a=n(43144),u=n(60136),s=n(29388),o=n(23132),l=n(57714),c=n(70441),h=n(75610),f=n(50448),d=n(30709),v=n(69797),p=r=function(e){(0,u.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).name=null,r.code=null,r}return(0,a.Z)(n,[{key:"clone",value:function(){return new r({name:this.name,code:this.code})}}]),n}(c.l);(0,o.e)([(0,o.d)({type:String,json:{write:!0}})],p.prototype,"name",void 0),(0,o.e)([(0,o.d)({type:[String,Number],json:{write:!0}})],p.prototype,"code",void 0),p=r=(0,o.e)([(0,o.n)("esri.layers.support.CodedValue")],p);var y=new l.s({inherited:"inherited",codedValue:"coded-value",range:"range"}),m=function(e){(0,u.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).name=null,r.type=null,r}return(0,a.Z)(n)}(c.l);(0,o.e)([(0,o.d)({type:String,json:{write:!0}})],m.prototype,"name",void 0),(0,o.e)([(0,f.r)(y)],m.prototype,"type",void 0);var g,_=m=(0,o.e)([(0,o.n)("esri.layers.support.Domain")],m),x=g=function(e){(0,u.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).codedValues=null,r.type="coded-value",r}return(0,a.Z)(n,[{key:"getName",value:function(e){var t=null;if(this.codedValues){var n=String(e);this.codedValues.some((function(e){return String(e.code)===n&&(t=e.name),!!t}))}return t}},{key:"clone",value:function(){return new g({codedValues:(0,h.m)(this.codedValues),name:this.name})}}]),n}(_);(0,o.e)([(0,o.d)({type:[p],json:{write:!0}})],x.prototype,"codedValues",void 0),(0,o.e)([(0,f.r)({codedValue:"coded-value"})],x.prototype,"type",void 0);var k,w=x=g=(0,o.e)([(0,o.n)("esri.layers.support.CodedValueDomain")],x),b=k=function(e){(0,u.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).type="inherited",r}return(0,a.Z)(n,[{key:"clone",value:function(){return new k}}]),n}(_);(0,o.e)([(0,f.r)({inherited:"inherited"})],b.prototype,"type",void 0);var T,S=b=k=(0,o.e)([(0,o.n)("esri.layers.support.InheritedDomain")],b),E=T=function(e){(0,u.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).maxValue=null,r.minValue=null,r.type="range",r}return(0,a.Z)(n,[{key:"clone",value:function(){return new T({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}}]),n}(_);(0,o.e)([(0,o.d)({type:Number,json:{type:[Number],read:{source:"range",reader:function(e,t){return t.range&&t.range[1]}},write:{enabled:!1,overridePolicy:function(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer:function(e,t,n){t[n]=[this.minValue||0,e]}}}})],E.prototype,"maxValue",void 0),(0,o.e)([(0,o.d)({type:Number,json:{type:[Number],read:{source:"range",reader:function(e,t){return t.range&&t.range[0]}},write:{target:"range",writer:function(e,t,n){t[n]=[e,this.maxValue||0]}}}})],E.prototype,"minValue",void 0),(0,o.e)([(0,f.r)({range:"range"})],E.prototype,"type",void 0);var F,I=E=T=(0,o.e)([(0,o.n)("esri.layers.support.RangeDomain")],E),M={key:"type",base:_,typeMap:{range:I,"coded-value":w,inherited:S}};function Z(e){if(!e||!e.type)return null;switch(e.type){case"range":return I.fromJSON(e);case"codedValue":return w.fromJSON(e);case"inherited":return S.fromJSON(e)}return null}var C=new l.s({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"}),O=F=function(e){(0,u.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).alias=null,r.defaultValue=void 0,r.description=null,r.domain=null,r.editable=!0,r.length=-1,r.name=null,r.nullable=!0,r.type=null,r.valueType=null,r}return(0,a.Z)(n,[{key:"readDescription",value:function(e,t){var n,r=t.description;try{n=JSON.parse(r)}catch(i){}return n?n.value:null}},{key:"readValueType",value:function(e,t){var n,r=t.description;try{n=JSON.parse(r)}catch(i){}return n?C.fromJSON(n.fieldValueType):null}},{key:"clone",value:function(){return new F({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}}]),n}(c.l);(0,o.e)([(0,o.d)({type:String,json:{write:!0}})],O.prototype,"alias",void 0),(0,o.e)([(0,o.d)({type:[String,Number],json:{write:{allowNull:!0}}})],O.prototype,"defaultValue",void 0),(0,o.e)([(0,o.d)()],O.prototype,"description",void 0),(0,o.e)([(0,d.o)("description")],O.prototype,"readDescription",null),(0,o.e)([(0,o.d)({types:M,json:{read:{reader:Z},write:!0}})],O.prototype,"domain",void 0),(0,o.e)([(0,o.d)({type:Boolean,json:{write:!0}})],O.prototype,"editable",void 0),(0,o.e)([(0,o.d)({type:o.S,json:{write:!0}})],O.prototype,"length",void 0),(0,o.e)([(0,o.d)({type:String,json:{write:!0}})],O.prototype,"name",void 0),(0,o.e)([(0,o.d)({type:Boolean,json:{write:!0}})],O.prototype,"nullable",void 0),(0,o.e)([(0,f.r)(v.i)],O.prototype,"type",void 0),(0,o.e)([(0,o.d)()],O.prototype,"valueType",void 0),(0,o.e)([(0,d.o)("valueType",["description"])],O.prototype,"readValueType",null);var A=O=F=(0,o.e)([(0,o.n)("esri.layers.support.Field")],O)},97033:function(e,t,n){n.d(t,{a:function(){return p},c:function(){return h},d:function(){return y}});var r=n(15671),i=n(43144),a=n(60136),u=n(29388),s=n(23132),o=n(77470),l=n(75610),c=n(36551),h=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).updating=!1,e.handleId=0,e.handles=new o.u,e.scheduleHandleId=0,e.pendingPromises=new Set,e}return(0,i.Z)(n,[{key:"destroy",value:function(){this.removeAll(),this.handles.destroy()}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,n,c.l)}},{key:"addWhen",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,n,c.f)}},{key:"addOnCollectionChange",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.initial,a=void 0!==i&&i,u=r.final,s=void 0!==u&&u,o=++this.handleId;return this.handles.add([(0,c.a)(e,"after-changes",this._createSyncUpdatingCallback(),c.U),(0,c.a)(e,"change",t,{onListenerAdd:a?function(e){return t({added:e.toArray(),removed:[]})}:void 0,onListenerRemove:s?function(e){return t({added:[],removed:e.toArray()})}:void 0})],o),{remove:function(){return n.handles.remove(o)}}}},{key:"addPromise",value:function(e){var t=this;if((0,l.t)(e))return e;var n=++this.handleId;this.handles.add({remove:function(){t.pendingPromises.delete(e)&&(0!==t.pendingPromises.size||t.handles.has(v)||t._set("updating",!1))}},n),this.pendingPromises.add(e),this._set("updating",!0);var r=function(){return t.handles.remove(n)};return e.then(r,r),e}},{key:"removeAll",value:function(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}},{key:"_installWatch",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,a=++this.handleId;r.sync||this._installSyncUpdatingWatch(e,a);var u=i(e,t,r);return this.handles.add(u,a),{remove:function(){return n.handles.remove(a)}}}},{key:"_installSyncUpdatingWatch",value:function(e,t){var n=this._createSyncUpdatingCallback(),r=(0,c.l)(e,n,{sync:!0,equals:function(){return!1}});return this.handles.add(r,t),r}},{key:"_createSyncUpdatingCallback",value:function(){var e=this;return function(){e.handles.remove(v),++e.scheduleHandleId;var t=e.scheduleHandleId;e._get("updating")||e._set("updating",!0),e.handles.add((0,s.B)((function(){t===e.scheduleHandleId&&(e._set("updating",e.pendingPromises.size>0),e.handles.remove(v))})),v)}}}]),n}(s.y);(0,s.e)([(0,s.d)({readOnly:!0})],h.prototype,"updating",void 0),h=(0,s.e)([(0,s.n)("esri.core.support.WatchUpdatingTracking")],h);var f,d,v=-42;(d=f||(f={}))[d.NONE=0]="NONE",d[d.SYNC=1]="SYNC",d[d.INIT=2]="INIT";var p=function(e){var t=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"destroy",value:function(){var e,t;this.destroyed||(null!==(e=this._get("handles"))&&void 0!==e&&e.destroy(),null===(t=this._get("updatingHandles"))||void 0===t||t.destroy())}},{key:"handles",get:function(){return this._get("handles")||new o.u}},{key:"updatingHandles",get:function(){return this._get("updatingHandles")||new h}}]),n}(e);return(0,s.e)([(0,s.d)({readOnly:!0})],t.prototype,"handles",null),(0,s.e)([(0,s.d)({readOnly:!0})],t.prototype,"updatingHandles",null),t=(0,s.e)([(0,s.n)("esri.core.HandleOwner")],t),t},y=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n)}(p(s.y));y=(0,s.e)([(0,s.n)("esri.core.HandleOwner")],y)},77470:function(e,t,n){n.d(t,{u:function(){return h}});var r=n(15671),i=n(43144),a=n(60136),u=n(29388),s=n(23132),o=n(80175),l=n(75610),c=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e))._groups=new Map,i}return(0,i.Z)(n,[{key:"destroy",value:function(){this.removeAll()}},{key:"size",get:function(){var e=0;return this._groups.forEach((function(t){e+=t.length})),e}},{key:"add",value:function(e,t){var n=this;if(!this._isHandle(e)&&!Array.isArray(e)&&!o.j.isCollection(e))return this;var r=this._getOrCreateGroup(t);return Array.isArray(e)||o.j.isCollection(e)?e.forEach((function(e){return n._isHandle(e)&&r.push(e)})):r.push(e),this.notifyChange("size"),this}},{key:"forEach",value:function(e,t){if("function"==typeof e)this._groups.forEach((function(t){return t.forEach(e)}));else{var n=this._getGroup(e);n&&t&&n.forEach(t)}}},{key:"has",value:function(e){return this._groups.has(this._ensureGroupKey(e))}},{key:"remove",value:function(e){if(Array.isArray(e)||o.j.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;for(var t=this._getGroup(e),n=0;n<t.length;n++)t[n].remove();return this._deleteGroup(e),this.notifyChange("size"),this}},{key:"removeAll",value:function(){return this._groups.forEach((function(e){for(var t=0;t<e.length;t++)e[t].remove()})),this._groups.clear(),this.notifyChange("size"),this}},{key:"_isHandle",value:function(e){return e&&!!e.remove}},{key:"_getOrCreateGroup",value:function(e){if(this.has(e))return this._getGroup(e);var t=[];return this._groups.set(this._ensureGroupKey(e),t),t}},{key:"_getGroup",value:function(e){return(0,l.q)(this._groups.get(this._ensureGroupKey(e)))}},{key:"_deleteGroup",value:function(e){return this._groups.delete(this._ensureGroupKey(e))}},{key:"_ensureGroupKey",value:function(e){return e||"_default_"}}]),n}(s.y);(0,s.e)([(0,s.d)({readOnly:!0})],c.prototype,"size",null);var h=c=(0,s.e)([(0,s.n)("esri.core.Handles")],c)},47626:function(e,t,n){n.d(t,{e:function(){return u}});var r=n(15671),i=n(43144),a=n(25316),u=function(){function e(t,n){(0,r.Z)(this,e),this._storage=new a.h,this._storage.maxSize=t,n&&this._storage.registerRemoveFunc("",n)}return(0,i.Z)(e,[{key:"put",value:function(e,t){this._storage.put(e,t,1,1)}},{key:"pop",value:function(e){return this._storage.pop(e)}},{key:"get",value:function(e){return this._storage.get(e)}},{key:"clear",value:function(){this._storage.clearAll()}},{key:"destroy",value:function(){this._storage.destroy()}}]),e}()},25316:function(e,t,n){n.d(t,{h:function(){return d},i:function(){return r},r:function(){return f},s:function(){return h}});var r,i,a=n(29439),u=n(37762),s=n(15671),o=n(43144),l=n(75610),c=n(23132),h=-3;(i=r||(r={}))[i.ALL=0]="ALL",i[i.SOME=1]="SOME";var f=function(){function e(t,n,r){(0,s.Z)(this,e),this._namespace=t,this._storage=n,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}return(0,o.Z)(e,[{key:"destroy",value:function(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}},{key:"namespace",get:function(){return this._namespace.slice(0,-1)}},{key:"hitRate",get:function(){return this._hit/(this._hit+this._miss)}},{key:"size",get:function(){return this._storage.size}},{key:"maxSize",get:function(){return this._storage.maxSize}},{key:"resetHitRate",value:function(){this._hit=this._miss=0}},{key:"put",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._storage.put(this._namespace+e,t,n,r)}},{key:"get",value:function(e){var t=this._storage.get(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}},{key:"pop",value:function(e){var t=this._storage.pop(this._namespace+e);return void 0===t?++this._miss:++this._hit,t}},{key:"updateSize",value:function(e,t,n){this._storage.updateSize(this._namespace+e,t,n)}},{key:"clear",value:function(){this._storage.clear(this._namespace)}},{key:"clearAll",value:function(){this._storage.clearAll()}},{key:"getStats",value:function(){return this._storage.getStats()}},{key:"resetStats",value:function(){this._storage.resetStats()}}]),e}(),d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10485760;(0,s.Z)(this,e),this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new c.ab,this._users=new c.ab}return(0,o.Z)(e,[{key:"destroy",value:function(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}},{key:"register",value:function(e){this._users.push(e)}},{key:"deregister",value:function(e){this._users.removeUnordered(e)}},{key:"registerRemoveFunc",value:function(e,t){this._removeFuncs.push([e,t])}},{key:"deregisterRemoveFunc",value:function(e){this._removeFuncs.filterInPlace((function(t){return t[0]!==e}))}},{key:"size",get:function(){return this._size}},{key:"maxSize",get:function(){return this._maxSize},set:function(e){this._maxSize=Math.max(e,0),this._checkSizeLimit()}},{key:"put",value:function(e,t,n,i){var a=this._db.get(e);if(a&&(this._size-=a.size,this._db.delete(e),a.entry!==t&&this._notifyRemove(e,a.entry,r.ALL)),n>this._maxSize)this._notifyRemove(e,t,r.ALL);else if(void 0!==t)if(!n||n<0)console.warn("Refusing to cache entry with invalid size "+n);else{var u=1+Math.max(i,h)-h;this._db.set(e,{entry:t,size:n,lifetime:u,lives:u}),this._size+=n,this._checkSizeLimit()}else console.warn("Refusing to cache undefined entry ")}},{key:"updateSize",value:function(e,t,n){var i=this._db.get(e);if(i&&i.entry===t){for(this._size-=i.size;n>this._maxSize;){var a=this._notifyRemove(e,t,r.SOME);if(!((0,l.r)(a)&&a>0))return void this._db.delete(e);n=a}i.size=n,this._size+=n,this._checkSizeLimit()}}},{key:"pop",value:function(e){var t=this._db.get(e);if(t)return this._size-=t.size,this._db.delete(e),++this._hit,t.entry;++this._miss}},{key:"get",value:function(e){var t=this._db.get(e);if(void 0!==t)return this._db.delete(e),t.lives=t.lifetime,this._db.set(e,t),++this._hit,t.entry;++this._miss}},{key:"getStats",value:function(){var e=this,t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},n={},r=new Array;this._db.forEach((function(t,i){var a=t.lifetime;r[a]=(r[a]||0)+t.size,e._users.forAll((function(e){var r=e.namespace;if(i.startsWith(r)){var a=n[r]||0;n[r]=a+t.size}}))}));var i={};this._users.forAll((function(e){var t=e.namespace;if(!isNaN(e.hitRate)&&e.hitRate>0){var r=n[t]||0;n[t]=r,i[t]=Math.round(100*e.hitRate)+"%"}else i[t]="0%"}));var a=Object.keys(n);a.sort((function(e,t){return n[t]-n[e]})),a.forEach((function(e){return t[e]=Math.round(n[e]/Math.pow(2,20))+"MB / "+i[e]}));for(var u=r.length-1;u>=0;--u){var s=r[u];s&&(t["Priority "+(u+h-1)]=Math.round(s/this.size*100)+"%")}return t}},{key:"resetStats",value:function(){this._hit=this._miss=0,this._users.forAll((function(e){return e.resetHitRate()}))}},{key:"clear",value:function(e){var t=this;this._db.forEach((function(n,i){i.startsWith(e)&&(t._size-=n.size,t._db.delete(i),t._notifyRemove(i,n.entry,r.ALL))}))}},{key:"clearAll",value:function(){var e=this;this._db.forEach((function(t,n){return e._notifyRemove(n,t.entry,r.ALL)})),this._size=0,this._db.clear()}},{key:"_getHitRate",value:function(){return this._hit/(this._hit+this._miss)}},{key:"_notifyRemove",value:function(e,t,n){var r;return this._removeFuncs.some((function(i){if(e.startsWith(i[0])){var a=i[1](t,n);return"number"==typeof a&&(r=a),!0}return!1})),r}},{key:"_checkSizeLimit",value:function(){if(!(this._size<=this._maxSize)){var e,t=(0,u.Z)(this._db);try{for(t.s();!(e=t.n()).done;){var n=(0,a.Z)(e.value,2),i=n[0],s=n[1];if(this._db.delete(i),s.lives<=1){this._size-=s.size;var o=this._notifyRemove(i,s.entry,r.SOME);(0,l.r)(o)&&o>0&&(this._size+=o,s.lives=s.lifetime,s.size=o,this._db.set(i,s))}else--s.lives,this._db.set(i,s);if(this._size<=.9*this.maxSize)return}}catch(c){t.e(c)}finally{t.f()}}}}]),e}()},62268:function(e,t,n){n.d(t,{h:function(){return h}});var r=n(60136),i=n(29388),a=n(37762),u=n(15671),s=n(43144),o=n(75610),l=n(23132),c=n(18392),h=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9,n=arguments.length>1?arguments[1]:void 0;(0,u.Z)(this,e),this.compareMinX=p,this.compareMinY=y,this._toBBox=function(e){return e},this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&("function"==typeof n?this._toBBox=n:this._initFormat(n)),this.clear()}return(0,s.Z)(e,[{key:"destroy",value:function(){this.clear(),T.prune(),S.prune(),E.prune(),F.prune()}},{key:"all",value:function(e){this._all(this.data,e)}},{key:"search",value:function(e,t){var n=this.data,r=this._toBBox;if(w(e,n))for(T.clear();n;){for(var i=0,a=n.children.length;i<a;i++){var u=n.children[i],s=n.leaf?r(u):u;w(e,s)&&(n.leaf?t(u):k(e,s)?this._all(u,t):T.push(u))}n=T.pop()}}},{key:"collides",value:function(e){var t=this.data,n=this._toBBox;if(!w(e,t))return!1;for(T.clear();t;){for(var r=0,i=t.children.length;r<i;r++){var a=t.children[r],u=t.leaf?n(a):a;if(w(e,u)){if(t.leaf||k(e,u))return!0;T.push(a)}}t=T.pop()}return!1}},{key:"load",value:function(e){if(!e.length)return this;if(e.length<this._minEntries){for(var t=0,n=e.length;t<n;t++)this.insert(e[t]);return this}var r=this._build(e.slice(0,e.length),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r,r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this}},{key:"insert",value:function(e){return e&&this._insert(e,this.data.height-1),this}},{key:"clear",value:function(){return this.data=new M([]),this}},{key:"remove",value:function(e){if(!e)return this;var t,n=this.data,r=null,i=0,a=!1,u=this._toBBox(e);for(E.clear(),F.clear();n||E.length>0;){var s;if(n||(n=(0,o.q)(E.pop()),r=E.data[E.length-1],i=null!==(s=F.pop())&&void 0!==s?s:0,a=!0),n.leaf&&-1!==(t=(0,o.v)(n.children,e,n.children.length,n.indexHint)))return n.children.splice(t,1),E.push(n),this._condense(E),this;a||n.leaf||!k(n,u)?r?(i++,n=r.children[i],a=!1):n=null:(E.push(n),F.push(i),i=0,r=n,n=n.children[0])}return this}},{key:"toJSON",value:function(){return this.data}},{key:"fromJSON",value:function(e){return this.data=e,this}},{key:"_all",value:function(e,t){var n=e;for(S.clear();n;){var r;if(!0===n.leaf){var i,u=(0,a.Z)(n.children);try{for(u.s();!(i=u.n()).done;){t(i.value)}}catch(s){u.e(s)}finally{u.f()}}else S.pushArray(n.children);n=null!==(r=S.pop())&&void 0!==r?r:null}}},{key:"_build",value:function(e,t,n,r){var i=n-t+1,a=this._maxEntries;if(i<=a){var u=new M(e.slice(t,n+1));return f(u,this._toBBox),u}r||(r=Math.ceil(Math.log(i)/Math.log(a)),a=Math.ceil(i/Math.pow(a,r-1)));var s=new Z([]);s.height=r;var o=Math.ceil(i/a),l=o*Math.ceil(Math.sqrt(a));b(e,t,n,l,this.compareMinX);for(var c=t;c<=n;c+=l){var h=Math.min(c+l-1,n);b(e,c,h,o,this.compareMinY);for(var d=c;d<=h;d+=o){var v=Math.min(d+o-1,h);s.children.push(this._build(e,d,v,r-1))}}return f(s,this._toBBox),s}},{key:"_chooseSubtree",value:function(e,t,n,r){for(;r.push(t),!0!==t.leaf&&r.length-1!==n;){for(var i=void 0,a=1/0,u=1/0,s=0,o=t.children.length;s<o;s++){var l=t.children[s],c=m(l),h=_(e,l)-c;h<u?(u=h,a=c<a?c:a,i=l):h===u&&c<a&&(a=c,i=l)}t=i||t.children[0]}return t}},{key:"_insert",value:function(e,t,n){var r=this._toBBox,i=n?e:r(e);E.clear();var a=this._chooseSubtree(i,this.data,t,E);for(a.children.push(e),v(a,i);t>=0&&E.data[t].children.length>this._maxEntries;)this._split(E,t),t--;this._adjustParentBBoxes(i,E,t)}},{key:"_split",value:function(e,t){var n=e.data[t],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var a=this._chooseSplitIndex(n,i,r);if(a){var u=n.children.splice(a,n.children.length-a),s=n.leaf?new M(u):new Z(u);s.height=n.height,f(n,this._toBBox),f(s,this._toBBox),t?e.data[t-1].children.push(s):this._splitRoot(n,s)}else console.log("  Error: assertion failed at PooledRBush._split: no valid split index")}},{key:"_splitRoot",value:function(e,t){this.data=new Z([e,t]),this.data.height=e.height+1,f(this.data,this._toBBox)}},{key:"_chooseSplitIndex",value:function(e,t,n){var r,i,a;r=i=1/0;for(var u=t;u<=n-t;u++){var s=d(e,0,u,this._toBBox),o=d(e,u,n,this._toBBox),l=x(s,o),c=m(s)+m(o);l<r?(r=l,a=u,i=c<i?c:i):l===r&&c<i&&(i=c,a=u)}return a}},{key:"_chooseSplitAxis",value:function(e,t,n){var r=e.leaf?this.compareMinX:p,i=e.leaf?this.compareMinY:y;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,i)&&e.children.sort(r)}},{key:"_allDistMargin",value:function(e,t,n,r){e.children.sort(r);for(var i=this._toBBox,a=d(e,0,t,i),u=d(e,n-t,n,i),s=g(a)+g(u),o=t;o<n-t;o++){var l=e.children[o];v(a,e.leaf?i(l):l),s+=g(a)}for(var c=n-t-1;c>=t;c--){var h=e.children[c];v(u,e.leaf?i(h):h),s+=g(u)}return s}},{key:"_adjustParentBBoxes",value:function(e,t,n){for(var r=n;r>=0;r--)v(t.data[r],e)}},{key:"_condense",value:function(e){for(var t=e.length-1;t>=0;t--){var n=e.data[t];if(0===n.children.length)if(t>0){var r=e.data[t-1],i=r.children;i.splice((0,o.v)(i,n,i.length,r.indexHint),1)}else this.clear();else f(n,this._toBBox)}}},{key:"_initFormat",value:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}]),e}();function f(e,t){d(e,0,e.children.length,t,e)}function d(e,t,n,r,i){i||(i=new M([])),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var a,u=t;u<n;u++)a=e.children[u],v(i,e.leaf?r(a):a);return i}function v(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function p(e,t){return e.minX-t.minX}function y(e,t){return e.minY-t.minY}function m(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function g(e){return e.maxX-e.minX+(e.maxY-e.minY)}function _(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function x(e,t){var n=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,i-n)*Math.max(0,a-r)}function k(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function w(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function b(e,t,n,r,i){for(var a=[t,n];a.length;){var u=(0,o.q)(a.pop()),s=(0,o.q)(a.pop());if(!(u-s<=r)){var l=s+Math.ceil((u-s)/r/2)*r;(0,c.a)(e,l,s,u,i),a.push(s,l,l,u)}}}var T=new l.ab,S=new l.ab,E=new l.ab,F=new l.ab({deallocator:void 0}),I=function(e){(0,r.Z)(n,e);var t=(0,i.Z)(n);function n(){var e;return(0,u.Z)(this,n),(e=t.apply(this,arguments)).height=1,e.indexHint=new o.g,e}return(0,s.Z)(n)}((0,s.Z)((function e(){(0,u.Z)(this,e),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}))),M=function(e){(0,r.Z)(n,e);var t=(0,i.Z)(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this)).children=e,r.leaf=!0,r}return(0,s.Z)(n)}(I),Z=function(e){(0,r.Z)(n,e);var t=(0,i.Z)(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this)).children=e,r.leaf=!1,r}return(0,s.Z)(n)}(I)},4720:function(e,t,n){n.d(t,{S:function(){return k},p:function(){return g}});var r,i=n(1413),a=n(15671),u=n(43144),s=n(60136),o=n(29388),l=n(23132),c=n(57714),h=n(70441),f=n(75610),d=n(44455),v=n(30709),p=n(78311),y=r=function(e){(0,s.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,a.Z)(this,n),(r=t.call(this,e)).cols=null,r.level=0,r.levelValue=null,r.origin=null,r.resolution=0,r.rows=null,r.scale=0,r}return(0,u.Z)(n,[{key:"clone",value:function(){return new r({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}}]),n}(h.l);(0,l.e)([(0,l.d)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],y.prototype,"cols",void 0),(0,l.e)([(0,l.d)({type:l.S,json:{write:!0}})],y.prototype,"level",void 0),(0,l.e)([(0,l.d)({type:String,json:{write:!0}})],y.prototype,"levelValue",void 0),(0,l.e)([(0,l.d)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],y.prototype,"origin",void 0),(0,l.e)([(0,l.d)({type:Number,json:{write:!0}})],y.prototype,"resolution",void 0),(0,l.e)([(0,l.d)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],y.prototype,"rows",void 0),(0,l.e)([(0,l.d)({type:Number,json:{write:!0}})],y.prototype,"scale",void 0);var m,g=y=r=(0,l.e)([(0,l.n)("esri.layers.support.LOD")],y),_=new c.s({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"}),x=m=function(e){(0,s.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,a.Z)(this,n),(r=t.call(this,e)).dpi=96,r.format=null,r.origin=null,r.minScale=0,r.maxScale=0,r.size=null,r.spatialReference=null,r}return(0,u.Z)(n,[{key:"isWrappable",get:function(){var e=this.spatialReference,t=this.origin;if(e&&t){var n=(0,v.b)(e);return e.isWrappable&&Math.abs(n.origin[0]-t.x)<=n.dx}return!1}},{key:"readOrigin",value:function(e,t){return v.j.fromJSON((0,i.Z)({spatialReference:t.spatialReference},e))}},{key:"lods",set:function(e){var t=this,n=0,r=0,i=[];this._levelToLOD={},e&&(n=-1/0,r=1/0,e.forEach((function(e){i.push(e.scale),n=e.scale>n?e.scale:n,r=e.scale<r?e.scale:r,t._levelToLOD[e.level]=e}))),this._set("scales",i),this._set("minScale",n),this._set("maxScale",r),this._set("lods",e),this._initializeUpsampleLevels()}},{key:"readSize",value:function(e,t){return[t.cols,t.rows]}},{key:"writeSize",value:function(e,t){t.cols=e[0],t.rows=e[1]}},{key:"zoomToScale",value:function(e){var t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];var n=Math.floor(e),r=n+1;return t[n]/Math.pow(t[n]/t[r],e-n)}},{key:"scaleToZoom",value:function(e){for(var t=this.scales,n=t.length-1,r=0;r<n;r++){var i=t[r],a=t[r+1];if(i<=e)return r;if(a===e)return r+1;if(i>e&&a<e)return r+Math.log(i/e)/Math.log(i/a)}return r}},{key:"snapScale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=this.scaleToZoom(e);return n%Math.floor(n)>=t?this.zoomToScale(Math.ceil(n)):this.zoomToScale(Math.floor(n))}},{key:"tileAt",value:function(e,t,n,r){var i,a,u=this.lodAt(e);if(!u)return null;if("number"==typeof t)i=t,a=n;else if((0,v.E)(t.spatialReference,this.spatialReference))i=t.x,a=t.y,r=n;else{var s=(0,v.M)(t,this.spatialReference);if((0,f.t)(s))return null;i=s.x,a=s.y,r=n}var o=u.resolution*this.size[0],l=u.resolution*this.size[1];return r||(r={id:null,level:0,row:0,col:0,extent:(0,p.u)()}),r.level=e,r.row=Math.floor((this.origin.y-a)/l+.001),r.col=Math.floor((i-this.origin.x)/o+.001),this.updateTileInfo(r),r}},{key:"updateTileInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.ExtrapolateOptions.NONE,n=this.lodAt(e.level);if(!n&&t===m.ExtrapolateOptions.POWER_OF_TWO){var r=this.lods[this.lods.length-1];r.level<e.level&&(n=r)}if(n){var i=e.level-n.level,a=n.resolution*this.size[0]/Math.pow(2,i),u=n.resolution*this.size[1]/Math.pow(2,i);e.id="".concat(e.level,"/").concat(e.row,"/").concat(e.col),e.extent||(e.extent=(0,p.u)()),e.extent[0]=this.origin.x+e.col*a,e.extent[1]=this.origin.y-(e.row+1)*u,e.extent[2]=e.extent[0]+a,e.extent[3]=e.extent[1]+u}}},{key:"upsampleTile",value:function(e){var t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}},{key:"getTileBounds",value:function(e,t){var n=this.lodAt(t.level).resolution,r=n*this.size[0],i=n*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*i,e[2]=e[0]+r,e[3]=e[1]+i,e}},{key:"lodAt",value:function(e){return this._levelToLOD&&this._levelToLOD[e]||null}},{key:"clone",value:function(){return m.fromJSON(this.write({}))}},{key:"getOrCreateCompatible",value:function(e,t){if(256===this.size[0]&&256===this.size[1])return 256===e?this:null;for(var n=[],r=this.lods.length,i=0;i<r;i++){var a=this.lods[i],u=a.resolution*t;n.push(new g({level:a.level,scale:a.scale,resolution:u}))}return new m({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:n})}},{key:"_initializeUpsampleLevels",value:function(){var e=this.lods;this._upsampleLevels=[];for(var t=null,n=0;n<e.length;n++){var r=e[n];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}}],[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.resolutionFactor,n=void 0===t?1:t,r=e.scales,i=e.size,a=void 0===i?256:i,u=e.spatialReference,s=void 0===u?v.k.WebMercator:u,o=e.numLODs,l=void 0===o?24:o;if(!(0,v.I)(s)){var c=[];if(r)for(var h=0;h<r.length;h++){var f=r[h];c.push({level:h,scale:f,resolution:f})}else for(var p=5e-4,y=l-1;y>=0;y--)c.unshift({level:y,scale:p,resolution:p}),p*=2;return new m({dpi:96,lods:c,origin:new v.j(0,0,s),size:[a,a],spatialReference:s})}var g=(0,v.b)(s),_=e.origin?new v.j({x:e.origin.x,y:e.origin.y,spatialReference:s}):new v.j(g?{x:g.origin[0],y:g.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),x=96,k=1/(39.37*(0,d.z)(s)*x),w=[];if(r)for(var b=0;b<r.length;b++){var T=r[b],S=T*k;w.push({level:b,scale:T,resolution:S})}else{var E=(0,v.h)(s)?512/a*591657527.5917094:256/a*591657527.591555,F=Math.ceil(l/n);w.push({level:0,scale:E,resolution:E*k});for(var I=1;I<F;I++){var M=E/Math.pow(2,n),Z=M*k;w.push({level:I,scale:M,resolution:Z}),E=M}}return new m({dpi:x,lods:w,origin:_,size:[a,a],spatialReference:s})}}]),n}(h.l);(0,l.e)([(0,l.d)({type:Number,json:{write:!0}})],x.prototype,"compressionQuality",void 0),(0,l.e)([(0,l.d)({type:Number,json:{write:!0}})],x.prototype,"dpi",void 0),(0,l.e)([(0,l.d)({type:String,json:{read:_.read,write:_.write,origins:{"web-scene":{read:!1,write:!1}}}})],x.prototype,"format",void 0),(0,l.e)([(0,l.d)({readOnly:!0})],x.prototype,"isWrappable",null),(0,l.e)([(0,l.d)({type:v.j,json:{write:!0}})],x.prototype,"origin",void 0),(0,l.e)([(0,v.o)("origin")],x.prototype,"readOrigin",null),(0,l.e)([(0,l.d)({type:[g],value:null,json:{write:!0}})],x.prototype,"lods",null),(0,l.e)([(0,l.d)({readOnly:!0})],x.prototype,"minScale",void 0),(0,l.e)([(0,l.d)({readOnly:!0})],x.prototype,"maxScale",void 0),(0,l.e)([(0,l.d)({readOnly:!0})],x.prototype,"scales",void 0),(0,l.e)([(0,l.d)({cast:function(e){return Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]}})],x.prototype,"size",void 0),(0,l.e)([(0,v.o)("size",["rows","cols"])],x.prototype,"readSize",null),(0,l.e)([(0,v.r)("size",{cols:{type:l.S},rows:{type:l.S}})],x.prototype,"writeSize",null),(0,l.e)([(0,l.d)({type:v.k,json:{write:!0}})],x.prototype,"spatialReference",void 0),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}((x=m=(0,l.e)([(0,l.n)("esri.layers.support.TileInfo")],x))||(x={}));var k=x},36638:function(e,t,n){n.d(t,{g:function(){return y},n:function(){return v},y:function(){return x}});var r,i=n(15671),a=n(43144),u=n(60136),s=n(29388),o=n(23132),l=n(70441),c=n(75610),h=n(30709),f={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},d={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function v(e,t,n){var r=new Date(e.getTime());if(t&&n){var i=d[n],a=i.getter,u=i.setter,s=i.multiplier;if("months"===n){var o=function(e,t){var n=new Date(e,t+1,1);return n.setDate(0),n.getDate()}(r.getFullYear(),r.getMonth()+t);r.getDate()>o&&r.setDate(o)}r[u](r[a]()+t*s)}return r}function p(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function y(e,t,n){return 0===e?0:e*f[t]/f[n]}var m=r=function(e){(0,u.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).end=null,r.start=null,r}return(0,a.Z)(n,[{key:"readEnd",value:function(e,t){return null!=t.end?new Date(t.end):null}},{key:"writeEnd",value:function(e,t){t.end=e?e.getTime():null}},{key:"isAllTime",get:function(){return this.equals(r.allTime)}},{key:"isEmpty",get:function(){return this.equals(r.empty)}},{key:"readStart",value:function(e,t){return null!=t.start?new Date(t.start):null}},{key:"writeStart",value:function(e,t){t.start=e?e.getTime():null}},{key:"clone",value:function(){return new r({end:this.end,start:this.start})}},{key:"equals",value:function(e){if(!e)return!1;var t=(0,c.r)(this.start)?this.start.getTime():this.start,n=(0,c.r)(this.end)?this.end.getTime():this.end,r=(0,c.r)(e.start)?e.start.getTime():e.start,i=(0,c.r)(e.end)?e.end.getTime():e.end;return t===r&&n===i}},{key:"expandTo",value:function(e){if(this.isEmpty||this.isAllTime)return this.clone();var t=(0,c.h)(this.start,(function(t){return p(t,e)})),n=(0,c.h)(this.end,(function(t){return v(p(t,e),1,e)}));return new r({start:t,end:n})}},{key:"intersection",value:function(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return r.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();var t,n,i=(0,c.E)(this.start,-1/0,(function(e){return e.getTime()})),a=(0,c.E)(this.end,1/0,(function(e){return e.getTime()})),u=(0,c.E)(e.start,-1/0,(function(e){return e.getTime()})),s=(0,c.E)(e.end,1/0,(function(e){return e.getTime()}));if(u>=i&&u<=a?t=u:i>=u&&i<=s&&(t=i),a>=u&&a<=s?n=a:s>=i&&s<=a&&(n=s),!isNaN(t)&&!isNaN(n)){var o=new r;return o.start=t===-1/0?null:new Date(t),o.end=n===1/0?null:new Date(n),o}return r.empty}},{key:"offset",value:function(e,t){if(this.isEmpty||this.isAllTime)return this.clone();var n=new r,i=this.start,a=this.end;return(0,c.r)(i)&&(n.start=v(i,e,t)),(0,c.r)(a)&&(n.end=v(a,e,t)),n}},{key:"union",value:function(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return g.clone();var t=(0,c.r)(this.start)&&(0,c.r)(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,n=(0,c.r)(this.end)&&(0,c.r)(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new r({start:t,end:n})}}],[{key:"allTime",get:function(){return g}},{key:"empty",get:function(){return _}}]),n}(l.l);(0,o.e)([(0,o.d)({type:Date,json:{write:{allowNull:!0}}})],m.prototype,"end",void 0),(0,o.e)([(0,h.o)("end")],m.prototype,"readEnd",null),(0,o.e)([(0,h.r)("end")],m.prototype,"writeEnd",null),(0,o.e)([(0,o.d)({readOnly:!0,json:{read:!1}})],m.prototype,"isAllTime",null),(0,o.e)([(0,o.d)({readOnly:!0,json:{read:!1}})],m.prototype,"isEmpty",null),(0,o.e)([(0,o.d)({type:Date,json:{write:{allowNull:!0}}})],m.prototype,"start",void 0),(0,o.e)([(0,h.o)("start")],m.prototype,"readStart",null),(0,o.e)([(0,h.r)("start")],m.prototype,"writeStart",null);var g=new(m=r=(0,o.e)([(0,o.n)("esri.TimeExtent")],m)),_=new m({start:void 0,end:void 0}),x=m},27264:function(e,t,n){n.d(t,{e:function(){return v},l:function(){return m},v:function(){return w}});var r,i=n(15671),a=n(43144),u=n(60136),s=n(29388),o=n(23132),l=n(36638),c=n(70441),h=n(75610),f=n(57714),d=n(30709),v=(0,f.o)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0}),p=r=function(e){(0,u.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).value=0,r.unit="milliseconds",r}return(0,a.Z)(n,[{key:"toMilliseconds",value:function(){return(0,l.g)(this.value,this.unit,"milliseconds")}},{key:"clone",value:function(){return new r({value:this.value,unit:this.unit})}}]),n}(c.l);(0,o.e)([(0,o.d)({type:Number,json:{write:!0},nonNullable:!0})],p.prototype,"value",void 0),(0,o.e)([(0,o.d)({type:v.apiValues,json:{type:v.jsonValues,read:v.read,write:v.write},nonNullable:!0})],p.prototype,"unit",void 0);var y,m=p=r=(0,o.e)([(0,o.n)("esri.TimeInterval")],p),g=y=function(e){(0,u.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).respectsDaylightSaving=!1,r.timezone=null,r}return(0,a.Z)(n,[{key:"readRespectsDaylightSaving",value:function(e,t){return void 0!==t.respectsDaylightSaving?t.respectsDaylightSaving:void 0!==t.respectDaylightSaving&&t.respectDaylightSaving}},{key:"clone",value:function(){var e=this.respectsDaylightSaving,t=this.timezone;return new y({respectsDaylightSaving:e,timezone:t})}}]),n}(c.l);(0,o.e)([(0,o.d)({type:Boolean,json:{write:!0}})],g.prototype,"respectsDaylightSaving",void 0),(0,o.e)([(0,d.o)("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],g.prototype,"readRespectsDaylightSaving",null),(0,o.e)([(0,o.d)({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],g.prototype,"timezone",void 0);var _,x=g=y=(0,o.e)([(0,o.n)("esri.layers.support.TimeReference")],g),k=_=function(e){(0,u.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).cumulative=!1,r.endField=null,r.fullTimeExtent=null,r.hasLiveData=!1,r.interval=null,r.startField=null,r.timeReference=null,r.trackIdField=null,r.useTime=!0,r}return(0,a.Z)(n,[{key:"readFullTimeExtent",value:function(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||2!==t.timeExtent.length)return null;var n=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new l.y({start:n,end:r})}},{key:"writeFullTimeExtent",value:function(e,t){e&&(0,h.r)(e.start)&&(0,h.r)(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}},{key:"readInterval",value:function(e,t){return t.timeInterval&&t.timeIntervalUnits?new m({value:t.timeInterval,unit:v.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new m({value:t.defaultTimeInterval,unit:v.fromJSON(t.defaultTimeIntervalUnits)}):null}},{key:"writeInterval",value:function(e,t){if(e){var n=e.toJSON();t.timeInterval=n.value,t.timeIntervalUnits=n.unit}else t.timeInterval=null,t.timeIntervalUnits=null}},{key:"clone",value:function(){var e=this.cumulative,t=this.endField,n=this.hasLiveData,r=this.interval,i=this.startField,a=this.timeReference,u=this.fullTimeExtent,s=this.trackIdField,o=this.useTime;return new _({cumulative:e,endField:t,hasLiveData:n,interval:r,startField:i,timeReference:(0,h.m)(a),fullTimeExtent:(0,h.m)(u),trackIdField:s,useTime:o})}}]),n}(c.l);(0,o.e)([(0,o.d)({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],k.prototype,"cumulative",void 0),(0,o.e)([(0,o.d)({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],k.prototype,"endField",void 0),(0,o.e)([(0,o.d)({type:l.y,json:{write:{enabled:!0,allowNull:!0}}})],k.prototype,"fullTimeExtent",void 0),(0,o.e)([(0,d.o)("fullTimeExtent",["timeExtent"])],k.prototype,"readFullTimeExtent",null),(0,o.e)([(0,d.r)("fullTimeExtent")],k.prototype,"writeFullTimeExtent",null),(0,o.e)([(0,o.d)({type:Boolean,json:{write:!0}})],k.prototype,"hasLiveData",void 0),(0,o.e)([(0,o.d)({type:m,json:{write:{enabled:!0,allowNull:!0}}})],k.prototype,"interval",void 0),(0,o.e)([(0,d.o)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],k.prototype,"readInterval",null),(0,o.e)([(0,d.r)("interval")],k.prototype,"writeInterval",null),(0,o.e)([(0,o.d)({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],k.prototype,"startField",void 0),(0,o.e)([(0,o.d)({type:x,json:{write:{enabled:!0,allowNull:!0}}})],k.prototype,"timeReference",void 0),(0,o.e)([(0,o.d)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],k.prototype,"trackIdField",void 0),(0,o.e)([(0,o.d)({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],k.prototype,"useTime",void 0);var w=k=_=(0,o.e)([(0,o.n)("esri.layers.support.TimeInfo")],k)},72820:function(e,t,n){n.d(t,{A:function(){return Z},B:function(){return C},C:function(){return N},D:function(){return j},E:function(){return w},F:function(){return x},G:function(){return O},H:function(){return H},I:function(){return p},M:function(){return f},N:function(){return m},O:function(){return A},R:function(){return S},S:function(){return B},V:function(){return E},Y:function(){return F},a:function(){return u},b:function(){return b},c:function(){return c},f:function(){return l},g:function(){return g},h:function(){return h},j:function(){return T},k:function(){return R},l:function(){return v},m:function(){return o},p:function(){return _},q:function(){return I},s:function(){return d},u:function(){return s},v:function(){return z},w:function(){return M},y:function(){return y},z:function(){return k}});var r=n(75610),i=n(80262),a=n(78311);function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:H;return[e[0],e[1],e[2],e[3],e[4],e[5]]}function s(e,t,n,r,i,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:u();return s[0]=e,s[1]=t,s[2]=n,s[3]=r,s[4]=i,s[5]=a,s}function o(e,t){var n=isFinite(e[2])||isFinite(e[5]);return new i.M(n?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function l(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function c(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function h(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function f(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length/3,i=e[0],a=e[1],u=e[2],s=e[3],o=e[4],l=e[5],c=0;c<r;c++)i=Math.min(i,t[n+3*c]),a=Math.min(a,t[n+3*c+1]),u=Math.min(u,t[n+3*c+2]),s=Math.max(s,t[n+3*c]),o=Math.max(o,t[n+3*c+1]),l=Math.max(l,t[n+3*c+2]);e[0]=i,e[1]=a,e[2]=u,e[3]=s,e[4]=o,e[5]=l}function d(e,t,n){var r=t.length,i=e[0],a=e[1],u=e[2],s=e[3],o=e[4],l=e[5];if(n)for(var c=0;c<r;c++){var h=t[c];i=Math.min(i,h[0]),a=Math.min(a,h[1]),u=Math.min(u,h[2]),s=Math.max(s,h[0]),o=Math.max(o,h[1]),l=Math.max(l,h[2])}else for(var f=0;f<r;f++){var d=t[f];i=Math.min(i,d[0]),a=Math.min(a,d[1]),s=Math.max(s,d[0]),o=Math.max(o,d[1])}e[0]=i,e[1]=a,e[2]=u,e[3]=s,e[4]=o,e[5]=l}function v(e){for(var t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function p(e){return e[0]>=e[3]?0:e[3]-e[0]}function y(e){return e[1]>=e[4]?0:e[4]-e[1]}function m(e){return e[2]>=e[5]?0:e[5]-e[2]}function g(e){var t=p(e),n=m(e),r=y(e);return Math.sqrt(t*t+n*n+r*r)}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return t[0]=e[0]+p(e)/2,t[1]=e[1]+y(e)/2,t[2]=e[2]+m(e)/2,t}function x(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return t[0]=p(e),t[1]=y(e),t[2]=m(e),t}function k(e){return Math.max(p(e),m(e),y(e))}function w(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function b(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function T(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function S(e,t){return!!(0,r.t)(t)||T(e,t)}function E(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e;return i[0]=e[0]+t,i[1]=e[1]+n,i[2]=e[2]+r,i[3]=e[3]+t,i[4]=e[4]+n,i[5]=e[5]+r,i}function F(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=e[0]+p(e)/2,i=e[1]+y(e)/2,a=e[2]+m(e)/2;return n[0]=r+(e[0]-r)*t,n[1]=i+(e[1]-i)*t,n[2]=a+(e[2]-a)*t,n[3]=r+(e[3]-r)*t,n[4]=i+(e[4]-i)*t,n[5]=a+(e[5]-a)*t,n}function I(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return n[0]=t[0],n[1]=t[1],n[2]=t[2],n!==e&&(n[3]=e[3],n[4]=e[4],n[5]=e[5]),n}function M(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return n[3]=t[0],n[4]=t[1],n[5]=t[2],n!==e&&(n[0]=e[0],n[1]=e[1],n[2]=e[2]),e}function Z(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function C(e){return e?Z(e,j):u(j)}function O(e,t){return t||(t=(0,a.u)()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function A(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function D(e){return 6===e.length}function B(e){return 0===p(e)&&0===y(e)&&0===m(e)}function R(e,t,n){if((0,r.t)(e)||(0,r.t)(t))return e===t;if(!D(e)||!D(t))return!1;if(n){for(var i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1}else for(var a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}function z(e,t,n,r,i,a){return s(e,t,n,r,i,a,P)}var N=[-1/0,-1/0,-1/0,1/0,1/0,1/0],j=[1/0,1/0,1/0,-1/0,-1/0,-1/0],H=[0,0,0,0,0,0],P=u()},78311:function(e,t,n){n.d(t,{D:function(){return C},E:function(){return E},F:function(){return b},H:function(){return A},I:function(){return D},J:function(){return B},K:function(){return R},M:function(){return p},R:function(){return F},U:function(){return I},a:function(){return o},b:function(){return x},c:function(){return c},d:function(){return M},e:function(){return s},f:function(){return h},g:function(){return k},h:function(){return d},j:function(){return w},l:function(){return m},m:function(){return f},o:function(){return l},p:function(){return _},q:function(){return S},s:function(){return y},u:function(){return u},w:function(){return T},x:function(){return v},y:function(){return g},z:function(){return Z}});var r=n(75610),i=n(2760),a=n(80262);function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z;return[e[0],e[1],e[2],e[3]]}function s(e){return[e[0],e[1],e[2],e[3]]}function o(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function l(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:u();return i[0]=e,i[1]=t,i[2]=n,i[3]=r,i}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u();return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function h(e,t){return new a.M({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function f(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function d(e,t,n){if((0,r.t)(t))o(n,e);else if("length"in t)O(t)?(n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.max(e[2],t[2]),n[3]=Math.max(e[3],t[3])):2!==t.length&&3!==t.length||(n[0]=Math.min(e[0],t[0]),n[1]=Math.min(e[1],t[1]),n[2]=Math.max(e[2],t[0]),n[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":n[0]=Math.min(e[0],t.xmin),n[1]=Math.min(e[1],t.ymin),n[2]=Math.max(e[2],t.xmax),n[3]=Math.max(e[3],t.ymax);break;case"point":n[0]=Math.min(e[0],t.x),n[1]=Math.min(e[1],t.y),n[2]=Math.max(e[2],t.x),n[3]=Math.max(e[3],t.y)}}function v(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=t.length,i=e[0],a=e[1],u=e[2],s=e[3],o=0;o<r;o++){var l=t[o];i=Math.min(i,l[0]),a=Math.min(a,l[1]),u=Math.max(u,l[0]),s=Math.max(s,l[1])}return n[0]=i,n[1]=a,n[2]=u,n[3]=s,n}function p(e){for(var t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function y(e){return(0,r.t)(e)||e[0]>=e[2]?0:e[2]-e[0]}function m(e){return e[1]>=e[3]?0:e[3]-e[1]}function g(e){return y(e)*m(e)}function _(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function x(e,t){return T(e,t[0],t[1])}function k(e,t){var n=t[3],r=.5*(e[0]+e[2]),i=Math.abs(t[0]-r),a=.5*(e[2]-e[0]);if(i>n+a)return!1;var u=.5*(e[1]+e[3]),s=.5*(e[3]-e[1]),o=Math.abs(t[1]-u);if(o>n+s)return!1;if(i<a||o<s)return!0;var l=i-a,c=o-s;return l*l+c*c<=n*n}function w(e,t,n){var r=e[0],i=e[1],a=e[2],u=e[3],s=t.x,o=t.y,l=n.x,c=n.y,h=function(e,t){return(c-o)*e+(s-l)*t+(l*o-s*c)<0},f=h(r,u),d=h(a,u),v=h(a,i),p=h(r,i);return!(f===d&&d===v&&v===p&&p===f||s<r&&l<r||s>a&&l>a||o>u&&c>u||o<i&&c<i)}function b(e,t){return T(e,t.x,t.y)}function T(e,t,n){return t>=e[0]&&n>=e[1]&&t<=e[2]&&n<=e[3]}function S(e,t,n){return t[0]>=e[0]-n&&t[1]>=e[1]-n&&t[0]<=e[2]+n&&t[1]<=e[3]+n}function E(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function F(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function I(e,t,n){if((0,r.t)(t))return o(n,e);var a=t[0],u=t[1],s=t[2],l=t[3];return n[0]=(0,i.o)(e[0],a,s),n[1]=(0,i.o)(e[1],u,l),n[2]=(0,i.o)(e[2],a,s),n[3]=(0,i.o)(e[3],u,l),n}function M(e,t){var n=(e[0]+e[2])/2,r=(e[1]+e[3])/2,i=Math.max(Math.abs(t[0]-n)-y(e)/2,0),a=Math.max(Math.abs(t[1]-r)-m(e)/2,0);return Math.sqrt(i*i+a*a)}function Z(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e;return r[0]=e[0]+t,r[1]=e[1]+n,r[2]=e[2]+t,r[3]=e[3]+n,r}function C(e){return e?o(e,R):u(R)}function O(e){return null!=e&&4===e.length}function A(e){return!(0!==y(e)&&isFinite(e[0])||0!==m(e)&&isFinite(e[1]))}function D(e,t){return O(e)&&O(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}var B=[-1/0,-1/0,1/0,1/0],R=[1/0,1/0,-1/0,-1/0],z=[0,0,0,0]},97866:function(e,t,n){n.d(t,{I:function(){return k},L:function(){return _},S:function(){return g},b:function(){return x},d:function(){return f},g:function(){return m},h:function(){return p},j:function(){return w},m:function(){return d},w:function(){return v},y:function(){return y}});var r=n(29439),i=n(75610),a=n(57714),u=n(96349),s={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},o=Object.values(s),l=new RegExp("^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(".concat(o.join("|"),"))(?:\\/(?:layers\\/)?(\\d+))?"),"i"),c=new RegExp("^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(".concat(o.join("|"),"))(?:\\/(?:layers\\/)?(\\d+))?"),"i"),h=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function f(e){return!!l.test(e)}function d(e){if((0,i.t)(e))return null;var t=(0,a.j)(e),n=t.path.match(l)||t.path.match(c);if(!n)return null;var u=(0,r.Z)(n,5),o=u[1],h=u[2],f=u[3],d=u[4],v=h.indexOf("/");return{title:p(-1!==v?h.slice(v+1):h),serverType:s[f.toLowerCase()],sublayer:null!=d&&""!==d?parseInt(d,10):null,url:{path:o}}}function v(e){var t=(0,a.j)(e).path.match(h);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function p(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function y(e,t){var n=[];if(e){var r=d(e);(0,i.r)(r)&&r.title&&n.push(r.title)}if(t){var a=p(t);n.push(a)}if(2===n.length){if(n[0].toLowerCase().includes(n[1].toLowerCase()))return n[0];if(n[1].toLowerCase().includes(n[0].toLowerCase()))return n[1]}return n.join(" - ")}function m(e){if(!e)return!1;var t=(e=e.toLowerCase()).includes(".arcgis.com/"),n=e.includes("//services")||e.includes("//tiles")||e.includes("//features");return t&&n}function g(e,t){return e?(0,a.C)((0,a.A)(e,t)):e}function _(e){var t=e.url;if(!t)return{url:t};t=(0,a.A)(t,e.logger);var n,r=(0,a.j)(t),u=d(r.path);if((0,i.r)(u))null!=u.sublayer&&null==e.layer.layerId&&(n=u.sublayer),t=u.url.path;else if(e.nonStandardUrlAllowed){var s=v(r.path);(0,i.r)(s)&&(t=s.serviceUrl,n=s.sublayerId)}return{url:(0,a.C)(t),layerId:n}}function x(e,t,n,r,i){(0,u.p)(t,r,"url",i),r.url&&null!=e.layerId&&(r.url=(0,a.G)(r.url,n,e.layerId.toString()))}function k(e){if(!e)return!1;var t=e.toLowerCase(),n=t.includes("/services/"),r=t.includes("/mapserver/wmsserver"),i=t.includes("/imageserver/wmsserver"),a=t.includes("/wmsserver");return n&&(r||i||a)}function w(e){if(!e)return!1;var t=new a.y((0,a.Q)(e)).authority.toLowerCase();return"server.arcgisonline.com"===t||"services.arcgisonline.com"===t}},38304:function(e,t,n){n.d(t,{a:function(){return c},e:function(){return o},i:function(){return v},n:function(){return s},u:function(){return f}});var r=n(74165),i=n(15861),a=n(75610),u=n(23132);function s(e,t,n){return(0,u.E)(e.map((function(e,r){return t.apply(n,[e,r])})))}function o(e,t,n){return l.apply(this,arguments)}function l(){return l=(0,i.Z)((0,r.Z)().mark((function e(t,n,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.E)(t.map((function(e,t){return n.apply(i,[e,t])})));case 2:return e.abrupt("return",e.sent.map((function(e){return e.value})));case 3:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function c(e){return h.apply(this,arguments)}function h(){return(h=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,a.t)(t)){e.next=2;break}return e.abrupt("return",{ok:!1,error:new Error("no promise provided")});case 2:return e.prev=2,e.t0=!0,e.next=6,t;case 6:return e.t1=e.sent,e.abrupt("return",{ok:e.t0,value:e.t1});case 10:return e.prev=10,e.t2=e.catch(2),e.abrupt("return",{ok:!1,error:e.t2});case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function f(e){return d.apply(this,arguments)}function d(){return(d=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=!0,e.next=4,t;case 4:return e.t1=e.sent,e.abrupt("return",{ok:e.t0,value:e.t1});case 8:return e.prev=8,e.t2=e.catch(0),e.abrupt("return",((0,u.M)(e.t2),{ok:!1,error:e.t2}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function v(e){if(!0===e.ok)return e.value;throw e.error}},48561:function(e,t,n){function r(e){return 32+e.length}function i(){return 16}function a(e){if(!e)return 0;var t=32;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];switch(typeof i){case"string":t+=r(i);break;case"number":t+=16;break;case"boolean":t+=4}}return t}function u(e,t){return 32+e.length*t}var s;n.d(t,{e:function(){return u},n:function(){return r},o:function(){return s},r:function(){return a},t:function(){return i}}),function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(s||(s={}))},69797:function(e,t,n){n.d(t,{i:function(){return r}});var r=new(n(57714).s)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})},86068:function(e,t,n){n.d(t,{i:function(){return u}});var r=n(75610),i=n(75370),a=n(33642),u={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new a.s(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return(0,r.t)(e.centroid)&&(e.centroid=(0,i.e)(new a.t,e.geometry,t.hasZ,t.hasM)),e.centroid}}},60912:function(e,t,n){n.d(t,{B:function(){return T},C:function(){return S},O:function(){return g},U:function(){return k},q:function(){return w},s:function(){return l},v:function(){return b}});var r=n(29439),i=n(75610),a=n(30604),u=function(e,t,n){return[t,n]},s=function(e,t,n){return[t,n,e[2]]},o=function(e,t,n){return[t,n,e[2],e[3]]};function l(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:(0,i.r)(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function c(e,t){var n=e.scale,r=e.translate;return Math.round((t-r[0])/n[0])}function h(e,t){var n=e.scale,r=e.translate;return Math.round((r[1]-t)/n[1])}function f(e,t,n){for(var r,i,a,u,s=[],o=0;o<n.length;o++){var l=n[o];o>0?(a=c(e,l[0]),u=h(e,l[1]),a===r&&u===i||(s.push(t(l,a-r,u-i)),r=a,i=u)):(r=c(e,l[0]),i=h(e,l[1]),s.push(t(l,r,i)))}return s.length>0?s:null}function d(e,t){var n=e.scale,r=e.translate;return t*n[0]+r[0]}function v(e,t){var n=e.scale;return e.translate[1]-t*n[1]}function p(e,t,n){var i=new Array(n.length);if(!n.length)return i;var a=(0,r.Z)(e.scale,2),u=a[0],s=a[1],o=d(e,n[0][0]),l=v(e,n[0][1]);i[0]=t(n[0],o,l);for(var c=1;c<n.length;c++){var h=n[c];o+=h[0]*u,l-=h[1]*s,i[c]=t(h,o,l)}return i}function y(e,t,n){for(var r=new Array(n.length),i=0;i<n.length;i++)r[i]=p(e,t,n[i]);return r}function m(e,t,n,r,i){return t.points=function(e,t,n,r){return f(e,n?r?o:s:r?s:u,t)}(e,n.points,r,i),t}function g(e,t,n,r,i){return t.x=c(e,n.x),t.y=h(e,n.y),t!==n&&(r&&(t.z=n.z),i&&(t.m=n.m)),t}function _(e,t,n,r,i){var a=function(e,t,n,r){for(var i=[],a=n?r?o:s:r?s:u,l=0;l<t.length;l++){var c=f(e,a,t[l]);c&&c.length>=3&&i.push(c)}return i.length?i:null}(e,n.rings,r,i);return a?(t.rings=a,t):null}function x(e,t,n,r,i){var a=function(e,t,n,r){for(var i=[],a=n?r?o:s:r?s:u,l=0;l<t.length;l++){var c=f(e,a,t[l]);c&&c.length>=2&&i.push(c)}return i.length?i:null}(e,n.paths,r,i);return a?(t.paths=a,t):null}function k(e,t){return e&&t?(0,a.l)(t)?g(e,{},t,!1,!1):(0,a.y)(t)?x(e,{},t,!1,!1):(0,a.c)(t)?_(e,{},t,!1,!1):(0,a.f)(t)?m(e,{},t,!1,!1):(0,a.s)(t)?function(e,t,n,r,i){return t.xmin=c(e,n.xmin),t.ymin=h(e,n.ymin),t.xmax=c(e,n.xmax),t.ymax=h(e,n.ymax),t!==n&&(r&&(t.zmin=n.zmin,t.zmax=n.zmax),i&&(t.mmin=n.mmin,t.mmax=n.mmax)),t}(e,{},t,!1,!1):null:null}function w(e,t,n,r,a){return(0,i.r)(n)&&(t.points=function(e,t,n,r){return p(e,n?r?o:s:r?s:u,t)}(e,n.points,r,a)),t}function b(e,t,n,r,a){return(0,i.t)(n)||(t.x=d(e,n.x),t.y=v(e,n.y),t!==n&&(r&&(t.z=n.z),a&&(t.m=n.m))),t}function T(e,t,n,r,a){return(0,i.r)(n)&&(t.rings=function(e,t,n,r){return y(e,n?r?o:s:r?s:u,t)}(e,n.rings,r,a)),t}function S(e,t,n,r,a){return(0,i.r)(n)&&(t.paths=function(e,t,n,r){return y(e,n?r?o:s:r?s:u,t)}(e,n.paths,r,a)),t}},28999:function(e,t,n){n.d(t,{r:function(){return u}});var r=n(37762),i=n(75610),a=n(69953);function u(e,t,n){if(n&&n.features&&n.hasZ){var u=(0,a.o)(n.geometryType,t,e.outSpatialReference);if(!(0,i.t)(u)){var s,o=(0,r.Z)(n.features);try{for(o.s();!(s=o.n()).done;){u(s.value.geometry)}}catch(l){o.e(l)}finally{o.f()}}}}},36551:function(e,t,n){n.d(t,{P:function(){return f},U:function(){return d},a:function(){return o},f:function(){return u},h:function(){return v},j:function(){return l},l:function(){return a},w:function(){return p}});var r=n(23132),i=n(75610);function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(e,t,n,c)}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return s(e,t,n,h)}function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,u=null,s=n.once?function(e,n){a(e)&&((0,i.d)(u),t(e,n))}:function(e,n){a(e)&&t(e,n)};if(u=(0,r.P)(e,s,n.sync,n.equals),n.initial){var o=e();s(o,o)}return u}function o(e,t,n){var u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=null,o=null,l=null;function c(){var e;s&&o&&(o.remove(),null!==(e=u.onListenerRemove)&&void 0!==e&&e.call(u,s),s=null,o=null)}function h(e){u.once&&u.once&&(0,i.d)(l),n(e)}var f=a(e,(function(e,n){var i;c(),(0,r.c)(e)&&(s=e,o=(0,r.f)(e,t,h),null===(i=u.onListenerAdd)||void 0===i||i.call(u,e))}),{sync:u.sync,initial:!0});return l=(0,r.g)((function(){f.remove(),c()}))}function l(e,t){return function(e,t,n){if((0,r.p)(n))return Promise.reject((0,r.m)());var a=e();if(null!==t&&void 0!==t&&t(a))return Promise.resolve(a);var u=null;function o(){u=(0,i.d)(u)}return new Promise((function(i,a){u=(0,r.h)([(0,r.v)(n,(function(){o(),a((0,r.m)())})),s(e,(function(e){o(),i(e)}),{sync:!1,once:!0},null!==t&&void 0!==t?t:c)])}))}(e,h,t)}function c(e){return!0}function h(e){return!!e}function f(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!1,i=a(e,(function(e,n){r||t(e,n)}),n);return{remove:function(){i.remove()},pause:function(){r=!0},resume:function(){r=!1}}}var d={sync:!0},v={initial:!0},p={sync:!0,initial:!0}}}]);
//# sourceMappingURL=6632.987f5a95.chunk.js.map