"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[8388],{88388:function(e,t,n){n.r(t),n.d(t,{ElevationQuery:function(){return g},GeometryDescriptor:function(){return w},getFinestLodIndex:function(){return E}});var r=n(60136),a=n(29388),i=n(37762),o=n(74165),l=n(1413),s=n(15861),u=n(15671),c=n(43144),f=n(38304),p=n(23132),h=n(75610),v=n(44455),y=n(36460),m=n(30709),d=n(63022),x=n(78311),k=n(83059),Z=(n(21583),n(57714),n(80262),n(70441),n(2760),n(80175),n(61340),n(33703),n(69953),n(91204),function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if((0,u.Z)(this,e),this.tile=t,this.zmin=0,this.zmax=0,(0,h.r)(n)){var r=t.extent;this.samplerData={pixelData:n.values,width:n.width,height:n.height,safeWidth:.99999999*(n.width-1),noDataValue:n.noDataValue,dx:(n.width-1)/(r[2]-r[0]),dy:(n.width-1)/(r[3]-r[1]),x0:r[0],y1:r[3]},this.zmin=n.minValue,this.zmax=n.maxValue}}return(0,c.Z)(e,[{key:"sample",value:function(e,t){if(!(0,h.t)(this.samplerData)){var n=this.samplerData,r=n.safeWidth,a=n.width,i=n.pixelData,o=n.noDataValue,l=n.dx,s=n.dy,u=n.y1,c=n.x0,f=T(s*(u-t),0,r),p=T(l*(e-c),0,r),v=Math.floor(f),y=Math.floor(p),m=v*a+y,d=m+a,x=i[m],k=i[d],Z=i[m+1],g=i[d+1];if(x!==o&&k!==o&&Z!==o&&g!==o){var w=p-y,R=x+(Z-x)*w;return R+(k+(g-k)*w-R)*(f-v)}}}}]),e}());function T(e,t,n){return e<t?t:e>n?n:e}var g=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,[{key:"queryAll",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n,r){var a,i,s,u,c;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=r&&r.ignoreInvisibleLayers?t.filter((function(e){return e.visible})):t.slice()).length){e.next=2;break}throw new p.a("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");case 2:return a=w.fromGeometry(n),i=!1,r&&r.returnSampleInfo||(i=!0),s=(0,l.Z)((0,l.Z)((0,l.Z)({},A),r),{},{returnSampleInfo:!0}),e.next=8,this.query(t[t.length-1],a,s);case 8:return u=e.sent,e.next=11,this._queryAllContinue(t,u,s);case 11:return c=e.sent,e.abrupt("return",(c.geometry=c.geometry.export(),i&&delete c.sampleInfo,c));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"query",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n,r){var a,i,s;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new p.a("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");case 2:if(n&&(n instanceof w||"point"===n.type||"multipoint"===n.type||"polyline"===n.type)){e.next=4;break}throw new p.a("elevation-query:invalid-geometry","Only point, polyline and multipoint geometries can be used to query elevation");case 4:return a=(0,l.Z)((0,l.Z)({},A),r),i=new _(t,n.spatialReference,a),s=a.signal,e.next=7,t.load({signal:s});case 7:return e.next=9,this._createGeometryDescriptor(i,n,s);case 9:return e.next=11,this._selectTiles(i,s);case 11:return e.next=13,this._populateElevationTiles(i,s);case 13:return this._sampleGeometryWithElevation(i),e.abrupt("return",this._createQueryResult(i,s));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createSampler",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n,r){var a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new p.a("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");case 2:if(n&&"extent"===n.type){e.next=4;break}throw new p.a("elevation-query:invalid-extent","Invalid or undefined extent");case 4:return a=(0,l.Z)((0,l.Z)({},A),r),e.abrupt("return",this._createSampler(t,n,a));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"createSamplerAll",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n,r){var a,i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=r&&r.ignoreInvisibleLayers?t.filter((function(e){return e.visible})):t.slice()).length){e.next=2;break}throw new p.a("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");case 2:if(n&&"extent"===n.type){e.next=4;break}throw new p.a("elevation-query:invalid-extent","Invalid or undefined extent");case 4:return a=(0,l.Z)((0,l.Z)((0,l.Z)({},A),r),{},{returnSampleInfo:!0}),e.next=7,this._createSampler(t[t.length-1],n,a);case 7:return i=e.sent,e.abrupt("return",this._createSamplerAllContinue(t,n,i,a));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_createSampler",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n,r,a){var i,l,s,u;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.signal,e.next=3,t.load({signal:i});case 3:if(l=n.spatialReference,s=t.tileInfo.spatialReference,e.t0=l.equals(s),e.t0){e.next=9;break}return e.next=8,(0,d.f)([{source:l,dest:s}],{signal:i});case 8:n=(0,d.r)(n,s);case 9:return u=new b(t,n,r,a),e.next=12,this._selectTiles(u,i);case 12:return e.next=14,this._populateElevationTiles(u,i);case 14:return e.abrupt("return",new k.p(u.elevationTiles,u.layer.tileInfo,u.options.noDataValue));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"_createSamplerAllContinue",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n,r,a){var i,l,s,u;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.pop(),t.length){e.next=2;break}return e.abrupt("return",r);case 2:return i=r.samplers.map((function(e){return(0,x.c)(e.extent)})),e.next=5,this._createSampler(t[t.length-1],n,a,i);case 5:if(0!==(l=e.sent).samplers.length){e.next=8;break}return e.abrupt("return",r);case 8:return s=r.samplers.concat(l.samplers),u=new k.p(s,a.noDataValue),e.abrupt("return",this._createSamplerAllContinue(t,n,u,a));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"_queryAllContinue",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n,r){var a,i,l,s,u,c,f,p;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=t.pop(),i=n.geometry.coordinates,l=[],s=[],u=0;u<i.length;u++)(c=n.sampleInfo[u]).demResolution>=0?c.source||(c.source=a):t.length&&(l.push(i[u]),s.push(u));if(t.length&&0!==l.length){e.next=4;break}return e.abrupt("return",n);case 4:return f=n.geometry.clone(l),e.next=7,this.query(t[t.length-1],f,r);case 7:return p=e.sent,e.abrupt("return",(s.forEach((function(e,t){i[e].z=p.geometry.coordinates[t].z,n.sampleInfo[e].demResolution=p.sampleInfo[t].demResolution})),this._queryAllContinue(t,n,r)));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_createQueryResult",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n){var r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.geometry.project(t.outSpatialReference,n);case 2:return e.t0=e.sent.export(),e.t1=t.options.noDataValue,r={geometry:e.t0,noDataValue:e.t1},e.abrupt("return",(t.options.returnSampleInfo&&(r.sampleInfo=this._extractSampleInfo(t)),t.geometry.coordinates.forEach((function(e){e.tile=null,e.elevationTile=null})),r));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_createGeometryDescriptor",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n,r){var a,i;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.layer.tileInfo.spatialReference,!(n instanceof w)){e.next=7;break}return e.next=4,n.project(i,r);case 4:a=e.sent,e.next=10;break;case 7:return e.next=9,(0,d.f)([{source:n.spatialReference,dest:i}],{signal:r});case 9:a=(0,d.r)(n,i);case 10:if(a){e.next=12;break}throw new p.a("elevation-query:spatial-reference-mismatch","Cannot query elevation in '".concat(n.spatialReference.wkid,"' on an elevation service in '").concat(i.wkid,"'"));case 12:t.geometry=w.fromGeometry(a);case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_selectTiles",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n){var r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.options.demResolution,"geometry"===t.type&&this._preselectOutsideLayerExtent(t),"number"!=typeof r){e.next=5;break}this._selectTilesClosestResolution(t),e.next=14;break;case 5:if("finest-contiguous"!==r){e.next=10;break}return e.next=8,this._selectTilesFinestContiguous(t,n);case 8:e.next=14;break;case 10:if("auto"===r){e.next=12;break}throw new p.a("elevation-query:invalid-dem-resolution","Invalid dem resolution value '".concat(r,'\', expected a number, "finest-contiguous" or "auto"'));case 12:return e.next=14,this._selectTilesAuto(t,n);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_preselectOutsideLayerExtent",value:function(e){if(!(0,h.t)(e.layer.fullExtent)){var t=new Z(null);t.sample=function(){return e.options.noDataValue},e.outsideExtentTile=t;var n=e.layer.fullExtent;e.geometry.coordinates.forEach((function(e){var r=e.x,a=e.y;(r<n.xmin||r>n.xmax||a<n.ymin||a>n.ymax)&&(e.elevationTile=t)}))}}},{key:"_selectTilesClosestResolution",value:function(e){var t=e.layer.tileInfo,n=this._findNearestDemResolutionLODIndex(t,e.options.demResolution);e.selectTilesAtLOD(n)}},{key:"_findNearestDemResolutionLODIndex",value:function(e,t){for(var n=t/(0,v.z)(e.spatialReference),r=e.lods[0],a=0,i=1;i<e.lods.length;i++){var o=e.lods[i];Math.abs(o.resolution-n)<Math.abs(r.resolution-n)&&(r=o,a=i)}return a}},{key:"_selectTilesFinestContiguous",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n){var r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=E(t.layer.tileInfo,t.options.minDemResolution),e.next=3,this._selectTilesFinestContiguousAt(t,r,n);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_selectTilesFinestContiguousAt",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n,r){var a,i,l;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.layer,t.selectTilesAtLOD(n),!(n<0)){e.next=3;break}return e.abrupt("return");case 3:if(i=a.tilemapCache,l=t.getTilesToFetch(),e.prev=4,!i){e.next=10;break}return e.next=8,(0,p.a6)(Promise.all(l.map((function(e){return i.fetchAvailability(e.level,e.row,e.col,{signal:r})}))),r);case 8:e.next=14;break;case 10:return e.next=12,this._populateElevationTiles(t,r);case 12:if(t.allElevationTilesFetched()){e.next=14;break}throw t.clearElevationTiles(),new p.a("elevation-query:has-unavailable-tiles");case 14:e.next=21;break;case 16:return e.prev=16,e.t0=e.catch(4),(0,p.M)(e.t0),e.next=21,this._selectTilesFinestContiguousAt(t,n-1,r);case 21:case"end":return e.stop()}}),e,this,[[4,16]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_populateElevationTiles",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n){var r,a,i,l,u;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.getTilesToFetch(),a={},i=t.options.cache,l=t.options.noDataValue,u=r.map(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(r){var s,u,c;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="".concat(t.layer.uid,":").concat(r.id,":").concat(l),u=(0,h.r)(i)?i.get(s):null,!(0,h.r)(u)){e.next=6;break}e.t0=u,e.next=9;break;case 6:return e.next=8,t.layer.fetchTile(r.level,r.row,r.col,{noDataValue:l,signal:n});case 8:e.t0=e.sent;case 9:c=e.t0,(0,h.r)(i)&&i.put(s,c),a[r.id]=new Z(r,c);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=3,(0,p.a6)((0,p.E)(u),n);case 3:t.populateElevationTiles(a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_selectTilesAuto",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n){var r,a,i,l;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._selectTilesAutoFinest(t),this._reduceTilesForMaximumRequests(t),r=t.layer.tilemapCache){e.next=4;break}return e.abrupt("return",this._selectTilesAutoPrefetchUpsample(t,n));case 4:return a=t.getTilesToFetch(),i={},l=a.map(function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var a,l;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={id:null,level:0,row:0,col:0,extent:(0,x.u)()},e.next=3,(0,f.a)(r.fetchAvailabilityUpsample(t.level,t.row,t.col,a,{signal:n}));case 3:!1===(l=e.sent).ok?(0,p.M)(l.error):i[t.id]=a;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=7,(0,p.a6)(Promise.all(l),n);case 7:t.remapTiles(i);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_reduceTilesForMaximumRequests",value:function(e){var t=e.layer.tileInfo,n=0,r={},a=function(e){e.id in r?r[e.id]++:(r[e.id]=1,n++)},i=function(e){var t=r[e.id];1===t?(delete r[e.id],n--):r[e.id]=t-1};e.forEachTileToFetch(a,i);for(var o=!0;o&&(o=!1,e.forEachTileToFetch((function(r){n<=e.options.maximumAutoTileRequests||(i(r),t.upsampleTile(r)&&(o=!0),a(r))}),i),o););}},{key:"_selectTilesAutoFinest",value:function(e){var t=E(e.layer.tileInfo,e.options.minDemResolution);e.selectTilesAtLOD(t,e.options.maximumAutoTileRequests)}},{key:"_selectTilesAutoPrefetchUpsample",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n){var r,a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.layer.tileInfo,e.next=3,this._populateElevationTiles(t,n);case 3:if(a=!1,t.forEachTileToFetch((function(e,t){r.upsampleTile(e)?a=!0:t()})),e.t0=a,!e.t0){e.next=9;break}return e.next=9,this._selectTilesAutoPrefetchUpsample(t,n);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_sampleGeometryWithElevation",value:function(e){e.geometry.coordinates.forEach((function(t){var n=t.elevationTile,r=e.options.noDataValue;if(n){var a=n.sample(t.x,t.y);(0,h.r)(a)?r=a:t.elevationTile=null}t.z=r}))}},{key:"_extractSampleInfo",value:function(e){var t=e.layer.tileInfo,n=(0,v.z)(t.spatialReference);return e.geometry.coordinates.map((function(r){var a=-1;return r.elevationTile&&r.elevationTile!==e.outsideExtentTile&&(a=t.lodAt(r.elevationTile.tile.level).resolution*n),{demResolution:a}}))}}]),e}(),w=function(){function e(){(0,u.Z)(this,e)}return(0,c.Z)(e,[{key:"export",value:function(){return this._exporter(this.coordinates,this.spatialReference)}},{key:"clone",value:function(t){var n=this,r=new e;return r.geometry=this.geometry,r.spatialReference=this.spatialReference,r.coordinates=t||this.coordinates.map((function(e){return n._cloneCoordinate(e)})),r._exporter=this._exporter,r}},{key:"project",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t,n){var r,a,i,l,s=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.spatialReference.equals(t)){e.next=2;break}return e.abrupt("return",this.clone());case 2:return e.next=4,(0,d.f)([{source:this.spatialReference,dest:t}],{signal:n});case 4:if(r=new y.a({spatialReference:this.spatialReference,points:this.coordinates.map((function(e){return[e.x,e.y]}))}),a=(0,d.r)(r,t)){e.next=7;break}return e.abrupt("return",null);case 7:return i=this.coordinates.map((function(e,t){var n=s._cloneCoordinate(e),r=a.points[t];return n.x=r[0],n.y=r[1],n})),l=this.clone(i),e.abrupt("return",(l.spatialReference=t,l));case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_cloneCoordinate",value:function(e){return{x:e.x,y:e.y,z:e.z,m:e.m,tile:null,elevationTile:null}}}],[{key:"fromGeometry",value:function(t){var n=new e;if(n.geometry=t,n.spatialReference=t.spatialReference,t instanceof e)n.coordinates=t.coordinates.map((function(e){return n._cloneCoordinate(e)})),n._exporter=function(e,n){var r=t.clone(e);return r.spatialReference=n,r};else switch(t.type){case"point":var r=t,a=r.hasZ,o=r.hasM;n.coordinates=a&&o?[{x:r.x,y:r.y,z:r.z,m:r.m}]:a?[{x:r.x,y:r.y,z:r.z}]:o?[{x:r.x,y:r.y,m:r.m}]:[{x:r.x,y:r.y}],n._exporter=function(e,n){return t.hasM?new m.j(e[0].x,e[0].y,e[0].z,e[0].m,n):new m.j(e[0].x,e[0].y,e[0].z,n)};break;case"multipoint":var l=t,s=l.hasZ,u=l.hasM;n.coordinates=s&&u?l.points.map((function(e){return{x:e[0],y:e[1],z:e[2],m:e[3]}})):s?l.points.map((function(e){return{x:e[0],y:e[1],z:e[2]}})):u?l.points.map((function(e){return{x:e[0],y:e[1],m:e[2]}})):l.points.map((function(e){return{x:e[0],y:e[1]}})),n._exporter=function(e,n){return t.hasM?new y.a({points:e.map((function(e){return[e.x,e.y,e.z,e.m]})),hasZ:!0,hasM:!0,spatiaReference:n}):new y.a(e.map((function(e){return[e.x,e.y,e.z]})),n)};break;case"polyline":var c,f=t,p=[],h=[],v=t.hasZ,d=t.hasM,x=0,k=(0,i.Z)(f.paths);try{for(k.s();!(c=k.n()).done;){var Z=c.value;if(h.push([x,x+Z.length]),x+=Z.length,v&&d){var T,g=(0,i.Z)(Z);try{for(g.s();!(T=g.n()).done;){var w=T.value;p.push({x:w[0],y:w[1],z:w[2],m:w[3]})}}catch(C){g.e(C)}finally{g.f()}}else if(v){var R,_=(0,i.Z)(Z);try{for(_.s();!(R=_.n()).done;){var b=R.value;p.push({x:b[0],y:b[1],z:b[2]})}}catch(C){_.e(C)}finally{_.f()}}else if(d){var E,A=(0,i.Z)(Z);try{for(A.s();!(E=A.n()).done;){var q=E.value;p.push({x:q[0],y:q[1],m:q[2]})}}catch(C){A.e(C)}finally{A.f()}}else{var z,D=(0,i.Z)(Z);try{for(D.s();!(z=D.n()).done;){var I=z.value;p.push({x:I[0],y:I[1]})}}catch(C){D.e(C)}finally{D.f()}}}}catch(C){k.e(C)}finally{k.f()}n.coordinates=p,n._exporter=function(e,n){var r=t.hasM?e.map((function(e){return[e.x,e.y,e.z,e.m]})):e.map((function(e){return[e.x,e.y,e.z]})),a=h.map((function(e){return r.slice(e[0],e[1])}));return new y.m({paths:a,hasM:t.hasM,hasZ:!0,spatialReference:n})}}return n}}]),e}(),R=(0,c.Z)((function e(t,n){(0,u.Z)(this,e),this.layer=t,this.options=n})),_=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e,r,a){var i;return(0,u.Z)(this,n),(i=t.call(this,e,a)).outSpatialReference=r,i.type="geometry",i}return(0,c.Z)(n,[{key:"selectTilesAtLOD",value:function(e){if(e<0)this.geometry.coordinates.forEach((function(e){return e.tile=null}));else{var t=this.layer.tileInfo,n=t.lods[e].level;this.geometry.coordinates.forEach((function(e){e.tile=t.tileAt(n,e.x,e.y)}))}}},{key:"allElevationTilesFetched",value:function(){return!this.geometry.coordinates.some((function(e){return!e.elevationTile}))}},{key:"clearElevationTiles",value:function(){var e,t=(0,i.Z)(this.geometry.coordinates);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.elevationTile!==this.outsideExtentTile&&(n.elevationTile=null)}}catch(r){t.e(r)}finally{t.f()}}},{key:"populateElevationTiles",value:function(e){var t,n=(0,i.Z)(this.geometry.coordinates);try{for(n.s();!(t=n.n()).done;){var r=t.value;!r.elevationTile&&r.tile&&(r.elevationTile=e[r.tile.id])}}catch(a){n.e(a)}finally{n.f()}}},{key:"remapTiles",value:function(e){var t,n=(0,i.Z)(this.geometry.coordinates);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.tile=e[r.tile.id]}}catch(a){n.e(a)}finally{n.f()}}},{key:"getTilesToFetch",value:function(){var e,t={},n=[],r=(0,i.Z)(this.geometry.coordinates);try{for(r.s();!(e=r.n()).done;){var a=e.value,o=a.tile;a.elevationTile||!a.tile||t[o.id]||(t[o.id]=o,n.push(o))}}catch(l){r.e(l)}finally{r.f()}return n}},{key:"forEachTileToFetch",value:function(e){var t,n=(0,i.Z)(this.geometry.coordinates);try{var r=function(){var n=t.value;n.tile&&!n.elevationTile&&e(n.tile,(function(){return n.tile=null}))};for(n.s();!(t=n.n()).done;)r()}catch(a){n.e(a)}finally{n.f()}}}]),n}(R),b=function(e){(0,r.Z)(n,e);var t=(0,a.Z)(n);function n(e,r,a,i){var o;return(0,u.Z)(this,n),(o=t.call(this,e,a)).type="extent",o.elevationTiles=[],o.candidateTiles=[],o.fetchedCandidates=new Set,o.extent=r.intersection(e.fullExtent),o.maskExtents=i,o}return(0,c.Z)(n,[{key:"selectTilesAtLOD",value:function(e,t){var n=this._maximumLodForRequests(t),r=Math.min(n,e);r<0?this.candidateTiles.length=0:this._selectCandidateTilesCoveringExtentAt(r)}},{key:"_maximumLodForRequests",value:function(e){var t=this.layer.tileInfo;if(!e)return t.lods.length-1;var n=this.extent;if((0,h.t)(n))return-1;for(var r=t.lods.length-1;r>=0;r--){var a=t.lods[r],i=a.resolution*t.size[0],o=a.resolution*t.size[1];if(Math.ceil(n.width/i)*Math.ceil(n.height/o)<=e)return r}return-1}},{key:"allElevationTilesFetched",value:function(){return this.candidateTiles.length===this.elevationTiles.length}},{key:"clearElevationTiles",value:function(){this.elevationTiles.length=0,this.fetchedCandidates.clear()}},{key:"populateElevationTiles",value:function(e){var t,n=(0,i.Z)(this.candidateTiles);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=e[r.id];a&&(this.fetchedCandidates.add(r),this.elevationTiles.push(a))}}catch(o){n.e(o)}finally{n.f()}}},{key:"remapTiles",value:function(e){this.candidateTiles=this._uniqueNonOverlappingTiles(this.candidateTiles.map((function(t){return e[t.id]})))}},{key:"getTilesToFetch",value:function(){return this.candidateTiles}},{key:"forEachTileToFetch",value:function(e,t){var n=this,r=this.candidateTiles;this.candidateTiles=[],r.forEach((function(r){if(n.fetchedCandidates.has(r))t&&t(r);else{var a=!1;e(r,(function(){return a=!0})),a?t&&t(r):n.candidateTiles.push(r)}})),this.candidateTiles=this._uniqueNonOverlappingTiles(this.candidateTiles,t)}},{key:"_uniqueNonOverlappingTiles",value:function(e,t){var n,r={},a=[],o=(0,i.Z)(e);try{for(o.s();!(n=o.n()).done;){var l=n.value;r[l.id]?t&&t(l):(r[l.id]=l,a.push(l))}}catch(u){o.e(u)}finally{o.f()}var s=a.sort((function(e,t){return e.level-t.level}));return s.filter((function(e,n){for(var r=0;r<n;r++)if((0,x.R)(s[r].extent,e.extent))return t&&t(e),!1;return!0}))}},{key:"_selectCandidateTilesCoveringExtentAt",value:function(e){this.candidateTiles.length=0;var t=this.extent;if(!(0,h.t)(t))for(var n=this.layer.tileInfo,r=n.lods[e],a=n.tileAt(r.level,t.xmin,t.ymin),i=r.resolution*n.size[0],o=r.resolution*n.size[1],l=Math.ceil((t.xmax-a.extent[0])/i),s=Math.ceil((t.ymax-a.extent[1])/o),u=0;u<s;u++)for(var c=0;c<l;c++){var f={id:null,level:a.level,row:a.row-u,col:a.col+c};n.updateTileInfo(f),this._tileIsMasked(f)||this.candidateTiles.push(f)}}},{key:"_tileIsMasked",value:function(e){return!!this.maskExtents&&this.maskExtents.some((function(t){return(0,x.R)(t,e.extent)}))}}]),n}(R);function E(e,t){var n=e.lods.length-1;if(t>0){var r=e.lods.findIndex((function(e){return e.resolution<t}));0===r?n=0:r>0&&(n=r-1)}return n}var A={maximumAutoTileRequests:20,noDataValue:0,returnSampleInfo:!1,demResolution:"auto",minDemResolution:0}},83059:function(e,t,n){n.d(t,{h:function(){return d},p:function(){return m}});var r=n(37762),a=n(60136),i=n(29388),o=n(15671),l=n(43144),s=(n(91204),n(75610)),u=n(23132),c=n(44455),f=n(78311),p=n(30709),h=u.s.getLogger("esri.layers.support.ElevationSampler"),v=function(){function e(){(0,o.Z)(this,e)}return(0,l.Z)(e,[{key:"queryElevation",value:function(e){return d(e.clone(),this)}},{key:"on",value:function(){return Z}},{key:"projectIfRequired",value:function(e,t){return x(e,t)}}]),e}(),y=function(e){(0,a.Z)(n,e);var t=(0,i.Z)(n);function n(e,r,a){var i;(0,o.Z)(this,n),(i=t.call(this)).tile=e,i.noDataValue=a,i.extent=(0,f.f)(e.tile.extent,r.spatialReference),i.extent.zmin=e.zmin,i.extent.zmax=e.zmax,i.aaExtent=e.tile.extent;var l=(0,c.z)(r.spatialReference),s=r.lodAt(e.tile.level).resolution*l;return i.demResolution={min:s,max:s},i}return(0,l.Z)(n,[{key:"spatialReference",get:function(){return this.extent.spatialReference}},{key:"contains",value:function(e){var t=this.projectIfRequired(e,this.spatialReference);return!(0,s.t)(t)&&this.containsAt(t.x,t.y)}},{key:"containsAt",value:function(e,t){return(0,f.w)(this.aaExtent,e,t)}},{key:"elevationAt",value:function(e,t){if(!this.containsAt(e,t)){var n=this.extent,r="".concat(n.xmin,", ").concat(n.ymin,", ").concat(n.xmax,", ").concat(n.ymax);return h.warn("#elevationAt()","Point used to sample elevation (".concat(e,", ").concat(t,") is outside of the sampler extent (").concat(r,")")),this.noDataValue}return(0,s.n)(this.tile.sample(e,t),this.noDataValue)}}]),n}(v),m=function(e){(0,a.Z)(n,e);var t=(0,i.Z)(n);function n(e,r,a){var i,l;(0,o.Z)(this,n),i=t.call(this),"number"==typeof r?(i.noDataValue=r,l=null):(l=r,i.noDataValue=a),i.samplers=l?e.map((function(e){return new y(e,l,i.noDataValue)})):e;var s=i.samplers[0];if(s){i.extent=s.extent.clone();var u=s.demResolution,c=u.min,p=u.max;i.demResolution={min:c,max:p};for(var h=1;h<i.samplers.length;h++){var v=i.samplers[h];i.extent.union(v.extent),i.demResolution.min=Math.min(i.demResolution.min,v.demResolution.min),i.demResolution.max=Math.max(i.demResolution.max,v.demResolution.max)}}else i.extent=(0,f.f)((0,f.u)(),l.spatialReference),i.demResolution={min:0,max:0};return i}return(0,l.Z)(n,[{key:"spatialReference",get:function(){return this.extent.spatialReference}},{key:"elevationAt",value:function(e,t){var n,a=(0,r.Z)(this.samplers);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i.containsAt(e,t))return i.elevationAt(e,t)}}catch(o){a.e(o)}finally{a.f()}return h.warn("#elevationAt()","Point used to sample elevation (".concat(e,", ").concat(t,") is outside of the sampler")),this.noDataValue}}]),n}(v);function d(e,t){var n=x(e,t.spatialReference);if(!n)return null;switch(e.type){case"point":!function(e,t,n){e.z=n.elevationAt(t.x,t.y)}(e,n,t);break;case"polyline":!function(e,t,n){k.spatialReference=t.spatialReference;for(var r=e.hasM&&!e.hasZ,a=0;a<e.paths.length;a++)for(var i=e.paths[a],o=t.paths[a],l=0;l<i.length;l++){var s=i[l],u=o[l];k.x=u[0],k.y=u[1],r&&(s[3]=s[2]),s[2]=n.elevationAt(k.x,k.y)}e.hasZ=!0}(e,n,t);break;case"multipoint":!function(e,t,n){k.spatialReference=t.spatialReference;for(var r=e.hasM&&!e.hasZ,a=0;a<e.points.length;a++){var i=e.points[a],o=t.points[a];k.x=o[0],k.y=o[1],r&&(i[3]=i[2]),i[2]=n.elevationAt(k.x,k.y)}e.hasZ=!0}(e,n,t)}return e}function x(e,t){if((0,s.t)(e))return null;var n=e.spatialReference;if(n.equals(t))return e;var r=(0,p.M)(e,t);return r||h.error("Cannot project geometry spatial reference (wkid:".concat(n.wkid,") to elevation sampler spatial reference (wkid:").concat(t.wkid,")")),r}var k=new p.j,Z={remove:function(){}}},69953:function(e,t,n){n.d(t,{o:function(){return l}});var r=n(37762),a=n(75610),i=n(44455),o=n(30709);function l(e,t,n){if((0,a.t)(t)||(0,a.t)(n)||n.vcsWkid||(0,o.E)(t,n))return null;var l=(0,i.W)(t)/(0,i.W)(n);if(1===l)return null;switch(e){case"point":case"esriGeometryPoint":return function(e){return function(e,t){e&&null!=e.z&&(e.z*=t)}(e,l)};case"polyline":case"esriGeometryPolyline":return function(e){return function(e,t){if(e){var n,a=(0,r.Z)(e.paths);try{for(a.s();!(n=a.n()).done;){var i,o=n.value,l=(0,r.Z)(o);try{for(l.s();!(i=l.n()).done;){var s=i.value;s.length>2&&(s[2]*=t)}}catch(u){l.e(u)}finally{l.f()}}}catch(u){a.e(u)}finally{a.f()}}}(e,l)};case"polygon":case"esriGeometryPolygon":return function(e){return function(e,t){if(e){var n,a=(0,r.Z)(e.rings);try{for(a.s();!(n=a.n()).done;){var i,o=n.value,l=(0,r.Z)(o);try{for(l.s();!(i=l.n()).done;){var s=i.value;s.length>2&&(s[2]*=t)}}catch(u){l.e(u)}finally{l.f()}}}catch(u){a.e(u)}finally{a.f()}}}(e,l)};case"multipoint":case"esriGeometryMultipoint":return function(e){return function(e,t){if(e){var n,a=(0,r.Z)(e.points);try{for(a.s();!(n=a.n()).done;){var i=n.value;i.length>2&&(i[2]*=t)}}catch(o){a.e(o)}finally{a.f()}}}(e,l)};case"extent":case"esriGeometryExtent":return function(e){return function(e,t){e&&null!=e.zmin&&null!=e.zmax&&(e.zmin*=t,e.zmax*=t)}(e,l)};default:return null}}}}]);
//# sourceMappingURL=8388.5815118f.chunk.js.map