"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[8882],{68882:function(e,r,t){t.d(r,{j:function(){return I}});var n=t(74165),i=t(15861),u=t(11752),o=t(61120),a=t(60136),s=t(29388),l=t(37762),c=t(1413),y=t(15671),d=t(43144),h=t(48848),p=t(93661),f=t(50690),v=t(28390),m=t(41896),g=t(72770),_=t(43406),F=t(49871),Z=t(64998),w=t(59929),b=t(82474),k=t(69641),x=t(81216),C=t(57791),O=t(62004),M=t(52195),q=t(35264),R=function(){function e(r){(0,y.Z)(this,e),this._schedule=r,this._handle=new S(r)}return(0,d.Z)(e,[{key:"destroy",value:function(){this._handle.destroy()}},{key:"invoke",value:function(e,r){var t=this;return e.buffer&&0!==e.buffer.byteLength?(e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof b.k&&(e.options=(0,c.Z)((0,c.Z)({},e.options),{},{sourceSpatialReference:e.options.sourceSpatialReference.toJSON()})),this._handle.invoke(e,r).then((function(e){return t._schedule((function(){if(e.spatialReference=b.k.fromJSON(e.spatialReference),e.fields)for(var r=0;r<e.fields.length;r++)e.fields[r]=k.y.fromJSON(e.fields[r]);var t,n=e.spatialReference,i=(0,l.Z)(e.features);try{for(i.s();!(t=i.n()).done;){var u=t.value;u.uid=Z.g.generateUID(),(0,p.r)(u.geometry)&&(u.geometry.spatialReference=n)}}catch(o){i.e(o)}finally{i.f()}return e}))}))):Promise.resolve(null)}}]),e}(),S=function(e){(0,a.Z)(t,e);var r=(0,s.Z)(t);function t(e){return(0,y.Z)(this,t),r.call(this,"PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:function(e){return[e.buffer]}},e)}return(0,d.Z)(t)}(w.h),D=function(e){(0,a.Z)(t,e);var r=(0,s.Z)(t);function t(e){return(0,y.Z)(this,t),r.call(this,e)}return(0,d.Z)(t,[{key:"queryFeaturesDehydrated",get:function(){var e=this,r=this.layer.capabilities,t=r&&r.query;if(t&&t.supportsFormatPBF){var n,i;(0,p.t)(this._decoder)&&(this._decoder=new R(this.schedule));var u={sourceSpatialReference:null!==(n=null===(i=this.layer.spatialReference)||void 0===i?void 0:i.toJSON())&&void 0!==n?n:null,applyTransform:!0,maxStringAttributeLength:1024};return function(r,t){return(0,F.E)(e.layer.parsedUrl,r,"pbf",e._createRequestOptions(t)).then((function(r){return(0,h.f)(t),(0,p.r)(e._decoder)?e._decoder.invoke({buffer:r.data,options:u},t.signal):Promise.reject((0,h.d)())}))}}return function(r,t){return(0,F.c)(e.layer.parsedUrl,r,e.layer.spatialReference,e._createRequestOptions(t)).then((function(e){return(0,_.z)(e.data)}))}}},{key:"queryFeatureCount",value:function(e,r){return this.layer.queryFeatureCount(e,r)}},{key:"destroy",value:function(){this._decoder=(0,p.g)(this._decoder)}},{key:"_createRequestOptions",value:function(e){return(0,c.Z)((0,c.Z)({},e),{},{query:(0,c.Z)((0,c.Z)({},this.layer.customParameters),{},{token:this.layer.apiKey},null===e||void 0===e?void 0:e.query)})}}]),t}(h.m);(0,h.e)([(0,h.y)({constructOnly:!0})],D.prototype,"layer",void 0),(0,h.e)([(0,h.y)({constructOnly:!0})],D.prototype,"schedule",void 0),(0,h.e)([(0,h.y)({readOnly:!0})],D.prototype,"queryFeaturesDehydrated",null),D=(0,h.e)([(0,h.n)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],D);var T=function(e){(0,a.Z)(t,e);var r=(0,s.Z)(t);function t(e){return(0,y.Z)(this,t),r.call(this,e)}return(0,d.Z)(t,[{key:"queryFeaturesDehydrated",value:function(e,r){return this.layer.queryFeatures(e,r)}},{key:"queryFeatureCount",value:function(e,r){return this.layer.queryFeatureCount(e,r)}}]),t}(h.m);(0,h.e)([(0,h.y)({constructOnly:!0})],T.prototype,"layer",void 0),(0,h.e)([(0,h.y)({readOnly:!0})],T.prototype,"queryFeaturesDehydrated",null),T=(0,h.e)([(0,h.n)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],T);var V=function(e){(0,a.Z)(t,e);var r=(0,s.Z)(t);function t(e){return(0,y.Z)(this,t),r.call(this,e)}return(0,d.Z)(t,[{key:"queryFeaturesDehydrated",value:function(e,r){return this.layer.queryFeatures(e,r)}}]),t}(h.m);(0,h.e)([(0,h.y)({constructOnly:!0})],V.prototype,"layer",void 0),V=(0,h.e)([(0,h.n)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],V);var N=function(e){(0,a.Z)(t,e);var r=(0,s.Z)(t);function t(e){return(0,y.Z)(this,t),r.call(this,e)}return(0,d.Z)(t,[{key:"queryFeaturesDehydrated",value:function(e,r){var t=this;return this.source.queryFeaturesJSON(e,r).then(_.z,(function(n){if(n&&"query-features-json:unsupported"===n.name)return t.layer.queryFeatures(e,r);throw n}))}},{key:"queryFeatureCount",value:function(e,r){return this.layer.queryFeatureCount(e,r)}}]),t}(h.m);(0,h.e)([(0,h.y)({constructOnly:!0})],N.prototype,"layer",void 0),(0,h.e)([(0,h.y)({constructOnly:!0})],N.prototype,"source",void 0),N=(0,h.e)([(0,h.n)("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],N);var P=function(){function e(r){(0,y.Z)(this,e),this._memoryCache=null,this._capabilities=null;var t=r.layerView.layer;this._layerView=r.layerView,this.objectIdField=t.objectIdField,this.globalIdField="globalIdField"in t?t.globalIdField:null,this._returnZ=r.returnZ,this._returnM=r.returnM;var n=this._layerView.view.resourceController;this.query=function(e,r){return"feature"===e.type&&"feature-layer"===e.source.type?(0,p.r)(e.infoFor3D)?new T({layer:e}):new D({layer:e,schedule:r}):"feature"===e.type&&"memory"===e.source.type||"csv"===e.type||"geojson"===e.type||"oriented-imagery"===e.type||"wfs"===e.type?new N({layer:e,source:e.source}):"ogc-feature"===e.type?new V({layer:e}):null}(t,(function(e){return n.schedule(e)})),n&&this._memoryCacheEnabled&&(this._memoryCache=n.memoryController.newCache(t.uid))}return(0,d.Z)(e,[{key:"_memoryCacheEnabled",get:function(){switch(this._layerView.layer.source.type){case"feature-layer":case"ogc-feature":case"oriented-imagery":return!0;case"csv":case"geojson":case"memory":case"wfs":return!1}}},{key:"destroy",value:function(){this._memoryCache=(0,p.g)(this._memoryCache),this.query.destroy()}},{key:"createQuery",value:function(){var e=this._layerView.layer.createQuery();return e.outFields=this._layerView.availableFields,e.returnZ=this._returnZ,e.returnM=this._returnM,e.outSpatialReference=this.tilingScheme.spatialReference,e}},{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this._layerView.view.state.viewingMode}},{key:"tilingScheme",get:function(){return this._layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){var e=this._layerView.view.resourceController;return e?e.scheduler:null}},{key:"geometryType",get:function(){return this._layerView.layer.geometryType}},{key:"fullExtent",get:function(){return this._layerView.layer.fullExtent}},{key:"tileMaxRecordCount",get:function(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this._layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return(0,p.r)(this._capabilities)||(this._capabilities=(0,m.L)(this._layerView.layer)),this._capabilities}},{key:"logFetchError",value:function(e,r){e.error("#fetchTile()",this._layerView.layer,r&&r.message?r.message:r)}}]),e}(),Q=function(e){(0,a.Z)(t,e);var r=(0,s.Z)(t);function t(e){var n;return(0,y.Z)(this,t),(n=r.call(this,e))._controllerTotal=0,n._processorTotal=0,n.suspendResumeExtentMode="data",n}return(0,d.Z)(t,[{key:"initialize",value:function(){var e=this;this.handles.add((0,f.l)((function(){return e._updatingRequiredFieldsPromise}),(function(r){return e.updatingHandles.addPromise(r)}),f.w))}},{key:"destroy",value:function(){this.updatingHandles.removeAll(),this.handles.removeAll(),this._fetcherContext=(0,p.g)(this._fetcherContext)}},{key:"maximumNumberOfFeatures",get:function(){var e,r;return null!==(e=null===(r=this.controller)||void 0===r?void 0:r.maximumNumberOfFeatures)&&void 0!==e?e:this._get("maximumNumberOfFeatures")},set:function(e){this._set("maximumNumberOfFeatures",e),this.controller&&(this.controller.maximumNumberOfFeatures=e)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)}},{key:"updatingProgressValue",get:function(){var e,r,t=0;if(null!==(e=this.controller)&&void 0!==e&&e.updating){var n=this.controller.updatingRemaining,i=Math.max(this.controller.updatingTotal,this._controllerTotal);i>0&&(t=(i-n)/i,this._controllerTotal=i)}var u=0;if(null!==(r=this.processor)&&void 0!==r&&r.updating){var o=this.processor.updatingRemaining,a=Math.max(o,this._processorTotal);a>0&&(u=(a-o)/a,this._processorTotal=a)}return.5*(t+u)}},{key:"updatePolicy",get:function(){if(!this.controller)return C.i.ASYNC;switch(this.controller.mode){case"snapshot":var e=E[this.layer.geometryType];return null==e||this.controller.serviceDataCount>e?C.i.ASYNC:C.i.SYNC;case"tiles":return C.i.ASYNC}}},{key:"hasZ",get:function(){var e=this.layer,r=e.capabilities&&e.capabilities.data;return!(!r||!r.supportsZ)&&("returnZ"in e&&null!=e.returnZ?e.returnZ:r.supportsZ)}},{key:"hasM",get:function(){var e=this.layer,r=e.capabilities&&e.capabilities.data;return!(!r||!r.supportsM)&&"returnM"in e&&null!=e.returnM&&e.returnM}},{key:"setVisibility",value:function(e,r){var t;null===(t=this.processor)||void 0===t||t.setObjectIdVisibility(e,r)}},{key:"createQuery",value:function(){return(0,u.Z)((0,o.Z)(t.prototype),"createQuery",this).call(this)}},{key:"queryFeatures",value:function(e,r){var n=this,i=function(){return(0,u.Z)((0,o.Z)(t.prototype),"queryFeatures",n).call(n,e,r)};return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(e),i):i()}},{key:"beforeSetController",value:function(e){e.maximumNumberOfFeatures=this.maximumNumberOfFeatures}},{key:"createController",value:function(){var e=this;this._fetcherContext=new P({layerView:this,returnZ:this.hasZ,returnM:this.hasM});var r=new m.O({layerView:this,context:this._fetcherContext,graphics:new x.r,extent:this.clippingExtent});return this.updatingHandles.add((function(){return r.serviceDataExtent}),(function(r){e.processor&&(e.processor.dataExtent=r)}),f.h),this.handles.add((0,f.l)((function(){return e.suspended}),(function(e){e?r.suspend():r.resume()}),f.w)),this.updatingHandles.add((function(){var r;return null===(r=e.processor)||void 0===r?void 0:r.displayFeatureLimit}),(function(e){return r.displayFeatureLimit=e}),f.h),this.handles.add((0,f.f)((function(){return!e.updating}),(function(){e._controllerTotal=0,e._processorTotal=0}))),r}},{key:"doRefresh",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r&&!this.suspended&&this.controller&&this.controller.refetch(),this.processor.refreshFilter();case 1:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}()},{key:"getUsedMemory",value:function(){var e,r,t,n;return(null!==(e=null===(r=this.processor)||void 0===r?void 0:r.usedMemory)&&void 0!==e?e:0)+(null!==(t=null===(n=this.controller)||void 0===n?void 0:n.memoryForUnusedFeatures)&&void 0!==t?t:0)}},{key:"getUnloadedMemory",value:function(){var e,r,t,n,i,u,o,a,s=null!==(e=null===(r=this.processor)||void 0===r?void 0:r.unprocessedMemoryEstimate)&&void 0!==e?e:0,l=null!==(t=null===(n=this.controller)||void 0===n?void 0:n.expectedFeatureDiff)&&void 0!==t?t:0,c=null!==(i=null===(u=this.processor)||void 0===u?void 0:u.loadedFeatures)&&void 0!==i?i:0;return s+(0===c||l/c>20?0:l*(null!==(o=null===(a=this.processor)||void 0===a?void 0:a.usedMemoryPerFeature)&&void 0!==o?o:0))}},{key:"ignoresMemoryFactor",value:function(){var e;return null===(e=this.controller)||void 0===e?void 0:e.hasMaximumNumberOfFeaturesOverride}},{key:"_queryFeaturesMesh",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(r,t){var i,u,o,a,s,c,y,d;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._validateQueryFeaturesMesh(r);case 2:return e.next=4,t();case 4:if(i=e.sent,!(r&&r.outStatistics||(0,p.t)(this.graphics3DProcessor))){e.next=7;break}return e.abrupt("return",i);case 7:u=this.layer.objectIdField,o=this.graphics3DProcessor.graphics3DGraphicsByObjectID,a=[],s=(0,l.Z)(i.features);try{for(s.s();!(c=s.n()).done;)(y=c.value).geometry?(d=o.get(y.attributes[u]))&&(y.geometry=(0,v.Y)(d.graphic.geometry),a.push(y)):a.push(y)}catch(n){s.e(n)}finally{s.f()}return e.abrupt("return",(i.features=a,i));case 11:case"end":return e.stop()}}),e,this)})));return function(r,t){return e.apply(this,arguments)}}()},{key:"_validateQueryFeaturesMesh",value:function(){var e=(0,i.Z)((0,n.Z)().mark((function e(r){var t,i,u,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:for(t=function(e){throw new h.s("feature-layer-view:unsupported-query","Queries on Mesh feature collection layers do not support '".concat(e,"'"))},i=0,u=["quantizationParameters","geometryPrecision","maxAllowableOffset"];i<u.length;i++)null!=r[o=u[i]]&&t(o);"returnM"in r&&r.returnM&&t("returnM"),"returnCentroid"in r&&r.returnCentroid&&t("returnCentroid"),(0,p.r)(r.outSpatialReference)&&!r.outSpatialReference.equals(this.view.spatialReference)&&t("outSpatialReference");case 5:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}()},{key:"performanceInfo",get:function(){var e,r,t,n,i,u=null===(e=this.controller)||void 0===e?void 0:e.displayFeatureLimit,o=(0,p.r)(u)&&u.averageSymbolComplexity,a=(0,p.r)(o)?"f:".concat(o.primitivesPerFeature,",v:").concat(o.primitivesPerCoordinate):"n/a",s=(0,c.Z)((0,c.Z)({},this._getResourceInfo()),{},{storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,mode:null!==(r=null===(t=this.controller)||void 0===t?void 0:t.mode)&&void 0!==r?r:"n/a",symbolComplexity:a,nodes:null!==(n=null===(i=this.controller)||void 0===i?void 0:i.tileDescriptors.length)&&void 0!==n?n:0});if(this.controller&&s.displayedNumberOfFeatures){var l=this.controller.debug;s.storedFeatures=l.storedFeatures,s.totalVertices=l.totalVertices}return s}},{key:"test",get:function(){var e;return{updatePolicy:this.updatePolicy,controller:this.controller,loadedGraphics:null===(e=this.controller)||void 0===e?void 0:e.graphics}}}]),t}((0,q.i)((0,m.w)((0,O.A)((0,g.n)(M.u)))));(0,h.e)([(0,h.y)()],Q.prototype,"layer",void 0),(0,h.e)([(0,h.y)()],Q.prototype,"controller",void 0),(0,h.e)([(0,h.y)()],Q.prototype,"_controllerTotal",void 0),(0,h.e)([(0,h.y)()],Q.prototype,"_processorTotal",void 0),(0,h.e)([(0,h.y)()],Q.prototype,"maximumNumberOfFeatures",null),(0,h.e)([(0,h.y)()],Q.prototype,"maximumNumberOfFeaturesExceeded",null),(0,h.e)([(0,h.y)(v.t)],Q.prototype,"updatingProgress",void 0),(0,h.e)([(0,h.y)({readOnly:!0})],Q.prototype,"updatingProgressValue",null),(0,h.e)([(0,h.y)({readOnly:!0})],Q.prototype,"updatePolicy",null),(0,h.e)([(0,h.y)({readOnly:!0})],Q.prototype,"hasZ",null),(0,h.e)([(0,h.y)({readOnly:!0})],Q.prototype,"hasM",null),(0,h.e)([(0,h.y)()],Q.prototype,"suspendResumeExtentMode",void 0),Q=(0,h.e)([(0,h.n)("esri.views.3d.layers.FeatureLayerViewBase3D")],Q);var E={point:5e3,polygon:500,polyline:1e3},I=Q}}]);
//# sourceMappingURL=8882.eb1a84d2.chunk.js.map