"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[8982],{37081:function(e,t,n){n.d(t,{f:function(){return b},l:function(){return f},u:function(){return g}});var i=n(15671),r=n(43144),o=n(60136),a=n(29388),s=n(50165),l=n(78697),u=n(32335),c=n(89180),d=n(77322),v=n(63334);function p(e,t){return f(e)===f(t)}function f(e){if((0,s.t)(e))return null;var t,n=null!=e.layer?e.layer.id:"";return null==(t=null!=e.objectId?e.objectId:null!=e.layer&&"objectIdField"in e.layer&&null!=e.layer.objectIdField&&null!=e.attributes?e.attributes[e.layer.objectIdField]:e.uid)?null:"o-".concat(n,"-").concat(t)}var h={json:{write:{writer:function(e,t){var n;(0,s.t)(e)||null==(null===(n=e.layer)||void 0===n?void 0:n.objectIdField)||null==e.attributes||(t.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})},target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:function(e){if(null!=e.layerId&&null!=e.objectId)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}}}}};var y=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).position=null,r.elevationInfo=null,r.feature=null,r}return(0,r.Z)(n,[{key:"equals",value:function(e){return(0,s.aw)(this.position,e.position)&&(0,s.aw)(this.elevationInfo,e.elevationInfo)&&p(this.feature,e.feature)}}]),n}((0,u.u)((0,l.l)(s.y)));(0,s.e)([(0,s.d)({type:d.j}),(0,c.w)()],y.prototype,"position",void 0),(0,s.e)([(0,s.d)({type:v.x}),(0,c.w)()],y.prototype,"elevationInfo",void 0),(0,s.e)([(0,s.d)(h)],y.prototype,"feature",void 0);var g=y=(0,s.e)([(0,s.n)("esri.analysis.LineOfSightAnalysisObserver")],y),m=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).position=null,r.elevationInfo=null,r.feature=null,r}return(0,r.Z)(n,[{key:"equals",value:function(e){return(0,s.aw)(this.position,e.position)&&(0,s.aw)(this.elevationInfo,e.elevationInfo)&&p(this.feature,e.feature)}}]),n}((0,u.u)(l.a));(0,s.e)([(0,s.d)({type:d.j}),(0,c.w)()],m.prototype,"position",void 0),(0,s.e)([(0,s.d)({type:v.x}),(0,c.w)()],m.prototype,"elevationInfo",void 0),(0,s.e)([(0,s.d)(h)],m.prototype,"feature",void 0);var b=m=(0,s.e)([(0,s.n)("esri.analysis.LineOfSightAnalysisTarget")],m)},78982:function(e,t,n){n.r(t);var i=n(1413),r=n(74165),o=n(15861),a=n(37762),s=n(43144),l=n(15671),u=n(60136),c=n(29388),d=n(50165),v=n(40133),p=n(2760),f=n(66385),h=n(88406),y=(n(33530),n(37081)),g=n(69738),m=n(73627),b=n(22984),_=n(98643),w=n(79146),C=n(64747),O=n(24018),I=n(78880),k=n(40438),T=n(27670),L=n(35691),S=n(44217),V=n(34236),R=n(67871),Z=n(77322),P=n(12317),A=n(63334),E=n(15621),M=n(68634),D=n(25186),z=n(57952),F=(n(52155),n(61340),n(50463),n(84192),n(26995),n(6819),n(48968),n(47692),n(24695),n(13994),n(92694),n(25715),n(96401),n(71573),n(9330),n(96263),n(83262),n(87833),n(7225),n(21286),n(47901),n(5233),n(46237),n(12989),n(6243),n(74021),n(3969),n(94867),n(61772),n(47672),n(92820),n(37783),n(20838),n(56864),n(36235),n(66307),n(31278),n(78697),n(32335),n(89180),n(92870),n(3029),n(73428),n(76375),n(48561),n(75105),n(78664),n(49961),n(79747),n(31412),n(83745),n(55269),n(89031),n(98496),n(4483),n(42),n(75662),n(17493),n(62980),n(16377),n(9887),n(42488),n(42687),n(78330),n(73393),n(87110),n(72577),n(26079),n(49796),n(42094),n(85966),n(66339),n(13445),n(57405),n(21523),n(76821),n(21984),n(15820),n(61377),n(64591),n(14023),n(44365),n(49734),n(69205),n(30594),n(2326),n(66156),n(49350),n(84539),n(89354),n(16897),n(47642),n(38419),n(84231),n(62469),n(85490),n(77576),n(59075),n(75366),n(57439),n(38969),n(8369),n(21277),n(80581),n(51613),n(98428),n(17691),n(55916),n(34095),n(85245),n(75777),n(68792),n(99797),n(49510),n(71871),n(53089),n(83172),n(75272),n(15508),n(86931),n(80392),n(10489),n(62298),n(2815),n(90339),n(82046),n(66270),n(60418),n(97823),n(38665),n(32717),n(39853),n(94872),n(43895),n(73267),n(22628),n(24982),n(46584),n(7093),n(28003),n(58428),n(8049),n(80933),n(40858),n(95076),n(56389),n(86738),n(50338),n(33074),n(31134),n(41524),n(68668),n(66319),n(24781),n(2329),n(37243),n(97345),n(39001),n(84913),n(84823),n(9411),n(14826),n(64620),n(22225),n(4197),n(86905),n(64997),n(26208),n(2816),n(5792),n(75097),n(99057),function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).innerWidth=2,i.outerWidth=8,i.visibleInnerColor=new h.l([3,252,111,1]),i.visibleOuterColor=new h.l([3,252,111,.15]),i.occludedInnerColor=new h.l([252,3,69,1]),i.occludedOuterColor=new h.l([252,3,69,.1]),i.undefinedInnerColor=new h.l([255,255,255,1]),i.undefinedOuterColor=new h.l([127,127,127,.2]),i}return(0,s.Z)(n)}(d.y));(0,d.e)([(0,d.d)({type:Number})],F.prototype,"innerWidth",void 0),(0,d.e)([(0,d.d)({type:Number})],F.prototype,"outerWidth",void 0),(0,d.e)([(0,d.d)({type:h.l})],F.prototype,"visibleInnerColor",void 0),(0,d.e)([(0,d.d)({type:h.l})],F.prototype,"visibleOuterColor",void 0),(0,d.e)([(0,d.d)({type:h.l})],F.prototype,"occludedInnerColor",void 0),(0,d.e)([(0,d.d)({type:h.l})],F.prototype,"occludedOuterColor",void 0),(0,d.e)([(0,d.d)({type:h.l})],F.prototype,"undefinedInnerColor",void 0),(0,d.e)([(0,d.d)({type:h.l})],F.prototype,"undefinedOuterColor",void 0),F=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightConfiguration")],F);var j=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).target=null,i.intersectedGraphic=null,i.intersectedLocation=null,i.elevationAlignedTargetLocation=null,i.visible=void 0,i}return(0,s.Z)(n)}(d.y);(0,d.e)([(0,d.d)()],j.prototype,"target",void 0),(0,d.e)([(0,d.d)()],j.prototype,"intersectedGraphic",void 0),(0,d.e)([(0,d.d)()],j.prototype,"intersectedLocation",void 0),(0,d.e)([(0,d.d)()],j.prototype,"elevationAlignedTargetLocation",void 0),(0,d.e)([(0,d.d)({type:Boolean})],j.prototype,"visible",void 0),j=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSightAnalysisResult")],j);var H,x=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).elevationAlignedTargetLocation=null,i.inputPoints={isValid:!1,observer:(0,p.n)(),observerSurfaceNormal:null,observerFeatureId:null,target:(0,p.n)(),targetSurfaceNormal:null,targetFeatureId:null,observerAdjusted:(0,p.n)(),targetAdjusted:(0,p.n)()},i.computationResult={start:(0,p.n)(),end:(0,p.n)(),intersection:(0,p.n)(),isValid:!1,isTargetVisible:!1},i.result=null,i}return(0,s.Z)(n,[{key:"notifyResultChanged",value:function(){this.notifyChange("computationResult")}},{key:"notifyInputPointsChanged",value:function(){this.notifyChange("inputPoints")}}]),n}(d.y);(0,d.e)([(0,d.d)()],x.prototype,"target",void 0),(0,d.e)([(0,d.d)()],x.prototype,"elevationAlignedTargetLocation",void 0),(0,d.e)([(0,d.d)()],x.prototype,"inputPoints",void 0),(0,d.e)([(0,d.d)()],x.prototype,"computationResult",void 0),(0,d.e)([(0,d.d)()],x.prototype,"result",void 0),x=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightComputation")],x);var G=H=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){return(0,l.Z)(this,n),t.call(this,e)}return(0,s.Z)(n,[{key:"clone",value:function(){return new H({type:this.type,id:(0,d.m)(this.id),point:(0,d.m)(this.point),normal:(0,d.m)(this.normal),ray:(0,d.m)(this.ray),graphic:this.graphic})}},{key:"equals",value:function(e){return this.type===e.type&&this.id===e.id&&(0,d.aw)(this.point,e.point)&&(0,d.a9)(this.normal,e.normal)&&(0,C.m)(this.ray,e.ray)&&this.graphic===e.graphic}}]),n}(d.y);(0,d.e)([(0,d.d)()],G.prototype,"type",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],G.prototype,"id",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],G.prototype,"point",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],G.prototype,"normal",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],G.prototype,"graphic",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],G.prototype,"ray",void 0),G=H=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightIntersectionResult")],G);var N=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e))._terrainIntersectionOptionsLayerUids=new Set(["terrain"]),i}return(0,s.Z)(n,[{key:"initialize",value:function(){this.intersector=(0,S.g)(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=S.w.MIN}},{key:"getScreenPointIntersection",value:function(e){var t=(0,I.d)(e,k.t.get()),n=(0,L.aY)(this.view.state.camera,t,X);return this._getRayIntersection(n)}},{key:"_getRayIntersection",value:function(e,t){if((0,d.t)(e)||(0,d.t)(this.view.sceneIntersectionHelper))return null;this.intersector.options.store=S.w.MIN,this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,this.intersector,t);var n=this.intersector.results.min;if(!n.getIntersectionPoint(U))return null;var i=this.view.renderCoordsHelper.fromRenderCoords(U,this.view.spatialReference),r=(0,p.a6)(n.normal);if((0,L.b5)(n))return new G({type:S.A.OBJECT,id:"".concat(n.target.layerUid,"/").concat(n.target.nodeIndex,"/").concat(n.target.componentIndex),point:i,normal:r,ray:(0,C.l)(e),graphic:null});if((0,L.b6)(n))return new G({type:S.A.TERRAIN,id:n.target.lij.slice(),point:i,normal:r,ray:(0,C.l)(e),graphic:null});var o=(0,L.b7)(n,this.view);if((0,d.r)(o)){var a,s=o.layer,l=o.sourceLayer;return a=l&&"scene"===l.type?(0,T.O)(o,l.objectIdField):o.uid,new G({type:S.A.OBJECT,id:"".concat(s.uid,"/").concat(a),point:i,normal:r,ray:(0,C.l)(e),graphic:o})}return null}},{key:"updateFromGroundIntersection",value:function(e,t,n){var i=U,r=B,o=W,a=q,s=J;(0,p.a)(r,e),this.view.renderCoordsHelper.worldUpAtPosition(r,o),(0,p.z)(o,o);var l=this.view.basemapTerrain.elevationBounds,u=this.view.renderCoordsHelper.getAltitude(r),c=l?Math.abs(l.max-l.min):100,v=u>0?1:-1;(0,p.q)(a,o,v*(c+Math.abs(t))),(0,p.u)(i,r,a),(0,C.p)(i,r,X);var f=this._getRayIntersection(X,{include:this._terrainIntersectionOptionsLayerUids});return(0,d.r)(f)&&(0,d.r)(f.point)?(this.view.renderCoordsHelper.toRenderCoords(f.point,s),(0,p.q)(a,o,v*t),(0,p.u)(n,s,a),(0,p.h)(f.normal)):((0,p.a)(n,e),null)}}]),n}(d.y);(0,d.e)([(0,d.d)()],N.prototype,"view",void 0),(0,d.e)([(0,d.d)()],N.prototype,"intersector",void 0),N=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightRayIntersector")],N);var U=(0,p.n)(),B=(0,p.n)(),W=(0,p.n)(),q=(0,p.n)(),J=(0,p.n)(),X=(0,C.d)(),K=d.s.getLogger("esri.views.3d.analysis.LineOfSight.LineOfSightController"),Q=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).updateOnCameraChange=!0,i._effectiveObserverElevationMode="absolute-height",i._observerFeatureId=null,i._updatingHandles=new b.c,i._frameTask=R.Q,i._handles=new g.u,i._computationHandles=new g.u,i._externalObserverUpdate=!0,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e,t=null===(e=this.view.resourceController)||void 0===e?void 0:e.scheduler;this._frameTask=t?t.registerTask(R.L.LINE_OF_SIGHT_TOOL):R.Q,this._intersector=new N({view:this.view}),this._handles.add([this._connectObserver(),this._connectComputations(),this._connectTargets()])}},{key:"destroy",value:function(){this._handles.destroy(),this._computationHandles.destroy(),this._computations.removeAll(),this._updatingHandles.destroy()}},{key:"updating",get:function(){return this._frameTask.updating||this._updatingHandles.updating}},{key:"priority",get:function(){return this._frameTask.priority},set:function(e){this._frameTask.priority=e}},{key:"_computations",get:function(){return this.analysisViewData.computations}},{key:"_elevationAlignedObserverPositionRenderSpace",get:function(){return this.analysisViewData.observerEngineLocation},set:function(e){this.analysisViewData.observerEngineLocation=e}},{key:"_screenPixelSize",get:function(){return this.view.state.camera.computeScreenPixelSizeAt(this._elevationAlignedObserverPositionRenderSpace)}},{key:"getLineOfSightComputationDependencies",value:function(e){return{inputPoints:e.inputPoints}}},{key:"_computeResult",value:function(e){var t=e.computation,n=t.inputPoints,i=t.computationResult,r=n.observerAdjusted,o=n.targetAdjusted,a=i.start,s=i.end;(0,p.a)(a,r),(0,p.a)(s,o),this._canCompute(t)?this._computeIntersection(e):this._interpolateIntersection(e),t.notifyResultChanged(),this.emit("result-changed",{target:e.computation.target,result:t.result})}},{key:"_updateAdjustedPointsFromFeatures",value:function(e){var t=this.view,n=t.sceneIntersectionHelper,i=e.inputPoints,r=i.observerAdjusted,o=i.observerFeatureId,s=i.targetFeatureId,l=i.targetAdjusted;if(!(0,d.t)(o)||!(0,d.t)(s)){var u=(0,p.x)(r,l),c=this._intersector.intersector,v=(0,C.p)(i.observer,i.target,ee);c.options.store=S.w.ALL,n.intersectToolIntersectorRay(v,c);var f,h=null,g=null,m=null,b=null,_=(0,a.Z)(c.results.all);try{for(_.s();!(f=_.n()).done;){var w=f.value,O=(0,L.b7)(w,this.view);if(!(0,d.t)(O)&&!(0,d.t)(w.distanceInRenderSpace)){var I=(0,y.l)(O);(0,d.t)(I)||((0,d.r)(o)&&I===o&&((0,d.t)(h)&&(h=this._getFeatureDistanceThreshold(w,t,u)),w.distanceInRenderSpace<h&&(m=w)),(0,d.r)(s)&&I===s&&((0,d.t)(g)&&(g=this._getFeatureDistanceThreshold(w,t,u)),(0,d.t)(b)&&w.distanceInRenderSpace<u&&u-w.distanceInRenderSpace<g&&(b=w)))}}}catch(k){_.e(k)}finally{_.f()}(0,d.r)(m)&&m.getIntersectionPoint(r)&&(i.observerSurfaceNormal=m.getTransformedNormal((0,p.n)())),(0,d.r)(b)&&b.getIntersectionPoint(l)&&(i.targetSurfaceNormal=b.getTransformedNormal((0,p.n)()))}}},{key:"_getFeatureDistanceThreshold",value:function(e,t,n){if((0,L.b8)(e)){var i=(0,L.b9)(e,t);if((0,d.r)(i))return Math.min(i*ne,n)}return 1e-5*n}},{key:"_adjustStartEndPositions",value:function(e){var t=this._screenPixelSize,n=this.view,i=e.inputPoints,r=i.observer,o=i.observerSurfaceNormal,a=i.target,s=i.targetSurfaceNormal,l=i.observerAdjusted,u=i.targetAdjusted,c=$;(0,p.a)(l,r),(0,p.a)(u,a),this._updateAdjustedPointsFromFeatures(e),(0,d.r)(o)?(0,p.a)(c,o):(0,p.e)(c,u,l);var v=t;(0,p.z)(c,c),(0,p.q)(c,c,Math.min(v,1)),(0,p.u)(l,l,c),(0,d.r)(s)?(0,p.a)(c,s):(0,p.e)(c,l,u);var f=n.state.camera.computeScreenPixelSizeAt(u);(0,p.z)(c,c),(0,p.q)(c,c,Math.min(f,1)),(0,p.u)(u,u,c)}},{key:"_computeIntersection",value:function(e){var t=e.computation,n=e.interpolationInfo,i=this.view,r=i.sceneIntersectionHelper,o=i.renderCoordsHelper;if(!(0,d.t)(r)){var a=this._intersector.intersector,s=t.computationResult,l=t.inputPoints,u=l.observer,c=l.target,v=s.start,f=s.end,h=(0,C.p)(v,f,ee);a.options.store=S.w.MIN,r.intersectToolIntersectorRay(h,a);var y=a.results.min,g=s.intersection,m=$,b=!0;if((0,d.r)(y)&&y.getIntersectionPoint(g)){(0,p.a)(n.originalIntersection,g),(0,p.a)(n.originalObserver,v),(0,p.a)(n.originalTarget,f),o.fromRenderCoords(g,m,i.spatialReference);var _=1-(0,p.U)(f,c)/(0,p.U)(v,c);b=(0,p.U)(u,g)>=_*(0,p.U)(u,c)}var w=new Z.j(m,i.spatialReference),O=t.result,I=t.target;(0,d.r)(O)?(O.target=I,O.intersectedGraphic=b?null:(0,L.b7)(y,i),O.intersectedLocation=b?null:w,O.visible=b):t.result=new j({target:I,elevationAlignedTargetLocation:t.elevationAlignedTargetLocation,intersectedGraphic:b?null:(0,L.b7)(y,i),intersectedLocation:b?null:w,visible:b}),s.isValid=l.isValid=!0,s.isTargetVisible=b}}},{key:"_interpolateIntersection",value:function(e){var t=e.computation,n=e.interpolationInfo,i=t.computationResult,r=t.inputPoints,o=i.start,a=i.end,s=i.intersection,l=n.originalIntersection,u=n.originalObserver,c=n.originalTarget;if((0,p.a)(s,l),r.isValid){var d=$,v=(0,p.U)(u,l)/(0,p.U)(u,c);(0,p.a1)(d,o,u),(0,p.q)(d,d,1-v),(0,p.u)(s,s,d),(0,p.a1)(d,a,c),(0,p.q)(d,d,v),(0,p.u)(s,s,d),i.isValid=!0}else t.result=null,i.isValid=!1,i.isTargetVisible=!1}},{key:"_canCompute",value:function(e){var t=this.analysisViewData.elevationAlignedObserver,n=this.view.frustum;if((0,d.t)(t)||(0,d.t)(e.elevationAlignedTargetLocation)||(0,d.t)(n))return!1;var i=e.inputPoints,r=i.observerAdjusted,o=i.targetAdjusted,a=n.intersectsPoint(r),s=n.intersectsPoint(o);return a&&s}},{key:"_onObserverPositionChange",value:function(e,t,n,i,r){if(this._externalObserverUpdate=r,(0,d.t)(e))return this.analysisViewData.elevationAlignedObserver=null,void(this._observerFeatureId=null);if((0,d.t)(t))return(0,V.a)(this.analysis,e.spatialReference,K),void(this.analysisViewData.elevationAlignedObserver=null);var o=this._getEffectiveElevationInfo(t,n),a=(0,O.d)(t.x,t.y,t.z,this.view.spatialReference,this.view,o),s=a.absoluteZ,l=a.elevation,u=t.clone();u.z=s,this._effectiveObserverElevationMode=o.mode,this.analysisViewData.elevationAlignedObserver=u;var c=(0,p.n)();this.view.renderCoordsHelper.toRenderCoords(u,c),this._elevationAlignedObserverPositionRenderSpace=c,this._observerGroundOffsetRenderSpace=s-l,this._observerFeatureId=(0,y.l)(i),this.priority=R.L.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_onObserverRenderSpacePositionChangeForComputation",value:function(e,t,n,i,r){var o=e.inputPoints;switch((0,p.a)(o.observer,t),o.observerFeatureId=r,o.observerSurfaceNormal=null,i){case"on-the-ground":case"relative-to-ground":var a=this._intersector.updateFromGroundIntersection(o.observer,n,o.observer);(0,d.t)(o.observerFeatureId)&&(o.observerSurfaceNormal=a)}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=R.L.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_onTargetPositionChange",value:function(e,t,n,i,r){var o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=e.inputPoints;if(o&&(a.isValid=!1),(0,d.t)(n))return(0,d.r)(t)&&(0,V.a)(this.analysis,t.spatialReference,K),e.elevationAlignedTargetLocation=null,void e.notifyInputPointsChanged();var s=this._getEffectiveElevationInfo(n,i),l=(0,O.d)(n.x,n.y,n.z,this.view.spatialReference,this.view,s),u=l.absoluteZ,c=l.elevation,v=n.clone();switch(v.z=u,e.elevationAlignedTargetLocation=v,this.view.renderCoordsHelper.toRenderCoords(e.elevationAlignedTargetLocation,a.target),a.targetFeatureId=(0,y.l)(r),a.targetSurfaceNormal=null,s.mode){case"on-the-ground":case"relative-to-ground":var p=this._intersector.updateFromGroundIntersection(a.target,u-c,a.target);(0,d.t)(a.targetFeatureId)&&(a.targetSurfaceNormal=p)}this._adjustStartEndPositions(e),e.notifyInputPointsChanged(),this.priority=R.L.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_connectComputationToTarget",value:function(e){var t=this;return(0,d.w)([(0,m.l)((function(){return{computation:e,targetPosition:e.target.position,targetElevationInfo:e.target.elevationInfo,targetFeatureInfo:e.target.feature,projectedTargetPosition:(0,_.u)(e.target.position,t.view.spatialReference)}}),(function(e){var n=e.computation,i=e.targetPosition,r=e.targetElevationInfo,o=e.targetFeatureInfo,a=e.projectedTargetPosition;(0,d.r)(a.pending)?t._updatingHandles.addPromise(a.pending):t._onTargetPositionChange(n,i,a.geometry,r,o)}),m.w)])}},{key:"_connectComputationToObserver",value:function(e){var t=this;return(0,m.l)((function(){return{computation:e,observer:t.analysisViewData.elevationAlignedObserver}}),(function(e){var n=e.computation;t._externalObserverUpdate&&(n.inputPoints.isValid=!1,n.notifyInputPointsChanged())}),m.w)}},{key:"_connectComputationToRenderSpaceObserver",value:function(e){var t=this;return(0,m.l)((function(){return{computation:e,observer:t._elevationAlignedObserverPositionRenderSpace,observerGroundOffset:t._observerGroundOffsetRenderSpace,observerElevationMode:t._effectiveObserverElevationMode,observerFeatureId:t._observerFeatureId}}),(function(e){var n=e.computation,i=e.observer,r=e.observerGroundOffset,o=e.observerElevationMode,a=e.observerFeatureId;t._onObserverRenderSpacePositionChangeForComputation(n,i,r,o,a)}),m.w)}},{key:"_connectComputationToCamera",value:function(e){var t=this;return(0,m.l)((function(){return{camera:t.view.state.camera,isDirty:t._isCameraDirty}}),(function(n){var i=n.isDirty;!t.updateOnCameraChange||e.inputPoints.isValid&&!i||e.notifyInputPointsChanged()}),m.U)}},{key:"_connectComputationToSlicePlane",value:function(e){var t=this;return(0,m.l)((function(){return t.view.slicePlane}),(function(){e.inputPoints.isValid=!1,e.notifyInputPointsChanged()}))}},{key:"_connectComputationToElevation",value:function(e){var t=this,n=function n(i,r){var o=t.analysis.observer,a=e.target,s=null,l=null,u=null,c=null,v=null,p=null;if((0,d.r)(o)&&(0,d.r)(o.position)){var f=(0,_.u)(o.position,t.view.spatialReference);if((0,d.r)(f.pending))return t._updatingHandles.addPromise(f.pending),void f.pending.finally((function(){return n(i,r)}));s=f.geometry,l=o.elevationInfo,u=o.feature}if((0,d.r)(a.position)){var h=(0,_.u)(a.position,t.view.spatialReference);if((0,d.r)(h.pending))return t._updatingHandles.addPromise(h.pending),void h.pending.finally((function(){return n(i,r)}));c=h.geometry,v=a.elevationInfo,p=a.feature}(0,d.t)(s)&&(0,d.t)(c)||((0,_.z)(i,r,te,t.view.spatialReference),(0,d.r)(s)&&(0,w.F)(te,s)&&t._onObserverPositionChange((0,d.r)(o)?o.position:null,s,l,u,!1),(0,d.r)(c)&&(0,w.F)(te,c)&&t._onTargetPositionChange(e,a.position,c,v,p,!1),(0,d.r)(s)&&(0,d.r)(c)&&(0,w.j)(te,s,c)&&e.notifyInputPointsChanged())};return this.view.elevationProvider.on("elevation-change",(function(e){return n(e.extent,e.spatialReference)}))}},{key:"_connectComputationToTask",value:function(e){var t=this,n=d.aZ,i={computation:e,interpolationInfo:{originalIntersection:(0,p.n)(),originalObserver:(0,p.n)(),originalTarget:(0,p.n)()}};return(0,d.w)([(0,m.l)((function(){return t.getLineOfSightComputationDependencies(e)}),(function(){n=(0,d.aJ)(n),n=(0,d.aK)(function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.av)(t._frameTask.schedule((function(){return t._computeResult(i)}),n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),{sync:!0,initial:!0,equals:d.by}),(0,d.p)((function(){return n=(0,d.aJ)(n)}))])}},{key:"_connectComputation",value:function(e){var t=this._computationHandles;t.has(e)||t.add([this._connectComputationToTarget(e),this._connectComputationToObserver(e),this._connectComputationToRenderSpaceObserver(e),this._connectComputationToCamera(e),this._connectComputationToSlicePlane(e),this._connectComputationToElevation(e),this._connectComputationToTask(e)],e)}},{key:"_disconnectComputation",value:function(e){this._computationHandles.remove(e)}},{key:"_onComputationCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,a.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(c){r.e(c)}finally{r.f()}var s,l=(0,a.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._connectComputation(u)}}catch(c){l.e(c)}finally{l.f()}}},{key:"_onTargetCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,a.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._removeTarget(o)}}catch(c){r.e(c)}finally{r.f()}var s,l=(0,a.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._addTarget(u)}}catch(c){l.e(c)}finally{l.f()}}},{key:"_onCursorTargetChange",value:function(e,t){(0,d.r)(t)&&this._removeTarget(t),(0,d.r)(e)&&this._addTarget(e)}},{key:"_addTarget",value:function(e){this._computations.some((function(t){return t.target===e}))||this._computations.add(new x({target:e}))}},{key:"_removeTarget",value:function(e){var t=this._computations.findIndex((function(t){return t.target===e}));this._computations.removeAt(t)}},{key:"_connectObserver",value:function(){var e=this;return(0,d.w)([(0,m.l)((function(){return{observerPosition:(0,d.r)(e.analysis.observer)?e.analysis.observer.position:null,projectedObserverPosition:(0,_.u)((0,d.r)(e.analysis.observer)?e.analysis.observer.position:null,e.view.spatialReference),observerElevationInfo:(0,d.r)(e.analysis.observer)?e.analysis.observer.elevationInfo:null,observerFeatureInfo:(0,d.r)(e.analysis.observer)?e.analysis.observer.feature:null}}),(function(t){var n=t.observerPosition,i=t.projectedObserverPosition,r=t.observerElevationInfo,o=t.observerFeatureInfo;(0,d.r)(i.pending)?e._updatingHandles.addPromise(i.pending):e._onObserverPositionChange(n,i.geometry,r,o,!0)}),m.w)])}},{key:"_connectComputations",value:function(){var e=this;return(0,m.a)((function(){return e._computations}),"change",(function(t){return e._onComputationCollectionChange(t)}),{onListenerAdd:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._connectComputation(r)}}catch(o){i.e(o)}finally{i.f()}},onListenerRemove:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._disconnectComputation(r)}}catch(o){i.e(o)}finally{i.f()}},sync:!0})}},{key:"_connectTargets",value:function(){var e=this;return(0,d.w)([this._updatingHandles.addOnCollectionChange((function(){return e.analysis.targets}),(function(t){return e._onTargetCollectionChange(t)}),{initial:!0,final:!0}),(0,m.l)((function(){return e.analysisViewData.cursorTarget}),(function(t,n){e._onCursorTargetChange(t,n)}))])}},{key:"_isCameraDirty",get:function(){var e=this.analysisViewData.elevationAlignedObserver,t=this.view,n=t.renderCoordsHelper;if((0,d.t)(e)||(0,d.t)(n))return!1;var i=$;n.toRenderCoords(e,i);var r=t.state.camera.computeScreenPixelSizeAt(i);return Math.abs((r-this._screenPixelSize)/this._screenPixelSize)>Y}},{key:"_getEffectiveElevationInfo",value:function(e,t){return e.hasZ?(0,d.af)(t,{mode:"absolute-height",offset:0}):{mode:"on-the-ground",offset:0}}}]),n}(v.n.EventedMixin(d.y));(0,d.e)([(0,d.d)({constructOnly:!0})],Q.prototype,"analysis",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],Q.prototype,"analysisViewData",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],Q.prototype,"view",void 0),(0,d.e)([(0,d.d)()],Q.prototype,"updating",null),(0,d.e)([(0,d.d)()],Q.prototype,"priority",null),(0,d.e)([(0,d.d)()],Q.prototype,"updateOnCameraChange",void 0),(0,d.e)([(0,d.d)()],Q.prototype,"_computations",null),(0,d.e)([(0,d.d)()],Q.prototype,"_elevationAlignedObserverPositionRenderSpace",null),(0,d.e)([(0,d.d)()],Q.prototype,"_observerGroundOffsetRenderSpace",void 0),(0,d.e)([(0,d.d)()],Q.prototype,"_effectiveObserverElevationMode",void 0),(0,d.e)([(0,d.d)()],Q.prototype,"_observerFeatureId",void 0),(0,d.e)([(0,d.d)()],Q.prototype,"_screenPixelSize",null),(0,d.e)([(0,d.d)({readOnly:!0})],Q.prototype,"_updatingHandles",void 0),(0,d.e)([(0,d.d)()],Q.prototype,"_frameTask",void 0),(0,d.e)([(0,d.d)()],Q.prototype,"_isCameraDirty",null),Q=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightController")],Q);var Y=.1,$=(0,p.n)(),ee=(0,C.d)(),te=(0,w.D)(),ne=.05,ie=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).enabled=!0,i.glowColor=new h.l([255,127,0]),i.glowWidth=8,i.innerColor=new h.l([255,255,255]),i.innerWidth=.75,i.globalAlpha=.75,i}return(0,s.Z)(n)}(d.y);(0,d.e)([(0,d.d)({type:Boolean})],ie.prototype,"enabled",void 0),(0,d.e)([(0,d.d)({type:h.l})],ie.prototype,"glowColor",void 0),(0,d.e)([(0,d.d)({type:Number})],ie.prototype,"glowWidth",void 0),(0,d.e)([(0,d.d)({type:h.l})],ie.prototype,"innerColor",void 0),(0,d.e)([(0,d.d)({type:Number})],ie.prototype,"innerWidth",void 0),(0,d.e)([(0,d.d)({type:Number})],ie.prototype,"globalAlpha",void 0),ie=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightLaserLineConfiguration")],ie);var re=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).size=.5,i.color=new h.l([255,127,0,.75]),i}return(0,s.Z)(n)}(d.y);(0,d.e)([(0,d.d)({type:Number})],re.prototype,"size",void 0),(0,d.e)([(0,d.d)({type:h.l})],re.prototype,"color",void 0),re=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightObserverConfiguration")],re);var oe=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).size=.5,i.visibleColor=new h.l([3,252,111,.75]),i.occludedColor=new h.l([252,3,69,.75]),i.undefinedColor=new h.l([127,127,127,.75]),i}return(0,s.Z)(n)}(d.y);(0,d.e)([(0,d.d)({type:Number})],oe.prototype,"size",void 0),(0,d.e)([(0,d.d)({type:h.l})],oe.prototype,"visibleColor",void 0),(0,d.e)([(0,d.d)({type:h.l})],oe.prototype,"occludedColor",void 0),(0,d.e)([(0,d.d)({type:h.l})],oe.prototype,"undefinedColor",void 0),oe=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTargetConfiguration")],oe);var ae=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).innerWidth=2,i.outerWidth=8,i.visibleInnerColor=new h.l([3,252,111,1]),i.visibleOuterColor=new h.l([3,252,111,.15]),i.occludedInnerColor=new h.l([252,3,69,1]),i.occludedOuterColor=new h.l([252,3,69,.1]),i.undefinedInnerColor=new h.l([255,255,255,1]),i.undefinedOuterColor=new h.l([127,127,127,.2]),i}return(0,s.Z)(n)}(d.y);(0,d.e)([(0,d.d)({type:Number})],ae.prototype,"innerWidth",void 0),(0,d.e)([(0,d.d)({type:Number})],ae.prototype,"outerWidth",void 0),(0,d.e)([(0,d.d)({type:h.l})],ae.prototype,"visibleInnerColor",void 0),(0,d.e)([(0,d.d)({type:h.l})],ae.prototype,"visibleOuterColor",void 0),(0,d.e)([(0,d.d)({type:h.l})],ae.prototype,"occludedInnerColor",void 0),(0,d.e)([(0,d.d)({type:h.l})],ae.prototype,"occludedOuterColor",void 0),(0,d.e)([(0,d.d)({type:h.l})],ae.prototype,"undefinedInnerColor",void 0),(0,d.e)([(0,d.d)({type:h.l})],ae.prototype,"undefinedOuterColor",void 0);var se,le,ue=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).laserLine=new ie,i.observer=new re,i.target=new oe,i.lineOfSight=new ae,i}return(0,s.Z)(n)}(d.y);function ce(e,t,n){return{geometry:L.T.createSphereGeometry(e,32,32),material:(0,E.w)(h.l.toUnitRGBA(t)),stateMask:n}}function de(e){var t=[];return e.customColor1&&t.push(ce(e.size,e.customColor1,M.X.Custom1)),e.customColor2&&t.push(ce(e.size,e.customColor2,M.X.Custom2)),e.customColor3&&t.push(ce(e.size,e.customColor3,M.X.Custom3)),e.color&&t.push(ce(e.size,e.color)),t}function ve(e,t){var n=de(t),i=new E.t({view:e,renderObjects:n,elevationInfo:{mode:"absolute-height",offset:0}});return function(e,t){var n=null,i=e.events.on("grab-changed",(function(i){(0,d.r)(n)&&(n.remove(),n=null),"start"===i.action?(n=e.disableDisplay(),t&&t(i)):t&&t(i)}))}(i),i}(0,d.e)([(0,d.d)({type:ie})],ue.prototype,"laserLine",void 0),(0,d.e)([(0,d.d)({type:re})],ue.prototype,"observer",void 0),(0,d.e)([(0,d.d)({type:oe})],ue.prototype,"target",void 0),(0,d.e)([(0,d.d)({type:ae})],ue.prototype,"lineOfSight",void 0),ue=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightToolConfiguration")],ue),(le=se||(se={})).Ready="ready",le.Creating="creating",le.Created="created",v.j.ofType(y.f);var pe=d.s.getLogger("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool"),fe=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).preferManipulatorCursor=!0,i.removeIncompleteOnCancel=!1,i.configuration=new ue,i.analysisViewData=null,i._laserlineVisualElement=null,i._grabbedManipulator=null,i._analysisHandles=new g.u,i._handles=new g.u,i._manipulatorHandles=new g.u,i._targetTrackerManipulator=null,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this;this._intersector=new N({view:this.view}),this._handles.add((0,m.l)((function(){return e.state}),(function(t){t===se.Created&&e.finishToolCreation()}),m.w)),this._observerManipulator=this._createObserverManipulator(),this._handles.add([(0,m.l)((function(){return(0,i.Z)({},e.configuration.observer)}),(function(){return e._updateObserverManipulatorStyle()}),m.U),(0,m.l)((function(){return e.analysisViewData.elevationAlignedObserver}),(function(t){return e._onObserverLocationChange(t)}),m.w),(0,m.l)((function(){return(0,i.Z)({},e.configuration.laserLine)}),(function(){return e._createVisualElements()}),m.w),(0,m.l)((function(){return e._laserLineRendererDependencies()}),(function(t){return e._updateLaserLineRenderer(t)})),this._connectComputations()])}},{key:"destroy",value:function(){this._handles=(0,d.G)(this._handles),this._manipulatorHandles=(0,d.G)(this._manipulatorHandles),this._analysisHandles=(0,d.G)(this._analysisHandles),this._observerManipulator=null,this._clearCursorTracker(),this._removeVisualElements(),this._intersector=null,this._set("analysis",null)}},{key:"state",get:function(){return this.active?(0,d.r)(this._grabbedManipulator)?se.Created:se.Creating:(0,d.r)(this.analysis.observer)&&(0,d.r)(this.analysis.observer.position)?se.Created:se.Ready}},{key:"cursor",get:function(){return this.active&&this._showTracker?"crosshair":null}},{key:"updating",get:function(){return!!(0,d.r)(this.analysisViewData)&&this.analysisViewData.updating}},{key:"_showTracker",get:function(){return this.active&&"mouse"===this._latestPointerMovePointerType}},{key:"_shouldRenderTracker",get:function(){return this._showTracker&&(0,d.r)(this.analysis.observer)&&(0,d.r)(this.analysis.observer.position)&&!this.hasFocusedManipulators}},{key:"continue",value:function(){this.view.activeTool=this}},{key:"stop",value:function(){this.view.activeTool=null}},{key:"onEditableChange",value:function(){this.analysisViewData.editable=this.internallyEditable}},{key:"onInputEvent",value:function(e){switch(e.type){case"immediate-double-click":this._doubleClickHandler(e);break;case"key-down":this._keyDownHandler(e);break;case"pointer-move":this._pointerMoveHandler(e)}}},{key:"onInputEventAfter",value:function(e){"immediate-click"===e.type&&this._clickHandler(e)}},{key:"onShow",value:function(){}},{key:"onHide",value:function(){this._grabbedManipulator=null}},{key:"onDeactivate",value:function(){this._clearCursorTracker()}},{key:"_connectComputations",value:function(){var e=this;return(0,m.a)((function(){return e.analysisViewData.computations}),"change",(function(t){return e._onComputationsCollectionChange(t)}),{onListenerAdd:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._connectComputation(r)}}catch(o){i.e(o)}finally{i.f()}},onListenerRemove:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._disconnectComputation(r)}}catch(o){i.e(o)}finally{i.f()}},sync:!0})}},{key:"_onComputationsCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,a.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(c){r.e(c)}finally{r.f()}var s,l=(0,a.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._connectComputation(u)}}catch(c){l.e(c)}finally{l.f()}}},{key:"_connectComputation",value:function(e){var t=this;if(this.destroyed)pe.warn("Attempting to connect an analysis to a destroyed LineOfSight tool. Ignoring.");else{var n=this._analysisHandles;if(!n.has(e)){var i=this._createTargetManipulator(e.target);(0,d.t)(this._targetTrackerManipulator)&&i.metadata.target===this.analysisViewData.cursorTarget&&(this._targetTrackerManipulator=i,this._targetTrackerManipulator.available=!1,this._targetTrackerManipulator.interactive=!1,this._updateLaserLineRenderer()),n.add([(0,m.l)((function(){return t._getLineOfSightManipulatorStateDependencies(e)}),(function(){return t._updateManipulatorState(i,e)}),m.w),(0,m.l)((function(){return e.elevationAlignedTargetLocation}),(function(e){return t._onTargetLocationChange(e,i)}),m.w)],e)}}}},{key:"_disconnectComputation",value:function(e){if(this.destroyed)pe.warn("Attempting to disconnect an analysis from a destroyed LineOfSight tool. Ignoring.");else{this._analysisHandles.remove(e);var t=this._getTargetManipulator(e.target);(0,d.r)(t)&&(this.manipulators.remove(t),this._manipulatorHandles.remove(t),(0,d.r)(this._targetTrackerManipulator)&&this._targetTrackerManipulator===t&&(this._targetTrackerManipulator=null))}}},{key:"_clearCursorTracker",value:function(){this.analysisViewData.cursorTarget=(0,d.G)(this.analysisViewData.cursorTarget)}},{key:"_createManipulator",value:function(e,t,n){var i=this,r=ve(this.view,e);return r.metadata=n,this._manipulatorHandles.add([t(r),r.events.on("grab-changed",(function(e){return i._manipulatorGrabChanged(r,e)})),r.events.on("immediate-click",(function(e){return i._manipulatorClick(r,e)}))],r),this.manipulators.add(r),r}},{key:"_createTargetManipulator",value:function(e){var t=this,n=this.configuration,i={size:n.target.size,customColor1:n.target.visibleColor,customColor2:n.target.occludedColor,customColor3:n.target.undefinedColor,visible:!0},r={target:e,type:"target"},o=this._createManipulator(i,(function(e){return t._createTargetManipulatorDragPipeline(e)}),r);return(0,d.r)(e.position)?o.elevationAlignedLocation=e.position:o.available=!1,o}},{key:"_getTargetManipulator",value:function(e){var t=null;return this.manipulators.forEach((function(n){var i=n.manipulator;(0,d.t)(t)&&"target"===i.metadata.type&&i.metadata.target===e&&(t=i)})),t}},{key:"_createObserverManipulator",value:function(){var e=this,t=this.configuration,n={size:t.observer.size,color:t.observer.color,visible:!0};return this._createManipulator(n,(function(t){return e._createObserverManipulatorDragPipeline(t)}),{type:"observer",intersection:null})}},{key:"_updateObserverManipulatorStyle",value:function(){var e=this._observerManipulator,t=this.configuration.observer,n={size:t.size,color:t.color,visible:e.available};e.renderObjects=de(n)}},{key:"_screenToIntersection",value:function(){var e=this;return function(t){var n=e._intersector.getScreenPointIntersection(t.screenEnd);return(0,d.t)(n)?null:(0,i.Z)((0,i.Z)({},t),{},{intersection:n})}}},{key:"_createTargetManipulatorDragPipeline",value:function(e){var t=this;return(0,E.p)(e,(function(n,i,r){i.next(t._screenToIntersection()).next(t._updateTargetDragStep(e)).next((function(){return t._updateLaserLineRenderer()})),r.next(t._cancelTargetDragStep(e.metadata.target)).next((function(){return t._updateLaserLineRenderer()}))}))}},{key:"_createObserverManipulatorDragPipeline",value:function(e){var t=this;return(0,E.p)(e,(function(e,n,i){n.next(t._screenToIntersection()).next(t._updateObserverDragStep()).next((function(){return t._updateLaserLineRenderer()})),i.next(t._cancelObserverDragStep()).next((function(){return t._updateLaserLineRenderer()}))}))}},{key:"_updateObserverDragStep",value:function(){var e=this;return function(t){return(0,d.r)(t.intersection.point)?((0,d.t)(e.analysis.observer)&&(e.analysis.observer=new y.u),e._updateFromIntersection(e.analysis.observer,t.intersection)):e.analysis.observer=null,t}}},{key:"_cancelObserverDragStep",value:function(){var e=this,t=(0,d.r)(this.analysis.observer)&&(0,d.r)(this.analysis.observer.position)?this.analysis.observer.clone():null;return function(n){return e.analysis.observer=t,n}}},{key:"_updateTargetDragStep",value:function(e){var t=this;return function(n){t._updateFromIntersection(e.metadata.target,n.intersection);var i=n.intersection.point;return(0,d.r)(i)&&(e.elevationAlignedLocation=i),n}}},{key:"_cancelTargetDragStep",value:function(e){var t=(0,d.aq)(e.position,(function(e){return e.clone()}));return function(n){return e.position=t,n}}},{key:"_manipulatorGrabChanged",value:function(e,t){switch(t.action){case"start":this._grabbedManipulator=e;break;case"end":this._grabbedManipulator===e&&(this._grabbedManipulator=null)}}},{key:"_updateManipulatorState",value:function(e,t){var n=t.computationResult,i=n.isValid,r=n.isTargetVisible;e.state=i?r?M.X.Custom1:M.X.Custom2:M.X.Custom3}},{key:"_getLineOfSightManipulatorStateDependencies",value:function(e){var t=e.computationResult;return{isValid:t.isValid,isTargetVisible:t.isTargetVisible}}},{key:"_laserLineRendererDependencies",value:function(){return{laserlineVisualElement:this._laserlineVisualElement,grabbedManipulator:this._grabbedManipulator,shouldRenderTracker:this._shouldRenderTracker,observerPosition:(0,d.r)(this.analysis.observer)?this.analysis.observer.position:null,visible:this.visible}}},{key:"_updateLaserLineRenderer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._laserLineRendererDependencies(),t=e.laserlineVisualElement,n=e.grabbedManipulator,i=e.shouldRenderTracker,r=e.observerPosition,o=e.visible;if(!(0,d.t)(t)){var a=(0,d.r)(n)?n:i&&(0,d.r)(r)?this._targetTrackerManipulator:null;this.configuration.laserLine.enabled&&(0,d.r)(a)&&o?(t.visible=!0,t.heightManifoldTarget=a.renderLocation,a!==this._observerManipulator?t.lineVerticalPlaneSegment=(0,P.l)(this._observerManipulator.renderLocation,a.renderLocation,he):t.lineVerticalPlaneSegment=null):(t.visible=!1,t.heightManifoldTarget=null,t.lineVerticalPlaneSegment=null)}}},{key:"_createVisualElements",value:function(){var e=this.configuration.laserLine;this._removeVisualElements(),this._laserlineVisualElement=new D._({view:this.view,attached:!0,visible:this.visible,style:{glowColor:h.l.toUnitRGB(e.glowColor),glowWidth:e.glowWidth,innerColor:h.l.toUnitRGB(e.innerColor),innerWidth:e.innerWidth,globalAlpha:e.globalAlpha}})}},{key:"_removeVisualElements",value:function(){(0,d.r)(this._laserlineVisualElement)&&(this._laserlineVisualElement.destroy(),this._laserlineVisualElement=null)}},{key:"_onObserverLocationChange",value:function(e){(0,d.t)(e)?this._observerManipulator.available=!1:(this._observerManipulator.metadata.intersection=null,this._observerManipulator.available=!0,this._observerManipulator.elevationAlignedLocation=e)}},{key:"_onTargetLocationChange",value:function(e,t){(0,d.r)(e)?(t.elevationAlignedLocation=e,t!==this._targetTrackerManipulator&&(t.available=!0)):t.available=!1}},{key:"_addPointFromClickEvent",value:function(e){var t=this._intersector.getScreenPointIntersection(e);if(!(0,d.t)(t)&&!(0,d.t)(t.point))if((0,d.r)(this.analysis.observer)&&(0,d.r)(this.analysis.observer.position)){this._clearCursorTracker();var n=new y.f;this._updateFromIntersection(n,t),this.analysis.targets.add(n)}else{var i=new y.u;this._updateFromIntersection(i,t),this.analysis.observer=i}}},{key:"_clickHandler",value:function(e){this.active&&e.button!==M.a3.Right&&(this._addPointFromClickEvent((0,M.a4)(e)),e.stopPropagation())}},{key:"_doubleClickHandler",value:function(e){this.active&&e.button!==M.a3.Right&&(this.stop(),e.stopPropagation())}},{key:"_keyDownHandler",value:function(e){this.active&&"Escape"===e.key&&(this.stop(),e.stopPropagation())}},{key:"_pointerMoveHandler",value:function(e){if(!this.hasFocusedManipulators&&(this._latestPointerMovePointerType=e.pointerType,this._updateLaserLineRenderer(),this._showTracker&&!(0,d.t)(this.analysis.observer)&&!(0,d.t)(this.analysis.observer.position))){var t=(0,M.a4)(e),n=this._intersector.getScreenPointIntersection(t);(0,d.r)(n)&&(0,d.r)(n.point)&&((0,d.t)(this.analysisViewData.cursorTarget)&&(this.analysisViewData.cursorTarget=new y.f),this._updateFromIntersection(this.analysisViewData.cursorTarget,n),this._updateLaserLineRenderer())}}},{key:"_updateFromIntersection",value:function(e,t){if((0,d.t)(t.point))return e.position=null,e.elevationInfo=null,void(e.feature=null);switch(t.type){case S.A.OBJECT:if((0,d.r)(t.graphic)){var n=t.graphic,i=(0,O.u)(n);"on-the-ground"===i.mode&&(i.mode="relative-to-ground",i.offset=0),e.elevationInfo=new A.x(i),e.feature=n}else e.elevationInfo=null,e.feature=null;break;case S.A.TERRAIN:case S.A.I3S:e.elevationInfo=new A.x({mode:"on-the-ground"}),e.feature=null;break;default:e.elevationInfo=null,e.feature=null}var r=t.point.clone();r.z=(0,O.f)(this.view,r,{mode:"absolute-height",offset:0},e.elevationInfo),e.position=r}},{key:"_manipulatorClick",value:function(e,t){if(!("observer"===e.metadata.type||e.grabbing||e.dragging||t.button!==M.a3.Right||this.analysis.targets.length<=1)){var n=e.metadata.target;this.analysis.targets.remove(n),t.stopPropagation()}}},{key:"testInfo",get:function(){return{laserLineVisualElement:this._laserlineVisualElement}}}]),n}(E.a);(0,d.e)([(0,d.d)({constructOnly:!0})],fe.prototype,"view",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],fe.prototype,"analysis",void 0),(0,d.e)([(0,d.d)({readOnly:!0})],fe.prototype,"state",null),(0,d.e)([(0,d.d)({readOnly:!0})],fe.prototype,"cursor",null),(0,d.e)([(0,d.d)({readOnly:!0})],fe.prototype,"preferManipulatorCursor",void 0),(0,d.e)([(0,d.d)()],fe.prototype,"removeIncompleteOnCancel",void 0),(0,d.e)([(0,d.d)({readOnly:!0})],fe.prototype,"updating",null),(0,d.e)([(0,d.d)({type:ue})],fe.prototype,"configuration",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],fe.prototype,"analysisViewData",void 0),(0,d.e)([(0,d.d)({readOnly:!0})],fe.prototype,"_showTracker",null),(0,d.e)([(0,d.d)()],fe.prototype,"_latestPointerMovePointerType",void 0),(0,d.e)([(0,d.d)()],fe.prototype,"_shouldRenderTracker",null),(0,d.e)([(0,d.d)()],fe.prototype,"_laserlineVisualElement",void 0),(0,d.e)([(0,d.d)()],fe.prototype,"_grabbedManipulator",void 0),fe=(0,d.e)([(0,d.n)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightTool")],fe);var he=(0,P.v)(),ye=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e))._lineOfSightVisualizations=[],i._computationHandles=new g.u,i}return(0,s.Z)(n,[{key:"initialize",value:function(){this.own(this._connectComputations()),this._createObserverVisualization()}},{key:"destroy",value:function(){this._computationHandles=(0,d.G)(this._computationHandles),this._observerVisualElement=(0,d.G)(this._observerVisualElement)}},{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"interactiveAndEditable",get:function(){return this.analysisViewData.interactive&&this.analysisViewData.editable}},{key:"testInfo",get:function(){return{visualizations:this._lineOfSightVisualizations}}},{key:"_configuration",get:function(){return this.analysisViewData.configuration}},{key:"_createLineOfSightVisualization",value:function(){var e=this._configuration,t=this.view,n={view:t,attached:!0,width:e.outerWidth,innerWidth:e.innerWidth},r=h.l.toUnitRGBA(e.visibleOuterColor),o=h.l.toUnitRGBA(e.visibleInnerColor),a=h.l.toUnitRGBA(e.occludedOuterColor),s=h.l.toUnitRGBA(e.occludedInnerColor),l=h.l.toUnitRGBA(e.undefinedOuterColor),u=h.l.toUnitRGBA(e.undefinedInnerColor),c={visibleLineVisualElement:new f.C((0,i.Z)((0,i.Z)({},n),{},{color:r,innerColor:o})),occludedLineVisualElement:new f.C((0,i.Z)((0,i.Z)({},n),{},{color:a,innerColor:s})),undefinedLineVisualElement:new f.C((0,i.Z)((0,i.Z)({},n),{},{color:l,innerColor:u})),targetVisualElement:new D.S((0,i.Z)((0,i.Z)({view:t,attached:!0},ge),{},{size:8}))};return this._lineOfSightVisualizations.push(c),c}},{key:"_destroyLineOfSightVisualization",value:function(e){e.visibleLineVisualElement=(0,d.G)(e.visibleLineVisualElement),e.occludedLineVisualElement=(0,d.G)(e.occludedLineVisualElement),e.undefinedLineVisualElement=(0,d.G)(e.undefinedLineVisualElement),e.targetVisualElement=(0,d.G)(e.targetVisualElement),this._lineOfSightVisualizations.splice(this._lineOfSightVisualizations.indexOf(e),1)}},{key:"_updateLineOfSightVisualization",value:function(e,t,n){var i=this._configuration,r=e.computationResult,o=e.inputPoints,a=r.start,s=r.end,l=r.intersection,u=r.isValid,c=r.isTargetVisible,v=o.observer,f=we;f[12]=v[0],f[13]=v[1],f[14]=v[2];var y=(0,p.e)(me,a,v),g=(0,p.e)(be,s,v),m=(0,p.e)(_e,l,v),b=t.visibleLineVisualElement,_=t.occludedLineVisualElement,w=t.undefinedLineVisualElement,C=t.targetVisualElement,O=(0,d.t)(this.analysisViewData.elevationAlignedObserver)||(0,d.t)(e.elevationAlignedTargetLocation),I=this.visible&&!O;b.visible=I,_.visible=I,w.visible=I,C.visible=I,C.attached=!n.interactiveAndEditable,I&&(b.geometry=null,_.geometry=null,w.geometry=null,C.geometry=e.elevationAlignedTargetLocation,u?c?(b.geometry=[[(0,p.a6)(y),(0,p.a6)(g)]],b.transform=f,b.color=h.l.toUnitRGBA(i.visibleOuterColor),C.color=h.l.toUnitRGBA(i.visibleInnerColor)):(b.geometry=[[(0,p.a6)(y),(0,p.a6)(m)]],b.transform=f,b.color=h.l.toUnitRGBA(i.occludedOuterColor),_.geometry=[[(0,p.a6)(m),(0,p.a6)(g)]],_.transform=f,C.color=h.l.toUnitRGBA(i.occludedInnerColor)):(w.geometry=[[(0,p.a6)(y),(0,p.a6)(g)]],w.transform=f,C.color=h.l.toUnitRGBA(i.undefinedInnerColor)))}},{key:"_getLineOfSightVisualizationDependencies",value:function(e){var t=e.computationResult,n=this._configuration;return{computationResult:t,occludedOuterColor:n.occludedOuterColor,visibleOuterColor:n.visibleOuterColor,visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}}},{key:"_connectComputation",value:function(e){var t=this,n=this._computationHandles;if(!n.has(e)){var i=this._createLineOfSightVisualization();n.add([(0,m.l)((function(){return t._getLineOfSightVisualizationDependencies(e)}),(function(n){return t._updateLineOfSightVisualization(e,i,n)}),{sync:!0,initial:!0,equals:d.by}),(0,d.p)((function(){return t._destroyLineOfSightVisualization(i)}))],e)}}},{key:"_disconnectComputation",value:function(e){this._computationHandles.remove(e)}},{key:"_connectComputations",value:function(){var e=this;return(0,m.a)((function(){return e.analysisViewData.computations}),"change",(function(t){return e._onComputationsCollectionChange(t)}),{sync:!0,onListenerAdd:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._connectComputation(r)}}catch(o){i.e(o)}finally{i.f()}},onListenerRemove:function(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._disconnectComputation(r)}}catch(o){i.e(o)}finally{i.f()}}})}},{key:"_onComputationsCollectionChange",value:function(e){var t,n=e.added,i=e.removed,r=(0,a.Z)(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;this._disconnectComputation(o)}}catch(c){r.e(c)}finally{r.f()}var s,l=(0,a.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;this._connectComputation(u)}}catch(c){l.e(c)}finally{l.f()}}},{key:"_createObserverVisualization",value:function(){var e=this,t=h.l.toUnitRGBA(this._configuration.visibleInnerColor),n=new D.S((0,i.Z)({view:this.view,attached:!1,color:t},ge));this._observerVisualElement=n,this.own((0,m.l)((function(){return{observer:e.analysisViewData.elevationAlignedObserver,interactiveAndEditable:e.interactiveAndEditable,visible:e.visible}}),(function(t){var i=t.observer,r=t.interactiveAndEditable,o=t.visible;(0,d.t)(i)||r||!o?n.attached=!1:(n.geometry=i,e._observerVisualElement.attached=!0)}),m.h))}}]),n}(d.y);(0,d.e)([(0,d.d)({constructOnly:!0})],ye.prototype,"analysis",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],ye.prototype,"analysisViewData",void 0),(0,d.e)([(0,d.d)({constructOnly:!0})],ye.prototype,"view",void 0),(0,d.e)([(0,d.d)({readOnly:!0})],ye.prototype,"visible",null),(0,d.e)([(0,d.d)()],ye.prototype,"interactiveAndEditable",null),(0,d.e)([(0,d.d)()],ye.prototype,"testInfo",null),(0,d.e)([(0,d.d)()],ye.prototype,"_configuration",null),ye=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],ye);var ge={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},me=(0,p.n)(),be=(0,p.n)(),_e=(0,p.n)(),we=(0,z.e)(),Ce=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e)).type="line-of-sight-view-3d",i.analysis=null,i.tool=null,i.computations=new v.j,i.elevationAlignedObserver=null,i.configuration=new F,i.observerEngineLocation=(0,p.n)(),i.cursorTarget=null,i.editable=!0,i}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this,t=this.view,n=this.analysis;this._analysisController=new Q({analysis:n,analysisViewData:this,view:t}),this._analysisVisualization=new ye({analysis:n,analysisViewData:this,view:t}),this.own([this._analysisController.on("result-changed",(function(t){t.target!==e.cursorTarget&&e.emit("result-changed",t)})),(0,E.c)(this,fe)])}},{key:"destroy",value:function(){(0,E.m)(this),this._analysisController=(0,d.G)(this._analysisController),this._analysisVisualization=(0,d.G)(this._analysisVisualization)}},{key:"results",get:function(){return this.computations.map((function(e){return e.result}))}},{key:"priority",get:function(){return this._analysisController.priority},set:function(e){this._analysisController.priority=e}},{key:"updating",get:function(){return(0,d.r)(this._analysisController)&&this._analysisController.updating}},{key:"getResultForTarget",value:function(e){var t=this.computations.find((function(t){return t.target===e}));return(0,d.aq)(t,(function(e){return e.result}))}},{key:"testInfo",get:function(){return{visualization:this._analysisVisualization,controller:this._analysisController}}}]),n}((0,f.a)(v.n.EventedMixin(d.y)));(0,d.e)([(0,d.d)({readOnly:!0})],Ce.prototype,"type",void 0),(0,d.e)([(0,d.d)({constructOnly:!0,nonNullable:!0})],Ce.prototype,"analysis",void 0),(0,d.e)([(0,d.d)()],Ce.prototype,"tool",void 0),(0,d.e)([(0,d.d)({readOnly:!0})],Ce.prototype,"results",null),(0,d.e)([(0,d.d)()],Ce.prototype,"priority",null),(0,d.e)([(0,d.d)()],Ce.prototype,"computations",void 0),(0,d.e)([(0,d.d)()],Ce.prototype,"elevationAlignedObserver",void 0),(0,d.e)([(0,d.d)()],Ce.prototype,"configuration",void 0),(0,d.e)([(0,d.d)()],Ce.prototype,"observerEngineLocation",void 0),(0,d.e)([(0,d.d)()],Ce.prototype,"cursorTarget",void 0),(0,d.e)([(0,d.d)()],Ce.prototype,"updating",null),(0,d.e)([(0,d.d)()],Ce.prototype,"editable",void 0),(0,d.e)([(0,d.d)()],Ce.prototype,"_analysisController",void 0),(0,d.e)([(0,d.d)()],Ce.prototype,"_analysisVisualization",void 0);var Oe=Ce=(0,d.e)([(0,d.n)("esri.views.3d.analysis.LineOfSightAnalysisView3D")],Ce);t.default=Oe},24018:function(e,t,n){n.d(t,{d:function(){return c},f:function(){return s},m:function(){return v},s:function(){return o},u:function(){return a},v:function(){return l}});var i=n(50165),r=n(63334);function o(e,t){return function(e,t){return(0,i.t)(t)||!t.mode?e?"absolute-height":"on-the-ground":t.mode}(!!(0,i.r)(e)&&e.hasZ,t)}function a(e){var t=function(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}(e),n=o(e.geometry,t);return{mode:n,offset:(0,i.r)(t)&&"on-the-ground"!==n?(0,i.af)(t.offset,0)*(0,r.r)((0,i.af)(t.unit,"meters")):0}}function s(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return u(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,n,i)}function l(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return u(e,t[0],t[1],t.length>2?t[2]:0,n,i,r)}function u(e,t,n,r,o,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(!(0,i.t)(a)){var l=(0,i.r)(s)?s.mode:"absolute-height";if("on-the-ground"===l)return 0;var u=c(t,n,r,o,e,a),v=u.absoluteZ;return d(v,t,n,r,o,e,s,l)}}function c(e,t,n,r,o,a){var s=(0,i.r)(a.offset)?a.offset:0;switch(a.mode){case"absolute-height":return{absoluteZ:n+s,elevation:0};case"on-the-ground":var l=(0,i.af)(o.elevationProvider.getElevation(e,t,0,r,"ground"),0);return{absoluteZ:l,elevation:l};case"relative-to-ground":var u=(0,i.af)(o.elevationProvider.getElevation(e,t,n,r,"ground"),0);return{absoluteZ:n+u+s,elevation:u};case"relative-to-scene":var c=(0,i.af)(o.elevationProvider.getElevation(e,t,n,r,"scene"),0);return{absoluteZ:n+c+s,elevation:c}}}function d(e,t,n,r,o,a,s,l){var u=(0,i.r)(s)&&(0,i.r)(s.offset)?s.offset:0;switch(l){case"absolute-height":return e-u;case"relative-to-ground":return e-((0,i.af)(a.elevationProvider.getElevation(t,n,r,o,"ground"),0)+u);case"relative-to-scene":return e-((0,i.af)(a.elevationProvider.getElevation(t,n,r,o,"scene"),0)+u)}}var v={mode:"absolute-height",offset:0}},98805:function(e,t,n){function i(e){return e&&"getAtOrigin"in e&&"originOf"in e}n.d(t,{i:function(){return i}})},89180:function(e,t,n){n.d(t,{w:function(){return m}});var i=n(74165),r=n(15861),o=n(1413),a=n(37762),s=n(50165),l=n(98805),u=n(13994),c=n(92870),d=n(3029);function v(e){return p[function(e){return e instanceof Blob?e.type:function(e){var t=(0,u.k)(e);return y[t]||f}(e.url)}(e)]||h}var p={},f="text/plain",h=p[f],y={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(var g in y)p[y[g]]=g;function m(e){var t=(0,s.r)(e)&&e.origins?e.origins:[void 0];return function(n,i){var r,c=function(e,t,n){if((0,s.r)(e)&&"resource"===e.type)return function(e,t,n){var i=(0,s.bt)(t,n);return{type:String,read:function(e,t,n){var r=(0,d.m)(e,t,n);return i.type===String?r:"function"==typeof i.type?new i.type({url:r}):void 0},write:{writer:function(t,r,a,c){if(!c||!c.resources)return"string"==typeof t?void(r[a]=(0,d.c)(t,c)):void(r[a]=t.write({},c));var v=function(e){return(0,s.t)(e)?null:"string"==typeof e?e:e.url}(t),p=v?(0,d.c)(v,(0,o.Z)((0,o.Z)({},c),{},{verifyItemRelativeUrls:c&&c.verifyItemRelativeUrls?{writtenUrls:c.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}),d.I.NO):null,f=i.type!==String&&(!(0,l.i)(this)||c&&c.origin&&this.originIdOf(n)>(0,s.a8)(c.origin));c&&c.portalItem&&(0,s.r)(p)&&!(0,u.K)(p)?f?_(this,n,t,p,r,a,c,e):function(e,t,n,i){i.resources.toKeep.push({resource:i.portalItem.resourceFromPath(e)}),t[n]=e}(p,r,a,c):c&&c.portalItem&&((0,s.t)(p)||(0,s.r)((0,d.h)(p))||(0,u.V)(p)||f)?b(this,n,t,p,r,a,c,e):r[a]=p}}}}(e,t,n);switch((0,s.r)(e)&&e.type?e.type:"other"){case"other":return{read:!0,write:!0};case"url":return{read:d.R.read,write:d.R.write}}}(e,n,i),v=(0,a.Z)(t);try{for(v.s();!(r=v.n()).done;){var p=r.value,f=(0,s.Y)(n,p,i);for(var h in c)f[h]=c[h]}}catch(y){v.e(y)}finally{v.f()}}}function b(e,t,n,i,r,o,a,l){var d=(0,c.t)(),p=C(n,i,a),f=(0,u.G)((0,s.aj)(l,"prefix"),d),h="".concat(f,".").concat(v(p)),y=a.portalItem.resourceFromPath(h);(0,u.V)(i)&&a.resources.pendingOperations.push(function(e){return O.apply(this,arguments)}(i).then((function(e){y.path="".concat(f,".").concat(v(e)),r[o]=y.itemRelativeUrl})).catch((function(){}))),w(e,t,y,p,a.resources.toAdd),r[o]=y.itemRelativeUrl}function _(e,t,n,i,r,o,a,s){var l=a.portalItem.resourceFromPath(i),c=C(n,i,a);v(c)===(0,u.k)(l.path)?(w(e,t,l,c,a.resources.toUpdate),r[o]=i):b(e,t,n,i,r,o,a,s)}function w(e,t,n,i,r){r.push({resource:n,content:i,finish:function(n){!function(e,t,n){"string"==typeof e[t]?e[t]=n.url:e[t].url=n.url}(e,t,n)}})}function C(e,t,n){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(n))],{type:"application/json"})}function O(){return O=(0,r.Z)((0,i.Z)().mark((function e(t){var r,o,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(n,13994)).then((function(e){return e.D}));case 2:return r=e.sent.default,e.next=5,r(t,{responseType:"blob"});case 5:return o=e.sent,a=o.data,e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)}))),O.apply(this,arguments)}},34236:function(e,t,n){n.d(t,{a:function(){return s},n:function(){return a}});var i=n(50165),r=n(98643),o=n(44217);function a(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=(0,r.k)(e,t);return(0,i.t)(s)?null:(s.hasZ&&!a||!(0,i.r)(n)||(s.z=(0,i.af)((0,o.q)(n,s),0)),s)}function s(e,t,n){n.warnOnce("Failed to project analysis geometry (id: '".concat(e.id,"'), projection from spatial reference (wkid: '").concat(t.wkid,"') to view spatial reference is not supported. Projection may be possible after calling projection.load()."))}}}]);
//# sourceMappingURL=8982.f14b73ba.chunk.js.map