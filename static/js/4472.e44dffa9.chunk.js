"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[4472],{28930:function(e,t,r){r.d(t,{p:function(){return c}});var i=r(15671),n=r(43144),a=r(60136),o=r(29388),s=r(23132),u=(r(75610),r(81019)),d=r(58687),l=s.s.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView"),c=function(e){var t=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments))._definitionExpressionErrors=0,e._maxDefinitionExpressionErrors=20,e.logError=function(t){e._definitionExpressionErrors<e._maxDefinitionExpressionErrors&&l.error("Error while evaluating definitionExpression: "+t),e._definitionExpressionErrors++,e._definitionExpressionErrors===e._maxDefinitionExpressionErrors&&l.error("Further errors are ignored")},e}return(0,n.Z)(r,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{var e=u.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!e.isStandardized)return l.error("definitionExpression is using non standard function"),null;var t=[],r=e.fieldNames;return(0,d.J)(r,this.i3slayer.fields,{missingFields:t}),t.length>0?(l.error("definitionExpression references unknown fields: ".concat(t.join(", "))),null):(this._definitionExpressionErrors=0,e)}catch(e){return l.error("Failed to parse definitionExpression: "+e),null}}},{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null}},{key:"_evaluateClause",value:function(e,t){try{return e.testFeature(t)}catch(r){return this.logError(r),!1}}},{key:"_addDefinitionExpressionToQuery",value:function(e){if(!this.parsedDefinitionExpression)return e;var t=this.i3slayer.definitionExpression,r=e.clone();return r.where?r.where="(".concat(t,") AND (").concat(r.where,")"):r.where=t,r}}]),r}(e);return(0,s.e)([(0,s.d)()],t.prototype,"i3slayer",void 0),(0,s.e)([(0,s.d)({readOnly:!0})],t.prototype,"parsedDefinitionExpression",null),(0,s.e)([(0,s.d)({readOnly:!0})],t.prototype,"definitionExpressionFields",null),t=(0,s.e)([(0,s.n)("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t),t}},34472:function(e,t,r){r.r(t);var i=r(37762),n=r(74165),a=r(93433),o=r(15861),s=r(11752),u=r(61120),d=r(43144),l=r(15671),c=r(60136),h=r(29388),p=r(23132),f=r(83822),v=r(75610),y=r(36551),g=r(2760),_=r(63022),b=r(78311),m=r(80262),x=r(69953),E=r(86148),k=r(58687),w=r(48466),I=r(25838),D=r(34860),S=r(21924),F=r(3964),C=r(2301),O=r(35825),A=r(28930),N=r(73538),Z=r(45414),T=r(14181),V=(r(91204),r(30709),r(70441),r(36460),r(57714),r(51451),r(80175),r(50526),r(50448),r(41742),r(43920),r(1773),r(77196),r(24980),r(3114),r(22144),r(78674),r(66307),r(88370),r(72820),r(96349),r(9055),r(79611),r(2157),r(30604),r(21583),r(44455),r(61340),r(33703),r(48561),r(60912),r(43124),r(69797),r(10815),r(55269),r(84538),r(49580),r(54841),r(77470),r(92870),r(6794),r(81663),r(97033),r(83996),r(97627),r(38304),r(96401),r(71573),r(57952),r(58394),r(44344),r(84192),r(3969),r(55806),r(47672),r(64296),r(14432),r(6243),r(37783),r(74021),r(56864),r(64004),r(40273),r(72692),r(77389),r(32568),r(69202),r(27597),r(1241),r(67417),r(15181),r(33642),r(28999),r(15612),r(10590),r(36638),r(19948),r(96636),r(30664),r(83024),r(47626),r(25316),r(407),r(67154),r(79054),r(29709),r(47642),r(18411),r(43782),r(33976),r(28210),r(17436),r(53373),r(94872),r(79042),r(61495),r(16485),r(92029),r(74575),r(9575),r(53249),r(72763),r(28681),r(38929),r(97866),r(68890),r(31513),r(28623),r(10312),r(95254),r(61099),r(12158),r(93874),r(62446),r(27264),r(50905),r(78945),r(55827),r(54539),r(19967),r(50338),r(70516),r(25279),r(22268),r(40452),r(60424),r(22225),r(38425),r(42471),r(78470),r(1665),r(38843),r(24892),r(48889),r(30150),r(53647),r(86270),r(87833),r(21523),r(71710),r(45332),r(83059),r(4720),r(91309),r(25715),r(83262),r(2822),r(61349),r(32990),r(6819),r(52376),r(94867),r(97566),r(90138),r(50982),r(21165),r(21984),r(48373),r(61473),r(14946),r(44365),r(90584),r(98907),r(66156),r(10534),r(25459),r(78556),r(77787),r(85511),r(87603),r(22051),r(46123),r(75777),r(76071),r(42446),r(59819),r(64571),r(68528),r(20005),r(84452),r(63662),r(86068),r(75370),r(62268),r(18392),r(90935),r(20880),r(73554),r(81019),r(68826),r(61212),r(83712),r(7513),r(75955),r(14739),r(10780),r(5900),r(42152),function(e){(0,c.Z)(r,e);var t=(0,h.Z)(r);function r(e){return(0,l.Z)(this,r),t.call(this,"SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:function(e){return[e.geometryBuffer]}},e,{hasInitialize:!0})}return(0,d.Z)(r)}(S.a)),L=p.s.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D"),M=(0,O.b)(),G=function(e){(0,c.Z)(p,e);var t=(0,h.Z)(p);function p(){var e;return(0,l.Z)(this,p),(e=t.apply(this,arguments)).type="scene-layer-graphics-3d",e._nodesAddedToStage=new Map,e._queryEngine=null,e._memCache=null,e._interactiveEditingSessions=new Map,e.loadedGraphics=new w.s,e.holeFilling="always",e.progressiveLoadFactor=1,e.supportsHeightUnitConversion=!0,e._coordinatesOutsideExtentErrors=0,e._maxCoordinatesOutsideExtentErrors=20,e}return(0,d.Z)(p,[{key:"initialize",value:function(){var e,t,i=this,n=this.layer;this.addResolvingPromise(n.indexInfo),this._attributeOverrides=new w.f(this.layer,null===(e=this.view.resourceController)||void 0===e?void 0:e.memoryController),(0,k.aK)(n,this.view.spatialReference,this.view.viewingMode),this.fieldsHelper=new O.c({layerView:this}),this.updatingHandles.add((function(){return n.rangeInfos}),(function(e){return i._rangeInfosChanged(e)}),y.h),this.updatingHandles.add((function(){return n.renderer}),(function(e,t){return i._rendererChange(e,t)})),this.updatingHandles.add((function(){return[i.parsedDefinitionExpression,i.excludeObjectIdsSorted]}),(function(){return i._filterChange()})),this.updatingHandles.add((function(){return i.view.floors}),(function(){return(0,v.r)(i.processor.filterVisibility)&&i.processor.filterVisibility.filterChanged()})),this.handles.add((0,y.l)((function(){return k.B.I3S_TREE_SHOW_TILES}),(function(e){if(e&&!i._treeDebugger){var t=i._controller.crsIndex;r.e(1427).then(r.bind(r,1427)).then((function(e){var r=e.I3STreeDebugger;!i._treeDebugger&&k.B.I3S_TREE_SHOW_TILES&&(i._treeDebugger=new r({lv:i,view:i.view,nodeSR:t}))}))}else e||!i._treeDebugger||k.B.I3S_TREE_SHOW_TILES||(i._treeDebugger.destroy(),i._treeDebugger=null)}),y.h)),this._set("processor",new C.F({owner:this,preferredUpdatePolicy:Z.o.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,dataExtent:n.fullExtent,updateClippingExtent:function(e){return i._updateClippingExtent(e)}})),null!==(t=this.processor.elevationAlignment)&&void 0!==t&&t.events.on("invalidate-elevation",(function(e){return i._invalidateElevation(e)})),this.supportsHeightUnitConversion&&(this._verticalScale=(0,x.o)("point",n.spatialReference,this.view.spatialReference)),this.addResolvingPromise(this.processor.setup()),this._memCache=this.view.resourceController.memoryController.newCache(n.uid),this._controller=new w.t({layerView:this,scaleVisibilityEnabled:!1}),(0,k.aL)(this.layer.geometryDefinitions)&&(this._worker=new V((function(e){return i.view.resourceController.schedule(e)}))),this.handles.add(this.layer.on("apply-edits",(function(e){return i.updatingHandles.addPromise(e.result)}))),this.handles.add(this.layer.on("edits",(function(e){return i._handleEdits(e)}))),this.when((function(){i._queryEngine=new C.l({layerView:i,priority:T.L.FEATURE_QUERY_ENGINE}),i.updatingHandles.add((function(){return i.maximumNumberOfFeatures}),(function(e){return i._controller.featureTarget=e}),y.h),i.updatingHandles.add((function(){return i.suspended}),(function(e){e&&i._removeAllNodeData()}))}))}},{key:"destroy",value:function(){this._treeDebugger=(0,v.l)(this._treeDebugger),this._attributeOverrides=(0,v.l)(this._attributeOverrides),this._set("processor",(0,v.l)(this.processor)),this._controller=(0,v.l)(this._controller),this._queryEngine=(0,v.l)(this._queryEngine),this._worker=(0,v.l)(this._worker),this._memCache=(0,v.l)(this._memCache),this._nodesAddedToStage.clear(),this.fieldsHelper=(0,v.l)(this.fieldsHelper)}},{key:"requiredFields",get:function(){var e,t;return null!==(e=null===(t=this.fieldsHelper)||void 0===t?void 0:t.requiredFields)&&void 0!==e?e:[]}},{key:"maximumNumberOfFeatures",get:function(){var e,t,r,i=null===(e=this.processor)||void 0===e||null===(t=e.graphicsCore)||void 0===t?void 0:t.displayFeatureLimit;return null!==(r=null===i||void 0===i?void 0:i.maximumNumberOfFeatures)&&void 0!==r?r:0},set:function(e){null!=e?(this._override("maximumNumberOfFeatures",e),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){var e;return!this.suspended&&!(null===(e=this._controller)||void 0===e||!e.useMaximumNumberOfFeatures)&&!this._controller.leavesReached}},{key:"excludeObjectIdsSorted",get:function(){var e=this.layer.excludeObjectIds;return e.length?e.toArray().sort((function(e,t){return e-t})):null}},{key:"lodFactor",get:function(){return"Labels"===this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}},{key:"hasM",get:function(){return!1}},{key:"hasZ",get:function(){return!0}},{key:"whenGraphicAttributes",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r){var i=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.Y)(this.layer,t,this._getObjectIdField(),r,(function(){return(0,a.Z)(i._nodesAddedToStage.values())})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getHit",value:function(e){if(!this.loadedGraphics)return null;var t=(0,k.c)(this.loadedGraphics.find((function(t){return t.uid===e})),this.layer),r=this._getObjectIdField();return t&&t.attributes&&t.attributes[r]?(t.layer=this.layer,t.sourceLayer=this.layer,{type:"graphic",graphic:t,layer:t.layer}):null}},{key:"whenGraphicBounds",value:function(e,t){return this.processor.whenGraphicBounds(e,t)}},{key:"computeAttachmentOrigin",value:function(e,t){return this.processor.computeAttachmentOrigin(e,t)}},{key:"canResume",value:function(){return(0,s.Z)((0,u.Z)(p.prototype),"canResume",this).call(this)&&(!this._controller||this._controller.rootNodeVisible)}},{key:"isUpdating",value:function(){var e,t,r;return!!(null!==(e=this._controller)&&void 0!==e&&e.updating||null!==(t=this.processor)&&void 0!==t&&t.updating||null!==(r=this.fieldsHelper)&&void 0!==r&&r.updating||this.layerFilterUpdating)}},{key:"highlight",value:function(e){return this.processor.highlight(e,this.layer.objectIdField)}},{key:"updatePolicy",get:function(){return this.processor.graphicsCore.effectiveUpdatePolicy}},{key:"createInteractiveEditSession",value:function(e){return(0,O.i)(this.attributeEditingContext,e)}},{key:"_extractBinaryPointData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r){var i,a=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={geometryBuffer:t.geometryBuffer},e.abrupt("return",((0,v.t)(this._worker)&&(this._worker=new V((function(e){return a.view.resourceController.schedule(e)}))),this._worker.invoke(i,r).then((function(e){if((0,v.r)(e))return{positionData:e.positions,featureIds:e.featureIds};throw new Error("Failed to decompress Draco point data")}))));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_checkExtent",value:function(e,t){e&&!(0,m.e)(e,t)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&L.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&L.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++)}},{key:"addNode",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,a){var o,s,u,d,l,c,h;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(H(r)||P(r)){e.next=2;break}throw new Error;case 2:if(!this._nodesAddedToStage.has(t.index)){e.next=4;break}return e.abrupt("return",void L.error("I3S node "+t.id+" already added"));case 4:if(o=(0,v.r)(this.layer.fullExtent)?q(this.layer.fullExtent.clone(),.5):null,s=this._controller.crsVertex,u=[],d={graphics:null,featureIds:null,attributeInfo:r.attributeDataInfo,node:t},!H(r)){e.next=10;break}return e.next=8,this._addNodeBinaryPointData(t,d,r,o,u,a);case 8:e.next=11;break;case 10:P(r)&&this._addNodeLegacyPointData(t,d,r,o,u);case 11:return e.next=13,this._attributeOverrides.apply(d.featureIds,r.attributeDataInfo,a);case 13:if(t.numFeatures=d.graphics.length,this._updateNodeMemory(t),j(d),u.length>0&&(this._computeObb(t,u,s),this._controller.updateVisibility(t.index)),!this._controller.isGeometryVisible(t)){e.next=22;break}if((0,v.r)(this._verticalScale)){l=(0,i.Z)(d.graphics);try{for(l.s();!(c=l.n()).done;)h=c.value,this._verticalScale(h.geometry)}catch(n){l.e(n)}finally{l.f()}}this._nodesAddedToStage.set(t.index,d),this.loadedGraphics.addMany(d.graphics),this._controller.updateLoadStatus(t.index,!0),this._filterNode(d),this._treeDebugger&&this._treeDebugger.update(),e.next=23;break;case 22:this._cacheNodeData(d);case 23:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_computeObb",value:function(e,t,r){var i=this._controller.crsIndex,n=i.isGeographic?this.view.renderSpatialReference:i;(0,_.U)(t,r,0,t,n,0,t.length/3);var a={data:t,size:3};e.serviceObb=(0,k.aM)(a),i.isGeographic&&(0,_.B)(e.serviceObb.center,n,e.serviceObb.center,i)}},{key:"isNodeLoaded",value:function(e){return this._nodesAddedToStage.has(e)}},{key:"isNodeReloading",value:function(){return!1}},{key:"updateNodeState",value:function(){}},{key:"_addNodeBinaryPointData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,i,a,o,s){var u,d,l,c,h,p,y,b,m,x,k,w,I,D,S,F,C,O,A;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._extractBinaryPointData(i,s);case 2:if(null!=(u=e.sent)){e.next=5;break}throw new Error;case 5:for(d=this._getObjectIdField(),l=this._controller.crsVertex,c=this.view.spatialReference,h=this.processor.graphicsCore,p=u.positionData,y=u.featureIds,3,b=p.length/3,m=new Array,x=0;x<b;x++)k=(0,v.r)(t.serviceObb)?t.serviceObb.center:[0,0,0],w=3*x,I=(0,g.r)(p[w+0],p[w+1],p[w+2]),(0,g.u)(I,I,k),t.serviceObb||o.push(I[0],I[1],I[2]),(0,v.r)(a)&&this._checkExtent(a,I),D=y[x],S={},null!=D&&(S[d]=D),F=null==D?f.g.generateUID():D,(0,_.U)(I,l,0,B,c,0,1),C=(0,E.v)(B[0],B[1],B[2],c),O=this.loadedGraphics.get(F),(0,v.r)(O)?(O.level<t.level&&(Q.property="geometry",Q.graphic=O,Q.oldValue=(0,v.e)(O.geometry),Q.newValue=C,O.geometry=C,h.graphicUpdateHandler(Q)),m.push(O)):(A=f.g.generateUID(),m.push({objectId:F,uid:A,geometry:C,attributes:S,visible:!0,level:t.level}));r.graphics=m,r.featureIds=Array.from(y);case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,o){return e.apply(this,arguments)}}()},{key:"_addNodeLegacyPointData",value:function(e,t,r,n,a){var o,s=this._getObjectIdField(),u=this._controller.crsVertex,d=this.view.spatialReference,l=[0,0,0],c=new Array,h=new Array,p=(0,i.Z)(r.pointData);try{for(p.s();!(o=p.n()).done;){var y=o.value,g=y.featureDataPosition,b=g.length,m=y.geometries&&y.geometries[0]||U[b],x=y.featureIds[0];if("points"===m.params.type){(0,v.r)(n)&&this._checkExtent(n,g);var k={};null!=x&&(k[s]=x);var w=null==x?f.g.generateUID():x,I=void 0;"Embedded"===m.type&&(I=m.params.vertexAttributes.position);for(var D=0;D<I.length;D+=b){for(var S=0;S<b;S++)l[S]=g[S]+I[D+S];var F=3===b;e.serviceObb||a.push(l[0],l[1],F?l[2]:0),(0,_.U)(l,u,0,B,d,0,1);var C=(0,E.v)(B[0],B[1],F?B[2]:void 0,d),O=this.loadedGraphics.get(w);(0,v.r)(O)?h.push(O):h.push({objectId:w,uid:f.g.generateUID(),geometry:C,attributes:k,visible:!0})}c.push(x)}}}catch(A){p.e(A)}finally{p.f()}t.graphics=h,t.featureIds=c}},{key:"_updateNodeMemory",value:function(e){e.memory=4096+((0,v.r)(e.numFeatures)?e.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)}},{key:"_cacheNodeData",value:function(e){var t=e.graphics.reduce((function(e,t){return(0,E.A)(t)+e}),512+8*e.featureIds.length+1024);this._memCache.put(this._getMemCacheKey(e.node),e,t)}},{key:"_getMemCacheKey",value:function(e){return"".concat(e.index)}},{key:"_removeAllNodeData",value:function(){var e=this;this._nodesAddedToStage.forEach((function(t,r){if(t){var i=t.node;e._updateNodeMemory(i),e._cacheNodeData(t)}e._controller.updateLoadStatus(r,!1)})),this._nodesAddedToStage.clear(),this._treeDebugger&&this._treeDebugger.update(),this.loadedGraphics.clear()}},{key:"removeNode",value:function(e){var t=this._removeNodeStageData(e);t&&(this._updateNodeMemory(t.node),this._cacheNodeData(t))}},{key:"_removeNodeStageData",value:function(e){var t=this._nodesAddedToStage.get(e);return t?(this._controller.updateLoadStatus(e,!1),this.loadedGraphics.removeMany(t.graphics),this._nodesAddedToStage.delete(e),this._treeDebugger&&this._treeDebugger.update(),t):null}},{key:"loadCachedNodeData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._memCache.pop(this._getMemCacheKey(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addCachedNodeData",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,i,a){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._nodesAddedToStage.has(t.index)){e.next=4;break}L.error("I3S node "+t.id+" already added"),e.next=12;break;case 4:return this.loadedGraphics.addMany(r.graphics),this._nodesAddedToStage.set(t.index,r),this._controller.updateLoadStatus(t.index,!0),this._updateNodeMemory(t),e.next=10,this.updateAttributes(t.index,i,a);case 10:this._filterNode(r),this._treeDebugger&&this._treeDebugger.update();case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n){return e.apply(this,arguments)}}()},{key:"getLoadedNodeIds",value:function(){var e=[];return this._nodesAddedToStage.forEach((function(t){return e.push(t.node.id)})),e.sort()}},{key:"getVisibleNodes",value:function(){var e=new Array;return this._nodesAddedToStage.forEach((function(t){return e.push(t.node)})),e}},{key:"getLoadedNodeIndices",value:function(e){this._nodesAddedToStage.forEach((function(t,r){return e.push(r)}))}},{key:"getLoadedAttributes",value:function(e){var t=this._nodesAddedToStage.get(e);if(t&&(0,v.r)(t.attributeInfo))return t.attributeInfo.loadedAttributes}},{key:"getAttributeData",value:function(e){var t=this._nodesAddedToStage.get(e);if(t&&(0,v.r)(t.attributeInfo))return t.attributeInfo.attributeData}},{key:"_setAttributeData",value:function(e,t){var r=this._nodesAddedToStage.get(e);r&&!(0,v.t)(r.attributeInfo)&&(r.attributeInfo.attributeData=t,this._attributeValuesChanged(r))}},{key:"updateAttributes",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r,i){var a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this._nodesAddedToStage.get(t),e.t0=a,!e.t0){e.next=7;break}return e.next=5,this._attributeOverrides.apply(a.featureIds,r,i);case 5:a.attributeInfo=r,this._attributeValuesChanged(a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_attributeValuesChanged",value:function(e){if(j(e),this._filterNode(e),this.processor.graphicsCore.labelsEnabled){var t=e.graphics.map((function(e){return e.uid}));this.processor.graphicsCore.updateLabelingInfo(t)}}},{key:"_updateClippingExtent",value:function(e){return this._controller&&this._controller.updateClippingArea(e),!1}},{key:"_getObjectIdField",value:function(){return this.layer.objectIdField||"OBJECTID"}},{key:"_rendererChange",value:function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r){var i,a,o,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.layer.fieldsIndex,a=new Set,!t){e.next=7;break}return e.next=4,t.collectRequiredFields(a,i);case 4:o=Array.from(a).sort(),e.next=8;break;case 7:o=[];case 8:if(a.clear(),!r){e.next=15;break}return e.next=12,r.collectRequiredFields(a,i);case 12:s=Array.from(a).sort(),e.next=16;break;case 15:s=[];case 16:o.length===s.length&&o.every((function(e,t){return o[t]===s[t]}))||this._reloadAllNodes();case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_rangeInfosChanged",value:function(e){null!=e&&e.length>0&&L.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")}},{key:"_filterChange",value:function(){var e=this;this._nodesAddedToStage.forEach((function(t){return e._filterNode(t)}))}},{key:"_reloadAllNodes",value:function(){this._removeAllNodeData(),this._controller&&this._controller.restartNodeLoading()}},{key:"_filterNode",value:function(e){var t,r=this.parsedDefinitionExpression,n=this.excludeObjectIdsSorted,a=this._getObjectIdField(),o=(0,i.Z)(e.graphics);try{for(o.s();!(t=o.n()).done;){var s=t.value,u=s.visible,d=!r||this._evaluateClause(r,s),l=(0,v.t)(n)||(0,v.O)(n,s.attributes[a])<0;s.visible=d&&l,u!==s.visible&&(Q.graphic=s,Q.property="visible",Q.oldValue=u,Q.newValue=s.visible,this.processor.graphicsCore.graphicUpdateHandler(Q))}}catch(c){o.e(c)}finally{o.f()}}},{key:"_invalidateElevation",value:function(e){var t=this._controller.crsIndex;(0,_.z)(e.extent,e.spatialReference,z,t),this._controller.updateElevationChanged(z,t)}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return(0,v.r)(this.filter)?this.filter.createQuery(e):new D.b(e)}},{key:"queryFeatures",value:function(e,t){return this._queryEngine.executeQuery(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryObjectIds",value:function(e,t){return this._queryEngine.executeQueryForIds(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryFeatureCount",value:function(e,t){return this._queryEngine.executeQueryForCount(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"queryExtent",value:function(e,t){return this._queryEngine.executeQueryForExtent(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"_ensureQuery",value:function(e){return this._addDefinitionExpressionToQuery((0,v.t)(e)?this.createQuery():D.b.from(e))}},{key:"getUsedMemory",value:function(){var e,t,r;return null!==(e=null===(t=this.processor)||void 0===t||null===(r=t.graphicsCore)||void 0===r?void 0:r.usedMemory)&&void 0!==e?e:0}},{key:"getUnloadedMemory",value:function(){var e,t,r,i,n;return.8*((null!==(e=null===(t=this._controller)||void 0===t?void 0:t.unloadedMemoryEstimate)&&void 0!==e?e:0)+(null!==(r=null===(i=this.processor)||void 0===i||null===(n=i.graphicsCore)||void 0===n?void 0:n.unprocessedMemoryEstimate)&&void 0!==r?r:0))}},{key:"ignoresMemoryFactor",value:function(){return this._controller&&this._controller.fixedFeatureTarget}},{key:"_handleEdits",value:function(e){(0,O.a)(this.attributeEditingContext,e)}},{key:"attributeEditingContext",get:function(){var e=this,t=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:t,forEachNode:function(t){return e._nodesAddedToStage.forEach((function(e){return t(e.node,e.featureIds)}))},attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this._attributeOverrides,getAttributeData:function(t){return e.getAttributeData(t)},setAttributeData:function(r,i,n){e._setAttributeData(r,i);var a=e._nodesAddedToStage.get(r);if((0,v.r)(n)){var o=e.loadedGraphics.get(n.attributes[t]);(0,v.r)(o)&&e.processor.graphicsCore.recreateGraphics([o])}else(0,v.r)(a)&&e.processor.graphicsCore.recreateGraphics(a.graphics)},clearMemCache:function(){}}}},{key:"performanceInfo",get:function(){var e={displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this._nodesAddedToStage.size,core:this.processor.graphicsCore.performanceInfo};return this._controller&&this._controller.updateStats(e),e}},{key:"test",get:function(){return{controller:this._controller,numNodes:this._nodesAddedToStage.size,loadedGraphics:this.loadedGraphics}}}]),p}((0,A.p)((0,N.c)((0,F.n)(O.g))));(0,p.e)([(0,p.d)()],G.prototype,"processor",void 0),(0,p.e)([(0,p.d)({type:I.y})],G.prototype,"filter",void 0),(0,p.e)([(0,p.d)()],G.prototype,"loadedGraphics",void 0),(0,p.e)([(0,p.d)({aliasOf:"layer"})],G.prototype,"i3slayer",void 0),(0,p.e)([(0,p.d)()],G.prototype,"_controller",void 0),(0,p.e)([(0,p.d)()],G.prototype,"updating",void 0),(0,p.e)([(0,p.d)()],G.prototype,"suspended",void 0),(0,p.e)([(0,p.d)()],G.prototype,"holeFilling",void 0),(0,p.e)([(0,p.d)(k.t)],G.prototype,"updatingProgress",void 0),(0,p.e)([(0,p.d)({aliasOf:"_controller.updatingProgress"})],G.prototype,"updatingProgressValue",void 0),(0,p.e)([(0,p.d)(M.requiredFields)],G.prototype,"requiredFields",null),(0,p.e)([(0,p.d)(M.availableFields)],G.prototype,"availableFields",void 0),(0,p.e)([(0,p.d)()],G.prototype,"fieldsHelper",void 0),(0,p.e)([(0,p.d)({type:Number})],G.prototype,"maximumNumberOfFeatures",null),(0,p.e)([(0,p.d)({readOnly:!0})],G.prototype,"maximumNumberOfFeaturesExceeded",null),(0,p.e)([(0,p.d)()],G.prototype,"excludeObjectIdsSorted",null),(0,p.e)([(0,p.d)({readOnly:!0})],G.prototype,"lodFactor",null),(0,p.e)([(0,p.d)({readOnly:!0})],G.prototype,"hasM",null),(0,p.e)([(0,p.d)({readOnly:!0})],G.prototype,"hasZ",null);var R=G=(0,p.e)([(0,p.n)("esri.views.3d.layers.SceneLayerGraphicsView3D")],G);function P(e){return"pointData"in e}function H(e){return"geometryBuffer"in e&&null!==e.geometryBuffer}function j(e){for(var t=e.attributeInfo,r=0;r<e.graphics.length;r++){var n=e.graphics[r];if(n.attributes||(n.attributes={}),(0,v.r)(t)&&(0,v.r)(t.loadedAttributes)){var a,o=(0,i.Z)(t.loadedAttributes);try{for(o.s();!(a=o.n()).done;){var s=a.value.name;t.attributeData[s]&&(n.attributes[s]=(0,k.a8)(t.attributeData[s],r))}}catch(u){o.e(u)}finally{o.f()}}}}function q(e,t){return e.xmin-=t,e.ymin-=t,e.xmax+=t,e.ymax+=t,e.hasZ&&(e.zmin-=t,e.zmax+=t),e.hasM&&(e.mmin-=t,e.mmax+=t),e}var U={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},B=(0,g.n)(),Q={graphic:null,property:null,oldValue:null,newValue:null},z=(0,b.u)();t.default=R},42152:function(e,t,r){r.d(t,{d:function(){return u},s:function(){return l}});var i=r(74165),n=r(93433),a=r(15861),o=r(75610),s=r(50526);function u(e){return d.apply(this,arguments)}function d(){return d=(0,a.Z)((0,i.Z)().mark((function e(t){var r,a,u,d,l,c,h,p,f,v=arguments;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=v.length>1&&void 0!==v[1]?v[1]:t.popupTemplate,!(0,o.t)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fieldsIndex);case 5:if(a=e.sent,u=r.lastEditInfoEnabled,d=t.objectIdField,l=t.typeIdField,c=t.globalIdField,h=t.relationships,!a.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!u){e.next=19;break}return e.next=16,(0,s.L)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return p=e.t0,f=(0,s.y)(t.fieldsIndex,[].concat((0,n.Z)(a),(0,n.Z)(p))),e.abrupt("return",(l&&f.push(l),f&&d&&t.fieldsIndex.has(d)&&!f.includes(d)&&f.push(d),f&&c&&t.fieldsIndex.has(c)&&!f.includes(c)&&f.push(c),h&&h.forEach((function(e){var r=e.keyField;f&&r&&t.fieldsIndex.has(r)&&!f.includes(r)&&f.push(r)})),f));case 23:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}function l(e,t){return e.popupTemplate?e.popupTemplate:(0,o.r)(t)&&t.defaultPopupTemplateEnabled&&(0,o.r)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=4472.e44dffa9.chunk.js.map