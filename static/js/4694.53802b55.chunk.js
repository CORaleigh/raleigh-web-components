"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[4694],{44694:function(e,t,n){n.r(t),n.d(t,{FeatureServiceSnappingSource:function(){return J}});var r=n(1413),i=n(74165),o=n(15861),a=n(29439),l=n(37762),u=n(15671),s=n(43144),c=n(60136),d=n(29388),f=n(48848),p=n(630),v=n(93661),h=n(50690),y=n(47748),g=n(52638),w=n(36040),k=n(71802),_=n(91681),b=n(25747),m=n(85700),S=n(28390),Z=n(53731),I=n(74384),O=n(25456),H=n(48024),T=n(59929),P=n(82474),x=n(3356);n(15751),n(15529),n(40558),n(40114),n(59984),n(47855),n(20302),n(89794),n(48200),n(37944),n(86086),n(21385),n(85253),n(93209),n(46817),n(46337),n(93314),n(37856),n(81556),n(93116),n(65094),n(62610),n(17455),n(1500),n(56162),n(64998),n(25577),n(53586),n(60369),n(92072),n(59389),n(26313),n(37077),n(49228),n(95249),n(79557),n(75255),n(65415),n(41723),n(64772),n(43955),n(76291),n(13239),n(24093),n(6189),n(17332),n(87750),n(20846),n(67430),n(87424),n(10464),n(42467),n(46737),n(52113),n(42667),n(61118),n(85113),n(23585),n(82396),n(32043),n(98598),n(19941),n(39994),n(49871),n(63212),n(69717),n(53409),n(35182),n(62466),n(51816),n(68781),n(69641),n(15436),n(35237),n(89181),n(69768),n(35865),n(51219),n(66577),n(95643),n(33795),n(43976),n(6762),n(2959),n(2821),n(33794),n(71147),n(84186),n(70449),n(22603),n(56546),n(39926),n(8141),n(26151),n(90429),n(52559),n(95399),n(98987),n(99795),n(87753),n(29130),n(1685),n(12953),n(74797),n(45999),n(72973),n(62710),n(52721),n(61903),n(23444),n(40811),n(51920),n(63393),n(90442),n(64854),n(24623),n(64264),n(6379),n(21015),n(23341),n(41820),n(20086),n(92982),n(61416),n(77880),n(74494),n(77755),n(71645),n(89311),n(67066),n(39769),n(70607),n(3719),n(32161),n(37686),n(16641),n(62642),n(90316),n(19891),n(70522),n(43066),n(29048),n(68136),n(50253),n(27205),n(16263),n(70381),n(20675),n(85026),n(33973),n(42233),n(93122),n(70288),n(95414),n(57791),n(43345),n(75833),n(31698),n(94777),n(4937),n(87440),n(21744),n(18936),n(4397),n(25217),n(43406),n(45184),n(72361),n(22159),n(73911),n(87917),n(46018),n(70863),n(62312),n(24648),n(63999),n(1797),n(5526),n(2473),n(2467),n(75257),n(26789),n(64095),n(51732),n(2851),n(70285),n(21078),n(75016),n(52102),n(8586),n(82509),n(42947),n(92251),n(91386),n(18668),n(15132),n(2352),n(62470),n(54622),n(73679),n(62753),n(83948),n(94663),n(40345),n(66633),n(43486);function E(e,t){return(0,b.ab)(t.extent,C),(0,b.ac)(C,(0,k.o)(F,e.x,e.y,0))}var C=(0,b.G)(),F=(0,_.n)(),z=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e)).pointOfInterest=null,r}return(0,s.Z)(n,[{key:"tiles",get:function(){var e=this.tilesCoveringView,t=(0,v.r)(this.pointOfInterest)?this.pointOfInterest:this.view.center;return e.sort((function(e,n){return E(t,e)-E(t,n)})),e}},{key:"_scaleEnabled",value:function(){return(0,m.c)(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)}},{key:"tilesCoveringView",get:function(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||(0,v.t)(this.tileInfo))return[];if(!this._scaleEnabled)return[];var e,t=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),n=t.spans,r=t.lodInfo,i=r.level,o=[],a=(0,l.Z)(n);try{for(a.s();!(e=a.n()).done;)for(var u=e.value,s=u.row,c=u.colFrom,d=u.colTo,f=c;f<=d;f++){var p=r.normalizeCol(f),h=new w.t(null,i,s,p);this.tileInfo.updateTileInfo(h),o.push(h)}}catch(y){a.e(y)}finally{a.f()}return o}},{key:"tileInfo",get:function(){var e,t;return null!==(e=null===(t=this.view.featuresTilingScheme)||void 0===t?void 0:t.tileInfo)&&void 0!==e?e:null}},{key:"tileSize",get:function(){return(0,v.r)(this.tileInfo)?this.tileInfo.size[0]:256}},{key:"initialize",value:function(){var e=this;this.addHandles((0,h.l)((function(){var t,n;return null===(t=e.view)||void 0===t||null===(n=t.state)||void 0===n?void 0:n.viewpoint}),(function(){return e.notifyChange("tilesCoveringView")}),h.U))}}]),n}(f.m);(0,f.e)([(0,f.y)({readOnly:!0})],z.prototype,"tiles",null),(0,f.e)([(0,f.y)({readOnly:!0})],z.prototype,"_scaleEnabled",null),(0,f.e)([(0,f.y)({readOnly:!0})],z.prototype,"tilesCoveringView",null),(0,f.e)([(0,f.y)({readOnly:!0})],z.prototype,"tileInfo",null),(0,f.e)([(0,f.y)({readOnly:!0})],z.prototype,"tileSize",null),(0,f.e)([(0,f.y)({constructOnly:!0})],z.prototype,"view",void 0),(0,f.e)([(0,f.y)({constructOnly:!0})],z.prototype,"layer",void 0),(0,f.e)([(0,f.y)()],z.prototype,"pointOfInterest",void 0),z=(0,f.e)([(0,f.n)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],z);var M=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e)).pointOfInterest=null,r}return(0,s.Z)(n,[{key:"tiles",get:function(){var e=this.tilesCoveringView,t=this._effectivePointOfInterest;if((0,v.r)(t))for(var n=e.map((function(e){return E(t,e)})),r=1;r<n.length;r++)if(n[r-1]>n[r])return e.sort((function(e,n){return E(t,e)-E(t,n)})),e.slice();return e}},{key:"tilesCoveringView",get:function(){var e,t;return this._filterTiles(null===(e=this.view.featureTiles)||void 0===e||null===(t=e.tiles)||void 0===t?void 0:t.toArray()).map(N)}},{key:"tileInfo",get:function(){var e,t;return null!==(e=null===(t=this.view.featureTiles)||void 0===t?void 0:t.tilingScheme.toTileInfo())&&void 0!==e?e:null}},{key:"tileSize",get:function(){var e,t;return null!==(e=null===(t=this.view.featureTiles)||void 0===t?void 0:t.tileSize)&&void 0!==e?e:256}},{key:"_effectivePointOfInterest",get:function(){var e,t=this.pointOfInterest;return(0,v.r)(t)?t:null===(e=this.view.pointsOfInterest)||void 0===e?void 0:e.focus.location}},{key:"initialize",value:function(){var e=this;this.handles.add((0,h.l)((function(){return e.view.featureTiles}),(function(t){e.handles.remove(j),t&&e.handles.add(t.addClient(),j)}),h.h))}},{key:"_filterTiles",value:function(e){return(0,v.t)(e)?[]:e.filter((function(e){return Math.abs(e.measures.screenRect[3]-e.measures.screenRect[1])>R&&e.measures.visibility===S.bu.VISIBLE_ON_SURFACE}))}}]),n}(p.d);function N(e){var t=(0,a.Z)(e.lij,3),n=t[0],r=t[1],i=t[2],o=e.extent;return new w.t("".concat(n,"/").concat(r,"/").concat(i),n,r,i,o)}(0,f.e)([(0,f.y)({readOnly:!0})],M.prototype,"tiles",null),(0,f.e)([(0,f.y)({readOnly:!0})],M.prototype,"tilesCoveringView",null),(0,f.e)([(0,f.y)({readOnly:!0})],M.prototype,"tileInfo",null),(0,f.e)([(0,f.y)({readOnly:!0})],M.prototype,"tileSize",null),(0,f.e)([(0,f.y)({constructOnly:!0})],M.prototype,"view",void 0),(0,f.e)([(0,f.y)()],M.prototype,"pointOfInterest",void 0),(0,f.e)([(0,f.y)()],M.prototype,"_effectivePointOfInterest",null),M=(0,f.e)([(0,f.n)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],M);var R=50,j="feature-tiles",A=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e))._handles=new f.X,r}return(0,s.Z)(n,[{key:"initialize",value:function(){var e=this,t=setInterval((function(){return e._fetchDebugInfo()}),2e3);this._handles.add((0,f.D)((function(){return clearInterval(t)})))}},{key:"destroy",value:function(){this._handles.destroy()}},{key:"getTiles",value:function(){var e=this;if(!this._debugInfo)return[];var t=new Map,n=new Map;this._debugInfo.storedTiles.forEach((function(e){t.set(e.data.id,e.featureCount)})),this._debugInfo.pendingTiles.forEach((function(e){t.set(e.data.id,e.featureCount),n.set(e.data.id,e.state)}));var r=function(e){var r,i=n.get(e),o=null!==(r=t.get(e))&&void 0!==r?r:"?";return i?"".concat(i,":").concat(o,"\n").concat(e):"store:".concat(o,"\n").concat(e)},i=new Map;return this._debugInfo.storedTiles.forEach((function(e){i.set(e.data.id,e.data)})),this._debugInfo.pendingTiles.forEach((function(e){i.set(e.data.id,e.data)})),Array.from(i.values()).map((function(t){return{lij:[t.level,t.row,t.col],geometry:I.v.fromExtent((0,O.f)(t.extent,e.view.spatialReference)),label:r(t.id)}}))}},{key:"_fetchDebugInfo",value:function(){var e=this;this.handle.getDebugInfo(null).then((function(t){e._debugInfo=t,e.update()}))}}]),n}(H.b);(0,f.e)([(0,f.y)({constructOnly:!0})],A.prototype,"handle",void 0),A=(0,f.e)([(0,f.n)("esri.views.interactive.snapping.featureSources.WorkerTileTreeDebugger")],A);var V=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e)).schedule=null,r.hasZ=!1,r.elevationAlignPointsInFeatures=function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){var n,r,o,a,u,s,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=(0,l.Z)(t);try{for(r.s();!(o=r.n()).done;){a=o.value.points,u=(0,l.Z)(a);try{for(u.s();!(s=u.n()).done;)c=s.value.z,n.push(c)}catch(i){u.e(i)}finally{u.f()}}}catch(i){r.e(i)}finally{r.f()}return e.abrupt("return",{elevations:n,drapedObjectIds:new Set,failedObjectIds:new Set});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),r.queryForSymbologySnapping=(0,o.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{candidates:[],sourceCandidateIndices:[]});case 1:case"end":return e.stop()}}),e)}))),r.availability=0,r._workerHandleUpdating=!0,r._editId=0,r}return(0,s.Z)(n,[{key:"updating",get:function(){return this.updatingHandles.updating||this._workerHandleUpdating}},{key:"destroy",value:function(){this._workerHandle.destroy()}},{key:"initialize",value:function(){var e=this;this._workerHandle=new U(this.schedule,{alignElevation:function(){var t=(0,o.Z)((0,i.Z)().mark((function t(n,r){var o;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=r.signal,t.next=3,e.elevationAlignPointsInFeatures(n.points,o);case 3:return t.t0=t.sent,t.abrupt("return",{result:t.t0});case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),getSymbologyCandidates:function(){var t=(0,o.Z)((0,i.Z)().mark((function t(n,r){var o;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=r.signal,t.next=3,e.queryForSymbologySnapping(n,o);case 3:return t.t0=t.sent,t.abrupt("return",{result:t.t0});case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}),this.handles.add([this._workerHandle.on("notify-updating",(function(t){var n=t.updating;return e._workerHandleUpdating=n})),this._workerHandle.on("notify-availability",(function(t){var n=t.availability;return e._set("availability",n)}))])}},{key:"setup",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){var r,o,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this._serviceInfoFromLayer(t.layer),!(0,v.t)(o)){e.next=3;break}return e.abrupt("return");case 3:return a={configuration:this._convertConfiguration(t.configuration),serviceInfo:o,spatialReference:t.spatialReference.toJSON(),hasZ:this.hasZ,elevationInfo:null===(r=t.layer.elevationInfo)||void 0===r?void 0:r.toJSON()},e.next=6,this.updatingHandles.addPromise(this._workerHandle.invokeMethod("setup",a,n));case 6:this.updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},n));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"configure",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._convertConfiguration(t),e.next=3,this.updatingHandles.addPromise(this._workerHandle.invokeMethod("configure",r,n));case 3:this.updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},n));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"refresh",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updatingHandles.addPromise(this._workerHandle.invokeMethod("refresh",{},t));case 2:this.updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchCandidates",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={distance:t.distance,point:t.coordinateHelper.vectorToPoint(t.point).toJSON(),types:t.types,filter:(0,v.r)(t.filter)?t.filter.toJSON():null},e.abrupt("return",this._workerHandle.invoke(r,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateTiles",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={tiles:t.tiles,tileInfo:(0,v.r)(t.tileInfo)?t.tileInfo.toJSON():null,tileSize:t.tileSize},e.next=3,this.updatingHandles.addPromise(this._workerHandle.invokeMethod("updateTiles",r,n));case 3:this.updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},n));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"applyEdits",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){var r,o,a,l,u,s,c,d,p,h;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=this._editId++,d={id:c},e.next=3,this.updatingHandles.addPromise(this._workerHandle.invokeMethod("beginApplyEdits",d,n));case 3:return e.next=5,this.updatingHandles.addPromise((0,f.Y)(t.result,n));case 5:return p=e.sent,h={id:c,edits:{addedFeatures:null!==(r=null===(o=p.addedFeatures)||void 0===o?void 0:o.map((function(e){return e.objectId})).filter(v.r))&&void 0!==r?r:[],deletedFeatures:null!==(a=null===(l=p.deletedFeatures)||void 0===l?void 0:l.map((function(e){return{objectId:e.objectId,globalId:e.globalId}})))&&void 0!==a?a:[],updatedFeatures:null!==(u=null===(s=p.updatedFeatures)||void 0===s?void 0:s.map((function(e){return e.objectId})).filter(v.r))&&void 0!==u?u:[]}},e.next=9,this.updatingHandles.addPromise(this._workerHandle.invokeMethod("endApplyEdits",h,n));case 9:this.updatingHandles.addPromise(this._workerHandle.invokeMethod("whenNotUpdating",{},n));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDebugInfo",value:function(e){return this._workerHandle.invokeMethod("getDebugInfo",{},e)}},{key:"notifyElevationSourceChange",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._workerHandle.invokeMethod("notifyElevationSourceChange",{});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"notifySymbologyChange",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._workerHandle.invokeMethod("notifySymbologyChange",{});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setSymbologySnappingSupported",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._workerHandle.invokeMethod("setSymbologySnappingSupported",t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_convertConfiguration",value:function(e){return{filter:(0,v.r)(e.filter)?e.filter.toJSON():null,customParameters:e.customParameters,viewType:e.viewType}}},{key:"_serviceInfoFromLayer",value:function(e){var t,n,r;return"multipatch"===e.geometryType||"mesh"===e.geometryType?null:{url:null!==(t=null===(n=e.parsedUrl)||void 0===n?void 0:n.path)&&void 0!==t?t:"",fields:e.fields.map((function(e){return e.toJSON()})),geometryType:I.a.toJSON(e.geometryType),capabilities:e.capabilities,objectIdField:e.objectIdField,globalIdField:e.globalIdField,spatialReference:e.spatialReference.toJSON(),timeInfo:null===(r=e.timeInfo)||void 0===r?void 0:r.toJSON()}}}]),n}(p.d);(0,f.e)([(0,f.y)({constructOnly:!0})],V.prototype,"schedule",void 0),(0,f.e)([(0,f.y)({constructOnly:!0})],V.prototype,"hasZ",void 0),(0,f.e)([(0,f.y)({constructOnly:!0})],V.prototype,"elevationAlignPointsInFeatures",void 0),(0,f.e)([(0,f.y)({constructOnly:!0})],V.prototype,"queryForSymbologySnapping",void 0),(0,f.e)([(0,f.y)({readOnly:!0})],V.prototype,"updating",null),(0,f.e)([(0,f.y)({readOnly:!0})],V.prototype,"availability",void 0),(0,f.e)([(0,f.y)()],V.prototype,"_workerHandleUpdating",void 0),V=(0,f.e)([(0,f.n)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorkerHandle")],V);var U=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,r){return(0,u.Z)(this,n),t.call(this,"FeatureServiceSnappingSourceWorker","fetchCandidates",{},e,{strategy:"dedicated",client:r})}return(0,s.Z)(n)}(T.h),D=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e)).pointOfInterest=null,r}return(0,s.Z)(n,[{key:"tiles",get:function(){return[new w.t("0/0/0",0,0,0,(0,O.o)(-1e8,-1e8,1e8,1e8))]}},{key:"tileInfo",get:function(){return new x.j({origin:new P.w({x:-1e8,y:1e8,spatialReference:this.layer.spatialReference}),size:[512,512],lods:[new x.p({level:0,scale:1,resolution:390625})],spatialReference:this.layer.spatialReference})}},{key:"tileSize",get:function(){return this.tileInfo.size[0]}}]),n}(f.m);(0,f.e)([(0,f.y)({readOnly:!0})],D.prototype,"tiles",null),(0,f.e)([(0,f.y)({readOnly:!0})],D.prototype,"tileInfo",null),(0,f.e)([(0,f.y)({readOnly:!0})],D.prototype,"tileSize",null),(0,f.e)([(0,f.y)({constructOnly:!0})],D.prototype,"layer",void 0),(0,f.e)([(0,f.y)()],D.prototype,"pointOfInterest",void 0),D=(0,f.e)([(0,f.n)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTilesSimple")],D);var J=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){return(0,u.Z)(this,n),t.call(this,e)}return(0,s.Z)(n,[{key:"_updateTilesParameters",get:function(){return{tiles:this._tilesOfInterest.tiles,tileInfo:this._tilesOfInterest.tileInfo,tileSize:this._tilesOfInterest.tileSize}}},{key:"updating",get:function(){return this._workerHandle.updating||this.updatingHandles.updating}},{key:"configuration",get:function(){var e=this.view,t=(0,v.r)(e)?e.type:"2d";return{filter:this._layer.createQuery(),customParameters:this._layer.customParameters,viewType:t}}},{key:"availability",get:function(){return this._workerHandle.availability}},{key:"_layer",get:function(){return this.layerSource.layer}},{key:"initialize",value:function(){var e=this,t=this.view;if((0,v.r)(t))switch(t.type){case"2d":this._tilesOfInterest=new z({view:t,layer:this._layer}),this._workerHandle=new V;break;case"3d":var n,r=t.resourceController,a=this._layer,l=t.whenLayerView(a);this._tilesOfInterest=new M({view:t}),this._workerHandle=new V({schedule:function(e){return r.schedule(e)},hasZ:this._layer.hasZ&&(null===(n=this._layer.returnZ)||void 0===n||n),elevationAlignPointsInFeatures:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:return r=e.sent,e.abrupt("return",((0,f.f)(n),r.elevationAlignPointsInFeatures(t,n)));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),queryForSymbologySnapping:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l;case 2:return r=e.sent,e.abrupt("return",((0,f.f)(n),r.queryForSymbologySnapping(t,n)));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()});var u=new y.t(null);l.then((function(e){return u.set(e)})),this.addHandles([t.elevationProvider.on("elevation-change",(function(t){var n,r=t.context,i=a.elevationInfo;(0,g.y)(r,i)&&(null===(n=e._workerHandle)||void 0===n||n.notifyElevationSourceChange())})),(0,h.l)((function(){return a.elevationInfo}),(function(){var t;return null===(t=e._workerHandle)||void 0===t?void 0:t.notifyElevationSourceChange()}),h.h),(0,h.l)((function(){return(0,v.n)(u.get(),(function(e){var t=e.processor;return null===t||void 0===t?void 0:t.renderer}))}),(function(){var t;return null===(t=e._workerHandle)||void 0===t?void 0:t.notifySymbologyChange()}),h.h),(0,h.l)((function(){return(0,v.u)(u.get(),!1,(function(e){return e.symbologySnappingSupported}))}),(function(t){var n;return null===(n=e._workerHandle)||void 0===n?void 0:n.setSymbologySnappingSupported(t)}),h.h)])}else this._tilesOfInterest=new D({layer:this._layer}),this._workerHandle=new V;this.handles.add([(0,f.aF)(this._workerHandle)]),this._workerHandle.setup({layer:this._layer,spatialReference:this.spatialReference,configuration:this.configuration},null),this.updatingHandles.add((function(){return e._updateTilesParameters}),(function(){return e._workerHandle.updateTiles(e._updateTilesParameters,null)}),h.h),this.handles.add([(0,h.l)((function(){return e.configuration}),(function(t){return e._workerHandle.configure(t,null)}),h.U)]),(0,v.r)(t)&&this.handles.add((0,h.l)((function(){return y.p.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES}),(function(n){n&&!e._debug?(e._debug=new A({view:t,handle:e._workerHandle}),e.handles.add((0,f.aF)(e._debug),"debug")):!n&&e._debug&&e.handles.remove("debug")}),h.h)),this.handles.add(this.layerSource.layer.on("apply-edits",(function(t){e._workerHandle.applyEdits(t,null)})))}},{key:"refresh",value:function(){this._workerHandle.refresh(null)}},{key:"fetchCandidates",value:function(){var e=(0,o.Z)((0,i.Z)().mark((function e(t,n){var o,a,l,u,s;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.coordinateHelper,a=t.elevationInfo,l=t.point,this._tilesOfInterest.pointOfInterest=o.vectorToPoint(l),u=o.hasZ()?g.E:a,s=this._getGroundElevation,e.next=5,this._workerHandle.fetchCandidates((0,r.Z)({},t),n);case 5:return e.abrupt("return",e.sent.candidates.map((function(e){return(0,Z.r)(e,o,u,s)})));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDebugInfo",value:function(e){return this._workerHandle.getDebugInfo(e)}},{key:"_getGroundElevation",get:function(){return(0,Z.a)(this.view)}}]),n}((0,p.a)(f.m));(0,f.e)([(0,f.y)({constructOnly:!0})],J.prototype,"spatialReference",void 0),(0,f.e)([(0,f.y)({constructOnly:!0})],J.prototype,"layerSource",void 0),(0,f.e)([(0,f.y)({constructOnly:!0})],J.prototype,"view",void 0),(0,f.e)([(0,f.y)()],J.prototype,"_tilesOfInterest",void 0),(0,f.e)([(0,f.y)({readOnly:!0})],J.prototype,"_updateTilesParameters",null),(0,f.e)([(0,f.y)({readOnly:!0})],J.prototype,"updating",null),(0,f.e)([(0,f.y)({readOnly:!0})],J.prototype,"configuration",null),(0,f.e)([(0,f.y)({readOnly:!0})],J.prototype,"availability",null),(0,f.e)([(0,f.y)()],J.prototype,"_getGroundElevation",null),J=(0,f.e)([(0,f.n)("esri.views.interactive.snapping.featureSources.FeatureServiceSnappingSource")],J)},48024:function(e,t,n){n.d(t,{b:function(){return v}});var r=n(15671),i=n(43144),o=n(60136),a=n(29388),l=n(48848),u=n(89794),s=n(64998),c=n(71802),d=n(93661),f=n(37944),p=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]],v=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).updating=!1,i.enablePolygons=!0,i.enableLabels=!0,i._polygons=new Map,i._labels=new Map,i._enabled=!0,i}return(0,i.Z)(n,[{key:"initialize",value:function(){this._symbols=p.map((function(e){return new f.a({color:[e[0],e[1],e[2],.6],outline:{color:"black",width:1}})})),this.update()}},{key:"destroy",value:function(){this._enabled=!1,this.clear()}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this.update())}},{key:"update",value:function(){var e=this;if(this._enabled){var t=this.getTiles(),n=new Array,r=new Set(this._labels.keys());t.forEach((function(i,o){var a=i.lij.toString();r.delete(a);var l=i.lij[0],p=i.geometry;if(e.enablePolygons&&!e._polygons.has(a)){var v=new s.g({geometry:p,symbol:e._symbols[l%e._symbols.length]});e._polygons.set(a,v),n.push(v)}if(e.enableLabels){var h=function(e){if((0,d.r)(e.label))return e.label;var t=e.lij.toString();return(0,d.r)(e.loadPriority)&&(t+=" (".concat(e.loadPriority,")")),t}(i),y=o/(t.length-1),g=(0,c.Z)(0,200,y),w=(0,c.Z)(20,6,y)/.75,k=(0,d.r)(i.loadPriority)&&i.loadPriority>=t.length,_=new u.l([g,k?0:g,k?0:g]),b="3d"===e.view.type?function(){return new f.d({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new f.A({text:h,halo:{color:"white",size:1/.75},material:{color:_},size:w})]})}:function(){return new f.b({text:h,haloColor:"white",haloSize:1/.75,color:_,size:w})};if(e._labels.has(a)){var m=e._labels.get(a),S=b();((0,d.t)(m.symbol)||JSON.stringify(S)!==JSON.stringify(m.symbol))&&(m.symbol=S)}else{var Z=new s.g({geometry:p.extent.center,symbol:b()});e._labels.set(a,Z),n.push(Z)}}}));var i=new Array;r.forEach((function(t){e._polygons.has(t)&&(i.push(e._polygons.get(t)),e._polygons.delete(t)),e._labels.has(t)&&(i.push(e._labels.get(t)),e._labels.delete(t))})),this.view.graphics.removeMany(i),this.view.graphics.addMany(n)}else this.clear()}},{key:"clear",value:function(){this.view.graphics.removeMany(Array.from(this._polygons.values())),this.view.graphics.removeMany(Array.from(this._labels.values())),this._polygons.clear(),this._labels.clear()}}]),n}(l.m);(0,l.e)([(0,l.y)({constructOnly:!0})],v.prototype,"view",void 0),(0,l.e)([(0,l.y)({readOnly:!0})],v.prototype,"updating",void 0),(0,l.e)([(0,l.y)()],v.prototype,"enabled",null),v=(0,l.e)([(0,l.n)("esri.views.support.TileTreeDebugger")],v)},43486:function(e,t,n){n.d(t,{o:function(){return s}});var r=n(1413),i=n(15671),o=n(43144),a=n(60136),l=n(29388),u=n(21078),s=function(e){(0,a.Z)(n,e);var t=(0,l.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,(0,r.Z)((0,r.Z)({},e),{},{constraint:new u.j(e.coordinateHelper,e.targetPoint)}))}return(0,o.Z)(n,[{key:"hints",get:function(){return[new u.a(this.targetPoint,this.elevationInfo,this.domain)]}}]),n}(u.n)},53731:function(e,t,n){n.d(t,{a:function(){return p},r:function(){return f}});var r=n(1413),i=n(15671),o=n(43144),a=n(60136),l=n(29388),u=n(93661),s=n(21078),c=n(43486),d=function(e){(0,a.Z)(n,e);var t=(0,l.Z)(n);function n(e){return(0,i.Z)(this,n),t.call(this,(0,r.Z)((0,r.Z)({},e),{},{constraint:new s.N(e.coordinateHelper,e.edgeStart,e.edgeEnd,e.getGroundElevation)}))}return(0,o.Z)(n,[{key:"hints",get:function(){return[new s.s(s.l.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo,this.domain)]}}]),n}(s.n);function f(e,t,n,r){switch(e.type){case"edge":return e.draped?new d({coordinateHelper:t,edgeStart:t.pointToVector(e.start),edgeEnd:t.pointToVector(e.end),targetPoint:t.pointToVector(e.target),objectId:e.objectId,getGroundElevation:r,elevationInfo:n}):new s.e({coordinateHelper:t,edgeStart:t.pointToVector(e.start),edgeEnd:t.pointToVector(e.end),targetPoint:t.pointToVector(e.target),objectId:e.objectId,elevationInfo:n});case"vertex":return new c.o({coordinateHelper:t,targetPoint:t.pointToVector(e.target),objectId:e.objectId,elevationInfo:n})}}function p(e){return(0,u.r)(e)&&"3d"===e.type?function(t,n,r){return e.elevationProvider.getElevation(t,n,r,e.spatialReference,"ground")}:function(){return null}}}}]);
//# sourceMappingURL=4694.53802b55.chunk.js.map