"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[7276,1816,6547],{62710:function(e,t,n){n.d(t,{i:function(){return l}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(48848);n(93661);var l=function(e){var t=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"apiKey",get:function(){var e;return this._isOverridden("apiKey")?this._get("apiKey"):"portalItem"in this?null===(e=this.portalItem)||void 0===e?void 0:e.apiKey:null},set:function(e){null!=e?this._override("apiKey",e):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}}]),n}(e);return(0,s.e)([(0,s.y)({type:String})],t.prototype,"apiKey",null),t=(0,s.e)([(0,s.n)("esri.layers.mixins.APIKeyMixin")],t)}},52721:function(e,t,n){n.d(t,{p:function(){return c}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(48848),l=n(93661),u=n(1685),c=function(e){var t=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"title",get:function(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){var e=(0,u.m)(this.url);if((0,l.r)(e)&&e.title)return e.title}return this._get("title")||""},set:function(e){this._set("title",e)}},{key:"url",set:function(e){this._set("url",(0,u.S)(e,s.a.getLogger(this.declaredClass)))}}]),n}(e);return(0,s.e)([(0,s.y)()],t.prototype,"title",null),(0,s.e)([(0,s.y)({type:String})],t.prototype,"url",null),t=(0,s.e)([(0,s.n)("esri.layers.mixins.ArcGISService")],t)}},1500:function(e,t,n){n.d(t,{i:function(){return o},o:function(){return l},r:function(){return u},s:function(){return c}});var r=n(15671),i=n(43144),a=n(71802),o=function(){function e(t,n){(0,r.Z)(this,e),this.min=t,this.max=n,this.range=n-t}return(0,i.Z)(e,[{key:"ndiff",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.ceil((e-t)/this.range)*this.range+t}},{key:"_normalize",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return(n-=r)<e?n+=this.ndiff(e-n):n>t&&(n-=this.ndiff(n-t)),i&&n===t&&(n=e),n+r}},{key:"normalize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._normalize(this.min,this.max,e,t,n)}},{key:"clamp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,a.a)(e-t,this.min,this.max)+t}},{key:"monotonic",value:function(e,t,n){return e<t?t:t+this.ndiff(e-t,n)}},{key:"minimalMonotonic",value:function(e,t,n){return this._normalize(e,e+this.range,t,n)}},{key:"center",value:function(e,t,n){return t=this.monotonic(e,t,n),this.normalize((e+t)/2,n)}},{key:"diff",value:function(e,t,n){return this.monotonic(e,t,n)-e}},{key:"shortestSignedDiff",value:function(e,t){e=this.normalize(e);var n=(t=this.normalize(t))-e,r=t<e?this.minimalMonotonic(e,t)-e:t-this.minimalMonotonic(t,e);return Math.abs(n)<Math.abs(r)?n:r}},{key:"contains",value:function(e,t,n){return t=this.minimalMonotonic(e,t),(n=this.minimalMonotonic(e,n))>e&&n<t}}]),e}();function s(e){for(var t in e){var n=e[t];n instanceof Function&&(e[t]=n.bind(e))}return e}var l=s(new o(0,2*Math.PI)),u=s(new o(-Math.PI,Math.PI)),c=s(new o(0,360))},98598:function(e,t,n){n.r(t),n.d(t,{C:function(){return ni},D:function(){return U},F:function(){return ri},W:function(){return $r},a:function(){return Yr},e:function(){return j},g:function(){return z},h:function(){return B},i:function(){return Xr},j:function(){return H},y:function(){return W}});var r=n(97326),i=n(37762),a=n(29439),o=n(4942),s=n(74165),l=n(15671),u=n(43144),c=n(60136),d=n(29388),f=n(93433),p=n(1413),h=n(15861),v=n(48848),y=n(46737),m=n(50690),g=n(93661),b=n(42467),_=n(43955),w=(n(1500),n(71802)),k=n(47855),I=n(53586),M=n(64998),F=n(93314),x=n(19941),A=n(35865),C=n(59984),Z=n(25577),E=n(75255),T=n(51219),L=n(630),S=n(90429),R=n(40558),P=n(35237),O=(n(82474),n(52559),n(46817),n(74384),n(63212),n(35182),n(68781),n(95399),n(65094)),N=n(98987),V=n(62610),q=n(92072);function j(e,t,n,r){var i=null,a=1e3;"number"==typeof t?(a=t,r=n):(i=null!==t&&void 0!==t?t:null,a=n);var o,s=0,l=function(){s=0,e.apply(r,o)},u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];i&&i.apply(r,t),o=t,a?s||(s=setTimeout(l,a)):l()};return u.remove=function(){s&&(clearTimeout(s),s=0)},u.forceUpdate=function(){s&&(clearTimeout(s),l())},u.hasPendingUpdates=function(){return!!s},u}function D(e,t,n){return e.units[t][n]}function z(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr";return"".concat((0,I.m)(t,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:t>0?"never":"exceptZero"})," ").concat(D(e,n,i))}function U(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr",a=(0,k.O)(t,n);return z(e,(0,k.a)(t,n,a),a,r,i)}function W(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr",a=(0,k.J)(t,n);return z(e,(0,k.a)(t,n,a),a,r,i)}function B(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr",a=(0,k.K)(t,n);return z(e,(0,k.a)(t,n,a),a,r,i)}function H(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"abbr",a=(0,k.b)(t,n);return z(e,(0,k.a)(t,n,a),a,r,i)}var G=["B","kB","MB","GB","TB"];var Q=v.a.getLogger("esri.widgets.Feature.support.featureUtils"),K=/href=(""|'')/gi,$=/(\{([^\{\r\n]+)\})/g,Y=/\'/g,X=/^\s*expression\//i,J=/(\n)/gi,ee=/[\u00A0-\u9999<>\&]/gim,te=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,ne=/^(?:mailto:|tel:)/,re="relationships/",ie=(0,I.S)("short-date-short-time");function ae(e){if(!(0,g.t)(e))return e.get("sourceLayer")||e.get("layer")}function oe(e,t){return se.apply(this,arguments)}function se(){return se=(0,h.Z)((0,s.Z)().mark((function e(t,n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","function"==typeof t?t.call(null,n):t);case 1:case"end":return e.stop()}}),e)}))),se.apply(this,arguments)}function le(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!ne.test(e.trim().toLowerCase())}function ue(e){return!!e&&X.test(e)}function ce(e,t){var n=function(e,t){if(!ue(t)||!e)return null;var n,r=t.replace(X,"").toLowerCase();return e.some((function(e){return e.name.toLowerCase()===r&&(n=e,!0)})),n}(t,null===e||void 0===e?void 0:e.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function de(e,t){var n=fe(t,e);return n?n.name:e}function fe(e,t){return e&&"function"==typeof e.getField?e.getField(t):null}function pe(e){return"".concat(e).trim()}function he(e){var t=e.attributes,n=e.globalAttributes,r=e.layer,i=e.text,a=e.expressionAttributes,o=e.fieldInfoMap;return i?ve({formattedAttributes:n,template:be(i,(0,p.Z)((0,p.Z)((0,p.Z)({},n),a),t),r),fieldInfoMap:o}):""}function ve(e){var t=e.formattedAttributes,n=e.template,r=e.fieldInfoMap;return pe(function(e){return e.replace(K,"")}((0,v.H)((0,v.H)(n,(function(e){return function(e,t){var n=t.get(e.toLowerCase());return"{".concat(n&&n.fieldName||e,"}")}(e,r)})),t)))}function ye(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t[e];if("string"==typeof r){var i="%27",a=(n?encodeURIComponent(r):r).replace(Y,i);t[e]=a}}function me(e,t,n){var r=(t=pe(t))&&"{"!==t[0];return(0,v.H)(e,function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,p.Z)({},e);return Object.keys(n).forEach((function(e){return ye(e,n,t)})),n}(n,r))}function ge(e,t){return e.replace($,(function(e,n,r){var i=fe(t,r);return i?"{".concat(i.name,"}"):n}))}function be(e,t,n){var r=ge(e,n);return r?r.replace(te,(function(e,n,r){return me(e,n||r,t)})):r}function _e(e){return!(null===e||void 0===e||!e.layer)}function we(e,t){var n,r=t.fieldInfos,i=t.fieldName,a=null===(n=ke(r,i))||void 0===n?void 0:n.clone(),o=t.preventPlacesFormatting,s=t.layer,l=fe(s,i);if(a&&"date"===(null===l||void 0===l?void 0:l.type)){var u=a.format||new Z.u;u.dateFormat=u.dateFormat||"short-date-short-time",u.dateTimeFormatOptions=!_e(s)&&function(e){return"feature"===(null===e||void 0===e?void 0:e.type)}(s)&&s.datesInUnknownTimezone||_e(s)&&function(e){return"map-image"===(null===e||void 0===e?void 0:e.type)}(s.layer)&&s.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,a.format=u}var c=a&&a.format;return"string"==typeof e&&(0,C.a)(i)&&c?c.formatRasterPixelValue(e):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){var n=Number(e);if(!isNaN(n))return n}return e}(e,c))||null==e||null==c?Fe(e):o?(0,I.m)(e,(0,p.Z)((0,p.Z)({},(0,I.u)(c)),{},{minimumFractionDigits:0,maximumFractionDigits:20})):c.format(e)}function ke(e,t){if(e&&e.length&&t){var n,r=t.toLowerCase();return e.some((function(e){return!(!e.fieldName||e.fieldName.toLowerCase()!==r)&&(n=e,!0)})),n}}function Ie(e){var t=[];if(!e)return t;var n=e.fieldInfos,r=e.content;return n&&t.push.apply(t,(0,f.Z)(n)),r&&Array.isArray(r)?(r.forEach((function(e){if("fields"===e.type){var n=e&&e.fieldInfos;n&&t.push.apply(t,(0,f.Z)(n))}})),t):t}function Me(e){return e.replace(ee,(function(e){return"&#".concat(e.charCodeAt(0),";")}))}function Fe(e){return"string"==typeof e?e.replace(J,'<br class="esri-text-new-line" />'):e}function xe(e){var t=e.value,n=e.fieldName,r=e.fieldInfos,i=e.fieldInfoMap,a=e.layer,o=e.graphic;if(null==t)return"";var s=function(e){var t=e.fieldName,n=e.value,r=e.graphic,i=e.layer;if(Re(t))return null;if(!i||"function"!=typeof i.getFieldDomain)return null;var a=i.getFieldDomain(t,{feature:r});return a&&"coded-value"===a.type?a.getName(n):null}({fieldName:n,value:t,graphic:o,layer:a});if(s)return s;var l=function(e){var t=e.fieldName,n=e.graphic,r=e.layer;if(Re(t))return null;if(!r||"function"!=typeof r.getFeatureType)return null;var i=r.typeIdField;if(!i||t!==i)return null;var a=r.getFeatureType(n);return a?a.name:null}({fieldName:n,graphic:o,layer:a});if(l)return l;if(i.get(n.toLowerCase()))return we(t,{fieldInfos:r||Array.from(i.values()),fieldName:n,layer:a});var u=a&&a.fieldsIndex;return u&&u.isDateField(n)?(0,I.L)(t,ie):Fe(t)}function Ae(e){var t=e.fieldInfos,n=e.attributes,r=e.layer,i=e.graphic,a=e.fieldInfoMap,o=e.relatedInfos,s={};return null!==o&&void 0!==o&&o.forEach((function(e){return function(e){var t=e.attributes,n=e.relatedInfo,r=e.fieldInfoMap,i=e.fieldInfos,a=e.layer;t&&n&&(n.relatedFeatures&&n.relatedFeatures&&n.relatedFeatures.forEach((function(e){return Pe({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:a})})),n.relatedStatsFeatures&&n.relatedStatsFeatures&&n.relatedStatsFeatures.forEach((function(e){return Pe({attributes:t,graphic:e,relatedInfo:n,fieldInfoMap:r,fieldInfos:i,layer:a})})))}({attributes:s,relatedInfo:e,fieldInfoMap:a,fieldInfos:t,layer:r})})),Object.keys(n).forEach((function(e){var o=n[e];s[e]=xe({fieldName:e,fieldInfos:t,fieldInfoMap:a,layer:r,value:o,graphic:i})})),s}function Ce(e,t){return Ze.apply(this,arguments)}function Ze(){return Ze=(0,h.Z)((0,s.Z)().mark((function e(t,n){var r,i,a,o,l,u,c,d,f,p,h,v;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.layer,o=t.graphic,l=t.outFields,u=t.objectIds,c=t.returnGeometry,d=t.spatialReference,"number"==typeof(f=u[0])||"string"==typeof f){e.next=4;break}return"Could not query required fields for the specified feature. The feature's ID is invalid.",p={layer:a,graphic:o,objectId:f,requiredFields:l},e.abrupt("return",(Q.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",p),null));case 4:if(null!==(r=a.capabilities)&&void 0!==r&&null!==(i=r.operations)&&void 0!==i&&i.supportsQuery){e.next=7;break}return"The specified layer cannot be queried. The following fields will not be available.",h={layer:a,graphic:o,requiredFields:l,returnGeometry:c},e.abrupt("return",(Q.warn("The specified layer cannot be queried. The following fields will not be available.",h),null));case 7:return(v=a.createQuery()).objectIds=u,v.outFields=null!==l&&void 0!==l&&l.length?l:[a.objectIdField],v.returnGeometry=!!c,v.returnZ=!!c,v.returnM=!!c,v.outSpatialReference=d,e.next=11,a.queryFeatures(v,n);case 11:return e.abrupt("return",e.sent.features[0]);case 12:case"end":return e.stop()}}),e)}))),Ze.apply(this,arguments)}function Ee(e){return Te.apply(this,arguments)}function Te(){return Te=(0,h.Z)((0,s.Z)().mark((function e(t){var n,r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=t.expressionInfos)&&void 0!==n&&n.length){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,(0,C.i)();case 4:return r=e.sent,i=r.arcadeUtils.hasGeometryFunctions,e.abrupt("return",i(t));case 7:case"end":return e.stop()}}),e)}))),Te.apply(this,arguments)}function Le(e,t){return Se.apply(this,arguments)}function Se(){return Se=(0,h.Z)((0,s.Z)().mark((function e(t,n){var r,i,a,o,l,u,c,d,f,h,v;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.graphic,i=t.popupTemplate,a=t.layer,o=t.spatialReference,a&&i){e.next=3;break}return e.abrupt("return");case 3:if(e.t0="function"==typeof a.load,!e.t0){e.next=7;break}return e.next=7,a.load(n);case 7:if(r.attributes){e.next=9;break}return e.abrupt("return");case 9:if(null!=(l=r.attributes[a.objectIdField])){e.next=12;break}return e.abrupt("return");case 12:return u=[l],e.next=15,i.getRequiredFields(a.fieldsIndex);case 15:if(c=e.sent,d=(0,C.c)(c,r),f=d?[]:c,e.t1=i.returnGeometry,e.t1){e.next=23;break}return e.next=22,Ee(i);case 22:e.t1=e.sent;case 23:if(h=e.t1,!d||h){e.next=26;break}return e.abrupt("return");case 26:return e.next=28,Ce({layer:a,graphic:r,outFields:f,objectIds:u,returnGeometry:h,spatialReference:o},n);case 28:(v=e.sent)&&(v.geometry&&(r.geometry=v.geometry),v.attributes&&(r.attributes=(0,p.Z)((0,p.Z)({},r.attributes),v.attributes)));case 30:case"end":return e.stop()}}),e)}))),Se.apply(this,arguments)}function Re(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(re)}function Pe(e){var t=e.attributes,n=e.graphic,r=e.relatedInfo,i=e.fieldInfos,a=e.fieldInfoMap,o=e.layer;t&&n&&r&&Object.keys(n.attributes).forEach((function(e){var s=function(e){return e?"".concat(re).concat(e.layerId,"/").concat(e.fieldName):""}({layerId:r.relation.id.toString(),fieldName:e}),l=n.attributes[e];t[s]=xe({fieldName:s,fieldInfos:i,fieldInfoMap:a,layer:o,value:l,graphic:n})}))}var Oe=function(e){if(!e)return!1;var t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},Ne=function(e){var t,n,r=e.layer,i=e.method,a=e.query,o=e.definitionExpression;if(null!==(t=r.capabilities)&&void 0!==t&&null!==(n=t.query)&&void 0!==n&&n.supportsCacheHint&&"attachments"!==i){var s=(0,g.r)(a.where)&&a.where,l=(0,g.r)(a.geometry)&&a.geometry;Oe(o)||Oe(s)||"extent"===(null===l||void 0===l?void 0:l.type)||"tile"===a.resultType||(a.cacheHint=!0)}};function Ve(e,t,n){return e.find((function(e){return e!==t&&"feature"===e.type&&e.url===t.url&&e.layerId===n.relatedTableId}))}var qe={editing:!1,operations:{add:!0,update:!0,delete:!0}},je=F.j.ofType(x.a),De=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,l.Z)(this,n),(r=t.call(this,e))._getAttachmentsPromise=null,r._attachmentLayer=null,r.abilities=(0,p.Z)({},qe),r.activeAttachmentInfo=null,r.activeFileInfo=null,r.attachmentInfos=new je,r.fileInfos=new F.j,r.graphic=null,r.mode="view",r.filesEnabled=!1,r.addHandles((0,m.l)((function(){return r.graphic}),(function(){return r._graphicChanged()}),m.h)),r}return(0,u.Z)(n,[{key:"destroy",value:function(){this._attachmentLayer=null,this.graphic=null}},{key:"castAbilities",value:function(e){return(0,p.Z)((0,p.Z)({},qe),e)}},{key:"state",get:function(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}},{key:"supportsResizeAttachments",get:function(){var e=this.graphic;if(!e)return!1;var t=e.layer||e.sourceLayer;return(null===t||void 0===t?void 0:t.loaded)&&"capabilities"in t&&"operations"in t.capabilities&&"supportsResizeAttachments"in t.capabilities.operations&&t.capabilities.operations.supportsResizeAttachments||!1}},{key:"getAttachments",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(){var t,n,r,i,a,o,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._attachmentLayer,n=this.attachmentInfos,t&&"function"==typeof t.queryAttachments){e.next=3;break}throw new v.s("invalid-layer","getAttachments(): A valid layer is required.");case 3:return r=this._getObjectId(),i=new A.c({objectIds:[r],returnMetadata:!0}),a=[],o=t.queryAttachments(i).then((function(e){return e[r]||a})).catch((function(){return a})),this._getAttachmentsPromise=o,this.notifyChange("state"),e.next=7,o;case 7:return l=e.sent,e.abrupt("return",(n.removeAll(),l.length&&n.addMany(l),this._getAttachmentsPromise=null,this.notifyChange("state"),l));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addAttachment",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(t){var n,r,i,a,o,l,u=this,c=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:this.graphic,r=this._attachmentLayer,i=this.attachmentInfos,a=this.abilities,n){e.next=4;break}throw new v.s("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:n});case 4:if(t){e.next=6;break}throw new v.s("invalid-attachment","addAttachment(): An attachment is required.",{attachment:t});case 6:if(a.operations.add){e.next=8;break}throw new v.s("invalid-abilities","addAttachment(): add abilities are required.");case 8:if(r&&"function"==typeof r.addAttachment){e.next=10;break}throw new v.s("invalid-layer","addAttachment(): A valid layer is required.");case 10:return o=r.addAttachment(n,t).then((function(e){return u._queryAttachment(e.objectId,n)})),e.next=13,o;case 13:return l=e.sent,e.abrupt("return",(i.add(l),l));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteAttachment",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(t){var n,r,i,a,o,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._attachmentLayer,r=this.attachmentInfos,i=this.graphic,a=this.abilities,t){e.next=3;break}throw new v.s("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:t});case 3:if(a.operations.delete){e.next=5;break}throw new v.s("invalid-abilities","deleteAttachment(): delete abilities are required.");case 5:if(n&&"function"==typeof n.deleteAttachments){e.next=7;break}throw new v.s("invalid-layer","deleteAttachment(): A valid layer is required.");case 7:return o=n.deleteAttachments(i,[t.id]).then((function(){return t})),e.next=10,o;case 10:return l=e.sent,e.abrupt("return",(r.remove(l),l));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateAttachment",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(t){var n,r,i,a,o,l,u,c,d=this,f=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=f.length>1&&void 0!==f[1]?f[1]:this.activeAttachmentInfo,r=this._attachmentLayer,i=this.attachmentInfos,a=this.graphic,o=this.abilities,t){e.next=4;break}throw new v.s("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:t});case 4:if(n){e.next=6;break}throw new v.s("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:n});case 6:if(o.operations.update){e.next=8;break}throw new v.s("invalid-abilities","updateAttachment(): Update abilities are required.");case 8:if(l=i.findIndex((function(e){return e===n})),r&&"function"==typeof r.updateAttachment){e.next=11;break}throw new v.s("invalid-layer","updateAttachment(): A valid layer is required.");case 11:return u=r.updateAttachment(a,n.id,t).then((function(e){return d._queryAttachment(e.objectId)})),e.next=14,u;case 14:return c=e.sent,e.abrupt("return",(i.splice(l,1,c),c));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"commitFiles",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(){var t=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.fileInfos.items.map((function(e){return t.addAttachment(e.form)})));case 2:return this.fileInfos.removeAll(),e.abrupt("return",this.getAttachments());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addFile",value:function(e,t){if(!e||!t)return null;var n={file:e,form:t};return this.fileInfos.add(n),n}},{key:"updateFile",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.activeFileInfo;if(!e||!t||!n)return null;var r=this.fileInfos.findIndex((function(e){return n===e}));return r>-1&&this.fileInfos.splice(r,1,{file:e,form:t}),this.fileInfos.items[r]}},{key:"deleteFile",value:function(e){var t,n=this.fileInfos.find((function(t){return t.file===e}));return null!==(t=this.fileInfos.remove(n))&&void 0!==t?t:null}},{key:"_queryAttachment",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(t,n){var r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new v.s("invalid-attachment-id","Could not query attachment.");case 2:return r=this._attachmentLayer,i=this._getObjectId(n),a=new A.c({objectIds:[i],attachmentsWhere:"AttachmentId=".concat(t),returnMetadata:!0}),e.abrupt("return",r.queryAttachments(a).then((function(e){return e[i][0]})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getObjectId",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.graphic;return null!==(e=null===t||void 0===t?void 0:t.getObjectId())&&void 0!==e?e:null}},{key:"_graphicChanged",value:function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((function(){})))}},{key:"_setAttachmentLayer",value:function(){var e=ae(this.graphic);this._attachmentLayer=e?"scene"===e.type&&(0,g.r)(e.associatedLayer)?e.associatedLayer:e:null}}]),n}(v.m);(0,v.e)([(0,v.y)()],De.prototype,"abilities",void 0),(0,v.e)([(0,v.c)("abilities")],De.prototype,"castAbilities",null),(0,v.e)([(0,v.y)()],De.prototype,"activeAttachmentInfo",void 0),(0,v.e)([(0,v.y)()],De.prototype,"activeFileInfo",void 0),(0,v.e)([(0,v.y)({readOnly:!0,type:je})],De.prototype,"attachmentInfos",void 0),(0,v.e)([(0,v.y)()],De.prototype,"fileInfos",void 0),(0,v.e)([(0,v.y)({type:M.g})],De.prototype,"graphic",void 0),(0,v.e)([(0,v.y)()],De.prototype,"mode",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],De.prototype,"state",null),(0,v.e)([(0,v.y)()],De.prototype,"filesEnabled",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],De.prototype,"supportsResizeAttachments",null);var ze=De=(0,v.e)([(0,v.n)("esri.widgets.Attachments.AttachmentsViewModel")],De);function Ue(e){var t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t}var We={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Be="esri-attachments",He="esri-attachments__loader-container",Ge="esri-attachments__loader",Qe="esri-attachments__container",Ke="esri-attachments__container--list",$e="esri-attachments__container--preview",Ye="esri-attachments__actions",Xe="esri-attachments__delete-button",Je="esri-attachments__add-attachment-button",et="esri-attachments__error-message",tt="esri-attachments__items",nt="esri-attachments__item",rt="esri-attachments__item-button",it="esri-attachments__item-mask",at="esri-attachments__item-mask--icon",ot="esri-attachments__image",st="esri-attachments__image--resizable",lt="esri-attachments__label",ut="esri-attachments__filename",ct="esri-attachments__item-chevron-icon",dt="esri-attachments__item-link",ft="esri-attachments__item-link-overlay",pt="esri-attachments__item-link-overlay-icon",ht="esri-attachments__item-add-icon",vt="esri-attachments__form-node",yt="esri-attachments__file-fieldset",mt="esri-attachments__file-label",gt="esri-attachments__file-name",bt="esri-attachments__file-input",_t="esri-attachments__metadata",wt="esri-attachments__metadata-fieldset",kt="esri-attachments__progress-bar",It="esri-widget",Mt="esri-button",Ft="esri-button--disabled",xt="esri-button--secondary",At="esri-button--tertiary",Ct="esri-button--third",Zt="esri-button--small",Et="esri-button--half",Tt="esri-widget__content--empty",Lt="esri-icon-right",St="esri-icon-left",Rt="esri-icon-plus",Pt=window.CSS,Ot=function(e){(0,c.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,l.Z)(this,r),(i=t.call(this,e,n)).displayType="auto",i.messages=null,i.messagesUnits=null,i.selectedFile=null,i.submitting=!1,i.viewModel=new ze,i.visibleElements=(0,p.Z)({},We),i._supportsImageOrientation=Pt&&Pt.supports&&Pt.supports("image-orientation","from-image"),i._addAttachmentForm=null,i._updateAttachmentForm=null,i}return(0,u.Z)(r,[{key:"initialize",value:function(){var e=this;this.addHandles([(0,m.a)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.attachmentInfos}),"change",(function(){return e.scheduleRender()})),(0,m.a)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.fileInfos}),"change",(function(){return e.scheduleRender()})),(0,m.l)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.mode}),(function(){return e._modeChanged()}),m.h)])}},{key:"loadDependencies",value:function(){return Promise.all([n.e(1903).then(n.bind(n,1903))])}},{key:"abilities",get:function(){return this.viewModel.abilities},set:function(e){this.viewModel.abilities=e}},{key:"effectiveDisplayType",get:function(){var e=this.displayType;return e&&"auto"!==e?e:this.viewModel.supportsResizeAttachments?"preview":"list"}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(e){this.viewModel.graphic=e}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"castVisibleElements",value:function(e){return(0,p.Z)((0,p.Z)({},We),e)}},{key:"addAttachment",value:function(){var e=this,t=this._addAttachmentForm,n=this.viewModel;return this._set("submitting",!0),this._set("error",null),n.addAttachment(t).then((function(t){return e._set("submitting",!1),e._set("error",null),n.mode="view",t})).catch((function(t){throw e._set("submitting",!1),e._set("error",new v.s("attachments:add-attachment",e.messages.addErrorMessage,t)),t}))}},{key:"deleteAttachment",value:function(e){var t=this,n=this.viewModel;return this._set("submitting",!0),this._set("error",null),n.deleteAttachment(e).then((function(e){return t._set("submitting",!1),t._set("error",null),n.mode="view",e})).catch((function(e){throw t._set("submitting",!1),t._set("error",new v.s("attachments:delete-attachment",t.messages.deleteErrorMessage,e)),e}))}},{key:"updateAttachment",value:function(){var e=this,t=this.viewModel,n=this._updateAttachmentForm;return this._set("submitting",!0),this._set("error",null),t.updateAttachment(n).then((function(n){return e._set("submitting",!1),e._set("error",null),t.mode="view",n})).catch((function(t){throw e._set("submitting",!1),e._set("error",new v.s("attachments:update-attachment",e.messages.updateErrorMessage,t)),t}))}},{key:"addFile",value:function(){var e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}},{key:"updateFile",value:function(){var e=this.viewModel,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}},{key:"deleteFile",value:function(e){var t=this.viewModel.deleteFile(e||this.viewModel.activeFileInfo.file);return this.viewModel.mode="view",t}},{key:"render",value:function(){var e=this.submitting,t=this.viewModel.state;return(0,b.n)("div",{class:this.classes(Be,It)},e?this.renderProgressBar():null,"loading"===t?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}},{key:"renderErrorMessage",value:function(){var e=this.error,t=this.visibleElements;return e&&t.errorMessage?(0,b.n)("div",{key:"error-message",class:et},e.message):null}},{key:"renderAttachments",value:function(){var e=this.viewModel,t=e.activeFileInfo,n=e.mode,r=e.activeAttachmentInfo;return"add"===n?this.renderAddForm():"edit"===n?this.renderDetailsForm(r||t):this.renderAttachmentContainer()}},{key:"renderLoading",value:function(){return(0,b.n)("div",{class:He,key:"loader"},(0,b.n)("div",{class:Ge}))}},{key:"renderProgressBar",value:function(){return this.visibleElements.progressBar?(0,b.n)("div",{class:kt,key:"progress-bar"}):null}},{key:"renderAddForm",value:function(){var e=this.submitting,t=this.selectedFile,n=e||!t,r=this.visibleElements.cancelAddButton?(0,b.n)("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(Mt,At,Zt,Et,e&&Ft)},this.messages.cancel):null,i=this.visibleElements.addSubmitButton?(0,b.n)("button",{type:"submit",disabled:n,class:this.classes(Mt,xt,Zt,Et,(0,o.Z)({},Ft,n))},this.messages.add):null,a=t?(0,b.n)("span",{key:"file-name",class:gt},t.name):null,s=(0,b.n)("form",{bind:this,afterCreate:b.v,afterRemoved:b.h,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,b.n)("fieldset",{class:yt},a,(0,b.n)("label",{class:this.classes(mt,Mt,xt)},t?this.messages.changeFile:this.messages.selectFile,(0,b.n)("input",{class:bt,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),i,r);return(0,b.n)("div",{key:"add-form-container",class:vt},s)}},{key:"renderDetailsForm",value:function(e){var t,n,r,i,a=this,s=this.visibleElements,l=this.viewModel,u=this.selectedFile,c=this.submitting,d=l.abilities,f=c||!u;u?(t=u.type,n=u.name,r=u.size):"file"in e?(t=e.file.type,n=e.file.name,r=e.file.size):(t=e.contentType,n=e.name,r=e.size,i=e.url);var p=d.editing&&d.operations.delete&&s.deleteButton?(0,b.n)("button",{key:"delete-button",type:"button",disabled:c,bind:this,onclick:function(t){return a._submitDeleteAttachment(t,e)},class:this.classes(Mt,Zt,At,Xe,(0,o.Z)({},Ft,c))},this.messages.delete):void 0,h=d.editing&&d.operations.update&&s.updateButton?(0,b.n)("button",{disabled:f,key:"update-button",type:"submit",class:this.classes(Mt,Zt,Ct,(0,o.Z)({},Ft,f))},this.messages.update):void 0,y=this.visibleElements.cancelUpdateButton?(0,b.n)("button",{disabled:c,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(Mt,Zt,At,Ct,(0,o.Z)({},Ft,c))},this.messages.cancel):void 0,m=d.editing&&d.operations.update?(0,b.n)("fieldset",{key:"file",class:yt},(0,b.n)("span",{key:"file-name",class:gt},n),(0,b.n)("label",{class:this.classes(mt,Mt,xt)},this.messages.changeFile,(0,b.n)("input",{class:bt,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0,k=(0,b.n)("fieldset",{key:"size",class:wt},(0,b.n)("label",null,function(e,t){var n=0===t?0:Math.floor(Math.log(t)/Math.log(_.s.KILOBYTES));n=(0,w.a)(n,0,G.length-1);var r=(0,I.m)(t/Math.pow(_.s.KILOBYTES,n),{maximumFractionDigits:2});return(0,v.H)(e.units.bytes[G[n]],{fileSize:r})}(this.messagesUnits,r))),M=(0,b.n)("fieldset",{key:"content-type",class:wt},(0,b.n)("label",null,t)),F=(0,g.r)(i)?(0,b.n)("a",{class:dt,href:i,rel:"noreferrer",target:"_blank"},this.renderImageMask(e,400),(0,b.n)("div",{class:ft},(0,b.n)("span",{class:pt},(0,b.n)("calcite-icon",{icon:"launch"})))):this.renderImageMask(e,400),x=(0,b.n)("form",{bind:this,afterCreate:b.v,afterRemoved:b.h,"data-node-ref":"_updateAttachmentForm",onsubmit:function(t){return a._submitUpdateAttachment(t,e)}},(0,b.n)("div",{class:_t},k,M),m,(0,b.n)("div",{class:Ye},p,y,h));return(0,b.n)("div",{key:"edit-form-container",class:vt},F,x)}},{key:"renderImageMask",value:function(e,t){return"file"in e?this.renderGenericImageMask(e.file.name,e.file.type):this.renderImageMaskForAttachment(e,t)}},{key:"renderGenericImageMask",value:function(e,t){var n=this.viewModel.supportsResizeAttachments,r=function(e){var t=(0,E.a)("esri/themes/base/images/files/");return e?"text/plain"===e?"".concat(t,"text-32.svg"):"application/pdf"===e?"".concat(t,"pdf-32.svg"):"text/csv"===e?"".concat(t,"csv-32.svg"):"application/gpx+xml"===e?"".concat(t,"gpx-32.svg"):"application/x-dwf"===e?"".concat(t,"cad-32.svg"):"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?"".concat(t,"code-32.svg"):"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?"".concat(t,"zip-32.svg"):e.includes("image/")?"".concat(t,"image-32.svg"):e.includes("audio/")?"".concat(t,"sound-32.svg"):e.includes("video/")?"".concat(t,"video-32.svg"):e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?"".concat(t,"excel-32.svg"):e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?"".concat(t,"word-32.svg"):e.includes("powerpoint")||e.includes("presentationml")?"".concat(t,"report-32.svg"):"".concat(t,"generic-32.svg"):"".concat(t,"generic-32.svg")}(t),i=(0,o.Z)({},st,n);return(0,b.n)("div",{class:this.classes(at,it)},(0,b.n)("img",{title:e,alt:e,src:r,class:this.classes(i,ot)}))}},{key:"renderImageMaskForAttachment",value:function(e,t){var n=this.viewModel.supportsResizeAttachments,r=e.contentType,i=e.name,a=e.url;if(!n||!Ue(r))return this.renderGenericImageMask(i,r);var s=this._getCSSTransform(e),l=s?{transform:s,"image-orientation":"none"}:{},u="".concat(a).concat(a.includes("?")?"&":"?","w=").concat(t),c=(0,o.Z)({},st,n);return(0,b.n)("div",{class:this.classes(it)},(0,b.n)("img",{styles:l,alt:i,title:i,src:u,class:this.classes(c,ot)}))}},{key:"renderFile",value:function(e){var t=this,n=e.file;return(0,b.n)("li",{class:nt,key:n},(0,b.n)("button",{key:"details-button",bind:this,class:rt,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,onclick:function(){return t._startEditFile(e)},type:"button"},this.renderImageMask(e),(0,b.n)("label",{class:lt},(0,b.n)("span",{class:ut},n.name||this.messages.noTitle),(0,b.n)("span",{"aria-hidden":"true",class:this.classes(ct,(0,b.f)(this.container)?St:Lt)}))))}},{key:"renderAttachmentInfo",value:function(e){var t=this,n=e.attachmentInfo,r=e.displayType,i=this.viewModel,a=this.effectiveDisplayType,o=i.abilities,s=i.supportsResizeAttachments,l=n.contentType,u=n.name,c=n.url,d=this.renderImageMask(n,"list"===r?48:400),f=o.editing?(0,b.n)("span",{"aria-hidden":"true",class:this.classes(ct,(0,b.f)(this.container)?St:Lt)}):null,p=[d,"preview"===a&&s&&Ue(l)?null:(0,b.n)("label",{class:lt},(0,b.n)("span",{class:ut},u||this.messages.noTitle),f)],h=o.editing?(0,b.n)("button",{key:"details-button",bind:this,class:rt,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":n.id,onclick:function(){return t._startEditAttachment(n)},type:"button"},p):(0,b.n)("a",{key:"details-link",class:rt,href:c,target:"_blank"},p);return(0,b.n)("li",{class:nt,key:n},h)}},{key:"renderAttachmentContainer",value:function(){var e,t=this,n=this.effectiveDisplayType,r=this.viewModel,i=this.visibleElements,a=r.attachmentInfos,s=r.abilities,l=r.fileInfos,u=!(null===a||void 0===a||!a.length),c=!(null===l||void 0===l||!l.length),d=(e={},(0,o.Z)(e,Ke,"preview"!==n),(0,o.Z)(e,$e,"preview"===n),e),f=s.editing&&s.operations.add&&i.addButton?(0,b.n)("button",{bind:this,onclick:function(){return t._startAddAttachment()},class:this.classes(Mt,At,Je),type:"button"},(0,b.n)("span",{"aria-hidden":"true",class:this.classes(ht,Rt)}),this.messages.add):void 0,p=u?(0,b.n)("ul",{key:"attachments-list",class:tt},a.toArray().map((function(e){return t.renderAttachmentInfo({attachmentInfo:e,displayType:n})}))):void 0,h=c?(0,b.n)("ul",{key:"file-list",class:tt},l.toArray().map((function(e){return t.renderFile(e)}))):void 0,v=c||u?void 0:(0,b.n)("div",{class:Tt},this.messages.noAttachments);return(0,b.n)("div",{key:"attachments-container",class:this.classes(Qe,d)},p,h,v,f)}},{key:"_modeChanged",value:function(){this._set("error",null),this._set("selectedFile",null)}},{key:"_handleFileInputChange",value:function(e){var t=e.target,n=t&&t.files&&t.files.item(0);this._set("selectedFile",n)}},{key:"_submitDeleteAttachment",value:function(e,t){e.preventDefault(),"file"in t?this.deleteFile(t.file):this.deleteAttachment(t)}},{key:"_submitAddAttachment",value:function(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}},{key:"_submitUpdateAttachment",value:function(e,t){e.preventDefault(),"file"in t?this.updateFile():this.updateAttachment()}},{key:"_startEditAttachment",value:function(e){var t=this.viewModel;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}},{key:"_startEditFile",value:function(e){var t=this.viewModel;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}},{key:"_startAddAttachment",value:function(){this.viewModel.mode="add"}},{key:"_cancelForm",value:function(e){e.preventDefault(),this.viewModel.mode="view"}},{key:"_getCSSTransform",value:function(e){var t=e.orientationInfo;return!this._supportsImageOrientation&&t?[t.rotation?"rotate(".concat(t.rotation,"deg)"):"",t.mirrored?"scaleX(-1)":""].join(" "):""}}]),r}(b.M);(0,v.e)([(0,v.y)()],Ot.prototype,"abilities",null),(0,v.e)([(0,v.y)()],Ot.prototype,"displayType",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Ot.prototype,"effectiveDisplayType",null),(0,v.e)([(0,v.y)()],Ot.prototype,"graphic",null),(0,v.e)([(0,v.y)()],Ot.prototype,"label",null),(0,v.e)([(0,v.y)(),(0,b.e)("esri/widgets/Attachments/t9n/Attachments")],Ot.prototype,"messages",void 0),(0,v.e)([(0,v.y)(),(0,b.e)("esri/core/t9n/Units")],Ot.prototype,"messagesUnits",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Ot.prototype,"selectedFile",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Ot.prototype,"submitting",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Ot.prototype,"error",void 0),(0,v.e)([(0,v.y)({type:ze})],Ot.prototype,"viewModel",void 0),(0,v.e)([(0,v.y)()],Ot.prototype,"visibleElements",void 0),(0,v.e)([(0,v.c)("visibleElements")],Ot.prototype,"castVisibleElements",null);var Nt=Ot=(0,v.e)([(0,v.n)("esri.widgets.Attachments")],Ot),Vt=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,l.Z)(this,n),(r=t.call(this,e)).description=null,r.title=null,r}return(0,u.Z)(n)}(ze);(0,v.e)([(0,v.y)()],Vt.prototype,"description",void 0),(0,v.e)([(0,v.y)()],Vt.prototype,"title",void 0);var qt=Vt=(0,v.e)([(0,v.n)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],Vt),jt="esri-feature-element-info",Dt="esri-feature-element-info__title",zt="esri-feature-element-info__description",Ut=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,r){var i;return(0,l.Z)(this,n),(i=t.call(this,e,r)).description=null,i.headingLevel=2,i.title=null,i}return(0,u.Z)(n,[{key:"render",value:function(){return(0,b.n)("div",{class:jt},this.renderTitle(),this.renderDescription())}},{key:"renderTitle",value:function(){var e=this.title;return e?(0,b.n)(T.n,{level:this.headingLevel,class:Dt},e):null}},{key:"renderDescription",value:function(){var e=this.description;return e?(0,b.n)("div",{key:"description",class:zt},e):null}}]),n}(b.M);(0,v.e)([(0,v.y)()],Ut.prototype,"description",void 0),(0,v.e)([(0,v.y)()],Ut.prototype,"headingLevel",void 0),(0,v.e)([(0,v.y)()],Ut.prototype,"title",void 0);var Wt=Ut=(0,v.e)([(0,v.n)("esri.widgets.Feature.support.FeatureElementInfo")],Ut),Bt="esri-feature-attachments",Ht=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,r){var i;return(0,l.Z)(this,n),(i=t.call(this,e,r))._featureElementInfo=null,i.attachmentsWidget=new Nt,i.headingLevel=2,i.viewModel=new qt,i}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=this;this._featureElementInfo=new Wt,this.addHandles([(0,m.l)((function(){var t,n;return[null===(t=e.viewModel)||void 0===t?void 0:t.description,null===(n=e.viewModel)||void 0===n?void 0:n.title,e.headingLevel]}),(function(){return e._setupFeatureElementInfo()}),m.h),(0,m.l)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.graphic}),(function(t){return e.attachmentsWidget.graphic=t}),m.h)])}},{key:"destroy",value:function(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}},{key:"description",get:function(){return this.viewModel.description},set:function(e){this.viewModel.description=e}},{key:"displayType",get:function(){return this.attachmentsWidget.displayType},set:function(e){this.attachmentsWidget.displayType=e}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(e){this.viewModel.graphic=e}},{key:"title",get:function(){return this.viewModel.title},set:function(e){this.viewModel.title=e}},{key:"render",value:function(){var e,t=this.attachmentsWidget;return(0,b.n)("div",{class:Bt},null===(e=this._featureElementInfo)||void 0===e?void 0:e.render(),null===t||void 0===t?void 0:t.render())}},{key:"_setupFeatureElementInfo",value:function(){var e=this.description,t=this.title,n=this.headingLevel;this._featureElementInfo.set({description:e,title:t,headingLevel:n})}}]),n}(b.M);(0,v.e)([(0,v.y)({readOnly:!0})],Ht.prototype,"attachmentsWidget",void 0),(0,v.e)([(0,v.y)()],Ht.prototype,"description",null),(0,v.e)([(0,v.y)()],Ht.prototype,"displayType",null),(0,v.e)([(0,v.y)()],Ht.prototype,"graphic",null),(0,v.e)([(0,v.y)()],Ht.prototype,"headingLevel",void 0),(0,v.e)([(0,v.y)()],Ht.prototype,"title",null),(0,v.e)([(0,v.y)({type:qt})],Ht.prototype,"viewModel",void 0);var Gt=Ht=(0,v.e)([(0,v.n)("esri.widgets.Feature.FeatureAttachments")],Ht),Qt=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,l.Z)(this,n),(r=t.call(this,e))._loadingPromise=null,r.created=null,r.creator=null,r.destroyer=null,r.graphic=null,r.handles.add((0,m.l)((function(){return r.creator}),(function(e){r._destroyContent(),r._createContent(e)}),m.h)),r}return(0,u.Z)(n,[{key:"destroy",value:function(){this._destroyContent()}},{key:"state",get:function(){return this._loadingPromise?"loading":"ready"}},{key:"_destroyContent",value:function(){var e=this.created,t=this.graphic,n=this.destroyer;e&&(oe(n,{graphic:t}).catch((function(){return null})),this._set("created",null))}},{key:"_createContent",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(t){var n,r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.graphic,r=oe(t,{graphic:n}).catch((function(){return null})),this._loadingPromise=r,this.notifyChange("state"),e.next=4,r;case 4:i=e.sent,r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",i));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}((0,L.a)(v.m));(0,v.e)([(0,v.y)({readOnly:!0})],Qt.prototype,"created",void 0),(0,v.e)([(0,v.y)()],Qt.prototype,"creator",void 0),(0,v.e)([(0,v.y)()],Qt.prototype,"destroyer",void 0),(0,v.e)([(0,v.y)({type:M.g})],Qt.prototype,"graphic",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Qt.prototype,"state",null);var Kt=Qt=(0,v.e)([(0,v.n)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Qt),$t="esri-feature-content",Yt="esri-feature-content__loader-container",Xt="esri-feature-content__loader",Jt=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,r){var i;return(0,l.Z)(this,n),(i=t.call(this,e,r)).viewModel=null,i._addTargetToAnchors=function(e){Array.from(e.querySelectorAll("a")).forEach((function(e){le(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")}))},i}return(0,u.Z)(n,[{key:"creator",get:function(){return this.viewModel.creator},set:function(e){this.viewModel.creator=e}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(e){this.viewModel.graphic=e}},{key:"renderLoading",value:function(){return(0,b.n)("div",{class:Yt,key:"loader"},(0,b.n)("div",{class:Xt}))}},{key:"renderCreated",value:function(){var e,t=null===(e=this.viewModel)||void 0===e?void 0:e.created;return t?t instanceof HTMLElement?(0,b.n)("div",{key:t,bind:t,afterCreate:this._attachToNode}):(0,S.e)(t)?(0,b.n)("div",{key:t},!t.destroyed&&t.render()):(0,b.n)("div",{key:t,innerHTML:t,afterCreate:this._addTargetToAnchors}):null}},{key:"render",value:function(){var e,t=null===(e=this.viewModel)||void 0===e?void 0:e.state;return(0,b.n)("div",{class:$t},"loading"===t?this.renderLoading():this.renderCreated())}},{key:"_attachToNode",value:function(e){e.appendChild(this)}}]),n}(b.M);(0,v.e)([(0,v.y)()],Jt.prototype,"creator",null),(0,v.e)([(0,v.y)()],Jt.prototype,"graphic",null),(0,v.e)([(0,v.y)({type:Kt})],Jt.prototype,"viewModel",void 0);var en=Jt=(0,v.e)([(0,v.n)("esri.widgets.Feature.FeatureContent")],Jt),tn=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,l.Z)(this,n),(r=t.call(this,e)).attributes=null,r.expressionInfos=null,r.description=null,r.fieldInfos=null,r.title=null,r}return(0,u.Z)(n,[{key:"formattedFieldInfos",get:function(){var e=this.expressionInfos,t=this.fieldInfos,n=[];return null!==t&&void 0!==t&&t.forEach((function(t){if(!t.hasOwnProperty("visible")||t.visible){var r=t.clone();r.label=ce(r,e),n.push(r)}})),n}}]),n}(v.m);(0,v.e)([(0,v.y)()],tn.prototype,"attributes",void 0),(0,v.e)([(0,v.y)({type:[Z.d]})],tn.prototype,"expressionInfos",void 0),(0,v.e)([(0,v.y)()],tn.prototype,"description",void 0),(0,v.e)([(0,v.y)({type:[Z.a]})],tn.prototype,"fieldInfos",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],tn.prototype,"formattedFieldInfos",null),(0,v.e)([(0,v.y)()],tn.prototype,"title",void 0);var nn=tn=(0,v.e)([(0,v.n)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],tn),rn=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function an(e,t){if("string"!=typeof t||!t)return t;var n=function(e){var t=null;return rn.some((function(n){return n.pattern.test(e)&&(t=n),!!t})),t}(t);if(!n)return t;var r=t.match(n.pattern),i=r&&r[2],a=(0,v.H)((0,v.H)(n.label,{messages:e,hierPart:i}),{appName:n.appName}),o=n.target?' target="'.concat(n.target,'"'):"",s="_blank"===n.target?' rel="noreferrer"':"";return t.replace(n.pattern,"<a".concat(o,' href="$1"').concat(s,">").concat(a,"</a>"))}var on="esri-feature-fields",sn="esri-feature-fields__field-header",ln="esri-feature-fields__field-data",un="esri-feature-fields__field-data--date",cn="esri-widget__table",dn=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,r){var i;return(0,l.Z)(this,n),(i=t.call(this,e,r))._featureElementInfo=null,i.viewModel=new nn,i.messages=null,i.messagesURIUtils=null,i}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=this;this._featureElementInfo=new Wt,this.addHandles((0,m.l)((function(){var t,n;return[null===(t=e.viewModel)||void 0===t?void 0:t.description,null===(n=e.viewModel)||void 0===n?void 0:n.title]}),(function(){return e._setupFeatureElementInfo()}),m.h))}},{key:"destroy",value:function(){this._featureElementInfo.destroy()}},{key:"attributes",get:function(){return this.viewModel.attributes},set:function(e){this.viewModel.attributes=e}},{key:"description",get:function(){return this.viewModel.description},set:function(e){this.viewModel.description=e}},{key:"expressionInfos",get:function(){return this.viewModel.expressionInfos},set:function(e){this.viewModel.expressionInfos=e}},{key:"fieldInfos",get:function(){return this.viewModel.fieldInfos},set:function(e){this.viewModel.fieldInfos=e}},{key:"title",get:function(){return this.viewModel.title},set:function(e){this.viewModel.title=e}},{key:"renderFieldInfo",value:function(e,t){var n=this.viewModel.attributes,r=e.fieldName,i=e.label||r,a=n?null==n[r]?"":n[r]:"",s=!(!e.format||!e.format.dateFormat),l="number"!=typeof a||s?an(this.messagesURIUtils,a):this._forceLTR(a),u=(0,o.Z)({},un,s);return(0,b.n)("tr",{key:"fields-element-info-row-".concat(r,"-").concat(t)},(0,b.n)("th",{key:"fields-element-info-row-header-".concat(r,"-").concat(t),class:sn,innerHTML:i}),(0,b.n)("td",{key:"fields-element-info-row-data-".concat(r,"-").concat(t),class:this.classes(ln,u),innerHTML:l}))}},{key:"renderFields",value:function(){var e=this,t=this.viewModel.formattedFieldInfos;return null!==t&&void 0!==t&&t.length?(0,b.n)("table",{class:cn,summary:this.messages.fieldsSummary},(0,b.n)("tbody",null,t.map((function(t,n){return e.renderFieldInfo(t,n)})))):null}},{key:"render",value:function(){var e;return(0,b.n)("div",{class:on},null===(e=this._featureElementInfo)||void 0===e?void 0:e.render(),this.renderFields())}},{key:"_setupFeatureElementInfo",value:function(){var e=this.description,t=this.title;this._featureElementInfo.set({description:e,title:t})}},{key:"_forceLTR",value:function(e){return"&lrm;".concat(e)}}]),n}(b.M);(0,v.e)([(0,v.y)()],dn.prototype,"attributes",null),(0,v.e)([(0,v.y)()],dn.prototype,"description",null),(0,v.e)([(0,v.y)()],dn.prototype,"expressionInfos",null),(0,v.e)([(0,v.y)()],dn.prototype,"fieldInfos",null),(0,v.e)([(0,v.y)()],dn.prototype,"title",null),(0,v.e)([(0,v.y)({type:nn,nonNullable:!0})],dn.prototype,"viewModel",void 0),(0,v.e)([(0,v.y)(),(0,b.e)("esri/widgets/Feature/t9n/Feature")],dn.prototype,"messages",void 0),(0,v.e)([(0,v.y)(),(0,b.e)("esri/widgets/support/t9n/uriUtils")],dn.prototype,"messagesURIUtils",void 0);var fn=dn=(0,v.e)([(0,v.n)("esri.widgets.Feature.FeatureFields")],dn),pn=v.a.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),hn=new Map;function vn(e){if(!Re(e))return null;var t=e.split("/").slice(1),n=(0,a.Z)(t,2);return{layerId:n[0],fieldName:n[1]}}function yn(e){var t,n=e.originRelationship,r=e.relationships,i=e.layerId;return r&&r.some((function(e){return"".concat(e.relatedTableId)===i&&e.id===n.id&&(t=e),!!t})),t}function mn(e,t){var n=t.toLowerCase();for(var r in e)if(r.toLowerCase()===n)return e[r];return null}function gn(e,t){var n=function(e,t){if(!t.relationships)return null;var n=null;return t.relationships.some((function(t){return t.id===parseInt(e,10)&&(n=t,!0)})),n}(e,t);if(n)return{url:"".concat(t.url,"/").concat(n.relatedTableId),sourceSpatialReference:t.spatialReference,relation:n,relatedFields:[],outStatistics:[]}}function bn(e,t){if(t&&e){var n=e.features,r=e.statsFeatures,i=n&&n.value;t.relatedFeatures=i?i.features:[];var a=r&&r.value;t.relatedStatsFeatures=a?a.features:[]}}function _n(e,t,n,r){var i=new A.d;return i.outFields=["*"],i.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),i.objectIds=[e.attributes[n.objectIdField]],n.queryRelatedFeatures(i,r)}function wn(e,t,n){for(var r=0,i=[];r<t.length;)i.push("".concat(e," IN (").concat(t.slice(r,n+r),")")),r+=n;return i.join(" OR ")}function kn(){return kn=(0,h.Z)((0,s.Z)().mark((function e(t,n,r,i){var a,o,l,u,c,d,f,p,h,y,m,g,b,_,w,k,I,M,F;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.layerId.toString(),o=n.layerInfo,l=n.relation,u=n.relatedFields,c=n.outStatistics,d=n.url,f=n.sourceSpatialReference,!(p=yn({originRelationship:l,relationships:o.relationships,layerId:a})).relationshipTableId||!p.keyFieldInRelationshipTable){e.next=14;break}return e.next=4,_n(t,p,r,i);case 4:if(e.t0=t.attributes[r.objectIdField],h=e.sent[e.t0]){e.next=8;break}return e.abrupt("return",null);case 8:if(y=h.features.map((function(e){return e.attributes[o.objectIdField]})),!((null===c||void 0===c?void 0:c.length)>0&&o.supportsStatistics)){e.next=14;break}return(m=new P.x).where=wn(o.objectIdField,y,1e3),m.outFields=u,m.outStatistics=c,m.sourceSpatialReference=f,g={features:Promise.resolve(h),statsFeatures:(0,x.s)(d,m)},e.abrupt("return",(0,v.E)(g));case 14:if(!(b=null===p||void 0===p?void 0:p.keyField)){e.next=18;break}return _=(0,C.b)(Fn(o.fields,b)),w=mn(t.attributes,l.keyField),k=_?"".concat(b,"=").concat(w):"".concat(b,"='").concat(w,"'"),I=(0,x.s)(d,new P.x({where:k,outFields:n.relatedFields,sourceSpatialReference:f}),i),M=n.outStatistics&&n.outStatistics.length>0&&o.supportsStatistics?(0,x.s)(d,new P.x({where:k,outFields:n.relatedFields,outStatistics:n.outStatistics,sourceSpatialReference:f}),i):null,F={features:I},e.abrupt("return",(M&&(F.statsFeatures=M),(0,v.E)(F)));case 18:return e.abrupt("return",null);case 19:case"end":return e.stop()}}),e)}))),kn.apply(this,arguments)}function In(e,t){var n=e.relatedInfos,r=e.layer,i={};return n.forEach((function(e,n){var a=e.relation;if(!a){var o=new v.s("relation-required","A relation is required on a layer to retrieve related records.");throw pn.error(o),o}var s=a.relatedTableId;if("number"!=typeof s){var l=new v.s("A related table ID is required on a layer to retrieve related records.");throw pn.error(l),l}var u="".concat(r.url,"/").concat(s),c=hn.get(u),d=c||function(e,t){return(0,R.U)(e,{query:{f:"json"},signal:t&&t.signal})}(u,t);c||hn.set(u,d),i[n]=d})),(0,v.E)(i)}function Mn(e,t){var n=e.graphic,r=e.relatedInfos,i=e.layer,a={};return r.forEach((function(e,r){e.layerInfo&&(a[r]=function(e,t,n,r){return kn.apply(this,arguments)}(n,e,i,t))})),(0,v.E)(a)}function Fn(e,t){if(null!=e){t=t.toLowerCase();var n,r=(0,i.Z)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a&&a.name.toLowerCase()===t)return a}}catch(o){r.e(o)}finally{r.f()}}return null}var xn={chartAnimation:!0},An=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,l.Z)(this,n),(r=t.call(this,e)).abilities=(0,p.Z)({},xn),r.activeMediaInfoIndex=0,r.attributes=null,r.description=null,r.fieldInfoMap=null,r.formattedAttributes=null,r.expressionAttributes=null,r.layer=null,r.mediaInfos=null,r.popupTemplate=null,r.relatedInfos=null,r.title=null,r}return(0,u.Z)(n,[{key:"castAbilities",value:function(e){return(0,p.Z)((0,p.Z)({},xn),e)}},{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}},{key:"setActiveMedia",value:function(e){this._setContentElementMedia(e)}},{key:"next",value:function(){this._pageContentElementMedia(1)}},{key:"previous",value:function(){this._pageContentElementMedia(-1)}},{key:"_setContentElementMedia",value:function(e){var t=this.formattedMediaInfoCount,n=(e+t)%t;this.activeMediaInfoIndex=n}},{key:"_pageContentElementMedia",value:function(e){var t=this.activeMediaInfoIndex+e;this._setContentElementMedia(t)}},{key:"_formatMediaInfos",value:function(){var e=this,t=this.attributes,n=this.mediaInfos,r=this.formattedAttributes,i=this.expressionAttributes,a=this.fieldInfoMap,o=this.layer;return null===n||void 0===n?void 0:n.map((function(n){var s=null===n||void 0===n?void 0:n.clone();if(!s)return null;if(s.title=he({attributes:t,fieldInfoMap:a,globalAttributes:r,expressionAttributes:i,layer:o,text:s.title}),s.caption=he({attributes:t,fieldInfoMap:a,globalAttributes:r,expressionAttributes:i,layer:o,text:s.caption}),s.altText=he({attributes:t,fieldInfoMap:a,globalAttributes:r,expressionAttributes:i,layer:o,text:s.altText}),"image"===s.type){var l=s.value;return e._setImageValue({value:l,formattedAttributes:r,layer:o}),s.value.sourceURL?s:void 0}if("pie-chart"===s.type||"line-chart"===s.type||"column-chart"===s.type||"bar-chart"===s.type){var u=s.value;return e._setChartValue({value:u,chartType:s.type,attributes:t,formattedAttributes:r,layer:o,expressionAttributes:i}),s}return null})).filter(Boolean)}},{key:"_setImageValue",value:function(e){var t=this.fieldInfoMap,n=e.value,r=e.formattedAttributes,i=e.layer,a=n.linkURL,o=n.sourceURL;if(o){var s=ge(o,i);n.sourceURL=ve({formattedAttributes:r,template:s,fieldInfoMap:t})}if(a){var l=ge(a,i);n.linkURL=ve({formattedAttributes:r,template:l,fieldInfoMap:t})}}},{key:"_setChartValue",value:function(e){var t=this,n=e.value,r=e.attributes,i=e.formattedAttributes,a=e.chartType,o=e.layer,s=e.expressionAttributes,l=this.popupTemplate,u=this.relatedInfos,c=n.fields,d=n.normalizeField;if(n.fields=function(e,t){return e&&e.map((function(e){return de(e,t)}))}(c,o),d&&(n.normalizeField=de(d,o)),c.some((function(e){return!!(null!=i[e]||Re(e)&&u.size)}))){var p=null===l||void 0===l?void 0:l.fieldInfos;c.forEach((function(e){if(Re(e))n.series=[].concat((0,f.Z)(n.series),(0,f.Z)(t._getRelatedChartInfos({fieldInfos:p,fieldName:e,formattedAttributes:i,chartType:a,value:n})));else{var o=t._getChartOption({value:n,attributes:r,chartType:a,formattedAttributes:i,expressionAttributes:s,fieldName:e,fieldInfos:p});n.series.push(o)}}))}}},{key:"_getRelatedChartInfos",value:function(e){var t,n=this,r=e.fieldInfos,i=e.fieldName,a=e.formattedAttributes,o=e.chartType,s=e.value,l=[],u=vn(i),c=u.layerId,d=u.fieldName,f=null===(t=this.relatedInfos)||void 0===t?void 0:t.get(c.toString());if(!f)return l;var p=f.relatedFeatures,h=f.relation;if(!h||!p)return l;var v=h.cardinality;return p.forEach((function(e){var t=e.attributes;t&&Object.keys(t).forEach((function(e){e===d&&l.push(n._getChartOption({value:s,attributes:t,formattedAttributes:a,fieldName:i,chartType:o,relatedFieldName:e,fieldInfos:r}))}))})),"one-to-many"===v||"many-to-many"===v?l:[l[0]]}},{key:"_getTooltip",value:function(e){var t=e.label,n=e.value;return"pie-chart"===e.chartType?"".concat(t):"".concat(t,": ").concat(n)}},{key:"_getChartOption",value:function(e){var t,n=e.value,r=e.attributes,i=e.formattedAttributes,a=e.expressionAttributes,o=e.fieldName,s=e.relatedFieldName,l=e.fieldInfos,u=e.chartType,c=this.layer,d=this.fieldInfoMap,f=n.normalizeField,p=n.tooltipField,h=f?Re(f)?r[vn(f).fieldName]:r[f]:null,v=ue(o)&&a&&void 0!==a[o]?a[o]:s&&void 0!==r[s]?r[s]:void 0!==r[o]?r[o]:i[o],y=new Z.e({fieldName:o,value:void 0===v?null:v&&h?v/h:v});if(Re(o)){var m,g,b,_,w,k=d.get(o.toLowerCase()),I=d.get(p.toLowerCase()),M=null!==(m=null===k||void 0===k?void 0:k.fieldName)&&void 0!==m?m:o,F=null!==(g=null!==(b=null!==(_=i[null!==(w=null===I||void 0===I?void 0:I.fieldName)&&void 0!==w?w:p])&&void 0!==_?_:null===k||void 0===k?void 0:k.label)&&void 0!==b?b:null===k||void 0===k?void 0:k.fieldName)&&void 0!==g?g:s,x=i[M];return y.tooltip=this._getTooltip({label:F,value:x,chartType:u}),y}var A=ke(l,o),C=de(o,c),E=p&&void 0!==i[p]?i[p]:ce(A||new Z.a({fieldName:C}),null===(t=this.popupTemplate)||void 0===t?void 0:t.expressionInfos),T=i[C];return y.tooltip=this._getTooltip({label:E,value:T,chartType:u}),y}}]),n}(v.m);(0,v.e)([(0,v.y)()],An.prototype,"abilities",void 0),(0,v.e)([(0,v.c)("abilities")],An.prototype,"castAbilities",null),(0,v.e)([(0,v.y)()],An.prototype,"activeMediaInfoIndex",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],An.prototype,"activeMediaInfo",null),(0,v.e)([(0,v.y)()],An.prototype,"attributes",void 0),(0,v.e)([(0,v.y)()],An.prototype,"description",void 0),(0,v.e)([(0,v.y)()],An.prototype,"fieldInfoMap",void 0),(0,v.e)([(0,v.y)()],An.prototype,"formattedAttributes",void 0),(0,v.e)([(0,v.y)()],An.prototype,"expressionAttributes",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],An.prototype,"formattedMediaInfos",null),(0,v.e)([(0,v.y)()],An.prototype,"layer",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],An.prototype,"formattedMediaInfoCount",null),(0,v.e)([(0,v.y)()],An.prototype,"mediaInfos",void 0),(0,v.e)([(0,v.y)()],An.prototype,"popupTemplate",void 0),(0,v.e)([(0,v.y)()],An.prototype,"relatedInfos",void 0),(0,v.e)([(0,v.y)()],An.prototype,"title",void 0);var Cn,Zn,En=An=(0,v.e)([(0,v.n)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],An),Tn=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Ln=[{name:"default",colors:[].concat(Tn.slice(30,39),Tn.slice(28,30).reverse())},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}],Sn="en-us",Rn=new Map([["ar",function(){return n.e(5839).then(n.bind(n,45839)).then((function(e){return e.a}))}],["bg-bg",function(){return n.e(1).then(n.bind(n,50001)).then((function(e){return e.b}))}],["bs-ba",function(){return n.e(7570).then(n.bind(n,97570)).then((function(e){return e.b}))}],["ca-es",function(){return n.e(8216).then(n.bind(n,88216)).then((function(e){return e.c}))}],["cs-cz",function(){return n.e(8621).then(n.bind(n,38621)).then((function(e){return e.c}))}],["da-dk",function(){return n.e(9466).then(n.bind(n,69466)).then((function(e){return e.d}))}],["de-de",function(){return n.e(8945).then(n.bind(n,68945)).then((function(e){return e.d}))}],["de-ch",function(){return n.e(3685).then(n.bind(n,3685)).then((function(e){return e.d}))}],["el-gr",function(){return n.e(8600).then(n.bind(n,8600)).then((function(e){return e.e}))}],["en-us",function(){return n.e(210).then(n.bind(n,20210)).then((function(e){return e.e}))}],["en-ca",function(){return n.e(9574).then(n.bind(n,49574)).then((function(e){return e.e}))}],["es-es",function(){return n.e(9303).then(n.bind(n,49303)).then((function(e){return e.e}))}],["et-ee",function(){return n.e(5535).then(n.bind(n,95535)).then((function(e){return e.e}))}],["fi-fi",function(){return n.e(7057).then(n.bind(n,27057)).then((function(e){return e.f}))}],["fr-fr",function(){return n.e(1307).then(n.bind(n,61307)).then((function(e){return e.f}))}],["he-il",function(){return n.e(8693).then(n.bind(n,98693)).then((function(e){return e.h}))}],["hr-hr",function(){return n.e(877).then(n.bind(n,877)).then((function(e){return e.h}))}],["hu-hu",function(){return n.e(8126).then(n.bind(n,48126)).then((function(e){return e.h}))}],["id-id",function(){return n.e(613).then(n.bind(n,30613)).then((function(e){return e.i}))}],["it-it",function(){return n.e(6604).then(n.bind(n,86604)).then((function(e){return e.i}))}],["ja-jp",function(){return n.e(5740).then(n.bind(n,75740)).then((function(e){return e.j}))}],["ko-kr",function(){return n.e(1933).then(n.bind(n,21933)).then((function(e){return e.k}))}],["lt-lt",function(){return n.e(4191).then(n.bind(n,74191)).then((function(e){return e.l}))}],["lv-lv",function(){return n.e(7756).then(n.bind(n,17756)).then((function(e){return e.l}))}],["nb-no",function(){return n.e(745).then(n.bind(n,24743)).then((function(e){return e.n}))}],["nl-nl",function(){return n.e(808).then(n.bind(n,40808)).then((function(e){return e.n}))}],["pl-pl",function(){return n.e(1321).then(n.bind(n,81321)).then((function(e){return e.p}))}],["pt-br",function(){return n.e(2716).then(n.bind(n,12716)).then((function(e){return e.p}))}],["pt-pt",function(){return n.e(1918).then(n.bind(n,61918)).then((function(e){return e.p}))}],["ro-ro",function(){return n.e(3946).then(n.bind(n,23946)).then((function(e){return e.r}))}],["ru-ru",function(){return n.e(1938).then(n.bind(n,81938)).then((function(e){return e.r}))}],["sk-sk",function(){return n.e(3842).then(n.bind(n,73842)).then((function(e){return e.s}))}],["sl-sl",function(){return n.e(6346).then(n.bind(n,66346)).then((function(e){return e.s}))}],["sr-rs",function(){return n.e(8795).then(n.bind(n,88795)).then((function(e){return e.s}))}],["sv-se",function(){return n.e(9595).then(n.bind(n,69595)).then((function(e){return e.s}))}],["th-th",function(){return n.e(2118).then(n.bind(n,52118)).then((function(e){return e.t}))}],["tr-tr",function(){return n.e(4269).then(n.bind(n,34269)).then((function(e){return e.t}))}],["uk-ua",function(){return n.e(8189).then(n.bind(n,38189)).then((function(e){return e.u}))}],["vi-vn",function(){return n.e(2965).then(n.bind(n,72965)).then((function(e){return e.v}))}],["zh-cn",function(){return n.e(164).then(n.bind(n,80164)).then((function(e){return e.z}))}],["zh-hk",function(){return n.e(3502).then(n.bind(n,73502)).then((function(e){return e.z}))}],["zh-tw",function(){return n.e(3502).then(n.bind(n,73502)).then((function(e){return e.z}))}]]);function Pn(e){return e?Rn.has(e.toLowerCase())?e.toLowerCase():function(e){var t,n=e.split("-")[0].toLowerCase(),r=null,a=(0,i.Z)(Rn.keys());try{for(a.s();!(t=a.n()).done;){var o=t.value;if(o.startsWith(n)){r=o;break}}}catch(s){a.e(s)}finally{a.f()}return r}(e)||Sn:Sn}function On(){return Nn.apply(this,arguments)}function Nn(){return Nn=(0,h.Z)((0,s.Z)().mark((function e(){var t,r,i,o,l,u=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Pn(t=u.length>0&&void 0!==u[0]?u[0]:(0,O.l)()),!Cn||t!==Zn){e.next=3;break}return e.abrupt("return",Cn);case 3:return Cn=n.e(8413).then(n.bind(n,98413)).then((function(e){return e.i})),Zn=t,e.prev=4,e.next=7,Promise.all([Cn,Rn.get(Zn)()]);case 7:r=e.sent,i=(0,a.Z)(r,2),o=i[0],l=i[1],Zn===t&&(o.am4core.options.defaultLocale=l.default),o.am4core.options.suppressWarnings=!0,o.am4core.options.autoDispose=!0,e.next=17;break;case 14:return e.prev=14,e.t0=e.catch(4),e.abrupt("return",(Cn=null,Zn=null,null));case 17:return e.abrupt("return",Cn);case 18:case"end":return e.stop()}}),e,null,[[4,14]])}))),Nn.apply(this,arguments)}var Vn="esri-feature-media",qn="esri-feature-media__container",jn="esri-feature-media__item-container",Dn="esri-feature-media__item",zn="esri-feature-media__item-title",Un="esri-feature-media__item-caption",Wn="esri-feature-media__previous",Bn="esri-feature-media__previous-icon",Hn="esri-feature-media__previous-icon--rtl",Gn="esri-feature-media__next",Qn="esri-feature-media__next-icon",Kn="esri-feature-media__next-icon--rtl",$n="esri-feature-media__chart",Yn="esri-feature-media__button",Xn="esri-feature-media__icon",Jn="esri-icon-left-triangle-arrow",er="esri-icon-right-triangle-arrow",tr=.05,nr=.95,rr="color",ir="tooltip",ar="value",or="default-line-value",sr=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,i){var a;return(0,l.Z)(this,n),(a=t.call(this,e,i))._refreshTimer=null,a._refreshIntervalInfo=null,a._featureElementInfo=null,a.viewModel=new En,a.messages=null,a._getChartDependencies=function(){var e=(0,h.Z)((0,s.Z)().mark((function e(t){var n,i,o,l,u,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,On();case 2:if(n=e.sent,i=(0,r.Z)(a),o=i.destroyed,l=i.viewModel,!o&&l&&t){e.next=8;break}return e.abrupt("return");case 8:return u=l.activeMediaInfo,e.next=11,a._getRendererColors(n);case 11:c=e.sent,a._renderChart({chartDiv:t,mediaInfo:u,chartsModule:n,colorMap:c});case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=this;this._featureElementInfo=new Wt,this.addHandles([(0,m.l)((function(){var t,n;return[null===(t=e.viewModel)||void 0===t?void 0:t.activeMediaInfo,null===(n=e.viewModel)||void 0===n?void 0:n.activeMediaInfoIndex]}),(function(){return e._setupMediaRefreshTimer()}),m.h),(0,m.l)((function(){var t,n;return[null===(t=e.viewModel)||void 0===t?void 0:t.description,null===(n=e.viewModel)||void 0===n?void 0:n.title]}),(function(){return e._setupFeatureElementInfo()}),m.h)])}},{key:"destroy",value:function(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}},{key:"attributes",get:function(){return this.viewModel.attributes},set:function(e){this.viewModel.attributes=e}},{key:"activeMediaInfoIndex",get:function(){return this.viewModel.activeMediaInfoIndex},set:function(e){this.viewModel.activeMediaInfoIndex=e}},{key:"description",get:function(){return this.viewModel.description},set:function(e){this.viewModel.description=e}},{key:"fieldInfoMap",get:function(){return this.viewModel.fieldInfoMap},set:function(e){this.viewModel.fieldInfoMap=e}},{key:"layer",get:function(){return this.viewModel.layer},set:function(e){this.viewModel.layer=e}},{key:"mediaInfos",get:function(){return this.viewModel.mediaInfos},set:function(e){this.viewModel.mediaInfos=e}},{key:"popupTemplate",get:function(){return this.viewModel.popupTemplate},set:function(e){this.viewModel.popupTemplate=e}},{key:"relatedInfos",get:function(){return this.viewModel.relatedInfos},set:function(e){this.viewModel.relatedInfos=e}},{key:"title",get:function(){return this.viewModel.title},set:function(e){this.viewModel.title=e}},{key:"render",value:function(){var e;return(0,b.n)("div",{bind:this,class:Vn,onkeyup:this._handleMediaKeyup},null===(e=this._featureElementInfo)||void 0===e?void 0:e.render(),this.renderMedia())}},{key:"renderMedia",value:function(){return this.viewModel.formattedMediaInfoCount?(0,b.n)("div",{key:"media-element-container",class:qn},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}},{key:"renderImageMediaInfo",value:function(e){var t=this._refreshIntervalInfo,n=this.viewModel,r=n.activeMediaInfoIndex,i=n.formattedMediaInfoCount,a=e.value,o=e.refreshInterval,s=e.altText,l=e.title,u=e.type,c=a.sourceURL,d=a.linkURL,f=le(d)?"_blank":"_self",p="_blank"===f?"noreferrer":"",h=o?t:null,v=h?h.timestamp:0,y=h?h.sourceURL:c,m=(0,b.n)("img",{alt:s||l,key:"media-".concat(u,"-").concat(r,"-").concat(i,"-").concat(v),src:y});return(d?(0,b.n)("a",{title:l,href:d,rel:p,target:f},m):null)||m}},{key:"renderChartMediaInfo",value:function(e){var t=this.viewModel,n=t.activeMediaInfoIndex,r=t.formattedMediaInfoCount;return(0,b.n)("div",{key:"media-".concat(e.type,"-").concat(n,"-").concat(r),bind:this,class:$n,afterCreate:this._getChartDependencies})}},{key:"renderMediaInfoType",value:function(){var e=this.viewModel.activeMediaInfo;return e?"image"===e.type?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}},{key:"renderMediaInfo",value:function(){var e=this.viewModel.activeMediaInfo;if(!e)return null;var t=e.title?(0,b.n)("div",{key:"media-title",class:zn,innerHTML:e.title}):null,n=e.caption?(0,b.n)("div",{key:"media-caption",class:Un,innerHTML:e.caption}):null;return(0,b.n)("div",{key:"media-container",class:jn},(0,b.n)("div",{key:"media-item-container",class:Dn},this.renderMediaInfoType()),t,n)}},{key:"renderMediaPageButton",value:function(e){if(this.viewModel.formattedMediaInfoCount<2)return null;var t="previous"===e,n=t?this.messages.previous:this.messages.next,r=t?this.classes(Yn,Wn):this.classes(Yn,Gn),i=t?this.classes(Xn,Bn,Jn):this.classes(Xn,Qn,er),a=t?this.classes(Xn,Hn,er):this.classes(Xn,Kn,Jn),o=t?"media-previous":"media-next",s=t?this._previous:this._next;return(0,b.n)("button",{type:"button",key:o,title:n,"aria-label":n,tabIndex:0,class:r,bind:this,onclick:s},(0,b.n)("span",{"aria-hidden":"true",class:i}),(0,b.n)("span",{"aria-hidden":"true",class:a}))}},{key:"_setupFeatureElementInfo",value:function(){var e=this.description,t=this.title;this._featureElementInfo.set({description:e,title:t})}},{key:"_next",value:function(){this.viewModel.next()}},{key:"_previous",value:function(){this.viewModel.previous()}},{key:"_getRendererColors",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(t){var n,r,i,a,o,l,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.am4core,a=new Map,o=null===(n=this.viewModel)||void 0===n||null===(r=n.layer)||void 0===r?void 0:r.renderer,l="default",o){e.next=3;break}return e.abrupt("return",a);case 3:return e.next=5,(0,T.b)(o);case 5:return(u=e.sent).delete(l),e.abrupt("return",Array.from(u.values()).every((function(e){return 1===(null===e||void 0===e?void 0:e.length)}))?(a.set(or,i.color({r:50,g:50,b:50,a:1})),Array.from(u.keys()).forEach((function(e){e&&a.set(e,i.color(u.get(e)[0].toCss(!0)))})),a):a);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_handleMediaKeyup",value:function(e){var t=(0,v.af)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}},{key:"_renderChart",value:function(e){var t=this.viewModel.abilities,n=e.chartsModule,r=e.chartDiv,i=e.mediaInfo,a=e.colorMap,s=i.value,l=i.type,u=n.am4core,c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",n=Ln.find((function(e){return e.name===t}));return n?n.colors.map((function(t){return e.color(t)})):null}(u);(0,T.r)()&&u.useTheme(n.am4themes_dark);var d=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!d.matches?u.useTheme(n.am4themes_animated):u.unuseTheme(n.am4themes_animated),u.useTheme((function(e){e instanceof u.ColorSet&&c&&(e.list=c)}));var f="pie-chart"===l?this._createPieChart(e):this._createXYChart(e);r.setAttribute("aria-label",i.altText||i.title),f.data=s.series.map((function(e){var t;return t={},(0,o.Z)(t,ir,e.tooltip),(0,o.Z)(t,ar,e.value),(0,o.Z)(t,rr,a.get(e.fieldName)),t})).filter((function(e){return"pie-chart"!==l||e.value>0}))}},{key:"_customizeChartTooltip",value:function(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}},{key:"_createPieChart",value:function(e){var t=e.chartDiv,n=e.chartsModule,r=n.am4core,i=n.am4charts,a=r.create(t,i.PieChart);a.rtl=(0,b.f)(this.container);var o=a.series.push(new i.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value=ar,o.dataFields.category=ir,this._customizeChartTooltip(o.tooltip,r),o.slices.template.propertyFields.fill=rr,o.slices.template.propertyFields.stroke=rr,a}},{key:"_getMinSeriesValue",value:function(e){var t=0;return e.forEach((function(e){return t=Math.min(e.value,t)})),t}},{key:"_createColumnChart",value:function(e,t){var n=t.chartsModule,r=t.mediaInfo.value,i=n.am4core,a=n.am4charts,o=e.xAxes.push(new a.CategoryAxis);o.dataFields.category=ir,o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,i),o.tooltip.events.on("sizechanged",(function(){o.tooltip.dy=-o.tooltip.contentHeight}));var s=e.yAxes.push(new a.ValueAxis),l=s.renderer.labels.template;s.renderer.minLabelPosition=tr,s.renderer.maxLabelPosition=nr,s.min=this._getMinSeriesValue(r.series),this._customizeChartTooltip(s.tooltip,i),l.wrap=!0;var u=e.series.push(new a.ColumnSeries);u.dataFields.valueY=ar,u.dataFields.categoryX=ir,u.columns.template.propertyFields.fill=rr,u.columns.template.propertyFields.stroke=rr,e.cursor=new a.XYCursor,r.series.length>15&&(e.scrollbarX=new i.Scrollbar)}},{key:"_createBarChart",value:function(e,t){var n=t.chartsModule,r=t.mediaInfo.value,i=n.am4core,a=n.am4charts,o=e.yAxes.push(new a.CategoryAxis);o.dataFields.category=ir,o.renderer.inversed=!0,o.renderer.labels.template.disabled=!0,this._customizeChartTooltip(o.tooltip,i),o.tooltip.events.on("sizechanged",(function(){o.tooltip.dx=o.tooltip.contentWidth}));var s=e.xAxes.push(new a.ValueAxis),l=s.renderer.labels.template;s.renderer.minLabelPosition=tr,s.renderer.maxLabelPosition=nr,s.min=this._getMinSeriesValue(r.series),this._customizeChartTooltip(s.tooltip,i),l.wrap=!0;var u=e.series.push(new a.ColumnSeries);u.dataFields.valueX=ar,u.dataFields.categoryY=ir,u.columns.template.propertyFields.fill=rr,u.columns.template.propertyFields.stroke=rr,e.cursor=new a.XYCursor,r.series.length>15&&(e.scrollbarY=new i.Scrollbar)}},{key:"_createLineChart",value:function(e,t){var n=t.chartsModule,r=t.mediaInfo,i=t.colorMap,a=r.value,o=n.am4core,s=n.am4charts,l=e.xAxes.push(new s.CategoryAxis);l.dataFields.category=ir,l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,o),l.tooltip.events.on("sizechanged",(function(){l.tooltip.dy=-l.tooltip.contentHeight}));var u=e.yAxes.push(new s.ValueAxis),c=u.renderer.labels.template;u.renderer.minLabelPosition=tr,u.renderer.maxLabelPosition=nr,u.min=this._getMinSeriesValue(a.series),this._customizeChartTooltip(u.tooltip,o),c.wrap=!0;var d=e.series.push(new s.LineSeries);d.dataFields.categoryX=ir,d.dataFields.valueY=ar,d.strokeWidth=1;var f=i.get(or);f&&(d.stroke=f);var p=d.bullets.push(new s.CircleBullet);p.propertyFields.fill=rr,p.propertyFields.stroke=rr,e.cursor=new s.XYCursor,a.series.length>15&&(e.scrollbarX=new o.Scrollbar)}},{key:"_createXYChart",value:function(e){var t=e.chartDiv,n=e.chartsModule,r=e.mediaInfo.type,i=n.am4core,a=n.am4charts,o=i.create(t,a.XYChart);return o.rtl=(0,b.f)(this.container),"column-chart"===r&&this._createColumnChart(o,e),"bar-chart"===r&&this._createBarChart(o,e),"line-chart"===r&&this._createLineChart(o,e),o}},{key:"_clearMediaRefreshTimer",value:function(){var e=this._refreshTimer;e&&(clearTimeout(e),this._refreshTimer=null)}},{key:"_updateMediaInfoTimestamp",value:function(e){var t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}},{key:"_setupMediaRefreshTimer",value:function(){this._clearMediaRefreshTimer();var e=this.viewModel.activeMediaInfo;e&&"image"===e.type&&e.refreshInterval&&this._setRefreshTimeout(e)}},{key:"_setRefreshTimeout",value:function(e){var t=this,n=e.refreshInterval,r=e.value;if(n){var i=6e4*n;this._updateMediaInfoTimestamp(r.sourceURL);var a=setInterval((function(){t._updateMediaInfoTimestamp(r.sourceURL)}),i);this._refreshTimer=a}}},{key:"_getImageSource",value:function(e,t){var n=e.includes("?")?"&":"?",r=e.split("#"),i=(0,a.Z)(r,2),o=i[0],s=i[1],l=void 0===s?"":s;return"".concat(o).concat(n,"timestamp=").concat(t).concat(l?"#":"").concat(l)}}]),n}(b.M);(0,v.e)([(0,v.y)()],sr.prototype,"attributes",null),(0,v.e)([(0,v.y)()],sr.prototype,"activeMediaInfoIndex",null),(0,v.e)([(0,v.y)()],sr.prototype,"description",null),(0,v.e)([(0,v.y)()],sr.prototype,"fieldInfoMap",null),(0,v.e)([(0,v.y)()],sr.prototype,"layer",null),(0,v.e)([(0,v.y)()],sr.prototype,"mediaInfos",null),(0,v.e)([(0,v.y)()],sr.prototype,"popupTemplate",null),(0,v.e)([(0,v.y)()],sr.prototype,"relatedInfos",null),(0,v.e)([(0,v.y)()],sr.prototype,"title",null),(0,v.e)([(0,v.y)({type:En})],sr.prototype,"viewModel",void 0),(0,v.e)([(0,v.y)(),(0,b.e)("esri/widgets/Feature/t9n/Feature")],sr.prototype,"messages",void 0);var lr=sr=(0,v.e)([(0,v.n)("esri.widgets.Feature.FeatureMedia")],sr),ur=["$datastore","$map","$layer","$aggregatedfeatures"],cr=v.a.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function dr(e){return"string"==typeof e?Fe(Me(e)):Array.isArray(e)?function(e){return'<ul class="esri-widget__list">'.concat(e.map((function(e){return"<li>".concat("string"==typeof e?Fe(Me(e)):e,"</li>")})).join(""),"</ul>")}(e):"esri.arcade.Dictionary"===(null===e||void 0===e?void 0:e.declaredClass)?function(e){return'<table class="esri-widget__table">'.concat(e.keys().map((function(t){var n=e.field(t);return"<tr><th>".concat(t,"</th><td>").concat("string"==typeof n?Fe(Me(n)):n,"</td></tr>")})).join(""),"</table>")}(e):e}function fr(e){var t=e.aggregatedFeatures,n=e.arcadeUtils,r=e.featureSetVars,i=e.context,a=e.viewInfo,o=e.map,s=e.graphic,l=e.interceptor;r.forEach((function(e){var r=e.toLowerCase(),u={map:o,spatialReference:a.sr,interceptor:l};if("$map"===r&&(i.vars[r]=n.convertMapToFeatureSetCollection(u)),"$layer"===r&&(i.vars[r]=n.convertFeatureLayerToFeatureSet({layer:s.sourceLayer,spatialReference:a.sr,interceptor:l})),"$datastore"===r&&(i.vars[r]=n.convertServiceUrlToWorkspace({url:s.sourceLayer.url,spatialReference:a.sr,interceptor:l})),"$aggregatedfeatures"===r){var c=s.layer,d=c.fields,f=c.objectIdField,h=c.geometryType,v=c.spatialReference,y=c.displayField,m=new N.default((0,p.Z)((0,p.Z)({fields:d,objectIdField:f,geometryType:h,spatialReference:v,displayField:y},"feature"===c.type?{templates:c.templates,typeIdField:c.typeIdField,types:c.types}:null),{},{source:t}));i.vars[r]=n.convertFeatureLayerToFeatureSet({layer:m,spatialReference:a.sr,interceptor:l})}}))}function pr(){return n.e(8631).then(n.bind(n,58631)).then((function(e){return e.ay}))}function hr(e){return"createQuery"in e&&"queryFeatures"in e}function vr(e){return yr.apply(this,arguments)}function yr(){return yr=(0,h.Z)((0,s.Z)().mark((function e(t){var n,r,i,a,o,l,u,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.graphic,r=t.view,i=n.isAggregate,a=n.layer,i&&a&&"2d"===(null===r||void 0===r?void 0:r.type)){e.next=4;break}return e.abrupt("return",[]);case 4:return e.next=6,r.whenLayerView(a);case 6:if(hr(o=e.sent)){e.next=9;break}return e.abrupt("return",[]);case 9:return(l=o.createQuery()).aggregateIds=[n.getObjectId()],e.next=13,o.queryFeatures(l);case 13:return u=e.sent,c=u.features,e.abrupt("return",c);case 16:case"end":return e.stop()}}),e)}))),yr.apply(this,arguments)}function mr(e){return gr.apply(this,arguments)}function gr(){return gr=(0,h.Z)((0,s.Z)().mark((function e(t){var n,r,i,o,l,u,c,d,f,p,h,v,y,m,g;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.expressionInfo,r=t.arcadeUtils,i=t.interceptor,o=t.spatialReference,l=t.map,u=t.graphic,c=t.view,n&&n.expression){e.next=3;break}return e.abrupt("return",null);case 3:return d=r.createSyntaxTree(n.expression),f=ur.filter((function(e){return r.hasVariable(d,e)})),e.next=7,Promise.all([vr({graphic:u,view:c}),r.loadScriptDependencies(d,!0,f)]);case 7:return p=e.sent,h=(0,a.Z)(p,1),v=h[0],y=r.getViewInfo({spatialReference:o}),(m=r.createExecContext(u,y)).interceptor=i,m.useAsync=!0,fr({aggregatedFeatures:v,arcadeUtils:r,featureSetVars:f,context:m,viewInfo:y,map:l,graphic:u,interceptor:i}),g=r.createFunction(d,m),e.abrupt("return",r.executeAsyncFunction(g,m).catch((function(e){return cr.error("arcade-execution-error",{error:e,graphic:u,expressionInfo:n})})));case 15:case"end":return e.stop()}}),e)}))),gr.apply(this,arguments)}function br(e){return _r.apply(this,arguments)}function _r(){return _r=(0,h.Z)((0,s.Z)().mark((function e(t){var n,r,a,o,l,u,c,d,f,p,h,y,m,g;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.expressionInfos,r=t.spatialReference,a=t.graphic,o=t.interceptor,l=t.map,u=t.view,n&&n.length){e.next=3;break}return e.abrupt("return",{});case 3:return e.next=5,pr();case 5:c=e.sent,d={},f=(0,i.Z)(n);try{for(f.s();!(p=f.n()).done;)h=p.value,d["expression/".concat(h.name)]=mr({expressionInfo:h,arcadeUtils:c,interceptor:o,spatialReference:r,map:l,graphic:a,view:u})}catch(s){f.e(s)}finally{f.f()}return e.next=11,(0,v.E)(d);case 11:for(g in y=e.sent,m={},y)m[g]=dr(y[g].value);return e.abrupt("return",m);case 15:case"end":return e.stop()}}),e)}))),_r.apply(this,arguments)}var wr=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e))._abortController=null,i.expressionInfo=null,i.graphic=null,i.contentElement=null,i.contentElementViewModel=null,i.interceptor=null,i.view=null,i._cancelQuery=function(){var e=(0,r.Z)(i)._abortController;e&&e.abort(),i._abortController=null},i._createVM=function(){var e,t,n=null===(e=i.contentElement)||void 0===e?void 0:e.type;null===(t=i.contentElementViewModel)||void 0===t||t.destroy();var r="fields"===n?new nn:"media"===n?new En:"text"===n?new Kt:null;i._set("contentElementViewModel",r)},i._compile=(0,h.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i._cancelQuery(),t=new AbortController,i._abortController=t,e.next=5,i._compileExpression();case 5:i._abortController===t&&(i._abortController=null);case 6:case"end":return e.stop()}}),e)}))),i._compileThrottled=j(i._compile,1,(0,r.Z)(i)),i._compileExpression=(0,h.Z)((0,s.Z)().mark((function e(){var t,n,a,o,l,u,c,d,f,p,h,v,y;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,r.Z)(i),n=t.expressionInfo,a=t.graphic,o=t.interceptor,l=t.spatialReference,u=t.map,c=t.view,d=t._abortController,n&&a&&l&&u){e.next=3;break}return e.abrupt("return",void i._set("contentElement",null));case 3:return e.next=5,pr();case 5:if(f=e.sent,d===i._abortController){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,mr({arcadeUtils:f,expressionInfo:n,graphic:a,interceptor:o,map:u,spatialReference:l,view:c});case 10:if((p=e.sent)&&"esri.arcade.Dictionary"===p.declaredClass){e.next=13;break}return e.abrupt("return",void i._set("contentElement",null));case 13:return e.next=15,p.castAsJsonAsync(d.signal);case 15:h=e.sent,v=null===h||void 0===h?void 0:h.type,y="media"===v?Z.I.fromJSON(h):"text"===v?Z.f.fromJSON(h):"fields"===v?Z.b.fromJSON(h):null,i._set("contentElement",y);case 19:case"end":return e.stop()}}),e)}))),i.handles.add([(0,m.l)((function(){return[i.expressionInfo,i.graphic,i.map,i.spatialReference,i.view]}),(function(){return i._compileThrottled()}),m.h),(0,m.l)((function(){return[i.contentElement]}),(function(){return i._createVM()}),m.h)]),i}return(0,u.Z)(n,[{key:"destroy",value:function(){var e;this._cancelQuery(),null!==(e=this.contentElementViewModel)&&void 0!==e&&e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}},{key:"spatialReference",get:function(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:null},set:function(e){this._override("spatialReference",e)}},{key:"state",get:function(){var e=this._abortController,t=this.contentElement,n=this.contentElementViewModel;return e?"loading":t||n?"ready":"disabled"}},{key:"map",get:function(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.map)&&void 0!==e?e:null},set:function(e){this._override("map",e)}}]),n}((0,L.a)(v.m));(0,v.e)([(0,v.y)()],wr.prototype,"_abortController",void 0),(0,v.e)([(0,v.y)({type:Z.g})],wr.prototype,"expressionInfo",void 0),(0,v.e)([(0,v.y)({type:M.g})],wr.prototype,"graphic",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],wr.prototype,"contentElement",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],wr.prototype,"contentElementViewModel",void 0),(0,v.e)([(0,v.y)()],wr.prototype,"interceptor",void 0),(0,v.e)([(0,v.y)()],wr.prototype,"spatialReference",null),(0,v.e)([(0,v.y)({readOnly:!0})],wr.prototype,"state",null),(0,v.e)([(0,v.y)()],wr.prototype,"map",null),(0,v.e)([(0,v.y)()],wr.prototype,"view",void 0);var kr=wr=(0,v.e)([(0,v.n)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],wr),Ir="esri-icon-loading-indicator esri-rotating",Mr="esri-feature-expression",Fr="esri-feature__loading-container",xr="esri-feature__loading-spinner",Ar=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,r){var i;return(0,l.Z)(this,n),(i=t.call(this,e,r)).viewModel=new kr,i}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,m.l)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.contentElementViewModel}),(function(){return e._setupExpressionWidget()}),m.h))}},{key:"destroy",value:function(){this._destroyContentWidget()}},{key:"renderLoading",value:function(){return(0,b.n)("div",{key:"loading-container",class:Fr},(0,b.n)("span",{class:this.classes(Ir,xr)}))}},{key:"render",value:function(){var e,t=this.viewModel.state;return(0,b.n)("div",{class:Mr},"loading"===t?this.renderLoading():"disabled"===t?null:null===(e=this._contentWidget)||void 0===e?void 0:e.render())}},{key:"_destroyContentWidget",value:function(){var e=this._contentWidget;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}},{key:"_setupExpressionWidget",value:function(){var e=this.viewModel,t=e.contentElementViewModel,n=e.contentElement,r=null===n||void 0===n?void 0:n.type;this._destroyContentWidget();var i=t?"fields"===r?new fn({viewModel:t}):"media"===r?new lr({viewModel:t}):"text"===r?new en({viewModel:t}):null:null;this._contentWidget=i,this.scheduleRender()}}]),n}(b.M);(0,v.e)([(0,v.y)({type:kr})],Ar.prototype,"viewModel",void 0);var Cr=Ar=(0,v.e)([(0,v.n)("esri.widgets.Feature.FeatureExpression")],Ar),Zr=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e))._queryAbortController=null,i._queryPageAbortController=null,i._queryFeatureCountAbortController=null,i.featuresPerPage=10,i.description=null,i.graphic=null,i.layer=null,i.map=null,i.orderByFields=null,i.featureCount=0,i.relationshipId=null,i.showAllEnabled=!1,i.title=null,i._cancelQuery=function(){var e=(0,r.Z)(i)._queryAbortController;e&&e.abort(),i._queryAbortController=null},i._cancelQueryFeatureCount=function(){var e=(0,r.Z)(i)._queryFeatureCountAbortController;e&&e.abort(),i._queryFeatureCountAbortController=null},i._cancelQueryPage=function(){var e=(0,r.Z)(i)._queryPageAbortController;e&&e.abort(),i._queryPageAbortController=null},i._queryController=(0,h.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i._cancelQuery(),t=new AbortController,i._queryAbortController=t,e.next=5,(0,v.a2)(i._query());case 5:i._queryAbortController===t&&(i._queryAbortController=null);case 6:case"end":return e.stop()}}),e)}))),i._queryFeatureCountController=(0,h.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i._cancelQueryFeatureCount(),t=new AbortController,i._queryFeatureCountAbortController=t,e.next=5,(0,v.a2)(i._queryFeatureCount());case 5:i._queryFeatureCountAbortController===t&&(i._queryFeatureCountAbortController=null);case 6:case"end":return e.stop()}}),e)}))),i._queryPageController=(0,h.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new AbortController,i._queryPageAbortController=t,e.next=4,(0,v.a2)(i._queryPage());case 4:i._queryPageAbortController===t&&(i._queryPageAbortController=null);case 5:case"end":return e.stop()}}),e)}))),i._queryThrottled=j(i._queryController,100,(0,r.Z)(i)),i._queryFeatureCountThrottled=j(i._queryFeatureCountController,100,(0,r.Z)(i)),i._queryPageThrottled=j(i._queryPageController,100,(0,r.Z)(i)),i._query=(0,h.Z)((0,s.Z)().mark((function e(){var t,n,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,r.Z)(i),n=t._queryAbortController,a=t.relatedFeatures,i._destroyRelatedFeatureViewModels(),i.featurePage=1,a.removeAll(),e.t0=a,e.t1=i,e.next=8,i._queryRelatedFeatures({signal:null===n||void 0===n?void 0:n.signal});case 8:e.t2=e.sent,e.t3=e.t1._sliceFeatures.call(e.t1,e.t2),e.t0.addMany.call(e.t0,e.t3);case 11:case"end":return e.stop()}}),e)}))),i.handles.add([(0,m.l)((function(){return[i.displayCount,i.graphic,i.layer,i.map,i.orderByFieldsFixedCasing,i.relationshipId,i.featuresPerPage,i.showAllEnabled]}),(function(){return i._queryThrottled()}),m.h),(0,m.l)((function(){return[i.featurePage,i.showAllEnabled]}),(function(){return i._queryPageThrottled()})),(0,m.l)((function(){return[i.layer,i.relationshipId,i.objectId]}),(function(){return i._queryFeatureCountThrottled()}))]),i}return(0,u.Z)(n,[{key:"destroy",value:function(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}},{key:"featurePage",get:function(){return this._get("featurePage")},set:function(e){var t=this.featuresPerPage,n=this.featureCount,r=Math.ceil(n/t)||1;this._set("featurePage",Math.min(Math.max(e,1),r))}},{key:"orderByFieldsFixedCasing",get:function(){var e=this.orderByFields,t=this.relatedLayer;return e&&null!==t&&void 0!==t&&t.loaded?e.map((function(e){var n=e.clone(),r=de(e.field,t);return n.field=r,n})):e}},{key:"itemDescriptionFieldName",get:function(){var e,t;return(null===(e=this.orderByFieldsFixedCasing)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.field)||null}},{key:"displayCount",get:function(){return this._get("displayCount")},set:function(e){this._set("displayCount",Math.min(Math.max(e,0),10))}},{key:"objectId",get:function(){var e,t,n;return null!==(e=null===(t=this.graphic)||void 0===t||null===(n=t.attributes)||void 0===n?void 0:n[this.objectIdField])&&void 0!==e?e:null}},{key:"objectIdField",get:function(){var e;return(null===(e=this.layer)||void 0===e?void 0:e.objectIdField)||null}},{key:"relatedFeatures",get:function(){return this._get("relatedFeatures")||new F.j}},{key:"relatedLayer",get:function(){var e=this.layer,t=this.map,n=this.relationship;return null!==e&&void 0!==e&&e.loaded?function(e,t,n){return e&&t&&n?Ve(e.allLayers,t,n)||Ve(e.allTables,t,n):null}(t,e,n):null}},{key:"relationship",get:function(){var e,t,n=this.relationshipId,r=this.layer;return"number"==typeof n&&null!==(e=null===r||void 0===r||null===(t=r.relationships)||void 0===t?void 0:t.find((function(e){return e.id===n})))&&void 0!==e?e:null}},{key:"relatedFeatureViewModels",get:function(){return this._get("relatedFeatureViewModels")||new F.j}},{key:"state",get:function(){var e=this._queryAbortController,t=this._queryFeatureCountAbortController,n=this._queryPageAbortController,r=this.graphic,i=this.relatedLayer;return t?"loading":e||n?"querying":r&&i?"ready":"disabled"}},{key:"_destroyRelatedFeatureViewModels",value:function(){var e;null!==(e=this.relatedFeatureViewModels)&&void 0!==e&&e.forEach((function(e){return!e.destroyed&&e.destroy()})),this.relatedFeatureViewModels.removeAll()}},{key:"_queryFeatureCount",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(){var t,n,r,i,a,o,l,u,c,d,f,p,h,v;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.layer,l=this.relatedLayer,u=this.relationshipId,c=this.objectId,d=this._queryFeatureCountAbortController,e.next=3,null===o||void 0===o?void 0:o.load();case 3:if(l&&"number"==typeof c&&null!==o&&void 0!==o&&null!==(t=o.capabilities)&&void 0!==t&&null!==(n=t.queryRelated)&&void 0!==n&&n.supportsCount){e.next=5;break}return e.abrupt("return",void this._set("featureCount",0));case 5:return e.next=7,l.load();case 7:return f=l.createQuery(),p=null!==(r=null===(i=o.capabilities)||void 0===i||null===(a=i.queryRelated)||void 0===a?void 0:a.supportsCacheHint)&&void 0!==r&&r,h=new A.d({cacheHint:p,relationshipId:u,returnGeometry:!1,objectIds:[c],where:f.where}),e.next=12,o.queryRelatedFeaturesCount(h,{signal:null===d||void 0===d?void 0:d.signal});case 12:v=e.sent,this._set("featureCount",v[c]||0);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_sliceFeatures",value:function(e){var t=this.showAllEnabled,n=this.displayCount;return t?e:n?e.slice(0,n):[]}},{key:"_queryPage",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(){var t,n,r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.relatedFeatures,n=this.featurePage,r=this.showAllEnabled,i=this._queryPageAbortController,e.t0=!r||n<2,e.t0){e.next=8;break}return e.t1=t,e.next=6,this._queryRelatedFeatures({signal:null===i||void 0===i?void 0:i.signal});case 6:e.t2=e.sent,e.t1.addMany.call(e.t1,e.t2);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_queryRelatedFeatures",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(t){var n,r,i,a,o,l,u,c,d,p,h,v,y,m,g,b,_,w,k,I,M,F,x,C,Z;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=this.orderByFieldsFixedCasing,u=this.showAllEnabled,c=this.featuresPerPage,d=this.displayCount,p=this.layer,h=this.relationshipId,v=this.featurePage,y=this.featureCount,m=this.relatedLayer,e.next=3,null===p||void 0===p?void 0:p.load();case 3:if(g=this.relationship,b=this.objectId,g&&"number"==typeof b&&null!==p&&void 0!==p&&null!==(n=p.capabilities)&&void 0!==n&&null!==(r=n.queryRelated)&&void 0!==r&&r.supportsPagination){e.next=6;break}return e.abrupt("return",[]);case 6:if(_=u?((v-1)*c+y)%y:0,w=u?c:d,m){e.next=9;break}return e.abrupt("return",[]);case 9:return e.next=11,m.load();case 11:return k=m.objectIdField,I=[].concat((0,f.Z)(null===l||void 0===l?void 0:l.map((function(e){return e.field}))),[k]),M=null===l||void 0===l?void 0:l.map((function(e){return"".concat(e.field," ").concat(e.order)})),F=(null===(i=p.capabilities)||void 0===i||null===(a=i.queryRelated)||void 0===a?void 0:a.supportsCacheHint)||!1,x=m.createQuery(),C=new A.d({orderByFields:M,start:_,num:w,outFields:I,cacheHint:F,relationshipId:h,returnGeometry:!1,objectIds:[b],where:x.where}),e.next=19,p.queryRelatedFeatures(C,{signal:null===t||void 0===t?void 0:t.signal});case 19:if(e.t2=b,e.t3=o=e.sent[e.t2],e.t1=null===e.t3,e.t1){e.next=24;break}e.t1=void 0===o;case 24:if(!e.t1){e.next=28;break}e.t4=void 0,e.next=29;break;case 28:e.t4=o.features;case 29:if(e.t0=e.t4,e.t0){e.next=32;break}e.t0=[];case 32:return Z=e.t0,e.abrupt("return",(Z.forEach((function(e){return e.sourceLayer=m})),Z));case 34:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}((0,V.i)((0,q.s)((0,L.a)(v.m))));(0,v.e)([(0,v.y)()],Zr.prototype,"_queryAbortController",void 0),(0,v.e)([(0,v.y)()],Zr.prototype,"_queryPageAbortController",void 0),(0,v.e)([(0,v.y)()],Zr.prototype,"_queryFeatureCountAbortController",void 0),(0,v.e)([(0,v.y)({value:1})],Zr.prototype,"featurePage",null),(0,v.e)([(0,v.y)()],Zr.prototype,"featuresPerPage",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Zr.prototype,"orderByFieldsFixedCasing",null),(0,v.e)([(0,v.y)()],Zr.prototype,"description",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Zr.prototype,"itemDescriptionFieldName",null),(0,v.e)([(0,v.y)({value:3})],Zr.prototype,"displayCount",null),(0,v.e)([(0,v.y)({type:M.g})],Zr.prototype,"graphic",void 0),(0,v.e)([(0,v.y)()],Zr.prototype,"layer",void 0),(0,v.e)([(0,v.y)()],Zr.prototype,"map",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Zr.prototype,"objectId",null),(0,v.e)([(0,v.y)({readOnly:!0})],Zr.prototype,"objectIdField",null),(0,v.e)([(0,v.y)()],Zr.prototype,"orderByFields",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Zr.prototype,"relatedFeatures",null),(0,v.e)([(0,v.y)({readOnly:!0})],Zr.prototype,"relatedLayer",null),(0,v.e)([(0,v.y)({readOnly:!0})],Zr.prototype,"relationship",null),(0,v.e)([(0,v.y)({readOnly:!0})],Zr.prototype,"featureCount",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Zr.prototype,"relatedFeatureViewModels",null),(0,v.e)([(0,v.y)()],Zr.prototype,"relationshipId",void 0),(0,v.e)([(0,v.y)()],Zr.prototype,"showAllEnabled",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Zr.prototype,"state",null),(0,v.e)([(0,v.y)()],Zr.prototype,"title",void 0);var Er=Zr=(0,v.e)([(0,v.n)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],Zr),Tr="esri-feature-relationship",Lr="esri-widget",Sr="esri-feature-relationship__list",Rr="esri-feature-relationship__list--querying",Pr="esri-feature__feature-observer",Or="esri-feature__sticky-loading-container",Nr="esri-feature__loading-container",Vr="esri-feature__loading-spinner",qr="esri-icon-loading-indicator esri-rotating",jr={title:!0,description:!0},Dr=function(e){(0,c.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,l.Z)(this,r),(i=t.call(this,e,n))._featureElementInfo=null,i._relatedFeatureIntersectionObserver=new IntersectionObserver((function(e){var t=(0,a.Z)(e,1)[0];(null===t||void 0===t?void 0:t.isIntersecting)&&i._increaseFeaturePage()}),{root:window.document}),i.headingLevel=2,i.viewModel=new Er,i.messages=null,i.messagesCommon=null,i.visibleElements=(0,p.Z)({},jr),i._increaseFeaturePage=function(){var e=i.viewModel,t=e.state,n=e.showAllEnabled,r=e.relatedFeatures,a=e.featuresPerPage,o=e.featurePage;"ready"===t&&n&&r.length>=a*o&&i.viewModel.featurePage++},i}return(0,u.Z)(r,[{key:"initialize",value:function(){var e=this;this._featureElementInfo=new Wt,this.addHandles([(0,m.l)((function(){return[e.viewModel.description,e.viewModel.title,e.headingLevel]}),(function(){return e._setupFeatureElementInfo()}),m.h),(0,m.l)((function(){return[e.viewModel.state,e.viewModel.showAllEnabled,e._relatedFeatureIntersectionObserverNode]}),(function(){return e._handleRelatedFeatureObserverChange()})),(0,m.a)((function(){return e.viewModel.relatedFeatureViewModels}),"change",(function(){return e._setupRelatedFeatureViewModels()}))])}},{key:"loadDependencies",value:function(){return Promise.all([n.e(756).then(n.bind(n,80756)),n.e(8119).then(n.bind(n,48119)),n.e(1903).then(n.bind(n,1903)),n.e(3678).then(n.bind(n,43678))])}},{key:"destroy",value:function(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=(0,g.g)(this._featureElementInfo)}},{key:"displayShowAllButton",get:function(){var e=this.viewModel,t=e.showAllEnabled,n=e.featureCount,r=e.displayCount;return!t&&(n>r||0===r)}},{key:"displayListItems",get:function(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}},{key:"description",get:function(){return this.viewModel.description},set:function(e){this.viewModel.description=e}},{key:"featureCountDescription",get:function(){var e=this.messages,t=this.viewModel.featureCount;return(0,y.s)(1===t?null===e||void 0===e?void 0:e.numberRecord:null===e||void 0===e?void 0:e.numberRecords,{number:t})}},{key:"title",get:function(){return this.viewModel.title},set:function(e){this.viewModel.title=e}},{key:"castVisibleElements",value:function(e){return(0,p.Z)((0,p.Z)({},jr),e)}},{key:"renderStickyLoading",value:function(){return"querying"===this.viewModel.state?(0,b.n)("div",{key:"sticky-loader",class:Or},this.renderLoadingIcon()):null}},{key:"renderLoadingIcon",value:function(){return(0,b.n)("span",{class:this.classes(qr,Vr)})}},{key:"renderLoading",value:function(){return(0,b.n)("div",{key:"loading-container",class:Nr},this.renderLoadingIcon())}},{key:"renderShowAllIconNode",value:function(){return(0,b.n)("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})}},{key:"renderChevronIconNode",value:function(){var e=(0,b.f)(this.container)?"chevron-left":"chevron-right";return(0,b.n)("calcite-icon",{scale:"s",icon:e,slot:"content-end"})}},{key:"renderRelatedFeature",value:function(e){var t,n,r=this,i=this.viewModel.itemDescriptionFieldName,a=e.title;e.description=i&&(null===(t=e.formattedAttributes)||void 0===t?void 0:t.global[i]);var o="loading"===e.state;return(0,b.n)("calcite-list-item",{key:e.uid,label:o?"".concat(null===(n=this.messagesCommon)||void 0===n?void 0:n.loading,"\u2026"):a,description:o?"\u2026":e.description,onclick:function(){return r.emit("select-record",{featureViewModel:e})}},this.renderChevronIconNode())}},{key:"renderShowAllListItem",value:function(){var e,t=this;return this.displayShowAllButton?(0,b.n)("calcite-list-item",{key:"show-all-item",label:null===(e=this.messages)||void 0===e?void 0:e.showAll,description:this.featureCountDescription,onclick:function(){return t.emit("show-all-records")}},this.renderShowAllIconNode()):null}},{key:"renderNoRelatedFeaturesMessage",value:function(){var e;return(0,b.n)("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,color:"blue",scale:"s",width:"full"},(0,b.n)("div",{slot:"message"},null===(e=this.messages)||void 0===e?void 0:e.noRelatedFeatures))}},{key:"renderFeatureObserver",value:function(){return(0,b.n)("div",{key:"feature-observer",class:Pr,bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})}},{key:"renderList",value:function(){var e=this,t=this.viewModel.relatedFeatureViewModels;return(0,b.n)("calcite-list",null,t.toArray().map((function(t){return e.renderRelatedFeature(t)})),this.renderShowAllListItem())}},{key:"renderRelatedFeatures",value:function(){var e=this.displayListItems,t=this.viewModel.state;return(0,b.n)("div",{key:"list-container",class:this.classes(Sr,(0,o.Z)({},Rr,"querying"===t))},e?this.renderList():"ready"===t?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())}},{key:"renderRelationshipNotFound",value:function(){var e;return(0,b.n)("calcite-notice",{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,color:"red",scale:"s",width:"full"},(0,b.n)("div",{slot:"message"},null===(e=this.messages)||void 0===e?void 0:e.relationshipNotFound))}},{key:"render",value:function(){var e,t=this.viewModel.state;return(0,b.n)("div",{class:this.classes(Tr,Lr)},null===(e=this._featureElementInfo)||void 0===e?void 0:e.render(),"loading"===t?this.renderLoading():"disabled"===t?this.renderRelationshipNotFound():this.renderRelatedFeatures())}},{key:"_setupRelatedFeatureViewModels",value:function(){var e=this,t=this.viewModel.relatedFeatureViewModels,n="related-feature-viewmodels";this.removeHandles(n),null!==t&&void 0!==t&&t.forEach((function(t){e.addHandles((0,m.l)((function(){return[t.title,t.state]}),(function(){return e.scheduleRender()}),m.h),n)})),this.scheduleRender()}},{key:"_setupFeatureElementInfo",value:function(){var e=this.headingLevel,t=this.visibleElements,n=t.description&&this.description,r=t.title&&this.title;this._featureElementInfo.set({description:n,title:r,headingLevel:e})}},{key:"_handleRelatedFeatureObserverChange",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(){var t,n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._unobserveRelatedFeatureObserver(),t=this.viewModel,n=t.state,r=t.showAllEnabled,e.next=4,(0,v.ab)(0);case 4:this._relatedFeatureIntersectionObserverNode&&"ready"===n&&r&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_relatedFeatureIntersectionObserverCreated",value:function(e){this._relatedFeatureIntersectionObserverNode=e}},{key:"_unobserveRelatedFeatureObserver",value:function(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}}]),r}(b.M);(0,v.e)([(0,v.y)()],Dr.prototype,"_relatedFeatureIntersectionObserverNode",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Dr.prototype,"displayShowAllButton",null),(0,v.e)([(0,v.y)({readOnly:!0})],Dr.prototype,"displayListItems",null),(0,v.e)([(0,v.y)()],Dr.prototype,"description",null),(0,v.e)([(0,v.y)({readOnly:!0})],Dr.prototype,"featureCountDescription",null),(0,v.e)([(0,v.y)()],Dr.prototype,"headingLevel",void 0),(0,v.e)([(0,v.y)()],Dr.prototype,"title",null),(0,v.e)([(0,v.y)({type:Er})],Dr.prototype,"viewModel",void 0),(0,v.e)([(0,v.y)(),(0,b.e)("esri/widgets/Feature/t9n/Feature")],Dr.prototype,"messages",void 0),(0,v.e)([(0,v.y)(),(0,b.e)("esri/t9n/common")],Dr.prototype,"messagesCommon",void 0),(0,v.e)([(0,v.y)()],Dr.prototype,"visibleElements",void 0),(0,v.e)([(0,v.c)("visibleElements")],Dr.prototype,"castVisibleElements",null);var zr,Ur=Dr=(0,v.e)([(0,v.n)("esri.widgets.Feature.FeatureRelationship")],Dr),Wr=(0,u.Z)((function e(t,n){(0,l.Z)(this,e),this.preLayerQueryCallback=t,this.preRequestCallback=n,this.preLayerQueryCallback||(this.preLayerQueryCallback=function(e){}),this.preRequestCallback||(this.preLayerQueryCallback=function(e){})})),Br="content-view-models",Hr="relationship-view-models",Gr={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0},Qr=zr=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,l.Z)(this,n),(i=t.call(this,e))._handles=new v.X,i._error=null,i._featureAbortController=null,i._graphicChangedThrottled=j(i._graphicChanged,1,(0,r.Z)(i)),i._expressionAttributes=null,i._graphicExpressionAttributes=null,i.abilities=(0,p.Z)({},Gr),i.content=null,i.contentViewModels=[],i.description=null,i.defaultPopupTemplateEnabled=!1,i.formattedAttributes=null,i.lastEditInfo=null,i.relatedInfos=new Map,i.title="",i.view=null,i._isAllowedContentType=function(e){var t=(0,r.Z)(i).abilities;return"attachments"===e.type&&t.attachmentsContent||"custom"===e.type&&t.customContent||"fields"===e.type&&t.fieldsContent||"media"===e.type&&t.mediaContent||"text"===e.type&&t.textContent||"expression"===e.type&&t.expressionContent||"relationship"===e.type&&t.relationshipContent},i._handles.add((0,m.l)((function(){return[i.graphic,i._effectivePopupTemplate,i.abilities]}),(function(){return i._graphicChangedThrottled()}),m.h)),i}return(0,u.Z)(n,[{key:"destroy",value:function(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}},{key:"_effectivePopupTemplate",get:function(){return(0,g.r)(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}},{key:"_fieldInfoMap",get:function(){return function(e,t){var n=new Map;return e&&e.forEach((function(e){var r=de(e.fieldName,t);e.fieldName=r,n.set(r.toLowerCase(),e)})),n}(Ie(this._effectivePopupTemplate),this._sourceLayer)}},{key:"_sourceLayer",get:function(){return ae(this.graphic)}},{key:"castAbilities",value:function(e){return(0,p.Z)((0,p.Z)({},Gr),e)}},{key:"state",get:function(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}},{key:"graphic",set:function(e){this._set("graphic",e?e.clone():null)}},{key:"spatialReference",get:function(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:null},set:function(e){this._override("spatialReference",e)}},{key:"map",get:function(){var e;return(null===(e=this.view)||void 0===e?void 0:e.map)||null},set:function(e){this._override("map",e)}},{key:"waitingForContent",get:function(){return!!this._featureAbortController}},{key:"setActiveMedia",value:function(e,t){var n=this.contentViewModels[e];n instanceof En&&n.setActiveMedia(t)}},{key:"nextMedia",value:function(e){var t=this.contentViewModels[e];t instanceof En&&t.next()}},{key:"previousMedia",value:function(e){var t=this.contentViewModels[e];t instanceof En&&t.previous()}},{key:"_clear",value:function(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}},{key:"_graphicChanged",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cancelFeatureQuery(),this._error=null,this._clear(),t=this.graphic){e.next=4;break}return e.abrupt("return");case 4:return n=new AbortController,this._featureAbortController=n,e.prev=6,e.next=9,this._queryFeature({signal:n.signal});case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),(0,v.j)(e.t0)||(this._error=e.t0,v.a.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:e.t0,graphic:t,popupTemplate:this._effectivePopupTemplate}));case 14:this._featureAbortController===n&&(this._featureAbortController=null);case 15:case"end":return e.stop()}}),e,this,[[6,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"_cancelFeatureQuery",value:function(){var e=this._featureAbortController;e&&e.abort(),this._featureAbortController=null}},{key:"_compileContentElement",value:function(e,t){return"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):"expression"===e.type?this._compileExpression(e,t):"relationship"===e.type?this._compileRelationship(e,t):void 0}},{key:"_compileContent",value:function(e){var t=this;if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((function(e,n){return t._compileContentElement(e,n)})):"string"==typeof e?this._compileText(new Z.f({text:e}),0).text:e}},{key:"_destroyContentViewModels",value:function(){var e,t;null!==(e=this._handles)&&void 0!==e&&e.remove(Hr),null!==(t=this._handles)&&void 0!==t&&t.remove(Br),this.contentViewModels.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("contentViewModels",[])}},{key:"_matchesFeature",value:function(e,t){var n,r=null===e||void 0===e||null===(n=e.graphic)||void 0===n?void 0:n.getObjectId(),i=null===t||void 0===t?void 0:t.getObjectId();return(0,g.r)(r)&&(0,g.r)(i)&&r===i}},{key:"_setRelatedFeaturesViewModels",value:function(e){var t=this,n=e.relatedFeatureViewModels,r=e.relatedFeatures,i=e.map;null!==r&&void 0!==r&&r.filter(Boolean).forEach((function(e){n.find((function(n){return t._matchesFeature(n,e)}))||n.add(new zr({abilities:{relationshipContent:!1},map:i,graphic:e}))})),n.forEach((function(e){var i=null===r||void 0===r?void 0:r.find((function(n){return t._matchesFeature(e,n)}));i||n.remove(e)}))}},{key:"_setExpressionContentVM",value:function(e,t){var n=this.formattedAttributes,r=e.contentElement,i=e.contentElementViewModel,a=null===r||void 0===r?void 0:r.type;i&&a&&("fields"===a&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:n}),i.set(this._createFieldsVMParams(r,t))),"media"===a&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:n}),i.set(this._createMediaVMParams(r,t))),"text"===a&&i.set(this._createTextVMParams(r)))}},{key:"_compileRelationship",value:function(e,t){var n=this,r=e.displayCount,i=e.orderByFields,a=e.relationshipId,o=e.title,s=e.description,l=this._sourceLayer,u=this.graphic,c=this.map,d=new Er((0,p.Z)({displayCount:r,graphic:u,orderByFields:i,relationshipId:a,layer:l,map:c},this._compileTitleAndDesc({title:o,description:s})));return this.contentViewModels[t]=d,this._handles.add((0,m.a)((function(){return d.relatedFeatures}),"change",(function(){return n._setRelatedFeaturesViewModels(d)})),Hr),e}},{key:"_compileExpression",value:function(e,t){var n=this,r=e.expressionInfo,i=this.graphic,a=this.map,o=this.spatialReference,s=this.view,l=new kr({expressionInfo:r,graphic:i,interceptor:zr.interceptor,map:a,spatialReference:o,view:s});return this.contentViewModels[t]=l,this._handles.add((0,m.l)((function(){return l.contentElementViewModel}),(function(){return n._setExpressionContentVM(l,t)}),m.h),Br),e}},{key:"_compileAttachments",value:function(e,t){var n=this.graphic,r=e.description,i=e.title;return this.contentViewModels[t]=new qt((0,p.Z)({graphic:n},this._compileTitleAndDesc({title:i,description:r}))),e}},{key:"_compileCustom",value:function(e,t){var n=this.graphic,r=e.creator,i=e.destroyer;return this.contentViewModels[t]=new Kt({graphic:n,creator:r,destroyer:i}),e}},{key:"_compileTitleAndDesc",value:function(e){var t=e.title,n=e.description,r=this._fieldInfoMap,i=this._sourceLayer,a=this.graphic,o=this.formattedAttributes,s=this._expressionAttributes,l=a.attributes,u=o.global;return{title:he({attributes:l,fieldInfoMap:r,globalAttributes:u,expressionAttributes:s,layer:i,text:t}),description:he({attributes:l,fieldInfoMap:r,globalAttributes:u,expressionAttributes:s,layer:i,text:n})}}},{key:"_createFieldsVMParams",value:function(e,t){var n,r=this._effectivePopupTemplate,i=this.formattedAttributes,a=(0,p.Z)((0,p.Z)({},i.global),i.content[t]),o=null===(n=(null===e||void 0===e?void 0:e.fieldInfos)||(null===r||void 0===r?void 0:r.fieldInfos))||void 0===n?void 0:n.filter((function(e){var t=e.fieldName;return ue(t)||Re(t)||a.hasOwnProperty(t)})),s=null===r||void 0===r?void 0:r.expressionInfos,l=e.description,u=e.title;return(0,p.Z)({attributes:a,expressionInfos:s,fieldInfos:o},this._compileTitleAndDesc({title:u,description:l}))}},{key:"_compileFields",value:function(e,t){var n=e.clone(),r=new nn(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,n.fieldInfos=r.formattedFieldInfos.slice(0),n}},{key:"_createMediaVMParams",value:function(e,t){var n=this.abilities,r=this.graphic,i=this._fieldInfoMap,a=this.formattedAttributes,o=this._effectivePopupTemplate,s=this.relatedInfos,l=this._sourceLayer,u=this._expressionAttributes,c=r.attributes,d=e.description,f=e.mediaInfos,h=e.title;return(0,p.Z)({abilities:{chartAnimation:n.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:c,layer:l,fieldInfoMap:i,formattedAttributes:(0,p.Z)((0,p.Z)({},a.global),a.content[t]),expressionAttributes:u,mediaInfos:f,popupTemplate:o,relatedInfos:s},this._compileTitleAndDesc({title:h,description:d}))}},{key:"_compileMedia",value:function(e,t){var n=e.clone(),r=new En(this._createMediaVMParams(e,t));return n.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,n}},{key:"_createTextVMParams",value:function(e){var t=this.graphic,n=this._fieldInfoMap,r=this._sourceLayer,i=this._expressionAttributes;if(e&&e.text){var a=t.attributes,o=this.formattedAttributes.global;e.text=he({attributes:a,fieldInfoMap:n,globalAttributes:o,expressionAttributes:i,layer:r,text:e.text})}return{graphic:t,creator:e.text}}},{key:"_compileText",value:function(e,t){var n=e.clone();return this.contentViewModels[t]=new Kt(this._createTextVMParams(n)),n}},{key:"_compileLastEditInfo",value:function(){var e=this._effectivePopupTemplate,t=this._sourceLayer,n=this.graphic;if(e){var r=e.lastEditInfoEnabled,i=null===t||void 0===t?void 0:t.editFieldsInfo;return r&&i?function(e,t){var n=e.creatorField,r=e.creationDateField,i=e.editorField,a=e.editDateField;if(t){var o=t[a];if("number"==typeof o){var s=t[i];return{type:"edit",date:(0,I.L)(o,ie),user:s}}var l=t[r];if("number"==typeof l){var u=t[n];return{type:"create",date:(0,I.L)(l,ie),user:u}}return null}}(i,n.attributes):void 0}}},{key:"_compileTitle",value:function(e){var t=this._fieldInfoMap,n=this._sourceLayer,r=this.graphic,i=this._expressionAttributes;return he({attributes:r.attributes,fieldInfoMap:t,globalAttributes:this.formattedAttributes.global,expressionAttributes:i,layer:n,text:e})}},{key:"_getTitle",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(){var t,n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._effectivePopupTemplate,n=this.graphic,r=null===t||void 0===t?void 0:t.title,e.abrupt("return",oe(r,{graphic:n}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getContent",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(){var t,n,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._effectivePopupTemplate,n=this.graphic,r=null===t||void 0===t?void 0:t.content,e.abrupt("return",oe(r,{graphic:n}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_queryFeature",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(t){var n,r,i,a,o,l,u,c,d,f,h,y;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._featureAbortController,r=this._sourceLayer,i=this.graphic,a=this._effectivePopupTemplate,o=this.spatialReference,l=this.map,u=this.view,n===this._featureAbortController&&i){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Le({graphic:i,popupTemplate:a,layer:r,spatialReference:o},t);case 5:return e.next=7,(0,v.E)({content:this._getContent(),title:this._getTitle()});case 7:return c=e.sent,d=c.content.value,f=c.title.value,e.next=12,(0,v.E)({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:br({expressionInfos:null===a||void 0===a?void 0:a.expressionInfos,spatialReference:o,graphic:i,map:l,interceptor:zr.interceptor,view:u})});case 12:h=e.sent,y=h.expressionAttributes.value,n===this._featureAbortController&&i&&(this._expressionAttributes=y,this._graphicExpressionAttributes=(0,p.Z)((0,p.Z)({},i.attributes),y),this._set("formattedAttributes",this._createFormattedAttributes(d)),this._set("title",this._compileTitle(f)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(d)||null));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createMediaFormattedAttributes",value:function(e){var t=e.contentElement,n=e.contentElementIndex,r=e.formattedAttributes,i=this._effectivePopupTemplate,a=this.graphic,o=this.relatedInfos,s=this._sourceLayer,l=this._fieldInfoMap,u=this._graphicExpressionAttributes;r.content[n]=Ae({fieldInfos:null===i||void 0===i?void 0:i.fieldInfos,graphic:a,attributes:(0,p.Z)((0,p.Z)({},u),t.attributes),layer:s,fieldInfoMap:l,relatedInfos:o})}},{key:"_createFieldsFormattedAttributes",value:function(e){var t=e.contentElement,n=e.contentElementIndex,r=e.formattedAttributes;if(t.fieldInfos){var i=this.graphic,a=this.relatedInfos,o=this._sourceLayer,s=this._fieldInfoMap,l=this._graphicExpressionAttributes;r.content[n]=Ae({fieldInfos:t.fieldInfos,graphic:i,attributes:(0,p.Z)((0,p.Z)({},l),t.attributes),layer:o,fieldInfoMap:s,relatedInfos:a})}}},{key:"_createFormattedAttributes",value:function(e){var t=this,n=this._effectivePopupTemplate,r=this.graphic,i=this.relatedInfos,a=this._sourceLayer,o=this._fieldInfoMap,s=this._graphicExpressionAttributes,l={global:Ae({fieldInfos:null===n||void 0===n?void 0:n.fieldInfos,graphic:r,attributes:s,layer:a,fieldInfoMap:o,relatedInfos:i}),content:[]};return Array.isArray(e)&&e.forEach((function(e,n){"fields"===e.type&&t._createFieldsFormattedAttributes({contentElement:e,contentElementIndex:n,formattedAttributes:l}),"media"===e.type&&t._createMediaFormattedAttributes({contentElement:e,contentElementIndex:n,formattedAttributes:l})})),l}},{key:"_checkForRelatedFeatures",value:function(e){var t=this.graphic,n=this._effectivePopupTemplate;return this._queryRelatedInfos(t,Ie(n),e)}},{key:"_queryRelatedInfos",value:function(){var e=(0,h.Z)((0,s.Z)().mark((function e(t,n,r){var i,a,o,l,u,c,d=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.relatedInfos,a=this._sourceLayer,i.clear(),!(0,g.r)(a.associatedLayer)){e.next=8;break}return e.next=5,a.associatedLayer.load(r);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=a;case 9:if(o=e.t0){e.next=12;break}return e.abrupt("return");case 12:if(l=n.filter((function(e){return e&&Re(e.fieldName)})),l&&l.length){e.next=15;break}return e.abrupt("return");case 15:return n.forEach((function(e){return d._configureRelatedInfo(e,o)})),e.next=18,In({relatedInfos:i,layer:o},r);case 18:return u=e.sent,Object.keys(u).forEach((function(e){var t,n=i.get(e.toString()),r=null===(t=u[e])||void 0===t?void 0:t.value;n&&r&&(n.layerInfo=r.data)})),e.next=22,Mn({graphic:t,relatedInfos:i,layer:o},r);case 22:c=e.sent,Object.keys(c).forEach((function(e){var t;bn(null===(t=c[e])||void 0===t?void 0:t.value,i.get(e.toString()))}));case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_configureRelatedInfo",value:function(e,t){var n=this.relatedInfos,r=vn(e.fieldName);if(r){var i=r.layerId,a=r.fieldName;if(i){var o=n.get(i.toString())||gn(i,t);o&&(function(e){var t=e.relatedInfo,n=e.fieldName,r=e.fieldInfo;if(t.relatedFields.push(n),r.statisticType){var i=new P.m({statisticType:r.statisticType,onStatisticField:n,outStatisticFieldName:n});t.outStatistics.push(i)}}({relatedInfo:o,fieldName:a,fieldInfo:e}),this.relatedInfos.set(i,o))}}}}]),n}((0,q.s)(v.m));Qr.interceptor=new Wr((function(e){var t=e.query,n=e.layer,r=e.method;Ne({layer:n,method:r,query:t,definitionExpression:"".concat(n.definitionExpression," ").concat(n.serviceDefinitionExpression)})}),(function(e){var t=e.queryPayload,n=e.layer,r=e.method;Ne({layer:n,method:r,query:t,definitionExpression:"".concat(n.definitionExpression," ").concat(n.serviceDefinitionExpression)})})),(0,v.e)([(0,v.y)()],Qr.prototype,"_error",void 0),(0,v.e)([(0,v.y)()],Qr.prototype,"_featureAbortController",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Qr.prototype,"_effectivePopupTemplate",null),(0,v.e)([(0,v.y)({readOnly:!0})],Qr.prototype,"_fieldInfoMap",null),(0,v.e)([(0,v.y)({readOnly:!0})],Qr.prototype,"_sourceLayer",null),(0,v.e)([(0,v.y)()],Qr.prototype,"abilities",void 0),(0,v.e)([(0,v.c)("abilities")],Qr.prototype,"castAbilities",null),(0,v.e)([(0,v.y)({readOnly:!0})],Qr.prototype,"content",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Qr.prototype,"contentViewModels",void 0),(0,v.e)([(0,v.y)()],Qr.prototype,"description",void 0),(0,v.e)([(0,v.y)({type:Boolean})],Qr.prototype,"defaultPopupTemplateEnabled",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Qr.prototype,"state",null),(0,v.e)([(0,v.y)({readOnly:!0})],Qr.prototype,"formattedAttributes",void 0),(0,v.e)([(0,v.y)({type:M.g,value:null})],Qr.prototype,"graphic",null),(0,v.e)([(0,v.y)({readOnly:!0})],Qr.prototype,"lastEditInfo",void 0),(0,v.e)([(0,v.y)({readOnly:!0})],Qr.prototype,"relatedInfos",void 0),(0,v.e)([(0,v.y)()],Qr.prototype,"spatialReference",null),(0,v.e)([(0,v.y)({readOnly:!0})],Qr.prototype,"title",void 0),(0,v.e)([(0,v.y)()],Qr.prototype,"map",null),(0,v.e)([(0,v.y)({readOnly:!0})],Qr.prototype,"waitingForContent",null),(0,v.e)([(0,v.y)()],Qr.prototype,"view",void 0);var Kr,$r=Qr=zr=(0,v.e)([(0,v.n)("esri.widgets.FeatureViewModel")],Qr),Yr={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentNode:"esri-feature__content-node",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},Xr=function(e){var t=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;return(0,l.Z)(this,n),(e=t.apply(this,arguments)).renderNodeContent=function(t){return(0,S.e)(t)&&!t.destroyed?(0,b.n)("div",{class:Yr.contentNode,key:t},t.render()):t instanceof HTMLElement?(0,b.n)("div",{class:Yr.contentNode,key:t,bind:t,afterCreate:e._attachToNode}):(0,S.t)(t)?(0,b.n)("div",{class:Yr.contentNode,key:t,bind:t.domNode,afterCreate:e._attachToNode}):null},e}return(0,u.Z)(n,[{key:"_attachToNode",value:function(e){e.appendChild(this)}}]),n}(e);return t=(0,v.e)([(0,v.n)("esri.widgets.Feature.ContentMixin")],t)},Jr={title:!0,content:!0,lastEditedInfo:!0},ei="relationship-handles",ti=Kr=function(e){(0,c.Z)(r,e);var t=(0,d.Z)(r);function r(e,n){var i;return(0,l.Z)(this,r),(i=t.call(this,e,n))._contentWidgets=[],i.flowItems=null,i.headingLevel=2,i.messages=null,i.messagesCommon=null,i.messagesURIUtils=null,i.visibleElements=(0,p.Z)({},Jr),i.viewModel=new $r,i}return(0,u.Z)(r,[{key:"initialize",value:function(){var e=this;this.addHandles((0,m.l)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.contentViewModels}),(function(){return e._setupContentWidgets()}),m.h))}},{key:"loadDependencies",value:function(){return n.e(3678).then(n.bind(n,43678))}},{key:"destroy",value:function(){this._destroyContentWidgets()}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(e){this.viewModel.graphic=e}},{key:"defaultPopupTemplateEnabled",get:function(){return this.viewModel.defaultPopupTemplateEnabled},set:function(e){this.viewModel.defaultPopupTemplateEnabled=e}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"spatialReference",get:function(){return this.viewModel.spatialReference},set:function(e){this.viewModel.spatialReference=e}},{key:"title",get:function(){return this.viewModel.title}},{key:"castVisibleElements",value:function(e){return(0,p.Z)((0,p.Z)({},Jr),e)}},{key:"map",get:function(){return this.viewModel.map},set:function(e){this.viewModel.map=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"render",value:function(){var e=this.viewModel.state,t=(0,b.n)("div",{class:Yr.container,key:"container"},this.renderTitle(),"error"===e?this.renderError():"loading"===e?this.renderLoading():this.renderContentContainer());return(0,b.n)("div",{class:this.classes(Yr.base,Yr.esriWidget)},t)}},{key:"setActiveMedia",value:function(e,t){return this.viewModel.setActiveMedia(e,t)}},{key:"nextMedia",value:function(e){return this.viewModel.nextMedia(e)}},{key:"previousMedia",value:function(e){return this.viewModel.previousMedia(e)}},{key:"renderError",value:function(){var e=this.messagesCommon,t=this.messages,n=this.visibleElements;return(0,b.n)("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},n.title?(0,b.n)("div",{key:"error-title",slot:"title"},e.errorMessage):null,(0,b.n)("div",{key:"error-message",slot:"message"},t.loadingError))}},{key:"renderLoading",value:function(){return(0,b.n)("div",{key:"loading-container",class:Yr.loadingSpinnerContainer},(0,b.n)("span",{class:this.classes(Yr.iconLoading,Yr.spinner)}))}},{key:"renderContentContainer",value:function(){return this.visibleElements.content?(0,b.n)("div",{class:Yr.main},[this.renderContent(),this.renderLastEditInfo()]):null}},{key:"renderTitle",value:function(){var e=this.visibleElements,t=this.title;return e.title?(0,b.n)(T.n,{level:this.headingLevel,class:Yr.title,innerHTML:t}):null}},{key:"renderContent",value:function(){var e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?(0,b.n)("div",{class:Yr.contentNode,key:"".concat(t,"-content-elements")},e.map(this.renderContentElement,this)):null;if("string"==typeof e){var n=this._contentWidgets[0];return!n||n.destroyed?null:(0,b.n)("div",{class:Yr.contentNode,key:"".concat(t,"-content")},n.render())}return this.renderNodeContent(e)}},{key:"renderContentElement",value:function(e,t){var n=this.visibleElements;if("boolean"!=typeof n.content&&!n.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);case"relationship":return this.renderRelationship(t);default:return null}}},{key:"renderAttachments",value:function(e){var t=this._contentWidgets[e];if(!t||t.destroyed)return null;var n=t.viewModel,r=n.state,i=n.attachmentInfos;return"loading"===r||i.length>0?(0,b.n)("div",{key:this._buildKey("attachments-element",e),class:this.classes(Yr.contentElement)},t.render()):null}},{key:"renderRelationship",value:function(e){var t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?(0,b.n)("div",{key:this._buildKey("relationship-element",e),class:Yr.contentElement},t.render()):null}},{key:"renderExpression",value:function(e){var t=this._contentWidgets[e];return!t||t.destroyed?null:(0,b.n)("div",{key:this._buildKey("expression-element",e),class:Yr.contentElement},t.render())}},{key:"renderCustom",value:function(e,t){var n=e.creator,r=this._contentWidgets[t];return!r||r.destroyed?null:n?(0,b.n)("div",{key:this._buildKey("custom-element",t),class:Yr.contentElement},r.render()):null}},{key:"renderFields",value:function(e){var t=this._contentWidgets[e];return!t||t.destroyed?null:(0,b.n)("div",{key:this._buildKey("fields-element",e),class:Yr.contentElement},t.render())}},{key:"renderMedia",value:function(e){var t=this._contentWidgets[e];return!t||t.destroyed?null:(0,b.n)("div",{key:this._buildKey("media-element",e),class:Yr.contentElement},t.render())}},{key:"renderLastEditInfo",value:function(){var e=this.visibleElements,t=this.messages,n=this.viewModel.lastEditInfo;if(!n||!e.lastEditedInfo)return null;var r=n.date,i=n.user,a="edit"===n.type?i?t.lastEditedByUser:t.lastEdited:i?t.lastCreatedByUser:t.lastCreated,o=(0,y.s)(a,{date:r,user:i});return(0,b.n)("div",{key:"edit-info-element",class:this.classes(Yr.lastEditedInfo,Yr.contentElement)},o)}},{key:"renderText",value:function(e,t){var n=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:n?(0,b.n)("div",{key:this._buildKey("text-element",t),class:this.classes(Yr.contentElement,Yr.text)},r.render()):null}},{key:"_buildKey",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"".concat(e,"__").concat(this.get("viewModel.graphic.uid")||"0","-").concat(n.join("-"))}},{key:"_destroyContentWidget",value:function(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}},{key:"_destroyContentWidgets",value:function(){var e=this;this.removeHandles(ei),this._contentWidgets.forEach((function(t){return e._destroyContentWidget(t)})),this._contentWidgets=[]}},{key:"_addFeatureRelationshipHandles",value:function(e){var t=this,n=this.flowItems,r=this.visibleElements;this.addHandles([(0,m.a)((function(){return e}),"select-record",(function(e){var t=e.featureViewModel;n&&(t.abilities={relationshipContent:!0},n.push(new Kr({flowItems:n,viewModel:t,visibleElements:r})))})),(0,m.a)((function(){return e}),"show-all-records",(function(){if(n){var r=e.viewModel;r.showAllEnabled=!0;var i=new Ur({visibleElements:{title:!1,description:!1},viewModel:r});t._addFeatureRelationshipHandles(i),n.push(i)}}))],ei)}},{key:"_setupContentWidgets",value:function(){var e=this;this._destroyContentWidgets();var t=this.headingLevel,n=this.visibleElements,r=this.get("viewModel.content"),i=this.viewModel.contentViewModels;if(Array.isArray(r))r.forEach((function(r,a){if("attachments"===r.type&&(e._contentWidgets[a]=new Gt({displayType:r.displayType,headingLevel:n.title?t+1:t,viewModel:i[a]})),"fields"===r.type&&(e._contentWidgets[a]=new fn({viewModel:i[a]})),"media"===r.type&&(e._contentWidgets[a]=new lr({viewModel:i[a]})),"text"===r.type&&(e._contentWidgets[a]=new en({viewModel:i[a]})),"custom"===r.type&&(e._contentWidgets[a]=new en({viewModel:i[a]})),"expression"===r.type&&(e._contentWidgets[a]=new Cr({viewModel:i[a]})),"relationship"===r.type){var o=new Ur({viewModel:i[a]});e._addFeatureRelationshipHandles(o),e._contentWidgets[a]=o}}),this);else{var a=i[0];a&&!a.destroyed&&(this._contentWidgets[0]=new en({viewModel:a}))}this.scheduleRender()}}]),r}(Xr(b.M));(0,v.e)([(0,v.y)()],ti.prototype,"graphic",null),(0,v.e)([(0,v.y)()],ti.prototype,"defaultPopupTemplateEnabled",null),(0,v.e)([(0,v.y)()],ti.prototype,"flowItems",void 0),(0,v.e)([(0,v.y)()],ti.prototype,"headingLevel",void 0),(0,v.e)([(0,v.y)()],ti.prototype,"label",null),(0,v.e)([(0,v.y)(),(0,b.e)("esri/widgets/Feature/t9n/Feature")],ti.prototype,"messages",void 0),(0,v.e)([(0,v.y)(),(0,b.e)("esri/t9n/common")],ti.prototype,"messagesCommon",void 0),(0,v.e)([(0,v.y)(),(0,b.e)("esri/widgets/support/t9n/uriUtils")],ti.prototype,"messagesURIUtils",void 0),(0,v.e)([(0,v.y)()],ti.prototype,"spatialReference",null),(0,v.e)([(0,v.y)({readOnly:!0})],ti.prototype,"title",null),(0,v.e)([(0,v.y)()],ti.prototype,"visibleElements",void 0),(0,v.e)([(0,v.c)("visibleElements")],ti.prototype,"castVisibleElements",null),(0,v.e)([(0,v.y)()],ti.prototype,"map",null),(0,v.e)([(0,v.y)()],ti.prototype,"view",null),(0,v.e)([(0,v.y)({type:$r})],ti.prototype,"viewModel",void 0);var ni=ti=Kr=(0,v.e)([(0,v.n)("esri.widgets.Feature")],ti),ri=Object.freeze({__proto__:null,default:ni})},61416:function(e,t,n){n.d(t,{p:function(){return p}});var r=n(43144),i=n(15671),a=n(60136),o=n(29388),s=n(48848),l=n(62610),u=n(40558),c=n(40114),d=(n(93661),new u.s({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"})),f=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).name=null,r.description=null,r.drawingTool=null,r.prototype=null,r.thumbnail=null,r}return(0,r.Z)(n)}((0,l.i)(c.l));(0,s.e)([(0,s.y)({json:{write:!0}})],f.prototype,"name",void 0),(0,s.e)([(0,s.y)({json:{write:!0}})],f.prototype,"description",void 0),(0,s.e)([(0,s.y)({json:{read:d.read,write:d.write}})],f.prototype,"drawingTool",void 0),(0,s.e)([(0,s.y)({json:{write:!0}})],f.prototype,"prototype",void 0),(0,s.e)([(0,s.y)({json:{write:!0}})],f.prototype,"thumbnail",void 0);var p=f=(0,s.e)([(0,s.n)("esri.layers.support.FeatureTemplate")],f)},77880:function(e,t,n){n.d(t,{n:function(){return h}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(48848),l=n(62610),u=n(40114),c=(n(93661),n(82474)),d=n(69641),f=n(61416),p=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).id=null,i.name=null,i.domains=null,i.templates=null,i}return(0,i.Z)(n,[{key:"readDomains",value:function(e){for(var t={},n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];t[i]=(0,d.t)(e[i])}return t}},{key:"writeDomains",value:function(e,t){for(var n={},r=0,i=Object.keys(e);r<i.length;r++){var a,o=i[r];e[o]&&(n[o]=null===(a=e[o])||void 0===a?void 0:a.toJSON())}t.domains=n}}]),n}((0,l.i)(u.l));(0,s.e)([(0,s.y)({json:{write:!0}})],p.prototype,"id",void 0),(0,s.e)([(0,s.y)({json:{write:!0}})],p.prototype,"name",void 0),(0,s.e)([(0,s.y)({json:{write:!0}})],p.prototype,"domains",void 0),(0,s.e)([(0,c.o)("domains")],p.prototype,"readDomains",null),(0,s.e)([(0,c.r)("domains")],p.prototype,"writeDomains",null),(0,s.e)([(0,s.y)({type:[f.p],json:{write:!0}})],p.prototype,"templates",void 0);var h=p=(0,s.e)([(0,s.n)("esri.layers.support.FeatureType")],p)},69641:function(e,t,n){n.d(t,{n:function(){return Z},p:function(){return v},t:function(){return E},u:function(){return k},y:function(){return S}});var r,i=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(48848),u=n(40558),c=n(40114),d=n(93661),f=n(20302),p=n(82474),h=n(15436),v=r=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).name=null,r.code=null,r}return(0,a.Z)(n,[{key:"clone",value:function(){return new r({name:this.name,code:this.code})}}]),n}(c.l);(0,l.e)([(0,l.y)({type:String,json:{write:!0}})],v.prototype,"name",void 0),(0,l.e)([(0,l.y)({type:[String,Number],json:{write:!0}})],v.prototype,"code",void 0),v=r=(0,l.e)([(0,l.n)("esri.layers.support.CodedValue")],v);var y=new u.s({inherited:"inherited",codedValue:"coded-value",range:"range"}),m=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).name=null,r.type=null,r}return(0,a.Z)(n)}(c.l);(0,l.e)([(0,l.y)({type:String,json:{write:!0}})],m.prototype,"name",void 0),(0,l.e)([(0,f.r)(y)],m.prototype,"type",void 0);var g,b=m=(0,l.e)([(0,l.n)("esri.layers.support.Domain")],m),_=g=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).codedValues=null,r.type="coded-value",r}return(0,a.Z)(n,[{key:"getName",value:function(e){var t=null;if(this.codedValues){var n=String(e);this.codedValues.some((function(e){return String(e.code)===n&&(t=e.name),!!t}))}return t}},{key:"clone",value:function(){return new g({codedValues:(0,d.y)(this.codedValues),name:this.name})}}]),n}(b);(0,l.e)([(0,l.y)({type:[v],json:{write:!0}})],_.prototype,"codedValues",void 0),(0,l.e)([(0,f.r)({codedValue:"coded-value"})],_.prototype,"type",void 0);var w,k=_=g=(0,l.e)([(0,l.n)("esri.layers.support.CodedValueDomain")],_),I=w=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).type="inherited",r}return(0,a.Z)(n,[{key:"clone",value:function(){return new w}}]),n}(b);(0,l.e)([(0,f.r)({inherited:"inherited"})],I.prototype,"type",void 0);var M,F=I=w=(0,l.e)([(0,l.n)("esri.layers.support.InheritedDomain")],I),x=M=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).maxValue=null,r.minValue=null,r.type="range",r}return(0,a.Z)(n,[{key:"clone",value:function(){return new M({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}}]),n}(b);(0,l.e)([(0,l.y)({type:Number,json:{type:[Number],read:{source:"range",reader:function(e,t){return t.range&&t.range[1]}},write:{enabled:!1,overridePolicy:function(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer:function(e,t,n){t[n]=[this.minValue||0,e]}}}})],x.prototype,"maxValue",void 0),(0,l.e)([(0,l.y)({type:Number,json:{type:[Number],read:{source:"range",reader:function(e,t){return t.range&&t.range[0]}},write:{target:"range",writer:function(e,t,n){t[n]=[e,this.maxValue||0]}}}})],x.prototype,"minValue",void 0),(0,l.e)([(0,f.r)({range:"range"})],x.prototype,"type",void 0);var A,C=x=M=(0,l.e)([(0,l.n)("esri.layers.support.RangeDomain")],x),Z={key:"type",base:b,typeMap:{range:C,"coded-value":k,inherited:F}};function E(e){if(!e||!e.type)return null;switch(e.type){case"range":return C.fromJSON(e);case"codedValue":return k.fromJSON(e);case"inherited":return F.fromJSON(e)}return null}var T=new u.s({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"}),L=A=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).alias=null,r.defaultValue=void 0,r.description=null,r.domain=null,r.editable=!0,r.length=-1,r.name=null,r.nullable=!0,r.type=null,r.valueType=null,r.visible=!0,r}return(0,a.Z)(n,[{key:"readDescription",value:function(e,t){var n,r,i=t.description,a=null;try{a=i?JSON.parse(i):null}catch(o){}return null!==(n=null===(r=a)||void 0===r?void 0:r.value)&&void 0!==n?n:null}},{key:"readValueType",value:function(e,t){var n=t.description,r=null;try{r=n?JSON.parse(n):null}catch(i){}return r?T.fromJSON(r.fieldValueType):null}},{key:"clone",value:function(){return new A({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}}]),n}(c.l);(0,l.e)([(0,l.y)({type:String,json:{write:!0}})],L.prototype,"alias",void 0),(0,l.e)([(0,l.y)({type:[String,Number],json:{write:{allowNull:!0}}})],L.prototype,"defaultValue",void 0),(0,l.e)([(0,l.y)()],L.prototype,"description",void 0),(0,l.e)([(0,p.o)("description")],L.prototype,"readDescription",null),(0,l.e)([(0,l.y)({types:Z,json:{read:{reader:E},write:!0}})],L.prototype,"domain",void 0),(0,l.e)([(0,l.y)({type:Boolean,json:{write:!0}})],L.prototype,"editable",void 0),(0,l.e)([(0,l.y)({type:l.T,json:{write:!0}})],L.prototype,"length",void 0),(0,l.e)([(0,l.y)({type:String,json:{write:!0}})],L.prototype,"name",void 0),(0,l.e)([(0,l.y)({type:Boolean,json:{write:!0}})],L.prototype,"nullable",void 0),(0,l.e)([(0,f.r)(h.i)],L.prototype,"type",void 0),(0,l.e)([(0,l.y)()],L.prototype,"valueType",void 0),(0,l.e)([(0,p.o)("valueType",["description"])],L.prototype,"readValueType",null),(0,l.e)([(0,l.y)({type:Boolean,json:{read:!1}})],L.prototype,"visible",void 0);var S=L=A=(0,l.e)([(0,l.n)("esri.layers.support.Field")],L)},630:function(e,t,n){n.d(t,{a:function(){return f},c:function(){return c},d:function(){return p}});var r=n(15671),i=n(43144),a=n(60136),o=n(29388),s=n(48848),l=n(93661),u=n(50690),c=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,r.Z)(this,n),(e=t.apply(this,arguments)).updating=!1,e._handleId=0,e._handles=new s.X,e._scheduleHandleId=0,e._pendingPromises=new Set,e}return(0,i.Z)(n,[{key:"destroy",value:function(){this.removeAll(),this._handles.destroy()}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,n,u.l)}},{key:"addWhen",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._installWatch(e,t,n,u.f)}},{key:"addOnCollectionChange",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.initial,a=void 0!==i&&i,o=r.final,s=void 0!==o&&o,l=++this._handleId;return this._handles.add([(0,u.a)(e,"after-changes",this._createSyncUpdatingCallback(),u.U),(0,u.a)(e,"change",t,{onListenerAdd:a?function(e){return t({added:e.toArray(),removed:[]})}:void 0,onListenerRemove:s?function(e){return t({added:[],removed:e.toArray()})}:void 0})],l),{remove:function(){return n._handles.remove(l)}}}},{key:"addPromise",value:function(e){var t=this;if((0,l.t)(e))return e;var n=++this._handleId;this._handles.add({remove:function(){t._pendingPromises.delete(e)&&(0!==t._pendingPromises.size||t._handles.has(d)||t._set("updating",!1))}},n),this._pendingPromises.add(e),this._set("updating",!0);var r=function(){return t._handles.remove(n)};return e.then(r,r),e}},{key:"removeAll",value:function(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}},{key:"_installWatch",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,a=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,a);var o=i(e,t,r);return this._handles.add(o,a),{remove:function(){return n._handles.remove(a)}}}},{key:"_installSyncUpdatingWatch",value:function(e,t){var n=this._createSyncUpdatingCallback(),r=(0,u.l)(e,n,{sync:!0,equals:function(){return!1}});return this._handles.add(r,t),r}},{key:"_createSyncUpdatingCallback",value:function(){var e=this;return function(){e._handles.remove(d),++e._scheduleHandleId;var t=e._scheduleHandleId;e._get("updating")||e._set("updating",!0),e._handles.add((0,s.k)((function(){t===e._scheduleHandleId&&(e._set("updating",e._pendingPromises.size>0),e._handles.remove(d))})),d)}}}]),n}(s.m);(0,s.e)([(0,s.y)({readOnly:!0})],c.prototype,"updating",void 0),c=(0,s.e)([(0,s.n)("esri.core.support.WatchUpdatingTracking")],c);var d=-42,f=function(e){var t=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"destroy",value:function(){var e,t;this.destroyed||(null!==(e=this._get("handles"))&&void 0!==e&&e.destroy(),null===(t=this._get("updatingHandles"))||void 0===t||t.destroy())}},{key:"handles",get:function(){return this._get("handles")||new s.X}},{key:"updatingHandles",get:function(){return this._get("updatingHandles")||new c}}]),n}(e);return(0,s.e)([(0,s.y)({readOnly:!0})],t.prototype,"handles",null),(0,s.e)([(0,s.y)({readOnly:!0})],t.prototype,"updatingHandles",null),t=(0,s.e)([(0,s.n)("esri.core.HandleOwner")],t),t},p=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n)}(f(s.m));p=(0,s.e)([(0,s.n)("esri.core.HandleOwner")],p)},74797:function(e,t,n){n.d(t,{p:function(){return f}});var r,i=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(48848),u=n(93314),c=n(40114),d=(n(93661),r=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).floorField=null,r.viewAllMode=!1,r.viewAllLevelIds=new u.j,r}return(0,a.Z)(n,[{key:"clone",value:function(){return new r({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}}]),n}(c.l));(0,l.e)([(0,l.y)({type:String,json:{write:!0}})],d.prototype,"floorField",void 0),(0,l.e)([(0,l.y)({json:{read:!1,write:!1}})],d.prototype,"viewAllMode",void 0),(0,l.e)([(0,l.y)({json:{read:!1,write:!1}})],d.prototype,"viewAllLevelIds",void 0);var f=d=r=(0,l.e)([(0,l.n)("esri.layers.support.LayerFloorInfo")],d)},1685:function(e,t,n){n.d(t,{I:function(){return w},L:function(){return b},S:function(){return g},b:function(){return _},d:function(){return f},g:function(){return m},h:function(){return v},j:function(){return k},m:function(){return p},w:function(){return h},y:function(){return y}});var r=n(29439),i=n(93661),a=n(40558),o=n(46337),s={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},l=Object.values(s),u=new RegExp("^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(".concat(l.join("|"),"))(?:\\/(?:layers\\/)?(\\d+))?"),"i"),c=new RegExp("^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(".concat(l.join("|"),"))(?:\\/(?:layers\\/)?(\\d+))?"),"i"),d=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function f(e){return!!u.test(e)}function p(e){if((0,i.t)(e))return null;var t=(0,a.j)(e),n=t.path.match(u)||t.path.match(c);if(!n)return null;var o=(0,r.Z)(n,5),l=o[1],d=o[2],f=o[3],p=o[4],h=d.indexOf("/");return{title:v(-1!==h?d.slice(h+1):d),serverType:s[f.toLowerCase()],sublayer:null!=p&&""!==p?parseInt(p,10):null,url:{path:l}}}function h(e){var t=(0,a.j)(e).path.match(d);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function v(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function y(e,t){var n=[];if(e){var r=p(e);(0,i.r)(r)&&r.title&&n.push(r.title)}if(t){var a=v(t);n.push(a)}if(2===n.length){if(n[0].toLowerCase().includes(n[1].toLowerCase()))return n[0];if(n[1].toLowerCase().includes(n[0].toLowerCase()))return n[1]}return n.join(" - ")}function m(e){if(!e)return!1;var t=(e=e.toLowerCase()).includes(".arcgis.com/"),n=e.includes("//services")||e.includes("//tiles")||e.includes("//features");return t&&n}function g(e,t){return e?(0,a.C)((0,a.A)(e,t)):e}function b(e){var t=e.url;if(!t)return{url:t};t=(0,a.A)(t,e.logger);var n,r=(0,a.j)(t),o=p(r.path);if((0,i.r)(o))null!=o.sublayer&&null==e.layer.layerId&&(n=o.sublayer),t=o.url.path;else if(e.nonStandardUrlAllowed){var s=h(r.path);(0,i.r)(s)&&(t=s.serviceUrl,n=s.sublayerId)}return{url:(0,a.C)(t),layerId:n}}function _(e,t,n,r,i){(0,o.f)(t,r,"url",i),r.url&&null!=e.layerId&&(r.url=(0,a.G)(r.url,n,e.layerId.toString()))}function w(e){if(!e)return!1;var t=e.toLowerCase(),n=t.includes("/services/"),r=t.includes("/mapserver/wmsserver"),i=t.includes("/imageserver/wmsserver"),a=t.includes("/wmsserver");return n&&(r||i||a)}function k(e){var t;if(!e)return!1;var n=null===(t=new a.y((0,a.Q)(e)).authority)||void 0===t?void 0:t.toLowerCase();return"server.arcgisonline.com"===n||"services.arcgisonline.com"===n}},43955:function(e,t,n){function r(e){return 32+e.length}function i(e){return 16}function a(e){if(!e)return 0;var t=c;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];switch(typeof i){case"string":t+=r(i);break;case"number":t+=16;break;case"boolean":t+=4}}return t}function o(e){if(!e)return 0;if(Array.isArray(e))return function(e){var t=e.length;if(0===t||"number"==typeof e[0])return 32+8*t;for(var n=d,r=0;r<t;r++)n+=s(e[r]);return n}(e);var t=c;for(var n in e)e.hasOwnProperty(n)&&(t+=s(e[n]));return t}function s(e){switch(typeof e){case"object":return o(e);case"string":return r(e);case"number":return 16;case"boolean":return 4;default:return 8}}function l(e,t){return d+e.length*t}n.d(t,{c:function(){return l},e:function(){return o},n:function(){return r},r:function(){return i},s:function(){return u},t:function(){return a}});var u,c=32,d=32;!function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(u||(u={}))},64854:function(e,t,n){n.d(t,{S:function(){return s},e:function(){return r},i:function(){return i},l:function(){return a},o:function(){return o},r:function(){return u},s:function(){return c},t:function(){return l},y:function(){return d}});var r=[252,146,31,255],i=[153,153,153,255],a={type:"esriSMS",style:"esriSMSCircle",size:6,color:r,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},o={type:"esriSLS",style:"esriSLSSolid",width:.75,color:r},s={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},u={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},c={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},d={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},19941:function(e,t,n){n.d(t,{a:function(){return _},b:function(){return I},s:function(){return w}});var r,i=n(1413),a=n(74165),o=n(15861),s=n(15671),l=n(43144),u=n(60136),c=n(29388),d=n(48848),f=n(40114),p=(n(93661),n(39994)),h=n(49871),v=n(68781),y=n(35237);function m(e){var t=e.exifInfo,n=e.exifName,r=e.tagName;if(!t||!n||!r)return null;var i=t.find((function(e){return e.name===n}));return i?function(e){var t=e.tagName,n=e.tags;if(!n||!t)return null;var r=n.find((function(e){return e.name===t}));return r&&r.value||null}({tagName:r,tags:i.tags}):null}var g={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}},b=r=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e)).contentType=null,r.exifInfo=null,r.id=null,r.globalId=null,r.keywords=null,r.name=null,r.parentGlobalId=null,r.parentObjectId=null,r.size=null,r.url=null,r}return(0,l.Z)(n,[{key:"orientationInfo",get:function(){var e=m({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:this.exifInfo});return g[e]||null}},{key:"clone",value:function(){return new r({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}}]),n}(f.l);(0,d.e)([(0,d.y)({type:String})],b.prototype,"contentType",void 0),(0,d.e)([(0,d.y)()],b.prototype,"exifInfo",void 0),(0,d.e)([(0,d.y)({readOnly:!0})],b.prototype,"orientationInfo",null),(0,d.e)([(0,d.y)({type:d.T})],b.prototype,"id",void 0),(0,d.e)([(0,d.y)({type:String})],b.prototype,"globalId",void 0),(0,d.e)([(0,d.y)({type:String})],b.prototype,"keywords",void 0),(0,d.e)([(0,d.y)({type:String})],b.prototype,"name",void 0),(0,d.e)([(0,d.y)({json:{read:!1}})],b.prototype,"parentGlobalId",void 0),(0,d.e)([(0,d.y)({json:{read:!1}})],b.prototype,"parentObjectId",void 0),(0,d.e)([(0,d.y)({type:d.T})],b.prototype,"size",void 0),(0,d.e)([(0,d.y)({json:{read:!1}})],b.prototype,"url",void 0);var _=b=r=(0,d.e)([(0,d.n)("esri.layers.support.AttachmentInfo")],b);function w(e,t,n){return k.apply(this,arguments)}function k(){return k=(0,o.Z)((0,a.Z)().mark((function e(t,n,r){var i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I(t,n,r);case 2:return i=e.sent,e.abrupt("return",v.default.fromJSON(i));case 4:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function I(e,t,n){return M.apply(this,arguments)}function M(){return M=(0,o.Z)((0,a.Z)().mark((function e(t,n,r){var o,s,l,u,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(0,p.f)(t),s=(0,i.Z)({},r),l=y.x.from(n),e.next=5,(0,h.c)(o,l,l.sourceSpatialReference,s);case 5:return u=e.sent,c=u.data,e.abrupt("return",c);case 8:case"end":return e.stop()}}),e)}))),M.apply(this,arguments)}},15436:function(e,t,n){n.d(t,{i:function(){return r}});var r=new(n(40558).s)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})},51816:function(e,t,n){n.d(t,{r:function(){return o}});var r=n(37762),i=n(93661),a=n(65415);function o(e,t,n){if(n&&n.features&&n.hasZ){var o=(0,a.o)(n.geometryType,t,e.outSpatialReference);if(!(0,i.t)(o)){var s,l=(0,r.Z)(n.features);try{for(l.s();!(s=l.n()).done;){o(s.value.geometry)}}catch(u){l.e(u)}finally{l.f()}}}}},90429:function(e,t,n){n.d(t,{e:function(){return r},t:function(){return i}});n(42467);function r(e){return e&&"function"==typeof e.render}function i(e){return e&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}},65415:function(e,t,n){n.d(t,{o:function(){return s}});var r=n(37762),i=n(93661),a=n(47855),o=n(82474);function s(e,t,n){if((0,i.t)(t)||(0,i.t)(n)||n.vcsWkid||(0,o.E)(t,n))return null;var s=(0,a.L)(t)/(0,a.L)(n);if(1===s)return null;switch(e){case"point":case"esriGeometryPoint":return function(e){return function(e,t){e&&null!=e.z&&(e.z*=t)}(e,s)};case"polyline":case"esriGeometryPolyline":return function(e){return function(e,t){if(e){var n,i=(0,r.Z)(e.paths);try{for(i.s();!(n=i.n()).done;){var a,o=n.value,s=(0,r.Z)(o);try{for(s.s();!(a=s.n()).done;){var l=a.value;l.length>2&&(l[2]*=t)}}catch(u){s.e(u)}finally{s.f()}}}catch(u){i.e(u)}finally{i.f()}}}(e,s)};case"polygon":case"esriGeometryPolygon":return function(e){return function(e,t){if(e){var n,i=(0,r.Z)(e.rings);try{for(i.s();!(n=i.n()).done;){var a,o=n.value,s=(0,r.Z)(o);try{for(s.s();!(a=s.n()).done;){var l=a.value;l.length>2&&(l[2]*=t)}}catch(u){s.e(u)}finally{s.f()}}}catch(u){i.e(u)}finally{i.f()}}}(e,s)};case"multipoint":case"esriGeometryMultipoint":return function(e){return function(e,t){if(e){var n,i=(0,r.Z)(e.points);try{for(i.s();!(n=i.n()).done;){var a=n.value;a.length>2&&(a[2]*=t)}}catch(o){i.e(o)}finally{i.f()}}}(e,s)};case"extent":case"esriGeometryExtent":return function(e){return function(e,t){e&&null!=e.zmin&&null!=e.zmax&&(e.zmin*=t,e.zmax*=t)}(e,s)};default:return null}}}}]);
//# sourceMappingURL=7276.9d58b53d.chunk.js.map