"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[548],{3096:function(e,t,n){n.d(t,{h:function(){return d}});var r=n(93433),i=n(15671),a=n(43144),s=n(60136),l=n(29388),o=n(50165),u=n(36235),c=-1,d=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._from=null,r._to=null,r._final=null,r._current=[],r._time=0,r.duration=(0,o.c)("mapview-transitions-duration"),r.effects=[],r}return(0,a.Z)(n,[{key:"effect",set:function(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(f(e))}catch(t){this._transitionTo([]),o.s.getLogger(this.declaredClass).warn("Invalid Effect",{effect:e,error:t})}}}},{key:"hasEffects",get:function(){return this.transitioning||!!this.effects.length}},{key:"scale",set:function(e){this._updateForScale(e)}},{key:"transitioning",get:function(){return null!==this._to}},{key:"canTransitionTo",value:function(e){try{return this.scale>0&&y(this._current,f(e),this.scale)}catch(t){return!1}}},{key:"transitionStep",value:function(e,t){this._applyTimeTransition(e),this._updateForScale(t)}},{key:"end",value:function(){this._applyTimeTransition(this.duration)}},{key:"_transitionTo",value:function(e){this.scale>0&&y(this._current,e,this.scale)?(this._final=e,this._to=(0,o.m)(e),function(e,t,n){for(var i,a,s=e.length>t.length?e:t,l=e.length>t.length?t:e,o=l[l.length-1],d=null!==(i=null===o||void 0===o?void 0:o.scale)&&void 0!==i?i:n,f=null!==(a=null===o||void 0===o?void 0:o.effects)&&void 0!==a?a:[],y=l.length;y<s.length;y++)l.push({scale:d,effects:(0,r.Z)(f)});for(var h=0;h<s.length;h++)l[h].scale=l[h].scale===c?n:l[h].scale,s[h].scale=s[h].scale===c?n:s[h].scale,(0,u.c)(l[h].effects,s[h].effects)}(this._current,this._to,this.scale),this._from=(0,o.m)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?(0,o.m)(this._current[0].effects):[])}},{key:"_applyTimeTransition",value:function(e){if(this._to&&this._from&&this._current&&this._final){this._time+=e;for(var t=Math.min(1,this._time/this.duration),n=0;n<this._current.length;n++){var r=this._current[n],i=this._from[n],a=this._to[n];r.scale=h(i.scale,a.scale,t);for(var s=0;s<r.effects.length;s++){var l=r.effects[s],u=i.effects[s],c=a.effects[s];l.interpolate(u,c,t)}}1===t&&(this._current=this._final,this._set("effects",this._current[0]?(0,o.m)(this._current[0].effects):[]),this._from=this._to=this._final=null)}}},{key:"_updateForScale",value:function(e){if(this._set("scale",e),0!==this._current.length){var t,n,r=this._current,i=this._current.length-1,a=1;if(1===r.length||e>=r[0].scale)n=t=r[0].effects;else if(e<=r[i].scale)n=t=r[i].effects;else for(var s=0;s<i;s++){var l=r[s],o=r[s+1];if(l.scale>=e&&o.scale<=e){a=(e-l.scale)/(o.scale-l.scale),t=l.effects,n=o.effects;break}}for(var u=0;u<this.effects.length;u++)this.effects[u].interpolate(t[u],n[u],a)}}}]),n}(o.y);function f(e){var t=(0,u.d)(e)||[];return function(e){var t=e[0];return!!t&&"type"in t}(t)?[{scale:c,effects:t}]:t}function y(e,t,n){var r,i,a,s;return null===(r=e[0])||void 0===r||!r.effects||null===(i=t[0])||void 0===i||!i.effects||!(((null===(a=e[0])||void 0===a?void 0:a.scale)===c||(null===(s=t[0])||void 0===s?void 0:s.scale)===c)&&(e.length>1||t.length>1)&&n<=0)&&(0,u.b)(e[0].effects,t[0].effects)}function h(e,t,n){return e+(t-e)*n}(0,o.e)([(0,o.d)()],d.prototype,"_to",void 0),(0,o.e)([(0,o.d)()],d.prototype,"duration",void 0),(0,o.e)([(0,o.d)({value:""})],d.prototype,"effect",null),(0,o.e)([(0,o.d)({readOnly:!0})],d.prototype,"effects",void 0),(0,o.e)([(0,o.d)({readOnly:!0})],d.prototype,"hasEffects",null),(0,o.e)([(0,o.d)({value:0})],d.prototype,"scale",null),(0,o.e)([(0,o.d)({readOnly:!0})],d.prototype,"transitioning",null),d=(0,o.e)([(0,o.n)("esri.layers.effects.EffectView")],d)},34342:function(e,t,n){n.d(t,{c:function(){return p}});var r=n(1413),i=n(15671),a=n(43144),s=n(60136),l=n(29388),o=n(50165),u=n(22984),c=n(7093),d=n(63334),f=n(42814),y=n(43634),h={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},p=function(e){(0,s.Z)(n,e);var t=(0,l.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).floors=null,r.scale=0,r}return(0,a.Z)(n,[{key:"destroy",value:function(){this.layer=null}},{key:"dynamicLayers",get:function(){var e=this;if(!this.hasDynamicLayers)return null;var t=this.visibleSublayers.map((function(t){var n=(0,f.n)(e.floors,t);return t.toExportImageJSON(n)}));return t.length?JSON.stringify(t):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&(0,y.i)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}},{key:"layer",set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("sublayer-update",(function(e){return t.notifyChange(h[e.propertyName])}))],"layer"))}},{key:"layers",get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map((function(e){return e.id})).join(","):"show:-1":null}},{key:"layerDefs",get:function(){var e,t=this,n=!(null===(e=this.floors)||void 0===e||!e.length),r=this.visibleSublayers.filter((function(e){return null!=e.definitionExpression||n&&null!=e.floorInfo}));return r.length?JSON.stringify(r.reduce((function(e,n){var r=(0,f.n)(t.floors,n),i=(0,c.t)(r,n.definitionExpression);return(0,o.r)(i)&&(e[n.id]=i),e}),{})):null}},{key:"version",get:function(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");var e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){var e=this,t=[];if(!this.layer)return t;var n=this.layer.sublayers;n&&n.forEach((function n(r){var i=e.scale,a=0===i,s=0===r.minScale||i<=r.minScale,l=0===r.maxScale||i>=r.maxScale;r.visible&&(a||s&&l)&&(r.sublayers?r.sublayers.forEach(n):t.unshift(r))}));var r=this._get("visibleSublayers");return!r||r.length!==t.length||r.some((function(e,n){return t[n]!==e}))?t:r}},{key:"toJSON",value:function(){var e=this.layer,t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=(0,r.Z)((0,r.Z)({},t),{},{layers:this.layers,layerDefs:this.layerDefs}),t}}]),n}((0,u.a)(o.y));(0,o.e)([(0,o.d)({readOnly:!0})],p.prototype,"dynamicLayers",null),(0,o.e)([(0,o.d)()],p.prototype,"floors",void 0),(0,o.e)([(0,o.d)({readOnly:!0})],p.prototype,"hasDynamicLayers",null),(0,o.e)([(0,o.d)()],p.prototype,"layer",null),(0,o.e)([(0,o.d)({readOnly:!0})],p.prototype,"layers",null),(0,o.e)([(0,o.d)({readOnly:!0})],p.prototype,"layerDefs",null),(0,o.e)([(0,o.d)({type:Number})],p.prototype,"scale",void 0),(0,o.e)([(0,o.d)(d.g)],p.prototype,"timeExtent",void 0),(0,o.e)([(0,o.d)({readOnly:!0})],p.prototype,"version",null),(0,o.e)([(0,o.d)({readOnly:!0})],p.prototype,"visibleSublayers",null),p=(0,o.e)([(0,o.n)("esri.layers.mixins.ExportImageParameters")],p)},60548:function(e,t,n){n.r(t);var r=n(29439),i=n(4942),a=n(1413),s=n(37762),l=n(74165),o=n(93433),u=n(15671),c=n(43144),d=n(60136),f=n(29388),y=n(15861),h=n(50165),p=n(69738),v=n(73627),m=n(17691),g=n(73393),b=n(87110),_=n(40133),w=n(88406),L=n(13994),k=n(62980),x=n(78880),S=n(3096),I=n(36235),E=n(34342),M=n(4483),C=n(97823),V=n(8180),Z=n(49350),R=n(75366),z=n(64620),F=n(60418),A=n(50035),T=n(42),N=n(52155),O=n(4197);n(92870),n(26079),n(61772),n(72577),n(66307),n(2760),n(16377),n(79747),n(77322),n(32335),n(9887),n(42488),n(9330),n(96263),n(79146),n(3029),n(42687),n(78330),n(78697),n(61340),n(22984),n(7093),n(63334),n(83172),n(73428),n(43634),n(33530),n(31278),n(38665),n(32717),n(59075),n(39853),n(94872),n(3969),n(38419),n(84539),n(89354),n(16897),n(47642),n(89031),n(98496),n(75662),n(17493),n(78664),n(84231),n(5233),n(57439),n(22225),n(38657),n(25715);function D(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;var n=e.visualVariables.find((function(e){return"size"===e.type})),r=function(e,t){var n=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return null!==t&&void 0!==t&&t.levels?t.levels[n]:null}(t,n);return r?new Z.b({field:n.field,minSize:r[2].size,minDataValue:r[2].value,maxSize:r[3].size,maxDataValue:r[3].value}):null}var P={HH:315,HL:45,LL:135,LH:225},B={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function q(e){if(e){var t=e.type;if(t.includes("3d"))return(0,A.getSymbolLayerFill)(e.symbolLayers.getItemAt(0));if("simple-line"===t){var n=(0,R.a)(e);return n&&n.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){var r=(0,R.a)(e);return r&&r.color}return(0,R.b)(e)}}function H(e,t){var n=t.HH.label,r=t.LL.label,i=t.HL.label,a=t.LH.label;switch(e){case"HH":default:return{top:n,bottom:r,left:i,right:a};case"HL":return{top:i,bottom:a,left:r,right:n};case"LL":return{top:r,bottom:n,left:a,right:i};case"LH":return{top:a,bottom:i,left:n,right:r}}}function j(e){var t=e.focus,n=e.infos,r=e.numClasses,i=B[r],a={};n.forEach((function(e){a[e.value]={label:e.label,fill:q(e.symbol)}}));for(var s=[],l=0;l<r;l++){for(var o=[],u=0;u<r;u++){var c=a[i[l][u]];o.push(c.fill)}s.push(o)}return{type:"relationship-ramp",numClasses:r,focus:t,colors:s,labels:H(t,a),rotation:U(t)}}function U(e){var t=P[e];return e&&null==t&&(t=P.HH),t||0}var W=[255,255,255],G=[200,200,200],J=[128,128,128];function Q(e,t){var n=e.length-1;return e.map((function(e,r){return(0,F.o)(e,r,n,t)}))}function Y(e,t,n,r,i,a){return X.apply(this,arguments)}function X(){return X=(0,y.Z)((0,l.Z)().mark((function e(t,n,r,i,a,s){var o,u,c,d,f,h,p,v,m,g,b,_,w,L,k,x,S,I,E,M;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n.legendOptions,d=c&&c.customValues,e.next=4,ee(t,r);case 4:if(f=e.sent,h=!!f,p=!!d,v=null!=n.minSize&&null!=n.maxSize,m=n.stops&&n.stops.length>1,g=!!n.target,h&&(p||v||m&&!g)){e.next=12;break}return e.abrupt("return");case 12:if(b=(0,R.d)(f),_=null,w=null,L=null,!b||m){e.next=18;break}e.t0=(0,F.u)([n.minDataValue,n.maxDataValue]),e.next=24;break;case 18:if(e.t1=d,e.t1){e.next=23;break}return e.next=22,ae(n,f,i,a);case 22:e.t1=e.sent;case 23:e.t0=e.t1;case 24:if(w=e.t0,k=null===t||void 0===t?void 0:t.authoringInfo,x="univariate-color-size"===(null===k||void 0===k?void 0:k.type),S=x&&"above-and-below"===(null===k||void 0===k?void 0:k.univariateTheme),!w&&m&&(w=n.stops.map((function(e){return e.value})),_=n.stops.some((function(e){return!!e.label})),"flow"===t.type&&(w=(0,F.u)(w)),_&&(L=n.stops.map((function(e){return e.label})))),b&&(null===(o=w)||void 0===o?void 0:o.length)>2&&!S&&(w=[w[0],w[w.length-1]]),w){e.next=28;break}return e.abrupt("return",null);case 28:return x&&5!==(null===(u=w)||void 0===u?void 0:u.length)&&(w=le({minSize:w[0],maxSize:w[w.length-1]})),I=b?$(t,w):null,E=(0,R.w)(f),M=_?null:Q(w,s),e.next=32,Promise.all(w.map(function(){var e=(0,y.Z)((0,l.Z)().mark((function e(r,s){var o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!b){e.next=4;break}e.t0=I[s],e.next=7;break;case 4:return e.next=6,de(n,f,r,i,a);case 6:e.t0=e.sent;case 7:return o=e.t0,e.abrupt("return",{value:r,symbol:ye(S&&"class-breaks"===t.type?K(t,s):f,o),label:_?L[s]:M[s],size:o,outlineSize:E});case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 32:return e.abrupt("return",e.sent.reverse());case 33:case"end":return e.stop()}}),e)}))),X.apply(this,arguments)}function $(e,t){var n=null===e||void 0===e?void 0:e.authoringInfo,r="univariate-color-size"===(null===n||void 0===n?void 0:n.type),i=[12,30];if(r){var a=t[0],s=t[t.length-1];i=t.map((function(e){return 12+(e-a)/(s-a)*18}))}return r&&"below"===(null===n||void 0===n?void 0:n.univariateTheme)&&i.reverse(),i}function K(e,t){var n=e.classBreakInfos,r=n.length,i=r<2||!(t>=2)?n[0].symbol.clone():n[r-1].symbol.clone();return e.visualVariables.some((function(e){return"color"===e.type}))&&(i.type.includes("3d")?re(i):ie(i)),i}function ee(e,t){return te.apply(this,arguments)}function te(){return te=(0,y.Z)((0,l.Z)().mark((function e(t,n){var r,i,a,s,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("flow"!==t.type){e.next=2;break}return e.abrupt("return",(0,F.b)(t,n));case 2:if("pie-chart"!==t.type){e.next=4;break}return e.abrupt("return",new k.y({color:null,outline:null!==(r=t.outline)&&void 0!==r&&r.width?t.outline:new k.m}));case 4:return i=null,a=null,"simple"===t.type?i=t.symbol:"class-breaks"===t.type?(s=t.classBreakInfos,i=s&&s[0]&&s[0].symbol,a=s.length>1):"unique-value"===t.type&&(o=t.uniqueValueInfos,i=o&&o[0]&&o[0].symbol,a=o.length>1),e.abrupt("return",!i||ne(i)?null:(i=i.clone(),(n||a)&&(i.type.includes("3d")?re(i):ie(i)),i));case 7:case"end":return e.stop()}}),e)}))),te.apply(this,arguments)}function ne(e){return!!e&&((0,k.d)(e)?!!e.symbolLayers&&e.symbolLayers.some((function(e){return e&&"fill"===e.type})):e.type.includes("fill"))}function re(e){"line-3d"===e.type?e.symbolLayers.forEach((function(e){e.material={color:J}})):e.symbolLayers.forEach((function(e){"icon"!==e.type||e.resource&&e.resource.href?e.material={color:G}:(e.material={color:W},e.outline={color:J,size:1.5})}))}function ie(e){var t=(0,F.r)();if("cim"===e.type)(0,R.p)(e,new w.l(G));else if(e.type.includes("line"))e.color=J;else if(e.color=t?J:W,"simple-marker"===e.type)if(e.outline){var n,r;"#ffffff"===(null===(n=e.outline)||void 0===n||null===(r=n.color)||void 0===r?void 0:r.toHex())&&(e.outline.color=J)}else e.outline={color:J,width:1.5}}function ae(e,t,n,r){return se.apply(this,arguments)}function se(){return se=(0,y.Z)((0,l.Z)().mark((function e(t,r,i,a){var s,o,u,c,d;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(n,49350)).then((function(e){return e.i}));case 2:if(s=e.sent.getSizeRangeAtScale(t,i,a),o=s&&le(s),s||o){e.next=6;break}return e.abrupt("return");case 6:u=o.map((function(e){return oe(e,t,s)})),u=(0,F.u)(u),c=1;case 9:if(!(c<u.length-1)){e.next=17;break}return e.next=12,ue(t,r,u[c],u[c-1],i,a);case 12:(d=e.sent)&&(u[c]=d[0],o[c]=d[1]);case 14:c++,e.next=9;break;case 17:return e.abrupt("return",u);case 18:case"end":return e.stop()}}),e)}))),se.apply(this,arguments)}function le(e){for(var t=e.minSize,n=(e.maxSize-t)/4,r=[],i=0;i<5;i++)r.push(t+n*i);return r}function oe(e,t,n){var r=n.minSize,i=n.maxSize,a=t.minDataValue,s=t.maxDataValue;return e<=r?a:e>=i?s:(e-r)/(i-r)*(s-a)+a}function ue(e,t,n,r,i,a){return ce.apply(this,arguments)}function ce(){return ce=(0,y.Z)((0,l.Z)().mark((function e(t,n,i,a,s,o){var u,c,d,f,y,h,p,v,m,g,b,_,w,L,k,x,S,I,E,M,C,V,Z;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,de(t,n,i,s,o);case 2:return u=e.sent,e.next=5,de(t,n,a,s,o);case 5:c=e.sent,d=(0,F.i)(i),f=d.fractional,y=20,h=d.integer,p=null,v=null,i>0&&i<1&&(p=Math.pow(10,f),h=(0,F.i)(i*=p).integer),m=h-1;case 12:if(!(m>=0)){e.next=38;break}return g=Math.pow(10,m),b=Math.floor(i/g)*g,_=Math.ceil(i/g)*g,null!=p&&(b/=p,_/=p),w=(b+_)/2,L=(0,F.u)([b,w,_],{indexes:[1]}),k=(0,r.Z)(L,2),w=k[1],e.next=22,de(t,n,b,s,o);case 22:return x=e.sent,e.next=25,de(t,n,_,s,o);case 25:return S=e.sent,e.next=28,de(t,n,w,s,o);case 28:if(I=e.sent,E=(0,F.l)(u,x,c,null),M=(0,F.l)(u,S,c,null),C=(0,F.l)(u,I,c,null),V=E.previous<=y,Z=M.previous<=y,V&&Z&&(E.previous<=M.previous?(V=!0,Z=!1):(Z=!0,V=!1)),V?v=[b,x]:Z?v=[_,S]:C.previous<=y&&(v=[w,I]),!v){e.next=35;break}return e.abrupt("break",38);case 35:m--,e.next=12;break;case 38:return e.abrupt("return",v);case 39:case"end":return e.stop()}}),e)}))),ce.apply(this,arguments)}function de(e,t,n,r,i){return fe.apply(this,arguments)}function fe(){return fe=(0,y.Z)((0,l.Z)().mark((function e(t,r,i,a,s){var o,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(n,49350)).then((function(e){return e.i}));case 2:return o=e.sent,u=o.getSize,e.abrupt("return",u(t,i,{scale:a,view:s,shape:"simple-marker"===r.type?r.style:null}));case 5:case"end":return e.stop()}}),e)}))),fe.apply(this,arguments)}function ye(e,t){var n=e.clone();if((0,k.d)(n))(0,R.d)(n)||n.symbolLayers.forEach((function(e){"fill"!==e.type&&(e.size=t)}));else if(function(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(n))n.size=t;else if(function(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(n)){var r=n.width,i=n.height;n.height=t,n.width=t*(r/i)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(n)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(n)&&n.font&&(n.font.size=t):n.width=t;return n}function he(e){var t=Math.floor(Math.log10(Math.abs(e)))+1,n=t<4||t>6?4:t,r=Math.abs(e)>=1e6?"compact":"standard";return(0,T.m)(e,{notation:r,minimumSignificantDigits:2,maximumSignificantDigits:n})}var pe=h.s.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),ve=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,me=new L.s({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),ge={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},be=new k.y({size:6,outline:{color:[128,128,128,.5],width:.5}}),_e=new k.S({style:"solid"});function we(e){return"flow"===e.type}function Le(e){return"vector-field"===e.type}function ke(e){return"raster-colormap"===e.type}function xe(e){return"raster-stretch"===e.type}function Se(e){return"raster-shaded-relief"===e.type}function Ie(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function Ee(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function Me(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function Ce(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function Ve(e){return Ze(e)||Re(e)||ze(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}function Ze(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function Re(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function ze(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function Fe(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function Ae(e){return"esri.renderers.PieChartRenderer"===e.declaredClass}function Te(e,t){return Ie(e)||Ee(e)||Me(e)||Ce(e)||Fe(e)||Ae(e)?"2d"===t.type||(0,V.o)(e):xe(e)||ke(e)||Se(e)||Ze(e)||Re(e)||ze(e)||Le(e)||we(e)}function Ne(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}function Oe(e){return"esri.layers.VoxelLayer"===e.declaredClass}function De(e){return"esri.layers.WMSLayer"===e.declaredClass}function Pe(e){return"esri.layers.WMTSLayer"===e.declaredClass}function Be(e){return"esri.layers.MapImageLayer"===e.declaredClass}function qe(e){return"esri.layers.TileLayer"===e.declaredClass}function He(e){return"esri.layers.FeatureLayer"===e.declaredClass}function je(e){return"esri.layers.ImageryLayer"===e.declaredClass}function Ue(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}function We(e){return"esri.layers.WCSLayer"===e.declaredClass}function Ge(e){return"stretch-ramp"===e.type}function Je(e){var t;return"univariate-color-size"===(null===(t="authoringInfo"in e&&(null===e||void 0===e?void 0:e.authoringInfo))||void 0===t?void 0:t.type)}function Qe(e){var t="authoringInfo"in e&&(null===e||void 0===e?void 0:e.authoringInfo);return"univariate-color-size"===(null===t||void 0===t?void 0:t.type)&&"above-and-below"===(null===t||void 0===t?void 0:t.univariateTheme)}var Ye=new k.y({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}}),Xe={},$e=function(e){(0,d.Z)(r,e);var t=(0,f.Z)(r);function r(e){var n;return(0,u.Z)(this,r),(n=t.call(this,e))._handles=new p.u,n._hasColorRamp=!1,n._hasOpacityRamp=!1,n._hasSizeRamp=!1,n._webStyleSymbolCache=new Map,n._dotDensityUrlCache=new Map,n._scaleDrivenSizeVariable=null,n._hasClusterSizeVariable=!1,n.children=new _.j,n.layerView=null,n.layer=null,n.legendElements=[],n.parent=null,n.hideLayersNotInCurrentView=!1,n.keepCacheOnDestroy=!1,n.respectLayerVisibility=!0,n.sublayerIds=[],n.title=null,n.view=null,n}return(0,c.Z)(r,[{key:"initialize",value:function(){var e=this,t=function(){return e.notifyChange("ready")};this._handles.add([(0,v.a)((function(){return e.children}),"change",(function(n){var r=n.added,i=n.removed,a=e._handles;r.forEach((function(e){var n="activeLayerInfo-ready-watcher-".concat(e.layer.uid);a.add((0,v.l)((function(){return e.ready}),t,v.h),n)})),i.forEach((function(e){return a.remove(e.layer.uid)})),t()}))]),this.keepCacheOnDestroy||(Xe={})}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(Xe=null)}},{key:"effectList",get:function(){var e=this.layer,t=null;return"effect"in e&&e.effect&&((t=new S.h).effect=e.effect,t.end(),t.scale=this.scale),t}},{key:"opacity",get:function(){var e,t=this.layer.opacity,n=null===(e=this.parent)||void 0===e?void 0:e.opacity,r=this.layer.parent,i=r&&"uid"in r?this._getParentLayerOpacity(r):null;return null!=n?n*t:null!=i?i*t:t}},{key:"ready",get:function(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}},{key:"scale",get:function(){return this.view&&this.view.scale}},{key:"isScaleDriven",get:function(){var e=this.layer;if(null===e)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if("cluster"===e.featureReduction.type)return!0;if("binning"===e.featureReduction.type&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}},{key:"version",get:function(){return this._get("version")+1}},{key:"buildLegendElementsForFeatureCollections",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t){var n,r,i=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=5;break}return e.next=4,this._isLayerInCurrentView();case 4:e.t0=e.sent;case 5:if(e.t0){e.next=7;break}return e.abrupt("return",(this.legendElements=[],void this.notifyChange("ready")));case 7:return n=Array.from(t,(function(e){if(He(e))return i._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){var t=e.layerDefinition,n=t&&t.drawingInfo,r=n&&(0,C.t)(n.renderer),a=me.read(t.geometryType);return r?i._getRendererLegendElements(r,{title:e.name,geometryType:a}):(pe.warn("drawingInfo not available!"),null)}return null})),e.prev=8,r=[],e.next=12,(0,h.E)(n).then((function(e){e.forEach((function(e){var t=e.value;return t&&r.push.apply(r,(0,o.Z)(t))}))}));case 12:this.legendElements=r,this.notifyChange("ready"),e.next=19;break;case 16:e.prev=16,e.t1=e.catch(8),pe.warn("error while building legend for layer!",e.t1);case 19:case"end":return e.stop()}}),e,this,[[8,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForRenderer",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=6;break}return e.next=5,this._isLayerInCurrentView();case 5:e.t0=e.sent;case 6:if(!e.t0){e.next=13;break}return e.next=10,this._getRendererLegendElements(t);case 10:e.t1=e.sent,e.next=14;break;case 13:e.t1=[];case 14:this.legendElements=e.t1,this.notifyChange("ready"),e.next=21;break;case 18:e.prev=18,e.t2=e.catch(0),pe.warn("error while building legend for layer!",e.t2);case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForTools",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(){var t,n,r,i,a=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Oe(t=this.layer)){e.next=5;break}this._constructLegendElementsForVoxellayer(),e.next=29;break;case 5:if(!Pe(t)){e.next=9;break}this._constructLegendElementsForWMTSlayer(),e.next=29;break;case 9:if(!De(t)){e.next=14;break}return e.next=12,this._constructLegendElementsForWMSSublayers();case 12:case 17:case 22:e.next=29;break;case 14:if(!Ne(t)){e.next=19;break}return e.next=17,this._constructLegendElementsForBuildingSceneLayer();case 19:if(!(Be(t)||qe(t)||Ne(t))){e.next=24;break}return e.next=22,this._constructLegendElementsForSublayers();case 24:return this._handles.remove("imageryLayers-watcher"),n="default",je(t)&&(n=((null===t||void 0===t||null===(r=t.renderingRule)||void 0===r?void 0:r.functionName)||"default")+"_"+(null!==(i=t.bandIds)&&void 0!==i&&i.length?t.bandIds.join(""):"###")),e.next=29,this._getLegendLayers("".concat(t.uid,"-").concat(n)).then(function(){var e=(0,y.Z)((0,l.Z)().mark((function e(n){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.legendElements=[],a.notifyChange("ready"),r=n.map(function(){var e=(0,y.Z)((0,l.Z)().mark((function e(n){var r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(je(t)||Ue(t))&&(r=(0,v.l)((function(){return["renderingRule"in t&&t.renderingRule,t.bandIds]}),(function(){return(0,h.B)((0,y.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Xe.default=null,!t.renderer){e.next=6;break}return e.next=4,a.buildLegendElementsForRenderer(t.renderer);case 4:e.next=8;break;case 6:return e.next=8,a.buildLegendElementsForTools();case 8:case"end":return e.stop()}}),e)}))))()})),a._handles.add(r,"imageryLayers-watcher")),(i=a._generateSymbolTableElementForLegendLayer(n))&&i.infos.length&&(je(t)&&(i.title=t.title),a.legendElements.push(i)),a.notifyChange("ready");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,(0,h.E)(r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){pe.warn("Request to server for legend has failed!",e)}));case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_isLayerInCurrentView",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(){var t,n,r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer,n=this.layerView,(r=n&&"createQuery"in n&&"queryFeatureCount"in n)||n&&"createQuery"in t&&"queryFeatureCount"in t){e.next=3;break}return e.abrupt("return",!0);case 3:return e.next=5,(0,v.j)((function(){return!n.updating}));case 5:if((i=r?"createQuery"in n&&n.createQuery():"createQuery"in t&&t.createQuery()).geometry=this.view.extent,!r){e.next=16;break}if(e.t1="queryFeatureCount"in n,!e.t1){e.next=13;break}return e.next=12,n.queryFeatureCount(i);case 12:e.t1=e.sent;case 13:e.t0=e.t1,e.next=22;break;case 16:if(e.t2="queryFeatureCount"in t,!e.t2){e.next=21;break}return e.next=20,t.queryFeatureCount(i);case 20:e.t2=e.sent;case 21:e.t0=e.t2;case 22:return e.t3=e.t0,e.abrupt("return",0!==e.t3);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getParentLayerOpacity",value:function(e){var t=1,n=e.parent;return n&&"uid"in n&&(t=this._getParentLayerOpacity(n)),e.opacity*t}},{key:"_isGroupActive",value:function(){var e=this.children;return!!e.length&&e.some((function(e){return e.ready}))}},{key:"_isRendererScaleDriven",value:function(e){var t=this;if("dot-density"===e.type)return!0;var n="valueExpression"in e&&e.valueExpression;if(ve.test(n))return!0;var r="visualVariables"in e&&e.visualVariables;return!!r&&r.some((function(e){return t._isScaleDrivenSizeVariable(e)}))}},{key:"_isScaleDrivenSizeVariable",value:function(e){if(e&&"size"!==e.type)return!1;var t=e,n=t.minSize,r=t.maxSize;return"object"==typeof n&&n?this._isScaleDrivenSizeVariable(n):"object"==typeof r&&r?this._isScaleDrivenSizeVariable(r):!!t.expression||ve.test(t.valueExpression)}},{key:"_isLayerScaleDriven",value:function(e){var t=this;if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((function(e){return t._isLayerScaleDriven(e)}));var n=e.parent;if(!1===e.loaded&&n&&Be(n)&&"source"in e&&e.source&&"map-layer"===e.source.type){var r,i=(0,s.Z)(n.sourceJSON.layers);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.id===e.source.mapLayerId&&(a.minScale>0||a.maxScale>0))return!0}}catch(l){i.e(l)}finally{i.f()}}return!1}},{key:"_constructLegendElementsForVoxellayer",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(){var t,n,r,i,a,s,o,u,c,d,f,y,p,m=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("voxel-style-watcher"),n=this.layer,this._handles.add((0,v.l)((function(){return n.currentVariableId}),(function(){return m._constructLegendElementsForVoxellayer()})),"voxel-style-watcher"),r=(0,h.g)(n.getVariableStyle(null)),i=[],r&&(null!==(t=r.uniqueValues)&&void 0!==t&&t.length?(a=[],r.uniqueValues.forEach((function(e){e.enabled&&a.push({label:e.label||"".concat(e.value),value:e.value,symbol:new k.S({color:e.color,outline:null})})})),a.length&&i.push({type:"symbol-table",title:r.label,infos:a})):r.transferFunction&&(s=r.transferFunction,o=s.colorStops,u=s.stretchRange,c=o.toArray().reverse(),d=u.map((function(e,t){return"".concat(0===t?F.s:F.c," ").concat(he(e))})).reverse(),f=c.map((function(e){return{color:e.color,value:null,label:null}})),f[0].label=d[0],f[f.length-1].label=d[1],i.push({type:"color-ramp",title:r.label,infos:f,preview:(0,z.g)(c.map((function(e){return e.color})))}))),y=n.opacity,p=i.reduce((function(e,t){return e.concat(m._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)})).map((function(e){return m._getSymbolPreview(e,y)})),e.next=8,(0,h.E)(p);case 8:this.legendElements=i,this.notifyChange("ready");case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_constructLegendElementsForWMTSlayer",value:function(){var e=this;this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");var t=this.layer.activeLayer;if(this._handles.add((0,v.l)((function(){var t=e.layer;return t&&"activeLayer"in t&&t.activeLayer}),(function(){return e._constructLegendElementsForWMTSlayer()})),"wmts-activeLayer-watcher"),t.styleId&&t.styles){var n=null;t.styles.some((function(e){return t.styleId===e.id&&(n=e.legendUrl,!0)})),n&&(this.legendElements=[{type:"symbol-table",title:t.title,infos:[{src:n,opacity:this.opacity}]}])}this.notifyChange("ready")}},{key:"_constructLegendElementsForWMSSublayers",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(){var t,n,r=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("wms-sublayers-watcher"),t=this.layer,n=null,(t.customParameters||t.customLayerParameters)&&(n=(0,a.Z)((0,a.Z)({},t.customParameters),t.customLayerParameters)),this._handles.add((0,v.l)((function(){var e=r.layer;return e&&"sublayers"in e&&e.sublayers}),(function(){return r._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),e.next=7,this._generateLegendElementsForWMSSublayers(t.sublayers,n);case 7:this.legendElements=e.sent,this.notifyChange("ready");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForWMSSublayers",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t,n){var r,i,a,o,u,c=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],this._handles.add(t.on("change",(function(){return c._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),i=t.toArray(),a=(0,s.Z)(i),e.prev=4,u=(0,l.Z)().mark((function e(){var t,i,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.value,i=(0,v.l)((function(){return[t.title,t.visible,t.legendEnabled]}),(function(){return c._constructLegendElementsForWMSSublayers()})),c._handles.add(i,"wms-sublayers-watcher"),!(!c.respectLayerVisibility||t.visible&&t.legendEnabled)){e.next=7;break}return e.next=5,c._generateSymbolTableElementForWMSSublayer(t,n);case 5:(a=e.sent)&&a.infos.length&&r.unshift(a);case 7:case"end":return e.stop()}}),e)})),a.s();case 7:if((o=a.n()).done){e.next=11;break}return e.delegateYield(u(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),a.e(e.t1);case 16:return e.prev=16,a.f(),e.finish(16);case 19:return e.abrupt("return",r);case 20:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForWMSSublayer",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t,n){var r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.legendUrl||!t.sublayers){e.next=5;break}return e.next=3,this._generateLegendElementsForWMSSublayers(t.sublayers,n);case 3:return r=e.sent.filter((function(e){return e})),e.abrupt("return",{type:"symbol-table",title:t.title,infos:r});case 5:return e.abrupt("return",this._generateSymbolTableElementForLegendUrl(t,n));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendUrl",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t,n){var r,i,a,s,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.legendUrl){e.next=3;break}return e.abrupt("return");case 3:return a={type:"symbol-table",title:t.title||t.name||t.id&&t.id+"",infos:[]},n&&(i=(0,L.B)(i,n)),s=null,o=null===(r=t.layer)||void 0===r?void 0:r.opacity,e.prev=7,e.next=10,(0,L.U)(i,{responseType:"image"});case 10:(s=e.sent.data)&&(s.style.opacity=o),e.next=16;break;case 14:e.prev=14,e.t0=e.catch(7);case 16:return e.abrupt("return",(a.infos.push({src:i,preview:s,opacity:o}),a));case 17:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getLegendLayers",value:function(e,t){var n=Xe&&Xe[e];return n?Promise.resolve(n):this._legendRequest(t).then((function(t){var n=t.layers;return Xe[e]=n,n}))}},{key:"_legendRequest",value:function(e){var t=this.layer,n={f:"json",dynamicLayers:e};if(je(t)){var r=t.exportImageServiceParameters.renderingRule;if(r&&(n.renderingRule=JSON.stringify(r.rasterFunctionDefinition||r.toJSON())),t.bandIds&&(n.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){var i=t.raster,s=t.viewId,l=t.customParameters;n=(0,a.Z)((0,a.Z)({raster:i,viewId:s},n),l)}}var o=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){var u=o.indexOf("?");u>-1?o=o.substring(0,u)+"/legend"+o.substring(u):o+="/legend"}else{var c=o.toLowerCase().indexOf("/rest/"),d=o.substring(0,c)+o.substring(c+5,o.length);o="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(d)+"&returnbytes=true"}return(0,L.U)(o,{query:n}).then((function(e){return e.data}))}},{key:"_constructLegendElementsForBuildingSceneLayer",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(){var t,n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add((0,v.l)((function(){return t.sublayers}),(function(){return n._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForBuildingSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),pe.warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForBuildingSublayers",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t,n){var r,i,a,u,c,d=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],this._handles.add(t.on("change",(function(){return d._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),i=t.toArray(),a=(0,s.Z)(i),e.prev=4,c=(0,l.Z)().mark((function e(){var t,i,a,s,c,f,y;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.value,i=(0,v.l)((function(){return["renderer"in t&&t.renderer,t.opacity,t.title,t.visible]}),(function(){return d._constructLegendElementsForBuildingSceneLayer()})),d._handles.add(i,"sublayers-watcher"),d.respectLayerVisibility&&!t.visible){e.next=21;break}if(a=t&&null!=t.opacity?t.opacity:null,s=null!=a?a*n:n,"building-group"!==t.type){e.next=12;break}return f={type:"symbol-table",title:t.title,infos:[]},e.next=8,d._generateLegendElementsForBuildingSublayers(t.sublayers,s);case 8:y=e.sent,(c=f.infos).push.apply(c,(0,o.Z)(y)),r=[f].concat((0,o.Z)(r)),e.next=21;break;case 12:if(!t.renderer){e.next=21;break}return e.t0=[],e.t1=o.Z,e.next=17,d._getRendererLegendElements(t.renderer,{title:t.title,opacity:s,sublayer:t});case 17:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=(0,o.Z)(r),r=e.t0.concat.call(e.t0,e.t3,e.t4);case 21:case"end":return e.stop()}}),e)})),a.s();case 7:if((u=a.n()).done){e.next=11;break}return e.delegateYield(c(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),a.e(e.t1);case 16:return e.prev=16,a.f(),e.finish(16);case 19:return e.abrupt("return",r.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 20:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_constructLegendElementsForSublayers",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(){var t,n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add((0,v.l)((function(){return t.sublayers}),(function(){return n._constructLegendElementsForSublayers})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),pe.warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForSublayers",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t,n,r){var i,a,u,c,d,f,y=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.layer,a=[],this._handles.add(t.on("change",(function(){return y._constructLegendElementsForSublayers()})),"sublayers-watcher"),u=t.toArray(),!r&&this.sublayerIds&&this.sublayerIds.length&&(u=this.sublayerIds.map((function(e){return i.findSublayerById(e)})).filter(Boolean)),c=(0,s.Z)(u),e.prev=6,f=(0,l.Z)().mark((function e(){var t,i,s,u,c;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d.value,i=(0,v.l)((function(){return[t.renderer,t.opacity,t.title,t.visible,t.legendEnabled]}),(function(){return y._constructLegendElementsForSublayers()})),y._handles.add(i,"sublayers-watcher"),y.respectLayerVisibility&&!(t.visible&&t.legendEnabled&&y._isSublayerInScale(t))){e.next=21;break}if(s=t&&null!=t.opacity?t.opacity:null,u=null!=s?s*n:n,!(t.renderer&&!t.sublayers&&t.originIdOf("renderer")>h.a1.SERVICE)){e.next=17;break}return e.next=7,t.load();case 7:return e.t0=[],e.t1=o.Z,e.next=11,y._getRendererLegendElements(t.renderer,{title:t.title,opacity:u,sublayer:t});case 11:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=(0,o.Z)(a),a=e.t0.concat.call(e.t0,e.t3,e.t4),e.next=21;break;case 17:return e.next=19,y._generateSymbolTableElementForSublayer(t,u,r);case 19:(c=e.sent)&&a.unshift(c);case 21:case"end":return e.stop()}}),e)})),c.s();case 9:if((d=c.n()).done){e.next=13;break}return e.delegateYield(f(),"t0",11);case 11:e.next=9;break;case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(6),c.e(e.t1);case 18:return e.prev=18,c.f(),e.finish(18);case 21:return e.abrupt("return",a.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 22:case"end":return e.stop()}}),e,this,[[6,15,18,21]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForSublayer",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t,n,r){var i,a,s,o,u,c,d;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=9;break}return r=new Map,i=this.layer,a=t.source,s=null,(a&&("map-layer"!==a.type||a.mapLayerId!==t.id||a.gdbVersion&&a.gdbVersion!==("gdbVersion"in i&&i.gdbVersion))||t.originIdOf("renderer")>h.a1.SERVICE||t.originIdOf("labelingInfo")>h.a1.SERVICE||t.originIdOf("labelsVisible")>h.a1.SERVICE)&&(o=new E.c({layer:this.layer}),s=o.hasDynamicLayers?o.dynamicLayers:null,o.destroy()),u=s||"".concat(i.uid,"-default"),e.next=8,this._getLegendLayers(u,s);case 8:e.sent.forEach((function(e){return r.set(e.layerId,e)}));case 9:if(!(!(c=r.get(t.id))||null!==c&&void 0!==c&&c.subLayerIds&&c.defaultVisibility)||!t.sublayers){e.next=15;break}return e.next=13,this._generateLegendElementsForSublayers(t.sublayers,n,r);case 13:return d=e.sent,e.abrupt("return",{type:"symbol-table",title:t.title,infos:d});case 15:return e.abrupt("return",this._generateSymbolTableElementForLegendLayer(c,t,n));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendLayer",value:function(e,t,n){var r,i=this;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;var a=null===t||void 0===t?void 0:t.renderer,s=(null===t||void 0===t?void 0:t.title)||e.layerName;if(a&&(!t||(null===t||void 0===t?void 0:t.originIdOf("renderer"))>h.a1.SERVICE)){var l=(null===t||void 0===t?void 0:t.title)||this._getRendererTitle(a,t);l&&(s&&"string"!=typeof l&&"title"in l&&(l.title=s),s=l)}var o={type:"symbol-table",title:s,legendType:e.legendType?e.legendType:null,infos:[]},u=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return(null===(r=e.legendGroups)||void 0===r?void 0:r.length)>0?e.legendGroups.forEach((function(t){var r,a={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:i._generateSymbolTableElementInfosForLegendLayer(u.filter((function(e){return e.groupId===t.id})),e.layerId,n)};(null===(r=a.infos)||void 0===r?void 0:r.length)>0&&o.infos.push(a)})):o.infos=this._generateSymbolTableElementInfosForLegendLayer(u,e.layerId,n),o.infos.length>0?o:null}},{key:"_generateSymbolTableElementInfosForLegendLayer",value:function(e,t,n){var r=this;return e.map((function(e){var i=e.url;if(e.imageData&&e.imageData.length>0)i="data:image/png;base64,".concat(e.imageData);else{if(0===i.indexOf("http"))return null;i=(0,L.i)("".concat(r.layer.url,"/").concat(t,"/images/").concat(i))}return{label:e.label,src:i,opacity:null==n?r.opacity:n,width:e.width,height:e.height}})).filter((function(e){return!!e}))}},{key:"_isSublayerInScale",value:function(e){var t=e.minScale||0,n=e.maxScale||0;return!(t>0&&t<this.scale||n>this.scale)}},{key:"_isLegendLayerInScale",value:function(e,t){var n=t||this.layer,r=null,i=null,a=!0;return!n.minScale&&0!==n.minScale||!n.maxScale&&0!==n.maxScale?(0===e.minScale&&n.tileInfo&&(r=n.tileInfo.lods[0].scale),0===e.maxScale&&n.tileInfo&&(i=n.tileInfo.lods[n.tileInfo.lods.length-1].scale)):(r=Math.min(n.minScale,e.minScale)||n.minScale||e.minScale,i=Math.max(n.maxScale,e.maxScale)),(r>0&&r<this.scale||i>this.scale)&&(a=!1),a}},{key:"_sanitizeLegendForSublayer",value:function(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;var n=t.renderer,r=e.some((function(e){return e.values})),i=null,a=null;return r&&e.some((function(e,t){return e.values||(i=t,(a=e).label||(a.label="others")),null!=a})),n?"unique-value"===n.type?a&&(e.splice(i,1),e.push(a)):"class-breaks"===n.type&&(a&&e.splice(i,1),e.reverse(),a&&e.push(a)):a&&(e.splice(i,1),e.push(a)),e}},{key:"_getRendererLegendElements",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t){var n,r=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",Te(t,this.view)?Ve(t)?this._constructPointCloudRendererLegendElements(t,n):Fe(t)?this._constructDotDensityRendererLegendElements(t):Ae(t)?this._constructPieChartRendererLegendElements(t):this._constructRendererLegendElements(t,n):(pe.warn("Renderer of type '".concat(t.type,"' not supported!")),[]));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getPointCloudRendererTitle",value:function(e){return e.legendOptions&&e.legendOptions.title||e.field}},{key:"_constructPointCloudRendererLegendElements",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.title,i=[],a=null,s=null;if(Ze(e))a={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((function(e){a.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:t._getAppliedCloneSymbol(be,e.color)})}));else if(Re(e)){var l=e.stops,o=null;if(l.length&&(1===l.length&&(o=l[0].color),!o)){var u=l[0].value,c=l[l.length-1].value;null!=u&&null!=c&&(o=(0,F.d)(u+(c-u)/2,l))}a={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(be,o||be.color)}]};var d=(0,F.e)(e.stops);s={type:"color-ramp",title:r||this._getPointCloudRendererTitle(e),infos:d,preview:(0,z.g)(d.map((function(e){return e.color})))}}else ze(e)&&(a={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((function(e){a.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:t._getAppliedCloneSymbol(be,e.color)})})));a&&a.infos.length&&i.push(a),s&&s.infos.length&&i.push(s);var f=i.reduce((function(e,t){return e.concat(t.infos)}),[]).filter((function(e){return!!e.symbol})).map((function(n){return t._getSymbolPreview(n,t.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})}));return(0,h.E)(f).then((function(){return i}))}},{key:"_getElementInfoForDotDensity",value:function(e,t){var n,r=e.backgroundColor,i=e.outline,a=e.dotSize,s=null===(n=this.effectList)||void 0===n?void 0:n.effects.map((function(e){return e.toJSON()})),l=(0,I.i)(s),o=a+"-"+t+"-"+r+"-"+(i&&JSON.stringify(i.toJSON()))+"-"+l,u=this._dotDensityUrlCache,c=u.has(o)?u.get(o):(0,z.m)(e,t);u.set(o,c);var d={shape:{type:"image",x:0,y:0,width:c.width,height:c.height,src:c.src},fill:null,stroke:null,offset:[0,0]},f=(0,z.l)([[d]],[c.width,c.height],{effectView:this.effectList});return{opacity:1,src:c.src,preview:f,width:c.width,height:c.height}}},{key:"_constructDotDensityRendererLegendElements",value:function(e){var t=this,n=e.calculateDotValue(this.view.scale),r=e.legendOptions&&e.legendOptions.unit,i={type:"symbol-table",title:{value:n&&Math.round(n),unit:r||""},infos:[]};return e.attributes.forEach((function(n){var r=t._getElementInfoForDotDensity(e,n.color);r.label=n.label||n.valueExpressionTitle||n.field,i.infos.push(r)})),Promise.resolve([i])}},{key:"_constructPieChartRendererLegendElements",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t){var n,r,i,a,s,o,u,c,d,f,y,p,v,m,g,b=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.layer.opacity,s=[],o="Others",u=t.outline,t.attributes.forEach((function(e){var t=new k.y({color:e.color,outline:u}),n=e.label||e.valueExpressionTitle||e.field;s.push({label:n,symbol:t})})),c=s.length?[].concat(s):[],null!==(n=t.othersCategory)&&void 0!==n&&n.color&&0!==(null===(r=t.othersCategory)||void 0===r?void 0:r.threshold)&&(d=new k.y({color:t.othersCategory.color,outline:u}),s.push({label:t.othersCategory.label||o,symbol:d})),null!==(i=t.defaultColor)&&void 0!==i&&i.a&&(f=new k.y({color:t.defaultColor,outline:u}),s.push({label:t.defaultLabel,symbol:f})),e.next=7,this._getVisualVariableLegendElements(t,this.layer);case 7:if(e.t0=e.sent,e.t0){e.next=10;break}e.t0=[];case 10:return y=e.t0,s.length&&(y.unshift({type:"symbol-table",title:null,infos:s}),v=c.filter((function(e){return e.label!==o})).map((function(e){return e.symbol.color})).filter(Boolean),m=(0,z.b)(v,{holePercentage:t.holePercentage,backgroundColor:null===(p=t.backgroundFillSymbol)||void 0===p?void 0:p.color,effectList:this.effectList,outline:u}),y.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(t,this.layer),infos:s,preview:m})),g=y.reduce((function(e,t){return e.concat(b._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)&&!(null!==e&&void 0!==e&&e.preview)})).map((function(e){return b._getSymbolPreview(e,a,{effectList:b.effectList})})),e.next=15,(0,h.E)(g);case 15:return e.abrupt("return",y);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_constructRendererLegendElements",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t){var n,r,i,a,s,o,u,c,d,f,y,p,v,m,g,b,_,w,L,k,x,S,I,E,M,C,V,Z,R,A,T,N,O,D,P,B,q,H,W,G,J,Q,Y,X,$,K,ee,te,ne,re,ie,ae,se=this,le=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=le.length>1&&void 0!==le[1]?le[1]:{},r=n.title,i=n.sublayer,a=i||this.layer,e.next=4,this._loadRenderer(t);case 4:return s=e.sent,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null,e.next=8,this._getVisualVariableLegendElements(s,a);case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0=[];case 11:if(o=e.t0,u={type:"symbol-table",title:r||this._getRendererTitle(s,a),infos:[]},c=null,d=!1,f=new Set,!we(s)||this._hasSizeRamp){e.next=22;break}return e.next=18,(0,F.b)(s);case 18:y=e.sent,u.infos.push({label:null,symbol:y}),e.next=86;break;case 22:if(!Je(s)){e.next=28;break}p=r,v=Qe(s)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",m=o.findIndex((function(e){return"color-ramp"===e.type})),g=-1!==m?o.splice(m,1)[0]:null,b=o.findIndex((function(e){return"size-ramp"===e.type})),_=-1!==b?o.splice(b,1)[0]:null,w=[],g&&(p=g.title,w.push(g)),_&&(p=_.title,w.push(_)),w.length>0&&o.push({type:v,title:p,infos:w}),e.next=86;break;case 28:if(!Ce(s)){e.next=33;break}k=(0,F.f)(s),o.push({type:"heatmap-ramp",title:r||(null===(L=s.legendOptions)||void 0===L?void 0:L.title),infos:k,preview:(0,z.g)(k.map((function(e){return e.color})),{effectList:this.effectList})}),e.next=86;break;case 33:if(!Me(s)){e.next=39;break}if((x=s&&s.authoringInfo)&&"relationship"===x.type){if(S=x.focus,I=x.numClasses,E=x.field1,M=x.field2,I&&E&&M){for(C=[E,M],V=U(S)||0,Z=0,R=C;Z<R.length;Z++)A=R[Z],T=A.field,N=A.normalizationField,O=A.label,D=O||{field:this._getFieldAlias(T,a),normField:N&&this._getFieldAlias(N,a)},(P=Ye.clone()).angle=V,u.infos.push({label:D,symbol:P}),f.add(P),V+=90;B=j({focus:S,numClasses:I,infos:s.uniqueValueInfos}),o.unshift(B)}}else q=s.field,s.uniqueValueInfos.forEach((function(e){e.symbol&&u.infos.push({label:e.label||se._getDomainName(q,e.value,a)||e.value,value:e.value,symbol:e.symbol})}));s.defaultSymbol&&(u.infos.push({label:s.defaultLabel||"others",symbol:s.defaultSymbol}),d=!0),e.next=86;break;case 39:if(!Ee(s)){e.next=44;break}(!(c=this._isUnclassedRenderer(s))||!this._hasSizeRamp)&&(s.classBreakInfos.forEach((function(e){e.symbol&&u.infos.unshift({label:e.label||(c?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),c&&(u.title=null),this._updateInfosforClassedSizeRenderer(s,u.infos)),s.defaultSymbol&&!c&&(u.infos.push({label:s.defaultLabel||"others",symbol:s.defaultSymbol}),d=!0),e.next=86;break;case 44:if(!xe(s)){e.next=68;break}if(!Ue(this.layer)&&!We(this.layer)){e.next=50;break}Ge(H=this._constructTileImageryStretchRendererElements(s))?o.push(H):u.infos=H,e.next=66;break;case 50:if(W=this.layer,s.statistics&&s.statistics.length&&(G=null!=s.statistics[0].min?s.statistics[0].min:s.statistics[0][0],J=null!=s.statistics[0].max?s.statistics[0].max:s.statistics[0][1]),Q=[],e.t1=h.g,!W.renderingRule){e.next=60;break}return e.next=57,W.generateRasterInfo(W.renderingRule);case 57:e.t2=e.sent,e.next=61;break;case 60:e.t2=W.serviceRasterInfo;case 61:e.t3=e.t2,Y=(0,e.t1)(e.t3),X=Y.keyProperties.BandProperties,$=ge[W.rasterInfo.pixelType.toLowerCase()],1===Y.bandCount||W.bandIds&&1===W.bandIds.length?(G=null!=G?G:Y.statistics?Y.statistics[W.bandIds[0]].min:$[0],J=null!=J?J:Y.statistics?Y.statistics[W.bandIds[0]].max:$[1],G||J?o.push(this._getStretchLegendElements(s,{min:G,max:J})):this._getServerSideLegend()):Y.bandCount>=3?X&&X.length>=Y.bandCount?W.bandIds&&3===W.bandIds.length?(Q=W.bandIds.map((function(e){return X[e].BandName})),u.infos=this._createSymbolTableElementMultiBand(Q)):"lerc"===W.format?(Q=[0,1,2].map((function(e){return X[e].BandName})),u.infos=this._createSymbolTableElementMultiBand(Q)):this._getServerSideLegend():"lerc"===W.format?(Q=["band1","band2","band3"],u.infos=this._createSymbolTableElementMultiBand(Q)):this._getServerSideLegend():this._getServerSideLegend();case 66:e.next=86;break;case 68:if(!ke(s)){e.next=72;break}s.colormapInfos.forEach((function(e){u.infos.push({label:e.label,value:e.value,symbol:se._getAppliedCloneSymbol(_e,e.color)})})),e.next=86;break;case 72:if(!Ie(s)){e.next=85;break}K=s.symbol,e.t4=n.geometryType,e.next="point"===e.t4?77:"polyline"===e.t4?79:"polygon"===e.t4?81:82;break;case 77:return K="pointSymbol"in a&&a.pointSymbol,e.abrupt("break",82);case 79:return K="lineSymbol"in a&&a.lineSymbol,e.abrupt("break",82);case 81:K="polygonSymbol"in a&&a.polygonSymbol;case 82:s.symbol&&!this._hasSizeRamp&&u.infos.push({label:s.label,symbol:K}),e.next=86;break;case 85:Le(s)?(s.outputUnit&&(this.title="("+s.toJSON().outputUnit+")"),u.title=s.attributeField,null!==(ee=s.getClassBreakInfos())&&void 0!==ee&&ee.length?ee.forEach((function(e){u.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):u.infos.push({label:s.attributeField,symbol:s.getDefaultSymbol()})):Se(s)&&o.push(this._getStretchLegendElements(s,{min:0,max:255}));case 86:return!(te=s.defaultSymbol)||d||Ie(s)||c&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||o.push({type:"symbol-table",infos:[{label:s.defaultLabel||"others",symbol:te}]}),u.infos.length&&o.unshift(u),ne=null==n.opacity?this.opacity:n.opacity,re=this._isTallSymbol("visualVariables"in s&&s.visualVariables),ie=je(this.layer)||Ue(this.layer),ae=o.reduce((function(e,t){return e.concat(se._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)})).map((function(e){return se._getSymbolPreview(e,ne,{isDefault:e.symbol===te,applyScaleDrivenSize:!f.has(e.symbol),symbolConfig:{isTall:re,isSquareFill:ie},effectList:f.has(e.symbol)?null:se.effectList})})),s=null,e.next=92,(0,h.E)(ae);case 92:return e.abrupt("return",o);case 93:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getServerSideLegend",value:function(){var e=this;setTimeout((function(){return e.buildLegendElementsForTools()}),0)}},{key:"_getAllInfos",value:function(e){var t=this,n=null===e||void 0===e?void 0:e.infos;return n?n.reduce((function(e,n){return e.concat(t._getAllInfos(n))}),[]):[e]}},{key:"_constructTileImageryStretchRendererElements",value:function(e){var t,n,r,i,a,s=this.layer,l=s.rasterInfo,o=l.bandCount||e.statistics.length,u=l.keyProperties&&l.keyProperties.BandProperties,c=null!==e&&void 0!==e&&null!==(t=e.statistics)&&void 0!==t&&t.length?e.statistics:null===l||void 0===l?void 0:l.statistics;if(c)r=void 0!==c[0].min?c[0].min:c[0][0],i=c[0].max||c[0][1];else{var d=ge[s.rasterInfo.pixelType.toLowerCase()];r=d[0],i=d[1]}if(s.hasStandardTime()&&(r=s.getStandardTimeValue(r),i=s.getStandardTimeValue(i)),1===l.bandCount||1===(null===(n=s.bandIds)||void 0===n?void 0:n.length))return this._getStretchLegendElements(e,{min:r,max:i});function f(e){var t,n=(null!==s&&void 0!==s&&null!==(t=s.bandIds)&&void 0!==t&&t.length?s.bandIds:Array.from(Array(Math.min(l.bandCount,3)).keys())).map((function(t){return e&&e[t]&&e[t].BandName||"band"+(t+1)}));return n.length<3?n.push(n[1]):n.length>3&&n.splice(3),n}return a=u&&u.length>=o?f(u):f(),this._createSymbolTableElementMultiBand(a)}},{key:"_getStretchLegendElements",value:function(e,t){var n=e.colorRamp,r=(0,F.g)(n,t);return{type:"stretch-ramp",title:"",infos:r,preview:(0,z.g)(r.map((function(e){return e.color})))}}},{key:"_getSizeLegendElement",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t,n,r,i){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this._hasClusterSizeVariable?this._getClusterTitle(n):t,e.t1=Y,e.t2=r,e.t3=n,e.next=6,(0,F.j)(r);case 6:return e.t4=e.sent,e.t5=this.scale,e.t6=this.view.type,e.t7=i,e.next=12,(0,e.t1)(e.t2,e.t3,e.t4,e.t5,e.t6,e.t7);case 12:return e.t8=e.sent,e.abrupt("return",{type:"size-ramp",title:e.t0,infos:e.t8});case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_createSymbolTableElementMultiBand",value:function(e){var t=this,n=[],r=["red","green","blue"];return e.forEach((function(e,i){var a;n.push({label:{colorName:r[i],bandName:e},src:F.m[i],opacity:null!==(a=t.opacity)&&void 0!==a?a:1})})),n}},{key:"_updateInfosforClassedSizeRenderer",value:function(e,t){var n=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,r=e.classBreakInfos.some((function(e){return(0,R.d)(e.symbol)}));if(n&&r){var i=e.classBreakInfos.length,a=18/(i>1?i-1:i);t.forEach((function(e,t){e.size=30-a*t}))}}},{key:"_isTallSymbol",value:function(e){var t=!1,n=!1;if(e)for(var r=0;r<e.length&&(!t||!n);r++){var i=e[r];"size"===i.type&&("height"===i.axis&&(t=!0),"width-and-depth"===i.axis&&(n=!0))}return t&&n}},{key:"_getSymbolPreview",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t,r,i){var a,s,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!==i&&void 0!==i&&i.isDefault||null!=t.size||!this._hasSizeRamp?t.size:(0,x.e)(z.t.size),!this._scaleDrivenSizeVariable||null===i||void 0===i||!i.applyScaleDrivenSize){e.next=7;break}return e.next=4,Promise.resolve().then(n.bind(n,49350)).then((function(e){return e.i}));case 4:s=e.sent,o=s.getSize,a=o(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===t.symbol.type?t.symbol.style:null});case 7:return e.abrupt("return",(0,z.S)(t.symbol,{size:a,opacity:r,scale:!1,symbolConfig:null===i||void 0===i?void 0:i.symbolConfig,effectView:null===i||void 0===i?void 0:i.effectList}).then((function(e){return t.preview=e,t})).catch((function(){return t.preview=null,t})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_loadRenderer",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t){var n,r,i,a,s,o,u,c,d,f,y,p,v,m=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[],a=this.layer,t=t.clone(),this._hasClusterSizeVariable=!1,s="visualVariables"in t&&(null===(n=t.visualVariables)||void 0===n?void 0:n.some((function(e){return"size"===e.type&&"outline"!==e.target&&!ve.test(e.valueExpression)}))),t&&"visualVariables"in t&&!s&&"featureReduction"in a&&"cluster"===(null===(r=a.featureReduction)||void 0===r?void 0:r.type)&&(o=this.layerView._effectiveRenderer,(u=(0,h.g)(D(o,this.view)))&&("clusterMinSize"in(c=a.featureReduction)&&"clusterMaxSize"in c&&(d=c.clusterMinSize,f=c.clusterMaxSize,u.legendOptions=new Z.c({showLegend:d!==f})),y=t.visualVariables||[],t.visualVariables=y.concat([u]),this._hasClusterSizeVariable=!0)),e.next=6,(0,F.j)(t);case 6:return p=e.sent,(Ee(t)||Me(t))&&(v=(t.classBreakInfos||t.uniqueValueInfos).map((function(e){return m._fetchSymbol(e.symbol,p).then((function(t){e.symbol=t})).catch((function(){e.symbol=null}))})),Array.prototype.push.apply(i,v)),e.abrupt("return",(i.push(this._fetchSymbol(t.symbol||t.defaultSymbol,t.defaultSymbol?null:p).then((function(e){m._applySymbolToRenderer(t,e,Ie(t))})).catch((function(){m._applySymbolToRenderer(t,null,Ie(t))}))),(0,h.E)(i).then((function(){return t}))));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_applySymbolToRenderer",value:function(e,t,n){n?e.symbol=t:e.defaultSymbol=t}},{key:"_fetchSymbol",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t,n){var r,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error;case 2:if("web-style"!==t.type){e.next=14;break}return r=this._webStyleSymbolCache,e.prev=4,e.next=7,"2d"===this.view.type?t.fetchCIMSymbol({cache:r}):t.fetchSymbol({cache:r});case 7:return i=e.sent,e.abrupt("return",this._getAppliedCloneSymbol(i,n));case 11:throw e.prev=11,e.t0=e.catch(4),pe.warn("Fetching web-style failed!"),new Error;case 14:return e.abrupt("return",this._getAppliedCloneSymbol(t,n));case 15:case"end":return e.stop()}}),e,this,[[4,11]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getAppliedCloneSymbol",value:function(e,t){if(!e||!t)return e;var n=e.clone(),r=t&&t.toRgba();return n.type.includes("3d")?this._applyColorTo3dSymbol(n,r):"cim"===n.type?(0,R.p)(n,t):n.color&&(n.color=new w.l(r||n.color)),n}},{key:"_applyColorTo3dSymbol",value:function(e,t){t&&e.symbolLayers.forEach((function(e){e&&(e.material||(e.material={}),e.material.color=new w.l(t))}))}},{key:"_getVisualVariableLegendElements",value:function(){var e=(0,y.Z)((0,l.Z)().mark((function e(t,n){var r,i,a,o,u,c,d,f,p,v,m,g,b,_=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("visualVariables"in t&&t.visualVariables&&"vector-field"!==t.type){e.next=2;break}return e.abrupt("return",null);case 2:r=t.visualVariables,i=[],a=[],o=[],u=(0,s.Z)(r);try{for(u.s();!(c=u.n()).done;)"color"===(d=c.value).type?i.push(d):"size"===d.type?a.push(d):"opacity"===d.type&&o.push(d)}catch(w){u.e(w)}finally{u.f()}return f=[].concat(i,a,o),0===i.length&&Ee(t)&&t.classBreakInfos&&1===t.classBreakInfos.length&&(m=t.classBreakInfos[0],p=m&&m.symbol),0===i.length&&Ie(t)&&(p=t.symbol),p&&(p.type.includes("3d")?"water"===(g=p.symbolLayers.getItemAt(0)).type?(0,h.r)(g.color)&&(v=g.color):(0,h.r)(g.material)&&(0,h.r)(g.material.color)&&(v=g.material.color):p.url||(v=p.color)),b=this.effectList,e.next=11,Promise.all(f.map(function(){var e=(0,y.Z)((0,l.Z)().mark((function e(r){var i,a,s,o,u,c;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.legendOptions&&!1===r.legendOptions.showLegend){e.next=28;break}if(i=we(t)?r.field:_._getRampTitle(r,n),a=null,s="getField"in n&&n.getField&&n.getField(r.field),o=s&&(0,M.K)(s),"color"!==r.type){e.next=11;break}return e.next=7,(0,F.k)(r,null,o);case 7:u=e.sent,a={type:"color-ramp",title:i,infos:u,preview:(0,z.g)(u.map((function(e){return e.color})),{effectList:b})},_._hasColorRamp||(_._hasColorRamp=!(null==a.infos||!a.infos.length)),e.next=27;break;case 11:if("size"!==r.type||"outline"===r.target){e.next=22;break}if(!ve.test(r.valueExpression)){e.next=16;break}_._hasClusterSizeVariable||(_._scaleDrivenSizeVariable=r),e.next=20;break;case 16:return e.next=18,_._getSizeLegendElement(i,r,t,o);case 18:a=e.sent,_._hasSizeRamp||(_._hasSizeRamp=!(null==a.infos||!a.infos.length));case 20:e.next=27;break;case 22:if("opacity"!==r.type){e.next=27;break}return e.next=25,(0,F.k)(r,v,o);case 25:c=e.sent,a={type:"opacity-ramp",title:i,infos:c,preview:(0,z.g)(c.map((function(e){return e.color})),{effectList:b})},_._hasOpacityRamp||(_._hasOpacityRamp=!(null==a.infos||!a.infos.length));case 27:return e.abrupt("return",a&&a.infos?a:null);case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return e.abrupt("return",e.sent.filter((function(e){return!!e})));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getDomainName",value:function(e,t,n){if(e&&"function"!=typeof e){var r="getField"in n&&n.getField&&n.getField(e),i=r&&"getFieldDomain"in n&&n.getFieldDomain?n.getFieldDomain(r.name):null;return i&&"coded-value"===i.type?i.getName(t):null}return null}},{key:"_getClusterTitle",value:function(e){var t=this.layer,n=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){var r=t.featureReduction,i="popupTemplate"in r&&r.popupTemplate,a=i&&i.fieldInfos;if(a){var l,o=(0,s.Z)(a);try{for(o.s();!(l=o.n()).done;){var u=l.value;if(u.fieldName===n)return"cluster_count"===n?u.label||{showCount:!0}:u.label}}catch(c){o.e(c)}finally{o.f()}}}return{showCount:!0}}},{key:"_getRampTitle",value:function(e,t){var n=e.field,r=e.normalizationField,i=!1,a=!1,s=!1,l=null;n="function"==typeof n?null:n,r="function"==typeof r?null:r;var o=e.legendOptions&&e.legendOptions.title;if(null!=o)l=o;else if(e.valueExpressionTitle)l=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables)for(var u=t.renderer.authoringInfo.visualVariables,c=0;c<u.length;c++){var d=u[c];if("color"===d.type){if("ratio"===d.style){i=!0;break}if("percent"===d.style){a=!0;break}if("percent-of-total"===d.style){s=!0;break}}}l={field:n&&this._getFieldAlias(n,t),normField:r&&this._getFieldAlias(r,t),ratio:i,ratioPercent:a,ratioPercentTotal:s}}return l}},{key:"_getRendererTitle",value:function(e,t){var n=e;if(n.legendOptions&&n.legendOptions.title)return n.legendOptions.title;if(n.valueExpressionTitle)return n.valueExpressionTitle;var r=n.field,i=null,a=null;Ee(n)&&(i=n.normalizationField,a="percent-of-total"===n.normalizationType),i="function"==typeof i?null:i;var s=null;return((r="function"==typeof r?null:r)||i)&&(s={field:r&&this._getFieldAlias(r,t),normField:i&&this._getFieldAlias(i,t),normByPct:a}),s}},{key:"_getFieldAlias",value:function(e,t){var n="popupTemplate"in t&&t.popupTemplate,r=n&&n.fieldInfos,i=null;r&&r.some((function(t){return e===t.fieldName&&(i=t,!0)}));var a=null;"getField"in t&&t.getField?a=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(a=t.fieldsIndex.get(e));var s=i||a,l=null;return s&&(l=i&&i.label||a&&a.alias||"name"in s&&s.name||"fieldName"in s&&s.fieldName),l}},{key:"_isUnclassedRenderer",value:function(e){var t=e.visualVariables,n=!1;return Ee(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(n=e.field?t.some((function(t){return!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField)})):!!t.length),n}}]),r}(h.y);(0,h.e)([(0,h.d)()],$e.prototype,"children",void 0),(0,h.e)([(0,h.d)({readOnly:!0})],$e.prototype,"effectList",null),(0,h.e)([(0,h.d)()],$e.prototype,"layerView",void 0),(0,h.e)([(0,h.d)()],$e.prototype,"layer",void 0),(0,h.e)([(0,h.d)()],$e.prototype,"legendElements",void 0),(0,h.e)([(0,h.d)({readOnly:!0})],$e.prototype,"opacity",null),(0,h.e)([(0,h.d)()],$e.prototype,"parent",void 0),(0,h.e)([(0,h.d)({readOnly:!0,dependsOn:[]})],$e.prototype,"ready",null),(0,h.e)([(0,h.d)()],$e.prototype,"hideLayersNotInCurrentView",void 0),(0,h.e)([(0,h.d)()],$e.prototype,"keepCacheOnDestroy",void 0),(0,h.e)([(0,h.d)()],$e.prototype,"respectLayerVisibility",void 0),(0,h.e)([(0,h.d)({readOnly:!0})],$e.prototype,"scale",null),(0,h.e)([(0,h.d)()],$e.prototype,"sublayerIds",void 0),(0,h.e)([(0,h.d)({readOnly:!0})],$e.prototype,"isScaleDriven",null),(0,h.e)([(0,h.d)()],$e.prototype,"title",void 0),(0,h.e)([(0,h.d)({readOnly:!0,dependsOn:["ready"],value:0})],$e.prototype,"version",null),(0,h.e)([(0,h.d)()],$e.prototype,"view",void 0);var Ke=$e=(0,h.e)([(0,h.n)("esri.widgets.Legend.support.ActiveLayerInfo")],$e),et="state",tt="view",nt="all-layer-views",rt="legend-properties",it=_.j.ofType(Ke),at=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],st="view.basemapView.baseLayerViews",lt="view.groundView.layerViews",ot="view.basemapView.referenceLayerViews",ut=[st,lt,"view.layerViews",ot],ct=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e))._handles=new p.u,r._layerViewByLayerId={},r._layerInfosByLayerViewId={},r._activeLayerInfosByLayerViewId={},r._activeLayerInfosWithNoParent=new _.j,r.activeLayerInfos=new it,r.basemapLegendVisible=!1,r.groundLegendVisible=!1,r.hideLayersNotInCurrentView=!1,r.keepCacheOnDestroy=!1,r.respectLayerVisibility=!0,r.layerInfos=[],r.view=null,r}return(0,c.Z)(n,[{key:"initialize",value:function(){var e=this;this._handles.add((0,v.l)((function(){return e.view}),(function(){return e._viewHandles()}),v.h),tt),this._handles.add((0,N.s)((function(){return e._refresh()})))}},{key:"destroy",value:function(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"_viewHandles",value:function(){var e=this;this._handles.remove(et),this.view&&this._handles.add((0,v.l)((function(){return e.state}),(function(){return e._stateHandles()}),v.h),et)}},{key:"_stateHandles",value:function(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}},{key:"_resetAll",value:function(){this._handles.remove([nt,rt]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}},{key:"_destroyViewActiveLayerInfos",value:function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}},{key:"_destroyViewActiveLayerInfo",value:function(e){this._handles.remove(e);var t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}},{key:"_watchPropertiesAndAllLayerViews",value:function(){var e=this,t=this.view.allLayerViews;t.length&&this._refresh(),this._handles.add(t.on("change",(function(t){return e._allLayerViewsChangeHandle(t)})),nt),this._handles.add((0,v.l)((function(){return[e.layerInfos,e.basemapLegendVisible,e.groundLegendVisible]}),(function(){return e._propertiesChangeHandle()})),rt)}},{key:"_allLayerViewsChangeHandle",value:function(e){var t=this;e.removed.forEach((function(e){return t._destroyViewActiveLayerInfo(e.uid)})),this._refresh()}},{key:"_propertiesChangeHandle",value:function(){this._destroyViewActiveLayerInfos(),this._refresh()}},{key:"_refresh",value:function(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}},{key:"_sortActiveLayerInfos",value:function(e){var t=this;if(!(e.length<2)){var n=[];e.forEach((function(r){if(!r.parent){var i=r.layer.parent,a=i&&"uid"in i&&t._layerViewByLayerId[i.uid],s=a&&t._activeLayerInfosByLayerViewId[a.uid];s&&e.includes(s)&&(n.push(r),r.parent=s,s.children.add(r),t._sortActiveLayerInfos(s.children))}})),e.removeMany(n);var r={};this.view.allLayerViews.forEach((function(e,t){return r[e.layer.uid]=t})),e.sort((function(e,t){var n=r[e.layer.uid]||0;return(r[t.layer.uid]||0)-n}))}}},{key:"_generateLayerViews",value:function(){var e=[];return ut.filter(this._filterLayerViews,this).map(this.get,this).filter((function(e){return null!=e})).forEach(this._collectLayerViews("layerViews",e)),e}},{key:"_filterLayerViews",value:function(e){var t=!this.basemapLegendVisible&&(e===st||e===ot),n=!this.groundLegendVisible&&e===lt;return!t&&!n}},{key:"_collectLayerViews",value:function(e,t){return function n(r){return r&&r.forEach((function(r){t.push(r),n(r[e])})),t}}},{key:"_filterLayerViewsByLayerInfos",value:function(e){var t=this,n=this.layerInfos;return!n||!n.length||n.some((function(n){return t._hasLayerInfo(n,e)}))}},{key:"_hasLayerInfo",value:function(e,t){var n=this._isLayerUIDMatching(e.layer,t.layer.uid);return n&&(this._layerInfosByLayerViewId[t.uid]=e),n}},{key:"_isLayerUIDMatching",value:function(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}},{key:"_hasLayerUID",value:function(e,t){var n=this;return e&&e.some((function(e){return n._isLayerUIDMatching(e,t)}))}},{key:"_isLayerViewSupported",value:function(e){return!!at.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}},{key:"_generateActiveLayerInfo",value:function(e){var t=this;this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add((0,v.l)((function(){var t;return[e.legendEnabled,null===(t=e.layer)||void 0===t?void 0:t.legendEnabled]}),(function(){return t._layerActiveHandle(e)})),e.uid))}},{key:"_layerActiveHandle",value:function(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}},{key:"_isLayerActive",value:function(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}},{key:"_buildActiveLayerInfo",value:function(e){var t,n=this,r=e.layer,i=e.uid,a=this._layerInfosByLayerViewId[i],s=this._activeLayerInfosByLayerViewId[i];if(!s){var l=a&&void 0!==a.title&&a.layer.uid===r.uid;s=new Ke({layer:r,layerView:e,title:l?a.title:r.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:a&&a.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=s}var o=r.parent&&"uid"in r.parent&&this._layerViewByLayerId[null===(t=r.parent)||void 0===t?void 0:t.uid];if(s.parent=this._activeLayerInfosByLayerViewId[null===o||void 0===o?void 0:o.uid],!this._handles.has(i)){var u=[(0,v.l)((function(){return r.title}),(function(e){return n._titleHandle(e,s)})),(0,v.l)((function(){return[r.opacity,"renderer"in r&&r.renderer,"pointSymbol"in r&&r.pointSymbol,"lineSymbol"in r&&r.lineSymbol,"polygonSymbol"in r&&r.polygonSymbol]}),(function(){return n._constructLegendElements(s)})),(0,v.f)((function(){var e;return!0===(null===(e=n.view)||void 0===e?void 0:e.stationary)}),(function(){return n._scaleHandle(s)}),v.h),(0,v.l)((function(){return e._effectiveRenderer}),(function(){return n._constructLegendElements(s)})),(0,v.l)((function(){return"effect"in r&&r.effect}),(function(){return n._constructLegendElements(s)}))];if(this.respectLayerVisibility){var c=(0,v.l)((function(){return e.legendEnabled}),(function(e){return n._legendEnabledHandle(e,s)})),d=(0,v.l)((function(){return r.legendEnabled}),(function(e){return n._legendEnabledHandle(e,s)}));u.push(c,d)}this._handles.add(u,i)}s.isScaleDriven||this._constructLegendElements(s),this._addActiveLayerInfo(s)}},{key:"_titleHandle",value:function(e,t){t.title=e,this._constructLegendElements(t)}},{key:"_legendEnabledHandle",value:function(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}},{key:"_scaleHandle",value:function(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}},{key:"_addActiveLayerInfo",value:function(e){var t=this,n=e.layerView,r=e.layer;if(this._isLayerActive(n)&&!this.activeLayerInfos.includes(e)){var i=e.parent;if(i)i.children.includes(e)||i.children.push(e),this._sortActiveLayerInfos(i.children);else{var a,s=null===(a=this.layerInfos)||void 0===a?void 0:a.some((function(e){return e.layer.uid===r.uid}));r.parent&&"uid"in r.parent&&!s?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){var l=[];this._activeLayerInfosWithNoParent.forEach((function(e){var n=e.layer.parent,r=n&&"uid"in n&&t._layerViewByLayerId[null===n||void 0===n?void 0:n.uid],i=t._activeLayerInfosByLayerViewId[null===r||void 0===r?void 0:r.uid];i&&(l.push(e),e.parent=i)})),l.length&&(this._activeLayerInfosWithNoParent.removeMany(l),l.forEach((function(e){return t._addActiveLayerInfo(e)})))}}}},{key:"_removeActiveLayerInfo",value:function(e){var t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}},{key:"_constructLegendElements",value:function(e){var t,n=this,r=e.layer;"featureCollections"in r&&r.featureCollections?e.buildLegendElementsForFeatureCollections(r.featureCollections):"featureReduction"in r&&"binning"===(null===(t=r.featureReduction)||void 0===t?void 0:t.type)&&"renderer"in r.featureReduction?e.buildLegendElementsForRenderer(r.featureReduction.renderer):"renderer"in r&&r.renderer?e.buildLegendElementsForRenderer(r.renderer):"url"in r&&r.url?e.buildLegendElementsForTools():e.children.forEach((function(e){return n._constructLegendElements(e)}))}}]),n}(h.y);(0,h.e)([(0,h.d)({type:it})],ct.prototype,"activeLayerInfos",void 0),(0,h.e)([(0,h.d)()],ct.prototype,"basemapLegendVisible",void 0),(0,h.e)([(0,h.d)()],ct.prototype,"groundLegendVisible",void 0),(0,h.e)([(0,h.d)()],ct.prototype,"hideLayersNotInCurrentView",void 0),(0,h.e)([(0,h.d)()],ct.prototype,"keepCacheOnDestroy",void 0),(0,h.e)([(0,h.d)()],ct.prototype,"respectLayerVisibility",void 0),(0,h.e)([(0,h.d)()],ct.prototype,"layerInfos",void 0),(0,h.e)([(0,h.d)({readOnly:!0})],ct.prototype,"state",null),(0,h.e)([(0,h.d)()],ct.prototype,"view",void 0);var dt=ct=(0,h.e)([(0,h.n)("esri.widgets.Legend.LegendViewModel")],ct),ft="http://www.w3.org/2000/svg",yt="esri-relationship-ramp--diamond__container",ht="esri-relationship-ramp--diamond__left-column",pt="esri-relationship-ramp--diamond__right-column",vt="esri-relationship-ramp--diamond__middle-column",mt="esri-relationship-ramp--diamond__middle-column--label",gt="esri-relationship-ramp--diamond__middle-column--ramp",bt="esri-relationship-ramp--square__table",_t="esri-relationship-ramp--square__table-row",wt="esri-relationship-ramp--square__table-cell",Lt="esri-relationship-ramp--square__table-label",kt="esri-relationship-ramp--square__table-label--left-bottom",xt="esri-relationship-ramp--square__table-label--right-bottom",St="esri-relationship-ramp--square__table-label--left-top",It="esri-relationship-ramp--square__table-label--right-top";function Et(e,t,n,r){var i=e.focus,a=e.labels,s=!!i,l=function(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:60,a=e.focus,s=e.numClasses,l=e.colors,o=e.rotation,u=!!a,c=Math.sqrt(Math.pow(i,2)+Math.pow(i,2))+(u?0:5),d=[],f=[],y=[],h=(i||75)/s,p=0;p<s;p++)for(var v=p*h,m=0;m<s;m++){var b=m*h,_=(0,z.M)(l[p][m]),w=(0,z.A)(null),L={type:"rect",x:b,y:v,width:h,height:h};d.push((0,z.$)(_)),f.push((0,z.v)(L,_.fill,w,null)),y.push((0,z.T)(L))}var k=10,x=15,S=15,I=10,E=null;u||(E="margin: -15px -15px -18px -15px");var M=Mt("left",a,t),C=Mt("right",a,t),V=(0,z.E)(y),Z=(0,z.V)(V,c,c,0,!1,o,!1),F=(0,z.V)(V,c,c,0,!1,u?-45:null,!1),A={filter:(0,R.q)(r),opacity:null==n?null:"".concat(n)};return(0,g.n)("div",{styles:A,class:u?gt:wt},(0,g.n)("svg",{xmlns:ft,width:c,height:c,style:E},(0,g.n)("defs",null,(0,g.n)("marker",{id:"".concat(t,"_arrowStart"),markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,g.n)("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),(0,g.n)("marker",{id:"".concat(t,"_arrowEnd"),markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,g.n)("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),d),(0,g.n)("g",{transform:Z},f),(0,g.n)("g",{transform:F},(0,g.n)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":M.markerStart,"marker-end":M.markerEnd,x1:-k,y1:i-x,x2:-k,y2:x}),(0,g.n)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":C.markerStart,"marker-end":C.markerEnd,x1:S,y1:i+I,x2:i-S,y2:i+I}))))}(e,t,n,r),o=(0,g.f)();return s?(0,g.n)("div",{class:yt,styles:{justifyContent:"center"}},(0,g.n)("div",{class:ht},o?a.right:a.left),(0,g.n)("div",{class:vt},(0,g.n)("div",{class:mt},a.top),l,(0,g.n)("div",{class:mt},a.bottom)),(0,g.n)("div",{class:pt},o?a.left:a.right)):(0,g.n)("div",{class:bt},(0,g.n)("div",{class:_t},(0,g.n)("div",{class:(0,g.p)(wt,Lt,xt)},o?a.top:a.left),(0,g.n)("div",{class:wt}),(0,g.n)("div",{class:(0,g.p)(wt,Lt,kt)},o?a.left:a.top)),(0,g.n)("div",{class:_t},(0,g.n)("div",{class:wt}),l,(0,g.n)("div",{class:wt})),(0,g.n)("div",{class:_t},(0,g.n)("div",{class:(0,g.p)(wt,Lt,It)},o?a.right:a.bottom),(0,g.n)("div",{class:wt}),(0,g.n)("div",{class:(0,g.p)(wt,Lt,St)},o?a.bottom:a.right)))}function Mt(e,t,n){var r="".concat(n,"_arrowStart"),i="".concat(n,"_arrowEnd"),a="left"===e,s={markerStart:null,markerEnd:null};switch(t){case"HL":a?s.markerStart="url(#".concat(i,")"):s.markerEnd="url(#".concat(r,")");break;case"LL":s.markerStart="url(#".concat(i,")");break;case"LH":a?s.markerEnd="url(#".concat(r,")"):s.markerStart="url(#".concat(i,")");break;default:s.markerEnd="url(#".concat(r,")")}return s}var Ct=(0,g.i)(),Vt=20,Zt=10,Rt=20,zt="esri-univariate-above-and-below-ramp__symbol",Ft="esri-legend__color-ramp";function At(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertical",t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?(0,g.n)("svg",{height:"4",width:"10"},(0,g.n)("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):(0,g.n)("svg",{height:"10",width:"10"},(0,g.n)("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function Tt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",n=document.createElement("div");return n.style.height="".concat(Vt,"px"),n.className=zt,null!=e&&(n.style.opacity=e.toString()),Ct.append(n,At.bind(null,t)),n}function Nt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",r=arguments.length>3?arguments[3]:void 0;e.infos.forEach((function(e,i){if(r&&2===i)e.preview=Tt(t,n);else{var a=(0,x.u)(e.size)+("horizontal"===n?Rt:Zt),s="div"===e.preview.tagName.toLowerCase(),l=s?e.preview:document.createElement("div");l.className=zt,"horizontal"===n?l.style.width="".concat(a,"px"):l.style.height="".concat(a,"px"),s||l.appendChild(e.preview),e.preview=l}}))}function Ot(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"classic",n=e.infos;return"classic"===t?((0,x.u)(n[0].size)+Zt)/2:((0,x.u)(n[0].size)-(0,x.u)(n[n.length-1].size))/2}function Dt(e,t){if(!e)return null;var n=e.infos.map((function(e){return e.color})),r=(0,z.g)("full"===t.type?n:"above"===t.type?n.slice(0,3):n.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return r.className=Ft,null!=t.opacity&&(r.style.opacity=t.opacity.toString()),r}function Pt(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",i=0,a=e.infos,s=Math.floor(a.length/2),l="full"===t||"above"===t?0:s,o="full"===t||"below"===t?a.length-1:s,u=l;u<=o;u++)i+=n&&u===s?"horizontal"===r?10:Vt:(0,x.u)(a[u].size)+("horizontal"===r?Rt:Zt);return Math.round(i)}function Bt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",i=Pt(e,t,n,r),a=e.infos,s=Math.floor(a.length/2),l="full"===t||"above"===t?0:s,o="full"===t||"below"===t?a.length-1:s,u="full"===t?a[l].size+a[o].size:"above"===t?a[l].size:a[o].size,c=n?"vertical"===r?Vt:10:0,d="vertical"===r?Zt*("full"===t?2:1):Rt*("full"===t?2:1);return Math.round(i-((0,x.u)(u)/2+c/2+d/2))}function qt(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",s=e.infos,l=s.find((function(e){return"size-ramp"===e.type})),u=s.find((function(e){return"color-ramp"===e.type}));return l&&((l=(0,a.Z)({},l)).infos=(0,o.Z)(l.infos),Nt(l,t,i,!0)),u&&((u=(0,a.Z)({},u)).infos=(0,o.Z)(u.infos)),"horizontal"===i&&(null!==(n=l)&&void 0!==n&&n.infos.reverse(),null!==(r=u)&&void 0!==r&&r.infos.reverse()),{sizeRampElement:l,colorRampElement:u}}function Ht(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",i=e.infos,s=i.find((function(e){return"size-ramp"===e.type})),l=i.find((function(e){return"color-ramp"===e.type}));return s&&((s=(0,a.Z)({},s)).infos=(0,o.Z)(s.infos),Nt(s,null,r,!1)),l&&((l=(0,a.Z)({},l)).infos=(0,o.Z)(l.infos)),"horizontal"===r&&(null!==(t=s)&&void 0!==t&&t.infos.reverse(),null!==(n=l)&&void 0!==n&&n.infos.reverse()),{sizeRampElement:s,colorRampElement:l}}function jt(e){e.appendChild(this)}function Ut(e,t,n){if(t){if("string"==typeof t||"number"==typeof t)return t;if("value"in t||"unit"in t)return(0,b.s)(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;var r=null;return function(e,t){return t}(0,n)?r=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:Wt(t,n)&&(r=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),r?(0,b.s)("showField"===r?"{field}":e[r],{field:t.field,normField:t.normField}):null}}function Wt(e,t){return!t}function Gt(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}var Jt,Qt,Yt="esri-legend--card__carousel-indicator--activated",Xt="esri-legend--card",$t="esri-legend--stacked",Kt="esri-legend--card__carousel-title",en="esri-legend--card__carousel-indicator",tn="esri-legend--card__interval-separator",nn="esri-legend--card__imagery-layer-image--stretched",rn="esri-legend--card__image-label",an="esri-legend--card__layer-caption",sn="esri-legend--card__label-element",ln="esri-legend--card__layer-row",on="esri-legend--card__label-cell",un="esri-legend--card__message",cn="esri-legend--card__ramp-label",dn="esri-legend--card__section",fn="esri-legend--card__service-caption-text",yn="esri-legend--card__service-content",hn="esri-legend--card__service",pn="esri-legend--card__group-layer",vn="esri-legend--card__group-layer-child",mn="esri-legend--card__symbol",gn="esri-legend--card__size-ramp-row",bn="esri-legend--card__symbol-row",_n="esri-legend--card__symbol-cell",wn="esri-legend--card__carousel-indicator-container",Ln="esri-legend--card__interval-separators-container",kn="esri-legend--card__relationship-label-container",xn="esri-legend--card__label-container",Sn="esri-legend--card__service-caption-container",In="esri-legend--card__symbol-container",En="esri-legend--card__size-ramp-container",Mn="esri-legend--card__size-ramp-preview",Cn="esri-legend--card__pie-chart-ramp-preview",Vn="esri-legend__size-ramp--horizontal",Zn="esri-legend__ramp-labels",Rn="esri-legend__layer-cell esri-legend__layer-cell--info",zn="esri-univariate-above-and-below-ramp__color--card";(Qt=Jt||(Jt={})).Auto="auto",Qt.Stack="stack",Qt.SideBySide="side-by-side";var Fn=window.devicePixelRatio;var An=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var i;return(0,u.Z)(this,n),(i=t.call(this,e,r))._handles=new p.u,i._hasIndicators=!1,i._selectedSectionName=null,i._sectionNames=[],i._sectionMap=new Map,i.activeLayerInfos=null,i.headingLevel=3,i.layout=Jt.Stack,i.messages=null,i.messagesCommon=null,i.type="card",i.view=null,i}return(0,c.Z)(n,[{key:"initialize",value:function(){var e=this;this.own((0,v.l)((function(){return e.activeLayerInfos}),(function(t){e._handles.removeAll(),e._watchForSectionChanges(t)})))}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null}},{key:"render",value:function(){var e=this;this._hasIndicators=this.layout===Jt.Auto&&this.view.container.clientWidth<=768||this.layout===Jt.Stack;var t=this.activeLayerInfos,n=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;var r=this._sectionNames.length,a=this._sectionNames.map((function(t,n){var a=(0,b.s)(e.messagesCommon.pagination.pageText,{index:n+1,total:r});return(0,g.n)("div",{key:t,role:"tab",id:t,"aria-label":a,"aria-controls":"".concat(t,"-panel"),"aria-selected":(e._selectedSectionName===t).toString(),tabIndex:e._selectedSectionName===t?0:-1,title:a,onclick:e._selectSection,onkeydown:e._focusSection,bind:e,class:e.classes(en,(0,i.Z)({},Yt,e._selectedSectionName===t)),"data-section-name":t})})),s=this._hasIndicators&&r>1?(0,g.n)("div",{class:wn,key:"carousel-navigation",role:"tablist"},a):null,l=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):n&&n.length?n:null,o=(0,i.Z)({},$t,this._hasIndicators);return(0,g.n)("div",{class:this.classes(Xt,o)},l||(0,g.n)("div",{class:un},this.messages.noLegend),s)}},{key:"_selectSection",value:function(e){var t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}},{key:"_focusSection",value:function(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}},{key:"_switchSectionOnArrowPress",value:function(e){var t=e.key,n="ArrowLeft"===t?-1:1,r=e.target.getAttribute("data-section-name"),i=this._sectionNames.indexOf(r),a=this._sectionNames,s=null;-1!==i&&(a[i+n]?s=document.getElementById(a[i+n]):"ArrowLeft"===t?s=document.getElementById(a[a.length-1]):"ArrowRight"===t&&(s=document.getElementById(a[0])),s&&s.focus())}},{key:"_watchForSectionChanges",value:function(e){var t=this;if(this._generateSectionNames(),e){e.forEach((function(e){var n="activeLayerInfo-".concat(e.layer.uid,"-version-change");t._handles.remove(n),t._watchForSectionChanges(e.children),t._handles.add((0,v.l)((function(){return e.version}),(function(){return t._generateSectionNames()})),n)}));var n="activeLayerInfos-collection-change";this._handles.remove(n),this._handles.add(e.on("change",(function(){return t._watchForSectionChanges(e)})),n)}}},{key:"_generateSectionNames",value:function(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}},{key:"_getSectionName",value:function(e,t,n){return"".concat(this.id).concat(e.uid,"-type-").concat(t.type,"-").concat(n)}},{key:"_generateSectionNamesForActiveLayerInfo",value:function(e){var t=this;e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((function(n,r){t._sectionNames.push(t._getSectionName(e.layer,n,r))}))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;if(e.children.length){var n=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return(0,g.n)("div",{key:e.layer.uid,class:this.classes(hn,pn)},(0,g.n)("div",{class:Sn},e.title),n)}var r=e.legendElements;if(r&&!r.length)return null;var a=r.some((function(e){return"relationship-ramp"===e.type})),s=r.map((function(n,r){return t._renderLegendForElement(n,e,r,a)})).filter((function(e){return!!e}));if(!s.length)return null;var l=(0,i.Z)({},vn,!!e.parent);return(0,g.n)("div",{key:e.layer.uid,class:this.classes(hn,l)},(0,g.n)("div",{class:Sn},(0,g.n)("div",{class:fn},e.title)),(0,g.n)("div",{class:yn},s))}},{key:"_renderLegendForElement",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s="color-ramp"===e.type,l="opacity-ramp"===e.type,o="size-ramp"===e.type,u=t.layer,c=null;if("string"==typeof e.title)c=e.title;else if(e.title){var d=e.title,f=Ut(this.messages,d,s||l);c=d.title?"".concat(d.title," (").concat(f,")"):f}var y=this._getSectionName(u,e,n),h=this._hasIndicators?(0,g.n)("div",null,(0,g.n)(F.n,{level:this.headingLevel,class:Kt},t.title),(0,g.n)(F.n,{level:(0,F.p)(this.headingLevel),class:an},c)):c?(0,g.n)(F.n,{level:this.headingLevel,class:an},c):null,p=t.effectList,v=null;if("symbol-table"===e.type){var m=e.infos.map((function(n,i){return r._renderLegendForElementInfo(n,t,e.legendType,i)})).filter((function(e){return!!e}));if(m.length){var b,_=m[0].properties.classes&&m[0].properties.classes[bn],w=(b={},(0,i.Z)(b,xn,!_&&!a),(0,i.Z)(b,kn,a),b);v=(0,g.n)("div",{class:this.classes(w)},m)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?v=this._renderLegendForRamp(e,u.opacity,p):o?v=this._renderSizeRamp(e,u.opacity):"pie-chart-ramp"===e.type?v=this._renderPieChartRamp(e):"relationship-ramp"===e.type?v=Et(e,this.id,u.opacity,p):"univariate-above-and-below-ramp"===e.type?v=this._renderUnivariateAboveAndBelowRamp(e,u.opacity,p):"univariate-color-size-ramp"===e.type&&(v=this._renderUnivariateColorSizeRamp(e,u.opacity,p));if(!v)return null;var L=(0,g.n)("div",{key:y,class:dn,id:"".concat(y,"-panel"),role:"tabpanel","aria-labelledby":y,tabIndex:0},[h,v]);return this._sectionMap.set(y,L),L}},{key:"_renderPieChartRamp",value:function(e){return(0,g.n)("div",{class:Cn,bind:e.preview,afterCreate:jt})}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t,n){var r=qt(e,t,"horizontal"),i=r.sizeRampElement,a=r.colorRampElement;if(!i)return null;var s=Pt(i,"full",!0,"horizontal"),l=Bt(i,"above",!0,"horizontal"),o=Bt(i,"below",!0,"horizontal"),u=Dt(a,{width:l,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:n}),c=Dt(a,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:n}),d=Ot(i,"card"),f=i.infos.map((function(e){return e.label})),y=f.length-1,h=f.map((function(e,t){return 0===t||t===y?(0,g.n)("div",{key:t},e):null})),p={marginTop:"3px",display:"flex"};(0,g.f)(this.container)?p.marginRight="".concat(d,"px"):p.marginLeft="".concat(d,"px");var v={width:"".concat(s,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,g.n)("div",{class:ln,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,g.n)("div",{class:this.classes(In,Vn),styles:{display:"flex",flexDirection:"row"}},i.infos.map((function(e,t){return(0,g.n)("div",{key:t,class:mn,bind:e.preview,afterCreate:jt})}))),u?(0,g.n)("div",{class:zn,styles:p,key:"color-ramp-preview"},(0,g.n)("div",{bind:u,afterCreate:jt}),(0,g.n)("div",{bind:c,afterCreate:jt})):null,(0,g.n)("div",{class:Rn},(0,g.n)("div",{class:Zn,styles:v},h)))}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t,n){var r=Ht(e,"horizontal"),i=r.sizeRampElement,a=r.colorRampElement;if(!i)return null;var s=Pt(i,"full",!1,"horizontal"),l=Dt(a,{width:Bt(i,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:n}),o=Ot(i,"card"),u=i.infos.length-1,c=i.infos.map((function(e,t){return 0===t||t===u?(0,g.n)("div",{key:t},e.label):null})),d={marginTop:"3px",display:"flex"};(0,g.f)(this.container)?d.marginRight="".concat(o,"px"):d.marginLeft="".concat(o,"px");var f={width:"".concat(s,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,g.n)("div",{class:ln,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,g.n)("div",{class:this.classes(In,Vn),styles:{display:"flex",flexDirection:"row"}},i.infos.map((function(e,t){return(0,g.n)("div",{key:t,class:mn,bind:e.preview,afterCreate:jt})}))),(0,g.n)("div",{class:zn,styles:d,key:"color-ramp-preview"},(0,g.n)("div",{bind:l,afterCreate:jt})),(0,g.n)("div",{class:Rn},(0,g.n)("div",{class:Zn,styles:f},c)))}},{key:"_renderLegendForElementInfo",value:function(e,t,n,r){var a=t.layer;if(e.type)return this._renderLegendForElement(e,t,r);var s=Gt(a,n);if(e.preview){var l,o;if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return(0,g.n)("div",{key:r,bind:e.preview,afterCreate:jt});var u=(0,i.Z)({},_n,this._hasIndicators);return(0,g.n)("div",{key:r,class:this.classes(ln,(0,i.Z)({},bn,this._hasIndicators))},(0,g.n)("div",{class:this.classes(u),bind:e.preview,afterCreate:jt}),(0,g.n)("div",{class:this.classes(rn,(0,i.Z)({},on,this._hasIndicators))},Ut(this.messages,e.label,!1)||""))}var c=255,d=255,f=255,y=0,h=255,p=255,v=255,m=0,b=e.symbol.color&&e.symbol.color.a,_=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;b&&(c=e.symbol.color.r,d=e.symbol.color.g,f=e.symbol.color.b,y=e.symbol.color.a*a.opacity),_&&(h=e.symbol.outline.color.r,p=e.symbol.outline.color.g,v=e.symbol.outline.color.b,m=e.symbol.outline.color.a*a.opacity);var w=null===(l=null===(o=e.symbol.color)||void 0===o?void 0:o.isBright)||void 0===l||l,L=w?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",k={background:b?"rgba(".concat(c,", ").concat(d,", ").concat(f,", ").concat(y,")"):"none",color:w?"black":"white",textShadow:"-1px -1px 0 ".concat(L,",\n                                              1px -1px 0 ").concat(L,",\n                                              -1px 1px 0 ").concat(L,",\n                                              1px 1px 0 ").concat(L),border:_?"1px solid rgba(".concat(h,", ").concat(p,", ").concat(v,", ").concat(m,")"):"none",filter:(0,R.q)(t.effectList)};return(0,g.n)("div",{key:r,class:ln},(0,g.n)("div",{class:sn,styles:k}," ",e.label," "))}if(e.src){var x=this._renderImage(e,a,s);return(0,g.n)("div",{key:r,class:ln},x,(0,g.n)("div",{class:rn},e.label||""))}}},{key:"_renderImage",value:function(e,t,n){var r,a=e.label,s=e.src,l=e.opacity,o=(r={},(0,i.Z)(r,nn,n),(0,i.Z)(r,mn,!n),r),u={opacity:"".concat(null!=l?l:t.opacity)};return(0,g.n)("img",{alt:Ut(this.messages,a,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(o),styles:u})}},{key:"_renderSizeRampLines",value:function(e){var t=e.infos,n=t[0],r=t[t.length-1],i=n.symbol,a=this._hasIndicators,s=(0,x.u)(n.size+n.outlineSize)*Fn,l=(0,x.u)(r.size+r.outlineSize)*Fn,o=a?s:s+50*Fn,u=a?s/2+50*Fn:s,c=function(e){if(e){if(e.type.includes("3d")){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var n=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===n||"cone"===n||"tetrahedron"===n}return"triangle"===e.style}}(i),d=function(e){if(e){if(e.type.includes("3d")){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var n=e.symbolLayers.getItemAt(t-1),r=n.resource&&n.resource.primitive;return"circle"===r||"cross"===r||"kite"===r||"sphere"===r||"cube"===r||"diamond"===r}var i=e.style;return"circle"===i||"diamond"===i||"cross"===i}}(i),f=document.createElement("canvas");f.width=o,f.height=u,f.style.width=f.width/Fn+"px",f.style.height=f.height/Fn+"px";var y=f.getContext("2d");if(a){y.beginPath();var h=o/2-l/2,p=u;y.moveTo(0,0),y.lineTo(h,p);var v=o,m=o/2+l/2,b=u;y.moveTo(v,0),y.lineTo(m,b)}else{y.beginPath();var _=u/2-l/2,w=o;y.moveTo(0,_),y.lineTo(w,0);var L=u/2+l/2,k=o,S=u;y.moveTo(0,L),y.lineTo(k,S)}return y.strokeStyle="#ddd",y.stroke(),(0,g.n)("div",{bind:f,afterCreate:jt,styles:a?{display:"flex",marginTop:"-".concat(c?0:d?s/2:0,"px"),marginBottom:"-".concat(c?l:d?l/2:0,"px")}:{display:"flex",marginRight:"-".concat(c?0:d?s/2:0,"px"),marginLeft:"-".concat(c?0:d?l/2:0,"px")}})}},{key:"_renderSizeRamp",value:function(e,t){var n=e.infos,r=n[0].label,a=n[n.length-1].label,s=n[0].preview,l=n[n.length-1].preview,o=this._hasIndicators,u={"flex-direction":o?"column":"row-reverse"};s&&((s=s.cloneNode(!0)).style.display="flex"),l&&((l=l.cloneNode(!0)).style.display="flex");var c={opacity:null!=t?"".concat(t):""};return(0,g.n)("div",{class:this.classes(ln,(0,i.Z)({},gn,o))},(0,g.n)("div",{class:cn},o?r:a),(0,g.n)("div",{class:En,styles:u},(0,g.n)("div",{bind:s,afterCreate:jt,class:Mn,styles:c}),this._renderSizeRampLines(e),(0,g.n)("div",{bind:l,afterCreate:jt,class:En,styles:c})),(0,g.n)("div",{class:cn},o?a:r))}},{key:"_renderLegendForRamp",value:function(e,t,n){var r=e.infos,i="heatmap-ramp"===e.type,a=r.length-1,s=25,l=a>2&&!i?25*a:100,o=l+20,u=10,c=r.slice(0).reverse();c.forEach((function(e,t){e.offset=i?e.ratio:t/a}));var d=c.length-1,f=c.length%2!=0&&c[c.length/2|0],y=f&&(0,g.n)("div",{class:Ln},(0,g.n)("div",{class:tn},"|"),(0,g.n)("div",{class:cn},f.label)),h=r[r.length-1].label,p=r[0].label,v=[[{shape:{type:"path",path:"M0 ".concat(s/2," L").concat(u," 0 L").concat(u," ").concat(s," Z")},fill:c[0].color,stroke:{width:0}},{shape:{type:"rect",x:u,y:0,width:l,height:s},fill:{type:"linear",x1:u,y1:0,x2:l+u,y2:0,colors:c},stroke:{width:0}},{shape:{type:"path",path:"M".concat(l+u," 0 L").concat(o," ").concat(s/2," L").concat(l+u," ").concat(s," Z")},fill:c[d].color,stroke:{width:0}}]],m=(0,z.D)(v,o,s),b=this.messages,_={filter:(0,R.q)(n),opacity:null==t?null:"".concat(t)};return(0,g.n)("div",{class:ln,styles:{justifyContent:"center"}},(0,g.n)("div",{class:cn},i?b[h]:h),(0,g.n)("div",{class:In},(0,g.n)("div",{styles:_},m),y),(0,g.n)("div",{class:cn},i?b[p]:p))}}]),n}(g.O);(0,h.e)([(0,h.d)()],An.prototype,"activeLayerInfos",void 0),(0,h.e)([(0,h.d)()],An.prototype,"headingLevel",void 0),(0,h.e)([(0,h.d)()],An.prototype,"layout",void 0),(0,h.e)([(0,h.d)(),(0,g.e)("esri/widgets/Legend/t9n/Legend")],An.prototype,"messages",void 0),(0,h.e)([(0,h.d)(),(0,g.e)("esri/t9n/common")],An.prototype,"messagesCommon",void 0),(0,h.e)([(0,h.d)({readOnly:!0})],An.prototype,"type",void 0),(0,h.e)([(0,h.d)()],An.prototype,"view",void 0),(0,h.e)([(0,O.t)()],An.prototype,"_selectSection",null);var Tn=An=(0,h.e)([(0,h.n)("esri.widgets.Legend.styles.Card")],An),Nn="esri-legend__service",On="esri-legend__service-label",Dn="esri-legend__layer",Pn="esri-legend__group-layer",Bn="esri-legend__group-layer-child",qn="esri-legend__layer-table",Hn="esri-legend__layer-table--size-ramp",jn="esri-legend__layer-child-table",Un="esri-legend__layer-caption",Wn="esri-legend__layer-body",Gn="esri-legend__layer-row",Jn="esri-legend__layer-cell esri-legend__layer-cell--info",Qn="esri-legend__imagery-layer-image--stretched",Yn="esri-legend__imagery-layer-info--stretched",Xn="esri-legend__layer-cell esri-legend__layer-cell--symbols",$n="esri-legend__symbol",Kn="esri-legend__ramps",er="esri-legend__size-ramp",tr="esri-legend__color-ramp",nr="esri-legend__opacity-ramp",rr="esri-legend__ramp-labels",ir="esri-legend__ramp-label",ar="esri-univariate-above-and-below-ramp__label",sr="esri-legend__message",lr="esri-widget__heading",or={display:"flex",alignItems:"flex-start"},ur={marginLeft:"3px"},cr={display:"table-cell",verticalAlign:"middle"},dr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var i;return(0,u.Z)(this,n),(i=t.call(this,e,r)).activeLayerInfos=null,i.headingLevel=3,i.messages=null,i.type="classic",i}return(0,c.Z)(n,[{key:"render",value:function(){var e=this,t=this.activeLayerInfos,n=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));return(0,g.n)("div",null,n&&n.length?n:(0,g.n)("div",{class:sr},this.messages.noLegend))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;var n=!!e.children.length,r="".concat("esri-legend__").concat(e.layer.uid,"-version-").concat(e.version),a=e.title?(0,F.n)({level:this.headingLevel,class:this.classes(lr,On)},e.title):null;if(n){var s=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return(0,g.n)("div",{key:r,class:this.classes(Nn,Pn)},a,s)}var l=e.legendElements;if(l&&!l.length)return null;var o=l.map((function(n){return t._renderLegendForElement(n,e.layer,e.effectList)})).filter((function(e){return!!e}));if(!o.length)return null;var u=(0,i.Z)({},Bn,!!e.parent);return(0,g.n)("div",{key:r,class:this.classes(Nn,u),tabIndex:0},a,(0,g.n)("div",{class:Dn},o))}},{key:"_renderLegendForElement",value:function(e,t,n,r){var a=this,s="color-ramp"===e.type,l="opacity-ramp"===e.type,o="size-ramp"===e.type,u=null;if("symbol-table"===e.type||o){var c=e.infos.map((function(r){return a._renderLegendForElementInfo(r,t,n,o,e.legendType)})).filter((function(e){return!!e}));c.length&&(u=(0,g.n)("div",{class:Wn},c))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?u=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?u=Et(e,this.id,t.opacity,n):"pie-chart-ramp"===e.type?u=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?u=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,n):"univariate-color-size-ramp"===e.type&&(u=this._renderUnivariateColorSizeRamp(e,t.opacity,n));if(!u)return null;var d=e.title,f=null;if("string"==typeof d)f=d;else if(d){var y=Ut(this.messages,d,s||l);f=Wt(0,s||l)&&d.title?"".concat(d.title," (").concat(y,")"):y}var h=r?jn:qn,p=f?(0,g.n)("div",{class:Un},f):null,v=(0,i.Z)({},Hn,o||!r);return(0,g.n)("div",{class:this.classes(h,v)},p,u)}},{key:"_renderPieChartRamp",value:function(e){return(0,g.n)("div",{bind:e.preview,afterCreate:jt})}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t,n){var r=this,i=qt(e,t),a=i.sizeRampElement,s=i.colorRampElement;if(!a)return null;var l=Bt(a,"above",!0),o=Bt(a,"below",!0),u=Dt(s,{width:12,height:l,rampAlignment:"vertical",opacity:t,type:"above",effectList:n}),c=Dt(s,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"below",effectList:n}),d=Ot(a),f=a.infos.map((function(e){return e.label})),y=f.map((function(e,t){var n=2===t;return 0===t?(0,g.n)("div",{key:t,class:e?u?ar:ir:null},e):n?(0,g.n)("div",null):null})),h=f.length-1,p=Math.floor(f.length/2),v=f.map((function(e,t){return t===p||t===h?(0,g.n)("div",{key:t,class:e?u?ar:ir:null},e):null})),m={display:"table-cell",verticalAlign:"middle"},b={marginTop:"".concat(d,"px")},_={height:"".concat(l,"px")},w={height:"".concat(o,"px")};return(0,g.n)("div",{key:"univariate-above-and-below-ramp-preview",styles:or},(0,g.n)("div",{class:Wn},a.infos.map((function(e,t){return(0,g.n)("div",{class:r.classes(Gn,er)},(0,g.n)("div",{class:$n,styles:m,bind:e.preview,afterCreate:jt}),u||t%2!=0?null:(0,g.n)("div",{class:Jn},f[t]))}))),u?(0,g.n)("div",{styles:b,key:"color-ramp-preview"},(0,g.n)("div",{styles:ur},(0,g.n)("div",{styles:cr},(0,g.n)("div",{class:Kn,bind:u,afterCreate:jt})),(0,g.n)("div",{styles:cr},(0,g.n)("div",{class:rr,styles:_},y))),(0,g.n)("div",{styles:ur},(0,g.n)("div",{styles:cr},(0,g.n)("div",{class:Kn,bind:c,afterCreate:jt})),(0,g.n)("div",{styles:cr},(0,g.n)("div",{class:rr,styles:w},v)))):null)}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t,n){var r=this,i=Ht(e),a=i.sizeRampElement,s=i.colorRampElement;if(!a)return null;var l=Ot(a),o=Bt(a,"full",!1),u=Dt(s,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"full",effectList:n}),c=a.infos.length-1,d=a.infos.map((function(e,t){return 0===t||t===c?(0,g.n)("div",{key:t,class:e.label?s?ar:ir:null},e.label):null})),f={display:"table-cell",verticalAlign:"middle"},y={marginTop:"".concat(l,"px")},h={height:"".concat(o,"px")};return(0,g.n)("div",{key:"univariate-above-and-below-ramp-preview",styles:or},(0,g.n)("div",{class:Wn},a.infos.map((function(e){return(0,g.n)("div",{class:r.classes(Gn,er)},(0,g.n)("div",{class:$n,styles:f,bind:e.preview,afterCreate:jt}))}))),(0,g.n)("div",{styles:y,key:"color-ramp-preview"},(0,g.n)("div",{styles:ur},(0,g.n)("div",{styles:cr},(0,g.n)("div",{class:Kn,bind:u,afterCreate:jt})),(0,g.n)("div",{styles:cr},(0,g.n)("div",{class:rr,styles:h},d)))))}},{key:"_renderLegendForRamp",value:function(e,t){var n=this,r=e.infos,i="opacity-ramp"===e.type,a="heatmap-ramp"===e.type,s="stretch-ramp"===e.type,l=e.preview,o=i?nr:"";l.className="".concat(tr," ").concat(o),null!=t&&(l.style.opacity=t.toString());var u=r.map((function(e){return(0,g.n)("div",{class:e.label?ir:null},a?n.messages[e.label]||e.label:s?n._getStretchStopLabel(e):e.label)})),c={width:"".concat(24,"px")},d={height:l.style.height};return(0,g.n)("div",{class:Gn},(0,g.n)("div",{class:Xn,styles:c},(0,g.n)("div",{class:Kn,bind:l,afterCreate:jt})),(0,g.n)("div",{class:Jn},(0,g.n)("div",{class:rr,styles:d},u)))}},{key:"_getStretchStopLabel",value:function(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:(0,T.m)(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}},{key:"_renderLegendForElementInfo",value:function(e,t,n,r,a){var s;if(e.type)return this._renderLegendForElement(e,t,n,!0);var l=null,o=Gt(t,a);if(e.preview?l=(0,g.n)("div",{class:$n,bind:e.preview,afterCreate:jt}):e.src&&(l=this._renderImage(e,t,o)),!l)return null;var u=(0,i.Z)({},Yn,o),c=(s={},(0,i.Z)(s,Yn,o),(0,i.Z)(s,er,!o&&r),s);return(0,g.n)("div",{class:Gn},(0,g.n)("div",{class:this.classes(Xn,c)},l),(0,g.n)("div",{class:this.classes(Jn,u)},Ut(this.messages,e.label,!1)||""))}},{key:"_renderImage",value:function(e,t,n){var r,a=e.label,s=e.src,l=e.opacity,o=(r={},(0,i.Z)(r,Qn,n),(0,i.Z)(r,$n,!n),r),u={opacity:"".concat(null!=l?l:t.opacity)};return(0,g.n)("img",{alt:Ut(this.messages,a,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(o),styles:u})}}]),n}(g.O);(0,h.e)([(0,h.d)()],dr.prototype,"activeLayerInfos",void 0),(0,h.e)([(0,h.d)()],dr.prototype,"headingLevel",void 0),(0,h.e)([(0,h.d)(),(0,g.e)("esri/widgets/Legend/t9n/Legend")],dr.prototype,"messages",void 0),(0,h.e)([(0,h.d)({readOnly:!0})],dr.prototype,"type",void 0);var fr=dr=(0,h.e)([(0,h.n)("esri.widgets.Legend.styles.Classic")],dr),yr="esri-legend",hr="esri-widget",pr="esri-widget--panel",vr="esri-icon-layer-list",mr=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(e,r){var i;return(0,u.Z)(this,n),(i=t.call(this,e,r))._handles=new p.u,i.activeLayerInfos=null,i.basemapLegendVisible=!1,i.groundLegendVisible=!1,i.headingLevel=3,i.hideLayersNotInCurrentView=!1,i.keepCacheOnDestroy=!1,i.respectLayerVisibility=!0,i.iconClass=vr,i.label=void 0,i.layerInfos=null,i.messages=null,i.style=new fr,i.view=null,i.viewModel=new dt,i}return(0,c.Z)(n,[{key:"initialize",value:function(){var e=this;this.own([(0,v.a)((function(){return e.view}),"resize",(function(){return e.scheduleRender()})),(0,v.a)((function(){return e.activeLayerInfos}),"change",(function(){return e._refreshActiveLayerInfos(e.activeLayerInfos)})),(0,v.l)((function(){return e.headingLevel}),(function(t){var n=e.style;n&&(n.headingLevel=t)})),(0,v.l)((function(){return e.style}),(function(t,n){n&&t!==n&&n.destroy(),t&&(t.activeLayerInfos=e.activeLayerInfos,"card"===t.type&&(t.view=e.view),t.headingLevel=e.headingLevel)}),v.h)])}},{key:"destroy",value:function(){this._handles=(0,h.G)(this._handles)}},{key:"castStyle",value:function(e){if(e instanceof Tn||e instanceof fr)return e;if("string"==typeof e)return"card"===e?new Tn:new fr;if(e&&"string"==typeof e.type){var t=(0,a.Z)({},e);return delete t.type,new("card"===e.type?Tn:fr)(t)}return new fr}},{key:"render",value:function(){return(0,g.n)("div",{class:this.classes(yr,hr,this.style instanceof fr?pr:null)},this.style.render())}},{key:"_refreshActiveLayerInfos",value:function(e){var t=this;this._handles.removeAll(),e.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)})),this.scheduleRender()}},{key:"_renderOnActiveLayerInfoChange",value:function(e){var t=this,n=(0,v.l)((function(){return e.version}),(function(){return t.scheduleRender()}));this._handles.add(n,"version_".concat(e.layer.uid));var r=(0,v.a)((function(){return e.children}),"change",(function(){return e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}),v.h);this._handles.add(r,"children_".concat(e.layer.uid)),e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}}]),n}(g.O);(0,h.e)([(0,m.o)("viewModel.activeLayerInfos")],mr.prototype,"activeLayerInfos",void 0),(0,h.e)([(0,m.o)("viewModel.basemapLegendVisible")],mr.prototype,"basemapLegendVisible",void 0),(0,h.e)([(0,m.o)("viewModel.groundLegendVisible")],mr.prototype,"groundLegendVisible",void 0),(0,h.e)([(0,h.d)()],mr.prototype,"headingLevel",void 0),(0,h.e)([(0,m.o)("viewModel.hideLayersNotInCurrentView")],mr.prototype,"hideLayersNotInCurrentView",void 0),(0,h.e)([(0,m.o)("viewModel.keepCacheOnDestroy")],mr.prototype,"keepCacheOnDestroy",void 0),(0,h.e)([(0,m.o)("viewModel.respectLayerVisibility")],mr.prototype,"respectLayerVisibility",void 0),(0,h.e)([(0,h.d)()],mr.prototype,"iconClass",void 0),(0,h.e)([(0,h.d)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],mr.prototype,"label",void 0),(0,h.e)([(0,m.o)("viewModel.layerInfos")],mr.prototype,"layerInfos",void 0),(0,h.e)([(0,h.d)(),(0,g.e)("esri/widgets/Legend/t9n/Legend")],mr.prototype,"messages",void 0),(0,h.e)([(0,h.d)()],mr.prototype,"style",void 0),(0,h.e)([(0,h.H)("style")],mr.prototype,"castStyle",null),(0,h.e)([(0,m.o)("viewModel.view")],mr.prototype,"view",void 0),(0,h.e)([(0,h.d)()],mr.prototype,"viewModel",void 0);var gr=mr=(0,h.e)([(0,h.n)("esri.widgets.Legend")],mr);t.default=gr},5233:function(e,t,n){n.d(t,{a:function(){return u},e:function(){return l},i:function(){return y},n:function(){return s},u:function(){return d}});var r=n(74165),i=n(15861),a=n(50165);function s(e,t,n){return(0,a.E)(e.map((function(e,r){return t.apply(n,[e,r])})))}function l(e,t,n){return o.apply(this,arguments)}function o(){return o=(0,i.Z)((0,r.Z)().mark((function e(t,n,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,a.E)(t.map((function(e,t){return n.apply(i,[e,t])})));case 2:return e.abrupt("return",e.sent.map((function(e){return e.value})));case 3:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function u(e){return c.apply(this,arguments)}function c(){return(c=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,a.t)(t)){e.next=2;break}return e.abrupt("return",{ok:!1,error:new Error("no promise provided")});case 2:return e.prev=2,e.t0=!0,e.next=6,t;case 6:return e.t1=e.sent,e.abrupt("return",{ok:e.t0,value:e.t1});case 10:return e.prev=10,e.t2=e.catch(2),e.abrupt("return",{ok:!1,error:e.t2});case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function d(e){return f.apply(this,arguments)}function f(){return(f=(0,i.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=!0,e.next=4,t;case 4:return e.t1=e.sent,e.abrupt("return",{ok:e.t0,value:e.t1});case 8:return e.prev=8,e.t2=e.catch(0),e.abrupt("return",((0,a._)(e.t2),{ok:!1,error:e.t2}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function y(e){if(!0===e.ok)return e.value;throw e.error}},63334:function(e,t,n){n.d(t,{D:function(){return J},I:function(){return G},a:function(){return k},b:function(){return W},c:function(){return O},d:function(){return D},f:function(){return N},g:function(){return H},j:function(){return j},l:function(){return F},m:function(){return T},n:function(){return I},p:function(){return A},r:function(){return E},u:function(){return q},v:function(){return U},w:function(){return B},x:function(){return z},y:function(){return P}});var r,i=n(1413),a=n(11752),s=n(61120),l=n(74165),o=n(15861),u=n(15671),c=n(43144),d=n(60136),f=n(29388),y=n(83172),h=n(96263),p=n(77322),v=n(3029),m=n(50165),g=n(13994),b=n(32335),_=n(4483),w=n(73428),L=n(42488),k={inches:(0,w.N)(1,"meters","inches"),feet:(0,w.N)(1,"meters","feet"),"us-feet":(0,w.N)(1,"meters","us-feet"),yards:(0,w.N)(1,"meters","yards"),miles:(0,w.N)(1,"meters","miles"),"nautical-miles":(0,w.N)(1,"meters","nautical-miles"),millimeters:(0,w.N)(1,"meters","millimeters"),centimeters:(0,w.N)(1,"meters","centimeters"),decimeters:(0,w.N)(1,"meters","decimeters"),meters:(0,w.N)(1,"meters","meters"),kilometers:(0,w.N)(1,"meters","kilometers"),"decimal-degrees":1/(0,w.a)(1,"meters",p.s.radius)};var x=r=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){return(0,u.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"collectRequiredFields",value:function(){var e=(0,o.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,_.b)(t,n,this.expression));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clone",value:function(){return new r({expression:this.expression,title:this.title})}},{key:"equals",value:function(e){return this.expression===e.expression&&this.title===e.title}}]),n}(b.l);(0,m.e)([(0,m.d)({type:String,json:{write:!0}})],x.prototype,"expression",void 0),(0,m.e)([(0,m.d)({type:String,json:{write:!0}})],x.prototype,"title",void 0);var S=x=r=(0,m.e)([(0,m.n)("esri.layers.support.FeatureExpressionInfo")],x);function I(e){return null!=k[e]}function E(e){return 1/(k[e]||1)}var M,C=function(){var e=Object.keys(k);return e.sort(),e}(),V=(0,g.o)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Z=new g.s({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"}),R=M=function(e){(0,d.Z)(n,e);var t=(0,f.Z)(n);function n(){var e;return(0,u.Z)(this,n),(e=t.apply(this,arguments)).offset=null,e}return(0,c.Z)(n,[{key:"readFeatureExpressionInfo",value:function(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}},{key:"writeFeatureExpressionInfo",value:function(e,t,n,r){t[n]=e.write({},r),"0"===e.expression&&(t.featureExpression={value:0})}},{key:"mode",get:function(){var e=this.offset,t=this.featureExpressionInfo;return this._isOverridden("mode")?this._get("mode"):(0,m.r)(e)||t?"relative-to-ground":"on-the-ground"},set:function(e){this._override("mode",e)}},{key:"unit",set:function(e){this._set("unit",e)}},{key:"write",value:function(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?(0,a.Z)((0,s.Z)(n.prototype),"write",this).call(this,e,t):null}},{key:"clone",value:function(){return new M({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}},{key:"equals",value:function(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&(0,m.aw)(this.featureExpressionInfo,e.featureExpressionInfo)}}]),n}(b.l);(0,m.e)([(0,m.d)({type:S,json:{write:!0}})],R.prototype,"featureExpressionInfo",void 0),(0,m.e)([(0,p.o)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],R.prototype,"readFeatureExpressionInfo",null),(0,m.e)([(0,p.r)("featureExpressionInfo",{featureExpressionInfo:{type:S},"featureExpression.value":{type:[0]}})],R.prototype,"writeFeatureExpressionInfo",null),(0,m.e)([(0,m.d)({type:V.apiValues,nonNullable:!0,json:{type:V.jsonValues,read:V.read,write:{writer:V.write,isRequired:!0}}})],R.prototype,"mode",null),(0,m.e)([(0,m.d)({type:Number,json:{write:!0}})],R.prototype,"offset",void 0),(0,m.e)([(0,m.d)({type:C,json:{type:String,read:Z.read,write:Z.write}})],R.prototype,"unit",null);var z=R=M=(0,m.e)([(0,m.n)("esri.layers.support.ElevationInfo")],R),F={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},A={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:function(e,t){return!t.disablePopup}},write:{enabled:!0,writer:function(e,t,n){t[n]=!e}}}},T={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},N={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:v.p}}},O={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},D={value:null,type:z,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function P(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}var B={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},q=(0,i.Z)((0,i.Z)({},B),{},{json:(0,i.Z)((0,i.Z)({},B.json),{},{origins:{"web-document":(0,i.Z)((0,i.Z)({},B.json.origins["web-document"]),{},{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:function(e,t,n){return n&&"service"!==n.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,L.r)(t.layerDefinition.drawingInfo.transparency):void 0:(0,L.r)(t.drawingInfo.transparency)}}})}),H={type:y.y,readOnly:!0,get:function(){var e,t;if(null===(e=this.layer)||void 0===e||!e.timeInfo)return null;var n=this.layer,r=n.datesInUnknownTimezone,i=n.timeOffset,a=n.useViewTime,s=null===(t=this.view)||void 0===t?void 0:t.timeExtent,l=this.layer.timeExtent;r&&(l=function(e){if(!e)return e;var t=e.start,n=e.end;return new y.y({start:(0,m.r)(t)?(0,y.n)(t,t.getTimezoneOffset(),"minutes"):t,end:(0,m.r)(n)?(0,y.n)(n,n.getTimezoneOffset(),"minutes"):n})}(l));var o=a?s&&l?s.intersection(l):s||l:l;if(!o||o.isEmpty||o.isAllTime)return o;i&&(o=o.offset(-i.value,i.unit)),r&&(o=function(e){if(!e)return e;var t=e.start,n=e.end;return new y.y({start:(0,m.r)(t)?(0,y.n)(t,-t.getTimezoneOffset(),"minutes"):t,end:(0,m.r)(n)?(0,y.n)(n,-n.getTimezoneOffset(),"minutes"):n})}(o));var u=this._get("timeExtent");return o.equals(u)?u:o}},j={type:h.M,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:function(e,t){var n=h.M.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(n.spatialReference=p.k.fromJSON(t.spatialReference)),n}}}},read:!1}},U={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},W={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},G={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},J={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}}},42814:function(e,t,n){function r(e){var t,n=e.layer;return"floorInfo"in n&&null!==(t=n.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?a(e.view.floors,n.floorInfo.floorField):null}function i(e,t){var n;return"floorInfo"in t&&null!==(n=t.floorInfo)&&void 0!==n&&n.floorField?a(e,t.floorInfo.floorField):null}function a(e,t){if(null===e||void 0===e||!e.length)return null;var n=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return n.push("''"),"".concat(t," IN (").concat(n.join(","),") OR ").concat(t," IS NULL")}n.d(t,{n:function(){return i},o:function(){return r}})},2760:function(e,t,n){function r(){return[0,0,0]}function i(e){return[e[0],e[1],e[2]]}function a(e,t,n){return[e,t,n]}function s(e){for(var t=[0,0,0],n=Math.min(3,e.length),r=0;r<n;++r)t[r]=e[r];return t}function l(e,t){return new Float64Array(e,t,3)}function o(){return[0,0,0]}function u(){return a(1,1,1)}function c(){return a(1,0,0)}function d(){return a(0,1,0)}function f(){return a(0,0,1)}n.d(t,{$:function(){return We},A:function(){return q},B:function(){return ae},C:function(){return Ge},D:function(){return se},E:function(){return le},F:function(){return J},G:function(){return de},H:function(){return Y},I:function(){return me},J:function(){return he},K:function(){return pe},L:function(){return H},M:function(){return Ne},N:function(){return ve},O:function(){return j},P:function(){return P},Q:function(){return _e},R:function(){return we},S:function(){return U},T:function(){return He},U:function(){return ee},V:function(){return qe},W:function(){return je},X:function(){return Ye},Y:function(){return ne},Z:function(){return Te},_:function(){return B},a:function(){return x},a0:function(){return Q},a1:function(){return X},a2:function(){return te},a3:function(){return ye},a4:function(){return re},a5:function(){return y},a6:function(){return s},a7:function(){return Ze},a8:function(){return M},a9:function(){return De},aa:function(){return F},ab:function(){return f},ac:function(){return V},ad:function(){return R},ae:function(){return Z},af:function(){return ie},ag:function(){return Ce},ah:function(){return ze},ai:function(){return C},aj:function(){return Fe},ak:function(){return Ae},al:function(){return Je},am:function(){return Qe},b:function(){return Be},c:function(){return L},d:function(){return b},e:function(){return E},f:function(){return S},g:function(){return Pe},h:function(){return i},i:function(){return m},j:function(){return ge},k:function(){return O},l:function(){return h},m:function(){return Oe},n:function(){return r},o:function(){return Re},p:function(){return T},q:function(){return z},r:function(){return a},s:function(){return k},t:function(){return g},u:function(){return I},v:function(){return N},w:function(){return be},x:function(){return A},y:function(){return l},z:function(){return D}});var y=[0,0,0],h=u(),p=c(),v=d(),m=f();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:i,fromValues:a,fromArray:s,createView:l,zeros:o,ones:u,unitX:c,unitY:d,unitZ:f,ZEROS:y,ONES:h,UNIT_X:p,UNIT_Y:v,UNIT_Z:m},Symbol.toStringTag,{value:"Module"}));var g=1e-6,b=Math.random,_=Math.PI/180,w=180/Math.PI;function L(e){return e*_}function k(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function x(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function S(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function I(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function E(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function M(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function C(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function V(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function Z(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function R(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function z(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function F(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function A(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}function T(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function N(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function O(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function D(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function P(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function B(e,t,n){var r=t[0],i=t[1],a=t[2],s=n[0],l=n[1],o=n[2];return e[0]=i*o-a*l,e[1]=a*s-r*o,e[2]=r*l-i*s,e}function q(e,t,n,r){var i=t[0],a=t[1],s=t[2];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=s+r*(n[2]-s),e}function H(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12],e[1]=n[1]*r+n[5]*i+n[9]*a+n[13],e[2]=n[2]*r+n[6]*i+n[10]*a+n[14],e}function j(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e}function U(e,t,n){var r=n[0],i=n[1],a=n[2],s=n[3],l=t[0],o=t[1],u=t[2],c=i*u-a*o,d=a*l-r*u,f=r*o-i*l,y=i*f-a*d,h=a*c-r*f,p=r*d-i*c,v=2*s;return c*=v,d*=v,f*=v,y*=2,h*=2,p*=2,e[0]=l+c+y,e[1]=o+d+h,e[2]=u+f+p,e}Object.freeze(Object.defineProperty({__proto__:null,EPSILON:g,RANDOM:b,toRadian:L,toDegree:function(e){return e*w},equals:function(e,t){return Math.abs(e-t)<=g*Math.max(1,Math.abs(e),Math.abs(t))}},Symbol.toStringTag,{value:"Module"}));var W=[0,0,0],G=[0,0,0];function J(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Q(e,t){if(e===t)return!0;var n=e[0],r=e[1],i=e[2],a=t[0],s=t[1],l=t[2];return Math.abs(n-a)<=g*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=g*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-l)<=g*Math.max(1,Math.abs(i),Math.abs(l))}function Y(e,t,n){var r=n[0]-t[0],i=n[1]-t[1],a=n[2]-t[2],s=r*r+i*i+a*a;return s>0?(s=1/Math.sqrt(s),e[0]=r*s,e[1]=i*s,e[2]=a*s,e):(e[0]=0,e[1]=0,e[2]=0,e)}var X=E,$=M,K=C,ee=A,te=T,ne=k,re=N,ie=Object.freeze(Object.defineProperty({__proto__:null,length:k,copy:x,set:S,add:I,subtract:E,multiply:M,divide:C,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},abs:V,sign:Z,min:R,max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:z,scaleAndAdd:F,distance:A,squaredDistance:T,squaredLength:N,negate:O,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:D,dot:P,cross:B,lerp:q,hermite:function(e,t,n,r,i,a){var s=a*a,l=s*(2*a-3)+1,o=s*(a-2)+a,u=s*(a-1),c=s*(3-2*a);return e[0]=t[0]*l+n[0]*o+r[0]*u+i[0]*c,e[1]=t[1]*l+n[1]*o+r[1]*u+i[1]*c,e[2]=t[2]*l+n[2]*o+r[2]*u+i[2]*c,e},bezier:function(e,t,n,r,i,a){var s=1-a,l=s*s,o=a*a,u=l*s,c=3*a*l,d=3*o*s,f=o*a;return e[0]=t[0]*u+n[0]*c+r[0]*d+i[0]*f,e[1]=t[1]*u+n[1]*c+r[1]*d+i[1]*f,e[2]=t[2]*u+n[2]*c+r[2]*d+i[2]*f,e},random:function(e,t){t=t||1;var n=2*b()*Math.PI,r=2*b()-1,i=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*i,e[1]=Math.sin(n)*i,e[2]=r*t,e},transformMat4:H,transformMat3:j,transformQuat:U,rotateX:function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},rotateY:function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},rotateZ:function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},angle:function(e,t){x(W,e),x(G,t),D(W,W),D(G,G);var n=P(W,G);return n>1?0:n<-1?Math.PI:Math.acos(n)},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:J,equals:Q,direction:Y,sub:X,mul:$,div:K,dist:ee,sqrDist:te,len:ne,sqrLen:re},Symbol.toStringTag,{value:"Module"}));function ae(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function se(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function le(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function oe(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function ue(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function ce(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function de(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function fe(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+a*a)}function ye(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return n*n+r*r+i*i+a*a}function he(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)}function pe(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}function ve(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],s=n*n+r*r+i*i+a*a;return s>0&&(s=1/Math.sqrt(s),e[0]=n*s,e[1]=r*s,e[2]=i*s,e[3]=a*s),e}function me(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ge(e,t,n,r){var i=t[0],a=t[1],s=t[2],l=t[3];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=s+r*(n[2]-s),e[3]=l+r*(n[3]-l),e}function be(e,t,n){var r=t[0],i=t[1],a=t[2],s=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*s,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*s,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*s,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*s,e}function _e(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function we(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],s=t[0],l=t[1],o=t[2],u=t[3];return Math.abs(n-s)<=g*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-l)<=g*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-o)<=g*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(a-u)<=g*Math.max(1,Math.abs(a),Math.abs(u))}var Le=oe,ke=ue,xe=ce,Se=fe,Ie=ye,Ee=he,Me=pe,Ce=Object.freeze(Object.defineProperty({__proto__:null,copy:ae,set:se,add:le,subtract:oe,multiply:ue,divide:ce,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:de,scaleAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},distance:fe,squaredDistance:ye,length:he,squaredLength:pe,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:ve,dot:me,lerp:ge,random:function(e,t){var n,r,i,a,s,l;t=t||1;do{s=(n=2*b()-1)*n+(r=2*b()-1)*r}while(s>=1);do{l=(i=2*b()-1)*i+(a=2*b()-1)*a}while(l>=1);var o=Math.sqrt((1-s)/l);return e[0]=t*n,e[1]=t*r,e[2]=t*i*o,e[3]=t*a*o,e},transformMat4:be,transformQuat:function(e,t,n){var r=t[0],i=t[1],a=t[2],s=n[0],l=n[1],o=n[2],u=n[3],c=u*r+l*a-o*i,d=u*i+o*r-s*a,f=u*a+s*i-l*r,y=-s*r-l*i-o*a;return e[0]=c*u+y*-s+d*-o-f*-l,e[1]=d*u+y*-l+f*-s-c*-o,e[2]=f*u+y*-o+c*-l-d*-s,e[3]=t[3],e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:_e,equals:we,sub:Le,mul:ke,div:xe,dist:Se,sqrDist:Ie,len:Ee,sqrLen:Me},Symbol.toStringTag,{value:"Module"})),Ve=new Float32Array(1);function Ze(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1}function Re(e,t,n){return Math.min(Math.max(e,t),n)}function ze(e){return 0==(e&e-1)}function Fe(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function Ae(e){return Math.pow(10,Math.ceil(Math.LOG10E*Math.log(e)))}function Te(e,t,n){return e+(t-e)*n}function Ne(e){return e*Math.PI/180}function Oe(e){return 180*e/Math.PI}function De(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-6;return(e<0?-1:1)/Math.max(Math.abs(e),t)}function Pe(e){return Math.acos(Re(e,-1,1))}function Be(e){return Math.asin(Re(e,-1,1))}function qe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6;if(isNaN(e)||isNaN(t))return!1;if(e===t)return!0;var r=Math.abs(e-t),i=Math.abs(e),a=Math.abs(t);if(0===e||0===t||i<1e-12&&a<1e-12){if(r>.01*n)return!1}else if(r/(i+a)>n)return!1;return!0}function He(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6;return!isNaN(e)&&!isNaN(t)&&(e>t?e-t:t-e)<=n}function je(e){return Ue(Math.max(-Ye,Math.min(e,Ye)))}function Ue(e){return Ve[0]=e,Ve[0]}function We(e,t,n){var r=Re((n-e)/(t-e),0,1);return r*r*(3-2*r)}function Ge(e,t){var n=k(e);return S(t,n,Be(e[2]/n),Math.atan2(e[1]/n,e[0]/n)),t}function Je(e,t,n){return se(e,t[0],t[1],t[2],t[3]*n)}function Qe(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(He(t,1)&&He(n,1)&&He(r,1))}var Ye=Ue(34028234663852886e22)},8180:function(e,t,n){n.d(t,{o:function(){return a},t:function(){return s}});var r=n(50165),i=n(38419);function a(e){return(0,r.t)(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function s(e){if((0,r.t)(e))return null;if(!a(e))return new r.a("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '".concat(e.type||e.declaredClass,"'"),{renderer:e});switch(e.type){case"simple":return l(t=e,(0,i.a)(t.symbol).error);case"unique-value":return function(e){var t=e.uniqueValueInfos.map((function(e){return(0,i.a)(e.symbol).error})).filter((function(e){return!!e})),n=(0,i.a)(e.defaultSymbol);return n.error&&t.unshift(n.error),l(e,t)}(e);case"class-breaks":return function(e){var t=e.classBreakInfos.map((function(e){return(0,i.a)(e.symbol).error})).filter((function(e){return!!e})),n=(0,i.a)(e.defaultSymbol);return n.error&&t.unshift(n.error),l(e,t)}(e);case"dictionary":case"heatmap":return null}var t;return null}function l(e,t){if(!t)return null;var n;if((n=Array.isArray(t)?t:[t]).length>0){var i=n.map((function(e){return e.details.symbol.type||e.details.symbol.declaredClass})).filter((function(e){return!!e}));i.sort();var a=[];return i.forEach((function(e,t){0!==t&&e===i[t-1]||a.push(e)})),new r.a("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols (".concat(a.join(", "),") which are not supported in 3D"),{renderer:e,symbolErrors:n})}return null}},43634:function(e,t,n){n.d(t,{i:function(){return s},n:function(){return a},t:function(){return o}});var r=n(37762),i=n(50165);function a(e,t,n){return t.flatten((function(e){return e.sublayers})).length!==e.length||(!!e.some((function(e){return e.originIdOf("minScale")>n||e.originIdOf("maxScale")>n||e.originIdOf("renderer")>n||e.originIdOf("labelingInfo")>n||e.originIdOf("opacity")>n||e.originIdOf("labelsVisible")>n||e.originIdOf("source")>n}))||!l(e,t))}function s(e,t,n){return!!e.some((function(e){var t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&((0,i.t)(t.gdbVersion)||t.gdbVersion===n))||e.originIdOf("renderer")>i.a1.SERVICE||e.originIdOf("labelingInfo")>i.a1.SERVICE||e.originIdOf("opacity")>i.a1.SERVICE||e.originIdOf("labelsVisible")>i.a1.SERVICE}))||!l(e,t)}function l(e,t){if(!e||!e.length||(0,i.t)(t))return!0;var n=t.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).map((function(e){return e.id})).toArray();if(e.length>n.length)return!1;var a,s=0,l=n.length,o=(0,r.Z)(e);try{for(o.s();!(a=o.n()).done;){for(var u=a.value.id;s<l&&n[s]!==u;)s++;if(s>=l)return!1}}catch(c){o.e(c)}finally{o.f()}return!0}function o(e){return!!e&&e.some((function(e){return null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale}))}}}]);
//# sourceMappingURL=548.c8cca2cb.chunk.js.map