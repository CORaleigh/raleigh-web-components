"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[8010],{8184:function(e,t,r){r.d(t,{r:function(){return h}});var i=r(93433),n=r(37762),a=r(15671),s=r(43144),u=r(60136),o=r(29388),l=r(40133),c=r(50165),h=function(e){(0,u.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._set=new Set,e}return(0,s.Z)(r,[{key:"clear",value:function(){if(this._set.size>0){var e=this.toArray();this._set.clear(),this.emit("after-changes",{type:l.E.REMOVE}),this.emit("change",{added:[],removed:e})}}},{key:"length",get:function(){return this._set.size}},{key:"addMany",value:function(e){if(0!==e.length){var t,r=(0,n.Z)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._set.add(i)}}catch(a){r.e(a)}finally{r.f()}this.emit("after-changes",{type:l.E.ADD}),this.emit("change",{added:e,removed:[]})}}},{key:"remove",value:function(e){this._set.delete(e)&&(this.emit("after-changes",{type:l.E.REMOVE}),this.emit("change",{added:[],removed:[e]}))}},{key:"removeMany",value:function(e){var t,r=[],i=(0,n.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;this._set.delete(a)&&r.push(a)}}catch(s){i.e(s)}finally{i.f()}r.length>0&&(this.emit("after-changes",{type:l.E.REMOVE}),this.emit("change",{added:[],removed:r}))}},{key:"toArray",value:function(){return(0,i.Z)(this._set)}},{key:"find",value:function(e){var t;return(0,c.aX)(this._set,(function(r){return!!e(r)&&(t=r,!0)})),t}},{key:"forEach",value:function(e){this._set.forEach((function(t){return e(t)}))}}]),r}(l.n)},72629:function(e,t,r){r.d(t,{E:function(){return at},I:function(){return De},S:function(){return ge},a:function(){return Be},t:function(){return Ne}});var i,n,a,s,u,o,l=r(1413),c=r(11752),h=r(61120),d=r(30168),f=r(29439),p=r(74165),y=r(15861),m=r(60136),v=r(29388),g=r(37762),_=r(15671),F=r(43144),x=r(50165),E=r(73627),b=r(35691),k=r(5233),T=r(40133),w=r(69738),R=r(52155),C=r(22984),S=r(80933),I=r(21277),D=r(53089),O=r(79146),P=r(27670),M=r(47672),Z=r(48561),N=(r(77322),r(96263),r(2760)),V=r(31278),A=(r(33530),r(49961),r(3822)),L=r(67871),U=r(89031),B=r(62980),q=r(85273),G=r(78880),z=r(98643),H=r(66339),j=r(30594),Q=r(2326),W=r(91403),X=r(4483),Y=r(94872),J=r(24695),K=r(92694),$=r(6819),ee=r(48968),te=r(47692),re=r(94867),ie=r(87833),ne=r(84192),ae=r(68634),se=r(92820),ue=r(43643),oe=function(){function e(t,r){(0,_.Z)(this,e),this.highestResolutionVersion=null,this.versions=[],this.ref(t,r)}return(0,F.Z)(e,[{key:"isReferenced",get:function(){return 0!==this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},{key:"ref",value:function(e,t){var r=this.feature;ce.oldVersion=r,this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0});var i,n=(0,g.Z)(this.versions);try{for(n.s();!(i=n.n()).done;){var a=i.value;if(a.resolution===t){a.refCount++;var s=this.highestResolutionVersion===a&&!(0,A.o)(e,a.feature);return(s||this.highestResolutionVersion!==a)&&(a.feature=e),ce.newVersion=s?e:r,ce}}}catch(o){n.e(o)}finally{n.f()}var u={feature:e,resolution:t,refCount:1};return this.versions.push(u),!this.highestResolutionVersion||t<this.highestResolutionVersion.resolution?(ce.newVersion=e,this.highestResolutionVersion=u):ce.newVersion=r,ce}},{key:"unref",value:function(e){for(var t=0;t<this.versions.length;t++){var r=this.versions[t];if(r.resolution===e)return r.refCount--,ce.oldVersion=this.feature,0===r.refCount&&(this.versions[t]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===r&&(this._recalculateHighestResolutionVersion(),ce.oldVersion=r.feature)),ce.newVersion=this.feature,ce}return null}},{key:"feature",get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null}},{key:"_recalculateHighestResolutionVersion",value:function(){if(0!==this.versions.length){for(var e=this.versions[0],t=1;t<this.versions.length;t++){var r=this.versions[t];r.resolution<e.resolution&&(e=r)}this.highestResolutionVersion=e}else this.highestResolutionVersion=null}}]),e}(),le=function(){function e(t){(0,_.Z)(this,e),this._feature=t,this.refCount=1}return(0,F.Z)(e,[{key:"isReferenced",get:function(){return 0!==this.refCount}},{key:"isSingle",get:function(){return 1===this.refCount}},{key:"ref",value:function(e){return++this.refCount,ce.oldVersion=this._feature,this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0}),(0,A.o)(this._feature,e)||(this._feature=e),ce.newVersion=this._feature,ce}},{key:"unref",value:function(){return ce.oldVersion=this._feature,this.refCount>0&&(this.refCount--,!this.isReferenced)?(ce.newVersion=null,ce):(ce.newVersion=this._feature,ce)}},{key:"feature",get:function(){return this._feature}}]),e}(),ce={oldVersion:null,newVersion:null},he=new Set,de=function(){function e(t){(0,_.Z)(this,e),this.descriptor=t,this.fetchStatus=o.FETCH_NEEDED,this._features=null,this._numVertices=0,this._featureLimit=0,this.featuresMissing=!0,this._shuffled=!1,this._numFeatures=fe,this._emptyFeatureRatio=0,this._estimatedSize=-1,this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._availableFields=he,this._displayingFeatures=null,this.alive=!0,this.filtered=!1}return(0,F.Z)(e,[{key:"displayingFeatures",get:function(){return this._displayingFeatures},set:function(e){this._displayingFeatures=e,this.extentIncludingBorrowedFeatures=null}},{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}},{key:"features",get:function(){return this._features}},{key:"featureLimit",get:function(){return this._featureLimit},set:function(e){this._featureLimit!==e&&(this._featureLimit=e,this._estimatedUnusedSizeDirty=!0)}},{key:"availableFields",get:function(){return this._availableFields}},{key:"setFeatures",value:function(e,t,r){this._availableFields=(0,x.af)(r,he),this._features=e,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0,e&&e.length>0?(this._emptyFeatureRatio=t/(e.length+t),this._numVertices=e.reduce((function(e,t){return e+(0,P.w)(t.geometry)}),0)):(this._emptyFeatureRatio=0,this._numVertices=0)}},{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio}},{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e}},{key:"hasPreciseFeatureCount",get:function(){return this._numFeatures>fe}},{key:"needsFeatureCount",get:function(){return this._numFeatures===fe}},{key:"numVertices",get:function(){return this._numVertices}},{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",get:function(){return this.updateMemoryEstimates(),this._estimatedSize}},{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},{key:"updateMemoryEstimates",value:function(){if(this._estimatedSize<0){if(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features)for(var e=0;e<this._features.length;++e){var t=(0,P.A)(this._features[e]);this._estimatedSize+=t,e>=this.featureLimit&&(this._estimatedUnusedSize+=t)}return!0}if(this._estimatedUnusedSizeDirty){if(this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._features)for(var r=this.featureLimit;r<this._features.length;++r)this._estimatedUnusedSize+=(0,P.A)(this._features[r]);return!0}return!1}},{key:"isFetching",get:function(){return this.fetchStatus===o.FETCHING||this.fetchStatus===o.REFETCHING}},{key:"isRefetching",get:function(){return this.fetchStatus===o.REFETCHING}},{key:"needsFetching",get:function(){return this.fetchStatus===o.FETCH_NEEDED||this.fetchStatus===o.REFETCH_NEEDED}},{key:"needsRefetching",get:function(){return this.fetchStatus===o.REFETCH_NEEDED}},{key:"isFetched",get:function(){return this.fetchStatus===o.DONE||this.fetchStatus===o.FULL}},{key:"resetFetching",value:function(){this.fetchStatus=this.fetchStatus===o.REFETCHING?o.REFETCH_NEEDED:o.FETCH_NEEDED}},{key:"needsDisplayUpdate",get:function(){return!!this._features&&!function(e,t,r){if((0,x.t)(t)||(0,x.t)(e)||r!==t.length||r>e.length)return!1;for(var i=0;i<r;++i)if(e[i]!==t[i])return!1;return!0}(this._features,this.displayingFeatures,this.featureLimit)}},{key:"intersects",value:function(e){return!e||!this.descriptor.extent||((0,O.c)(e,pe),(0,O.E)(this.descriptor.extent,pe))}},{key:"intersectionIncludingBorrowed",value:function(e,t){var r=(0,x.r)(this.extentIncludingBorrowedFeatures)?this.extentIncludingBorrowedFeatures:this.descriptor.extent;return e||r?(e?((0,O.c)(e,t),(0,O.U)(t,r,t)):(0,O.a)(t,r),t):((0,O.a)(t,O.J),t)}},{key:"_shuffle",value:function(e){this._features.sort((function(t,r){return(0,P.O)(t,e)-(0,P.O)(r,e)})),(0,x.bu)(this._features,16438),this._shuffled=!0,this._estimatedUnusedSizeDirty=!0}},{key:"reduceFeatures",value:function(e,t,r){if(e<=0)return!1;if(!this._features)return this.featureLimit=0,!1;var i=!1;this.featureLimit=Math.ceil(this.numFeatures*e),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===o.DONE&&this._features.length>0&&(this.fetchStatus=o.REFETCH_NEEDED,i=!0)),!this._shuffled&&e<1&&this._shuffle(r);var n=Math.max(this.featureLimit,Math.ceil(t*this.numFeatures));return this._features.length>n&&(this._features.length=n,this.featuresMissing=!0,this.fetchStatus===o.FULL&&(this.fetchStatus=o.DONE)),i}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(e){this.requestController=null,this._availableFields=e.availableFields,this._features=e.features,this._numFeatures=e.numFeatures,this._emptyFeatureRatio=e.emptyFeatureRatio,this.fetchStatus=e.fetchStatus,this.featuresMissing=e.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0}}]),e}(),fe=-1;!function(e){e[e.FETCH_NEEDED=0]="FETCH_NEEDED",e[e.REFETCH_NEEDED=1]="REFETCH_NEEDED",e[e.FETCHING=2]="FETCHING",e[e.REFETCHING=3]="REFETCHING",e[e.DONE=4]="DONE",e[e.FULL=5]="FULL"}(o||(o={}));var pe=(0,O.u)(),ye=x.s.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D"),me=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(e){var i;return(0,_.Z)(this,r),(i=t.call(this,e))._useTileCount=!1,i.updating=!1,i.updatingTotal=0,i.updatingRemaining=0,i.expectedFeatureDiff=0,i.maximumNumberOfFeaturesExceeded=!1,i.maximumNumberOfFeaturesExceededThrottle=1e3,i._fullRatio=1,i._farRatio=1,i.changes={updates:{adds:new Array,removes:new Array},adds:new Array,removes:new Array},i.handles=new w.u,i._frameTask=L.Q,i._dirty=!1,i.featureTiles=new Map,i.displayingFeatureReferences=new Map,i.numDisplayingFeatureReferences=0,i.suspended=!0,i.pendingEdits=null,i}return(0,F.Z)(r,[{key:"maximumNumberOfFeatures",set:function(e){e=e||1/0;var t=this._get("maximumNumberOfFeatures");e===t||e<1||(this._set("maximumNumberOfFeatures",e),this._maximumFeaturesUpdated(t,e))}},{key:"memoryFactor",set:function(e){this.memoryFactor!==e&&(this._set("memoryFactor",e),this._setDirty())}},{key:"lodFactor",set:function(e){this.lodFactor!==e&&(this._set("lodFactor",e),this.supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&(0,x.r)(this.context.query.queryFeatureCount)},set:function(e){this._useTileCount=e,this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.estimatedUnusedSize})),e}},{key:"totalVertices",get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numVertices})),e}},{key:"totalFeatures",get:function(){var e=0;return this.featureTiles.forEach((function(t){return e+=t.numFeatures})),e}},{key:"filterExtent",set:function(e){if(e&&this.context.tilingScheme&&!e.spatialReference.equals(this.context.tilingScheme.spatialReference))ye.error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme");else{var t=this._get("filterExtent");if(!(t===e||t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("filterExtent",r),this._reclip(r,t)}}}},{key:"initialize",value:function(){var e=this;this.handles.add((0,E.a)((function(){return e.tileDescriptors}),"change",(function(){return e._setDirty()}),{onListenerAdd:function(){return e._setDirty()}})),this.objectIdField=this.context.objectIdField,this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?oe:le;var t=this.context.scheduler;(0,x.r)(t)&&(this._frameTask=t.registerTask(L.L.FEATURE_TILE_FETCHER,this)),this._setDirty()}},{key:"destroy",value:function(){var e=this;this._frameTask.remove(),this.handles=(0,x.G)(this.handles),this.featureTiles.forEach((function(t){e._cancelFetchTile(t),e._removeTile(t)})),this.featureTiles.clear(),this.displayingFeatureReferences.clear(),this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)}},{key:"paused",get:function(){return this.suspended||!!this.pendingEdits}},{key:"restart",value:function(){var e=this;this.featureTiles.forEach((function(t){e._cancelFetchTile(t),e._clearTile(t),e._resetFetchTile(t)})),(0,x.r)(this.context.memoryCache)&&this.context.memoryCache.clear(),this._setDirty()}},{key:"refetch",value:function(){var e=this;this.featureTiles.forEach((function(t){e._cancelFetchTile(t),e._resetFetchTile(t)})),(0,x.r)(this.context.memoryCache)&&this.context.memoryCache.clear(),this._setDirty()}},{key:"suspend",value:function(){this.suspended||(this.suspended=!0,this._pause(),this._setDirty())}},{key:"resume",value:function(){this.suspended&&(this.suspended=!1,this._unpause())}},{key:"_pause",value:function(){var e=this;this.paused&&(this.featureTiles.forEach((function(t){return e._cancelFetchTile(t)})),this._updated())}},{key:"_unpause",value:function(){this.paused||(this._setDirty(),this._updated())}},{key:"availableFields",get:function(){var e=null;return this.featureTiles.forEach((function(t){(0,x.t)(t.displayingFeatures)||0===t.displayingFeatures.length||((0,x.t)(e)?e=new Set(t.availableFields):e.forEach((function(r){t.availableFields.has(r)||(0,x.g)(e).delete(r)})))})),(0,x.r)(e)?e:new Set}},{key:"applyEdits",value:function(e){var t=this;this.pendingEdits||(this.pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());var r=this.pendingEdits;r.count++;var i=r.edits.then((function(){return e.result.catch((function(e){if((0,x.I)(e))throw e;return null})).then((function(e){return e?(t._applyEditsDeleteFeatures(e.deletedFeatures),t._applyEditsAddUpdateFeatures(e.addedFeatures,e.updatedFeatures,r.controller.signal).then((function(){return e}))):e})).then((function(e){return 0==--r.count&&(t.pendingEdits===r&&(t.pendingEdits=null),(0,x.r)(t.context.memoryCache)&&t.context.memoryCache.clear(),t._unpause(),t._updated()),e}))}));return r.edits=i,this._updated(),i}},{key:"_applyEditsDeleteFeatures",value:function(e){var t=this;if(0!==e.length){var r=this.context.globalIdField,i=r&&this.availableFields.has(r),n=new Set,a=this.objectIdField;e.forEach((function(e){var s=e.objectId,u=e.globalId;if((!s||s<0)&&r){i||ye.errorOncePerTick("Editing the specified service requires the layer's globalIdField, ".concat(r," to be included the layer's outFields for updates to be reflected in the view"));var o=t.features.find((function(e){return e.attributes&&e.attributes[r]===u}));o&&n.add((0,P.O)(o,a))}else n.add(s)})),this.featureTiles.forEach((function(e){if(e.features){var r=e.features.filter((function(e){return!n.has((0,P.O)(e,t.objectIdField))}));r.length!==e.features.length&&(e.setFeatures(r,0,e.availableFields),t._invalidateCounts())}}))}}},{key:"_applyEditsAddUpdateFeatures",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t,r,i){var n,a,s,u=this;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],a=new Set,t.forEach((function(e){return n.push(e.objectId)})),r.forEach((function(e){n.push(e.objectId),a.add(e.objectId)})),0!==n.length){e.next=3;break}return e.abrupt("return");case 3:return s=[],this.featureTiles.forEach((function(e){var t=u._applyEditsAddUpdateTile(e,n,a,i);t&&s.push(t)})),e.next=7,(0,x.E)(s);case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_applyEditsAddUpdateTile",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t,r,i,n){var a,s,u,o,l,c,h,d=this;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.features){e.next=2;break}return e.abrupt("return");case 2:return(a=this._createQuery(t)).resultType=void 0,a.cacheHint=!1,a.objectIds=r,e.next=6,this._queryFeatures(a,n);case 6:if(s=e.sent,u=null,i.size>0&&(o=t.features.filter((function(e){return!i.has((0,P.O)(e,d.objectIdField))}))).length!==t.features.length&&(u=o),s.features.length>0){u||(u=t.features.slice()),l=(0,g.Z)(s.features);try{for(l.s();!(c=l.n()).done;)h=c.value,u.push(h)}catch(f){l.e(f)}finally{l.f()}}u&&(t.hasPreciseFeatureCount&&(t.numFeatures=Math.max(t.numFeatures,u.length)),t.setFeatures(u,0,Ee(t.availableFields,s.fields)),this._invalidateCounts());case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n){return e.apply(this,arguments)}}()},{key:"_queryFeatures",value:function(e,t){return this.context.query.queryFeaturesDehydrated(e,{signal:t,timeout:we})}},{key:"_setDirty",value:function(){this._dirty=!0,this._updated()}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(e){var t=this;if(this._frameTask.processQueue(e),this._dirty&&this.constructed){this._dirty=!1;var r=this._getListOfTiles();if(this._markTilesNotAlive(r),e.run((function(){return t._addTiles(r,e)}))&&e.run((function(){return t._filterExtentTiles(r,e)}))&&e.run((function(){return t._removeTiles(r,e)}))&&!e.done){var i=this._sortTiles(r);e.run((function(){return t._displayTiles(i,e)}))&&e.run((function(){return t._fetchTiles(i,e)}))&&e.run((function(){return t._updateMemoryEstimates(i,e)}))||this._setDirty(),this._updated(),this.updating||this._updateMaximumNumberOfFeaturesExceeded()}else this._setDirty()}}},{key:"_markTilesNotAlive",value:function(e){var t,r=(0,g.Z)(e);try{for(r.s();!(t=r.n()).done;){t.value.alive=!1}}catch(i){r.e(i)}finally{r.f()}}},{key:"_addTiles",value:function(e,t){var r=this;return!this.suspended&&(this.tileDescriptors.forEach((function(i){var n=r.featureTiles.get(i.id);n?n.alive=!0:t.done||(e.push(r._addTile(i)),t.madeProgress())})),t.hasProgressed)}},{key:"_filterExtentTiles",value:function(e,t){var r,i=(0,g.Z)(e);try{for(i.s();!(r=i.n()).done;){var n=r.value;if(t.done)break;n.alive&&(n.filtered=!n.intersects(this.filterExtent),n.filtered&&(this._clearTile(n),t.madeProgress()))}}catch(a){i.e(a)}finally{i.f()}return t.hasProgressed}},{key:"_removeTiles",value:function(e,t){for(var r=e.length-1;r>=0&&!t.done;r--){var i=e[r];i.alive||(this._removeTile(i),r!==e.length-1&&(e[r]=e[e.length-1]),e.pop(),t.madeProgress())}return t.hasProgressed}},{key:"_sortTiles",value:function(e){return e.sort((function(e,t){return e.descriptor.loadPriority-t.descriptor.loadPriority})),e}},{key:"_displayTiles",value:function(e,t){var r,i=this,n=this._updateRatio(e),a=(0,g.Z)(e);try{var s=function(){var e=r.value;if(!t.run((function(){return function(e){var t=i._fullRatio<1?n(e)*i._farRatio:1;return e.reduceFeatures(t,i.memoryFactor,i.objectIdField)&&i._setDirty(),i._showTile(e)}(e)})))return i._setDirty(),"break"};for(a.s();!(r=a.n()).done;){if("break"===s())break}}catch(u){a.e(u)}finally{a.f()}return t.hasProgressed}},{key:"_fetchTiles",value:function(e,t){var r=this;if(this.paused)return!1;var i,n=!1,a=(0,g.Z)(e);try{var s=function(){var e=i.value;if(!e.needsFetching)return"continue";var a=(0,x.r)(r.context.memoryCache)?r.context.memoryCache.pop(e.id):null;if((0,x.r)(a))e.cache=a,r._setDirty(),r._scheduleUpdated(),t.madeProgress();else{if(r._needsNumFeatures(e)){var s=new AbortController,u=r._fetchTileCount(e,s.signal);r._handleRequest(e,u,s,(function(){return e.numFeatures=-2})),n=!0,t.madeProgress()}if(t.done)return{v:!0}}};for(a.s();!(i=a.n()).done;){var u=s();if("continue"!==u&&"object"===typeof u)return u.v}}catch(d){a.e(d)}finally{a.f()}if(n)return t.hasProgressed;var o,l=(0,g.Z)(e);try{var c=function(){var e=o.value;if(e.needsFetching){var i=new AbortController,n=r._fetchTile(e,i.signal);if(r._handleRequest(e,n,i,(function(t){e.setFeatures([],0,null),r._invalidateCounts(),e.featuresMissing=!1,r.context.logFetchError(ye,t)})),t.madeProgress(),t.done)return{v:!0}}};for(l.s();!(o=l.n()).done;){var h=c();if("object"===typeof h)return h.v}}catch(d){l.e(d)}finally{l.f()}return t.hasProgressed}},{key:"_updateMemoryEstimates",value:function(e,t){var r=this;return e.some((function(e){return!t.run((function(){return e.updateMemoryEstimates()}))&&(r._setDirty(),!0)})),t.hasProgressed}},{key:"_reclip",value:function(e,t){if(this.constructed){var r=new Array;this.featureTiles.forEach((function(i){(0,x.t)(i.displayingFeatures)||0===i.displayingFeatures.length||(i.intersectionIncludingBorrowed(t,ke),i.intersectionIncludingBorrowed(e,Te),(0,O.I)(ke,Te)||r.push(i))})),this._refreshDisplayingFeatures(r),this._updated()}}},{key:"_refreshDisplayingFeatures",value:function(e){var t,r=new Set,i=this.changes.updates,n=(0,g.Z)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(!(0,x.t)(a.displayingFeatures)){var s,u=(0,g.Z)(a.displayingFeatures);try{for(u.s();!(s=u.n()).done;){var o=s.value,l=(0,P.O)(o,this.objectIdField);if(!r.has(l)){r.add(l);var c=this.displayingFeatureReferences.get(l).feature;i.removes.push(c),i.adds.push(c)}}}catch(h){u.e(h)}finally{u.f()}}}}catch(h){n.e(h)}finally{n.f()}this._applyChanges()}},{key:"_updated",value:function(){var e=this,t=0;this.paused||this.featureTiles.forEach((function(e){return e.isFetching?++t:0}));var r=this._dirty||t>0||!!this.pendingEdits;if(this._set("updating",r),r){var i=0,n=0,a=0,s=0,u=0,o=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach((function(t){if(++n,t.isFetching&&t.hasPreciseFeatureCount){var r=e._maximumFeaturesForTile(t)*(1-t.emptyFeatureRatio),l=(0,x.r)(t.displayingFeatures)?t.displayingFeatures.length*o:0;u+=r-l}t.needsFetching?++s:t.numFeatures>0&&(++a,i+=t.numFeatures)})),s+=t;var l=0,c=0;i?(c=i,l=Math.min(s*i/a,i)):(c=n,l=s),u=Math.min(this.maximumNumberOfFeatures-this.features.length,u),this._set("updatingTotal",c),this._set("updatingRemaining",l),this._set("expectedFeatureDiff",u)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()}},{key:"_updateMaximumNumberOfFeaturesExceeded",value:function(){var e=(0,x.aD)(this.featureTiles,(function(e){return e.perTileMaximumNumberOfFeaturesExceeded}));this._set("maximumNumberOfFeaturesExceeded",e)}},{key:"_updateRatio",value:function(e){var t,r=function(e){var t,r=0,i=(0,g.Z)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;n.features&&n.features.length>0&&n.alive&&(r=Math.max(r,n.descriptor.lij[0]))}}catch(a){i.e(a)}finally{i.f()}return r}(e),i=function(e){return 1/(1<<Math.max(0,r-e.descriptor.lij[0]))},n=0,a=0,s=(0,g.Z)(e);try{for(s.s();!(t=s.n()).done;){var u=t.value,o=u.numFeatures;n+=o,a+=o*i(u)}}catch(l){s.e(l)}finally{s.f()}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/n),this._farRatio=this.maximumNumberOfFeatures/a,this._scheduleUpdated(),i}},{key:"_maximumFeaturesUpdated",value:function(e,t){var r=this;e!==t&&(t>e&&this.featureTiles.forEach((function(e){if(e.featuresMissing){var t=r._maximumFeaturesForTile(e);e.features&&(e.features.length>=t||e.fetchStatus===o.FULL)||(r._cancelFetchTile(e),r._resetFetchTile(e))}})),this._setDirty())}},{key:"_addTile",value:function(e){var t=new de(e);return this.featureTiles.set(t.id,t),this._resetFetchTile(t),this._referenceDisplayingFeaturesFromRelatedTiles(t),t}},{key:"_referenceDisplayingFeaturesFromRelatedTiles",value:function(e){var t=this,r=e.descriptor.resolution;this.featureTiles.forEach((function(i){if(!((0,x.t)(i.displayingFeatures)||e===i||e.descriptor.lij&&i.descriptor.lij&&!(0,b.as)(e.descriptor.lij,i.descriptor.lij))){(0,x.t)(e.displayingFeatures)&&(e.displayingFeatures=[]),e.descriptor.extent&&i.descriptor.extent&&((0,x.t)(e.extentIncludingBorrowedFeatures)&&(e.extentIncludingBorrowedFeatures=(0,O.e)(e.descriptor.extent)),(0,O.h)(e.extentIncludingBorrowedFeatures,i.descriptor.extent,e.extentIncludingBorrowedFeatures));var n,a=(0,g.Z)(i.displayingFeatures);try{for(a.s();!(n=a.n()).done;){var s=n.value;e.displayingFeatures.push(s);var u=t.displayingFeatureReferences.get((0,P.O)(s,t.objectIdField));u.ref(u.feature,r),t.numDisplayingFeatureReferences++}}catch(o){a.e(o)}finally{a.f()}}})),e.featureLimit=(0,x.r)(e.displayingFeatures)?e.displayingFeatures.length:0}},{key:"_removeTile",value:function(e){this._clearTile(e),this.featureTiles.delete(e.id)}},{key:"_resetFetchTile",value:function(e){e.filtered=!e.intersects(this.filterExtent),e.filtered?e.needsFetching&&(e.fetchStatus=o.DONE):e.fetchStatus=o.FETCH_NEEDED}},{key:"_cancelFetchTile",value:function(e){var t=e.requestController;(0,x.r)(t)&&(e.requestController=null,e.resetFetching(),t.abort())}},{key:"_fetchTileCount",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t,r){return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetchCount(t,r);case 2:return t.numFeatures=e.sent,this._updateRatio(this._getListOfTiles()),e.abrupt("return",t.fetchStatus===o.REFETCHING?o.REFETCH_NEEDED:o.FETCH_NEEDED);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchTile",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t,r){var i,n,a,s,u,l,c,h,d,f,y=this;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((i=this._maximumFeaturesForTile(t))<=0)){e.next=3;break}return e.abrupt("return",Fe(t));case 3:if(n=this._getMaxRecordCount(t),a=Math.ceil(i/n),!(ve(t)||!this.context.capabilities.supportsMaxRecordCountFactor||t.numFeatures<=i&&a>D.b.MAX_MAX_RECORD_COUNT_FACTOR)){e.next=6;break}return e.abrupt("return",this._fetchPagedTile(t,r));case 6:return(s=this._createQuery(t)).maxRecordCountFactor=Math.ceil(i/n),t.isRefetching&&t.features&&t.features.length>0&&(u=Math.ceil(t.features.length/(1-t.emptyFeatureRatio)/n),s.maxRecordCountFactor=Math.max(u+1,s.maxRecordCountFactor)),e.next=10,this._queryFeatures(s,r);case 10:return l=e.sent,c=l.features,h=l.exceededTransferLimit,d=l.fields,f=h?s.maxRecordCountFactor>=D.b.MAX_MAX_RECORD_COUNT_FACTOR?o.FULL:o.DONE:o.FULL,e.next=17,this._frameTask.schedule((function(){t.featuresMissing=c.length<t.numFeatures||h;var e=y._removeEmptyFeatures(c);t.setFeatures(c,e,xe(d))}),r);case 17:return(0,x.W)(r),this._invalidateCounts(),e.abrupt("return",f);case 20:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchCount",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t,r){return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.context.query.queryFeatureCount(this._createFeatureCountQuery(t),{signal:r}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchPagedTile",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t,r){var i,n,a,s,u,l,c,h,d,f=this;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0,a=0,s=0,u=this._maximumFeaturesForTile(t)-s,l=this._getMaxRecordCount(t),c=null,h=(0,p.Z)().mark((function e(){var h,d,y,m,v,g;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h=f._createQuery(t),d=f._setPagingParameters(h,n,u,l),e.next=4,f._queryFeatures(h,r);case 4:return y=e.sent,m=y.features,v=y.exceededTransferLimit,g=y.fields,e.next=10,f._frameTask.schedule((function(){d&&(n+=(0,x.g)(h.num)),s+=m.length,a+=f._removeEmptyFeatures(m),t.featuresMissing=n<t.numFeatures||v,i=i?i.concat(m):m,c=Ee(c,g),t.setFeatures(i,a,c)}),r);case 10:if((0,x.W)(r),f._invalidateCounts(),f._setDirty(),u=f._maximumFeaturesForTile(t)-s,d&&v&&!(u<=0)){e.next=16;break}return e.abrupt("return",{v:v?o.DONE:o.FULL});case 16:case"end":return e.stop()}}),e)}));case 4:return e.delegateYield(h(),"t0",5);case 5:if("object"!==typeof(d=e.t0)){e.next=8;break}return e.abrupt("return",d.v);case 8:e.next=4;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createFeatureCountQuery",value:function(e){var t=this._createQuery(e);return this.context.capabilities.supportsCacheHint&&(t.resultType=void 0,t.cacheHint=!0),t}},{key:"_createQuery",value:function(e){var t=this.context.createQuery(),r=e.descriptor.extent;if(r){var i=this.context.tilingScheme.spatialReference;t.geometry=(0,O.f)(r,i)}return this._setResolutionParams(t,e),this._useTileQuery(e)?t.resultType="tile":this.context.capabilities.supportsCacheHint&&(t.cacheHint=!0),t}},{key:"_setPagingParameters",value:function(e,t,r,i){return!!this.context.capabilities.supportsPagination&&(e.start=t,r>0&&this.context.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(r/i),e.num=Math.min(e.maxRecordCountFactor*i,r)):e.num=Math.min(i),!0)}},{key:"_getEffectiveTileResolution",value:function(e){if(null==e.descriptor.resolution)return null;var t=this.context.viewingMode===M.l.Global?this.context.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)/this.lodFactor}},{key:"supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}},{key:"_setResolutionParams",value:function(e,t){if(this.supportsResolution){var r=this._getEffectiveTileResolution(t);null!=r&&(this.context.capabilities.supportsQuantization?e.quantizationParameters=new D.a({mode:"view",originPosition:"upper-left",tolerance:r,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(e.maxAllowableOffset=r))}}},{key:"_removeEmptyFeatures",value:function(e){for(var t=e.length,r=0;r<e.length;){var i=e[r];(0,P.S)(i.geometry)?++r:(e[r]=e[e.length-1],--e.length)}return t-e.length}},{key:"_needsNumFeatures",value:function(e){return this.useTileCount&&e.needsFeatureCount&&!ve(e)}},{key:"_getMaxRecordCount",value:function(e){var t=this.context,r=t.tileMaxRecordCount,i=t.maxRecordCount;return this._useTileQuery(e)&&(0,x.r)(r)&&r>0&&this.context.capabilities.supportsResultType?r:(0,x.r)(i)&&i>0?i:be}},{key:"_useTileQuery",value:function(e){return(!ve(e)||!this.context.capabilities.supportsCacheHint)&&this.context.capabilities.supportsResultType}},{key:"_handleRequest",value:function(e,t,r,i){var n=this;e.fetchStatus=e.needsRefetching?o.REFETCHING:o.FETCHING,e.requestController=r;var a=!1;t.then((function(t){e.requestController=null,e.fetchStatus=t})).catch((function(t){e.requestController===r&&(e.requestController=null,e.fetchStatus=o.DONE),(0,x.I)(t)?a=!0:i(t)})).then((function(){a||n._setDirty(),n._scheduleUpdated()}))}},{key:"_scheduleUpdated",value:function(){var e=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add((0,x.O)((function(){e.handles.remove("scheduleUpdated"),e._updated()})),"scheduleUpdated")}},{key:"_showTile",value:function(e){if((0,x.r)(e.displayingFeatures)&&!e.needsDisplayUpdate)return!1;var t=e.features;if(0===e.featureLimit||!t){var r=(0,x.r)(e.displayingFeatures)&&e.displayingFeatures.length>0;return this._hideTileFeatures(e),e.displayingFeatures=[],r}var i=e.descriptor.resolution,n=this.changes.updates,a=this.changes.adds,s=Math.min(e.featureLimit,t.length);e.featureLimit=s;for(var u=0;u<s;++u){var o=t[u],l=(0,P.O)(o,this.objectIdField),c=this.displayingFeatureReferences.get(l);if(c){var h=c.ref(o,i);h.oldVersion!==h.newVersion&&(n.removes.push(h.oldVersion),n.adds.push(h.newVersion))}else this.displayingFeatureReferences.set(l,new this.FeatureReferenceClass(o,i)),a.push(o);this.numDisplayingFeatureReferences++}return this._hideTileFeatures(e),this._applyChanges(),e.displayingFeatures=t.slice(0,s),!0}},{key:"_hideTile",value:function(e){this._cancelFetchTile(e),this._hideTileFeatures(e)}},{key:"_hideTileFeatures",value:function(e){if(!(0,x.t)(e.displayingFeatures)){var t,r=this.changes.updates,i=this.changes.removes,n=(0,g.Z)(e.displayingFeatures);try{for(n.s();!(t=n.n()).done;){var a=t.value,s=(0,P.O)(a,this.objectIdField),u=this.displayingFeatureReferences.get(s);if(u){var o=u.unref(e.descriptor.resolution);this.numDisplayingFeatureReferences--,o?o.oldVersion!==o.newVersion&&(null==o.newVersion?(this.displayingFeatureReferences.delete(s),i.push(o.oldVersion)):(r.adds.push(o.newVersion),r.removes.push(o.oldVersion))):console.error("Hiding unreferenced feature")}}}catch(l){n.e(l)}finally{n.f()}this._applyChanges(),e.displayingFeatures=null}}},{key:"_applyChanges",value:function(){var e=this.changes.updates;e.removes.length>0&&(this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this.features.addMany(e.adds),e.adds.length=0);for(var t=this.changes.adds,r=this.changes.removes,i=Math.min(t.length,r.length),n=0;n<i;){var a=Math.min(n+Re,i);this.features.addMany(t.slice(n,a)),this.features.removeMany(r.slice(n,a)),n=a}t.length>i&&this.features.addMany(0===n?t:t.slice(n)),r.length>i&&this.features.removeMany(0===n?r:r.slice(n)),t.length=0,r.length=0}},{key:"_clearTile",value:function(e){if(this._hideTile(e),e.features&&(0,x.r)(this.context.memoryCache)){var t=16+e.estimatedSize;this.context.memoryCache.put(e.id,e.cache,t)}e.setFeatures(null,0,null),this._invalidateCounts()}},{key:"_invalidateCounts",value:function(){this.notifyChange("totalVertices"),this.notifyChange("totalFeatures"),this.notifyChange("memoryForUnusedFeatures")}},{key:"_getListOfTiles",value:function(){return Array.from(this.featureTiles.values())}},{key:"storedFeatures",get:function(){return this._getListOfTiles().reduce((function(e,t){return e+(t.features?t.features.length:0)}),0)}},{key:"_maximumFeaturesForTile",value:function(e){var t=e.hasPreciseFeatureCount?e.numFeatures:1/0,r=e.hasPreciseFeatureCount?t:this.maximumNumberOfFeatures,i=this._fullRatio<1?this._farRatio:1;return Math.min(Math.ceil(r*i/(1-e.emptyFeatureRatio)),t)}},{key:"test",get:function(){var e=this;return{process:function(t){return e.runTask(t)},getFeatureTileById:function(t){return e.featureTiles.get(t)},forEachFeatureTile:function(t){return e.featureTiles.forEach(t)}}}}]),r}(x.y);function ve(e){return"dummy-tile-full-extent"===e.id}function ge(e){var t=e.capabilities.query;return{supportsMultipleResolutions:_e(e),supportsPagination:!(!t||!t.supportsPagination),supportsResultType:!(!t||!t.supportsResultType),supportsCacheHint:!(!t||!t.supportsCacheHint),supportsQuantization:!(!t||!t.supportsQuantization),supportsQuantizationEditMode:!(!t||!t.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!t||!t.supportsMaxRecordCountFactor),supportsFormatPBF:!(!t||!t.supportsFormatPBF)}}function _e(e){switch(e.geometryType){case"polyline":return!0;case"polygon":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}}function Fe(e){return e.setFeatures([],0,null),e.featuresMissing=!1,o.DONE}function xe(e){return(0,x.t)(e)?new Set:new Set(e.map((function(e){return e.name})))}function Ee(e,t){if((0,x.t)(e)||(0,x.t)(t))return xe(t);var r,i=new Set,n=(0,g.Z)(t);try{for(n.s();!(r=n.n()).done;){var a=r.value.name;e.has(a)&&i.add(a)}}catch(s){n.e(s)}finally{n.f()}return i}(0,x.e)([(0,x.d)({constructOnly:!0})],me.prototype,"features",void 0),(0,x.e)([(0,x.d)()],me.prototype,"tileDescriptors",void 0),(0,x.e)([(0,x.d)({value:1/0})],me.prototype,"maximumNumberOfFeatures",null),(0,x.e)([(0,x.d)({value:1})],me.prototype,"memoryFactor",null),(0,x.e)([(0,x.d)({value:1})],me.prototype,"lodFactor",null),(0,x.e)([(0,x.d)()],me.prototype,"useTileCount",null),(0,x.e)([(0,x.d)({readOnly:!0})],me.prototype,"updating",void 0),(0,x.e)([(0,x.d)({readOnly:!0})],me.prototype,"updatingTotal",void 0),(0,x.e)([(0,x.d)({readOnly:!0})],me.prototype,"updatingRemaining",void 0),(0,x.e)([(0,x.d)({readOnly:!0})],me.prototype,"expectedFeatureDiff",void 0),(0,x.e)([(0,x.d)({readOnly:!0})],me.prototype,"memoryForUnusedFeatures",null),(0,x.e)([(0,x.d)({readOnly:!0})],me.prototype,"maximumNumberOfFeaturesExceeded",void 0),(0,x.e)([(0,x.d)({constructOnly:!0})],me.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0),(0,x.e)([(0,x.d)({readOnly:!0})],me.prototype,"totalVertices",null),(0,x.e)([(0,x.d)({readOnly:!0})],me.prototype,"totalFeatures",null),(0,x.e)([(0,x.d)()],me.prototype,"filterExtent",null),(0,x.e)([(0,x.d)({constructOnly:!0})],me.prototype,"context",void 0),me=(0,x.e)([(0,x.n)("esri.views.3d.layers.support.FeatureTileFetcher3D")],me);var be=2e3,ke=(0,O.u)(),Te=(0,O.u)(),we=6e5,Re=200,Ce=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]],Se=function(){function e(t,r,i){(0,_.Z)(this,e),this.loadingGraphics=new Map,this.loadedGraphics=new Map,this.pendingGraphics=new Map,this._enabled=!0,this.tileFetcher=t,this.view=i,this.tilingScheme=new b.at(r),this.loadedSymbols=Ce.map((function(e){return new B.b(new B.G({material:{color:[e[0],e[1],e[2],.6]},outline:{color:"black",size:1}}))})),this.loadingSymbols=[new B.b(new B.G({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))],this.pendingSymbols=[new B.b(new B.G({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))],this.dataExtentSymbol=new B.b(new B.G({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}return(0,F.Z)(e,[{key:"destroy",value:function(){this.enabled=!1}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()}},{key:"update",value:function(){var e=this;this._enabled?(this._synchronizeMaps(this.loadingGraphics,{filter:function(e){return e.isFetching},symbols:this.loadingSymbols}),this._synchronizeMaps(this.loadedGraphics,{filter:function(e){return!e.isFetching},symbols:this.loadedSymbols}),this._synchronizeMaps(this.pendingGraphics,{filter:function(e){return!e.isFetching},symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadingGraphics.clear(),this.loadedGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.loadedGraphics.clear(),this.pendingGraphics.forEach((function(t){e.view.graphics.removeMany(t)})),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))}},{key:"showDataExtent",value:function(e){if(this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null),e){var t=V.v.fromExtent(e);this.dataExtentGraphic=new U.g({geometry:t,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic)}}},{key:"_synchronizeMaps",value:function(e,t){var r=this,i=[];e.forEach((function(e,n){var a=r.tileFetcher.test.getFeatureTileById(n);a&&t.filter(a)||(r.view.graphics.removeMany(e),i.push(n))})),i.forEach((function(t){return e.delete(t)})),this.tileFetcher.test.forEachFeatureTile((function(i){if(t.filter(i)&&!e.has(i.id)){var n=(0,f.Z)(i.descriptor.lij,3),a=n[0],s=n[1],u=n[2];r.tilingScheme.ensureMaxLod(a);var o=r.tilingScheme.getExtentGeometry(a,s,u),l=[new U.g({geometry:o,symbol:t.symbols[a%t.symbols.length]}),new U.g({geometry:o.center,symbol:new B.e({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new B.w({text:"".concat(a,"/").concat(s,"/").concat(u),halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})})];e.set(i.id,l),r.view.graphics.addMany(l)}}))}}]),e}(),Ie=x.s.getLogger("esri.layers.graphics.controllers.FeatureTileController3D"),De=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(e){var i;return(0,_.Z)(this,r),(i=t.call(this,e)).type="feature-tile-3d",i.watchUpdatingTracking=new C.c,i.serviceDataExtent=null,i.serviceDataCount=Oe.NO_SERVICE_DATA_COUNT,i.vertexLimitExceeded=!1,i.displayFeatureLimit=null,i.suspended=!1,i.tileFetcher=null,i.handles=new w.u,i.fetchDataInfoPromise=null,i.fetchDataInfoAbortController=null,i.lifeCycleAbortController=new AbortController,i}return(0,F.Z)(r,[{key:"extent",set:function(e){if(!e||e.spatialReference.equals(this.layerView.view.spatialReference)){var t=this._get("extent");if(t!==e&&!(t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("extent",r)}}else Ie.error("#extent=","extent needs to be in the same spatial reference as the view")}},{key:"updating",get:function(){return!!((0,x.r)(this.tileFetcher)&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)}},{key:"updatingTotal",get:function(){return this.updating&&(0,x.r)(this.tileFetcher)?this.tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&(0,x.r)(this.tileFetcher)?this.tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",get:function(){return this.updating&&(0,x.r)(this.tileFetcher)?this.tileFetcher.expectedFeatureDiff:0}},{key:"memoryForUnusedFeatures",get:function(){return(0,x.r)(this.tileFetcher)?this.tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(!(0,x.r)(this.tileFetcher)||!this.tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"maximumNumberOfFeatures",get:function(){return(0,x.r)(this.displayFeatureLimit)?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(e){e!==this.maximumNumberOfFeatures&&(null==e?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",e))}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"mode",get:function(){var e,t,r=this.layerView.layer;if("feature"===r.type&&(0,x.r)(r.infoFor3D))return"snapshot";if(!1===(null===(e=this.layerView.view.qualitySettings)||void 0===e||null===(t=e.graphics3D)||void 0===t?void 0:t.snapshotAvailable)||this.serviceDataCount===Oe.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var i=this.layerView.view,n=i&&i.featureTiles,a=n&&n.tilingScheme;if(r&&r.minScale&&this.serviceDataExtent&&a){var s=this._approximateExtentSizeAtScale(r.minScale,a);if((this.serviceDataExtent.width/s+this.serviceDataExtent.height/s)/2>Oe.MAX_SNAPSHOT_MIN_SCALE_FACTOR)return"tiles"}return!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){var e=this._get("maxTotalSnapshotVertices")||0,t="snapshot"===this.mode&&(0,x.r)(this.tileFetcher)&&this.tileFetcher.totalVertices||0;return Math.max(e,t)}},{key:"_approximateExtentSizeAtScale",value:function(e,t){var r=this.layerView.view,i=Math.ceil((r.width/t.pixelSize+r.height/t.pixelSize)/2),n=t.levels[0];return i*((n.tileSize[0]/(n.scale/e)+n.tileSize[1]/(n.scale/e))/2)}},{key:"tileDescriptors",get:function(){return"snapshot"===this.mode?new T.j([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new T.j}},{key:"test",get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}}},{key:"initialize",value:function(){var e=this;this.watchUpdatingTracking.add((function(){return e.vertexLimitInfo}),(function(){return e.watchUpdatingTracking.addPromise(e._updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))})),this.watchUpdatingTracking.add((function(){return e.mode}),(function(){return e._modeChanged()}),E.h),this.addResolvingPromise(Promise.resolve().then((function(){return e._verifyCapabilities()})).then((function(){return e.watchUpdatingTracking.addPromise(e._fetchServiceDataInfo())})).then((function(){return e._initializeTileFetcher()})))}},{key:"_verifyCapabilities",value:function(){var e=this.layerView.layer;if(!e.get("capabilities.operations.supportsQuery")&&"ogc-feature"!==e.type)throw new x.a("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:e})}},{key:"destroy",value:function(){this._cancelFetchServiceDataInfo(),this.tileFetcher=(0,x.G)(this.tileFetcher),this.handles=(0,x.G)(this.handles),this.tilesHandle=(0,x.z)(this.tilesHandle),this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null),this.watchUpdatingTracking.destroy(),this._set("watchUpdatingTracking",null)}},{key:"suspend",value:function(){this.suspended||(this.suspended=!0,(0,x.r)(this.tileFetcher)&&this.tileFetcher.suspend())}},{key:"resume",value:function(){this.suspended&&(this.suspended=!1,(0,x.r)(this.tileFetcher)&&this.tileFetcher.resume())}},{key:"restart",value:function(){var e=this,t=function(){(0,x.r)(e.tileFetcher)&&e.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(t,t))}},{key:"refetch",value:function(){var e=this,t=function(){(0,x.r)(e.tileFetcher)&&e.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(t,t))}},{key:"_initializeTileFetcher",value:function(){var e=this,t=this.layerView.view;if(t){var r=(0,E.j)((function(){var e;return null===(e=t.featureTiles)||void 0===e?void 0:e.tilingScheme}),this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(r),r.then((function(){var r=e.layerView,i=e.tileDescriptors,n=r.layer,a=new me({context:e.context,filterExtent:e.extent,tileDescriptors:i,features:e.graphics});e.tileFetcher=a,e.suspended?e.tileFetcher.suspend():e.tileFetcher.resume();var s=e.layerView.view.resourceController;s&&e.handles.add((0,E.l)((function(){return s.memoryController.memoryFactor}),(function(e){return a.memoryFactor=e}),E.w));var u="polygon"===e.context.geometryType?"polygonLodFactor":"polyline"===e.context.geometryType?"polylineLodFactor":null;u&&e.handles.add((0,E.l)((function(){var t,r,i;return null===(t=e.layerView.view)||void 0===t||null===(r=t.qualitySettings)||void 0===r||null===(i=r.graphics3D)||void 0===i?void 0:i[u]}),(function(e){return a.lodFactor=e||1}),E.h));"ogc-feature"!==n.type&&e.watchUpdatingTracking.add((function(){return n.createQueryVersion}),(function(){return e._dataFilterChanged()})),e.watchUpdatingTracking.add((function(){return r.availableFields}),(function(t,r){return e._availableFieldsChanged(r,t)})),e.watchUpdatingTracking.add((function(){return r.requiredFields}),(function(t,r){return e._requiredFieldsChanged(r,t)})),e.handles.add([n.on("apply-edits",(function(t){return e._applyEdits(t)})),(0,E.l)((function(){return e.extent}),(function(e){return a.filterExtent=e}),E.U),(0,E.l)((function(){return e.tileDescriptors}),(function(e){return a.tileDescriptors=e}),E.U),(0,E.l)((function(){return e.maximumNumberOfFeatures}),(function(t){a.maximumNumberOfFeatures=t,a.useTileCount=e.serviceDataCount>t}),E.w),(0,E.l)((function(){return e.serviceDataCount}),(function(t){return a.useTileCount=t>e.maximumNumberOfFeatures}),E.w),(0,E.l)((function(){return b.B.FEATURE_TILE_FETCH_SHOW_TILES}),(function(r){r&&a&&!a.debugger?(a.debugger=new Se(a,t.featureTiles.tilingScheme.toTileInfo(),t),a.debugger.update()):!r&&e.tileFetcher&&a.debugger&&(a.debugger.destroy(),a.debugger=null)}),E.w)]),e.supportsExceedsLimitQuery||e.watchUpdatingTracking.add((function(){return e.maxTotalSnapshotVertices}),(function(){return e.watchUpdatingTracking.addPromise(e._updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))}))})).catch((function(){}))}}},{key:"_modeChanged",value:function(){switch(this.mode){case"tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:Ie.warn("Unhandled feature layer mode "+this.mode);case"snapshot":(0,x.r)(this.tilesHandle)&&(this.tilesHandle.remove(),this.tilesHandle=null)}}},{key:"_dataFilterChanged",value:function(){this._set("maxTotalSnapshotVertices",0),this.notifyChange("maxTotalSnapshotVertices"),this.refetch()}},{key:"_applyEdits",value:function(e){var t=this;(0,x.t)(this.tileFetcher)||this.tileFetcher.applyEdits(e).then((function(e){e&&(e.deletedFeatures.length||e.updatedFeatures.length||e.addedFeatures.length)&&t.watchUpdatingTracking.addPromise(t._updateServiceDataExtent(t.lifeCycleAbortController.signal))})).catch((function(e){if(!(0,x.I)(e))throw e}))}},{key:"_availableFieldsChanged",value:function(e,t){(0,x.r)(this.tileFetcher)&&Ze(this.tileFetcher.availableFields,t)&&this.refetch()}},{key:"_requiredFieldsChanged",value:function(e,t){(0,x.r)(this.tileFetcher)&&Ze(this.tileFetcher.availableFields,t)&&this.restart()}},{key:"_createVertexLimitExceededQuery",value:function(e){var t=this.layerView.layer,r=t.createQuery();return r.outStatistics=[new D.m({statisticType:"exceedslimit",maxVertexCount:e,outStatisticFieldName:"exceedslimit",maxPointCount:1e8,maxRecordCount:1e8})],t.capabilities.query.supportsCacheHint&&(r.cacheHint=!0),r}},{key:"_createDataInfoQuery",value:function(){var e=this.layerView.layer,t=e.createQuery();return t.outSpatialReference=this.layerView.view.spatialReference,e.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}},{key:"_fullExtentIsAccurate",value:function(){var e=this.layerView.layer;if(e.definitionExpression)return!1;switch(e.type){case"feature":return(0,S.g)(e.url);case"csv":case"geojson":case"ogc-feature":case"wfs":return!0;default:return}}},{key:"_updateServiceDataExtent",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t){return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._tryUpdateServiceDataExtent(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),(0,x.I)(e.t0)||this._set("serviceDataExtent",(0,x.m)(this.layerView.fullExtentInLocalViewSpatialReference));case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_tryUpdateServiceDataExtent",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t){var r,i,n,a,s,u,o,l,c,h,d;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.layerView,i=r.layer,n=i.capabilities.query.supportsExtent,a=(0,x.m)(r.fullExtentInLocalViewSpatialReference),s=i.fullExtent,u=this._fullExtentIsAccurate(),o=this.serviceDataCount,!(n&&o<=Oe.MAX_FEATURE_COUNT_FOR_EXTENT)||a&&u||!("queryExtent"in i)){e.next=9;break}return l=this._createDataInfoQuery(),e.next=5,i.queryExtent(l,{timeout:Oe.QUERY_EXTENT_TIMEOUT,signal:t});case 5:c=e.sent,this._set("serviceDataExtent",c.extent),e.next=22;break;case 9:if(!a){e.next=13;break}this._set("serviceDataExtent",a),e.next=22;break;case 13:if(!(0,x.r)(s)){e.next=21;break}return h="portalItem"in i?i.portalItem:null,e.next=17,(0,I.projectGeometry)(s,r.view.spatialReference,h,t);case 17:d=e.sent,this._set("serviceDataExtent",d),e.next=22;break;case 21:this._set("serviceDataExtent",null);case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateServiceDataCount",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t){var r,i;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("queryFeatureCount"in(r=this.layerView.layer)){e.next=3;break}return e.abrupt("return",void this._set("serviceDataCount",Oe.NO_SERVICE_DATA_COUNT));case 3:return e.next=5,(0,k.a)(r.queryFeatureCount(this._createDataInfoQuery(),{timeout:Oe.QUERY_STATISTICS_TIMEOUT,signal:t}));case 5:if(!0!==(i=e.sent).ok){e.next=10;break}this._set("serviceDataCount",i.value),e.next=13;break;case 10:if(!(0,x.I)(i.error)){e.next=12;break}throw i.error;case 12:this._set("serviceDataCount",Oe.NO_SERVICE_DATA_COUNT);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"vertexLimitInfo",get:function(){if((0,x.t)(this.displayFeatureLimit)||(0,x.t)(this.displayFeatureLimit.averageSymbolComplexity))return null;var e=this.displayFeatureLimit,t=e.averageSymbolComplexity,r=e.maximumTotalNumberOfPrimitives,i=t.primitivesPerCoordinate,n=t.primitivesPerFeature,a=this._get("vertexLimitInfo");return(0,x.t)(a)||a.maximumTotalNumberOfPrimitives!==r||a.primitivesPerCoordinate!==i||a.primitivesPerFeature!==n?{primitivesPerCoordinate:i,primitivesPerFeature:n,maximumTotalNumberOfPrimitives:r}:a}},{key:"supportsExceedsLimitQuery",get:function(){var e=this.layerView.layer;return e.capabilities&&e.capabilities.operations&&e.capabilities.operations.supportsExceedsLimitStatistics}},{key:"minimumNumberOfVerticesForGeometry",get:function(){switch(this.layerView.layer.geometryType){case"point":case"multipoint":return 1;case"polygon":return 4;case"polyline":return 2;case"multipatch":case"mesh":return 3;default:return 0}}},{key:"_updateVertexLimitExceeded",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t,r){var i,n,a,s,u,o,l,c,h,d,f;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.vertexLimitInfo,!(0,x.t)(i)){e.next=3;break}return e.abrupt("return",void this._set("vertexLimitExceeded",!1));case 3:if(n=i.primitivesPerFeature<=0,a=this.minimumNumberOfVerticesForGeometry>1,n||a){e.next=6;break}return e.abrupt("return",void this._set("vertexLimitExceeded",!1));case 6:if(s=i.primitivesPerFeature,u=i.primitivesPerCoordinate,o=i.maximumTotalNumberOfPrimitives,e.t0=0!==s&&(0,x.r)(t),!e.t0){e.next=11;break}return e.next=11,t;case 11:if(c=this.serviceDataCount,h=c!==Oe.NO_SERVICE_DATA_COUNT,l=h?Math.ceil((o-c*s)/(u||1)):Math.ceil(o/(u||1)),a&&(l=Math.min(l,Me)),!(h&&this.minimumNumberOfVerticesForGeometry*c>l)){e.next=14;break}return e.abrupt("return",void this._set("vertexLimitExceeded",!0));case 14:if(this.supportsExceedsLimitQuery){e.next=16;break}return e.abrupt("return",void this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>l));case 16:return e.next=18,(0,k.a)(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(l),{timeout:Oe.QUERY_STATISTICS_TIMEOUT,signal:r}));case 18:if(!1!==(d=e.sent).ok){e.next=23;break}if(!(0,x.I)(d.error)){e.next=22;break}throw d.error;case 22:return e.abrupt("return",void this._set("vertexLimitExceeded",!1));case 23:(f=d.value.features[0])&&f.attributes?this._set("vertexLimitExceeded",!!f.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);case 25:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_fetchServiceDataInfo",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(){var t,r,i,n,a,s=this;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._cancelFetchServiceDataInfo(),t=new AbortController,r=t.signal,i=this._updateServiceDataCount(r),n=(0,x.E)([i,this._updateVertexLimitExceeded(i,r)]),a=n.then((function(){return s._updateServiceDataExtent(r)})).catch((function(e){(0,x.I)(e)||Ie.error("#fetchServiceDataInfo()",e)})).then((function(){a===s.fetchDataInfoPromise&&(s.fetchDataInfoPromise=null,s.fetchDataInfoAbortController=null),t=null})),e.abrupt("return",(t&&(this.fetchDataInfoPromise=a),this.fetchDataInfoAbortController=t,n.then((function(){}),(function(){}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_cancelFetchServiceDataInfo",value:function(){var e=this.fetchDataInfoAbortController;e&&(this.fetchDataInfoAbortController=null,this.fetchDataInfoPromise=null,e.abort())}},{key:"debug",get:function(){return{storedFeatures:(0,x.r)(this.tileFetcher)?this.tileFetcher.storedFeatures:0,totalFeatures:(0,x.r)(this.tileFetcher)?this.tileFetcher.totalFeatures:0,totalVertices:(0,x.r)(this.tileFetcher)?this.tileFetcher.totalVertices:0}}}]),r}((0,R.m)(x.y));(0,x.e)([(0,x.d)({readOnly:!0})],De.prototype,"type",void 0),(0,x.e)([(0,x.d)({constructOnly:!0})],De.prototype,"graphics",void 0),(0,x.e)([(0,x.d)({constructOnly:!0})],De.prototype,"layerView",void 0),(0,x.e)([(0,x.d)({constructOnly:!0})],De.prototype,"context",void 0),(0,x.e)([(0,x.d)()],De.prototype,"extent",null),(0,x.e)([(0,x.d)()],De.prototype,"updating",null),(0,x.e)([(0,x.d)({readOnly:!0})],De.prototype,"watchUpdatingTracking",void 0),(0,x.e)([(0,x.d)()],De.prototype,"updatingTotal",null),(0,x.e)([(0,x.d)()],De.prototype,"updatingRemaining",null),(0,x.e)([(0,x.d)()],De.prototype,"expectedFeatureDiff",null),(0,x.e)([(0,x.d)()],De.prototype,"memoryForUnusedFeatures",null),(0,x.e)([(0,x.d)()],De.prototype,"maximumNumberOfFeaturesExceeded",null),(0,x.e)([(0,x.d)({readOnly:!0})],De.prototype,"serviceDataExtent",void 0),(0,x.e)([(0,x.d)({readOnly:!0})],De.prototype,"serviceDataCount",void 0),(0,x.e)([(0,x.d)({readOnly:!0})],De.prototype,"vertexLimitExceeded",void 0),(0,x.e)([(0,x.d)()],De.prototype,"displayFeatureLimit",void 0),(0,x.e)([(0,x.d)({type:Number})],De.prototype,"maximumNumberOfFeatures",null),(0,x.e)([(0,x.d)({readOnly:!0})],De.prototype,"mode",null),(0,x.e)([(0,x.d)({readOnly:!0})],De.prototype,"maxTotalSnapshotVertices",null),(0,x.e)([(0,x.d)({readOnly:!0,dependsOn:["mode"]})],De.prototype,"tileDescriptors",null),(0,x.e)([(0,x.d)()],De.prototype,"tileFetcher",void 0),(0,x.e)([(0,x.d)()],De.prototype,"fetchDataInfoPromise",void 0),(0,x.e)([(0,x.d)({readOnly:!0})],De.prototype,"vertexLimitInfo",null),De=(0,x.e)([(0,x.n)("esri.layers.graphics.controllers.FeatureTileController3D")],De);var Oe,Pe,Me=5e6;function Ze(e,t){if(!t)return!1;var r,i=(0,g.Z)(t);try{for(i.s();!(r=i.n()).done;){var n=r.value;if(!e.has(n))return!0}}catch(a){i.e(a)}finally{i.f()}return!1}function Ne(){var e=new K.a;return e.include(b.au),e.include(K.by),e.fragment.uniforms.add([new K.B("densityMap",(function(e){return e.densityMap})),new K.B("tex",(function(e){return e.colorRamp})),new K.p("densityNormalizer",(function(e){return 1/(e.maxDensity-e.minDensity)})),new K.p("minDensity",(function(e){return e.minDensity}))]),e.fragment.uniforms.add(new K.p("densityMultiplier",(function(e){return 3/(e.searchRadius*e.searchRadius*Math.PI)}))),e.fragment.code.add((0,K.n)(i||(i=(0,d.Z)(["void main() {\nfloat density = texture2D(densityMap, uv).r * densityMultiplier;\nfloat densityRatio = (density - minDensity) * densityNormalizer;\nvec4 color = texture2D(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));\ndiscardOrAdjustAlpha(color);\ngl_FragColor = color;\n}"])))),e}(Pe=Oe||(Oe={})).NO_SERVICE_DATA_COUNT=1/0,Pe.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5,Pe.reset=function(){Pe.MAX_FEATURE_COUNT_FOR_EXTENT=1e4,Pe.QUERY_STATISTICS_TIMEOUT=12e3,Pe.QUERY_EXTENT_TIMEOUT=1e4},Oe.reset();var Ve=Object.freeze(Object.defineProperty({__proto__:null,build:Ne},Symbol.toStringTag,{value:"Module"})),Ae=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){var e;return(0,_.Z)(this,r),(e=t.apply(this,arguments)).colorRamp=null,e.densityMap=null,e.searchRadius=1,e.fieldTotal=0,e.minDensity=0,e.maxDensity=100,e}return(0,F.Z)(r)}(K.l),Le=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(e,i){var n;return(0,_.Z)(this,r),n=t.call(this,e,i,(function(){return n.destroy()}))}return(0,F.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get().build();return new K.h(e.rctx,t,K.E)}},{key:"initializePipeline",value:function(){return(0,J.W)({blending:J.d,colorWrite:J.c,depthTest:null,depthWrite:null})}},{key:"primitiveType",get:function(){return $.E.TRIANGLE_STRIP}}]),r}(K.g);Le.shader=new K.t(Ve,(function(){return r.e(216).then(r.bind(r,10216))}));var Ue=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(e){var i;return(0,_.Z)(this,r),(i=t.call(this,e)).pixelRatio=1,i._colorRampData=new Uint8ClampedArray(4),i.type="draped-heatmap",i._heatmapParameters=new Ae,i}return(0,F.Z)(r,[{key:"initialize",value:function(){var e=this,t={colorTarget:$.Y.TEXTURE,depthStencilTarget:$.V.NONE,width:0,height:0},r=this.rctx.capabilities,i=r.colorBufferFloat.R32F,n=r.textureFloat.textureFloatLinear,a=null!=i,s={target:$.M.TEXTURE_2D,pixelFormat:a?$.P.RED:$.P.RGBA,internalFormat:a?$.U.R32F:$.P.RGBA,dataType:$.G.FLOAT,samplingMode:n?$.L.LINEAR:$.L.NEAREST,wrapMode:$.D.CLAMP_TO_EDGE,width:0,height:0};this._densityMap=new ee.D(this.rctx,t,s),this._quad=(0,K.u)(this.rctx);var u=this._colorRampData,o={target:$.M.TEXTURE_2D,pixelFormat:$.P.RGBA,dataType:$.G.UNSIGNED_BYTE,samplingMode:$.L.LINEAR,wrapMode:$.D.CLAMP_TO_EDGE,width:u.length/4,height:1};this._colorRamp=new te.u(this.rctx,o,u),this._technique=new Le({rctx:this.rctx,viewingMode:M.l.Local},new K.k),this._heatmapParameters.densityMap=this._densityMap.colorTexture,this.own((0,E.l)((function(){return[e.colorRampData,e.minDensity,e.maxDensity,e.fieldTotal,e.pixelRatio,e.searchRadius]}),(function(){return e.rendererContext.notifyContentChanged()})))}},{key:"destroy",value:function(){this._technique=(0,x.aP)(this._technique),this._densityMap=(0,x.aQ)(this._densityMap),this._quad=(0,x.aQ)(this._quad),this._colorRamp=(0,x.aQ)(this._colorRamp)}},{key:"searchRadius",get:function(){return this._heatmapParameters.searchRadius},set:function(e){e!==this._heatmapParameters.searchRadius&&(this._heatmapParameters.searchRadius=e,this.notifyChange("searchRadius"))}},{key:"minDensity",get:function(){return this._heatmapParameters.minDensity},set:function(e){e!==this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=e,this.notifyChange("minDensity"))}},{key:"maxDensity",get:function(){return this._heatmapParameters.maxDensity},set:function(e){e!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=e,this.notifyChange("maxDensity"))}},{key:"fieldTotal",get:function(){return this._heatmapParameters.fieldTotal},set:function(e){this._heatmapParameters.fieldTotal=e,this.notifyChange("fieldTotal")}},{key:"colorRampData",get:function(){return this._colorRampData},set:function(e){var t=this._heatmapParameters.colorRamp;if((0,x.r)(t)&&e!==this._colorRampData){var r=t.descriptor.width,i=e.length/4;i!==r&&t.resize(i,1),t.setData(e)}this._colorRampData=e}},{key:"_colorRamp",get:function(){return this._heatmapParameters.colorRamp},set:function(e){this._heatmapParameters.colorRamp=e}},{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",get:function(){return!1}},{key:"render",value:function(e,t){var r=this._sortedMaterialRenderers,i=r.length;if(!(i<1)){var n=this.rctx.getBoundFramebufferObject(),a=this.rctx.getViewport(),s=this.pixelRatio,u=Math.ceil(a.width*s),o=Math.ceil(a.height*s);this._densityMap.resize(u,o),this.rctx.bindFramebuffer(this._densityMap),this.rctx.setViewport(0,0,u,o),this.rctx.clear($._.COLOR_BUFFER_BIT);for(var l=!1,c=0;c<i;c++){var h=r.getItemAt(c);h.material.shouldRender(e)&&(l=l||h.materialRenderer.render(e.pass,t))}this.rctx.bindFramebuffer(n),this.rctx.setViewport(a.x,a.y,a.width,a.height),l&&(this.rctx.bindVAO(this._quad),this.rctx.useProgram(this._technique.program),this._technique.bindPipelineState(this.rctx),this._technique.bindPass(this._heatmapParameters,e.bindParameters),this.rctx.drawArrays(this._technique.primitiveType,0,(0,ee.n)(this._quad,"geometry")))}}}]),r}(b.av);function Be(e){var t=new K.a;(0,K.P)(t,e);var r=e.isAttributeDriven;return t.attributes.add(re.O.POSITION,"vec3"),t.attributes.add(re.O.UV0,"vec2"),r&&(t.attributes.add(re.O.FEATUREATTRIBUTE,"float"),t.varyings.add("attributeValue","float")),t.varyings.add("unitCirclePos","vec2"),t.vertex.uniforms.add(new K.p("radius",(function(e,t){var r=e.resolutionForScale,i=e.searchRadius,n=t.camera,a=t.screenToWorldRatio;return 2*i*(0===r?1:r/a)*n.pixelRatio/n.fullViewport[2]}))),t.vertex.code.add((0,K.n)(n||(n=(0,d.Z)(["\n    void main() {\n      unitCirclePos = uv0;\n\n      vec4 posProj = proj * (view * vec4(",", 1.0));\n      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);\n\n      ","\n      gl_Position = posProj + quadOffset;\n    }\n  "])),re.O.POSITION,r?(0,K.n)(a||(a=(0,d.Z)(["attributeValue = ",";"])),re.O.FEATUREATTRIBUTE):"")),t.fragment.code.add((0,K.n)(s||(s=(0,d.Z)(["\n    void main() {\n      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);\n      if (radiusRatioSquared > 1.0) {\n        discard;\n      }\n\n      float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;\n      float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ",";\n      gl_FragColor = vec4(density);\n    }\n  "])),r?(0,K.n)(u||(u=(0,d.Z)([" * attributeValue"]))):"")),t}(0,x.e)([(0,x.d)()],Ue.prototype,"searchRadius",null),(0,x.e)([(0,x.d)()],Ue.prototype,"minDensity",null),(0,x.e)([(0,x.d)()],Ue.prototype,"maxDensity",null),(0,x.e)([(0,x.d)()],Ue.prototype,"fieldTotal",null),(0,x.e)([(0,x.d)()],Ue.prototype,"pixelRatio",void 0),(0,x.e)([(0,x.d)()],Ue.prototype,"colorRampData",null),(0,x.e)([(0,x.d)()],Ue.prototype,"_colorRampData",void 0),Ue=(0,x.e)([(0,x.n)("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],Ue);var qe,Ge=Object.freeze(Object.defineProperty({__proto__:null,build:Be},Symbol.toStringTag,{value:"Module"}));!function(e){e[e.Screen=0]="Screen",e[e.World=1]="World"}(qe||(qe={}));var ze=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){var e;return(0,_.Z)(this,r),(e=t.apply(this,arguments)).searchRadius=128,e.resolutionForScale=0,e}return(0,F.Z)(r)}(K.ai),He=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,_.Z)(this,r),t.apply(this,arguments)}return(0,F.Z)(r,[{key:"initializeProgram",value:function(e){var t=r.shader.get().build(this.configuration);return new K.h(e.rctx,t,K.E)}},{key:"initializePipeline",value:function(){return(0,J.W)({blending:(0,J.s)($.R.ONE,$.R.ONE,$.T.ADD),colorWrite:J.c,depthTest:null,depthWrite:null})}},{key:"destroy",value:function(){(0,c.Z)((0,h.Z)(r.prototype),"destroy",this).call(this)}}]),r}(K.g);He.shader=new K.t(Ge,(function(){return r.e(957).then(r.bind(r,20957))}));var je=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){var e;return(0,_.Z)(this,r),(e=t.apply(this,arguments)).isAttributeDriven=!1,e}return(0,F.Z)(r)}(K.a2);(0,x.e)([(0,K.j)()],je.prototype,"isAttributeDriven",void 0);var Qe=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){var e;return(0,_.Z)(this,r),(e=t.apply(this,arguments)).isAttributeDriven=!1,e}return(0,F.Z)(r)}(ze),We=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(e){var i;return(0,_.Z)(this,r),(i=t.call(this,e,new Qe))._techniqueConfig=new je,i}return(0,F.Z)(r,[{key:"requiresSlot",value:function(e,t){return e===K.C.DRAPED_MATERIAL&&t===K.K.MATERIAL}},{key:"getConfiguration",value:function(){return this._techniqueConfig.isAttributeDriven=this.parameters.isAttributeDriven,this._techniqueConfig}},{key:"createGLMaterial",value:function(e){return new Xe(e)}},{key:"intersect",value:function(e,t,r,i,n,a,s,u,o){if(!(0,x.t)(o)&&(0,ae.T)(a))for(var l=e.vertexAttributes.get(re.O.POSITION),c=this.parameters.searchRadius,h=e.screenToWorldRatio,d=c*h+2*h,f=d*d,p=l.data.length/l.size,y=0;y<p;y++){var m=y*l.size,v=(0,ie.r)(et,l.data[m],l.data[m+1]);(0,ie.b)(v,a)<f&&s(o.dist,o.normal,-1,!1)}}},{key:"createBufferWriter",value:function(){return new Ye(this.parameters.isAttributeDriven?Ke:Je)}}]),r}(K.a3),Xe=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){return(0,_.Z)(this,r),t.apply(this,arguments)}return(0,F.Z)(r,[{key:"beginSlot",value:function(e){return this.ensureTechnique(He,e)}}]),r}(K.ah),Ye=function(){function e(t){(0,_.Z)(this,e),this.vertexBufferLayout=t}return(0,F.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get(re.O.POSITION).length*$e}},{key:"write",value:function(e,t,r,i){(0,K.aa)(t.indices.get(re.O.POSITION),t.vertexAttributes.get(re.O.POSITION).data,e.transformation,r.position,i,$e);for(var n=t.indices.get(re.O.POSITION).length,a=r.uv0,s=i,u=0;u<n;++u)a.setValues(s++,-1,-1),a.setValues(s++,1,-1),a.setValues(s++,1,1),a.setValues(s++,1,1),a.setValues(s++,-1,1),a.setValues(s++,-1,-1);var o="featureAttribute"in r?r.featureAttribute:null;o&&(0,K.bz)(t.indices.get(re.O.FEATUREATTRIBUTE),t.vertexAttributes.get(re.O.FEATUREATTRIBUTE).data,o,i,$e)}}]),e}(),Je=(0,se.T)().vec3f(re.O.POSITION).vec2f(re.O.UV0),Ke=Je.clone().f32(re.O.FEATUREATTRIBUTE),$e=6,et=(0,ne.n)(),tt=x.s.getLogger("esri.views.3d.layers.support.HeatmapFeatureProcessor"),rt=112,it=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(e){var i;return(0,_.Z)(this,r),(i=t.call(this,e)).type="heatmap",i.filterVisibility={filterChanged:function(){},dirty:!1},i.preferredUpdatePolicy=J.o.ASYNC,i.dataExtent=null,i.drapeSourceType=b.e.Features,i._renderGeometries=new Map,i._material=new We({}),i._materialWithField=new We({isAttributeDriven:!0}),i._fieldTotal=0,i._drapeSourceRenderer=null,i}return(0,F.Z)(r,[{key:"initialize",value:function(){var e=this;this._featureStore=new W.u({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});var t=this._renderView.capabilities,r=t.colorBufferFloat,i=t.textureFloat,n=this._renderView.renderingContext.driverTest.floatBufferBlendWorking;if(null===i||void 0===i||!i.textureFloat)throw new x.a("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float.");if(null===r||void 0===r||!r.textureFloat)throw new x.a("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL2 extension EXT_color_buffer_float or the WebGL1 extension WEBGL_color_buffer_float.");if(null===r||void 0===r||!r.floatBlend)throw new x.a("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend.");if(!n)throw new x.a("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend. This device claims support for it, but does not actually support it.");this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerDrapeSource(this,Ue,this._rendererParameters),this.updatingHandles.addOnCollectionChange((function(){return e._loadedPointGraphics}),(function(t){return e._onLoadedFeaturesChange(t)}),E.h),this.updatingHandles.addWhen((function(){return e._materialParameters}),(function(t){return e._forEachMaterial((function(e){return e.setParameters(t)}))}),E.h),this.updatingHandles.add((function(){return e._rendererParameters}),(function(t){return e._drapeSourceRenderer.set(t)})),this.updatingHandles.add((function(){return e._heatmapRendererField}),(function(){e._recreate()}),E.U),this.updatingHandles.add((function(){return{fieldName:e._heatmapRendererFieldName,numeric:e._heatmapRendererFieldIsNumeric}}),(function(t){var r=t.fieldName,i=t.numeric;if((0,x.r)(r)&&i){var n=0;e._featureStore.forEach((function(e){var t;return n+=null!==(t=e.attributes[r])&&void 0!==t?t:0})),e._fieldTotal=n}else e._fieldTotal=e._featureStore.numFeatures}),E.h),this.handles.add([(0,E.l)((function(){return{fieldName:e._heatmapRendererFieldName,field:e._heatmapRendererField}}),(function(t){var r,i=t.fieldName,n=t.field;i&&!n&&tt.warn("Heatmap renderer field '".concat(i,"' for layer '").concat(null!==(r=e.layer.title)&&void 0!==r?r:e.layer.id,"' not found"))})),(0,E.l)((function(){return{field:e._heatmapRendererField,numeric:e._heatmapRendererFieldIsNumeric}}),(function(t){var r,i=t.field,n=t.numeric;(0,x.r)(i)&&!n&&tt.warn("Heatmap renderer field '".concat(i.name,"' for layer '").concat(null!==(r=e.layer.title)&&void 0!==r?r:e.layer.id,"' does not contain numeric values and cannot be used to drive the heatmap density"))})),(0,x.p)((function(){return e.view.basemapTerrain.overlayManager.unregisterDrapeSource(e)}))])}},{key:"destroy",value:function(){this._renderGeometries.clear(),this._material=(0,x.aQ)(this._material),this._materialWithField=(0,x.aQ)(this._materialWithField),this._featureStore.clear(),this._featureStore=null}},{key:"layer",get:function(){return this.owner.layer}},{key:"featureStore",get:function(){return this._featureStore}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"updatingRemaining",get:function(){return 0}},{key:"suspendInfo",get:function(){return{}}},{key:"legendEnabled",get:function(){return!0}},{key:"displayFeatureLimit",get:function(){var e,t,r,i,n,a,s,u=null!==(e=null===(t=this.owner)||void 0===t||null===(r=t.view)||void 0===r||null===(i=r.resourceController)||void 0===i||null===(n=i.memoryController)||void 0===n?void 0:n.memoryFactor)&&void 0!==e?e:1,o=null===(a=this.owner)||void 0===a||null===(s=a.view)||void 0===s?void 0:s.qualitySettings,l=o?Math.ceil(o.heatmap.maxTotalNumberOfFeatures*u):0;return{minimumTotalNumberOfFeatures:0,maximumTotalNumberOfFeatures:l,maximumTotalNumberOfPrimitives:2*l,maximumNumberOfFeatures:l}}},{key:"hasZ",get:function(){return"hasZ"in this.layer&&this.layer.hasZ}},{key:"hasM",get:function(){return"hasM"in this.layer&&this.layer.hasM}},{key:"view",get:function(){return this.owner.view}},{key:"fullOpacity",get:function(){return this.owner.fullOpacity}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}},{key:"scaleVisibilitySuspended",get:function(){return!1}},{key:"usedMemory",get:function(){var e,t,r,i,n,a=this.usedMemoryPerFeature*this._featureStore.numFeatures,s=null!=(null===(e=this._renderView)||void 0===e||null===(t=e.capabilities)||void 0===t?void 0:t.colorBufferFloat).R32F?1:4,u=null!==(r=Math.ceil((null===(i=this._overlayRenderer)||void 0===i||null===(n=i.overlays[0])||void 0===n?void 0:n.resolution)*this._densityMapPixelRatio))&&void 0!==r?r:0;return u*u*s*4+a+((0,x.r)(this._heatmapRenderer)?(0,G.u)(Math.min(this._heatmapRenderer.radius,rt)):0)*s*4}},{key:"usedMemoryPerFeature",get:function(){if(0===this._featureStore.numFeatures)return 0;var e=0;this._featureStore.forEach((function(t){return e+=(0,Z.r)(t.attributes)})),e/=this._featureStore.numFeatures;var t=(0,Z.t)();return 6*(0,Z.e)([0,0,0],t)+6*(0,Z.e)([0,0],t)+(this._heatmapRendererFieldIsNumeric?6*t:0)+e}},{key:"unprocessedMemoryEstimate",get:function(){return 0}},{key:"performanceInfo",get:function(){return{core:{visible:this._featureStore.numFeatures,missing:0,pending:0},elevationUpdating:!1,visibilityFrustum:!0,visibilityScale:!0}}},{key:"_overlayRenderer",get:function(){return this.view.basemapTerrain.overlayManager.renderer}},{key:"_overlaySpatialReference",get:function(){return(0,x.g)(this._overlayRenderer.spatialReference)}},{key:"_rendererParameters",get:function(){return(0,l.Z)((0,l.Z)((0,l.Z)((0,l.Z)({},this._radiusParameter),this._densityParameters),this._colorRampParameter),this._pixelRatioParameter)}},{key:"_materialParameters",get:function(){return(0,l.Z)((0,l.Z)({},this._radiusParameter),this._resolutionForScaleParameter)}},{key:"_densityParameters",get:function(){var e=this._heatmapRenderer;return(0,x.t)(e)?null:{minDensity:e.minDensity,maxDensity:e.maxDensity,fieldTotal:this._fieldTotal}}},{key:"_radiusParameter",get:function(){var e=this;return(0,x.aq)(this._heatmapRenderer,(function(t){var r=t.radius;return{searchRadius:(0,G.u)(e._clampSearchRadius(r))}}))}},{key:"_resolutionForScaleParameter",get:function(){var e=this;return(0,x.aq)(this._heatmapRenderer,(function(t){var r=t.referenceScale;return{resolutionForScale:0===r?0:(0,H.i)(r,e.view.spatialReference)}}))}},{key:"_colorRampParameter",get:function(){return(0,x.aq)(this._heatmapRenderer,(function(e){return{colorRampData:(0,Y.s)(e.colorStops)}}))}},{key:"_pixelRatioParameter",get:function(){return{pixelRatio:this._densityMapPixelRatio}}},{key:"_densityMapPixelRatio",get:function(){var e,t,r,i,n,a,s,u,o=null!==(e=null===(t=this.owner)||void 0===t||null===(r=t.view)||void 0===r||null===(i=r.resourceController)||void 0===i||null===(n=i.memoryController)||void 0===n?void 0:n.memoryFactor)&&void 0!==e?e:1;return(null!==(a=null===(s=this.owner)||void 0===s||null===(u=s.view)||void 0===u?void 0:u.qualitySettings.heatmap.pixelRatio)&&void 0!==a?a:1)*Math.sqrt(o)}},{key:"_renderView",get:function(){return this.view._stage.renderView}},{key:"_featuresArePoints",get:function(){return"point"===this.layer.geometryType}},{key:"_loadedPointGraphics",get:function(){return this.owner.loadedGraphics}},{key:"_heatmapRenderer",get:function(){var e=this.layer.renderer;return"heatmap"===(null===e||void 0===e?void 0:e.type)?e:null}},{key:"_heatmapRendererFieldName",get:function(){return(0,x.aq)(this._heatmapRenderer,(function(e){return e.field}))}},{key:"_heatmapRendererField",get:function(){var e=this;return(0,x.aq)(this._heatmapRendererFieldName,(function(t){return e.layer.fieldsIndex.get(t)}))}},{key:"_heatmapRendererFieldIsNumeric",get:function(){var e=this._heatmapRendererField;return!(0,x.t)(e)&&(0,X.B)(e)}},{key:"whenGraphicBounds",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(){return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"computeAttachmentOrigin",value:function(){return null}},{key:"highlight",value:function(){return nt}},{key:"maskOccludee",value:function(){return nt}},{key:"setObjectIdVisibility",value:function(){}},{key:"setup",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(){return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_onLoadedFeaturesChange",value:function(e){var t=this;if(this._featuresArePoints){var r=this.layer.objectIdField;this._featureStore.removeManyById(e.removed.map((function(e){return(0,P.O)(e,r)}))),this._featureStore.addMany(e.added.map((function(e){return new Q.s((0,j.V)(new Q.t,e.geometry),e.attributes,(0,x.aq)(e.centroid,(function(e){return(0,j.V)(new Q.t,e)})),(0,P.O)(e,r))})));var i=e.added,n=e.removed;this._fieldTotal+=this._computeFieldTotalChange(i,n);var a=(0,x.bv)(n,(function(e){var r=e.uid,i=t._renderGeometries.get(r);return t._renderGeometries.delete(r),i})),s=i.map((function(e){var r=t._pointGraphicToRenderGeometry(e);return t._renderGeometries.set(e.uid,r),r}));a.length>0&&this._drapeSourceRenderer.removeGeometries(a,b.v.Geometry.REMOVE),s.length>0&&this._drapeSourceRenderer.addGeometries(s,b.v.Geometry.ADD),(s.length>0||a.length>0)&&this._renderView.requestRender()}}},{key:"_recreate",value:function(){if(this._loadedPointGraphics){var e=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:e,removed:e})}}},{key:"_pointGraphicToRenderGeometry",value:function(e){var t,r=this._heatmapRendererFieldName,i=(0,x.r)(r)?this._materialWithField:this._material,n=(0,N.n)();(0,z.H)(e.geometry,n,this._overlaySpatialReference),n[2]=b.aw;var a=[[re.O.POSITION,{data:n,size:n.length}]],s=this._heatmapRendererFieldIsNumeric;(0,x.r)(r)&&a.push([re.O.FEATUREATTRIBUTE,{data:[s&&null!==(t=e.attributes[r])&&void 0!==t?t:0],size:1}]);var u=new b.A(new K.I(a,null,J.a.Point),i,{layerUid:this.layer.uid,graphicUid:e.uid});return(0,N.a)(u.boundingSphere,n),u}},{key:"_forEachMaterial",value:function(e){e(this._material),e(this._materialWithField)}},{key:"_computeFieldTotalChange",value:function(e,t){if((0,x.t)(this._heatmapRendererFieldName)||!this._heatmapRendererFieldIsNumeric)return e.length-t.length;var r=this._heatmapRendererFieldName,i=function(e,t){var i;return e+(null!==(i=t.attributes[r])&&void 0!==i?i:0)};return e.reduce(i,0)-t.reduce(i,0)}},{key:"_clampSearchRadius",value:function(e){return e>rt&&tt.warnOnce("SceneView supports a maximum radius of ".concat(rt," pt for HeatmapRenderer.")),Math.min(e,rt)}}]),r}(C.d);(0,x.e)([(0,x.d)()],it.prototype,"type",void 0),(0,x.e)([(0,x.d)({constructOnly:!0})],it.prototype,"owner",void 0),(0,x.e)([(0,x.d)()],it.prototype,"layer",null),(0,x.e)([(0,x.d)()],it.prototype,"featureStore",null),(0,x.e)([(0,x.d)()],it.prototype,"updating",null),(0,x.e)([(0,x.d)()],it.prototype,"updatingRemaining",null),(0,x.e)([(0,x.d)()],it.prototype,"suspendInfo",null),(0,x.e)([(0,x.d)()],it.prototype,"legendEnabled",null),(0,x.e)([(0,x.d)()],it.prototype,"filterVisibility",void 0),(0,x.e)([(0,x.d)()],it.prototype,"displayFeatureLimit",null),(0,x.e)([(0,x.d)()],it.prototype,"preferredUpdatePolicy",void 0),(0,x.e)([(0,x.d)()],it.prototype,"hasZ",null),(0,x.e)([(0,x.d)()],it.prototype,"hasM",null),(0,x.e)([(0,x.d)()],it.prototype,"dataExtent",void 0),(0,x.e)([(0,x.d)()],it.prototype,"view",null),(0,x.e)([(0,x.d)()],it.prototype,"fullOpacity",null),(0,x.e)([(0,x.d)()],it.prototype,"updatePolicy",null),(0,x.e)([(0,x.d)()],it.prototype,"drapeSourceType",void 0),(0,x.e)([(0,x.d)()],it.prototype,"_featureStore",void 0),(0,x.e)([(0,x.d)()],it.prototype,"_overlayRenderer",null),(0,x.e)([(0,x.d)()],it.prototype,"_overlaySpatialReference",null),(0,x.e)([(0,x.d)()],it.prototype,"_rendererParameters",null),(0,x.e)([(0,x.d)()],it.prototype,"_materialParameters",null),(0,x.e)([(0,x.d)()],it.prototype,"_densityParameters",null),(0,x.e)([(0,x.d)()],it.prototype,"_radiusParameter",null),(0,x.e)([(0,x.d)()],it.prototype,"_resolutionForScaleParameter",null),(0,x.e)([(0,x.d)()],it.prototype,"_colorRampParameter",null),(0,x.e)([(0,x.d)()],it.prototype,"_pixelRatioParameter",null),(0,x.e)([(0,x.d)()],it.prototype,"_densityMapPixelRatio",null),(0,x.e)([(0,x.d)()],it.prototype,"_renderGeometries",void 0),(0,x.e)([(0,x.d)()],it.prototype,"_material",void 0),(0,x.e)([(0,x.d)()],it.prototype,"_materialWithField",void 0),(0,x.e)([(0,x.d)()],it.prototype,"_renderView",null),(0,x.e)([(0,x.d)()],it.prototype,"_featuresArePoints",null),(0,x.e)([(0,x.d)()],it.prototype,"_loadedPointGraphics",null),(0,x.e)([(0,x.d)()],it.prototype,"_heatmapRenderer",null),(0,x.e)([(0,x.d)()],it.prototype,"_heatmapRendererFieldName",null),(0,x.e)([(0,x.d)()],it.prototype,"_heatmapRendererField",null),(0,x.e)([(0,x.d)()],it.prototype,"_heatmapRendererFieldIsNumeric",null),(0,x.e)([(0,x.d)()],it.prototype,"_fieldTotal",void 0),(0,x.e)([(0,x.d)()],it.prototype,"_drapeSourceRenderer",void 0),it=(0,x.e)([(0,x.n)("esri.views.3d.layers.support.HeatmapFeatureProcessor")],it);var nt=(0,x.p)(),at=function(e){var t=function(e){(0,m.Z)(r,e);var t=(0,v.Z)(r);function r(){var e;return(0,_.Z)(this,r),(e=t.apply(this,arguments)).controller=null,e.updatePolicy=J.o.SYNC,e.suspendResumeExtentMode="computed",e.slicePlaneEnabled=!1,e.fullExtentInLocalViewSpatialReference=null,e.suspendResumeExtent=null,e._controllerCreated=!1,e.clippingExtent=null,e.supportsHeightUnitConversion=!0,e.pendingController=null,e.queryEngine=null,e}return(0,F.Z)(r,[{key:"initialize",value:function(){var e=this,t=this.layer;"isTable"in t&&t.isTable?this.addResolvingPromise(Promise.reject(new x.a("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:t}))):(this.addResolvingPromise(this._validateGeometryType()),this.updatingHandles.add((function(){return e.layer.renderer}),(function(t){return e._recreateProcessor(t)}),E.h),this.addResolvingPromise((0,y.Z)((0,p.Z)().mark((function t(){var r;return(0,p.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,ue.l)(e);case 2:return r=t.sent,e.fullExtentInLocalViewSpatialReference=r,t.next=6,e._initializeController();case 6:case"end":return t.stop()}}),t)})))()),this.updatingHandles.add((function(){return e.updatePolicy}),(function(t){return e.processor.preferredUpdatePolicy=t})),this.queryEngine=new q.l({layerView:this,priority:L.L.FEATURE_QUERY_ENGINE}),this.notifyChange("updating"))}},{key:"destroy",value:function(){this._destroyPendingController(),this.controller=(0,x.G)(this.controller),this._set("processor",(0,x.G)(this.processor)),this.queryEngine=(0,x.G)(this.queryEngine),this.loadedGraphics=null}},{key:"_destroyPendingController",value:function(){this.pendingController=(0,x.G)(this.pendingController)}},{key:"legendEnabled",get:function(){var e;return this.canResume()&&(null===(e=this.processor)||void 0===e?void 0:e.legendEnabled)}},{key:"graphics3DProcessor",get:function(){var e;return"graphics-3d"===(null===(e=this.processor)||void 0===e?void 0:e.type)?this.processor:null}},{key:"heatmapProcessor",get:function(){var e;return"heatmap"===(null===(e=this.processor)||void 0===e?void 0:e.type)?this.processor:null}},{key:"getHit",value:function(e){var t,r=this,i=null;return null!==(t=this.loadedGraphics)&&void 0!==t&&t.forEach((function(t){t.uid===e&&(i=(0,b.c)(t,r.layer))})),i?{type:"graphic",graphic:i,layer:i.layer}:null}},{key:"whenGraphicBounds",value:function(e,t){var r;return null===(r=this.processor)||void 0===r?void 0:r.whenGraphicBounds(e,t)}},{key:"computeAttachmentOrigin",value:function(e,t){var r;return null===(r=this.processor)||void 0===r?void 0:r.computeAttachmentOrigin(e,t)}},{key:"queryFeatures",value:function(e,t){return this.queryEngine.executeQuery(this._ensureQuery(e),(0,x.aj)(t,"signal"))}},{key:"queryObjectIds",value:function(e,t){return this.queryEngine.executeQueryForIds(this._ensureQuery(e),(0,x.aj)(t,"signal"))}},{key:"queryFeatureCount",value:function(e,t){return this.queryEngine.executeQueryForCount(this._ensureQuery(e),(0,x.aj)(t,"signal"))}},{key:"queryExtent",value:function(e,t){return this.queryEngine.executeQueryForExtent(this._ensureQuery(e),(0,x.aj)(t,"signal"))}},{key:"_ensureQuery",value:function(e){return(0,x.t)(e)?this.createQuery():D.b.from(e)}},{key:"highlight",value:function(e){return this.processor.highlight(e,this.layer.objectIdField)}},{key:"maskOccludee",value:function(e){return this.processor.maskOccludee(e)}},{key:"canResume",value:function(){var e;return(0,c.Z)((0,h.Z)(r.prototype),"canResume",this).call(this)&&!(null!==(e=this.processor)&&void 0!==e&&e.scaleVisibilitySuspended)}},{key:"getSuspendInfo",value:function(){var e=(0,c.Z)((0,h.Z)(r.prototype),"getSuspendInfo",this).call(this);return this.processor?(0,l.Z)((0,l.Z)({},e),this.processor.suspendInfo):e}},{key:"isUpdating",value:function(){var e,t,r;return!(!this.processor||this.processor.destroyed)&&!(this._controllerCreated&&(null===(e=this.controller)||void 0===e||!e.updating)&&null!==(t=this.view)&&void 0!==t&&null!==(r=t.basemapTerrain)&&void 0!==r&&r.ready&&!this.processor.updating)}},{key:"_initializeController",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(){var t;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.createController(),this.pendingController=t,e.next=4,t.when();case 4:this._setControllerWhenInitialized(t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setControllerWhenInitialized",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(t){var r=this;return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.when();case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:if(this._controllerCreated=!0,this.notifyChange("updating"),!this.isResolved()||this.destroyed){e.next=19;break}return e.next=12,(0,E.j)((function(){var e,t;return null===(e=r.view)||void 0===e||null===(t=e.basemapTerrain)||void 0===t?void 0:t.ready}));case 12:this.beforeSetController(t),this.pendingController=null,this.controller=t,this.loadedGraphics=t.graphics,this.notifyChange("updating"),e.next=20;break;case 19:this._destroyPendingController();case 20:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateClippingExtent",value:function(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=e,!0}}},{key:"_validateGeometryType",value:function(){var e=(0,y.Z)((0,p.Z)().mark((function e(){return(0,p.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=this.layer.geometryType,e.next="multipatch"===e.t0||"multipoint"===e.t0?3:4;break;case 3:throw new x.a("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_recreateProcessor",value:function(e){var t,r,i=this,n="heatmap"===(null===e||void 0===e?void 0:e.type),a="heatmap"===(null===(t=this.processor)||void 0===t?void 0:t.type),s=this.processor;if(!s||n!==a){var u=n?new it({owner:this}):new q.F({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:function(e){return i._updateClippingExtent(e)}});this._set("processor",u),null!==s&&void 0!==s&&s.destroy(),null!==(r=this.queryEngine)&&void 0!==r&&r.clear(),this.addResolvingPromise(u.setup())}}},{key:"_getResourceInfo",value:function(){var e,t,r=this.controller instanceof De?this.controller:null;return(0,l.Z)({displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:null!==(e=null===r||void 0===r?void 0:r.maximumNumberOfFeatures)&&void 0!==e?e:-1,totalNumberOfFeatures:null!==(t=null===r||void 0===r?void 0:r.serviceDataCount)&&void 0!==t?t:-1,nodes:0},this.processor.performanceInfo)}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]),r}(e);return(0,x.e)([(0,x.d)()],t.prototype,"loadedGraphics",void 0),(0,x.e)([(0,x.d)()],t.prototype,"suspended",void 0),(0,x.e)([(0,x.d)({readOnly:!0})],t.prototype,"legendEnabled",null),(0,x.e)([(0,x.d)()],t.prototype,"updating",void 0),(0,x.e)([(0,x.d)()],t.prototype,"controller",void 0),(0,x.e)([(0,x.d)()],t.prototype,"processor",void 0),(0,x.e)([(0,x.d)({readOnly:!0})],t.prototype,"updatePolicy",void 0),(0,x.e)([(0,x.d)({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0),(0,x.e)([(0,x.d)({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),(0,x.e)([(0,x.d)({readOnly:!0})],t.prototype,"suspendInfo",void 0),(0,x.e)([(0,x.d)()],t.prototype,"graphics3DProcessor",null),(0,x.e)([(0,x.d)()],t.prototype,"heatmapProcessor",null),t=(0,x.e)([(0,x.n)("esri.views.3d.layers.FeatureLikeLayerView3D")],t)}},91403:function(e,t,r){r.d(t,{h:function(){return y},u:function(){return m}});var i=r(37762),n=r(15671),a=r(43144),s=r(50165),u=r(40133),o=r(9330),l=r(79146),c=r(30594),h=r(55985),d=r(43750),f={minX:0,minY:0,maxX:0,maxY:0};function p(e,t,r){(function(e){f.minX=e[0],f.minY=e[1],f.maxX=e[2],f.maxY=e[3]})(t),e.search(f,r)}var y=function(){function e(){var t=this;(0,n.Z)(this,e),this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new h.h(9,(0,s.c)("esri-csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:["[0]","[1]","[2]","[3]"]),this._loadIndex=function(){if(t._indexInvalid){var e=new Array(t._idByBounds.size),r=0;t._idByBounds.forEach((function(t,i){e[r++]=i})),t._indexInvalid=!1,t._index.clear(),t._index.load(e)}else t._boundsToLoad.length&&(t._index.load(t._boundsToLoad.filter((function(e){return t._idByBounds.has(e)}))),t._boundsToLoad.length=0)}}return(0,a.Z)(e,[{key:"fullBounds",get:function(){if(!this._boundsById.size)return null;var e,t=(0,l.D)(),r=(0,i.Z)(this._boundsById.values());try{for(r.s();!(e=r.n()).done;){var n=e.value;n&&(t[0]=Math.min(n[0],t[0]),t[1]=Math.min(n[1],t[1]),t[2]=Math.max(n[2],t[2]),t[3]=Math.max(n[3],t[3]))}}catch(a){r.e(a)}finally{r.f()}return t}},{key:"valid",get:function(){return!this._indexInvalid}},{key:"clear",value:function(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}},{key:"delete",value:function(e){var t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}},{key:"forEachInBounds",value:function(e,t){var r=this;this._loadIndex(),p(this._index,e,(function(e){return t(r._idByBounds.get(e))}))}},{key:"get",value:function(e){return this._boundsById.get(e)}},{key:"has",value:function(e){return this._boundsById.has(e)}},{key:"invalidateIndex",value:function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}},{key:"set",value:function(e,t){if(!this._indexInvalid){var r=this._boundsById.get(e);r&&(this._index.remove(r),this._idByBounds.delete(r))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}]),e}(),m=function(){function e(t){(0,n.Z)(this,e),this.geometryInfo=t,this._boundsStore=new y,this._featuresById=new Map,this._markedIds=new Set,this.events=new u.n,this.featureAdapter=d.i}return(0,a.Z)(e,[{key:"geometryType",get:function(){return this.geometryInfo.geometryType}},{key:"hasM",get:function(){return this.geometryInfo.hasM}},{key:"hasZ",get:function(){return this.geometryInfo.hasZ}},{key:"numFeatures",get:function(){return this._featuresById.size}},{key:"fullBounds",get:function(){return this._boundsStore.fullBounds}},{key:"storeStatistics",get:function(){var e=0;return this._featuresById.forEach((function(t){(0,s.r)(t.geometry)&&t.geometry.coords&&(e+=t.geometry.coords.length)})),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}},{key:"add",value:function(e){this._add(e),this._emitChanged()}},{key:"addMany",value:function(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this._add(n)}}catch(a){r.e(a)}finally{r.f()}this._emitChanged()}},{key:"clear",value:function(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}},{key:"removeById",value:function(e){var t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}},{key:"removeManyById",value:function(e){this._boundsStore.invalidateIndex();var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,a=this._featuresById.get(n);a&&this._remove(a)}}catch(s){r.e(s)}finally{r.f()}this._emitChanged()}},{key:"forEachBounds",value:function(e,t,r){var n,a=(0,i.Z)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value,u=this._boundsStore.get(s.objectId);u&&t((0,o.O)(r,u))}}catch(l){a.e(l)}finally{a.f()}}},{key:"getFeature",value:function(e){return this._featuresById.get(e)}},{key:"has",value:function(e){return this._featuresById.has(e)}},{key:"toArray",value:function(){return Array.from(this._featuresById.values())}},{key:"forEach",value:function(e){this._featuresById.forEach((function(t){return e(t)}))}},{key:"forEachInBounds",value:function(e,t){var r=this;this._boundsStore.forEachInBounds(e,(function(e){t(r._featuresById.get(e))}))}},{key:"startMarkingUsedFeatures",value:function(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}},{key:"sweep",value:function(){var e=this,t=!1;this._featuresById.forEach((function(r,i){e._markedIds.has(i)||(t=!0,e._remove(r))})),this._markedIds.clear(),t&&this._emitChanged()}},{key:"_emitChanged",value:function(){this.events.emit("changed",void 0)}},{key:"_add",value:function(e){if(e){var t=e.objectId;if(null!=t){var r,i=this._featuresById.get(t);if(this._markedIds.add(t),i?(e.displayId=i.displayId,r=this._boundsStore.get(t),this._boundsStore.delete(t)):(0,s.r)(this.onFeatureAdd)&&this.onFeatureAdd(e),(0,s.t)(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);r=(0,c.g)((0,s.r)(r)?r:(0,l.u)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),(0,s.r)(r)&&this._boundsStore.set(t,r),this._featuresById.set(t,e)}else s.s.getLogger("esri.layers.graphics.data.FeatureStore").error(new s.a("featurestore:invalid-feature","feature id is missing",{feature:e}))}}},{key:"_remove",value:function(e){return(0,s.r)(this.onFeatureRemove)&&this.onFeatureRemove(e),this._markedIds.delete(e.objectId),this._boundsStore.delete(e.objectId),this._featuresById.delete(e.objectId),e}}]),e}()},3822:function(e,t,r){r.d(t,{o:function(){return d},r:function(){return s}});var i=r(50165);function n(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++){var i=e[r],n=t[r];if(i.length!==n.length)return!1;for(var a=0;a<i.length;a++)if(i[a]!==n[a])return!1}return!0}function a(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}function s(e,t){return!!c(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function u(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!c(e.spatialReference,t.spatialReference)&&a(e.paths,t.paths)}function o(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!c(e.spatialReference,t.spatialReference)&&a(e.rings,t.rings)}function l(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!c(e.spatialReference,t.spatialReference)&&n(e.points,t.points)}function c(e,t){return e===t||e&&t&&e.equals(t)}function h(e,t){if(e===t)return!0;if((0,i.t)(e)||(0,i.t)(t))return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return s(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!c(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return u(e,t);case"polygon":return o(e,t);case"multipoint":return l(e,t);case"mesh":return!1;default:return}}function d(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!h(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(var n=0,a=r;n<a.length;n++){var s=a[n];if(e[s]!==t[s])return!1}return!0}(e.attributes,t.attributes)}},43643:function(e,t,r){r.d(t,{l:function(){return s}});var i=r(50165),n=r(77322),a=r(21277);function s(e){var t=e.view.spatialReference,r=e.layer.fullExtent,s=(0,i.r)(r)&&r.spatialReference;if((0,i.t)(r)||!s)return Promise.resolve(null);if(s.equals(t))return Promise.resolve(r.clone());var u=(0,n.M)(r,t);return(0,i.r)(u)?Promise.resolve(u):e.view.state.isLocal?(0,a.projectGeometry)(r,t,e.layer.portalItem).then((function(t){return!e.destroyed&&t?t:void 0})).catch((function(){return null})):Promise.resolve(null)}}}]);
//# sourceMappingURL=8010.44bf71fc.chunk.js.map