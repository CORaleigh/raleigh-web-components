"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[9251],{13385:function(e,t,r){r.d(t,{s:function(){return s}});var i=r(37762),n=r(15671),a=r(43144),o=r(93661),s=function(){function e(t){(0,n.Z)(this,e),this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}return(0,a.Z)(e,[{key:"entries",get:function(){return this._buffer}},{key:"enqueue",value:function(e){if(this.size===this.maxSize){var t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}},{key:"dequeue",value:function(){if(0===this.size)return null;var e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}},{key:"peek",value:function(){return 0===this.size?null:this._buffer[this._start]}},{key:"find",value:function(e){if(0===this.size)return null;var t,r=(0,i.Z)(this._buffer);try{for(r.s();!(t=r.n()).done;){var n=t.value;if((0,o.r)(n)&&e(n))return n}}catch(a){r.e(a)}finally{r.f()}return null}},{key:"clear",value:function(e){for(var t=this.dequeue();(0,o.r)(t);)e&&e(t),t=this.dequeue()}}]),e}()},52195:function(e,t,r){r.d(t,{u:function(){return f}});var i=r(15671),n=r(43144),a=r(60136),o=r(29388),s=r(48848),u=r(37856),l=r(630),d=r(92072),c=r(93661),h=r(65094),v=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(e){var n;return(0,i.Z)(this,r),(n=t.call(this,e)).layer=null,n.parent=null,n}return(0,n.Z)(r,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",i=e.layer&&e.layer.title||"no title";s.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(i,"', id: '").concat(r,"')"),t)}}))}},{key:"fullOpacity",get:function(){return(0,c.v)(this.get("layer.opacity"),1)*(0,c.v)(this.get("parent.fullOpacity"),1)}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}},{key:"updating",get:function(){var e;return!((null===(e=this.updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)},set:function(e){this._overrideIfSome("visible",e)}},{key:"canResume",value:function(){var e,t,r;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(r=this.view)||void 0===r?void 0:r.ready)||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),r}((0,l.a)((0,d.s)((0,h.m)(u.n.EventedMixin(s.m)))));(0,s.e)([(0,s.y)()],v.prototype,"fullOpacity",null),(0,s.e)([(0,s.y)()],v.prototype,"layer",void 0),(0,s.e)([(0,s.y)()],v.prototype,"parent",void 0),(0,s.e)([(0,s.y)({readOnly:!0})],v.prototype,"suspended",null),(0,s.e)([(0,s.y)({readOnly:!0})],v.prototype,"suspendInfo",null),(0,s.e)([(0,s.y)({readOnly:!0})],v.prototype,"legendEnabled",null),(0,s.e)([(0,s.y)({type:Boolean,readOnly:!0})],v.prototype,"updating",null),(0,s.e)([(0,s.y)({readOnly:!0})],v.prototype,"updatingProgress",null),(0,s.e)([(0,s.y)()],v.prototype,"visible",null),(0,s.e)([(0,s.y)()],v.prototype,"view",void 0);var f=v=(0,s.e)([(0,s.n)("esri.views.layers.LayerView")],v)},6336:function(e,t,r){r.d(t,{h:function(){return c}});var i=r(37762),n=r(15671),a=r(43144),o=r(13385),s=r(71802),u=r(93661),l="__esri_stream_id__",d="__esri_timestamp__",c=function(){function e(t,r,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:128;(0,n.Z)(this,e),this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=i,this._purgeOptions=a,this.store=t,this.objectIdField=r,this.purgeInterval=o,this._useGeneratedIds=this.objectIdField===l}return(0,a.Z)(e,[{key:"add",value:function(e){if(this._useGeneratedIds){var t=this._nextId();e.attributes[this.objectIdField]=t,e.objectId=t}else e.objectId=e.attributes[this.objectIdField];if(this._addOrUpdated.set(e.objectId,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),!this._timeInfo.trackIdField)return(0,u.t)(this._trackIdLessObservations)&&(this._trackIdLessObservations=new o.s(1e5)),void this._trackIdLessObservations.enqueue(e.objectId);var r=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(r)){var i=(0,u.r)(this._purgeOptions)&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:1e3,n=(0,s.a)(i,0,1e3);this._trackIdToObservations.set(r,new o.s(n))}var a=this._trackIdToObservations.get(r).enqueue(e.objectId);(0,u.r)(a)&&(this._addOrUpdated.has(a)?this._addOrUpdated.delete(a):this._removed.push(a))}},{key:"checkForUpdates",value:function(){var e=this._getToAdd(),t=this._getToRemove(),r=performance.now();r-this._lastPurge>=this.purgeInterval&&(this._purge(r),this._lastPurge=r);var n=[];if((0,u.r)(t)){var a,o=(0,i.Z)(t);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=this.store.removeById(s);(0,u.r)(l)&&n.push(l)}}catch(f){o.e(f)}finally{o.f()}}if((0,u.r)(e)){var c,h=(0,i.Z)(e);try{for(h.s();!(c=h.n()).done;){var v=c.value;v.attributes[d]=r,this.store.add(v)}}catch(f){h.e(f)}finally{h.f()}}(e||(null===n||void 0===n?void 0:n.length))&&this.store.update(e,n)}},{key:"_getToAdd",value:function(){if(!this._addOrUpdated.size)return null;var e=new Array(this._addOrUpdated.size),t=0;return this._addOrUpdated.forEach((function(r){return e[t++]=r})),this._addOrUpdated.clear(),e}},{key:"_getToRemove",value:function(){var e=this._removed;return this._removed.length?(this._removed=[],e):null}},{key:"_nextId",value:function(){var e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e}},{key:"_purge",value:function(e){var t=this._purgeOptions;(0,u.r)(t)&&(this._purgeSomeByDisplayCount(t),this._purgeByAge(t),this._purgeByAgeReceived(e,t),this._purgeTracks())}},{key:"_purgeSomeByDisplayCount",value:function(e){if(e.displayCount){var t=this.store.size;if(t>e.displayCount){if(this._timeInfo.trackIdField){var r,n=(0,i.Z)(this._trackIdToObservations.values());try{for(n.s();!(r=n.n()).done;){var a=r.value;if(t>e.displayCount&&a.size){var o=(0,u.e)(a.dequeue());this._removed.push(o),t--}}}catch(d){n.e(d)}finally{n.f()}}if((0,u.r)(this._trackIdLessObservations))for(var s=t-e.displayCount;s-- >0;){var l=this._trackIdLessObservations.dequeue();(0,u.r)(l)&&this._removed.push(l)}}}}},{key:"_purgeByAge",value:function(e){var t,r=this;if(e.age&&null!==(t=this._timeInfo)&&void 0!==t&&t.startTimeField){var i=60*e.age*1e3,n=this._maxAge-i;this.store.forEach((function(e){e.attributes[r._timeInfo.startTimeField]<n&&r._removed.push(e.objectId)}))}}},{key:"_purgeByAgeReceived",value:function(e,t){var r=this;if(t.ageReceived){var i=e-60*t.ageReceived*1e3;this.store.forEach((function(e){e.attributes[d]<i&&r._removed.push(e.objectId)}))}}},{key:"_purgeTracks",value:function(){var e=this;this._trackIdToObservations.forEach((function(t,r){0===t.size&&e._trackIdToObservations.delete(r)}))}}]),e}()},9899:function(e,t,r){r.r(t);var i=r(15671),n=r(43144),a=r(60136),o=r(29388),s=r(48848),u=r(50690),l=r(93661),d=r(74384),c=r(64998),h=r(630),v=r(65094),f=r(6336),y=r(73609),p=r(81216),_=r(35237),g=r(41896),m=r(72770),I=r(57791),k=r(52195),b=r(51920),w=(r(46817),r(82474),r(40114),r(40558),r(25577),r(62610),r(93314),r(37856),r(15751),r(59984),r(20302),r(53586),r(60369),r(92072),r(37944),r(86086),r(21385),r(89794),r(48200),r(71802),r(85253),r(93209),r(25456),r(46337),r(81556),r(93116),r(56162),r(13385),r(65415),r(47855),r(49871),r(63212),r(39994),r(69717),r(53409),r(35182),r(62466),r(51816),r(89181),r(69641),r(15436),r(69768),r(28390),r(17455),r(1500),r(42467),r(46737),r(52113),r(75255),r(42667),r(61118),r(85113),r(23585),r(82396),r(95249),r(79557),r(25747),r(59389),r(26313),r(37077),r(49228),r(41723),r(64772),r(91681),r(43955),r(76291),r(13239),r(24093),r(6189),r(17332),r(87750),r(20846),r(67430),r(87424),r(10464),r(32043),r(98598),r(19941),r(68781),r(35865),r(51219),r(66577),r(95643),r(33795),r(43976),r(6762),r(2959),r(2821),r(33794),r(71147),r(84186),r(15529),r(70449),r(22603),r(56546),r(39926),r(8141),r(26151),r(90429),r(52559),r(95399),r(98987),r(99795),r(87753),r(29130),r(1685),r(12953),r(74797),r(45999),r(72973),r(62710),r(52721),r(61903),r(23444),r(40811),r(24623),r(64264),r(6379),r(21015),r(23341),r(41820),r(20086),r(92982),r(61416),r(77880),r(74494),r(77755),r(63393),r(90442),r(64854),r(71645),r(89311),r(67066),r(39769),r(70607),r(85700),r(3719),r(32161),r(37686),r(16641),r(62642),r(90316),r(19891),r(47748),r(70522),r(43066),r(29048),r(68136),r(50253),r(27205),r(16263),r(3356),r(70381),r(20675),r(85026),r(33973),r(42233),r(93122),r(70288),r(95414),r(43345),r(75833),r(31698),r(94777),r(4937),r(87440),r(21744),r(18936),r(4397),r(25217),r(43406),r(45184),r(72361),r(22159),r(73911),r(87917),r(46018),r(70863),r(62312),r(24648),r(63999),r(1797),r(5526),r(2473),r(59929),r(2467),r(75257),r(26789),r(64095),r(51732),r(2851),r(70285),r(40345),r(96278),r(52638),r(76419),r(25874),r(44581),r(44513),r(90325),r(53921),r(69838),r(2352),r(62470),r(54622),r(73679),r(62753),r(83948),r(94663),r(67477),r(78413),r(26593),r(60491),r(3393),function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,n.Z)(r,[{key:"getObjectId",value:function(){return this.objectId}}]),r}(c.g));(0,s.e)([(0,s.y)({type:Number,json:{read:!0}})],w.prototype,"objectId",void 0),w=(0,s.e)([(0,s.n)("esri.layers.graphics.controllers.StreamGraphic")],w);var O=function(){function e(t){(0,i.Z)(this,e),this.onUpdate=t,this._idToGraphic=new Map}return(0,n.Z)(e,[{key:"destroy",value:function(){this._idToGraphic.clear()}},{key:"add",value:function(e){this._idToGraphic.set(e.objectId,e)}},{key:"get",value:function(e){return this._idToGraphic.get(e)}},{key:"forEach",value:function(e){this._idToGraphic.forEach(e)}},{key:"removeById",value:function(e){var t=this._idToGraphic.get(e);return t?(t.sourceLayer=t.layer=null,this._idToGraphic.delete(e),t):null}},{key:"update",value:function(e,t){this.onUpdate(e,t)}},{key:"size",get:function(){return this._idToGraphic.size}}]),e}(),S=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments))._updateInfo={websocket:0,client:0},e.graphics=new p.r,e}return(0,n.Z)(r,[{key:"initialize",value:function(){var e=this;this.addResolvingPromise(this.layer.when((function(){return e._startup()})))}},{key:"destroy",value:function(){this.clear()}},{key:"_clearInterval",value:function(){this._updateIntervalId&&(clearInterval(this._updateIntervalId),this._updateIntervalId=0)}},{key:"clear",value:function(){this._clearInterval(),this.connection&&(this.connection.destroy(),this.connection=null),this.store&&(this.store.destroy(),this.store=null),this.graphics.clear(),this.handles.removeAll()}},{key:"updating",get:function(){return!this.connection||"connected"===this.connection.connectionStatus}},{key:"_startup",value:function(){var e=this,t=this.layer,r=this.layerView,i=t.parsedUrl,n=t.spatialReference,a=t.definitionExpression,o=t.geometryDefinition,s=t.objectIdField,l=t.timeInfo,c=t.purgeOptions,h=t.maxReconnectionAttempts,v=t.maxReconnectionInterval,p=t.customParameters,_=d.a.toJSON(t.geometryType),g=n,m=r.view.spatialReference,I={geometry:o,where:a};this.clear(),this._set("connection",(0,y.createConnection)(i,g,m,_,I,h,v,p)),this._outSpatialReference=m.toJSON(),this.store=new O(this._onUpdate.bind(this)),this.featuresManager=new f.h(this.store,s,l.toJSON(),c);var k="startup-watches";this.handles.remove(k),this.handles.add([this.connection.on("data-received",(function(t){return e._onFeature(t)})),(0,u.l)((function(){return[t.definitionExpression,t.geometryDefinition,t.purgeOptions]}),(function(){return e._startup()}))],k),this._initUpdateInterval()}},{key:"_onFeature",value:function(e){this._updateInfo.websocket++,this.layerView.hasEventListener("data-received")&&this.layerView.emit("data-received",{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry});try{(0,l.r)(e.geometry)&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._outSpatialReference);var t=w.fromJSON(e);t.sourceLayer=t.layer=this.layer,this.featuresManager.add(t)}catch(r){}}},{key:"_onUpdate",value:function(e,t){(0,l.r)(t)&&this.graphics.removeMany(t),(0,l.r)(e)&&(this._updateInfo.client+=e.length,this.graphics.addMany(e))}},{key:"_initUpdateInterval",value:function(){var e=this;this._clearInterval();var t=this.layer.updateInterval,r=performance.now();this._updateIntervalId=setInterval((function(){var t=performance.now(),i=t-r;if(i>2500){r=t;var n=Math.round(e._updateInfo.client/(i/1e3)),a=Math.round(e._updateInfo.websocket/(i/1e3));e._updateInfo.client=0,e._updateInfo.websocket=0,e.layerView.emit("update-rate",{client:n,websocket:a})}e.featuresManager.checkForUpdates()}),t)}},{key:"pauseStream",value:function(){this._clearInterval()}},{key:"resumeStream",value:function(){this._initUpdateInterval()}}]),r}((0,h.a)((0,v.m)(s.m)));(0,s.e)([(0,s.y)()],S.prototype,"connection",void 0),(0,s.e)([(0,s.y)()],S.prototype,"layer",void 0),(0,s.e)([(0,s.y)()],S.prototype,"layerView",void 0),(0,s.e)([(0,s.y)({readOnly:!0})],S.prototype,"updating",null),S=(0,s.e)([(0,s.n)("esri.layers.graphics.controllers.StreamController")],S);var Z=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments)).type="stream-3d",e.updatePolicy=I.i.ASYNC,e.hasZ=!0,e.hasM=!1,e}return(0,n.Z)(r,[{key:"initialize",value:function(){var e=this;this.handles.add((0,u.l)((function(){return e.suspended}),(function(t){e.controller&&(t?e.controller.pauseStream():e.controller.resumeStream())})))}},{key:"connectionError",get:function(){var e=this.get("controller.connection.errorString");if(e)return new s.s("stream-controller",e)}},{key:"createQuery",value:function(){return new _.x({outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference})}},{key:"queryLatestObservations",value:function(e,t){return this.queryEngine.executeQueryForLatestObservations(this._ensureQuery(e),null===t||void 0===t?void 0:t.signal)}},{key:"createController",value:function(){return new S({layer:this.layer,layerView:this})}},{key:"beforeSetController",value:function(){}}]),r}(function(e){var t=function(e){(0,a.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;(0,i.Z)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).connectionError=null,e.filter=null,e}return(0,n.Z)(r,[{key:"connectionStatus",get:function(){var e,t,r;return null!==(e=null===(t=this.controller)||void 0===t||null===(r=t.connection)||void 0===r?void 0:r.connectionStatus)&&void 0!==e?e:"disconnected"}}]),r}(e);return(0,s.e)([(0,s.y)({readOnly:!0})],t.prototype,"connectionError",void 0),(0,s.e)([(0,s.y)({readOnly:!0})],t.prototype,"connectionStatus",null),(0,s.e)([(0,s.y)({type:b.y})],t.prototype,"filter",void 0),t=(0,s.e)([(0,s.n)("esri.layers.mixins.StreamLayerView")],t)}((0,g.w)((0,m.n)(k.u))));(0,s.e)([(0,s.y)({readOnly:!0})],Z.prototype,"updatePolicy",void 0),(0,s.e)([(0,s.y)({readOnly:!0})],Z.prototype,"connectionError",null),(0,s.e)([(0,s.y)()],Z.prototype,"controller",void 0),(0,s.e)([(0,s.y)({readOnly:!0})],Z.prototype,"hasZ",void 0),(0,s.e)([(0,s.y)({readOnly:!0})],Z.prototype,"hasM",void 0);var T=Z=(0,s.e)([(0,s.n)("esri.views.3d.layers.StreamLayerView3D")],Z);t.default=T},17562:function(e,t,r){function i(e){var t,r=e.layer;return"floorInfo"in r&&null!==(t=r.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?a(e.view.floors,r.floorInfo.floorField):null}function n(e,t){var r;return"floorInfo"in t&&null!==(r=t.floorInfo)&&void 0!==r&&r.floorField?a(e,t.floorInfo.floorField):null}function a(e,t){if(null===e||void 0===e||!e.length)return null;var r=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return r.push("''"),"".concat(t," IN (").concat(r.join(","),") OR ").concat(t," IS NULL")}r.d(t,{n:function(){return n},o:function(){return i}})}}]);
//# sourceMappingURL=9251.36db9ba9.chunk.js.map