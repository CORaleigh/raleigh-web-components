"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[4965],{91502:function(e,t,r){r.d(t,{y:function(){return L}});var i=r(11752),n=r(61120),a=r(15671),s=r(43144),l=r(60136),o=r(29388),u=r(48848),c=r(93314),h=r(81556),y=r(50690),f=(r(93661),r(84234)),d=r(40114),p=r(74384),v=r(82474),_=r(56162),g=r(46817),m=function(e){(0,l.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"version",get:function(){return this.commitVersionProperties(),(this._get("version")||0)+1}}]),r}(d.l);(0,u.e)([(0,u.y)({readOnly:!0})],m.prototype,"version",null);var I,T=m=(0,u.e)([(0,u.n)("esri.views.layers.support.ClipArea")],m),b=I=function(e){(0,l.Z)(r,e);var t=(0,o.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this,e)).type="rect",i.left=null,i.right=null,i.top=null,i.bottom=null,i}return(0,s.Z)(r,[{key:"clone",value:function(){return new I({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}},{key:"commitVersionProperties",value:function(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}}]),r}(T);(0,u.e)([(0,u.y)({type:[Number,String],json:{write:!0}})],b.prototype,"left",void 0),(0,u.e)([(0,u.y)({type:[Number,String],json:{write:!0}})],b.prototype,"right",void 0),(0,u.e)([(0,u.y)({type:[Number,String],json:{write:!0}})],b.prototype,"top",void 0),(0,u.e)([(0,u.y)({type:[Number,String],json:{write:!0}})],b.prototype,"bottom",void 0);var C,w=b=I=(0,u.e)([(0,u.n)("esri.views.layers.support.ClipRect")],b),x={base:v.p,key:"type",typeMap:{extent:g.w,polygon:p.v}},R=C=function(e){(0,l.Z)(r,e);var t=(0,o.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this,e)).type="geometry",i.geometry=null,i}return(0,s.Z)(r,[{key:"clone",value:function(){var e,t;return new C({geometry:null!==(e=null===(t=this.geometry)||void 0===t?void 0:t.clone())&&void 0!==e?e:null})}},{key:"commitVersionProperties",value:function(){this.commitProperty("geometry")}}]),r}(T);(0,u.e)([(0,u.y)({types:x,json:{read:_.v,write:!0}})],R.prototype,"geometry",void 0);var k=R=C=(0,u.e)([(0,u.n)("esri.views.layers.support.Geometry")],R),S=function(e){(0,l.Z)(r,e);var t=(0,o.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this,e)).type="path",i.path=[],i}return(0,s.Z)(r,[{key:"commitVersionProperties",value:function(){this.commitProperty("path")}}]),r}(T);(0,u.e)([(0,u.y)({type:[[[Number]]],json:{write:!0}})],S.prototype,"path",void 0);var E=S=(0,u.e)([(0,u.n)("esri.views.layers.support.Path")],S),D=c.j.ofType({key:"type",base:null,typeMap:{rect:w,path:E,geometry:k}}),L=function(e){var t=function(e){(0,l.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).attached=!1,e.clips=new D,e.lastUpdateId=-1,e.moving=!1,e.updateRequested=!1,e.visibleAtCurrentScale=!1,e}return(0,s.Z)(r,[{key:"initialize",value:function(){var e,t,r,i,n=this,a=null===(e=null===(t=this.view)||void 0===t?void 0:t.spatialReferenceLocked)||void 0===e||e;(null===(r=this.view)||void 0===r?void 0:r.spatialReference)&&a&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new u.s("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new f.i),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.handles.add([(0,y.l)((function(){return n.suspended}),(function(e){n.container&&(n.container.visible=!e),n.view&&!e&&n.updateRequested&&n.view.requestUpdate()}),y.w),(0,y.l)((function(){var e,t;return null!==(e=null===(t=n.layer)||void 0===t?void 0:t.opacity)&&void 0!==e?e:1}),(function(e){n.container&&(n.container.opacity=e)}),y.w),(0,y.l)((function(){return n.layer&&"blendMode"in n.layer?n.layer.blendMode:"normal"}),(function(e){n.container&&(n.container.blendMode=e)}),y.w),(0,y.l)((function(){return n.layer&&"effect"in n.layer?n.layer.effect:null}),(function(e){n.container&&(n.container.effect=e)}),y.w),(0,y.a)((function(){return n.clips}),"change",(function(){n.container&&(n.container.clips=n.clips)}),y.w),(0,y.l)((function(){var e;return{scale:null===(e=n.view)||void 0===e?void 0:e.scale,scaleRange:n.layer&&"effectiveScaleRange"in n.layer?n.layer.effectiveScaleRange:null}}),(function(e){var t=e.scale,r=t&&n.isVisibleAtScale(t);r!==n.visibleAtCurrentScale&&n._set("visibleAtCurrentScale",r)}),y.w)]),null!==(i=this.view)&&void 0!==i&&i.whenLayerView?this.view.whenLayerView(this.layer).then((function(e){e===n&&n.processAttach()}),(function(){})):this.when().then((function(){n.processAttach()}),(function(){})))}},{key:"destroy",value:function(){this.processDetach(),this.updateRequested=!1}},{key:"spatialReferenceSupported",get:function(){var e,t=null===(e=this.view)||void 0===e?void 0:e.spatialReference;return null==t||this.supportsSpatialReference(t)}},{key:"updating",get:function(){var e;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null===(e=this.updatingHandles)||void 0===e||!e.updating))}},{key:"processAttach",value:function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}},{key:"processDetach",value:function(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=!1)}},{key:"isVisibleAtScale",value:function(e){var t=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!t)return!0;var r=t.minScale,i=t.maxScale;return(0===r||e<=r)&&(0===i||e>=i)}},{key:"requestUpdate",value:function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())}},{key:"processUpdate",value:function(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}},{key:"hitTest",value:function(e,t){return Promise.resolve(null)}},{key:"supportsSpatialReference",value:function(e){return!0}},{key:"canResume",value:function(){return!!this.spatialReferenceSupported&&!!(0,i.Z)((0,n.Z)(r.prototype),"canResume",this).call(this)&&this.visibleAtCurrentScale}},{key:"getSuspendInfo",value:function(){var e=(0,i.Z)((0,n.Z)(r.prototype),"getSuspendInfo",this).call(this),t=!this.spatialReferenceSupported,a=this.visibleAtCurrentScale;return t&&(e.spatialReferenceNotSupported=t),a&&(e.outsideScaleRange=a),e}}]),r}(e);return(0,u.e)([(0,u.y)()],t.prototype,"attached",void 0),(0,u.e)([(0,u.y)({type:D,set:function(e){var t=(0,h.n)(e,this._get("clips"),D);this._set("clips",t)}})],t.prototype,"clips",void 0),(0,u.e)([(0,u.y)()],t.prototype,"container",void 0),(0,u.e)([(0,u.y)()],t.prototype,"moving",void 0),(0,u.e)([(0,u.y)({readOnly:!0})],t.prototype,"spatialReferenceSupported",null),(0,u.e)([(0,u.y)({readOnly:!0})],t.prototype,"updateParameters",void 0),(0,u.e)([(0,u.y)()],t.prototype,"updateRequested",void 0),(0,u.e)([(0,u.y)()],t.prototype,"updating",null),(0,u.e)([(0,u.y)()],t.prototype,"view",void 0),(0,u.e)([(0,u.y)({readOnly:!0})],t.prototype,"visibleAtCurrentScale",void 0),t=(0,u.e)([(0,u.n)("esri.views.2d.layers.LayerView2D")],t)}},17327:function(e,t,r){r.d(t,{i:function(){return d}});var i=r(37762),n=r(15671),a=r(43144),s=r(11752),l=r(61120),o=r(60136),u=r(29388),c=r(93661),h=r(1206),y=r(6994),f=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},d=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this))._tileInfoView=e,i}return(0,a.Z)(r,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(f),this.setStencilReference(e),(0,s.Z)((0,l.Z)(r.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,i=(0,s.Z)((0,l.Z)(r.prototype),"createRenderParams",this).call(this,e);return i.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,i.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),i}},{key:"prepareRenderPasses",value:function(e){var t=this,i=(0,s.Z)((0,l.Z)(r.prototype),"prepareRenderPasses",this).call(this,e);return i.push(e.registerRenderPass({name:"stencil",brushes:[y.h],drawPhase:h.I.DEBUG|h.I.MAP|h.I.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),(0,c.h)("esri-tiles-debug")&&i.push(e.registerRenderPass({name:"tileInfo",brushes:[y.x],drawPhase:h.I.DEBUG,target:function(){return t.children}})),i}},{key:"getStencilTarget",value:function(){return this.children}},{key:"setStencilReference",value:function(e){var t,r=1,n=(0,i.Z)(this.children);try{for(n.s();!(t=n.n()).done;){t.value.stencilRef=r++}}catch(a){n.e(a)}finally{n.f()}}}]),r}(y.o)},26789:function(e,t,r){r.d(t,{r:function(){return h}});var i=r(29439),n=r(15671),a=r(43144),s=r(60136),l=r(29388),o=r(26313),u=r(64095),c=r(51732),h=function(e){(0,s.Z)(r,e);var t=(0,l.Z)(r);function r(e,i,a,s,l,o){var u,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:o;return(0,n.Z)(this,r),(u=t.call(this)).triangleCountReportedInDebug=0,u.triangleCount=0,u.texture=null,u.key=new c.e(e),u.resolution=i,u.x=a,u.y=s,u.width=l,u.height=o,u.rangeX=h,u.rangeY=y,u}return(0,a.Z)(r,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"setTransform",value:function(e){var t=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,n=e.toScreenNoRotation([0,0],[this.x,this.y]),a=(0,i.Z)(n,2),s=a[0],l=a[1],u=this.width/this.rangeX*t,c=this.height/this.rangeY*t;(0,o.s)(r,u,0,0,0,c,0,s,l,1),(0,o.i)(this.transforms.dvs,e.displayViewMat3,r)}}]),r}(u.r)},2467:function(e,t,r){r.d(t,{c:function(){return w},i:function(){return b},l:function(){return T},m:function(){return L},p:function(){return Z},s:function(){return I}});var i=r(11752),n=r(61120),a=r(60136),s=r(29388),l=r(29439),o=r(37762),u=r(43144),c=r(15671),h=r(93661),y=r(26313),f=r(43066),d=r(75257),p=r(31698),v=r(93122),_=r(65636),g=r(26789),m=(0,u.Z)((function e(t){(0,c.Z)(this,e),this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t})),I=(0,u.Z)((function e(){(0,c.Z)(this,e),this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}));function T(e,t,r,i,n,a){var s=r-n;if(s>=0)return(t>>s)+(i-(a<<s))*(e>>s);var l=-s;return t-(a-(i<<l))*(e>>l)<<l}var b=function(){function e(t,r,i){(0,c.Z)(this,e),this._rows=Math.ceil(r/i),this._columns=Math.ceil(t/i),this._cellSize=i,this.cells=new Array(this._rows);for(var n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(var a=0;a<this._columns;a++)this.cells[n][a]=[]}}return(0,u.Z)(e,[{key:"getCell",value:function(e,t){var r=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),i=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][i]||null}},{key:"getCellSpan",value:function(e,t,r,i){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1)]}},{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]),e}();function C(e,t,r,i,n,a){for(var s=t[i++],l=0;l<s;l++){var o=new m(a);o.xTile=t[i++],o.yTile=t[i++],o.hash=t[i++],o.priority=t[i++];for(var u=t[i++],c=0;c<u;c++){var h=t[i++],y=t[i++],f=t[i++],d=t[i++],p=!!t[i++],v=t[i++],_=r[i++],g=r[i++],I=t[i++],T=t[i++];o.colliders.push({xTile:h,yTile:y,dxPixels:f,dyPixels:d,hard:p,partIndex:v,width:I,height:T,minLod:_,maxLod:g})}for(var b=e[i++],C=0;C<b;C++)o.textVertexRanges.push([e[i++],e[i++]]);for(var w=e[i++],x=0;x<w;x++)o.iconVertexRanges.push([e[i++],e[i++]]);n.push(o)}return i}function w(e,t,r){var i,n=(0,o.Z)(e.symbols);try{for(n.s();!(i=n.n()).done;){var a=(0,l.Z)(i.value,2),s=a[0];x(e,t,r,a[1],s)}}catch(u){n.e(u)}finally{n.f()}}function x(e,t,r,i,n){var a=e.layerData.get(n);if(a.type===d.I.SYMBOL){var s,u=(0,o.Z)(i);try{for(u.s();!(s=u.n()).done;){var c=s.value,h=c.unique,y=void 0;if(c.selectedForRendering){var f=h.parts[0],p=f.startOpacity,v=f.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===v;var _=r?Math.floor(127*p)|v<<7:v?255:0;y=_<<24|_<<16|_<<8|_}else y=0;var g,m=(0,o.Z)(c.iconVertexRanges);try{for(m.s();!(g=m.n()).done;)for(var I=(0,l.Z)(g.value,2),T=I[0],b=I[1],C=T;C<T+b;C+=4)a.iconOpacity[C/4]=y}catch(O){m.e(O)}finally{m.f()}if(c.selectedForRendering){var w=h.parts[1],x=w.startOpacity,R=w.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===R;var k=r?Math.floor(127*x)|R<<7:R?255:0;y=k<<24|k<<16|k<<8|k}else y=0;var S,E=(0,o.Z)(c.textVertexRanges);try{for(E.s();!(S=E.n()).done;)for(var D=(0,l.Z)(S.value,2),L=D[0],A=D[1],Z=L;Z<L+A;Z+=4)a.textOpacity[Z/4]=y}catch(O){E.e(O)}finally{E.f()}}}catch(O){u.e(O)}finally{u.f()}a.lastOpacityUpdate=t,a.opacityChanged=!0}}var R=function(){function e(t,r){(0,c.Z)(this,e),this.layerUIDs=[],this.isDestroyed=!1,this._data=t,this.memoryUsed=t.byteLength;var i=1,n=new Uint32Array(t);this.layerUIDs=[];for(var a=n[i++],s=0;s<a;s++)this.layerUIDs[s]=n[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}return(0,u.Z)(e,[{key:"isPreparedForRendering",get:function(){return(0,h.t)(this._data)}},{key:"offset",get:function(){return this.bufferDataOffset}},{key:"destroy",value:function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}},{key:"prepareForRendering",value:function(e){(0,h.t)(this._data)||(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}}]),e}(),k=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(e,i){var n;(0,c.Z)(this,r),(n=t.call(this,e,i)).type=d.I.LINE,n.lineIndexStart=0,n.lineIndexCount=0;var a=new Uint32Array(e),s=n.bufferDataOffset;n.lineIndexStart=a[s++],n.lineIndexCount=a[s++];var l=a[s++];if(l>0){for(var o=new Map,u=0;u<l;u++){var h=a[s++],y=a[s++],f=a[s++];o.set(h,[y,f])}n.patternMap=o}return n.bufferDataOffset=s,n}return(0,u.Z)(r,[{key:"hasData",value:function(){return this.lineIndexCount>0}},{key:"triangleCount",value:function(){return this.lineIndexCount/3}},{key:"doDestroy",value:function(){(0,h.r)(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),(0,h.r)(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),(0,h.r)(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,r){var i=new Uint32Array(t),n=new Int32Array(i.buffer),a=i[r++];this.lineVertexBuffer=p.E.createVertex(e,v.F.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;var s=i[r++];this.lineIndexBuffer=p.E.createIndex(e,v.F.STATIC_DRAW,new Uint32Array(i.buffer,4*r,s)),r+=s;var l=this.layer.lineMaterial;this.lineVertexArrayObject=new p.b(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}]),r}(R),S=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(e,i){var n;(0,c.Z)(this,r),(n=t.call(this,e,i)).type=d.I.FILL,n.fillIndexStart=0,n.fillIndexCount=0,n.outlineIndexStart=0,n.outlineIndexCount=0;var a=new Uint32Array(e),s=n.bufferDataOffset;n.fillIndexStart=a[s++],n.fillIndexCount=a[s++],n.outlineIndexStart=a[s++],n.outlineIndexCount=a[s++];var l=a[s++];if(l>0){for(var o=new Map,u=0;u<l;u++){var h=a[s++],y=a[s++],f=a[s++];o.set(h,[y,f])}n.patternMap=o}return n.bufferDataOffset=s,n}return(0,u.Z)(r,[{key:"hasData",value:function(){return this.fillIndexCount>0||this.outlineIndexCount>0}},{key:"triangleCount",value:function(){return(this.fillIndexCount+this.outlineIndexCount)/3}},{key:"doDestroy",value:function(){(0,h.r)(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),(0,h.r)(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),(0,h.r)(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,(0,h.r)(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),(0,h.r)(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),(0,h.r)(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,r){var i=new Uint32Array(t),n=new Int32Array(i.buffer),a=i[r++];this.fillVertexBuffer=p.E.createVertex(e,v.F.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;var s=i[r++];this.fillIndexBuffer=p.E.createIndex(e,v.F.STATIC_DRAW,new Uint32Array(i.buffer,4*r,s)),r+=s;var l=i[r++];this.outlineVertexBuffer=p.E.createVertex(e,v.F.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;var o=i[r++];this.outlineIndexBuffer=p.E.createIndex(e,v.F.STATIC_DRAW,new Uint32Array(i.buffer,4*r,o)),r+=o;var u=this.layer,c=u.fillMaterial,h=u.outlineMaterial;this.fillVertexArrayObject=new p.b(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new p.b(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}]),r}(R),E=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(e,i,n){var a;(0,c.Z)(this,r),(a=t.call(this,e,i)).type=d.I.SYMBOL,a.iconPerPageElementsMap=new Map,a.glyphPerPageElementsMap=new Map,a.symbolInstances=[],a.isIconSDF=!1,a.opacityChanged=!1,a.lastOpacityUpdate=0,a.symbols=[];var s=new Uint32Array(e),l=new Int32Array(e),o=new Float32Array(e),u=a.bufferDataOffset;a.isIconSDF=!!s[u++];for(var h=s[u++],y=0;y<h;y++){var f=s[u++],p=s[u++],v=s[u++];a.iconPerPageElementsMap.set(f,[p,v])}for(var _=s[u++],g=0;g<_;g++){var m=s[u++],I=s[u++],T=s[u++];a.glyphPerPageElementsMap.set(m,[I,T])}var b=s[u++],w=s[u++];return a.iconOpacity=new Int32Array(b),a.textOpacity=new Int32Array(w),u=C(s,l,o,u,a.symbols,n),a.bufferDataOffset=u,a}return(0,u.Z)(r,[{key:"hasData",value:function(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}},{key:"triangleCount",value:function(){var e,t=0,r=(0,o.Z)(this.iconPerPageElementsMap);try{for(r.s();!(e=r.n()).done;){var i=(0,l.Z)(e.value,2);i[0];t+=i[1][1]}}catch(u){r.e(u)}finally{r.f()}var n,a=(0,o.Z)(this.glyphPerPageElementsMap);try{for(a.s();!(n=a.n()).done;){var s=(0,l.Z)(n.value,2);s[0];t+=s[1][1]}}catch(u){a.e(u)}finally{a.f()}return t/3}},{key:"doDestroy",value:function(){(0,h.r)(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),(0,h.r)(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),(0,h.r)(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),(0,h.r)(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,(0,h.r)(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),(0,h.r)(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),(0,h.r)(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),(0,h.r)(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}},{key:"updateOpacityInfo",value:function(){if(this.opacityChanged){this.opacityChanged=!1;var e=(0,h.e)(this.iconOpacity),t=(0,h.e)(this.iconOpacityBuffer);e.length>0&&e.byteLength===t.size&&t.setSubData(e,0,0,e.length);var r=(0,h.e)(this.textOpacity),i=(0,h.e)(this.textOpacityBuffer);r.length>0&&r.byteLength===i.size&&i.setSubData(r,0,0,r.length)}}},{key:"doPrepareForRendering",value:function(e,t,r){var i=new Uint32Array(t),n=new Int32Array(i.buffer),a=i[r++];this.iconVertexBuffer=p.E.createVertex(e,v.F.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;var s=i[r++];this.iconIndexBuffer=p.E.createIndex(e,v.F.STATIC_DRAW,new Uint32Array(i.buffer,4*r,s)),r+=s;var l=i[r++];this.textVertexBuffer=p.E.createVertex(e,v.F.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;var o=i[r++];this.textIndexBuffer=p.E.createIndex(e,v.F.STATIC_DRAW,new Uint32Array(i.buffer,4*r,o)),r+=o,this.iconOpacityBuffer=p.E.createVertex(e,v.F.STATIC_DRAW,(0,h.e)(this.iconOpacity).buffer),this.textOpacityBuffer=p.E.createVertex(e,v.F.STATIC_DRAW,(0,h.e)(this.textOpacity).buffer);var u=this.layer,c=u.iconMaterial,y=u.textMaterial;this.iconVertexArrayObject=new p.b(e,c.getAttributeLocations(),c.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new p.b(e,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}]),r}(R),D=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(e,i){var n;(0,c.Z)(this,r),(n=t.call(this,e,i)).type=d.I.CIRCLE,n.circleIndexStart=0,n.circleIndexCount=0;var a=new Uint32Array(e),s=n.bufferDataOffset;return n.circleIndexStart=a[s++],n.circleIndexCount=a[s++],n.bufferDataOffset=s,n}return(0,u.Z)(r,[{key:"hasData",value:function(){return this.circleIndexCount>0}},{key:"triangleCount",value:function(){return this.circleIndexCount/3}},{key:"doDestroy",value:function(){(0,h.r)(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),(0,h.r)(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),(0,h.r)(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,r){var i=new Uint32Array(t),n=new Int32Array(i.buffer),a=i[r++];this.circleVertexBuffer=p.E.createVertex(e,v.F.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;var s=i[r++];this.circleIndexBuffer=p.E.createIndex(e,v.F.STATIC_DRAW,new Uint32Array(i.buffer,4*r,s)),r+=s;var l=this.layer.circleMaterial;this.circleVertexArrayObject=new p.b(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}]),r}(R),L=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(e,i,n,a,s,l,o){var u,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return(0,c.Z)(this,r),(u=t.call(this,e,i,n,a,s,l,4096,4096))._memCache=h,u.type="vector-tile",u._referenced=0,u._hasSymbolBuckets=!1,u._memoryUsedByLayerData=0,u.layerData=new Map,u.layerCount=0,u.status="loading",u.allSymbolsFadingOut=!1,u.lastOpacityUpdate=0,u.symbols=new Map,u.isCoverage=!1,u.neededForCoverage=!1,u.decluttered=!1,u.invalidating=!1,u.parentTile=null,u.childrenTiles=new Set,u._processed=!1,u._referenced=1,u.styleRepository=o,u.id=e.id,u}return(0,u.Z)(r,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<_.e}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<_.e)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"setData",value:function(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}},{key:"deleteLayerData",value:function(e){var t,r=!1,i=(0,o.Z)(e);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(this.layerData.has(n)){var a=this.layerData.get(n);this._memoryUsedByLayerData-=a.memoryUsed,a.type===d.I.SYMBOL&&this.symbols.has(n)&&(this.symbols.delete(n),r=!0),a.destroy(),this.layerData.delete(n),this.layerCount--}}}catch(s){i.e(s)}finally{i.f()}(0,h.r)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}},{key:"processed",value:function(){return this._processed}},{key:"hasData",value:function(){return this.layerCount>0}},{key:"dispose",value:function(){"unloaded"!==this.status&&(A.delete(this),r._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}},{key:"release",value:function(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}},{key:"retain",value:function(){++this._referenced}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}},{key:"changeDataImpl",value:function(e){var t=!1;if(e){var r=e.bucketsWithData,i=e.emptyBuckets,n=this._createRenderBuckets(r);if(i&&i.byteLength>0){var a,s=new Uint32Array(i),u=(0,o.Z)(s);try{for(u.s();!(a=u.n()).done;){var c=a.value;this._deleteLayerData(c)}}catch(T){u.e(T)}finally{u.f()}}var y,f=(0,o.Z)(n);try{for(f.s();!(y=f.n()).done;){var p=(0,l.Z)(y.value,2),v=p[0],_=p[1];this._deleteLayerData(v),_.type===d.I.SYMBOL&&(this.symbols.set(v,_.symbols),t=!0),this._memoryUsedByLayerData+=_.memoryUsed,this.layerData.set(v,_),this.layerCount++}}catch(T){f.e(T)}finally{f.f()}(0,h.r)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;var g,m=(0,o.Z)(this.layerData);try{for(m.s();!(g=m.n()).done;){var I=(0,l.Z)(g.value,2);I[0];I[1].type===d.I.SYMBOL&&(this._hasSymbolBuckets=!0)}}catch(T){m.e(T)}finally{m.f()}t&&this.emit("symbols-changed")}},{key:"attachWithContext",value:function(e){this.stage={context:e,trashDisplayObject:function(e){e.processDetach()},untrashDisplayObject:function(){return!1}}}},{key:"setTransform",value:function(e){(0,i.Z)((0,n.Z)(r.prototype),"setTransform",this).call(this,e);var t=this.resolution/(e.resolution*e.pixelRatio),a=this.width/this.rangeX*t,s=this.height/this.rangeY*t,l=[0,0];e.toScreen(l,[this.x,this.y]);var o=this.transforms.tileUnitsToPixels;(0,y.r)(o),(0,y.M)(o,o,l),(0,y.h)(o,o,Math.PI*e.rotation/180),(0,y.f)(o,o,[a,s,1])}},{key:"_createTransforms",value:function(){return{dvs:(0,f.e)(),tileMat3:(0,f.e)(),tileUnitsToPixels:(0,f.e)()}}},{key:"_createRenderBuckets",value:function(e){var t,r=new Map,i=new Map,n=(0,o.Z)(e);try{for(n.s();!(t=n.n()).done;){var a,s=t.value,l=this._deserializeBucket(s,i),u=(0,o.Z)(l.layerUIDs);try{for(u.s();!(a=u.n()).done;){var c=a.value;r.set(c,l)}}catch(h){u.e(h)}finally{u.f()}}}catch(h){n.e(h)}finally{n.f()}return r}},{key:"_deserializeBucket",value:function(e,t){var r=t.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case d.I.FILL:r=new S(e,this.styleRepository);break;case d.I.LINE:r=new k(e,this.styleRepository);break;case d.I.SYMBOL:r=new E(e,this.styleRepository,this);break;case d.I.CIRCLE:r=new D(e,this.styleRepository)}return t.set(e,r),r}},{key:"_deleteLayerData",value:function(e){if(this.layerData.has(e)){var t=this.layerData.get(e);this._memoryUsedByLayerData-=t.memoryUsed,t.destroy(),this.layerData.delete(e),this.layerCount--}}}],[{key:"_destroyRenderBuckets",value:function(e){if(e){var t=new Set;e.forEach((function(e){t.has(e)||(e.destroy(),t.add(e))})),e.clear()}}}]),r}(g.r),A=new Map;function Z(){A.forEach((function(e,t){console.log("\n".concat(t.key,":")),e[0].forEach((function(e){return console.log(e)})),console.log("========"),e[1].forEach((function(e){return console.log(e)}))}))}},34965:function(e,t,r){r.r(t);var i=r(1413),n=r(74165),a=r(15861),s=r(11752),l=r(61120),o=r(60136),u=r(29388),c=r(29439),h=r(37762),y=r(15671),f=r(43144),d=r(48848),p=r(64998),v=r(93661),_=r(50690),g=r(33794),m=r(25456),I=r(82474),T=r(75257),b=r(42525),C=r(39926),w=r(65703),x=r(51732),R=r(2467),k=r(37856),S=r(65636),E=r(92739),D=r(1206),L=r(43066),A=r(26789),Z=r(17327),O=r(93122),B=r(84495),V=r(91502),M=r(26313),P=r(31698),U=(r(75833),r(27205),r(62312),r(64095)),N=r(11448),F=r(97880),H=r(52195),z=(r(74384),r(46817),r(40558),r(25577),r(62610),r(93314),r(15751),r(40114),r(59984),r(20302),r(53586),r(65094),r(60369),r(92072),r(37944),r(86086),r(21385),r(89794),r(48200),r(71802),r(85253),r(93209),r(46337),r(81556),r(93116),r(56162),r(85113),r(75255),r(46737),r(52113),r(35182),r(72448),r(25217),r(3356),r(47855),r(6762),r(18144),r(6994),r(7131),r(1797),r(13239),r(68136),r(74337),r(44954),r(54233),r(4679),r(5650),r(35602),r(84234),r(18030),r(33795),r(79557),r(26151),r(91681),r(60491),r(87917),r(29048),r(52559),r(62466),r(15870),r(43924),r(55944),r(5430),r(53921),r(35237),r(89181),r(69641),r(15436),r(69768),r(630),function(e,t){return e+1/(1<<2*t)}),q=function(){function e(t,r){(0,y.Z)(this,e),this._tiles=new Map,this._tileCache=new C.e(40,(function(e){return e.dispose()})),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this._container=r}return(0,f.Z)(e,[{key:"destroy",value:function(){var e,t=(0,h.Z)(this._tiles);try{for(t.s();!(e=t.n()).done;){var r=(0,c.Z)(e.value,2);r[0];r[1].dispose()}}catch(i){t.e(i)}finally{t.f()}this._tiles=null,this._tileCache.clear(),this._tileCache=null}},{key:"update",value:function(e){this._updateCacheSize(e);var t,r=this.tileInfoView,i=r.getTileCoverage(e.state,0,"smallest"),n=i.spans,a=i.lodInfo,s=a.level,l=this._tiles,o=new Set,u=new Set,y=(0,h.Z)(n);try{for(y.s();!(t=y.n()).done;)for(var f=t.value,d=f.row,p=f.colFrom,v=f.colTo,_=p;_<=v;_++){var g=x.e.getId(s,d,a.normalizeCol(_),a.getWorldForColumn(_)),m=this._getOrAcquireTile(g);o.add(g),m.processed()?this._addToContainer(m):u.add(new x.e(g))}}catch(U){y.e(U)}finally{y.f()}var I,T=(0,h.Z)(l);try{for(T.s();!(I=T.n()).done;){var b=(0,c.Z)(I.value,2),C=b[0];b[1].isCoverage=o.has(C)}}catch(U){T.e(U)}finally{T.f()}var R,k=(0,h.Z)(u);try{for(k.s();!(R=k.n()).done;){var S=R.value;this._findPlaceholdersForMissingTiles(S,o)}}catch(U){k.e(U)}finally{k.f()}var E,D=!1,L=(0,h.Z)(l);try{for(L.s();!(E=L.n()).done;){var A=(0,c.Z)(E.value,2),Z=A[0],O=A[1];O.neededForCoverage=o.has(Z),O.neededForCoverage||O.isHoldingForFade&&r.intersects(i,O.key)&&o.add(Z),O.isFading&&(D=!0)}}catch(U){L.e(U)}finally{L.f()}var B,V=(0,h.Z)(this._tiles);try{for(V.s();!(B=V.n()).done;){var M=(0,c.Z)(B.value,2),P=M[0];M[1];o.has(P)||this._releaseTile(P)}}catch(U){V.e(U)}finally{V.f()}return w.l.pool.release(i),!D}},{key:"clear",value:function(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}},{key:"clearCache",value:function(){this._tileCache.clear()}},{key:"_findPlaceholdersForMissingTiles",value:function(e,t){var r,i=[],n=(0,h.Z)(this._tiles);try{for(n.s();!(r=n.n()).done;){var a=(0,c.Z)(r.value,2),s=(a[0],a[1]);this._addPlaceholderChild(i,s,e,t)}}catch(o){n.e(o)}finally{n.f()}var l=i.reduce(z,0);Math.abs(1-l)<1e-6||this._addPlaceholderParent(e.id,t)}},{key:"_addPlaceholderChild",value:function(e,t,r,i){t.key.level<=r.level||!t.hasData()||function(e,t){var r=t.level-e.level;return e.row===t.row>>r&&e.col===t.col>>r&&e.world===t.world}(r,t.key)&&(this._addToContainer(t),i.add(t.id),e.push(t.key.level-r.level))}},{key:"_addPlaceholderParent",value:function(e,t){for(var r=this._tiles,i=e;;){if(!(i=Q(i))||t.has(i))return;var n=r.get(i);if(n&&n.hasData())return this._addToContainer(n),void t.add(n.id)}}},{key:"_getOrAcquireTile",value:function(e){var t=this._tiles.get(e);return t||((t=this._tileCache.pop(e))||(t=this.acquireTile(new x.e(e))),this._tiles.set(e,t),t)}},{key:"_releaseTile",value:function(e){var t=this._tiles.get(e);this.releaseTile(t),this._removeFromContainer(t),this._tiles.delete(e),t.hasData()?this._tileCache.put(e,t,1):t.dispose()}},{key:"_addToContainer",value:function(e){var t,r=[],i=this._container;if(!i.contains(e)){var n,a=this._visibleTiles,s=(0,h.Z)(a);try{for(s.s();!(n=s.n()).done;){var l=(0,c.Z)(n.value,2),o=(l[0],l[1]);this._canConnectDirectly(e,o)&&r.push(o),(0,v.t)(t)&&this._canConnectDirectly(o,e)&&(t=o)}}catch(g){s.e(g)}finally{s.f()}if((0,v.r)(t)){var u,y=(0,h.Z)(r);try{for(y.s();!(u=y.n()).done;){var f=u.value;t.childrenTiles.delete(f),e.childrenTiles.add(f),f.parentTile=e}}catch(g){y.e(g)}finally{y.f()}t.childrenTiles.add(e),e.parentTile=t}else{var d,p=(0,h.Z)(r);try{for(p.s();!(d=p.n()).done;){var _=d.value;e.childrenTiles.add(_),_.parentTile=e}}catch(g){p.e(g)}finally{p.f()}}a.set(e.id,e),i.addChild(e)}}},{key:"_removeFromContainer",value:function(e){if(this._visibleTiles.delete(e.id),this._container.removeChild(e),(0,v.r)(e.parentTile)){e.parentTile.childrenTiles.delete(e);var t,r=(0,h.Z)(e.childrenTiles);try{for(r.s();!(t=r.n()).done;){var i=t.value;(0,v.r)(e.parentTile)&&e.parentTile.childrenTiles.add(i)}}catch(s){r.e(s)}finally{r.f()}}var n,a=(0,h.Z)(e.childrenTiles);try{for(a.s();!(n=a.n()).done;){n.value.parentTile=e.parentTile}}catch(s){a.e(s)}finally{a.f()}e.parentTile=null,e.childrenTiles.clear()}},{key:"_canConnectDirectly",value:function(e,t){for(var r=e.key,i=t.key,n=i.level,a=i.row,s=i.col,l=i.world,o=this._visibleTiles;n>0;){if(n--,a>>=1,s>>=1,r.level===n&&r.row===a&&r.col===s&&r.world===l)return!0;if(o.has("".concat(n,"/").concat(a,"/").concat(s,"/").concat(l)))return!1}return!1}},{key:"_updateCacheSize",value:function(e){var t=e.state.size;if(t[0]!==this._viewSize[0]||t[1]!==this._viewSize[1]){var r=Math.ceil(t[0]/512)+1,i=Math.ceil(t[1]/512)+1;this._viewSize[0]=t[0],this._viewSize[1]=t[1],this._tileCache.maxSize=5*r*i}}}]),e}();function Q(e){var t=e.split("/"),r=(0,c.Z)(t,4),i=r[0],n=r[1],a=r[2],s=r[3],l=parseInt(i,10);return 0===l?null:"".concat(l-1,"/").concat(parseInt(n,10)>>1,"/").concat(parseInt(a,10)>>1,"/").concat(parseInt(s,10))}var X=1e-6,j=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i){var n;return(0,y.Z)(this,r),(n=t.call(this)).styleRepository=e,n._tileToHandle=new Map,n._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},n._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},n._completed=!1,n._symbolRepository=new b.r(4096,i,(function(){return new R.s})),n._symbolDeclutterer=new b.i(i,n._symbolRepository,(function(e,t,r){return new b.l(e,t,r,n.styleRepository,n._zoom,n._viewState.rotation)}),(function(e,t){e.allSymbolsFadingOut=!0,e.lastOpacityUpdate=t,(0,R.c)(e,t,!0),e.decluttered=!0,e.requestRender()}),(function(e,t){return n.styleRepository.getStyleLayerByUID(e.styleLayerUID).z-n.styleRepository.getStyleLayerByUID(t.styleLayerUID).z}),(function(e){var t=n.styleRepository.getStyleLayerByUID(e);if(n._zoom+X<t.minzoom||n._zoom-X>=t.maxzoom)return!1;var r=t.getLayoutProperty("visibility");return!r||r.getValue()!==E.i.NONE})),n}return(0,f.Z)(r,[{key:"addTile",value:function(e){var t=this;e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",(function(){t._symbolRepository.add(e),t.restartDeclutter()}))),this._symbolRepository.add(e),this.restartDeclutter()}},{key:"removeTile",value:function(e){var t=this._tileToHandle.get(e);t&&(this._symbolRepository.removeTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}},{key:"update",value:function(e,t){return this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]},this._continueDeclutter(),this._completed}},{key:"restartDeclutter",value:function(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}},{key:"clear",value:function(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach((function(e){return e.remove()})),this._tileToHandle.clear()}},{key:"stale",get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}},{key:"deleteStyleLayers",value:function(e){this._symbolRepository.deleteStyleLayers(e)}},{key:"_continueDeclutter",value:function(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(S.c),this._completed&&this._scheduleNotifyStable())}},{key:"_scheduleNotifyStable",value:function(){var e=this;(0,v.r)(this._stableNotificationHandle)&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout((function(){e._stableNotificationHandle=null,e.emit("fade-complete")}),1.5*S.e)}},{key:"_notifyUnstable",value:function(){(0,v.r)(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this.emit("fade-start")}}]),r}(k.n),G=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,y.Z)(this,r),t.apply(this,arguments)}return(0,f.Z)(r,[{key:"_createTransforms",value:function(){return{dvs:(0,L.e)(),tileMat3:(0,L.e)()}}}]),r}(A.r),Y=1e-6;function W(e,t){if(e){var r=e.getLayoutProperty("visibility");if(!r||r.getValue()!==E.i.NONE&&(void 0===e.minzoom||e.minzoom<t+Y)&&(void 0===e.maxzoom||e.maxzoom>=t-Y))return!0}return!1}var K=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e){var i;return(0,y.Z)(this,r),(i=t.call(this,e))._backgroundTiles=[],i._pointToCallbacks=new Map,i}return(0,f.Z)(r,[{key:"destroy",value:function(){this.removeAllChildren(),this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null),(0,v.r)(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[],this._pointToCallbacks.clear()}},{key:"setStyleResources",value:function(e,t,r){var i=this;if(this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=r,(0,v.t)(this._symbolFader)){var n=new j(this._styleRepository,this.children);n.on("fade-start",(function(){i.emit("fade-start"),i.requestRender()})),n.on("fade-complete",(function(){i.emit("fade-complete"),i.requestRender()})),this._symbolFader=n}(0,v.e)(this._symbolFader).styleRepository=r}},{key:"setSpriteMosaic",value:function(e){this._spriteMosaic.dispose(),this._spriteMosaic=e}},{key:"deleteStyleLayers",value:function(e){(0,v.r)(this._symbolFader)&&this._symbolFader.deleteStyleLayers(e)}},{key:"hitTest",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,d.ap)(),e.abrupt("return",(this._pointToCallbacks.set(t,r),this.requestRender(),r.promise));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"enterTileInvalidation",value:function(){var e,t=(0,h.Z)(this.children);try{for(t.s();!(e=t.n()).done;){e.value.invalidating=!0}}catch(r){t.e(r)}finally{t.f()}}},{key:"createRenderParams",value:function(e){return(0,i.Z)((0,i.Z)({},(0,s.Z)((0,l.Z)(r.prototype),"createRenderParams",this).call(this,e)),{},{renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos})}},{key:"doRender",value:function(e){!this.visible||e.drawPhase!==D.I.MAP&&e.drawPhase!==D.I.DEBUG||void 0===this._spriteMosaic||(0,s.Z)((0,l.Z)(r.prototype),"doRender",this).call(this,e)}},{key:"addChild",value:function(e){return(0,s.Z)((0,l.Z)(r.prototype),"addChild",this).call(this,e),(0,v.r)(this._symbolFader)?this._symbolFader.addTile(e):e.decluttered=!0,this.requestRender(),e}},{key:"removeChild",value:function(e){return(0,v.r)(this._symbolFader)&&this._symbolFader.removeTile(e),this.requestRender(),(0,s.Z)((0,l.Z)(r.prototype),"removeChild",this).call(this,e)}},{key:"renderChildren",value:function(e){var t=e.drawPhase;if(t!==D.I.DEBUG){if(this._doRender(e),this._pointToCallbacks.size>0){e.drawPhase=D.I.HITTEST;var i=e.painter.effects.hittestVTL;i.bind(e),this._doRender(e),i.draw(e,this._pointToCallbacks),i.unbind(e),e.drawPhase=t}}else(0,s.Z)((0,l.Z)(r.prototype),"renderChildren",this).call(this,e)}},{key:"removeAllChildren",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];(0,v.r)(this._symbolFader)&&this._symbolFader.removeTile(t),t.dispose()}(0,s.Z)((0,l.Z)(r.prototype),"removeAllChildren",this).call(this)}},{key:"getStencilTarget",value:function(){return this.children.filter((function(e){return e.neededForCoverage&&e.hasData()}))}},{key:"restartDeclutter",value:function(){(0,v.r)(this._symbolFader)&&this._symbolFader.restartDeclutter()}},{key:"_doRender",value:function(e){var t=e.context,i=this._styleRepository;if(i){var n=i.layers,a=!0;e.drawPhase===D.I.HITTEST&&(a=!1),i.backgroundBucketIds.length>0&&(e.renderPass="background",this._renderBackgroundLayers(e,i.backgroundBucketIds)),(0,s.Z)((0,l.Z)(r.prototype),"renderChildren",this).call(this,e),e.drawPhase===D.I.MAP&&this._fade(e.displayLevel,e.state);var o=this.children.filter((function(e){return e.visible&&e.hasData()}));if(!o||0===o.length)return t.bindVAO(),t.setStencilTestEnabled(!0),void t.setBlendingEnabled(!0);var u,c=(0,h.Z)(o);try{for(c.s();!(u=c.n()).done;){u.value.triangleCount=0}}catch(d){c.e(d)}finally{c.f()}t.setStencilWriteMask(0),t.setColorMask(!0,!0,!0,!0),t.setStencilOp(O.O.KEEP,O.O.KEEP,O.O.REPLACE),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setDepthTestEnabled(!0),t.setDepthWriteEnabled(!0),t.setDepthFunction(O.I.LEQUAL),t.setClearDepth(1),t.clear(t.gl.DEPTH_BUFFER_BIT),e.renderPass="opaque";for(var y=n.length-1;y>=0;y--)this._renderStyleLayer(n[y],e,o);t.setDepthWriteEnabled(!1),t.setBlendingEnabled(a),t.setBlendFunctionSeparate(O.R.ONE,O.R.ONE_MINUS_SRC_ALPHA,O.R.ONE,O.R.ONE_MINUS_SRC_ALPHA),e.renderPass="translucent";for(var f=0;f<n.length;f++)this._renderStyleLayer(n[f],e,o);t.bindVAO(),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!0)}}},{key:"_fade",value:function(e,t){(0,v.r)(this._symbolFader)&&(this._symbolFader.update(e,t)||this.requestRender())}},{key:"_renderStyleLayer",value:function(e,t,r){var i=t.painter,n=t.renderPass;if(void 0!==e){var a=e.getLayoutProperty("visibility");if(!a||a.getValue()!==E.i.NONE){var s;switch(e.type){case E.a.BACKGROUND:return;case E.a.FILL:if("opaque"!==n&&"translucent"!==t.renderPass)return;s="vtlFill";break;case E.a.LINE:if("translucent"!==n)return;s="vtlLine";break;case E.a.CIRCLE:if("translucent"!==n)return;s="vtlCircle";break;case E.a.SYMBOL:if("translucent"!==n)return;s="vtlSymbol"}if(r=e.type===E.a.SYMBOL?r.filter((function(e){return e.decluttered})):r.filter((function(e){return e.neededForCoverage})),"vtlSymbol"!==s){var l=t.displayLevel;if(0===r.length||void 0!==e.minzoom&&e.minzoom>=l+Y||void 0!==e.maxzoom&&e.maxzoom<l-Y)return}var o=e.uid;t.styleLayerUID=o,t.styleLayer=e;var u,c=(0,h.Z)(r);try{for(c.s();!(u=c.n()).done;){if(u.value.layerData.has(o)){i.renderObjects(t,r,s);break}}}catch(y){c.e(y)}finally{c.f()}}}}},{key:"_renderBackgroundLayers",value:function(e,t){var r,i=e.context,n=e.displayLevel,a=e.painter,s=e.state,l=this._styleRepository,o=!1,u=(0,h.Z)(t);try{for(u.s();!(r=u.n()).done;){var c=r.value;if(l.getLayerById(c).type===E.a.BACKGROUND&&W(l.getLayerById(c),n)){o=!0;break}}}catch(q){u.e(q)}finally{u.f()}if(o){var y=this._tileInfoView.getTileCoverage(e.state,0,"smallest"),f=y.spans,d=y.lodInfo,p=d.level,_=(0,m.u)(),g=[];if(this._renderPasses){var I=this._renderPasses[0];(0,v.r)(this._clippingInfos)&&(I.brushes[0].prepareState(e),I.brushes[0].drawMany(e,this._clippingInfos))}var T,b,C=this._backgroundTiles,R=0,k=(0,h.Z)(f);try{for(k.s();!(b=k.n()).done;)for(var S=b.value,L=S.row,A=S.colFrom,Z=S.colTo,B=A;B<=Z;B++){if(R<C.length)(T=C[R]).key.set(p,L,d.normalizeCol(B),d.getWorldForColumn(B)),this._tileInfoView.getTileBounds(_,T.key,!1),T.x=_[0],T.y=_[3],T.resolution=this._tileInfoView.getTileResolution(p);else{var V=new x.e(p,L,d.normalizeCol(B),d.getWorldForColumn(B)),M=this._tileInfoView.getTileBounds((0,m.u)(),V),P=this._tileInfoView.getTileResolution(p);T=new G(V,P,M[0],M[3],512,512,4096,4096),C.push(T)}T.setTransform(s),g.push(T),R++}}catch(q){k.e(q)}finally{k.f()}i.setStencilWriteMask(0),i.setColorMask(!0,!0,!0,!0),i.setStencilOp(O.O.KEEP,O.O.KEEP,O.O.REPLACE),i.setStencilFunction(O.I.EQUAL,0,255);var U=!0;e.drawPhase===D.I.HITTEST&&(U=!1),i.setStencilTestEnabled(U);var N,F=(0,h.Z)(t);try{for(F.s();!(N=F.n()).done;){var H=N.value,z=l.getLayerById(H);z.type===E.a.BACKGROUND&&W(z,n)&&(e.styleLayerUID=z.uid,e.styleLayer=z,a.renderObjects(e,g,"vtlBackground"))}}catch(q){F.e(q)}finally{F.f()}w.l.pool.release(y)}}}]),r}(Z.i),J={geometry:[new N.t("a_PositionAndFlags",3,O.C.SHORT,0,6)]},$=new Map;$.set("a_PositionAndFlags",0);var ee={vsPath:"debug/overlay",fsPath:"debug/overlay",attributes:$},te=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e){var i;return(0,y.Z)(this,r),(i=t.call(this))._conf=e,i}return(0,f.Z)(r,[{key:"_createTransforms",value:function(){return{dvs:(0,L.e)()}}},{key:"doRender",value:function(e){this._updateTransforms(e),this._ensureResources(e);var t=e.context;t.useProgram(this._program),this._program.setUniformMatrix3fv("u_dvsMat3",this.transforms.dvs),this._program.setUniform4fv("u_colors",this._conf.getColors(e)),this._program.setUniform1fv("u_opacities",this._conf.getOpacities(e));var r=this._conf.getMesh(e),i=r.vertexData,n=r.indexData;this._vertexBuffer.setData(i),this._indexBuffer.setData(n),t.bindVAO(this._vertexArray),t.setBlendingEnabled(!0),t.setBlendFunction(O.R.ONE,O.R.ONE_MINUS_SRC_ALPHA),t.setDepthTestEnabled(!1),t.setStencilTestEnabled(!1),t.setColorMask(!0,!0,!0,!0),t.drawElements(O.E.TRIANGLES,n.length,O.C.UNSIGNED_INT,0)}},{key:"onDetach",value:function(){this._vertexArray&&(this._vertexArray.dispose(),this._vertexArray=null)}},{key:"_updateTransforms",value:function(e){(0,M.r)(this.transforms.dvs),(0,M.M)(this.transforms.dvs,this.transforms.dvs,[-1,1]),(0,M.f)(this.transforms.dvs,this.transforms.dvs,[2/e.state.size[0],-2/e.state.size[1],1])}},{key:"_ensureResources",value:function(e){var t=e.context;this._program||(this._program=e.painter.materialManager.getProgram(ee)),this._vertexBuffer||(this._vertexBuffer=P.E.createVertex(t,O.F.STREAM_DRAW)),this._indexBuffer||(this._indexBuffer=P.E.createIndex(t,O.F.STREAM_DRAW)),this._vertexArray||(this._vertexArray=new P.b(t,$,J,{geometry:this._vertexBuffer},this._indexBuffer))}}],[{key:"makeFlags",value:function(e,t){return e|t<<2}}]),r}(U.r),re=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,y.Z)(this,r),(e=t.apply(this,arguments))._styleChanges=[],e._fetchQueue=null,e._parseQueue=null,e._isTileHandlerReady=!1,e.fading=!1,e._getCollidersMesh=function(t){var r,i=t.state.pixelRatio,n=0,a=[],s=[],l=(0,h.Z)(e._vectorTileContainer.children);try{for(l.s();!(r=l.n()).done;){var o=r.value;if(o.symbols){var u,y=(0,h.Z)(o.symbols);try{for(y.s();!(u=y.n()).done;){var f,d=(0,c.Z)(u.value,2),p=(d[0],d[1]),v=(0,h.Z)(p);try{for(v.s();!(f=v.n()).done;){var _,g=f.value,m=(0,h.Z)(g.colliders);try{for(m.s();!(_=m.n()).done;){var I=_.value,T=(I.xScreen+I.dxScreen)*i,b=(I.yScreen+I.dyScreen)*i,C=I.width*i,w=I.height*i,x=g.unique.parts[I.partIndex].targetOpacity>.5;if(x||"all"===e.layer.showCollisionBoxes){var R=x?2:0,k=x?3:0,S=te.makeFlags(R,k);a.push(T,b,S,T+C,b,S,T,b+w,S,T+C,b+w,S),s.push(n+0,n+1,n+2,n+1,n+3,n+2),n+=4;var E=x?3:1,D=x?3:0,L=te.makeFlags(E,D);a.push(T,b,L,T+C,b,L,T,b+1,L,T+C,b+1,L),s.push(n+0,n+1,n+2,n+1,n+3,n+2),n+=4,a.push(T,b+w-1,L,T+C,b+w-1,L,T,b+w,L,T+C,b+w,L),s.push(n+0,n+1,n+2,n+1,n+3,n+2),n+=4,a.push(T,b,L,T+1,b,L,T,b+w,L,T+1,b+w,L),s.push(n+0,n+1,n+2,n+1,n+3,n+2),n+=4,a.push(T+C-1,b,L,T+C,b,L,T+C-1,b+w,L,T+C,b+w,L),s.push(n+0,n+1,n+2,n+1,n+3,n+2),n+=4}}}catch(A){m.e(A)}finally{m.f()}}}catch(A){v.e(A)}finally{v.f()}}}catch(A){y.e(A)}finally{y.f()}}}}catch(A){l.e(A)}finally{l.f()}return{vertexData:new Int16Array(a),indexData:new Uint32Array(s)}},e._getCollidersColors=function(){return[1,.5,0,1,1,0,0,1,0,1,.5,1,0,.5,0,1]},e._getCollidersOpacities=function(){return[.05,.01,.15,.2]},e}return(0,f.Z)(r,[{key:"hitTest",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r){var i,a,s,l,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._tileHandlerPromise){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this._tileHandlerPromise;case 4:return e.next=6,this._vectorTileContainer.hitTest(r);case 6:if((i=e.sent)&&0!==i.length){e.next=9;break}return e.abrupt("return",null);case 9:if(a=i[0]-1,s=this._styleRepository,l=s.getStyleLayerByUID(a)){e.next=12;break}return e.abrupt("return",null);case 12:return o=s.getStyleLayerIndex(l.id),e.abrupt("return",[{type:"graphic",mapPoint:t,layer:this.layer,graphic:new p.g({attributes:{layerId:o,layerName:l.id,layerUID:a},layer:this.layer,sourceLayer:this.layer})}]);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"update",value:function(e){if(this._tileHandlerPromise&&this._isTileHandlerReady)return e.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=e.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=e.state,this._parseQueue.state=e.state,this._tileManager.update(e)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}},{key:"attach",value:function(){var e=this,t=this.layer.currentStyleInfo.style;this._styleRepository=new B.l(t),this._tileInfoView=new b.t(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new K(this._tileInfoView),this._tileHandler=new b.n(this.layer,this._styleRepository,window.devicePixelRatio||1),this.container.addChild(this._vectorTileContainer),this._start(),this.handles.add([this._vectorTileContainer.on("fade-start",(function(){e.fading=!0,e.notifyChange("updating"),e.requestUpdate()})),this._vectorTileContainer.on("fade-complete",(function(){var t;null!==(t=e._collisionOverlay)&&void 0!==t&&t.requestRender(),e.fading=!1,e.notifyChange("updating"),e.requestUpdate()})),(0,_.l)((function(){return e.layer.showCollisionBoxes}),(function(t){"none"!==t?e._collisionOverlay||(e._collisionOverlay=new te({getMesh:e._getCollidersMesh,getColors:e._getCollidersColors,getOpacities:e._getCollidersOpacities}),e.container.addChild(e._collisionOverlay)):(e.container.removeChild(e._collisionOverlay),e._collisionOverlay=null),e.container.requestRender()}),_.h),this.layer.on("paint-change",(function(t){if(t.isDataDriven)e._styleChanges.push({type:T.L.PAINTER_CHANGED,data:t}),e.notifyChange("updating"),e.requestUpdate();else{var r=e._styleRepository,i=r.getLayerById(t.layer);if(!i)return;var n=i.type===E.a.SYMBOL;r.setPaintProperties(t.layer,t.paint),n&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender()}})),this.layer.on("layout-change",(function(t){var r=e._styleRepository,i=r.getLayerById(t.layer);if(i){var n=(0,g.m)(i.layout,t.layout);if(!(0,v.t)(n)){if((0,g.a)(n,"visibility")&&1===function(e){if((0,v.t)(e))return 0;switch(e.type){case"partial":return Object.keys(e.diff).length;case"complete":return Math.max(Object.keys(e.oldValue).length,Object.keys(e.newValue).length);case"collection":return Object.keys(e.added).length+Object.keys(e.changed).length+Object.keys(e.removed).length}}(n))return r.setLayoutProperties(t.layer,t.layout),i.type===E.a.SYMBOL&&e._vectorTileContainer.restartDeclutter(),void e._vectorTileContainer.requestRender();e._styleChanges.push({type:T.L.LAYOUT_CHANGED,data:t}),e.notifyChange("updating"),e.requestUpdate()}}})),this.layer.on("style-layer-visibility-change",(function(t){var r=e._styleRepository,i=r.getLayerById(t.layer);i&&(r.setStyleLayerVisibility(t.layer,t.visibility),i.type===E.a.SYMBOL&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender())})),this.layer.on("style-layer-change",(function(t){e._styleChanges.push({type:T.L.LAYER_CHANGED,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("delete-style-layer",(function(t){e._styleChanges.push({type:T.L.LAYER_REMOVED,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("load-style",(function(){return e._loadStyle()})),this.layer.on("spriteSource-change",(function(t){e._newSpriteSource=t.spriteSource,e._styleChanges.push({type:T.L.SPRITES_CHANGED,data:null});var r,i=e._styleRepository.layers,n=(0,h.Z)(i);try{for(n.s();!(r=n.n()).done;){var a=r.value;switch(a.type){case E.a.SYMBOL:a.getLayoutProperty("icon-image")&&e._styleChanges.push({type:T.L.LAYOUT_CHANGED,data:{layer:a.id,layout:a.layout}});break;case E.a.LINE:a.getPaintProperty("line-pattern")&&e._styleChanges.push({type:T.L.PAINTER_CHANGED,data:{layer:a.id,paint:a.paint,isDataDriven:a.isPainterDataDriven()}});break;case E.a.FILL:a.getLayoutProperty("fill-pattern")&&e._styleChanges.push({type:T.L.PAINTER_CHANGED,data:{layer:a.id,paint:a.paint,isDataDriven:a.isPainterDataDriven()}})}}}catch(s){n.e(s)}finally{n.f()}e.notifyChange("updating"),e.requestUpdate()}))],this.declaredClass)}},{key:"detach",value:function(){var e,t;this._stop(),this.container.removeAllChildren(),null!==(e=this._vectorTileContainer)&&void 0!==e&&e.destroy(),this._vectorTileContainer=null,null!==(t=this._tileHandler)&&void 0!==t&&t.destroy(),this._tileHandler=null,this.handles.remove(this.declaredClass)}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this._collisionOverlay&&this._vectorTileContainer.restartDeclutter(),this.requestUpdate()}},{key:"supportsSpatialReference",value:function(e){var t;return(0,I.E)(null===(t=this.layer.tileInfo)||void 0===t?void 0:t.spatialReference,e)}},{key:"canResume",value:function(){var e=(0,s.Z)((0,l.Z)(r.prototype),"canResume",this).call(this),t=this.layer.currentStyleInfo;if(e&&null!==t&&void 0!==t&&t.layerDefinition){var i=this.view.scale,n=t.layerDefinition,a=n.minScale,o=n.maxScale;t&&t.layerDefinition&&(a&&a<i&&(e=!1),o&&o>i&&(e=!1))}return e}},{key:"isUpdating",value:function(){var e=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||e.length>0&&e.some((function(e){return e.invalidating}))||this.fading}},{key:"acquireTile",value:function(e){var t=this,r=this._createVectorTile(e);return this._tileHandlerPromise.then((function(){t._fetchQueue.push(r.key).then((function(e){return t._parseQueue.push({key:r.key,data:e})})).then((function(e){r.once("attach",(function(){return t.requestUpdate()})),r.setData(e),t.requestUpdate(),t.notifyChange("updating")})).catch((function(e){t.notifyChange("updating"),(0,d.j)(e)||d.a.getLogger(t.declaredClass).error(e)}))})),r}},{key:"releaseTile",value:function(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}},{key:"_start",value:function(){var e=this;if(this._stop(),this._tileManager=new q({acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:this._tileInfoView},this._vectorTileContainer),this.layer.currentStyleInfo){var t=new AbortController,r=this._tileHandler.start({signal:t.signal}).then((function(){e._fetchQueue=new F.y({tileInfoView:e._tileInfoView,process:function(t,r){return e._getTileData(t,r)},concurrency:15}),e._parseQueue=new F.y({tileInfoView:e._tileInfoView,process:function(t,r){return e._parseTileData(t,r)},concurrency:8}),e.requestUpdate(),e._isTileHandlerReady=!0}));this._tileHandler.spriteMosaic.then((function(t){e._vectorTileContainer.setStyleResources(t,e._tileHandler.glyphMosaic,e._styleRepository),e.requestUpdate()})),this._tileHandlerAbortController=t,this._tileHandlerPromise=r}}},{key:"_stop",value:function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null),this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null),this._tileManager&&(this._tileManager.destroy(),this._tileManager=null),this._vectorTileContainer.removeAllChildren()}}},{key:"_getTileData",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._tileHandler.fetchTileData(t,r);case 2:return i=e.sent,e.abrupt("return",(this.notifyChange("updating"),i));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_parseTileData",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(t,r){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._tileHandler.parseTileData(t,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_applyStyleChanges",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,r,i,a,s,l,o,u,c,y,f,p,v=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this._tileManager.clearCache(),t=this._styleChanges,e.prev=2,e.next=5,this._tileHandler.updateStyle(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),d.a.getLogger(this.declaredClass).error("error applying vector-tiles style update",e.t0.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0;case 10:if(r=this._styleRepository,i=[],t.forEach((function(e){if(e.type===T.L.LAYER_REMOVED){var t=e.data,n=r.getLayerById(t.layer);n&&i.push(n.uid)}})),a=[],t.forEach((function(e){var t=e.type,i=e.data;switch(t){case T.L.PAINTER_CHANGED:r.setPaintProperties(i.layer,i.paint),s=i.layer;break;case T.L.LAYOUT_CHANGED:r.setLayoutProperties(i.layer,i.layout),s=i.layer;break;case T.L.LAYER_REMOVED:return void r.deleteStyleLayer(i.layer);case T.L.LAYER_CHANGED:r.setStyleLayer(i.layer,i.index),s=i.layer.id;break;case T.L.SPRITES_CHANGED:v._vectorTileContainer.setSpriteMosaic(v._tileHandler.setSpriteSource(v._newSpriteSource)),v._newSpriteSource=null,s=null}var n=r.getLayerById(s);n&&a.push(n.uid)})),l=this._vectorTileContainer.children,i.length>0){this._vectorTileContainer.deleteStyleLayers(i),o=(0,h.Z)(l);try{for(o.s();!(u=o.n()).done;)u.value.deleteLayerData(i)}catch(n){o.e(n)}finally{o.f()}}if(this._fetchQueue.resume(),this._parseQueue.resume(),!(a.length>0)){e.next=22;break}c=[],y=(0,h.Z)(l);try{for(p=function(){var e=f.value,t=v._fetchQueue.push(e.key).then((function(t){return v._parseQueue.push({key:e.key,data:t,styleLayerUIDs:a})})).then((function(t){return e.setData(t)}));c.push(t)},y.s();!(f=y.n()).done;)p()}catch(n){y.e(n)}finally{y.f()}return e.next=22,Promise.all(c);case 22:this._styleChanges=[],this._isTileHandlerReady=!0,this.notifyChange("updating"),this.requestUpdate();case 23:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"_loadStyle",value:function(){var e=(0,a.Z)((0,n.Z)().mark((function e(){var t,r,i,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.currentStyleInfo.style,r=(0,v.y)(t),this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this.notifyChange("updating"),this._styleRepository=new B.l(r),this._vectorTileContainer.destroy(),this._tileManager.clear(),this._tileHandlerAbortController.abort(),this._tileHandlerAbortController=new AbortController,i=this._tileHandlerAbortController.signal,e.prev=3,this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,r),e.next=7,this._tileHandlerPromise;case 7:e.next=13;break;case 9:if(e.prev=9,e.t0=e.catch(3),(0,d.j)(e.t0)){e.next=13;break}throw e.t0;case 13:if(!i.aborted){e.next=15;break}return e.abrupt("return",(this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange("updating"),void this.requestUpdate()));case 15:return e.next=17,this._tileHandler.spriteMosaic;case 17:a=e.sent,this._vectorTileContainer.setStyleResources(a,this._tileHandler.glyphMosaic,this._styleRepository),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.notifyChange("updating"),this.requestUpdate();case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"_createVectorTile",value:function(e){var t=this._tileInfoView.getTileBounds((0,m.u)(),e),r=this._tileInfoView.getTileResolution(e.level);return new R.m(e,r,t[0],t[3],512,512,this._styleRepository)}}]),r}((0,V.y)(H.u));(0,d.e)([(0,d.y)()],re.prototype,"_fetchQueue",void 0),(0,d.e)([(0,d.y)()],re.prototype,"_parseQueue",void 0),(0,d.e)([(0,d.y)()],re.prototype,"_isTileHandlerReady",void 0),(0,d.e)([(0,d.y)()],re.prototype,"fading",void 0);var ie=re=(0,d.e)([(0,d.n)("esri.views.2d.layers.VectorTileLayerView2D")],re);t.default=ie},75257:function(e,t,r){var i,n,a,s,l;r.d(t,{I:function(){return n},L:function(){return l},T:function(){return s}}),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"}(i||(i={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(n||(n={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(a||(a={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(s||(s={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(l||(l={}))},25217:function(e,t,r){r.d(t,{o:function(){return n},r:function(){return a}});var i=r(71802);function n(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=(0,i.a)(e,0,o),a=0;a<4;a++)t[r+a]=Math.floor(256*u(n*s[a]))}function a(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0,i=0;i<4;i++)r+=e[t+i]*l[i];return r}var s=[1,256,65536,16777216],l=[1/256,1/65536,1/16777216,1/4294967296],o=a(new Uint8ClampedArray([255,255,255,255]));function u(e){return e-Math.floor(e)}}}]);
//# sourceMappingURL=4965.ec524c34.chunk.js.map