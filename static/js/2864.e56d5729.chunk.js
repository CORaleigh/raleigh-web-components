"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[2864],{80817:function(e,t,r){r.d(t,{S:function(){return q}});var i=r(74165),n=r(37762),a=r(15861),o=r(15671),s=r(43144),u=r(60136),l=r(29388),c=r(29439),h=r(23132),d=(r(75610),r(80262)),p=r(78311),y=r(30709),v=r(4720),f=r(54323),m=r(38415),g=r(59819),x=Math.PI/180;function w(e){return e*x}function b(e,t){var r=w(t.rotation),i=Math.abs(Math.cos(r)),n=Math.abs(Math.sin(r)),a=(0,c.Z)(t.size,2),o=a[0],s=a[1];return e[0]=Math.round(s*n+o*i),e[1]=Math.round(s*i+o*n),e}function k(e,t,r,i){var n=(0,c.Z)(t,2),a=n[0],o=n[1],s=(0,c.Z)(i,2),u=s[0],l=s[1],h=.5*r;return e[0]=a-h*u,e[1]=o-h*l,e[2]=a+h*u,e[3]=o+h*l,e}var _=(0,p.u)(),Z=[0,0],R=new g.e(0,0,0,0),P=2048,S=2048,E=!1,M=!1,V=!1,T=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e){var s;return(0,o.Z)(this,r),(s=t.call(this,e))._imagePromise=null,s.bitmaps=[],s.hidpi=V,s.imageMaxWidth=P,s.imageMaxHeight=S,s.imageRotationSupported=E,s.imageNormalizationSupported=M,s.update=(0,h.x)(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var o,u,l,c,h,d,p,v,f,m,g;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stationary&&!s.destroyed){e.next=2;break}return e.abrupt("return",null);case 2:return o=t.state,u=(0,y.b)(o.spatialReference),l=s.hidpi?t.pixelRatio:1,(c=s.imageNormalizationSupported&&o.worldScreenWidth&&o.worldScreenWidth<o.size[0])?(Z[0]=o.worldScreenWidth,Z[1]=o.size[1]):s.imageRotationSupported?(Z[0]=o.size[0],Z[1]=o.size[1]):b(Z,o),h=Math.floor(Z[0]*l)>s.imageMaxWidth||Math.floor(Z[1]*l)>s.imageMaxHeight,d=u&&(o.extent.xmin<u.valid[0]||o.extent.xmax>u.valid[1]),p=!s.imageNormalizationSupported&&d,v=!h&&!p,f=s.imageRotationSupported?o.rotation:0,v?(m=c?o.paddedViewState.center:o.center,s._imagePromise=s._singleExport(o,Z,m,o.resolution,f,l,r)):(g=Math.min(s.imageMaxWidth,s.imageMaxHeight),p&&(g=Math.min(o.worldScreenWidth,g)),s._imagePromise=s._tiledExport(o,g,l,r)),e.abrupt("return",s._imagePromise.then(function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,a,o,u,l,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s._imagePromise=null,!s.destroyed){s.bitmaps=null!==t&&void 0!==t?t:[],r=(0,n.Z)(s.container.children);try{for(o=function(){var e=a.value;t.includes(e)||e.fadeOut().then((function(){e.remove()}))},r.s();!(a=r.n()).done;)o()}catch(i){r.e(i)}finally{r.f()}u=(0,n.Z)(t);try{for(u.s();!(l=u.n()).done;)c=l.value,s.container.addChild(c),c.fadeIn()}catch(i){u.e(i)}finally{u.f()}}case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){throw s._imagePromise=null,e})));case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),5e3),s}return(0,s.Z)(r,[{key:"destroy",value:function(){this.bitmaps=[]}},{key:"updating",get:function(){return!this.destroyed&&null!==this._imagePromise}},{key:"updateExports",value:function(e){var t,r=(0,n.Z)(this.container.children);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(!i.visible||!i.stage)return;e(i),i.invalidateTexture(),i.requestRender()}}catch(a){r.e(a)}finally{r.f()}}},{key:"_export",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n,a,o,s){var u,l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchSource(t,Math.floor(r*o),Math.floor(n*o),{rotation:a,pixelRatio:o,signal:s});case 2:return u=e.sent,l=new f.v(u,"additive"),e.abrupt("return",(l.x=t.xmin,l.y=t.ymax,l.resolution=t.width/r,l.rotation=a,l.pixelRatio=o,l));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,o){return e.apply(this,arguments)}}()},{key:"_singleExport",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,n,a,o,s,u){var l;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k(_,n,a,r),l=new d.M(_[0],_[1],_[2],_[3],t.spatialReference),e.next=4,this._export(l,r[0],r[1],o,s,u);case 4:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,i,n,a,o,s){return e.apply(this,arguments)}}()},{key:"_tiledExport",value:function(e,t,r,i){var n=this,a=v.S.create({size:t,spatialReference:e.spatialReference,scales:[e.scale]}),o=new m.h(a),s=o.getTileCoverage(e);if(!s)return null;var u=[];return s.forEach((function(a,s,l,c){R.set(a,s,l,c),o.getTileBounds(_,R);var h=new d.M(_[0],_[1],_[2],_[3],e.spatialReference);u.push(n._export(h,t,t,0,r,i))})),Promise.all(u)}}]),r}(h.y);(0,h.e)([(0,h.d)()],T.prototype,"_imagePromise",void 0),(0,h.e)([(0,h.d)()],T.prototype,"bitmaps",void 0),(0,h.e)([(0,h.d)()],T.prototype,"container",void 0),(0,h.e)([(0,h.d)()],T.prototype,"fetchSource",void 0),(0,h.e)([(0,h.d)()],T.prototype,"hidpi",void 0),(0,h.e)([(0,h.d)()],T.prototype,"imageMaxWidth",void 0),(0,h.e)([(0,h.d)()],T.prototype,"imageMaxHeight",void 0),(0,h.e)([(0,h.d)()],T.prototype,"imageRotationSupported",void 0),(0,h.e)([(0,h.d)()],T.prototype,"imageNormalizationSupported",void 0),(0,h.e)([(0,h.d)()],T.prototype,"requestUpdate",void 0),(0,h.e)([(0,h.d)()],T.prototype,"updating",null);var q=T=(0,h.e)([(0,h.n)("esri.views.2d.layers.support.ExportStrategy")],T)},2380:function(e,t,r){r.d(t,{n:function(){return y}});var i=r(15671),n=r(43144),a=r(11752),o=r(61120),s=r(60136),u=r(29388),l=r(23132),c=(r(75610),r(28329)),h=r(75354),d=r(6819),p=function(e){(0,s.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,n.Z)(r,[{key:"doRender",value:function(e){e.drawPhase===c.I.HIGHLIGHT&&(0,a.Z)((0,o.Z)(r.prototype),"doRender",this).call(this,e)}},{key:"renderChildren",value:function(e){if(this.attributeView.bindTextures(e.context),this.children.some((function(e){return e.hasData}))){(0,a.Z)((0,o.Z)(r.prototype),"renderChildren",this).call(this,e);var t=e.painter.effects.highlight;t.bind(e),e.context.setColorMask(!0,!0,!0,!0),e.context.clear(d._.COLOR_BUFFER_BIT),this._renderChildren(e,t.defines.concat(["highlightAll"])),t.draw(e),t.unbind()}}}]),r}(h.t),y=p=(0,l.e)([(0,l.n)("esri.views.2d.layers.support.HighlightGraphicContainer")],p)},15261:function(e,t,r){r.d(t,{m:function(){return m}});var i=r(74165),n=r(15861),a=r(15671),o=r(43144),s=r(11752),u=r(61120),l=r(60136),c=r(29388),h=r(23132),d=r(75610),p=r(30709),y=r(18411),v=r(34860),f=r(42152),m=function(e){var t=function(e){(0,l.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).view=null,e}return(0,o.Z)(r,[{key:"fetchPopupFeatures",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n,a,o,s,u,l,c,y,m,g,x;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.layer,t){e.next=3;break}throw new h.a("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:n});case 3:if(a=n.popupEnabled,o=(0,f.s)(n,r),a&&!(0,d.t)(o)){e.next=6;break}throw new h.a("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:o});case 6:return e.next=8,o.getRequiredFields();case 8:return s=e.sent,(u=new v.b).timeExtent=this.timeExtent,u.geometry=t,u.outFields=s,u.outSpatialReference=t.spatialReference,l=this.view.resolution,c="2d"===this.view.type?new p.j(l,l,this.view.spatialReference):new p.j(.5*l,.5*l,this.view.spatialReference),y=o.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},m=y.returnTopmostRaster,g=y.showNoDataRecords,x={returnDomainValues:!0,returnTopmostRaster:m,pixelSize:c,showNoDataRecords:g,signal:(0,d.r)(r)?r.signal:null},e.abrupt("return",n.queryVisibleRasters(u,x).then((function(e){return e})));case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){var e;return!!(0,s.Z)((0,u.Z)(r.prototype),"canResume",this).call(this)&&!(null!==(e=this.timeExtent)&&void 0!==e&&e.isEmpty)}}]),r}(e);return(0,h.e)([(0,h.d)()],t.prototype,"layer",void 0),(0,h.e)([(0,h.d)()],t.prototype,"suspended",void 0),(0,h.e)([(0,h.d)(y.g)],t.prototype,"timeExtent",void 0),(0,h.e)([(0,h.d)()],t.prototype,"view",void 0),t=(0,h.e)([(0,h.n)("esri.views.layers.ImageryLayerView")],t)}},72864:function(e,t,r){r.r(t);var i=r(74165),n=r(29439),a=r(15861),o=r(93433),s=r(11752),u=r(61120),l=r(15671),c=r(43144),h=r(60136),d=r(29388),p=r(23132),y=r(83822),v=r(80175),f=r(36551),m=r(75610),g=r(81663),x=r(47650),w=r(20842),b=r(75354),k=r(2380),_=r(93669),Z=r(97402),R=r(49607),P=r(54323),S=r(80817),E=r(57714),M=r(97033),V=r(80262),T=r(75105),q=r(40881),z=r(76470),D=r(28329),I=r(95208),B=r(15261),C=r(5900),F=r(19231),U=(r(91204),r(30709),r(70441),r(36460),r(51451),r(50526),r(50448),r(41742),r(43920),r(1773),r(77196),r(24980),r(3114),r(22144),r(78674),r(66307),r(2760),r(88370),r(72820),r(78311),r(96349),r(9055),r(79611),r(2157),r(30604),r(21583),r(90138),r(6819),r(97566),r(45332),r(96401),r(40273),r(77470),r(84538),r(49580),r(54841),r(33703),r(92870),r(72692),r(77389),r(48561),r(55269),r(44455),r(32568),r(69202),r(27597),r(1241),r(67417),r(15181),r(33642),r(28999),r(69953),r(15612),r(43124),r(69797),r(34860),r(36638),r(10590),r(19948),r(96636),r(30664),r(38304),r(83024),r(61340),r(47626),r(25316),r(407),r(67154),r(79054),r(29709),r(47642),r(18411),r(43782),r(33976),r(28210),r(17436),r(53373),r(94872),r(3969),r(79042),r(61495),r(16485),r(92029),r(74575),r(9575),r(53249),r(83996),r(72763),r(6794),r(28681),r(38929),r(97866),r(68890),r(31513),r(25838),r(54539),r(19967),r(50338),r(28623),r(10312),r(95254),r(61099),r(12158),r(93874),r(62446),r(27264),r(50905),r(78945),r(55827),r(70516),r(25279),r(22268),r(40452),r(60424),r(22225),r(38425),r(42471),r(78470),r(1665),r(38843),r(24892),r(48889),r(30150),r(53647),r(14181),r(86270),r(47672),r(63022),r(10815),r(87833),r(21523),r(84192),r(71710),r(42446),r(28080),r(20592),r(44365),r(45578),r(77372),r(77006),r(45379),r(83712),r(7513),r(98337),r(76071),r(59819),r(433),r(101),r(59038),r(85523),r(85331),r(96267),r(54026),r(38415),r(18392),r(10200),r(46471),r(98057),r(38802),r(93092),r(77787),r(60912),r(66156),r(25715),r(62820),r(25428),r(40100),r(49015),r(12495),r(75370),r(3426),r(37783),r(38058),r(4720),r(90584),r(45794),r(14946),r(69754),r(42152),p.s.getLogger("esri.views.2d.layers.imagery.ImageryView2D")),A=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,l.Z)(this,r),(e=t.apply(this,arguments)).attached=!1,e.container=new R.s,e.updateRequested=!1,e.type="imagery",e._bitmapView=new Z.t,e}return(0,c.Z)(r,[{key:"destroy",value:function(){this.attached&&(this.detach(),this.attached=!1),this.updateRequested=!1}},{key:"updating",get:function(){return!this.attached||this.isUpdating()}},{key:"update",value:function(e){this.strategy.update(e).catch((function(e){(0,p.u)(e)||U.error(e)}))}},{key:"hitTest",value:function(e){return new y.g({attributes:{},geometry:e.clone(),layer:this.layer})}},{key:"attach",value:function(){var e=this;this.container.addChild(this._bitmapView);var t=this.layer.version>=10,r=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,i=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this.strategy=new S.S({container:this._bitmapView,imageNormalizationSupported:t,imageMaxHeight:r,imageMaxWidth:i,fetchSource:this._fetchImage.bind(this),requestUpdate:function(){return e.requestUpdate()}})}},{key:"detach",value:function(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren(),this.updateRequested=!1}},{key:"redraw",value:function(){var e=this;this.strategy.updateExports((function(t){t.source instanceof HTMLImageElement?t.requestRender():e.layer.applyRenderer({pixelBlock:t.source.pixelBlock}).then((function(r){var i=t.source;i.pixelBlock=r.pixelBlock,i.filter=function(t){return e.layer.applyFilter(t)},e.container.requestRender()}))}))}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}},{key:"isUpdating",value:function(){return this.strategy.updating||this.updateRequested}},{key:"getPixelData",value:function(){if(this.updating)return null;var e=this.strategy.bitmaps;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){var t=this.view.extent,r=e.map((function(e){return e.source})).filter((function(e){return e.extent&&e.extent.intersects(t)})).map((function(e){return{extent:e.extent,pixelBlock:e.originalPixelBlock}})),i=(0,_.f)(r,t);return(0,m.r)(i)?{extent:i.extent,pixelBlock:i.pixelBlock}:null}return null}},{key:"_fetchImage",value:function(e,t,r,i){var n=this;return(i=i||{}).timeExtent=this.timeExtent,i.requestAsImageElement=!0,this.layer.fetchImage(e,t,r,i).then((function(e){return e.imageElement?e.imageElement:n.layer.applyRenderer(e.pixelData,{signal:i.signal}).then((function(t){var r=new P.i(t.pixelBlock,t.extent.clone(),e.pixelData.pixelBlock);return r.filter=function(e){return n.layer.applyFilter(e)},r}))}))}}]),r}(p.y);(0,p.e)([(0,p.d)()],A.prototype,"attached",void 0),(0,p.e)([(0,p.d)()],A.prototype,"container",void 0),(0,p.e)([(0,p.d)()],A.prototype,"layer",void 0),(0,p.e)([(0,p.d)()],A.prototype,"strategy",void 0),(0,p.e)([(0,p.d)()],A.prototype,"timeExtent",void 0),(0,p.e)([(0,p.d)()],A.prototype,"view",void 0),(0,p.e)([(0,p.d)()],A.prototype,"updateRequested",void 0),(0,p.e)([(0,p.d)()],A.prototype,"updating",null),(0,p.e)([(0,p.d)()],A.prototype,"type",void 0);var O=A=(0,p.e)([(0,p.n)("esri.views.2d.layers.imagery.ImageryView2D")],A),H=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,l.Z)(this,r),(e=t.apply(this,arguments)).symbolTypes=["triangle"],e}return(0,c.Z)(r,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"imagery (vf)",brushes:[z.m],target:function(){return t.children},drawPhase:D.I.MAP});return[].concat((0,o.Z)((0,s.Z)((0,u.Z)(r.prototype),"prepareRenderPasses",this).call(this,e)),[i])}},{key:"doRender",value:function(e){var t=this;this.visible&&e.drawPhase===D.I.MAP&&this.symbolTypes.forEach((function(i){e.renderPass=i,(0,s.Z)((0,u.Z)(r.prototype),"doRender",t).call(t,e)}))}}]),r}(I.a),N=p.s.getLogger("esri.views.2d.layers.imagery.VectorFieldView2D"),W=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(e){var i;return(0,l.Z)(this,r),(i=t.call(this,e)).update=(0,p.x)((function(e,t){return i._update(e,t).catch((function(e){(0,p.u)(e)||N.error(e)}))})),i}return(0,c.Z)(r,[{key:"updating",get:function(){return!!this._loading}},{key:"redraw",value:function(e){if(this.container.children.length){var t=this.container.children[0];t.symbolizerParameters=e,t.invalidateVAO(),this.container.symbolTypes="wind_speed"===e.style?["scalar","triangle"]:"simple_scalar"===e.style?["scalar"]:["triangle"],this.container.requestRender()}}},{key:"_update",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r,a){var o,s,u,l,c,h,d,p;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stationary){e.next=2;break}return e.abrupt("return");case 2:return o=t.state,s=o.extent,u=o.spatialReference,l=new V.M({xmin:s.xmin,ymin:s.ymin,xmax:s.xmax,ymax:s.ymax,spatialReference:u}),c=(0,n.Z)(t.state.size,2),h=c[0],d=c[1],this._loading=this.fetchPixels(l,h,d,a),e.next=6,this._loading;case 6:p=e.sent,this._addToDisplay(p,r,t.state),this._loading=null;case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,i){return e.apply(this,arguments)}}()},{key:"_addToDisplay",value:function(e,t,r){if((0,m.t)(e.pixelBlock))return this.container.children.forEach((function(e){return e.destroy()})),void this.container.removeAllChildren();var i=e.extent,n=e.pixelBlock,a=new x.y(n);a.offset=[0,0],a.symbolizerParameters=t,a.rawPixelData=e,a.invalidateVAO(),a.x=i.xmin,a.y=i.ymax,a.pixelRatio=r.pixelRatio,a.rotation=r.rotation,a.resolution=r.resolution,a.width=n.width*t.symbolTileSize,a.height=n.height*t.symbolTileSize,this.container.children.forEach((function(e){return e.destroy()})),this.container.removeAllChildren(),this.container.symbolTypes="wind_speed"===t.style?["scalar","triangle"]:"simple_scalar"===t.style?["scalar"]:["triangle"],this.container.addChild(a)}}]),r}(p.y);(0,p.e)([(0,p.d)()],W.prototype,"fetchPixels",void 0),(0,p.e)([(0,p.d)()],W.prototype,"container",void 0),(0,p.e)([(0,p.d)()],W.prototype,"_loading",void 0),(0,p.e)([(0,p.d)()],W.prototype,"updating",null);var j=W=(0,p.e)([(0,p.n)("esri.views.2d.layers.imagery.ImageryVFStrategy")],W),G=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,l.Z)(this,r),(e=t.apply(this,arguments)).attached=!1,e.container=new H,e.type="imageryVF",e._dataParameters={exportParametersVersion:0,bbox:"",symbolTileSize:0,time:""},e._fetchpixels=function(){var t=(0,a.Z)((0,i.Z)().mark((function t(r,n,a,o){var s,u,l,c,h,d,p,y,v,f;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._projectFullExtentPromise;case 2:if(s=t.sent,u=e.layer.renderer.symbolTileSize,l=(0,q.M)(r,n,a,u,s),c=l.extent,h=l.width,d=l.height,!(0,m.r)(s)||s.intersects(r)){t.next=10;break}return t.abrupt("return",{extent:c,pixelBlock:null});case 10:if(p={bbox:"".concat(c.xmin,", ").concat(c.ymin,", ").concat(c.xmax,", ").concat(c.ymax),exportParametersVersion:e.layer.exportImageServiceParameters.version,symbolTileSize:u,time:JSON.stringify(e.timeExtent||"")},!e._canReuseVectorFieldData(p)){t.next=16;break}if(y=e.getPixelData(),!(0,m.r)(y)){t.next=16;break}if("".concat(y.extent.xmin,", ").concat(y.extent.ymin,", ").concat(y.extent.xmax,", ").concat(y.extent.ymax)!==p.bbox){t.next=16;break}return t.abrupt("return",y);case 16:return t.next=18,e.layer.fetchImage(c,h,d,{timeExtent:e.timeExtent,requestAsImageElement:!1,signal:o});case 18:if(v=t.sent,f=v.pixelData,e._dataParameters=p,!(0,m.t)(f.pixelBlock)){t.next=22;break}return t.abrupt("return",{extent:c,pixelBlock:null});case 22:return t.abrupt("return",{extent:c,pixelBlock:"vector-uv"===e.layer.rasterInfo.dataType?(0,m.e)((0,q.m)(f.pixelBlock,"vector-uv")):f.pixelBlock});case 23:case"end":return t.stop()}}),t)})));return function(e,r,i,n){return t.apply(this,arguments)}}(),e}return(0,c.Z)(r,[{key:"updating",get:function(){return!this.attached||this._strategy.updating}},{key:"attach",value:function(){var e=this;this._projectFullExtentPromise=this._getProjectedFullExtent(this.view.spatialReference),this._strategy=new j({container:this.container,fetchPixels:this._fetchpixels}),this.handles.add((0,f.l)((function(){return e.layer.renderer}),(function(t){return e._updateSymbolizerParams(t)}),f.w),"vector-field-view-update")}},{key:"detach",value:function(){this._strategy.destroy(),this.container.children.forEach((function(e){return e.destroy()})),this.container.removeAllChildren(),this.handles.remove("vector-field-view-update"),this._strategy=this.container=this._projectFullExtentPromise=null}},{key:"getPixelData",value:function(){if(this.updating||!this.container.children.length)return null;var e=this.container.children[0].rawPixelData;return{extent:e.extent,pixelBlock:e.pixelBlock}}},{key:"hitTest",value:function(e){return new y.g({attributes:{},geometry:e.clone(),layer:this.layer})}},{key:"update",value:function(e){this._strategy.update(e,this._symbolizerParams)}},{key:"redraw",value:function(){this._updateSymbolizerParams(this.layer.renderer),this._strategy.redraw(this._symbolizerParams)}},{key:"_canReuseVectorFieldData",value:function(e){var t=this._dataParameters.exportParametersVersion===e.exportParametersVersion,r=this._dataParameters.time===e.time,i=this._dataParameters.symbolTileSize===e.symbolTileSize,n=this._dataParameters.bbox===e.bbox;return t&&r&&i&&n}},{key:"_getProjectedFullExtent",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,T.F)(this.layer.fullExtent,t);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.prev=8,e.next=11,(0,E.U)(this.layer.url,{query:{option:"footprints",outSR:t.wkid||JSON.stringify(t.toJSON()),f:"json"}});case 11:return r=e.sent.data.featureCollection.layers[0].layerDefinition.extent,e.abrupt("return",r?V.M.fromJSON(r):null);case 15:return e.prev=15,e.t1=e.catch(8),e.abrupt("return",null);case 18:case"end":return e.stop()}}),e,this,[[0,6],[8,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateSymbolizerParams",value:function(e){"vector-field"===e.type&&(this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null}))}}]),r}(M.d);(0,p.e)([(0,p.d)()],G.prototype,"attached",void 0),(0,p.e)([(0,p.d)()],G.prototype,"container",void 0),(0,p.e)([(0,p.d)()],G.prototype,"layer",void 0),(0,p.e)([(0,p.d)()],G.prototype,"timeExtent",void 0),(0,p.e)([(0,p.d)()],G.prototype,"type",void 0),(0,p.e)([(0,p.d)()],G.prototype,"view",void 0),(0,p.e)([(0,p.d)()],G.prototype,"updating",null);var L=G=(0,p.e)([(0,p.n)("esri.views.2d.layers.imagery.VectorFieldView2D")],G),J=function(e){(0,h.Z)(r,e);var t=(0,d.Z)(r);function r(){var e;return(0,l.Z)(this,r),(e=t.apply(this,arguments))._exportImageVersion=-1,e._highlightGraphics=new g.c,e.subview=null,e}return(0,c.Z)(r,[{key:"pixelData",get:function(){return this.updating?null:"getPixelData"in this.subview?this.subview.getPixelData():null}},{key:"updating",get:function(){return!!(!this.subview||"updating"in this.subview&&this.subview.updating)}},{key:"hitTest",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.subview?[{type:"graphic",graphic:this.subview.hitTest(t),layer:this.layer,mapPoint:t}]:null);case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"update",value:function(e){var t;null===(t=this.subview)||void 0===t||t.update(e)}},{key:"attach",value:function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.view&&(this._highlightView=new b.a({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:function(){return e.requestUpdate()},container:new k.n(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container)),this.handles.add([(0,f.l)((function(){var t;return null!==(t=e.layer.blendMode)&&void 0!==t?t:"normal"}),(function(t){return e.subview.container.blendMode=t}),f.w),(0,f.l)((function(){var t;return null!==(t=e.layer.effect)&&void 0!==t?t:null}),(function(t){return e.subview.container.effect=t}),f.w),(0,f.l)((function(){return e.layer.exportImageServiceParameters.version}),(function(t){t&&e._exportImageVersion!==t&&(e._exportImageVersion=t,e.requestUpdate())}),f.U),(0,f.l)((function(){return e.timeExtent}),(function(t){e.subview.timeExtent=t,"redraw"in e.subview?e.requestUpdate():e.subview.redrawOrRefetch()}),f.U),this.layer.on("redraw",(function(){"redraw"in e.subview?e.subview.redraw():e.subview.redrawOrRefetch()})),(0,f.l)((function(){return e.layer.renderer}),(function(){return e._setSubView()}))],"imagerylayerview-update")}},{key:"detach",value:function(){var e,t;this.layer.decreaseRasterJobHandlerUsage(),this.container.removeAllChildren(),this._detachSubview(this.subview),null!==(e=this.subview)&&void 0!==e&&e.destroy(),this.handles.remove("imagerylayerview-update"),this.subview=null,null!==(t=this._highlightView)&&void 0!==t&&t.destroy(),this._exportImageVersion=-1}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"highlight",value:function(e,t){var r=this;if(!((Array.isArray(e)?e[0]:v.j.isCollection(e)?e.getItemAt(0):e)instanceof y.g))return{remove:function(){}};var i=[];return Array.isArray(e)||v.j.isCollection(e)?i=e.map((function(e){return e.clone()})):e instanceof y.g&&(i=[e.clone()]),this._highlightGraphics.addMany(i),{remove:function(){r._highlightGraphics.removeMany(i)}}}},{key:"doRefresh",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.requestUpdate();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return!this.subview||this.subview.updating}},{key:"_setSubView",value:function(){var e;if(this.view){var t=null===(e=this.layer.renderer)||void 0===e?void 0:e.type,r="imagery";if("vector-field"===t?r="imageryVF":"flow"===t&&(r="flow"),this.subview){var i;if(this.subview.type===r)return this._attachSubview(this.subview),void("flow"===this.subview.type&&this.subview.redrawOrRefetch());this._detachSubview(this.subview),null===(i=this.subview)||void 0===i||i.destroy()}this.subview="imagery"===r?new O({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"imageryVF"===r?new L({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new x.d({layer:this.layer,layerView:this}),this._attachSubview(this.subview),this.requestUpdate()}}},{key:"_attachSubview",value:function(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0),e.container.blendMode=this.layer.blendMode,e.container.effect=this.layer.effect)}},{key:"_detachSubview",value:function(e){(null===e||void 0===e?void 0:e.attached)&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}}]),r}((0,B.m)((0,F.i)((0,w.f)(C.u))));(0,p.e)([(0,p.d)()],J.prototype,"pixelData",null),(0,p.e)([(0,p.d)({readOnly:!0})],J.prototype,"updating",null),(0,p.e)([(0,p.d)()],J.prototype,"subview",void 0);var K=J=(0,p.e)([(0,p.n)("esri.views.2d.layers.ImageryLayerView2D")],J);t.default=K}}]);
//# sourceMappingURL=2864.e56d5729.chunk.js.map