"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[4473],{95865:function(e,t,i){i.d(t,{m:function(){return d}});var n,r=i(15671),a=i(43144),o=i(60136),s=i(29388),l=i(50165),u=i(88406),h=i(32335),c=n=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,r.Z)(this,i),(n=t.call(this,e)).color=new u.l([0,0,0,1]),n}return(0,a.Z)(i,[{key:"clone",value:function(){return new n((0,l.m)({color:this.color}))}}]),i}(h.l);(0,l.e)([(0,l.d)({type:u.l,json:{write:!0}})],c.prototype,"color",void 0);var d=c=n=(0,l.e)([(0,l.n)("esri.webmap.background.ColorBackground")],c)},54473:function(e,t,i){i.r(t),i.d(t,{M:function(){return Qe},e:function(){return Ee}});var n=i(29439),r=i(74165),a=i(93433),o=i(1413),s=i(15861),l=i(4942),u=i(11752),h=i(61120),c=i(37762),d=i(97326),f=i(60136),p=i(29388),v=i(15671),m=i(43144),y=i(50165),g=i(89031),_=i(83745),w=i(40133),k=i(98428),x=i(73627),b=i(78880),T=i(49796),S=i(96263),M=i(77322),Z=i(98643),I=i(57405),P=i(68634),C=(i(33530),i(72021)),V=i(87833),R=i(31278),O=i(84192),z=(i(69379),i(22494)),D=(i(49510),i(69738)),E=i(88406),N=i(85490),F=i(95865),L=function(){function e(t,i,n,r){(0,v.Z)(this,e);var a=t.targetGeometry,o=i.targetGeometry;r?"string"==typeof r&&(r=(0,C.r)(r)||C.t.ease):r=C.t.ease,this.easing=r,this.duration=n,this.sCenterX=a.x,this.sCenterY=a.y,this.sScale=t.scale,this.sRotation=t.rotation,this.tCenterX=o.x,this.tCenterY=o.y,this.tScale=i.scale,this.tRotation=i.rotation,this.dCenterX=this.tCenterX-this.sCenterX,this.dCenterY=this.tCenterY-this.sCenterY,this.dScale=this.tScale-this.sScale,this.dRotation=this.tRotation-this.sRotation,this.dRotation>180?this.dRotation-=360:this.dRotation<-180&&(this.dRotation+=360)}return(0,m.Z)(e,[{key:"applyRatio",value:function(e,t){var i,n,r,a,o=this.easing(t);t>=1?(i=this.tCenterX,n=this.tCenterY,r=this.tRotation,a=this.tScale):(i=this.sCenterX+o*this.dCenterX,n=this.sCenterY+o*this.dCenterY,r=this.sRotation+o*this.dRotation,a=this.sScale+o*this.dScale),e.targetGeometry.x=i,e.targetGeometry.y=n,e.scale=a,e.rotation=r}}]),e}(),B=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e){var n;return(0,v.Z)(this,i),(n=t.call(this,e)).duration=200,n.transition=null,n.easing=C.t.ease,n.view=null,n.viewpoint=null,n.viewpoint=new _.u({targetGeometry:new M.j,scale:0,rotation:0}),n._updateTask=(0,y.aB)({postRender:n._postRender.bind((0,d.Z)(n))}),n._updateTask.pause(),n}return(0,m.Z)(i,[{key:"destroy",value:function(){this._updateTask.remove(),this._updateTask=null}},{key:"animate",value:function(e,t,i){var n=this;this.stop();var r=this.viewpoint;(0,P.Z)(r,t),this.transition=new L(this.viewpoint,e.target,i&&i.duration||this.duration,i&&i.easing||this.easing);var a=function(){n.animation===e&&n._updateTask&&("finished"===e.state&&(n.transition.applyRatio(n.viewpoint,1),n.view.state&&(n.view.state.viewpoint=n.viewpoint.clone())),n.animation=null,n.updateFunction=null)};return e.when(a,a),this._startTime=performance.now(),this._updateTask.resume(),this.animation=e,e}},{key:"animateContinous",value:function(e,t){var i=this;this.stop(),this.updateFunction=t,this.viewpoint=e;var n=new P.n({target:e.clone()}),r=function(){i.animation===n&&i._updateTask&&(i.animation=null,i.updateFunction=null)};return n.when(r,r),this._startTime=performance.now(),this._updateTask.resume(),this.animation=n,n}},{key:"stop",value:function(){this.animation&&(this.animation.stop(),this.animation=null,this.updateFunction=null)}},{key:"_postRender",value:function(e){var t=this.animation;if(t&&t.state!==P.n.State.STOPPED){if(this.updateFunction)this.updateFunction(this.viewpoint,e.deltaTime);else{var i=(performance.now()-this._startTime)/this.transition.duration,n=i>=1;this.transition.applyRatio(this.viewpoint,i),n&&this.animation.finish()}this.view.state&&(this.view.state.viewpoint=this.viewpoint.clone())}else this._updateTask.pause()}}]),i}(y.y);(0,y.e)([(0,y.d)()],B.prototype,"animation",void 0),(0,y.e)([(0,y.d)()],B.prototype,"duration",void 0),(0,y.e)([(0,y.d)()],B.prototype,"transition",void 0),(0,y.e)([(0,y.d)()],B.prototype,"easing",void 0),(0,y.e)([(0,y.d)()],B.prototype,"view",void 0),(0,y.e)([(0,y.d)()],B.prototype,"viewpoint",void 0);var q=B=(0,y.e)([(0,y.n)("esri.views.2d.AnimationManager")],B),Y=function(){function e(t){var i=this;(0,v.Z)(this,e),this.view=t,this._frameTaskHandle=null,this._updateRequested=!1,this.stationary=!0,this.animationInProgress=!1,this.prepare=function(){i._updateParameters.state=i.view.state,i._updateParameters.stationary=i.view.stationary,i._updateParameters.pixelRatio=window.devicePixelRatio,i._updateParameters.renderingOptions=i.view.renderingOptions},this.update=function(){i._updateRequested=!1;var e=i.view,t=e.basemapView,n=e.graphicsView,r=e.labelManager,a=e.layerViews,o=e.state.id;t.baseLayerViews.forEach(i._updateLayerView,i),a.forEach(i._updateLayerView,i),t.referenceLayerViews.forEach(i._updateLayerView,i),(0,y.r)(r)&&(r.lastUpdateId!==o&&(r.viewChange(),r.lastUpdateId=o),r.updateRequested&&r.processUpdate(i._updateParameters)),(0,y.r)(n)&&(n.lastUpdateId!==o&&(n.viewChange(),n.lastUpdateId=o),n.updateRequested&&n.processUpdate(i._updateParameters)),i.view.graphicsTileStore.setViewState(i._updateParameters.state),i.animationInProgress||i._updateRequested||i._frameTaskHandle.pause()}}return(0,m.Z)(e,[{key:"destroy",value:function(){this.stop()}},{key:"start",value:function(){var e=this;if(!this._frameTaskHandle){var t=this.view;this.stationary=t.stationary,this._updateParameters={state:t.state,pixelRatio:window.devicePixelRatio,stationary:this.stationary,renderingOptions:t.renderingOptions},this._stationaryHandle=(0,x.l)((function(){return t.stationary}),(function(t){e.stationary=t,e.requestFrame()})),this._frameTaskHandle=(0,y.aB)(this),this.requestUpdate()}}},{key:"stop",value:function(){this._frameTaskHandle&&(this._updateRequested=!1,this._stationaryHandle.remove(),this._frameTaskHandle.remove(),this._updateParameters=this._stationaryHandle=this._frameTaskHandle=null,this.stationary=!0,this.animationInProgress=!1)}},{key:"requestUpdate",value:function(){this._updateRequested||(this._updateRequested=!0,this.requestFrame())}},{key:"requestFrame",value:function(){this._frameTaskHandle&&this._frameTaskHandle.resume()}},{key:"_updateLayerView",value:function(e){var t=this.view.state,i=e.lastUpdateId;null!=i&&(this.stationary||e.moving)||(e.moving=!0,e.moveStart()),i!==t.id&&e.viewChange(),this.stationary&&e.moving&&(e.moving=!1,e.moveEnd()),e.lastUpdateId=t.id,e.updateRequested&&e.processUpdate(this._updateParameters),"layerViews"in e&&e.layerViews.forEach(this._updateLayerView,this)}}]),e}();function A(){return Promise.all([Promise.all([i.e(7692),i.e(8968),i.e(4023),i.e(6934)]).then(i.bind(i,66934)),Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(2671),i.e(3265),i.e(422),i.e(5090),i.e(6283),i.e(5593),i.e(7639),i.e(8606),i.e(8611),i.e(1615),i.e(9984),i.e(7539)]).then(i.bind(i,87539))])}var X=function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(4967),i.e(4811)]).then(i.bind(i,24811))}))},G=function(){return A().then((function(){return Promise.all([i.e(7692),i.e(3441),i.e(6281),i.e(4147),i.e(2671),i.e(3265),i.e(422),i.e(5090),i.e(478),i.e(6893)]).then(i.bind(i,36893))}))},j={"base-dynamic":function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(6100),i.e(9754)]).then(i.bind(i,36863))}))},"base-tile":X,"bing-maps":X,csv:G,"geo-rss":function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(2671),i.e(3265),i.e(422),i.e(5090),i.e(6283),i.e(5593),i.e(7639),i.e(8606),i.e(8611),i.e(922)]).then(i.bind(i,80922))}))},feature:G,geojson:G,graphics:function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(2671),i.e(3265),i.e(422),i.e(5090),i.e(6283),i.e(5593),i.e(7639),i.e(8606),i.e(8611),i.e(5668)]).then(i.bind(i,35668))}))},group:function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(9873),i.e(4303)]).then(i.bind(i,94303))}))},imagery:function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(2671),i.e(3265),i.e(422),i.e(5090),i.e(6283),i.e(5593),i.e(7639),i.e(8606),i.e(8611),i.e(6100),i.e(866),i.e(4806),i.e(9159),i.e(8196)]).then(i.bind(i,48196))}))},"imagery-tile":function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(866),i.e(4806),i.e(9159),i.e(7778)]).then(i.bind(i,57778))}))},kml:function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(2671),i.e(3265),i.e(422),i.e(5090),i.e(6283),i.e(5593),i.e(7639),i.e(8606),i.e(8611),i.e(6100),i.e(7084)]).then(i.bind(i,77084))}))},"map-image":function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(2671),i.e(3265),i.e(422),i.e(5090),i.e(6283),i.e(5593),i.e(7639),i.e(8606),i.e(8611),i.e(6100),i.e(5788),i.e(1529)]).then(i.bind(i,31529))}))},"map-notes":function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(2671),i.e(3265),i.e(422),i.e(5090),i.e(6283),i.e(5593),i.e(7639),i.e(8606),i.e(8611),i.e(9873),i.e(4470)]).then(i.bind(i,64470))}))},media:function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(2619)]).then(i.bind(i,42619))}))},"ogc-feature":function(){return A().then((function(){return Promise.all([i.e(7692),i.e(3441),i.e(6281),i.e(4147),i.e(2671),i.e(3265),i.e(422),i.e(5090),i.e(478),i.e(6893),i.e(7142)]).then(i.bind(i,77142))}))},"open-street-map":X,route:function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(2671),i.e(3265),i.e(422),i.e(5090),i.e(6283),i.e(5593),i.e(7639),i.e(8606),i.e(8611),i.e(4167),i.e(3065)]).then(i.bind(i,83065))}))},stream:function(){return A().then((function(){return Promise.all([i.e(7692),i.e(3441),i.e(6281),i.e(4147),i.e(2671),i.e(3265),i.e(422),i.e(5090),i.e(478),i.e(6893),i.e(2816)]).then(i.bind(i,82816))}))},"subtype-group":function(){return A().then((function(){return Promise.all([i.e(7692),i.e(3441),i.e(6281),i.e(4147),i.e(2671),i.e(3265),i.e(422),i.e(5090),i.e(478),i.e(6893),i.e(6493)]).then(i.bind(i,36493))}))},tile:X,"vector-tile":function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(2671),i.e(3265),i.e(6100),i.e(3419),i.e(8032),i.e(1887)]).then(i.bind(i,31887))}))},wcs:function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(866),i.e(4806),i.e(9159),i.e(7778)]).then(i.bind(i,57778))}))},"web-tile":X,wfs:G,wms:function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(6100),i.e(5641)]).then(i.bind(i,35641))}))},wmts:function(){return A().then((function(){return Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(4967),i.e(8838)]).then(i.bind(i,48838))}))},"line-of-sight":null,"base-elevation":null,"building-scene":null,elevation:null,"integrated-mesh":null,"point-cloud":null,voxel:null,scene:null,unknown:null,unsupported:null};var U,K=function(e){return(0,y.r)(j[e.type])},H=function(e){var t=j[e.type];if((0,y.t)(t))throw function(e){var t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new y.a("".concat(i,":view-not-supported"),"".concat(t," is not supported in 2D"))}(e);return t(e)};var W,J=y.s.getLogger("esri.views.MapView"),Q=U=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e){var n;return(0,v.Z)(this,i),(n=t.call(this,e)).geometry=null,n.spatialReference=null,n}return(0,m.Z)(i,[{key:"normalizedGeometry",get:function(){if((0,y.t)(this.geometry)||!this.spatialReference)return null;if(!this.spatialReference.equals(this.geometry.spatialReference))try{return(0,Z.r)(this.geometry,this.spatialReference)}catch(Ne){return J.error("#constraints.geometry","could not project the geometry to the view's spatial reference",{geometry:this.geometry,spatialReference:this.spatialReference,error:Ne}),null}return this.geometry}},{key:"constrain",value:function(e,t){if((0,y.t)(this.normalizedGeometry))return e;var i=e.targetGeometry;if("extent"===this.normalizedGeometry.type?(0,S.r)(this.normalizedGeometry,i):(0,S.c)(this.normalizedGeometry,i))return e;var n=function(e,t){var i,n=t.spatialReference,r=[t.x,t.y],a=Number.POSITIVE_INFINITY,o=0,s=0,l=[0,0],u="extent"===e.type?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]:e.rings,h=(0,c.Z)(u);try{for(h.s();!(i=h.n()).done;)for(var d=i.value,f=0;f<d.length-1;f++){(0,R.o)(l,r,d,f);var p=(0,V.m)(r,l);p<a&&(a=p,o=l[0],s=l[1])}}catch(v){h.e(v)}finally{h.f()}return{coordinate:new M.j({x:o,y:s,spatialReference:n}),distance:a}}(this.normalizedGeometry,i),r=n.coordinate;return r?(e.targetGeometry=r,e):e}},{key:"clone",value:function(){var e,t;return new U({geometry:null===(e=this.geometry)||void 0===e?void 0:e.clone(),spatialReference:null===(t=this.spatialReference)||void 0===t?void 0:t.clone()})}}]),i}(y.y);(0,y.e)([(0,y.d)({constructOnly:!0})],Q.prototype,"geometry",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],Q.prototype,"normalizedGeometry",null),(0,y.e)([(0,y.d)({constructOnly:!0})],Q.prototype,"spatialReference",void 0),Q=U=(0,y.e)([(0,y.n)("esri.views.2d.constraints.GeometryConstraint")],Q);var $=W=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(){var e;return(0,v.Z)(this,i),(e=t.apply(this,arguments)).enabled=!0,e.rotationEnabled=!0,e}return(0,m.Z)(i,[{key:"constrain",value:function(e,t){return this.enabled&&t?(this.rotationEnabled||(e.rotation=t.rotation),e):e}},{key:"clone",value:function(){return new W({enabled:this.enabled,rotationEnabled:this.rotationEnabled})}}]),i}(y.y);(0,y.e)([(0,y.d)()],$.prototype,"enabled",void 0),(0,y.e)([(0,y.d)()],$.prototype,"rotationEnabled",void 0);var ee,te=$=W=(0,y.e)([(0,y.n)("esri.views.2d.constraints.RotationConstraint")],$),ie=ee=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e){var n;return(0,v.Z)(this,i),(n=t.call(this,e))._lodByScale={},n._scales=[],n.effectiveLODs=null,n.effectiveMinZoom=-1,n.effectiveMaxZoom=-1,n.effectiveMinScale=0,n.effectiveMaxScale=0,n.lods=null,n.minZoom=-1,n.maxZoom=-1,n.minScale=0,n.maxScale=0,n.snapToZoom=!0,n}return(0,m.Z)(i,[{key:"initialize",value:function(){var e,t,i,n=this,r=this.lods,a=this.minScale,o=this.maxScale,s=this.minZoom,l=this.maxZoom,u=-1,h=-1,d=!1,f=!1;if(0!==a&&0!==o&&a<o&&(a=(e=[o,a])[0],o=e[1]),!r||!r.length)return this._set("effectiveMinScale",a),void this._set("effectiveMaxScale",o);r=r.map((function(e){return e.clone()})),r.sort((function(e,t){return t.scale-e.scale})),r.forEach((function(e,t){return e.level=t}));var p,v=(0,c.Z)(r);try{for(v.s();!(p=v.n()).done;){var m=p.value;!d&&a>0&&a>=m.scale&&(u=m.level,d=!0),!f&&o>0&&o>=m.scale&&(h=i?i.level:-1,f=!0),i=m}}catch(y){v.e(y)}finally{v.f()}-1===s&&(s=0===a?0:u),-1===l&&(l=0===o?r.length-1:h),s=Math.max(s,0),s=Math.min(s,r.length-1),l=Math.max(l,0),s>(l=Math.min(l,r.length-1))&&(s=(t=[l,s])[0],l=t[1]),a=r[s].scale,o=r[l].scale,r.splice(0,s),r.splice(l-s+1,r.length),r.forEach((function(e,t){n._lodByScale[e.scale]=e,n._scales[t]=e.scale})),this._set("effectiveLODs",r),this._set("effectiveMinZoom",s),this._set("effectiveMaxZoom",l),this._set("effectiveMinScale",a),this._set("effectiveMaxScale",o)}},{key:"constrain",value:function(e,t){if(t&&e.scale===t.scale)return e;var i=this.effectiveMinScale,n=this.effectiveMaxScale,r=e.targetGeometry,a=t&&t.targetGeometry,o=0!==n&&e.scale<n,s=0!==i&&e.scale>i;if(o||s){var l=s?i:n;if(a){var u=(l-t.scale)/(e.scale-t.scale);r.x=a.x+(r.x-a.x)*u,r.y=a.y+(r.y-a.y)*u}e.scale=l}return this.snapToZoom&&this.effectiveLODs&&(e.scale=this._getClosestScale(e.scale)),e}},{key:"fit",value:function(e){if(!this.effectiveLODs||!this.snapToZoom)return this.constrain(e,null);var t=this.scaleToZoom(e.scale),i=Math.abs(t-Math.floor(t));return e.scale=this.zoomToScale(i>.99?Math.round(t):Math.floor(t)),e}},{key:"zoomToScale",value:function(e){if(!this.effectiveLODs)return 0;e-=this.effectiveMinZoom,e=Math.max(0,e);var t=this._scales;if(e<=0)return t[0];if(e>=t.length)return t[t.length-1];var i=Math.round(e-.5),n=Math.round(e);return t[n]+(n-e)*(t[i]-t[n])}},{key:"scaleToZoom",value:function(e){if(!this.effectiveLODs)return-1;var t,i,n=this._scales;if(e>=n[0])return this.effectiveMinZoom;if(e<=n[n.length-1])return this.effectiveMaxZoom;for(var r=0;r<n.length-1;r++){if(t=n[r],(i=n[r+1])===e)return r+this.effectiveMinZoom+1;if(t>e&&i<e)return r+this.effectiveMinZoom+1-(e-i)/(t-i)}}},{key:"snapToClosestScale",value:function(e){if(!this.effectiveLODs)return e;var t=this.scaleToZoom(e);return this.zoomToScale(Math.round(t))}},{key:"snapToNextScale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if(!this.effectiveLODs)return e*t;var i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i+1)}},{key:"snapToPreviousScale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(!this.effectiveLODs)return e*t;var i=Math.round(this.scaleToZoom(e));return this.zoomToScale(i-1)}},{key:"clone",value:function(){return new ee({lods:this.lods,minZoom:this.minZoom,maxZoom:this.maxZoom,minScale:this.minScale,maxScale:this.maxScale})}},{key:"_getClosestScale",value:function(e){return this._lodByScale[e]||(e=this._scales.reduce((function(t,i){return Math.abs(i-e)<=Math.abs(t-e)?i:t}),this._scales[0])),this._lodByScale[e].scale}}]),i}(y.y);(0,y.e)([(0,y.d)({readOnly:!0})],ie.prototype,"effectiveLODs",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],ie.prototype,"effectiveMinZoom",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],ie.prototype,"effectiveMaxZoom",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],ie.prototype,"effectiveMinScale",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],ie.prototype,"effectiveMaxScale",void 0),(0,y.e)([(0,y.d)()],ie.prototype,"lods",void 0),(0,y.e)([(0,y.d)()],ie.prototype,"minZoom",void 0),(0,y.e)([(0,y.d)()],ie.prototype,"maxZoom",void 0),(0,y.e)([(0,y.d)()],ie.prototype,"minScale",void 0),(0,y.e)([(0,y.d)()],ie.prototype,"maxScale",void 0),(0,y.e)([(0,y.d)()],ie.prototype,"snapToZoom",void 0);var ne=ie=ee=(0,y.e)([(0,y.n)("esri.views.2d.constraints.ZoomConstraint")],ie),re={base:null,key:"type",typeMap:{extent:S.M,polygon:R.v}},ae=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e){var n;return(0,v.Z)(this,i),(n=t.call(this,e)).lods=null,n.minScale=0,n.maxScale=0,n.minZoom=-1,n.maxZoom=-1,n.rotationEnabled=!0,n.snapToZoom=!0,n}return(0,m.Z)(i,[{key:"destroy",value:function(){this.view=null,this._set("_zoom",null),this._set("_rotation",null),this._set("_geometry",null)}},{key:"geometry",set:function(e){e?this._set("geometry",e):this._set("geometry",null)}},{key:"version",get:function(){var e;return this.commitProperty("_zoom"),this.commitProperty("_rotation"),this.commitProperty("_geometry"),(null!==(e=this._get("version"))&&void 0!==e?e:0)+1}},{key:"_defaultLODs",get:function(){var e,t,i,n=null===(e=this.view)||void 0===e||null===(t=e.defaultsFromMap)||void 0===t?void 0:t.tileInfo,r=null===(i=this.view)||void 0===i?void 0:i.spatialReference;return n&&r&&n.spatialReference.equals(r)?n.lods:null}},{key:"_geometry",get:function(){var e;return new Q({geometry:this.geometry,spatialReference:null===(e=this.view)||void 0===e?void 0:e.spatialReference})}},{key:"_rotation",get:function(){return new te({rotationEnabled:this.rotationEnabled})}},{key:"_zoom",get:function(){var e=this._get("_zoom"),t=this.lods||this._defaultLODs,i=this.minZoom,n=this.maxZoom,r=this.minScale,a=this.maxScale,o=this.snapToZoom;return e&&e.lods===t&&e.minZoom===i&&e.maxZoom===n&&e.minScale===r&&e.maxScale===a&&e.snapToZoom===o?e:new ne({lods:t,minZoom:i,maxZoom:n,minScale:r,maxScale:a,snapToZoom:o})}},{key:"canZoomInTo",value:function(e){var t=this.effectiveMaxScale;return 0===t||e>=t}},{key:"canZoomOutTo",value:function(e){var t=this.effectiveMinScale;return 0===t||e<=t}},{key:"constrain",value:function(e,t){return this._zoom.constrain(e,t),this._rotation.constrain(e,t),this._geometry.constrain(e,t),e}},{key:"constrainByGeometry",value:function(e){return this._geometry.constrain(e)}},{key:"fit",value:function(e){return this._zoom.fit(e)}},{key:"zoomToScale",value:function(e){return this._zoom.zoomToScale(e)}},{key:"scaleToZoom",value:function(e){return this._zoom.scaleToZoom(e)}},{key:"snapScale",value:function(e){return this._zoom.snapToClosestScale(e)}},{key:"snapToNextScale",value:function(e){return this._zoom.snapToNextScale(e)}},{key:"snapToPreviousScale",value:function(e){return this._zoom.snapToPreviousScale(e)}}]),i}(y.y);(0,y.e)([(0,y.d)({readOnly:!0,aliasOf:"_zoom.effectiveLODs"})],ae.prototype,"effectiveLODs",void 0),(0,y.e)([(0,y.d)({readOnly:!0,aliasOf:"_zoom.effectiveMinScale"})],ae.prototype,"effectiveMinScale",void 0),(0,y.e)([(0,y.d)({readOnly:!0,aliasOf:"_zoom.effectiveMaxScale"})],ae.prototype,"effectiveMaxScale",void 0),(0,y.e)([(0,y.d)({readOnly:!0,aliasOf:"_zoom.effectiveMinZoom"})],ae.prototype,"effectiveMinZoom",void 0),(0,y.e)([(0,y.d)({readOnly:!0,aliasOf:"_zoom.effectiveMaxZoom"})],ae.prototype,"effectiveMaxZoom",void 0),(0,y.e)([(0,y.d)({types:re,value:null})],ae.prototype,"geometry",null),(0,y.e)([(0,y.d)({type:[I.p]})],ae.prototype,"lods",void 0),(0,y.e)([(0,y.d)()],ae.prototype,"minScale",void 0),(0,y.e)([(0,y.d)()],ae.prototype,"maxScale",void 0),(0,y.e)([(0,y.d)()],ae.prototype,"minZoom",void 0),(0,y.e)([(0,y.d)()],ae.prototype,"maxZoom",void 0),(0,y.e)([(0,y.d)()],ae.prototype,"rotationEnabled",void 0),(0,y.e)([(0,y.d)()],ae.prototype,"snapToZoom",void 0),(0,y.e)([(0,y.d)()],ae.prototype,"view",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],ae.prototype,"version",null),(0,y.e)([(0,y.d)()],ae.prototype,"_defaultLODs",null),(0,y.e)([(0,y.d)({type:Q})],ae.prototype,"_geometry",null),(0,y.e)([(0,y.d)({type:te})],ae.prototype,"_rotation",null),(0,y.e)([(0,y.d)({readOnly:!0,type:ne})],ae.prototype,"_zoom",null);var oe,se,le=ae=(0,y.e)([(0,y.n)("esri.views.2d.MapViewConstraints")],ae),ue=oe=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(){var e;return(0,v.Z)(this,i),(e=t.apply(this,arguments)).left=0,e.top=0,e.right=0,e.bottom=0,e}return(0,m.Z)(i,[{key:"clone",value:function(){return new oe({left:this.left,top:this.top,right:this.right,bottom:this.bottom})}}]),i}(y.y);(0,y.e)([(0,y.d)()],ue.prototype,"left",void 0),(0,y.e)([(0,y.d)()],ue.prototype,"top",void 0),(0,y.e)([(0,y.d)()],ue.prototype,"right",void 0),(0,y.e)([(0,y.d)()],ue.prototype,"bottom",void 0),ue=oe=(0,y.e)([(0,y.n)("esri.views.2d.PaddedViewState.Padding")],ue);var he=se=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(){var e;(0,v.Z)(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).paddedViewState=new P.U,e._updateContent=function(){var t=(0,O.n)();return function(){var i=e._get("size"),n=e._get("padding");if(i&&n){var r=e.paddedViewState;(0,V.r)(t,n.left+n.right,n.top+n.bottom),(0,V.o)(t,i,t),(0,V.a)(r.size,t);var a=r.viewpoint;a&&(e.viewpoint=a)}}}(),e.own((0,x.l)((function(){return[e.size,e.padding]}),(function(){return e._updateContent()}),x.U)),e.padding=new ue,e.size=[0,0],e}return(0,m.Z)(i,[{key:"padding",set:function(e){this._set("padding",e||new ue)}},{key:"viewpoint",set:function(e){if(e){var t=e.clone();this.paddedViewState.viewpoint=e,(0,P.g)(t,e,this._get("size"),this._get("padding"));var i=this._viewpoint2D,n=t.targetGeometry;i.center[0]=n.x,i.center[1]=n.y,i.rotation=t.rotation,i.scale=t.scale,i.spatialReference=n.spatialReference,this._update()}}},{key:"clone",value:function(){return new se({padding:this.padding.clone(),size:this.size.slice(),viewpoint:this.paddedViewState.viewpoint.clone(),pixelRatio:this.pixelRatio})}}]),i}(P.U);(0,y.e)([(0,y.d)()],he.prototype,"paddedViewState",void 0),(0,y.e)([(0,y.d)({type:ue})],he.prototype,"padding",null),(0,y.e)([(0,y.d)()],he.prototype,"viewpoint",null);var ce,de=he=se=(0,y.e)([(0,y.n)("esri.views.2d.PaddedViewState")],he),fe=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e,n){var r;return(0,v.Z)(this,i),(r=t.call(this,!0)).view=e,r.registerIncoming("double-click",n,(function(e){return r._handleDoubleClick(e,n)})),r}return(0,m.Z)(i,[{key:"_handleDoubleClick",value:function(e,t){(0,P.t)(e.data,"primary")&&(e.stopPropagation(),t?this.view.mapViewNavigation.zoomOut([e.data.x,e.data.y]):this.view.mapViewNavigation.zoomIn([e.data.x,e.data.y]))}}]),i}(P.i),pe=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e,n,r){var a;return(0,v.Z)(this,i),(a=t.call(this,!0)).view=e,a.pointerType=n,a.registerIncoming("double-tap-drag",r,(function(e){return a._handleDoubleTapDrag(e)})),a}return(0,m.Z)(i,[{key:"_handleDoubleTapDrag",value:function(e){var t=e.data;if(t.pointerType===this.pointerType){e.stopPropagation();var i=t.action,n=t.delta,r=this.view,a=r.mapViewNavigation;switch(i){case"begin":var o=r.scale;this._startScale=o,this._currentScale=o,this._previousDelta=n,a.begin();break;case"update":if(this._previousDelta.y===n.y)return;this._previousDelta=n;var s=Math.pow(1.015,n.y),l=this._startScale*s,u=l/this._currentScale;a.setViewpointImmediate(u),this._currentScale=l;break;case"end":var h=r.constraints,c=h.effectiveLODs;if(!h.snapToZoom||!c)return void a.end();var d=h.snapScale(this._currentScale),f=(n.y>0?Math.max(d,h.snapToPreviousScale(this._startScale)):Math.min(d,h.snapToNextScale(this._startScale)))/this._currentScale;a.zoom(f)}}}}]),i}(P.i),ve=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e,n,r){var a;return(0,v.Z)(this,i),(a=t.call(this,!0)).view=e,a.pointerAction=n,a.registerIncoming("drag",r,(function(e){return a._handleDrag(e)})),a.registerIncoming("pointer-down",(function(){return a.stopMomentumNavigation()})),a}return(0,m.Z)(i,[{key:"onInstall",value:function(e){var t=this;(0,u.Z)((0,h.Z)(i.prototype),"onInstall",this).call(this,e),this.dragEventSeparator=new P.a({start:function(e,i){t.view.mapViewNavigation.pan.begin(t.view,i.data),i.stopPropagation()},update:function(e,i){t.view.mapViewNavigation.pan.update(t.view,i.data),i.stopPropagation()},end:function(e,i){t.view.mapViewNavigation.pan.end(t.view,i.data),i.stopPropagation()},condition:function(e,i){return 1===e&&(0,P.t)(i.data,t.pointerAction)}})}},{key:"_handleDrag",value:function(e){var t=this.view.mapViewNavigation;t.pinch.zoomMomentum||t.pinch.rotateMomentum?this.stopMomentumNavigation():this.dragEventSeparator.handle(e)}},{key:"stopMomentumNavigation",value:function(){this.view.mapViewNavigation.pan.stopMomentumNavigation()}}]),i}(P.i),me=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e,n,r){var a;(0,v.Z)(this,i),(a=t.call(this,!0)).view=e,a.pointerAction=n;var o=a.view.mapViewNavigation;return a.dragEventSeparator=new P.a({start:function(e,t){o.rotate.begin(a.view,t.data),t.stopPropagation()},update:function(e,t){o.rotate.update(a.view,t.data),t.stopPropagation()},end:function(e,t){o.rotate.end(),t.stopPropagation()},condition:function(e,t){return 1===e&&(0,P.t)(t.data,a.pointerAction)}}),a.registerIncoming("drag",r,(function(e){return a.dragEventSeparator.handle(e)})),a}return(0,m.Z)(i)}(P.i),ye=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e){var n;return(0,v.Z)(this,i),(n=t.call(this,!0)).view=e,n.frameTask=null,n.watchHandles=new D.u,n.currentDevice=null,n.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},n.handle=n.registerIncoming("gamepad",(function(e){return n._handleGamePadEvent(e)})),n.handle.pause(),n}return(0,m.Z)(i,[{key:"onInstall",value:function(e){var t=this;(0,u.Z)((0,h.Z)(i.prototype),"onInstall",this).call(this,e),this.watchHandles.add([(0,x.l)((function(){var e;return null===(e=t.view.navigation.gamepad)||void 0===e?void 0:e.enabled}),(function(e){e?(t.handle.resume(),t.frameTask||(t.frameTask=(0,y.aB)({update:function(e){return t._frameUpdate(e.deltaTime)}}))):(t.handle.pause(),t.frameTask&&(t.frameTask.remove(),t.frameTask=null))}),x.h)])}},{key:"onUninstall",value:function(){this.watchHandles.removeAll(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null),(0,u.Z)((0,h.Z)(i.prototype),"onUninstall",this).call(this)}},{key:"_handleGamePadEvent",value:function(e){var t=this.view.navigation.gamepad.device;t&&e.data.device!==t||this.currentDevice&&this.currentDevice!==e.data.device||("end"===e.data.action?(this.currentDevice=null,(0,P.b)(this.transformation)):(this.currentDevice=e.data.device,(0,P.c)(e.data,this.view.navigation.gamepad,this.transformation)))}},{key:"_frameUpdate",value:function(e){var t=this.transformation;if(!(0,P.s)(t)){var i=this.view.viewpoint.clone(),n=this.view.navigation.gamepad.velocityFactor,r=_e*n*e;(0,P.S)(i,i,[t.translation[0]*r,-t.translation[1]*r]);var a=1+t.translation[2]*we*e,o=this.view.constraints.rotationEnabled?-t.heading*ge*e:0,s=this.view.size,l=[s[0]/2,s[1]];(0,P.G)(i,i,a,o,l,s);var u=this.view.constraints.constrain(i,this.view.viewpoint);this.view.viewpoint=u}}}]),i}(P.i),ge=.06,_e=.7,we=6e-4,ke=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e,n,r){var a,o;return(0,v.Z)(this,i),(o=t.call(this,!0)).view=e,o.keys=n,o._pressed=!1,o._keyMap=(a={},(0,l.Z)(a,n.left,"left"),(0,l.Z)(a,n.right,"right"),(0,l.Z)(a,n.up,"up"),(0,l.Z)(a,n.down,"down"),a),o.registerIncoming("key-down",r,(function(e){return o._handleKeyDown(e)})),o.registerIncoming("key-up",r,(function(e){return o._handleKeyUp(e)})),o.registerIncoming("blur",r,(function(){return o._handleBlur()})),o}return(0,m.Z)(i,[{key:"_handleKeyDown",value:function(e){e.data.repeat||this._handleKey(e,!0)}},{key:"_handleKeyUp",value:function(e){this._handleKey(e,!1)}},{key:"_handleBlur",value:function(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}},{key:"_handleKey",value:function(e,t){var i=this._keyMap[e.data.key];if(this._pressed=null!=i,this._pressed){if(t)switch(this.view.mapViewNavigation.begin(),i){case"left":this.view.mapViewNavigation.continousPanLeft();break;case"right":this.view.mapViewNavigation.continousPanRight();break;case"up":this.view.mapViewNavigation.continousPanUp();break;case"down":this.view.mapViewNavigation.continousPanDown()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}}]),i}(P.i),xe=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e,n,r){var a,o;return(0,v.Z)(this,i),(o=t.call(this,!0)).view=e,o.keys=n,o._pressed=!1,o._keyToDirection=(a={},(0,l.Z)(a,n.clockwiseOption1,"clockwise"),(0,l.Z)(a,n.clockwiseOption2,"clockwise"),(0,l.Z)(a,n.counterClockwiseOption1,"counterClockwise"),(0,l.Z)(a,n.counterClockwiseOption2,"counterClockwise"),(0,l.Z)(a,n.resetOption1,"reset"),(0,l.Z)(a,n.resetOption2,"reset"),a),o.registerIncoming("key-down",r,(function(e){return o._handleKeyDown(e)})),o.registerIncoming("key-up",r,(function(e){return o._handleKeyUp(e)})),o.registerIncoming("blur",r,(function(){return o._handleBlur()})),o}return(0,m.Z)(i,[{key:"_handleKeyDown",value:function(e){e.data.repeat||this._handleKey(e,!0)}},{key:"_handleKeyUp",value:function(e){this._handleKey(e,!1)}},{key:"_handleBlur",value:function(){this._pressed&&(this._pressed=!1,this.view.mapViewNavigation.stop())}},{key:"_handleKey",value:function(e,t){var i=e.modifiers;if(!(i.size>0&&!i.has("Shift")||!this.view.constraints.rotationEnabled)){var n=this._keyToDirection[e.data.key];if(this._pressed=null!=n,this._pressed){if(t)switch(this.view.mapViewNavigation.begin(),n){case"clockwise":this.view.mapViewNavigation.continousRotateClockwise();break;case"counterClockwise":this.view.mapViewNavigation.continousRotateCounterclockwise();break;case"reset":this.view.mapViewNavigation.resetRotation()}else this._pressed=!1,this.view.mapViewNavigation.stop();e.stopPropagation()}}}}]),i}(P.i);!function(e){e[e.IN=0]="IN",e[e.OUT=1]="OUT"}(ce||(ce={}));var be=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e,n,r){var a;return(0,v.Z)(this,i),(a=t.call(this,!0)).view=e,a.keys=n,a._keysToZoomAction={},a.registerIncoming("key-down",r,(function(e){return a._handleKeyDown(e)})),n.zoomIn.forEach((function(e){return a._keysToZoomAction[e]=ce.IN})),n.zoomOut.forEach((function(e){return a._keysToZoomAction[e]=ce.OUT})),a}return(0,m.Z)(i,[{key:"_handleKeyDown",value:function(e){this._handleKey(e)}},{key:"_handleKey",value:function(e){var t=e.modifiers;if(!(t.size>0)||t.has("Shift")){var i=e.data.key;if(i in this._keysToZoomAction){var n=this._keysToZoomAction[i],r=this.view.mapViewNavigation,a=null;switch(n){case ce.IN:a=r.zoomIn();break;case ce.OUT:a=r.zoomOut();break;default:return}r.begin(),a.then((function(){return r.end()})),e.stopPropagation()}}}}]),i}(P.i),Te=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e,n){var r;return(0,v.Z)(this,i),(r=t.call(this,!0)).view=e,r._canZoom=!0,r.registerIncoming("mouse-wheel",n,(function(e){return r._handleMouseWheel(e)})),r}return(0,m.Z)(i,[{key:"_handleMouseWheel",value:function(e){var t=this;if(this.view.navigation.mouseWheelZoomEnabled&&(e.preventDefault(),e.stopPropagation(),this._canZoom)){var i=this.view.mapViewNavigation,n=e.data,r=n.x,a=n.y,o=n.deltaY,s=1/Math.pow(.6,1/60*o),l=i.zoom(s,[r,a]);l&&(this._canZoom=!1,l.catch((function(){})).then((function(){t._canZoom=!0,i.end()})))}}}]),i}(P.i),Se=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e){var n;(0,v.Z)(this,i),(n=t.call(this,!0)).view=e,n.registerIncoming("drag",(function(e){return n._handleDrag(e)})),n.registerIncoming("pointer-down",(function(){return n._stopMomentumNavigation()}));var r=n.view.mapViewNavigation;return n.dragEventSeparator=new P.a({start:function(e,t){r.pinch.begin(n.view,t.data),t.stopPropagation()},update:function(e,t){r.pinch.update(n.view,t.data),t.stopPropagation()},end:function(e,t){r.pinch.end(n.view),t.stopPropagation()},condition:function(e){return e>=2}}),n}return(0,m.Z)(i,[{key:"_handleDrag",value:function(e){this.dragEventSeparator.handle(e)}},{key:"_stopMomentumNavigation",value:function(){this.view.mapViewNavigation.pinch.stopMomentumNavigation()}}]),i}(P.i),Me=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P.d.maximumDoubleClickDelay,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:P.d.maximumDoubleClickDistance,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P.d.maximumDoubleTouchDelay,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:P.d.maximumDoubleTouchDistance,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:y.aC;return(0,v.Z)(this,i),(e=t.call(this,!1)).maximumDoubleClickDelay=n,e.maximumDoubleClickDistance=r,e.maximumDoubleTouchDelay=a,e.maximumDoubleTouchDistance=o,e._clock=s,e._doubleTapDragReady=!1,e._doubleTapDragActive=!1,e._dragStartCenter=(0,b.c)(0,0),e._pointerState=new Map,e._doubleTapDrag=e.registerOutgoing("double-tap-drag"),e._dragEventSeparator=new P.a({start:function(t,i){return e._dragStart(t,i)},update:function(t,i){return e._dragUpdate(i)},end:function(t,i){return e._dragEnd(i)}}),e.registerIncoming("drag",(function(t){return e._dragEventSeparator.handle(t)})),e.registerIncoming("pointer-down",(function(t){return e._handlePointerDown(t)})),e.registerIncoming("pointer-up",(function(){return e._handlePointerUp()})),e}return(0,m.Z)(i,[{key:"onUninstall",value:function(){this._pointerState.forEach((function(e){null!=e.doubleTapTimeout&&(e.doubleTapTimeout.remove(),e.doubleTapTimeout=null)}))}},{key:"hasPendingInputs",get:function(){return(0,y.aD)(this._pointerState,(function(e){return null!=e.doubleTapTimeout}))}},{key:"_clearPointerDown",value:function(e){var t=this._pointerState.get(e);t&&(t.doubleTapTimeout.remove(),t.doubleTapTimeout=null,this._pointerState.delete(e),this.refreshHasPendingInputs())}},{key:"_createDoubleTapDragData",value:function(e,t,i){return{action:e,delta:t,button:i.button,buttons:i.buttons,pointer:i.pointer,pointers:i.pointers,pointerType:i.pointerType,timestamp:i.timestamp}}},{key:"_dragStart",value:function(e,t){if(this._doubleTapDragReady&&1===e){this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;var i=t.data,n=t.modifiers,r=i.center;this._dragStartCenter=r;var a=this._createDoubleTapDragData("begin",(0,b.c)(0,0),i);this._doubleTapDrag.emit(a,void 0,n),t.stopPropagation()}}},{key:"_dragUpdate",value:function(e){if(this._doubleTapDragActive){var t=e.data,i=e.modifiers,n=t.center,r=(0,b.c)(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),a=this._createDoubleTapDragData("update",r,t);this._doubleTapDrag.emit(a,void 0,i),e.stopPropagation()}}},{key:"_dragEnd",value:function(e){if(this._doubleTapDragActive){var t=e.data,i=e.modifiers,n=t.center,r=(0,b.c)(n.x-this._dragStartCenter.x,n.y-this._dragStartCenter.y),a=this._createDoubleTapDragData("end",r,t);this._doubleTapDrag.emit(a,void 0,i),this._doubleTapDragActive=!1,e.stopPropagation()}}},{key:"_handlePointerDown",value:function(e){var t=e.data,i=this._pointerId(t),n=this._pointerState.get(i),r=t.native.pointerType;if(n){var a="touch"===r?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;this._clearPointerDown(i),(0,P.e)(n.event.data,t)>a?this._storePointerDown(e):this._doubleTapDragReady=!0}else this._storePointerDown(e)}},{key:"_handlePointerUp",value:function(){this._doubleTapDragReady=!1}},{key:"_pointerId",value:function(e){var t=e.native,i=t.pointerId,n=t.button,r=t.pointerType;return"mouse"===r?"".concat(i,":").concat(n):"".concat(r)}},{key:"_storePointerDown",value:function(e){var t=this,i=e.data,n=i.native.pointerType,r=this._pointerId(i),a="touch"===n?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay,o=this._clock.setTimeout((function(){return t._clearPointerDown(r)}),a);this._pointerState.set(r,{event:e,doubleTapTimeout:o}),this.refreshHasPendingInputs()}}]),i}(P.i),Ze="Ctrl",Ie={left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"},Pe={zoomIn:["=","+"],zoomOut:["-","_"]},Ce={clockwiseOption1:"a",clockwiseOption2:"A",counterClockwiseOption1:"d",counterClockwiseOption2:"D",resetOption1:"n",resetOption2:"N"},Ve=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(){var e;return(0,v.Z)(this,i),(e=t.apply(this,arguments))._handles=new D.u,e}return(0,m.Z)(i,[{key:"initialize",value:function(){var e=this,t=function(){var t;return null===(t=e.view)||void 0===t?void 0:t.ready};this._handles.add([(0,x.f)((function(){return!t()}),(function(){return e._disconnect()})),(0,x.f)(t,(function(){return e._connect()}))])}},{key:"destroy",value:function(){this._handles&&(this._handles.removeAll(),this._handles=null),this._disconnect()}},{key:"latestPointerType",get:function(){var e;return null===(e=this._inputManager)||void 0===e?void 0:e.latestPointerType}},{key:"latestPointerLocation",get:function(){var e;return null===(e=this._inputManager)||void 0===e?void 0:e.latestPointerLocation}},{key:"_disconnect",value:function(){this._inputManager&&(this.view.viewEvents.disconnect(),this._inputManager.destroy(),this._inputManager=null,this._source.destroy(),this._source=null)}},{key:"_connect",value:function(){var e=this,t=this.view.surface,i=new P.u(t,this.view.input),n=[new P.f,new P.o,new P.h,new P.j(this.view.navigation),new Me],r=new P.k({eventSource:i,recognizers:n});r.installHandlers("prevent-context-menu",[new P.l],P.m.INTERNAL),r.installHandlers("navigation",[new Se(this.view),new ye(this.view),new Te(this.view),new fe(this.view),new fe(this.view,[Ze]),new ve(this.view,"primary"),new ke(this.view,Ie),new be(this.view,Pe),new xe(this.view,Ce),new me(this.view,"secondary"),new pe(this.view,"touch")],P.m.INTERNAL),this.view.viewEvents.connect(r),this._source=i,this._inputManager=r,(0,x.l)((function(){var t,i;return null===(t=e.view)||void 0===t||null===(i=t.navigation)||void 0===i?void 0:i.browserTouchPanEnabled}),(function(t){e._source&&(e._source.browserTouchPanningEnabled=!t)}),x.h)}},{key:"test",get:function(){return{inputManager:this._inputManager}}}]),i}(y.y);(0,y.e)([(0,y.d)()],Ve.prototype,"view",void 0),(0,y.e)([(0,y.d)()],Ve.prototype,"latestPointerType",null),(0,y.e)([(0,y.d)()],Ve.prototype,"latestPointerLocation",null);var Re=Ve=(0,y.e)([(0,y.n)("esri.views.2d.input.MapViewInputManager")],Ve),Oe=0,ze=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(){var e;return(0,v.Z)(this,i),(e=t.apply(this,arguments)).color=new E.l([0,255,255]),e.haloOpacity=1,e.fillOpacity=.25,e}return(0,m.Z)(i,[{key:"version",get:function(){return Oe++}}]),i}(y.y);(0,y.e)([(0,y.d)({readOnly:!0})],ze.prototype,"version",null),(0,y.e)([(0,y.d)({type:E.l})],ze.prototype,"color",void 0),(0,y.e)([(0,y.d)({type:E.l})],ze.prototype,"haloColor",void 0),(0,y.e)([(0,y.d)()],ze.prototype,"haloOpacity",void 0),(0,y.e)([(0,y.d)()],ze.prototype,"fillOpacity",void 0);var De=ze=(0,y.e)([(0,y.n)("esri.views.2d.support.HighlightOptions")],ze),Ee=function(){function e(){(0,v.Z)(this,e),this._names=new Map}return(0,m.Z)(e,[{key:"begin",value:function(e){this._names.has(e)||(this._names.set(e,!1),e.includes("Brush")&&this.record("Esri.FirstDraw"),performance.mark("Esri.".concat(e,".Start")))}},{key:"end",value:function(e){this._names.has(e)&&!this._names.get(e)&&(this._names.set(e,!0),performance.mark("Esri.".concat(e,".End")))}},{key:"record",value:function(e){this._names.has(e)||(this._names.set(e,!0),performance.mark("Esri.".concat(e)))}}]),e}();var Ne=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e){var n;return(0,v.Z)(this,i),(n=t.call(this,e)).components=["attribution","zoom"],n}return(0,m.Z)(i)}(P._);(0,y.e)([(0,y.d)()],Ne.prototype,"components",void 0);var Fe,Le,Be,qe,Ye,Ae,Xe=Ne=(0,y.e)([(0,y.n)("esri.views.ui.2d.DefaultUI2D")],Ne),Ge=y.s.getLogger("esri.views.MapView");function je(){return je=(0,s.Z)((0,r.Z)().mark((function e(){var t,a,o,s,l,u,h,c,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Promise.all([i.e(7692),i.e(8968),i.e(4023),i.e(6934)]).then(i.bind(i,66934)),Promise.all([i.e(7692),i.e(5346),i.e(3441),i.e(8968),i.e(6281),i.e(4023),i.e(4147),i.e(5341),i.e(9514),i.e(2671),i.e(3265),i.e(422),i.e(5090),i.e(6283),i.e(5593),i.e(7639),i.e(8606),i.e(8611),i.e(1615),i.e(9984),i.e(7539)]).then(i.bind(i,87539))]);case 2:t=e.sent,a=(0,n.Z)(t,2),o=a[1],s=o.GraphicsView2D,l=o.GraphicContainer,u=o.LabelManager,h=o.MapViewNavigation,c=o.MagnifierView2D,d=o.Stage,Le=s,Be=l,qe=u,Ye=h,Ae=c,Fe=d;case 12:case"end":return e.stop()}}),e)}))),je.apply(this,arguments)}var Ue=function(e){(0,f.Z)(i,e);var t=(0,p.Z)(i);function i(e){var n;return(0,v.Z)(this,i),(n=t.call(this,e))._magnifierView=null,n._stage=null,n._resolveWhenReady=[],n.rootLayerViews=new k.p({getCollections:function(){var e,t;return[null===(e=n.basemapView)||void 0===e?void 0:e.baseLayerViews,n.layerViews,null===(t=n.basemapView)||void 0===t?void 0:t.referenceLayerViews]},getChildrenFunction:function(){return null}}),n.featuresTilingScheme=null,n.fullOpacity=1,n.graphicsView=null,n.labelManager=null,n.mapViewNavigation=null,n.renderingOptions={samplingMode:"dynamic",edgeLabelsVisible:!0,labelsAnimationTime:125,labelCollisionsEnabled:!0},n.rendering=!1,n.supersampleScreenshotsEnabled=!1,n.supportsGround=!1,n._stationaryTimer=null,n.frameTask=new Y((0,d.Z)(n)),n._pePromise=null,n.floors=new w.j,n.highlightOptions=new De,n.inputManager=new Re({view:(0,d.Z)(n)}),n.map=null,n.resizeAlign="center",n.spatialReferenceLocked=!1,n.timeline=new Ee,n.type="2d",n.ui=new Xe,n._pixelFormat={flipY:!0,premultipliedAlpha:!0},n.constraints=new le,n.padding={top:0,right:0,bottom:0,left:0},n.handles.add([(0,x.l)((function(){return n.viewpoint}),(function(){n._lastStationaryEventTimestamp=performance.now(),n._flipStationary(160)}),x.U),n.on("resize",(function(e){return n._resizeHandler(e)})),(0,x.l)((function(){var e;return null===(e=n.animationManager)||void 0===e?void 0:e.animation}),(function(e){n.animation=e}))]),(0,T.c)(),n}return(0,m.Z)(i,[{key:"destroy",value:function(){this._set("preconditionsReady",!1),this._gotoTask=this.frameTask=null,this.rootLayerViews.destroy(),this.inputManager.destroy(),this._set("inputManager",null)}},{key:"graphicsTileStore",get:function(){return new z.l(this.featuresTilingScheme)}},{key:"initialExtentRequired",get:function(){var e,t=this.scale,i=this.constraints,n=this.center,r=this.viewpoint,a=this.extent,o=this.zoom;return!(this.map&&"initialViewProperties"in this.map&&null!==(e=this.map.initialViewProperties)&&void 0!==e&&e.viewpoint)&&!a&&(null!==i&&void 0!==i&&i.effectiveLODs||(o=-1),(!n||0===t&&-1===o)&&(!r||!(0,y.r)(r.targetGeometry)||"extent"!==r.targetGeometry.type&&!r.scale))}},{key:"resourceManager",get:function(){return this._stage.resourceManager}},{key:"textureManager",get:function(){return this._stage.painter.textureManager}},{key:"_defaultsFromMapSettings",get:function(){return{required:{tileInfo:!0,heightModelInfo:!1,extent:!1},requiresExtentInSpatialReference:this.spatialReferenceLocked}}},{key:"_projectionEngineLoaded",get:function(){var e=this;return!!(0,Z.e)()||(this._pePromise||(this._pePromise=(0,Z.t)().finally((function(){e._pePromise=null}))),!1)}},{key:"typeSpecificPreconditionsReady",get:function(){var e=this._getDefaultViewpoint();if(!e)return!1;var t=this.spatialReference,i=(0,y.g)(e.targetGeometry);return!!(0,Z.A)(i.spatialReference,t)||this._projectionEngineLoaded}},{key:"animation",set:function(e){var t=this,i=this._get("animation");if(e!==i)if(i&&i.stop(),e&&!e.isFulfilled()){this._set("animation",e),this.frameTask.animationInProgress=!0;var n=function(){e===t._get("animation")&&(t._set("animation",null),t.frameTask.requestFrame()),t.frameTask.animationInProgress=!1};e.when(n,n)}else this._set("animation",null)}},{key:"background",get:function(){return this.get("map.initialViewProperties.background")||null},set:function(e){void 0===e?this._clearOverride("background"):this._override("background",e)}},{key:"center",get:function(){if(!this.ready)return this._get("center");var e=this.state.paddedViewState,t=e.center,i=e.spatialReference;return new M.j({x:t[0],y:t[1],spatialReference:i})},set:function(e){if(null!=e){if(!this.ready)return this._set("center",e),void this.notifyChange("initialExtentRequired");var t;try{t=this._project(e,this.spatialReference)}catch(n){return void Ge.error(new y.a("mapview:invalid-center","could not project the value in the view's spatial reference",{input:e,error:n}))}var i=this.viewpoint;(0,P.x)(i,i,t),this.viewpoint=i}}},{key:"constraints",set:function(e){var t=this,i=this._get("constraints");i&&(this.handles.remove("map-view-constraints"),i.destroy()),this._set("constraints",e),e&&(e.view=this,this.ready&&(this.state.viewpoint=e.fit(this.state.paddedViewState.viewpoint)),this.handles.add((0,x.l)((function(){return e.version}),(function(){t.ready&&t.state&&(t.state.viewpoint=e.fit(t.state.paddedViewState.viewpoint))}),x.U),"map-view-constraints"))}},{key:"extent",get:function(){return this.ready?this.state.paddedViewState.extent.clone():this._get("extent")},set:function(e){if(null!=e)if(e.width&&e.height){if(!this.ready)return this._set("extent",e),this._set("center",null),this._set("viewpoint",null),this._set("scale",0),this._set("zoom",-1),void this.notifyChange("initialExtentRequired");var t;try{t=this._project(e,this.spatialReference)}catch(n){return void Ge.error(new y.a("mapview:invalid-extent","could not project the value in the view's spatial reference",{error:n}))}var i=this.viewpoint;(0,P.r)(i,i,t,this.size,{constraints:this.constraints}),this.viewpoint=i}else Ge.error(new y.a("mapview:invalid-extent","invalid extent size"))}},{key:"padding",get:function(){return this.ready?this.state.padding:this._get("padding")},set:function(e){this.ready?(this.state.padding=e,this._set("padding",this.state.padding)):this._set("padding",e)}},{key:"resolution",get:function(){return this.state?this.state.resolution:0}},{key:"rotation",get:function(){return this.ready?this.state.rotation:this._get("rotation")},set:function(e){if(!isNaN(e))if(this.ready){var t=this.viewpoint;(0,P.v)(t,t,e),this.viewpoint=t}else this._set("rotation",e)}},{key:"scale",get:function(){return this.ready?this.state.scale:this._get("scale")},set:function(e){if(e&&!isNaN(e)){if(!this.ready){this._set("scale",e),this._set("zoom",-1);var t=this._get("extent");return t&&(this._set("extent",null),this._set("center",t.center)),void this.notifyChange("initialExtentRequired")}var i=this.viewpoint;(0,P.y)(i,i,e),this.viewpoint=i}}},{key:"stationary",get:function(){return!(this.animation||this.navigating||this.resizing||this._stationaryTimer)}},{key:"updating",get:function(){return!this.destroyed&&(!this.layerViewManager||!this.labelManager||!this.graphicsView||!0===this.layerViewManager.updating||!0===this.labelManager.updating||!0===this.graphicsView.updating||this.allLayerViews.some((function(e){return!e.destroyed&&!("layerViews"in e)&&!0===e.updating})))}},{key:"viewpoint",get:function(){if(!this.ready)return this._get("viewpoint");var e=this.state.paddedViewState;return e&&e.viewpoint.clone()},set:function(e){if(null!=e){if(!this.ready)return this._set("viewpoint",e),this._set("extent",null),this._set("center",null),this._set("zoom",-1),this._set("scale",0),void this.notifyChange("initialExtentRequired");var t,i;try{t=this._project(e,this.spatialReference),!e.scale||isNaN(e.scale)?i=new y.a("mapview:invalid-viewpoint","invalid scale value of ".concat(e.scale)):(0,y.t)(e.targetGeometry)&&(i=new y.a("mapview:invalid-viewpoint","geometry not defined"))}catch(Se){i=new y.a("mapview:invalid-viewpoint","could not project the value in the view's spatial reference",{error:Se})}if(i)Ge.error(i);else{this._scaleBeforeChangingSpatialReference=null;var n=new _.u({targetGeometry:new M.j,scale:0,rotation:0});(0,P.Z)(n,t),this.constraints.constrain(n,this.state.paddedViewState.viewpoint),this.state.viewpoint=n,this.frameTask.requestFrame(),this._set("viewpoint",n)}}}},{key:"zoom",get:function(){return this.ready?this.constraints.scaleToZoom(this.scale):this._get("zoom")},set:function(e){if(null!=e){if(!this.ready){this._set("zoom",e),this._set("scale",0);var t=this._get("extent");return t&&(this._set("extent",null),this._set("center",t.center)),void this.notifyChange("initialExtentRequired")}if(this.constraints.effectiveLODs){var i=this.viewpoint;(0,P.y)(i,i,this.constraints.zoomToScale(e)),this.viewpoint=i,this._set("zoom",this.constraints.scaleToZoom(this.scale))}else this._set("zoom",-1)}}},{key:"navigating",get:function(){return!(!this.mapViewNavigation||!this.mapViewNavigation.interacting)}},{key:"goTo",value:function(e,t){var i=this;if(e)return this.animation&&(this.animation=null),this._createAnimation(),(0,x.j)((function(){return i.ready}),t).then((function(){var n=(0,o.Z)({animate:!0},t),r=(0,P.Y)(e,i);return i.animation.update(r),i._gotoTask={},n.animate?i._gotoAnimated(r,n):i._gotoImmediate(r,n)}));Ge.error("#goTo()","target cannot be null or undefined")}},{key:"hitTest",value:function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t,i){var n,o,s,l,u,h,c,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(0,P.z)(t)?(0,P.A)(this,t):t,this.ready&&!isNaN(n.x)&&!isNaN(n.y)){e.next=3;break}return e.abrupt("return",{screenPoint:n,results:[]});case 3:return o=new Set,s=!1,l=null,u=null,null!==i&&void 0!==i&&i.include?Je(i.include,We(this,(function(e){return o.add(e)}),(function(e){l||(l=new Set),l.add(e)}),(function(e){return o.add(e)}),(function(){return s=!0}))):(s=!0,o=new Set(this.allLayerViews)),(null===i||void 0===i?void 0:i.exclude)&&Je(i.exclude,We(this,(function(e){return o.delete(e)}),(function(e){u||(u=new Set),u.add(e)}))),h=this.allLayerViews.filter((function(e){return!e.suspended&&o.has(e)})).reverse(),c=this.toMap(n),e.t0=[],e.t1=(0,a.Z)(s?this.graphicsView.hitTest(c).map((function(e){return{type:"graphic",graphic:e,layer:null,mapPoint:c}})):[]),e.t2=a.Z,e.next=11,Promise.all(h.map((function(e){return e.hitTest(c,n)})).toArray());case 11:return e.t3=e.sent,e.t4=(0,e.t2)(e.t3),d=e.t0.concat.call(e.t0,e.t1,e.t4).filter(y.r).flat().filter(y.r),e.abrupt("return",(l&&(d=d.filter((function(e){return!("graphic"in e)||!e.graphic||l.has(He(e.graphic))}))),u&&(d=d.filter((function(e){return!("graphic"in e)||!e.graphic||u.has(He(e.graphic))}))),{screenPoint:n,results:d}));case 15:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"takeScreenshot",value:function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t){var i,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this._createScreenshotPlan(t),e.next=3,this._stage.takeScreenshot(i);case 3:return n=e.sent,e.abrupt("return",(0,N.r)(n,{format:i.format,quality:i.quality,rotation:0,disableDecorations:!1},this._pixelFormat));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_takeScreenshot",value:function(){var e=(0,s.Z)((0,r.Z)().mark((function e(t){var i,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this._createScreenshotPlan(t),e.next=3,this._stage.takeScreenshot(i);case 3:return n=e.sent,e.abrupt("return",(0,N.l)(n,this._pixelFormat));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createScreenshotPlan",value:function(e){var t=this;e=e||{};var i,n=this.supersampleScreenshotsEnabled?Math.min(4,(0,N.w)(this.size,Math.min(4096,this._stage.context.parameters.maxTextureSize))):1;e.layers?(i=[],e.layers.forEach((function(e){var n=t.allLayerViews.find((function(t){return t.layer.id===e.id}));n&&"container"in n&&n.container&&i.push(n.container)}))):i=this._stage.children;var r=(0,N.s)(e.format,e.quality),a=r.format,o=r.quality;return function(e,t,i,n,r,a,o,s){var l;e.ignorePadding&&(n={left:0,right:0,top:0,bottom:0}),null!=e.width&&null!=e.height?l=[e.width,e.height]:null==e.width&&null!=e.height?l=[e.height,e.height]:null!=e.width&&null==e.height?l=[e.width,e.width]:null==e.width&&null==e.height&&(l=null);var u,h,c=i[0]-(n.left+n.right),d=i[1]-(n.top+n.bottom),f=e.area||{x:0,y:0,width:c,height:d};if(l){var p=c/d,v=l[0]/l[1];if(v>p){var m=f.width/v;f={x:f.x,y:Math.round(f.y+(f.height-m)/2),width:f.width,height:Math.round(m)}}else{var y=f.height*v;f={x:Math.round(f.x+(f.width-y)/2),y:f.y,width:Math.round(y),height:f.height}}}else l=[f.width,f.height];return l[0]>f.width?(u=Math.min(l[0]/f.width,t),h=l[0]/f.width/u):(u=1,h=l[0]/f.width),{resolutionScale:u,cropArea:{x:Math.round((f.x+n.left)*u),y:Math.round((f.y+n.top)*u),width:Math.round(f.width*u),height:Math.round(f.height*u)},outputScale:h,format:r,quality:a,children:o,rotation:s}}(e,n,this.size,this.padding,a,o,i,e.rotation)}},{key:"test",get:function(){var e=this;return{takeScreenshot:function(t){return e._takeScreenshot(t)}}}},{key:"toMap",value:function(e){if(!this.ready)return null;var t=(0,P.z)(e)?(0,P.A)(this,e):e,i=this.state.toMap([0,0],[t.x,t.y]),r=(0,n.Z)(i,2),a=r[0],o=r[1],s=this.spatialReference;return new M.j({x:a,y:o,spatialReference:s})}},{key:"toScreen",value:function(e){if(!this.ready)return null;var t=this._project(e,this.spatialReference),i=[t.x,t.y];return this.state.toScreen(i,i),(0,b.c)(i[0],i[1])}},{key:"on",value:function(e,t,n,r){return this.inputManager&&this.viewEvents.on(e,t,n,r)||(0,u.Z)((0,h.Z)(i.prototype),"on",this).call(this,e,t)}},{key:"hasEventListener",value:function(e){return(0,u.Z)((0,h.Z)(i.prototype),"hasEventListener",this).call(this,e)||this.viewEvents.hasHandler(e)}},{key:"whenLayerView",value:function(e){return(0,u.Z)((0,h.Z)(i.prototype),"whenLayerView",this).call(this,e)}},{key:"graphicChanged",value:function(e){this.graphicsView&&this.graphicsView.graphicUpdateHandler(e)}},{key:"whenReady",value:function(){var e=this;return new Promise((function(t){e.ready?t(e):e._resolveWhenReady.push(t)}))}},{key:"forceDOMReadyCycle",value:function(){this.forceReadyCycle()}},{key:"getDefaultSpatialReference",value:function(){var e,t,i;return this.map&&"initialViewProperties"in this.map&&(null===(e=this.map)||void 0===e||null===(t=e.initialViewProperties)||void 0===t?void 0:t.spatialReference)||(null===(i=this.defaultsFromMap)||void 0===i?void 0:i.spatialReference)||null}},{key:"hasLayerViewModule",value:function(e){return K(e)}},{key:"importLayerView",value:function(e){return H(e)}},{key:"pixelSizeAt",value:function(){return this.ready?this.state.resolution:(Ge.error("#pixelSizeAt()","Map view cannot be used before it is ready"),null)}},{key:"popupHitTest",value:function(e){var t=this;return this.hitTest(e).then((function(i){return(0,o.Z)((0,o.Z)({},i),{},{mapPoint:t.toMap(e)})}))}},{key:"requestUpdate",value:function(){this.ready&&this.frameTask.requestUpdate()}},{key:"validate",value:function(){var e=(0,P.B)(this.type);return(0,y.c)("safari")&&(0,y.c)("safari")<9&&(e=new y.a("mapview:browser-not-supported","This browser is not supported by MapView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:(0,y.c)("safari")})),(0,y.r)(e)?(Ge.warn("#validate()",e.message),Promise.reject(e)):function(){return je.apply(this,arguments)}()}},{key:"_createAnimation",value:function(){return this.animation&&!this.animation.done||(this.animation=new P.n),this.animation}},{key:"_cancellableGoTo",value:function(e,t,i){var n=this,r=function(){return e===n._gotoTask},a=i.then((function(){r()&&(n.animation=null)})).catch((function(e){throw r()&&(n.animation=null,t.done||(t.stop(),n.frameTask.animationInProgress=!1)),e})),o=new Promise((function(e){return e(a)}));return t.when().catch((function(){r()&&o.cancel&&o.cancel()})),o}},{key:"_gotoImmediate",value:function(e,t){var i=this,n=this._gotoTask,r=this.animation,a=e.then((function(e){if((0,y.W)(t),n!==i._gotoTask)throw new y.a("view:goto-interrupted","Goto was interrupted");i.viewpoint=r.target=e,r.finish()}));return this._cancellableGoTo(n,r,a)}},{key:"_flipStationary",value:function(e){var t=this;return null!==this._stationaryTimer||(this._stationaryTimer=setTimeout((function(){t._stationaryTimer=null;var e=performance.now()-t._lastStationaryEventTimestamp;e<160&&(t._stationaryTimer=t._flipStationary(e))}),e)),this._stationaryTimer}},{key:"_getDefaultViewpoint",value:function(){var e,t,i,n,r=this.constraints,a=this.initialExtent,o=this.map,s=this.padding,l=this.size;if(!r)return null;var u=o&&"initialViewProperties"in o&&o.initialViewProperties,h={zoom:this._get("zoom"),scale:this._get("scale"),center:this._get("center"),extent:this._get("extent"),rotation:this._get("rotation"),viewpoint:this._get("viewpoint"),spatialReference:this._userSpatialReference};r.effectiveLODs?-1!==h.zoom&&(h.scale=r.zoomToScale(h.zoom)):h.zoom=-1;var c=null,d=null,f=0,p=h.viewpoint&&h.viewpoint.rotation,v=h.viewpoint&&h.viewpoint.targetGeometry;(0,y.r)(v)&&("extent"===v.type?c=v:"point"===v.type&&(d=v,f=h.viewpoint.scale));var m=h.extent||c||(null===(e=(0,y.g)(null===u||void 0===u||null===(t=u.viewpoint)||void 0===t?void 0:t.targetGeometry))||void 0===e?void 0:e.extent)||a,g=h.center||d||(null===m||void 0===m?void 0:m.center),w=h.scale||f||(null===u||void 0===u||null===(i=u.viewpoint)||void 0===i?void 0:i.scale)||m&&(0,P.H)(m,[l[0]-s.left-s.right,l[1]-s.top-s.bottom]),k=h.rotation||p||(null===u||void 0===u||null===(n=u.viewpoint)||void 0===n?void 0:n.rotation)||0;return g&&w?new _.u({targetGeometry:g,scale:w,rotation:k}):null}},{key:"_gotoAnimated",value:function(e,t){var i=this,n=this._gotoTask,r=this.animation,a=e.then((function(e){if((0,y.W)(t),n!==i._gotoTask)throw new y.a("view:goto-interrupted","Goto was interrupted");return r.update(e),i.animationManager.animate(r,i.viewpoint,t),r.when().then((function(){}),(function(){}))}));return this._cancellableGoTo(n,r,a)}},{key:"_project",value:function(e,t){var i,n=e&&e.targetGeometry||e;if(!t)return e;if(!n)return null;if(t.imageCoordinateSystem||null!==(i=n.spatialReference)&&void 0!==i&&i.imageCoordinateSystem)return e;if((0,M.E)(t,n.spatialReference))return e;var r=(0,Z.r)(n,t);if(!r)throw new y.a("mapview:projection-not-possible","projecting input geometry to target spatial reference returned a null value",{geometry:n,spatialReference:t});return function(e){return e&&"esri.Viewpoint"===e.declaredClass}(e)?(e.targetGeometry=r,e):r}},{key:"_resizeHandler",value:function(e){if(this.ready){var t=this.state,i=this.state.paddedViewState.viewpoint,n=this.state.paddedViewState.size.concat();t.size=[e.width,e.height],(0,P.C)(i,i,n,this.state.paddedViewState.size,this.resizeAlign),i=this.constraints.constrain(i,null),this.state.viewpoint=i}}},{key:"_startup",value:function(){var e,t=this;this.timeline.begin("MapView Startup");var i=this._getDefaultViewpoint(),n=i.targetGeometry;try{this._project(i,this.spatialReference)}catch(Te){var r;Ge.warn(new y.V("mapview:startup-projection-error","projection of initial viewpoint to the view's spatial reference, defaulting to the initial viewpoint.",{center:n.toJSON(),spatialReference:this.spatialReference,error:Te})),i.targetGeometry=(null===(r=this.defaultsFromMap.extent)||void 0===r?void 0:r.center)||new M.j({x:0,y:0,spatialReference:this.spatialReference})}null!==(e=this.constraints)&&void 0!==e&&e.fit(i),this._set("state",new de({padding:this._get("padding"),size:this.size,viewpoint:i})),this.graphics.owner=this;var a=new Fe(this.surface,{canvas:this.renderCanvas,supersampleScreenshots:this.supersampleScreenshotsEnabled,contextOptions:{disabledExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions},renderingOptions:this.renderingOptions,timeline:this.timeline});this._stage=a,this._magnifierView=new Ae,this._magnifierView.magnifier=this.magnifier;var o=new qe({view:this});this._set("labelManager",o);var s=new q({view:this});this._set("animationManager",s);var l=new Ye({view:this,animationManager:s});this._set("mapViewNavigation",l),this._setupSpatialReferenceDependentProperties(),this.handles.add([this.rootLayerViews.on("change",(function(){return t._updateStageChildren()})),a.on("post-render",(function(){return t._set("rendering",a.renderRequested)})),a.on("will-render",(function(){return t._set("rendering",a.renderRequested)})),a.on("webgl-error",(function(e){return t.fatalError=e.error})),(0,x.l)((function(){return t.stationary}),(function(e){return a.stationary=e}),x.w),(0,x.l)((function(){return t.background}),(function(e){a.background=e,t._magnifierView.background=e}),x.w),(0,x.l)((function(){return t.magnifier}),(function(e){return t._magnifierView.magnifier=e}),x.w),(0,x.l)((function(){return t.renderingOptions}),(function(e){return a.renderingOptions=e}),x.w),(0,x.l)((function(){return t.highlightOptions}),(function(e){return a.highlightOptions=e}),x.w),(0,x.l)((function(){return t.state.id}),(function(){return a.state=t.state}),x.w)],"map-view"),this._updateStageChildren();var u=this._resolveWhenReady;this._resolveWhenReady=[],u.forEach((function(e){return e(t)})),this.timeline.end("MapView Startup"),this.frameTask&&this.frameTask.start(),this._set("ready",!0)}},{key:"_teardown",value:function(){this._destroySpatialReferenceDependentProperties(),this.handles.remove("map-view"),this.mapViewNavigation.destroy(),this._set("mapViewNavigation",null),this.animationManager.destroy(),this._set("animationManager",null),this.layerViewManager.clear(),this.labelManager.destroy(),this._magnifierView.destroy(),this._stage.destroy(),this._stage=null,this._set("graphicsView",null),this._magnifierView=null,this._set("labelManager",null),this._set("mapViewNavigation",null),this.graphics.owner=null,this.frameTask&&this.frameTask.stop(),this._stationaryTimer&&(clearTimeout(this._stationaryTimer),this._stationaryTimer=null),this._set("ready",!1);var e=this.state.paddedViewState,t=(0,n.Z)(e.center,2),i=t[0],r=t[1],a=e.spatialReference,o=e.rotation,s=e.scale,l=new M.j({x:i,y:r,spatialReference:a});this._set("viewpoint",null),this._set("extent",null),this._set("center",l),this._set("zoom",-1),this._set("rotation",o),this._set("scale",s),this._set("spatialReference",a),this._set("state",null),this.animation=null}},{key:"_updateStageChildren",value:function(){var e=this;this._stage.removeAllChildren(),this.rootLayerViews.forEach((function(t){e._stage.addChild(t.container)}));var t=this.graphicsView;this._stage.addChild(t.container),this._stage.addChild(this._magnifierView)}},{key:"_setupSpatialReferenceDependentProperties",value:function(){var e=this,t=new z.h(I.S.create({spatialReference:this.spatialReference,size:512,numLODs:36}));this._set("featuresTilingScheme",t);var i=new Le({view:this,graphics:this.graphics,requestUpdateCallback:function(){return e.requestUpdate()},container:new Be(t)});this.frameTask.graphicsView=i,this._set("graphicsView",i)}},{key:"_destroySpatialReferenceDependentProperties",value:function(){var e=this.graphicsView;this._set("graphicsView",null),this.frameTask.graphicsView=null,e.destroy(),this._set("featuresTilingScheme",null)}},{key:"_spatialReferenceChanged",value:function(e){if(this.ready){this.frameTask.stop();var t,i=(0,c.Z)(this.allLayerViews);try{for(i.s();!(t=i.n()).done;){t.value.processDetach()}}catch(S){i.e(S)}finally{i.f()}this._destroySpatialReferenceDependentProperties();var r=this.state.paddedViewState.clone();if((0,y.t)(this._scaleBeforeChangingSpatialReference))this._scaleBeforeChangingSpatialReference=r.scale;else{var a=r.viewpoint.clone();a.scale=this._scaleBeforeChangingSpatialReference,r.viewpoint=a}var o=r.clone(),s=(0,n.Z)(r.center,2),l=s[0],u=s[1],h=null;try{h=this._project(new M.j({x:l,y:u,spatialReference:r.spatialReference}),e)}catch(Xe){(0,Z.e)()||Ge.warn(new y.V("mapview:spatial-reference-change","could not project the view's center to the new spatial reference",{center:h.toJSON(),spatialReference:e,error:Xe}))}h||(h=new M.j({x:0,y:0,spatialReference:e}));var d=(0,P.x)(new _.u({targetGeometry:new M.j,scale:0,rotation:0}),r.viewpoint,h);o.viewpoint=d;try{var f=[r.size[0]/2,r.size[1]/2],p=[f[0]+20,f[1]],v=r.toMap([0,0],p),m=this._project(new M.j({x:v[0],y:v[1],spatialReference:r.spatialReference}),e),g=m.x,w=m.y;v[0]=g,v[1]=w,o.toScreen(v,v);var k=(0,P.D)(f,v,p),x=Math.hypot(v[0]-f[0],v[1]-f[1])/20;!Number.isFinite(x)||Math.abs(x)>4?(d.rotation=0,d.targetGeometry=new M.j({x:0,y:0,spatialReference:e})):(d.scale*=x,d.scale>(0,y.c)("mapview-srswitch-adjust-rotation-scale-threshold")?d.rotation=0:d.rotation+=Number.isFinite(k)?k:0)}catch(I){}this._get("constraints").constrain(d,null),this._get("state").viewpoint=d,this._stage.state=this.state,this._setupSpatialReferenceDependentProperties();var b,T=(0,c.Z)(this.allLayerViews);try{for(T.s();!(b=T.n()).done;){b.value.processAttach()}}catch(S){T.e(S)}finally{T.f()}this.frameTask.requestFrame(),this.frameTask.start(),this._updateStageChildren()}}}]),i}((0,P.w)((0,P.p)((0,P.q)(P.E))));Ue.type="2d",(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"animationManager",void 0),(0,y.e)([(0,y.d)({constructOnly:!0})],Ue.prototype,"deactivatedWebGLExtensions",void 0),(0,y.e)([(0,y.d)({constructOnly:!0})],Ue.prototype,"debugWebGLExtensions",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"featuresTilingScheme",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"fullOpacity",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"graphicsTileStore",null),(0,y.e)([(0,y.d)()],Ue.prototype,"graphicsView",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"state",void 0),(0,y.e)([(0,y.d)()],Ue.prototype,"initialExtentRequired",null),(0,y.e)([(0,y.d)()],Ue.prototype,"labelManager",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"resourceManager",null),(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"textureManager",null),(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"mapViewNavigation",void 0),(0,y.e)([(0,y.d)({constructOnly:!0})],Ue.prototype,"renderCanvas",void 0),(0,y.e)([(0,y.d)()],Ue.prototype,"renderingOptions",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"rendering",void 0),(0,y.e)([(0,y.d)({constructOnly:!0})],Ue.prototype,"supersampleScreenshotsEnabled",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"supportsGround",void 0),(0,y.e)([(0,y.d)()],Ue.prototype,"_stationaryTimer",void 0),(0,y.e)([(0,y.d)()],Ue.prototype,"_defaultsFromMapSettings",null),(0,y.e)([(0,y.d)()],Ue.prototype,"_pePromise",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"typeSpecificPreconditionsReady",null),(0,y.e)([(0,y.d)()],Ue.prototype,"animation",null),(0,y.e)([(0,y.d)({type:F.m})],Ue.prototype,"background",null),(0,y.e)([(0,y.d)({value:null,type:M.j,dependsOn:["state.id","ready"]})],Ue.prototype,"center",null),(0,y.e)([(0,y.d)({type:le})],Ue.prototype,"constraints",null),(0,y.e)([(0,y.d)({value:null,type:S.M,dependsOn:["state.id","ready"]})],Ue.prototype,"extent",null),(0,y.e)([(0,y.d)()],Ue.prototype,"floors",void 0),(0,y.e)([(0,y.d)({type:De})],Ue.prototype,"highlightOptions",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"inputManager",void 0),(0,y.e)([(0,y.d)()],Ue.prototype,"map",void 0),(0,y.e)([(0,y.d)({value:{top:0,right:0,bottom:0,left:0},cast:function(e){return(0,o.Z)({top:0,right:0,bottom:0,left:0},e)}})],Ue.prototype,"padding",null),(0,y.e)([(0,y.d)()],Ue.prototype,"resizeAlign",void 0),(0,y.e)([(0,y.d)({readOnly:!0,dependsOn:["state.id"]})],Ue.prototype,"resolution",null),(0,y.e)([(0,y.d)({value:0,type:Number,dependsOn:["state.id","ready"]})],Ue.prototype,"rotation",null),(0,y.e)([(0,y.d)({value:0,type:Number,dependsOn:["state.id","ready"]})],Ue.prototype,"scale",null),(0,y.e)([(0,y.d)({constructOnly:!0})],Ue.prototype,"spatialReferenceLocked",void 0),(0,y.e)([(0,y.d)()],Ue.prototype,"stationary",null),(0,y.e)([(0,y.d)({type:Ee,readOnly:!0})],Ue.prototype,"timeline",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"type",void 0),(0,y.e)([(0,y.d)({readOnly:!0})],Ue.prototype,"updating",null),(0,y.e)([(0,y.d)({value:null,type:_.u,dependsOn:["state.id","ready"]})],Ue.prototype,"viewpoint",null),(0,y.e)([(0,y.d)({value:-1,dependsOn:["state.id","ready"]})],Ue.prototype,"zoom",null),(0,y.e)([(0,y.d)({type:Boolean})],Ue.prototype,"navigating",null),(0,y.e)([(0,y.d)({type:Xe})],Ue.prototype,"ui",void 0);var Ke=Ue=(0,y.e)([(0,y.n)("esri.views.MapView")],Ue);function He(e){var t,i,n,r,a=e.getObjectId();return a?"".concat(null!==(t=null!==(i=null===(n=e.layer)||void 0===n?void 0:n.uid)&&void 0!==i?i:null===(r=e.sourceLayer)||void 0===r?void 0:r.uid)&&void 0!==t?t:"MapView","/").concat(a):'"MapView/'.concat(e.uid)}function We(e,t,i,n,r){return function(a){if(a instanceof g.g){if(a.layer===e)null===r||void 0===r||r();else{var o=e.allLayerViews.find((function(e){return e.layer===a.layer}));o&&(null===n||void 0===n||n(o))}i(He(a))}else{var s=e.allLayerViews.find((function(e){return e.layer===a}));s&&t(s)}}}function Je(e,t){if(e)if((0,y.aE)(e)){var i,n=(0,c.Z)(e);try{for(n.s();!(i=n.n()).done;){var r=i.value;if((0,y.aE)(r)){var a,o=(0,c.Z)(r);try{for(o.s();!(a=o.n()).done;){t(a.value)}}catch(s){o.e(s)}finally{o.f()}}else t(r)}}catch(s){n.e(s)}finally{n.f()}}else t(e)}var Qe=Object.freeze({__proto__:null,default:Ke})},22494:function(e,t,i){i.d(t,{a:function(){return _},b:function(){return S},h:function(){return C},i:function(){return V},l:function(){return W}});var n=i(60136),r=i(29388),a=i(29439),o=i(37762),s=i(43144),l=i(15671),u=i(50165),h=i(49796),c=i(77322),d=i(49510),f=i(40133),p=i(18392),v=i(96263),m=i(79146),y=i(53089),g=(0,s.Z)((function e(t,i){(0,l.Z)(this,e),this.item=t,this.controller=i,this.promise=null})),_=function(){function e(t){(0,l.Z)(this,e),this._deferreds=new Map,this._controllers=new Map,this._processingItems=new Map,this._isPaused=!1,this._schedule=null,this._task=null,this.concurrency=1,t.concurrency&&(this.concurrency=t.concurrency),this._queue=new h.e(t.peeker),this.process=t.process;var i=t.scheduler;t.priority&&(0,u.r)(i)&&(this._task=i.registerTask(t.priority,this))}return(0,s.Z)(e,[{key:"destroy",value:function(){this.clear(),this._schedule&&(this._schedule.remove(),this._schedule=null),this._task&&(this._task.remove(),this._task=null)}},{key:"length",get:function(){return this._processingItems.size+this._queue.length}},{key:"abort",value:function(e){var t=this._controllers.get(e);t&&t.abort()}},{key:"clear",value:function(){this._queue.clear();var e=[];this._controllers.forEach((function(t){return e.push(t)})),this._controllers.clear(),e.forEach((function(e){return e.abort()})),this._processingItems.clear(),this._cancelNext()}},{key:"forEach",value:function(e){this._deferreds.forEach((function(t,i){return e(i)}))}},{key:"get",value:function(e){var t=this._deferreds.get(e);return t?t.promise:void 0}},{key:"isOngoing",value:function(e){return this._processingItems.has(e)}},{key:"has",value:function(e){return this._deferreds.has(e)}},{key:"pause",value:function(){this._isPaused||(this._isPaused=!0,this._cancelNext())}},{key:"push",value:function(e,t){var i=this,n=this.get(e);if(n)return n;var r=new AbortController,a=null;t&&(a=(0,u.x)(t,(function(){return r.abort()})));var o=function(){s.remove(),(0,u.r)(a)&&a.remove(),i._deferreds.delete(e),i._controllers.delete(e),i._queue.remove(e),i._processingItems.delete(e),i._scheduleNext()},s=(0,u.Z)(r.signal,(function(){var t=i._processingItems.get(e);t&&t.controller.abort(),o(),l.reject((0,u.v)())})),l=(0,u.T)();return this._deferreds.set(e,l),this._controllers.set(e,r),l.promise.then(o,o),this._queue.push(e),this._scheduleNext(),l.promise}},{key:"last",value:function(){return this._queue.last()}},{key:"peek",value:function(){return this._queue.peek()}},{key:"popLast",value:function(){return this._queue.popLast()}},{key:"reset",value:function(){var e=[];this._processingItems.forEach((function(t){return e.push(t)})),this._processingItems.clear();for(var t=0,i=e;t<i.length;t++){var n=i[t];this._queue.push(n.item),n.controller.abort()}this._scheduleNext()}},{key:"resume",value:function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext())}},{key:"takeAll",value:function(){for(var e=[];this._queue.length;)e.push(this._queue.pop());return this.clear(),e}},{key:"running",get:function(){return!this._isPaused&&this._queue.length>0&&this._processingItems.size<this.concurrency}},{key:"runTask",value:function(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}},{key:"_scheduleNext",value:function(){var e=this;this._task||this._isPaused||this._schedule||(this._schedule=(0,u.O)((function(){e._schedule=null,e._next()})))}},{key:"_next",value:function(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}},{key:"_cancelNext",value:function(){this._schedule&&(this._schedule.remove(),this._schedule=null)}},{key:"_processResult",value:function(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}},{key:"_processError",value:function(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}},{key:"_canProcessFulfillment",value:function(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}},{key:"_process",value:function(e){var t=this;if(!(0,u.t)(e)){var i,n=new AbortController,r=new g(e,n);this._processingItems.set(e,r);try{i=this.process(e,n.signal)}catch(N){this._processError(r,N)}(0,u.R)(i)?(r.promise=i,i.then((function(e){return t._processResult(r,e)}),(function(e){return t._processError(r,e)}))):this._processResult(r,i)}}},{key:"test",get:function(){var e=this;return{update:function(t){return e.runTask(t)}}}}]),e}();function w(e,t){return[e,t]}function k(e,t,i){return e[0]=t,e[1]=i,e}function x(e,t,i,n,r){return e[0]=t,e[1]=i,e[2]=n,e[3]=r,e}var b=new d.e("0/0/0/0"),T=function(){function e(t,i,n,r,a,o,s,u,h,c,d,f){(0,l.Z)(this,e),this.level=t,this.resolution=i,this.scale=n,this.origin=r,this.first=a,this.last=o,this.size=s,this.norm=u,this.worldStart=h,this.worldEnd=c,this.worldSize=d,this.wrap=f}return(0,s.Z)(e,[{key:"normalizeCol",value:function(e){if(!this.wrap)return e;var t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t}},{key:"denormalizeCol",value:function(e,t){return this.wrap?this.worldSize[0]*t+e:e}},{key:"getWorldForColumn",value:function(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}},{key:"getFirstColumnForWorld",value:function(e){return e*this.worldSize[0]+this.first[0]}},{key:"getLastColumnForWorld",value:function(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}},{key:"getColumnForX",value:function(e){return(e-this.origin[0])/this.norm[0]}},{key:"getXForColumn",value:function(e){return this.origin[0]+e*this.norm[0]}},{key:"getRowForY",value:function(e){return(this.origin[1]-e)/this.norm[1]}},{key:"getYForRow",value:function(e){return this.origin[1]-e*this.norm[1]}},{key:"getTileBounds",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];b.set(t);var n=i?b.col:this.denormalizeCol(b.col,b.world),r=b.row;return x(e,this.getXForColumn(n),this.getYForRow(r+1),this.getXForColumn(n+1),this.getYForRow(r)),e}},{key:"getTileCoords",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];b.set(t);var n=i?b.col:this.denormalizeCol(b.col,b.world);return Array.isArray(e)?k(e,this.getXForColumn(n),this.getYForRow(b.row)):(e.x=this.getXForColumn(n),e.y=this.getYForRow(b.row)),e}}],[{key:"create",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=(0,c.b)(t.spatialReference),a=i.origin||w(t.origin.x,t.origin.y),o=w(t.size[0]*i.resolution,t.size[1]*i.resolution),s=w(-1/0,-1/0),l=w(1/0,1/0),h=w(1/0,1/0);(0,u.r)(n)&&(k(s,Math.max(0,Math.floor((n.xmin-a[0])/o[0])),Math.max(0,Math.floor((a[1]-n.ymax)/o[1]))),k(l,Math.max(0,Math.floor((n.xmax-a[0])/o[0])),Math.max(0,Math.floor((a[1]-n.ymin)/o[1]))),k(h,l[0]-s[0]+1,l[1]-s[1]+1));var d,f,p,v,m=i.cols,y=i.rows;return!n&&m&&y&&(k(s,m[0],y[0]),k(l,m[1],y[1]),k(h,m[1]-m[0]+1,y[1]-y[0]+1)),t.isWrappable?(d=w(Math.ceil(Math.round((r.valid[1]-r.valid[0])/i.resolution)/t.size[0]),h[1]),f=w(Math.floor((r.origin[0]-a[0])/o[0]),s[1]),p=w(d[0]+f[0]-1,l[1]),v=!0):(f=s,p=l,d=h,v=!1),new e(i.level,i.resolution,i.scale,a,s,l,h,o,f,p,d,v)}}]),e}(),S=function(){function e(){(0,l.Z)(this,e),this.spans=[]}return(0,s.Z)(e,[{key:"acquire",value:function(e){this.lodInfo=e}},{key:"release",value:function(){this.lodInfo=null,this.spans.length=0}},{key:"forEach",value:function(e,t){var i=this.spans,n=this.lodInfo,r=n.level;if(0!==i.length){var a,s=(0,o.Z)(i);try{for(s.s();!(a=s.n()).done;)for(var l=a.value,u=l.row,h=l.colFrom,c=l.colTo,d=h;d<=c;d++)e.call(t,r,u,n.normalizeCol(d),n.getWorldForColumn(d))}catch(f){s.e(f)}finally{s.f()}}}}]),e}();S.pool=new u.K(S);var M=(0,s.Z)((function e(t,i,n){(0,l.Z)(this,e),this.row=t,this.colFrom=i,this.colTo=n})),Z=new d.e("0/0/0/0"),I=function(){function e(t,i,n,r,a,o,s,u){(0,l.Z)(this,e),this.x=t,this.ymin=i,this.ymax=n,this.invM=r,this.leftAdjust=a,this.rightAdjust=o,this.leftBound=s,this.rightBound=u}return(0,s.Z)(e,[{key:"incrRow",value:function(){this.x+=this.invM}},{key:"getLeftCol",value:function(){return Math.max(this.x+this.leftAdjust,this.leftBound)}},{key:"getRightCol",value:function(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}],[{key:"create",value:function(t,i){var n;t[1]>i[1]&&(t=(n=[i,t])[0],i=n[1]);var r=t,o=(0,a.Z)(r,2),s=o[0],l=o[1],u=i,h=(0,a.Z)(u,2),c=h[0],d=h[1],f=c-s,p=d-l,v=0!==p?f/p:0,m=(Math.ceil(l)-l)*v,y=(Math.floor(l)-l)*v;return new e(s,Math.floor(l),Math.ceil(d),v,f<0?m:y,f<0?y:m,f<0?c:s,f<0?s:c)}}]),e}(),P=[[0,0],[0,0],[0,0],[0,0]],C=function(){function e(t){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,l.Z)(this,e),this.tileInfo=t,this.fullExtent=n,this.scales=[],this._lodInfos=null,this._infoByScale={},this._infoByLevel={};var r=t.lods.slice();r.sort((function(e,t){return t.scale-e.scale}));var a=this._lodInfos=r.map((function(e){return T.create(t,e,n)}));r.forEach((function(e,t){i._infoByLevel[e.level]=a[t],i._infoByScale[e.scale]=a[t],i.scales[t]=e.scale}),this),this._wrap=t.isWrappable}return(0,s.Z)(e,[{key:"spatialReference",get:function(){return this.tileInfo.spatialReference}},{key:"getLODInfoAt",value:function(e){return this._infoByLevel["number"==typeof e?e:e.level]}},{key:"getTileBounds",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Z.set(t);var n=this._infoByLevel[Z.level];return n?n.getTileBounds(e,Z,i):e}},{key:"getTileCoords",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Z.set(t);var n=this._infoByLevel[Z.level];return n?n.getTileCoords(e,Z,i):e}},{key:"getTileCoverage",value:function(e){var t,i,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:192,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"closest",s="closest"===a?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),l=S.pool.acquire(s),u=this._wrap,h=1/0,c=-1/0,d=l.spans;P[0][0]=P[0][1]=P[1][1]=P[3][0]=-r,P[1][0]=P[2][0]=e.size[0]+r,P[2][1]=P[3][1]=e.size[1]+r;var f,p=(0,o.Z)(P);try{for(p.s();!(f=p.n()).done;){var v=f.value;e.toMap(v,v),v[0]=s.getColumnForX(v[0]),v[1]=s.getRowForY(v[1])}}catch(V){p.e(V)}finally{p.f()}for(var m=[],y=3,g=0;g<4;g++)if(P[g][1]!==P[y][1]){var _=I.create(P[g],P[y]);h=Math.min(_.ymin,h),c=Math.max(_.ymax,c),void 0===m[_.ymin]&&(m[_.ymin]=[]),m[_.ymin].push(_),y=g}else y=g;if(null==h||null==c||c-h>100)return null;var w=[];for(t=h;t<c;){null!=m[t]&&(w=w.concat(m[t])),i=1/0,n=-1/0;for(var k=w.length-1;k>=0;k--){var x=w[k];i=Math.min(i,x.getLeftCol()),n=Math.max(n,x.getRightCol())}if(i=Math.floor(i),n=Math.floor(n),t>=s.first[1]&&t<=s.last[1])if(u)if(s.size[0]<s.worldSize[0])for(var b=Math.floor(n/s.worldSize[0]),T=Math.floor(i/s.worldSize[0]);T<=b;T++)d.push(new M(t,Math.max(s.getFirstColumnForWorld(T),i),Math.min(s.getLastColumnForWorld(T),n)));else d.push(new M(t,i,n));else i>s.last[0]||n<s.first[0]||(i=Math.max(i,s.first[0]),n=Math.min(n,s.last[0]),d.push(new M(t,i,n)));t+=1;for(var Z=w.length-1;Z>=0;Z--){var C=w[Z];C.ymax>=t?C.incrRow():w.splice(Z,1)}}return l}},{key:"getTileParentId",value:function(e){Z.set(e);var t=this._infoByLevel[Z.level],i=this._lodInfos.indexOf(t)-1;return i<0?null:(this._getTileIdAtLOD(Z,this._lodInfos[i],Z),Z.id)}},{key:"getTileResolution",value:function(e){var t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1}},{key:"getTileScale",value:function(e){var t=this._infoByLevel[e.level];return t?t.scale:-1}},{key:"intersects",value:function(e,t){Z.set(t);var i=this._infoByLevel[Z.level],n=e.lodInfo;if(n.resolution>i.resolution){this._getTileIdAtLOD(Z,n,Z);var r,s=n.denormalizeCol(Z.col,Z.world),l=(0,o.Z)(e.spans);try{for(l.s();!(r=l.n()).done;){var u=r.value;if(u.row===Z.row&&u.colFrom<=s&&u.colTo>=s)return!0}}catch(x){l.e(x)}finally{l.f()}}if(n.resolution<i.resolution){var h=e.spans.reduce((function(e,t){return e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e}),[1/0,-1/0,1/0,-1/0]),c=(0,a.Z)(h,4),d=c[0],f=c[1],p=c[2],v=c[3],m=i.denormalizeCol(Z.col,Z.world),y=n.getColumnForX(i.getXForColumn(m)),g=n.getRowForY(i.getYForRow(Z.row)),_=n.getColumnForX(i.getXForColumn(m+1))-1,w=n.getRowForY(i.getYForRow(Z.row+1))-1;return!(y>v||_<p||g>f||w<d)}var k=n.denormalizeCol(Z.col,Z.world);return e.spans.some((function(e){return e.row===Z.row&&e.colFrom<=k&&e.colTo>=k}))}},{key:"normalizeBounds",value:function(e,t,i){if(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],this._wrap){var n=(0,c.b)(this.tileInfo.spatialReference),r=-i*(n.valid[1]-n.valid[0]);e[0]+=r,e[2]+=r}return e}},{key:"getSmallestInfoForScale",value:function(e){var t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(var i=1;i<t.length-1;i++)if(e>t[i]+1e-6)return this._infoByScale[t[i-1]];return this._infoByScale[t[t.length-1]]}},{key:"getClosestInfoForScale",value:function(e){var t=this.scales;return this._infoByScale[e]||(e=t.reduce((function(t,i){return Math.abs(i-e)<Math.abs(t-e)?i:t}),t[0])),this._infoByScale[e]}},{key:"scaleToLevel",value:function(e){var t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(var i=t.length-1;i>=0;i--)if(e<t[i])return i===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[i]].level+(t[i]-e)/(t[i]-t[i+1]);return this._infoByScale[t[0]].level}},{key:"scaleToZoom",value:function(e){return this.tileInfo.scaleToZoom(e)}},{key:"_getTileIdAtLOD",value:function(e,t,i){var n=this._infoByLevel[i.level];return e.set(i),t.resolution<n.resolution?null:(t.resolution===n.resolution||(e.level=t.level,e.col=Math.floor(i.col*n.resolution/t.resolution+.01),e.row=Math.floor(i.row*n.resolution/t.resolution+.01)),e)}}]),e}();function V(e,t){if(!(this instanceof V))return new V(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}function R(e,t,i){if(!i)return t.indexOf(e);for(var n=0;n<t.length;n++)if(i(e,t[n]))return n;return-1}function O(e,t){z(e,0,e.children.length,t,e)}function z(e,t,i,n,r){r||(r=X(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var a,o=t;o<i;o++)a=e.children[o],D(r,e.leaf?n(a):a);return r}function D(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function E(e,t){return e.minX-t.minX}function N(e,t){return e.minY-t.minY}function F(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function L(e){return e.maxX-e.minX+(e.maxY-e.minY)}function B(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function q(e,t){var i=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,r-i)*Math.max(0,a-n)}function Y(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function A(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function X(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function G(e,t,i,n,r){for(var a,o=[t,i];o.length;)(i=o.pop())-(t=o.pop())<=n||(a=t+Math.ceil((i-t)/n/2)*n,(0,p.a)(e,a,t,i,r),o.push(t,a,a,i))}V.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,i=[],n=this.toBBox;if(!A(e,t))return i;for(var r,a,o,s,l=[];t;){for(r=0,a=t.children.length;r<a;r++)o=t.children[r],A(e,s=t.leaf?n(o):o)&&(t.leaf?i.push(o):Y(e,s)?this._all(o,i):l.push(o));t=l.pop()}return i},collides:function(e){var t=this.data,i=this.toBBox;if(!A(e,t))return!1;for(var n,r,a,o,s=[];t;){for(n=0,r=t.children.length;n<r;n++)if(a=t.children[n],A(e,o=t.leaf?i(a):a)){if(t.leaf||Y(e,o))return!0;s.push(a)}t=s.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},insert:function(e){return e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=X([]),this},remove:function(e,t){if(!e)return this;for(var i,n,r,a,o=this.data,s=this.toBBox(e),l=[],u=[];o||l.length;){if(o||(o=l.pop(),n=l[l.length-1],i=u.pop(),a=!0),o.leaf&&-1!==(r=R(e,o.children,t)))return o.children.splice(r,1),l.push(o),this._condense(l),this;a||o.leaf||!Y(o,s)?n?(i++,o=n.children[i],a=!1):o=null:(l.push(o),u.push(i),i=0,n=o,o=o.children[0])}return this},toBBox:function(e){return e},compareMinX:E,compareMinY:N,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},_build:function(e,t,i,n){var r,a=i-t+1,o=this._maxEntries;if(a<=o)return O(r=X(e.slice(t,i+1)),this.toBBox),r;n||(n=Math.ceil(Math.log(a)/Math.log(o)),o=Math.ceil(a/Math.pow(o,n-1))),(r=X([])).leaf=!1,r.height=n;var s,l,u,h,c=Math.ceil(a/o),d=c*Math.ceil(Math.sqrt(o));for(G(e,t,i,d,this.compareMinX),s=t;s<=i;s+=d)for(G(e,s,u=Math.min(s+d-1,i),c,this.compareMinY),l=s;l<=u;l+=c)h=Math.min(l+c-1,u),r.children.push(this._build(e,l,h,n-1));return O(r,this.toBBox),r},_chooseSubtree:function(e,t,i,n){for(var r,a,o,s,l,u,h,c;n.push(t),!t.leaf&&n.length-1!==i;){for(h=c=1/0,r=0,a=t.children.length;r<a;r++)l=F(o=t.children[r]),(u=B(e,o)-l)<c?(c=u,h=l<h?l:h,s=o):u===c&&l<h&&(h=l,s=o);t=s||t.children[0]}return t},_insert:function(e,t,i){var n=this.toBBox,r=i?e:n(e),a=[],o=this._chooseSubtree(r,this.data,t,a);for(o.children.push(e),D(o,r);t>=0&&a[t].children.length>this._maxEntries;)this._split(a,t),t--;this._adjustParentBBoxes(r,a,t)},_split:function(e,t){var i=e[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);var a=this._chooseSplitIndex(i,r,n),o=X(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,O(i,this.toBBox),O(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(i,o)},_splitRoot:function(e,t){this.data=X([e,t]),this.data.height=e.height+1,this.data.leaf=!1,O(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,i){var n,r,a,o,s,l,u,h;for(l=u=1/0,n=t;n<=i-t;n++)o=q(r=z(e,0,n,this.toBBox),a=z(e,n,i,this.toBBox)),s=F(r)+F(a),o<l?(l=o,h=n,u=s<u?s:u):o===l&&s<u&&(u=s,h=n);return h},_chooseSplitAxis:function(e,t,i){var n=e.leaf?this.compareMinX:E,r=e.leaf?this.compareMinY:N;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,r)&&e.children.sort(n)},_allDistMargin:function(e,t,i,n){e.children.sort(n);var r,a,o=this.toBBox,s=z(e,0,t,o),l=z(e,i-t,i,o),u=L(s)+L(l);for(r=t;r<i-t;r++)a=e.children[r],D(s,e.leaf?o(a):a),u+=L(s);for(r=i-t-1;r>=t;r--)a=e.children[r],D(l,e.leaf?o(a):a),u+=L(l);return u},_adjustParentBBoxes:function(e,t,i){for(var n=i;n>=0;n--)D(t[n],e)},_condense:function(e){for(var t,i=e.length-1;i>=0;i--)0===e[i].children.length?i>0?(t=e[i-1].children).splice(t.indexOf(e[i]),1):this.clear():O(e[i],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};var j=function(){function e(t,i){(0,l.Z)(this,e),this.key=new d.e(0,0,0,0),this.bounds=(0,m.u)(),this.objectIds=new Set,this.key.set(i);var n=t.getLODInfoAt(this.key);this.tileInfoView=t,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=n.resolution,this.scale=n.scale,this.level=n.level}return(0,s.Z)(e,[{key:"id",get:function(){return this.key.id}},{key:"extent",get:function(){return v.M.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)}},{key:"transform",get:function(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}},{key:"createChildTiles",value:function(){for(var t=this.key.getChildKeys(),i=u.A.acquire(),n=0;n<t.length;n++)i[n]=new e(this.tileInfoView,t[n]);return i}},{key:"getQuantizationParameters",value:function(){return y.a.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}]),e}(),U={added:[],removed:[]},K=new Set,H=new d.e(0,0,0,0),W=function(e){(0,n.Z)(i,e);var t=(0,r.Z)(i);function i(e){var n;return(0,l.Z)(this,i),(n=t.call(this))._tiles=new Map,n._index=V(9,(0,u.c)("esri-csp-restrictions")?function(e){return{minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),n.tiles=[],n.tileScheme=e,n}return(0,s.Z)(i,[{key:"destroy",value:function(){this.clear()}},{key:"clear",value:function(){this.tiles.length=0,this._tiles.clear(),this._index.clear()}},{key:"has",value:function(e){return this._tiles.has(e)}},{key:"get",value:function(e){return this._tiles.get(e)}},{key:"boundsIntersections",value:function(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})}},{key:"updateTiles",value:function(e){var t,i=this,n={added:[],removed:[]},r=(0,o.Z)(e.added);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(!this.has(a)){var s=new j(this.tileScheme,a);this._tiles.set(a,s),this._index.insert(s),n.added.push(s)}}}catch(d){r.e(d)}finally{r.f()}var l,u=(0,o.Z)(e.removed);try{for(u.s();!(l=u.n()).done;){var h=l.value;if(this.has(h)){var c=this.get(h);this._tiles.delete(h),this._index.remove(c),n.removed.push(c)}}}catch(d){u.e(d)}finally{u.f()}this.tiles.length=0,this._tiles.forEach((function(e){return i.tiles.push(e)})),(n.added.length||n.removed.length)&&this.emit("update",n)}},{key:"setViewState",value:function(e){var t=this.tileScheme.getTileCoverage(e,0);if(t){var i=t.spans,n=t.lodInfo,r=n.level;if(i.length>0){var a,s=(0,o.Z)(i);try{for(s.s();!(a=s.n()).done;)for(var l=a.value,u=l.row,h=l.colFrom,c=l.colTo,d=h;d<=c;d++){var f=H.set(r,u,n.normalizeCol(d),n.getWorldForColumn(d)).id;if(K.add(f),!this.has(f)){var p=new j(this.tileScheme,f);this._tiles.set(f,p),this._index.insert(p),this.tiles.push(p),U.added.push(p)}}}catch(y){s.e(y)}finally{s.f()}}for(var v=this.tiles.length-1;v>=0;v--){var m=this.tiles[v];K.has(m.id)||(this._tiles.delete(m.id),this.tiles.splice(v,1),this._index.remove(m),U.removed.push(m))}(U.added.length||U.removed.length)&&this.emit("update",U),S.pool.release(t),K.clear(),U.added.length=0,U.removed.length=0}}}]),i}(f.n)},69379:function(e,t,i){i.d(t,{p:function(){return b},r:function(){return C}});var n=i(37762),r=i(15671),a=i(43144),o=i(60136),s=i(29388),l=i(50165),u=i(87833),h=i(22494),c=i(79146),d=i(49510);var f=new Set,p=[],v=new Map,m=[0,0],y=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,r.Z)(this,i),(n=t.call(this,e))._keyToItem=new Map,n.concurrency=6,n.strategy="scale-first",n.tileInfoView=null,n}return(0,a.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.concurrency,i=this.process;this._queue=new h.a({concurrency:t,process:function(t,n){var r=e._keyToItem.get(t);return i(r,{signal:n})},peeker:function(e){return e.values().next().value}})}},{key:"destroy",value:function(){this.clear(),this._queue.destroy(),this._queue=null}},{key:"length",get:function(){return this._queue?this._queue.length:0}},{key:"onGoingCount",get:function(){return this._keyToItem.size}},{key:"updating",get:function(){return this.length>0||this.onGoingCount>0}},{key:"abort",value:function(e){var t="string"==typeof e?e:e.id;this._queue.abort(t)}},{key:"clear",value:function(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}},{key:"has",value:function(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}},{key:"isOngoing",value:function(e){var t="string"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}},{key:"pause",value:function(){this._queue.pause()}},{key:"push",value:function(e,t){var i=this,n=e.key.id+"-"+t;if(this.has(n))return this.get(n);var r=this._queue.push(n),a=function(){i._keyToItem.delete(n),i.notifyChange("updating")};return this._keyToItem.set(n,e),r.then(a,a),this.notifyChange("updating"),r}},{key:"reset",value:function(){this._queue.reset(),this.notifyChange("updating")}},{key:"resume",value:function(){this._queue.resume()}},{key:"_peekByScaleFirst",value:function(e){var t=this;if(!this.state)return e.values().next().value;var i=this.tileInfoView,n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;e.forEach((function(e){var i=t._keyToItem.get(e),a=t.tileInfoView.getTileScale(i.key);v.has(a)||(v.set(a,[]),n=Math.max(a,n),r=Math.min(a,r)),v.get(a).push(i.key),f.add(a)}));var a=this.state.scale;v.has(a)||(function(e,t){e.length=0,t.forEach((function(t){return e.push(t)}))}(p,f),p.sort((function(e,t){return e-t})),a=p.reduce((function(e,t){return Math.abs(t-a)<Math.abs(e-a)?t:e}),p[0])),a=Math.min(a,n),a=Math.max(a,r);var o=v.get(a),s=i.getClosestInfoForScale(a),l=s.getColumnForX(this.state.center[0]),u=s.getRowForY(this.state.center[1]);return o.sort((function(e,t){var i=s.denormalizeCol(e.col,e.world),n=s.denormalizeCol(t.col,t.world);return Math.sqrt((l-i)*(l-i)+(u-e.row)*(u-e.row))-Math.sqrt((l-n)*(l-n)+(u-t.row)*(u-t.row))})),f.clear(),v.clear(),o[0].id}},{key:"_peekByCenterFirst",value:function(e){var t=this;if(!this.state)return e.values().next().value;var i=this.tileInfoView,n=this.state.center,r=Number.POSITIVE_INFINITY,a=null;return e.forEach((function(e){var o=t._keyToItem.get(e);i.getTileCoords(m,o.key);var s=(0,u.m)(m,n);s<r&&(r=s,a=o.key)})),a.id}}]),i}(l.y);(0,l.e)([(0,l.d)({constructOnly:!0})],y.prototype,"concurrency",void 0),(0,l.e)([(0,l.d)({constructOnly:!0})],y.prototype,"process",void 0),(0,l.e)([(0,l.d)()],y.prototype,"state",void 0),(0,l.e)([(0,l.d)({constructOnly:!0})],y.prototype,"strategy",void 0),(0,l.e)([(0,l.d)({constructOnly:!0})],y.prototype,"tileInfoView",void 0),(0,l.e)([(0,l.d)({readOnly:!0})],y.prototype,"updating",null),y=(0,l.e)([(0,l.n)("esri.views.2d.tiling.PagedTileQueue")],y);var g=new Set,_=[],w=new Map,k=[0,0],x=function(e){(0,o.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,r.Z)(this,i),(n=t.call(this,e))._keyToItem=new Map,n.concurrency=6,n.strategy="scale-first",n.tileInfoView=null,n}return(0,a.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.concurrency,i=this.process,n=this.strategy;this._queue=new h.a({concurrency:t,process:function(t,n){var r=e._keyToItem.get(t);return i(r,{signal:n})},peeker:"scale-first"===n?function(t){return e._peekByScaleFirst(t)}:function(t){return e._peekByCenterFirst(t)}})}},{key:"destroy",value:function(){this.clear(),this._queue.destroy(),this._queue=null}},{key:"length",get:function(){return this._queue?this._queue.length:0}},{key:"onGoingCount",get:function(){return this._keyToItem.size}},{key:"updating",get:function(){return this.length>0||this.onGoingCount>0}},{key:"abort",value:function(e){var t="string"==typeof e?e:e.id;this._queue.abort(t)}},{key:"clear",value:function(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}},{key:"has",value:function(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}},{key:"isOngoing",value:function(e){var t="string"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}},{key:"pause",value:function(){this._queue.pause()}},{key:"push",value:function(e){var t=this,i=e.key.id;if(this._queue.has(i))return this._queue.get(i);var n=this._queue.push(i),r=function(){t._keyToItem.delete(i),t.notifyChange("updating")};return this._keyToItem.set(i,e),n.then(r,r),this.notifyChange("updating"),n}},{key:"reset",value:function(){this._queue.reset()}},{key:"resume",value:function(){this._queue.resume()}},{key:"_peekByScaleFirst",value:function(e){var t=this;if(!this.state)return e.values().next().value;var i=this.tileInfoView,n=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;e.forEach((function(e){var i=t._keyToItem.get(e),a=t.tileInfoView.getTileScale(i.key);w.has(a)||(w.set(a,[]),n=Math.max(a,n),r=Math.min(a,r)),w.get(a).push(i.key),g.add(a)}));var a=this.state.scale;w.has(a)||(function(e,t){e.length=0,t.forEach((function(t){return e.push(t)}))}(_,g),_.sort((function(e,t){return e-t})),a=_.reduce((function(e,t){return Math.abs(t-a)<Math.abs(e-a)?t:e}),_[0])),a=Math.min(a,n),a=Math.max(a,r);var o=w.get(a),s=i.getClosestInfoForScale(a),l=s.getColumnForX(this.state.center[0]),u=s.getRowForY(this.state.center[1]);return o.sort((function(e,t){var i=s.denormalizeCol(e.col,e.world),n=s.denormalizeCol(t.col,t.world);return Math.sqrt((l-i)*(l-i)+(u-e.row)*(u-e.row))-Math.sqrt((l-n)*(l-n)+(u-t.row)*(u-t.row))})),g.clear(),w.clear(),o[0].id}},{key:"_peekByCenterFirst",value:function(e){var t=this;if(!this.state)return e.values().next().value;var i=this.tileInfoView,n=this.state.center,r=Number.POSITIVE_INFINITY,a=null;return e.forEach((function(e){var o=t._keyToItem.get(e);i.getTileCoords(k,o.key);var s=(0,u.m)(k,n);s<r&&(r=s,a=o.key)})),a.id}}]),i}(l.y);(0,l.e)([(0,l.d)({constructOnly:!0})],x.prototype,"concurrency",void 0),(0,l.e)([(0,l.d)({constructOnly:!0})],x.prototype,"process",void 0),(0,l.e)([(0,l.d)()],x.prototype,"state",void 0),(0,l.e)([(0,l.d)({constructOnly:!0})],x.prototype,"strategy",void 0),(0,l.e)([(0,l.d)({constructOnly:!0})],x.prototype,"tileInfoView",void 0),(0,l.e)([(0,l.d)({readOnly:!0})],x.prototype,"updating",null);var b=x=(0,l.e)([(0,l.n)("esri.views.2d.tiling.TileQueue")],x),T=function(){function e(t,i,n){(0,r.Z)(this,e),this.maxSize=t,this.tileInfoView=i,this.removedFunc=n,this._tilePerId=new Map,this._tileKeysPerLevel=[]}return(0,a.Z)(e,[{key:"has",value:function(e){return this._tilePerId.has(e)}},{key:"get",value:function(e){return this._tilePerId.get(e)}},{key:"pop",value:function(e){var t=this._tilePerId.get(e);if(!t)return null;var i=t.key.level,n=this._tileKeysPerLevel[i];S(this._tilePerId,e);for(var r=0;r<n.length;r++)if(n[r].id===e){n.splice(r,1);break}return t.visible=!0,t}},{key:"add",value:function(e){e.visible=!1;var t=e.key,i=t.id;if(!this._tilePerId.has(i)){this._tilePerId.set(i,e);var n=t.level;this._tileKeysPerLevel[n]||(this._tileKeysPerLevel[n]=[]),this._tileKeysPerLevel[n].push(t)}}},{key:"prune",value:function(e,t,i){var n=this._tilePerId.size;if(!(n<=this.maxSize)){for(var r=this._tileKeysPerLevel.length-1;n>this.maxSize&&r>=0;)r!==e&&(n=this._pruneAroundCenterTile(n,t,i,r)),r--;n>this.maxSize&&(n=this._pruneAroundCenterTile(n,t,i,e))}}},{key:"_pruneAroundCenterTile",value:function(e,t,i,n){var r=this._tileKeysPerLevel[n];if(!r||0===r.length)return e;var a=this.tileInfoView.tileInfo,o=a.size,s=a.origin,l=i*o[0],h=i*o[1],c=[0,0],d=[0,0];for(r.sort((function(e,i){return c[0]=s.x+l*(e.col+.5),c[1]=s.y-h*(e.row+.5),d[0]=s.x+l*(i.col+.5),d[1]=s.y-h*(i.row+.5),(0,u.b)(c,t)-(0,u.b)(d,t)}));r.length>0;){var f=r.pop();if(this._removeTile(f.id),--e===this.maxSize)break}return e}},{key:"_removeTile",value:function(e){var t=this._tilePerId.get(e);this.removedFunc&&this.removedFunc(t),S(this._tilePerId,e)}}]),e}();function S(e,t){e.delete(t)}var M=new d.e(0,0,0,0),Z=new Map,I=[],P=[],C=function(){function e(t){var i=this;(0,r.Z)(this,e),this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this.resampling=null==t.resampling||!!t.resampling,t.cachePolicy&&(this.cachePolicy=t.cachePolicy),t.coveragePolicy&&(this.coveragePolicy=t.coveragePolicy),null!=t.buffer&&(this.buffer=t.buffer),t.cacheSize&&(this._tileCache=new T(t.cacheSize,this.tileInfoView,(function(e){i.releaseTile(e)})))}return(0,a.Z)(e,[{key:"destroy",value:function(){this.tileIndex.clear()}},{key:"update",value:function(e){var t=this,i=this.resampling,r=this.tileIndex,a=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.coveragePolicy);if(P.length=0,I.length=0,Z.clear(),a){var o=this.tileInfoView.tileInfo,s=o.minScale,l=o.maxScale,u=a.spans,c=a.lodInfo,d=c.level,f=e.state,p=f.scale,v=f.center,m=f.resolution,y=!e.stationary&&p>this._previousScale;if(this._previousScale=p,this.tiles.length=0,!i&&(p>s||p<l))return this.tiles.length=0,Z.clear(),r.forEach((function(e){t.releaseTile(e)})),r.clear(),P.length=0,I.length=0,Z.clear(),h.b.pool.release(a),!0;r.forEach((function(e){return e.visible=!0}));var g=0,_=0;if(u.length>0){var w,k=(0,n.Z)(u);try{for(k.s();!(w=k.n()).done;)for(var x=w.value,b=x.row,T=x.colFrom,S=x.colTo,C=T;C<=S;C++){g++;var V=M.set(d,b,c.normalizeCol(C),c.getWorldForColumn(C)).id;if(r.has(V)){var R=r.get(V);R.isReady?(Z.set(V,R),_++):y||this._addParentTile(V,Z)}else{var O=void 0;if(this._tileCache&&this._tileCache.has(V)){if(O=this._tileCache.pop(V),this.tileIndex.set(V,O),O.isReady){Z.set(V,O),_++;continue}}else O=this.acquireTile(M),this.tileIndex.set(V,O);y||this._addParentTile(V,Z)}}}catch(A){k.e(A)}finally{k.f()}}var z=_===g;r.forEach((function(e,i){if(M.set(i),!Z.has(i)){var n=t.tileInfoView.intersects(a,M),r="purge"===t.cachePolicy?M.level!==d:M.level>d;!n||!y&&z?!r&&n||I.push(i):e.isReady?r&&"purge"===t.cachePolicy&&t._hasReadyAncestor(M,d)?I.push(i):P.push(i):r&&I.push(i)}}));var D,E=(0,n.Z)(P);try{for(E.s();!(D=E.n()).done;){var N=D.value,F=r.get(N);F&&F.isReady&&Z.set(N,F)}}catch(A){E.e(A)}finally{E.f()}var L,B=(0,n.Z)(I);try{for(B.s();!(L=B.n()).done;){var q=L.value,Y=r.get(q);this._tileCache?this._tileCache.add(Y):this.releaseTile(Y),r.delete(q)}}catch(A){B.e(A)}finally{B.f()}return Z.forEach((function(e){return t.tiles.push(e)})),r.forEach((function(e){Z.has(e.key.id)||(e.visible=!1)})),this._tileCache&&this._tileCache.prune(d,v,m),h.b.pool.release(a),Z.clear(),z}}},{key:"clear",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=this.tileIndex;t&&i.forEach((function(t){e.releaseTile(t)})),i.clear()}},{key:"updateCacheSize",value:function(e){this._tileCache&&(this._tileCache.maxSize=e)}},{key:"_addParentTile",value:function(e,t){for(var i=e,n=null;i=this.tileInfoView.getTileParentId(i);)if(this.tileIndex.has(i)){if((n=this.tileIndex.get(i))&&n.isReady){t.has(n.key.id)||t.set(n.key.id,n);break}}else if(this._tileCache&&this._tileCache.has(i)&&(n=this._tileCache.pop(i),this.tileIndex.set(i,n),n&&n.isReady)){t.has(n.key.id)||t.set(n.key.id,n);break}}},{key:"_hasReadyAncestor",value:function(e,t){var i=(0,c.u)();this.tileInfoView.getTileBounds(i,e,!0);var r,a=(0,n.Z)(this.tileIndex.values());try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.isReady&&o.key.level>=t&&o.key.level<e.level){var s=(0,c.u)();if(this.tileInfoView.getTileBounds(s,o.key,!0),(0,c.R)(s,i))return!0}}}catch(l){a.e(l)}finally{a.f()}return!1}}]),e}()},18392:function(e,t,i){i.d(t,{a:function(){return s}});var n,r,a,o={exports:{}};n=o,r=function(){function e(i,n,r,a,o){for(;a>r;){if(a-r>600){var s=a-r+1,l=n-r+1,u=Math.log(s),h=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*h*(s-h)/s)*(l-s/2<0?-1:1);e(i,n,Math.max(r,Math.floor(n-l*h/s+c)),Math.min(a,Math.floor(n+(s-l)*h/s+c)),o)}var d=i[n],f=r,p=a;for(t(i,r,n),o(i[a],d)>0&&t(i,r,a);f<p;){for(t(i,f,p),f++,p--;o(i[f],d)<0;)f++;for(;o(i[p],d)>0;)p--}0===o(i[r],d)?t(i,r,p):t(i,++p,a),p<=n&&(r=p+1),n<=p&&(a=p-1)}}function t(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function i(e,t){return e<t?-1:e>t?1:0}return function(t,n,r,a,o){e(t,n,r||0,a||t.length-1,o||i)}},void 0!==(a=r())&&(n.exports=a);var s=o.exports},72021:function(e,t,i){function n(e,t,i,n){var r=3*e,a=3*(i-e)-r,o=1-r-a,s=3*t,l=3*(n-t)-s,u=1-s-l;function h(e){return((o*e+a)*e+r)*e}function c(e){return((u*e+l)*e+s)*e}function d(e){return(3*o*e+2*a)*e+r}function f(e,t){var i,n,r,a,o,s;for(r=e,s=0;s<8;s++){if(a=h(r)-e,Math.abs(a)<t)return r;if(o=d(r),Math.abs(o)<1e-6)break;r-=a/o}if((r=e)<(i=0))return i;if(r>(n=1))return n;for(;i<n;){if(a=h(r),Math.abs(a-e)<t)return r;e>a?i=r:n=r,r=.5*(n-i)+i}return r}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-6;return c(f(e,t))}}i.d(t,{e:function(){return n},r:function(){return o},t:function(){return a}});var r=/^cubic-bezier\((.*)\)/,a={};function o(e){var t=a[e]||null;if(!t){var i=r.exec(e);if(i){var o=i[1].split(",").map((function(e){return parseFloat(e.trim())}));4!==o.length||o.some((function(e){return isNaN(e)}))||(t=n.apply(n,o))}}return t}a.ease=n(.25,.1,.25,1),a.linear=n(0,0,1,1),a.easeIn=a["ease-in"]=n(.42,0,1,1),a.easeOut=a["ease-out"]=n(0,0,.58,1),a.easeInOut=a["ease-in-out"]=n(.42,0,.58,1)},84192:function(e,t,i){function n(){return[0,0]}function r(e){return[e[0],e[1]]}function a(e,t){return[e,t]}function o(e){for(var t=[0,0],i=Math.min(2,e.length),n=0;n<i;++n)t[n]=e[n];return t}function s(e,t){return new Float64Array(e,t,2)}function l(){return[0,0]}function u(){return a(1,1)}function h(){return a(1,0)}function c(){return a(0,1)}i.d(t,{e:function(){return o},f:function(){return d},i:function(){return f},n:function(){return n},o:function(){return s},r:function(){return a},t:function(){return r}});var d=[0,0],f=u(),p=h(),v=c();Object.freeze(Object.defineProperty({__proto__:null,create:n,clone:r,fromValues:a,fromArray:o,createView:s,zeros:l,ones:u,unitX:h,unitY:c,ZEROS:d,ONES:f,UNIT_X:p,UNIT_Y:v},Symbol.toStringTag,{value:"Module"}))}}]);
//# sourceMappingURL=4473.6fa77ae7.chunk.js.map