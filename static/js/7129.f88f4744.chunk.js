"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[7129],{40273:function(e,t,n){n.d(t,{$:function(){return br},A:function(){return Ti},B:function(){return Oa},C:function(){return Or},D:function(){return Rr},E:function(){return ar},F:function(){return ta},G:function(){return Br},H:function(){return vr},I:function(){return oa},J:function(){return Te},K:function(){return hi},L:function(){return Kr},M:function(){return qr},N:function(){return ii},O:function(){return xr},P:function(){return Dr},Q:function(){return Sr},R:function(){return Gr},S:function(){return Wr},T:function(){return Yr},U:function(){return $r},V:function(){return Qr},W:function(){return Ei},X:function(){return mi},Y:function(){return _r},Z:function(){return kr},_:function(){return ps},a:function(){return na},a0:function(){return gi},a1:function(){return yi},a2:function(){return ei},a3:function(){return ci},a4:function(){return Mi},b:function(){return ra},c:function(){return aa},d:function(){return ba},e:function(){return wa},f:function(){return Ia},g:function(){return Fr},h:function(){return Ma},i:function(){return Le},j:function(){return Ea},k:function(){return ze},l:function(){return _a},m:function(){return Ge},n:function(){return sr},o:function(){return La},p:function(){return $n},q:function(){return ti},r:function(){return Er},s:function(){return sa},t:function(){return ea},u:function(){return ga},v:function(){return Vr},w:function(){return he},x:function(){return Lr},y:function(){return zr},z:function(){return Ci}});var i=n(11752),r=n(61120),a=n(29439),o=n(93433),s=n(74165),u=n(15861),l=n(97326),c=n(4942),d=n(37762),h=n(1413),p=n(15671),v=n(43144),f=n(60136),y=n(29388),g=n(23132),m=n(77470),_=n(75610),w=n(36551),k=n(84538),b=n(80175),M=n(97033),E=n(49580),x=n(72692),T=n(77389),C=(n(91204),n(83822)),P=n(24980),I=n(30709),Z=n(72763),A=n(1773),S=n(60424),R=n(38425),F=n(19948),L=n(42471),O=n(82162),D=n(78470),V=n(36638),N=n(30150),z=n(79611),U=n(43920),B=n(81663),G=n(80262),H=n(83996),j=n(78880),W=n(14181),q=n(6794),K=n(2760),Q=n(86270),Y=n(47672),X=n(63022),J=n(10815),$=n(70441),ee=n(22225),te=n(96401),ne=n(87833),ie=n(21523),re=n(84192),ae=n(44455),oe=n(71710),se=n(45332),ue=n(38304),le={widthBreakpoint:{getValue:function(e){var t=e.viewSize[0],n=e.breakpoints,i=this.values;return t<=n.xsmall?i.xsmall:t<=n.small?i.small:t<=n.medium?i.medium:t<=n.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue:function(e){var t=e.viewSize[1],n=e.breakpoints,i=this.values;return t<=n.xsmall?i.xsmall:t<=n.small?i.small:t<=n.medium?i.medium:t<=n.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue:function(e){var t=e.viewSize,n=t[0],i=t[1],r=this.values;return i>=n?r.portrait:r.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},ce={xsmall:544,small:768,medium:992,large:1200};function de(e,t){return t?le[e].valueToClassName[t].split(" "):[]}var he=function(e){var t=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;(0,p.Z)(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r)))._breakpointsHandles=new m.u,e.orientation=null,e.widthBreakpoint=null,e.heightBreakpoint=null,e.breakpoints=ce,e}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this._breakpointsHandles.add((0,w.l)((function(){return[e.breakpoints,e.size]}),(function(){return e._updateClassNames()}),w.h))}},{key:"destroy",value:function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=(0,_.l)(this._breakpointsHandles))}},{key:"breakpoints",set:function(e){if(e!==this._get("breakpoints")){var t=function(e){var t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}(e);if(!t){var n=JSON.stringify(ce,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}e=t?e:ce,this._set("breakpoints",(0,h.Z)({},e))}}},{key:"_updateClassNames",value:function(){if(this.container){var e,t=g.t.acquire(),n=g.t.acquire(),i=!1;for(e in le){var r=this[e],a=le[e].getValue({viewSize:this.size,breakpoints:this.breakpoints});r!==a&&(i=!0,this[e]=a,de(e,r).forEach((function(e){return n.push(e)})),de(e,a).forEach((function(e){return t.push(e)})))}i&&(this._applyClassNameChanges(t,n),g.t.release(t),g.t.release(n))}}},{key:"_applyClassNameChanges",value:function(e,t){var n=this.container;n&&(t.forEach((function(e){return n.classList.remove(e)})),e.forEach((function(e){return n.classList.add(e)})))}},{key:"_removeActiveClassNames",value:function(){var e,t=this.container;if(t)for(e in le)de(e,this[e]).forEach((function(e){return t.classList.remove(e)}))}}]),n}(e);return(0,g.e)([(0,g.d)()],t.prototype,"breakpoints",null),(0,g.e)([(0,g.d)()],t.prototype,"orientation",void 0),(0,g.e)([(0,g.d)()],t.prototype,"widthBreakpoint",void 0),(0,g.e)([(0,g.d)()],t.prototype,"heightBreakpoint",void 0),t=(0,g.e)([(0,g.n)("esri.views.BreakpointsOwner")],t)},pe=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;return(0,p.Z)(this,n),(e=t.apply(this,arguments)).items=new b.j,e._watchUpdatingTracking=new M.c,e._callbacks=new Map,e._projector=(0,k.i)(),e._hiddenProjector=(0,k.i)(),e}return(0,v.Z)(n,[{key:"needsRender",get:function(){return this.items.length>0}},{key:"initialize",value:function(){var e=this,t=document.createElement("div");t.className="esri-overlay-surface",this._set("surface",t),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),t.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange((function(){return e.items}),(function(t){var n,i=(0,d.Z)(t.added);try{var r=function(){var t=n.value,i=function(){return t.render()};e._callbacks.set(t,i),e._projector.append(e.surface,i)};for(i.s();!(n=i.n()).done;)r()}catch(l){i.e(l)}finally{i.f()}var a,o=(0,d.Z)(t.removed);try{for(o.s();!(a=o.n()).done;){var s=a.value,u=e._projector.detach(e._callbacks.get(s));e.surface.removeChild(u.domNode),e._callbacks.delete(s)}}catch(l){o.e(l)}finally{o.f()}}))}},{key:"addItem",value:function(e){this.items.add(e)}},{key:"removeItem",value:function(e){this.items.remove(e)}},{key:"destroy",value:function(){var e=this;this.items.removeAll(),this._callbacks.forEach((function(t){return e._projector.detach(t)})),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}},{key:"render",value:function(){this._projector.renderNow()}},{key:"computeBoundingRect",value:function(e){var t=this._hiddenSurface,n=this._hiddenProjector,i=null,r=function(){return i=e.render()};n.append(t,r),n.renderNow();var a={left:0,top:0,right:0,bottom:0};if(i&&i.domNode){var o=i.domNode.getBoundingClientRect();a.left=o.left,a.top=o.top,a.right=o.right,a.bottom=o.bottom}for(n.detach(r);t.firstChild;)t.removeChild(t.firstChild);return a}},{key:"overlaps",value:function(e,t){var n=this.computeBoundingRect(e),i=this.computeBoundingRect(t);return Math.max(n.left,i.left)<=Math.min(n.right,i.right)&&Math.max(n.top,i.top)<=Math.min(n.bottom,i.bottom)}},{key:"hasVisibleItems",get:function(){return this.items.some((function(e){return e.visible}))}},{key:"renderCanvas",value:function(e){if(this.items.some((function(e){return e.visible}))){var t=e.getContext("2d");t.save(),t.font="10px ".concat(getComputedStyle(this.surface).fontFamily),this.items.forEach((function(e){t.save(),e.renderCanvas(t),t.restore()})),t.restore()}}}]),n}(g.y);(0,g.e)([(0,g.d)({readOnly:!0})],pe.prototype,"surface",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],pe.prototype,"items",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],pe.prototype,"needsRender",null),(0,g.e)([(0,g.d)({readOnly:!0})],pe.prototype,"_watchUpdatingTracking",void 0),(0,g.e)([(0,g.d)({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],pe.prototype,"updating",void 0);var ve,fe=pe=(0,g.e)([(0,g.n)("esri.views.overlay.ViewOverlay")],pe),ye=Symbol("anchorHandles"),ge=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))[ve]=new m.u,i.location=null,i.screenLocationEnabled=!1,i.view=null,i[ye].add([(0,w.f)((function(){return(0,_.h)(i.screenLocationEnabled?i.view:null,(function(e){return[e.size,"3d"===e.type?e.camera:e.viewpoint]}))}),(function(){return i.notifyChange("screenLocation")})),(0,w.l)((function(){return i.screenLocation}),(function(e,t){(0,_.r)(e)&&(0,_.r)(t)&&i.emit("view-change")}))]),i}return(0,v.Z)(n,[{key:"destroy",value:function(){this.view=null,this[ye]=(0,_.l)(this[ye])}},{key:"screenLocation",get:function(){var e=this.location,t=this.view;return this.screenLocationEnabled&&(0,_.r)(e)&&(0,_.r)(t)&&t.ready?t.toScreen(e):null}}]),n}(b.n.EventedAccessor);ve=ye,(0,g.e)([(0,g.d)()],ge.prototype,"location",void 0),(0,g.e)([(0,g.d)()],ge.prototype,"screenLocation",null),(0,g.e)([(0,g.d)()],ge.prototype,"screenLocationEnabled",void 0),(0,g.e)([(0,g.d)()],ge.prototype,"view",void 0);var me=ge=(0,g.e)([(0,g.n)("esri.widgets.support.AnchorElementViewModel")],ge),_e=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).visible=!1,i}return(0,v.Z)(n)}(me);(0,g.e)([(0,g.d)()],_e.prototype,"visible",void 0);var we=_e=(0,g.e)([(0,g.n)("esri.widgets.CompassViewModel")],_e),ke="esri-spinner",be="esri-spinner--start",Me="esri-spinner--finish",Ee=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i){var r;return(0,p.Z)(this,n),(r=t.call(this,e,i))._animationDelay=500,r._animationPromise=null,r.location=null,r.view=null,r.viewModel=new we,r.visible=!1,r}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.own([(0,w.l)((function(){return e.visible}),(function(t){return e._visibleChange(t)}))])}},{key:"destroy",value:function(){this._animationPromise=null}},{key:"show",value:function(e){var t=this,n=e.location,i=e.promise;n&&(this.viewModel.location=n),this.visible=!0;i&&i.catch((function(){})).then((function(){return t.hide()}))}},{key:"hide",value:function(){this.visible=!1}},{key:"render",value:function(){var e,t=this.visible,n=!!this.viewModel.screenLocation,i=t&&n,r=!t&&n,a=(e={},(0,c.Z)(e,be,i),(0,c.Z)(e,Me,r),e),o=this._getPositionStyles();return(0,k.n)("div",{class:this.classes(ke,a),styles:o})}},{key:"_visibleChange",value:function(e){var t=this;if(e)this.viewModel.screenLocationEnabled=!0;else{var n=(0,g.L)(this._animationDelay);this._animationPromise=n,n.catch((function(){})).then((function(){t._animationPromise===n&&(t.viewModel.screenLocationEnabled=!1,t._animationPromise=null)}))}}},{key:"_getPositionStyles",value:function(){var e=this.viewModel,t=e.screenLocation,n=e.view;if((0,_.t)(n)||(0,_.t)(t))return{};var i=n.padding;return{left:t.x-i.left+"px",top:t.y-i.top+"px"}}}]),n}(k.O);(0,g.e)([(0,T.o)("viewModel.location")],Ee.prototype,"location",void 0),(0,g.e)([(0,T.o)("viewModel.view")],Ee.prototype,"view",void 0),(0,g.e)([(0,g.d)({type:we})],Ee.prototype,"viewModel",void 0),(0,g.e)([(0,T.o)("viewModel.visible")],Ee.prototype,"visible",void 0);for(var xe=Ee=(0,g.e)([(0,g.n)("esri.widgets.Spinner")],Ee),Te=function(){function e(t,n){var i=this;for(var r in(0,p.Z)(this,e),this.owner=n,this.properties={},this.afterDispatchHandle=null,t){var a=t[r],o=new g.ah(a,null,null,2,2);this.properties[r]={pool:o,acquired:[]}}this.afterDispatchHandle=(0,g.ai)((function(){return i._release()}))}return(0,v.Z)(e,[{key:"destroy",value:function(){for(var e in this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null),this.properties){var t,n=this.properties[e],i=(0,d.Z)(n.acquired);try{for(i.s();!(t=i.n()).done;){var r=t.value;(0,g.aj)(r)||n.pool.release(r)}}catch(a){i.e(a)}finally{i.f()}n.pool.destroy(),n.pool=null,n.acquired=null}this.properties=null,this.owner=null}},{key:"get",value:function(e){var t=this.owner._get(e),n=this.properties[e],i=n.pool.acquire();for(n.acquired.push(i);i===t;)n.acquired.push(i),i=n.pool.acquire();return i}},{key:"_release",value:function(){for(var e in this.properties){var t,n=this.properties[e],i=0,r=(0,d.Z)(n.acquired);try{for(r.s();!(t=r.n()).done;){var a=t.value;(0,g.aj)(a)?n.acquired[i++]=a:n.pool.release(a)}}catch(o){r.e(o)}finally{r.f()}n.acquired.length=i}}}]),e}(),Ce=(0,_.a)("mac")?"Meta":"Ctrl",Pe={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"},Ie=48;Ie<58;Ie++)Pe[Ie]=String.fromCharCode(Ie);for(var Ze=1;Ze<25;Ze++)Pe[111+Ze]="F".concat(Ze);for(var Ae=65;Ae<91;Ae++)Pe[Ae]=[String.fromCharCode(Ae+32),String.fromCharCode(Ae)];function Se(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}var Re=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];(0,p.Z)(this,e),this.eventType=t,this.keyModifiers=n}return(0,v.Z)(e,[{key:"matches",value:function(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;var t,n=e.modifiers,i=(0,d.Z)(this.keyModifiers);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(!n.has(r))return!1}}catch(a){i.e(a)}finally{i.f()}return!0}}]),e}(),Fe=g.s.getLogger("esri.views.input.InputHandler"),Le=function(){function e(t){(0,p.Z)(this,e),this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}return(0,v.Z)(e,[{key:"incomingEventMatches",get:function(){if(!this._incomingEventMatches)for(var e in this._incomingEventMatches=[],this._incoming){var t,n=this._incoming[e],i=(0,d.Z)(n);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._incomingEventMatches.push(r.match)}}catch(a){i.e(a)}finally{i.f()}}return this._incomingEventMatches}},{key:"incomingEventTypes",get:function(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((function(e){return e.eventType}))),this._incomingEventTypes}},{key:"outgoingEventTypes",get:function(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}},{key:"hasSideEffects",get:function(){return this._hasSideEffects}},{key:"hasPendingInputs",get:function(){return!1}},{key:"onInstall",value:function(e){var t=this;this._manager?Fe.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((function(e){return t._handleEvent(e)})),e.setUninstallCallback((function(){return t._onUninstall()})),this._manager=e)}},{key:"onUninstall",value:function(){}},{key:"registerIncoming",value:function(e,t,n){var i,r=this;"function"==typeof t?(n=t,i=[]):i=t||[];var a="string"==typeof e?new Re(e,i):e,o=function(){r._incomingEventTypes=null,r._incomingEventMatches=null},s=function(e){var t=r._incoming[e.match.eventType];if(t){var n=t.indexOf(e);t.splice(n,1),o(),r._manager&&r._manager.updateDependencies()}},u=new Oe(a,n,{onPause:s,onRemove:s,onResume:function(e){var t=r._incoming[e.match.eventType];t&&!t.includes(e)&&(t.push(e),o(),r._manager&&r._manager.updateDependencies())}}),l=this._incoming[a.eventType];return l||(l=[],this._incoming[a.eventType]=l),l.push(u),o(),this._manager&&this._manager.updateDependencies(),u}},{key:"registerOutgoing",value:function(e){var t=this;if(this._outgoing[e])throw Error("There is already a callback registered for this outgoing InputEvent: "+e);var n=new De(e,{onEmit:function(e,n,i,r){t._manager.emit(e.eventType,n,i,r)},onRemove:function(e){delete t._outgoing[e.eventType],t._manager.updateDependencies()}});return this._outgoing[e]=n,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),n}},{key:"startCapturingPointer",value:function(e){this._manager.setPointerCapture(e,!0)}},{key:"stopCapturingPointer",value:function(e){this._manager.setPointerCapture(e,!1)}},{key:"refreshHasPendingInputs",value:function(){this._manager.refreshHasPendingInputs()}},{key:"_onUninstall",value:function(){this._manager?(this.onUninstall(),this._manager=null):Fe.error("This InputHandler is not registered with an InputManager")}},{key:"_handleEvent",value:function(e){var t=this._incoming[e.type];if(t){var n,i=(0,d.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r.match.matches(e)&&(r.callback(e),e.shouldStopPropagation()))break}}catch(a){i.e(a)}finally{i.f()}}}}]),e}(),Oe=function(){function e(t,n,i){(0,p.Z)(this,e),this.match=t,this._callback=n,this._handler=i}return(0,v.Z)(e,[{key:"pause",value:function(){this._handler.onPause(this)}},{key:"resume",value:function(){this._handler.onResume(this)}},{key:"remove",value:function(){this._handler.onRemove(this)}},{key:"callback",get:function(){return this._callback}}]),e}(),De=function(){function e(t,n){(0,p.Z)(this,e),this.eventType=t,this._removed=!1,this._handler=n}return(0,v.Z)(e,[{key:"emit",value:function(e,t,n){this._removed||this._handler.onEmit(this,e,t,n)}},{key:"remove",value:function(){this._removed=!0,this._handler.onRemove(this)}}]),e}(),Ve=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,!0))._onChange=e,i._value="mouse",i._x=null,i._y=null,i.registerIncoming("pointer-move",(function(e){var t="touch"===e.data.native.pointerType;i._setValue(t?"touch":"mouse",e.data.x,e.data.y)})),i}return(0,v.Z)(n,[{key:"_setValue",value:function(e,t,n){e===this._value&&this._x===t&&this._y===n||(this._value=e,this._x=t,this._y=n,this._onChange(e,t,n))}}]),n}(Le),Ne=g.s.getLogger("esri.views.input.InputManager"),ze=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._pointerCaptures=new Map,i._nameToGroup={},i._handlers=[],i._currentPropagation=null,i._updateDependenciesAfterPropagation=!1,i._sourceEvents=new Set,i._keyModifiers=new Set,i._activeKeyModifiers=new Set,i._stoppedPropagationEventIds=new Set,i.primaryKey=Ce,i.latestPointerType="mouse",i._propertiesPool=new Te({latestPointerLocation:He},(0,l.Z)(i)),i.latestPointerLocation=null,i.test={timestamp:void 0,hasCurrentPropagation:function(){return!!i._currentPropagation}},i}return(0,v.Z)(n,[{key:"initialize",value:function(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}},{key:"destroy",value:function(){for(var e=0,t=Object.keys(this._nameToGroup);e<t.length;e++){var n=t[e];this.uninstallHandlers(n)}this.eventSource=null,this._currentPropagation=null,this._propertiesPool.destroy()}},{key:"hasPendingInputs",get:function(){return this._handlers.some((function(e){return e.handler.hasPendingInputs}))}},{key:"installHandlers",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ge.INTERNAL;if(this._nameToGroup[e])Ne.error("There is already an InputHandler group registered under the name `"+e+"`");else if(0!==t.length){var r={name:e,handlers:t.map((function(e){return{handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}}))};this._nameToGroup[e]=r;for(var a=function(e){var t=r.handlers[e];n._handlers.push(t),t.handler.onInstall({updateDependencies:function(){n.updateDependencies()},emit:function(e,i,r,a,o){n._emitInputEvent(t.priorityIndex+1,e,i,r,o,a)},setPointerCapture:function(e,i){n._setPointerCapture(r,t,e,i)},setEventCallback:function(e){t.eventCallback=e},setUninstallCallback:function(e){t.uninstallCallback=e},refreshHasPendingInputs:function(){n.notifyChange("hasPendingInputs")}})},o=r.handlers.length-1;o>=0;o--)a(o);this.updateDependencies()}else Ne.error("Can't register a group of zero handlers")}},{key:"uninstallHandlers",value:function(e){var t=this._nameToGroup[e];t?(t.handlers.forEach((function(e){e.removed=!0,e.uninstallCallback()})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):Ne.error("There is no InputHandler group registered under the name `"+e+"`")}},{key:"hasHandlers",value:function(e){return void 0!==this._nameToGroup[e]}},{key:"updateDependencies",value:function(){if(this._currentPropagation)this._updateDependenciesAfterPropagation=!0;else{this._updateDependenciesAfterPropagation=!1;var e=new Set,t=new Set;this._handlersPriority=[];for(var n=this._handlers.length-1;n>=0;n--){var i=this._handlers[n];i.priorityIndex=n,this._handlersPriority.push(i)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(var r=this._handlersPriority.length-1;r>=0;r--){var a=this._handlersPriority[r];a.priorityIndex=r;var o=a.handler.hasSideEffects;if(!o){var s,u=(0,d.Z)(a.handler.outgoingEventTypes);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(e.has(l)){o=!0;break}}}catch(g){u.e(g)}finally{u.f()}}if(o){var c,h=(0,d.Z)(a.handler.incomingEventMatches);try{for(h.s();!(c=h.n()).done;){var p=c.value;e.add(p.eventType);var v,f=(0,d.Z)(p.keyModifiers);try{for(f.s();!(v=f.n()).done;){var y=v.value;Se(y)||t.add(y)}}catch(g){f.e(g)}finally{f.f()}}}catch(g){h.e(g)}finally{h.f()}}a.active=o}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}}},{key:"_setLatestPointer",value:function(e,t,n){this._get("latestPointerType")!==e&&this._set("latestPointerType",e);var i=this._get("latestPointerLocation");if((0,_.t)(i)||i.x!==t||i.y!==n){var r=this._propertiesPool.get("latestPointerLocation");r.x=t,r.y=n,this._set("latestPointerLocation",r)}}},{key:"_onEventReceived",value:function(e,t){if("pointer-capture-lost"===e){var n=t;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,t);var i=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}},{key:"_updateKeyModifiers",value:function(e,t){var n=this;if(t){var i=!1,r=function(){if(!i){var e=new Set;n._activeKeyModifiers.forEach((function(t){e.add(t)})),n._activeKeyModifiers=e,i=!0}},a=function(e,t){t&&!n._activeKeyModifiers.has(e)?(r(),n._activeKeyModifiers.add(e)):!t&&n._activeKeyModifiers.has(e)&&(r(),n._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){var o=t.key;this._keyModifiers.has(o)&&a(o,"key-down"===e)}var s=t.native;a("Alt",!(!s||!s.altKey)),a("Ctrl",!(!s||!s.ctrlKey)),a("Shift",!(!s||!s.shiftKey)),a("Meta",!(!s||!s.metaKey)),a("Primary",this._activeKeyModifiers.has(this.primaryKey))}}},{key:"_installRecognizers",value:function(){var e=this;this._latestPointerHandler=new Ve((function(t,n,i){return e._setLatestPointer(t,n,i)})),this.installHandlers("input-manager-logic",[this._latestPointerHandler],Ge.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Ge.INTERNAL)}},{key:"_setPointerCapture",value:function(e,t,n,i){var r=e.name+"-"+t.priorityIndex,a=this._pointerCaptures.get(n.pointerId)||new Set;this._pointerCaptures.set(n.pointerId,a),i?(a.add(r),1===a.size&&this.eventSource&&this.eventSource.setPointerCapture(n,!0)):a.has(r)&&(a.delete(r),0===a.size&&(this._pointerCaptures.delete(n.pointerId),this.eventSource&&this.eventSource.setPointerCapture(n,!1)))}},{key:"_garbageCollectRemovedHandlers",value:function(){this._handlers=this._handlers.filter((function(e){return!e.removed})),this.updateDependencies()}},{key:"_emitInputEventFromSource",value:function(e,t,n,i){this._emitInputEvent(0,e,t,n,i)}},{key:"_emitInputEvent",value:function(e,t,n,i,r,a){var o=void 0!==i?i:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),s=void 0!==r&&r,u={event:new Be(t,n,o,a||this._activeKeyModifiers,s),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(u):this._doNewPropagation(u)}},{key:"_doNewPropagation",value:function(e){this._currentPropagation={events:new q.e,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}},{key:"_continuePropagation",value:function(){var e=this,t=this._currentPropagation;if(t){for(;this._currentPropagation.events.length>0;){var n=this._currentPropagation.events.pop(),i=n.event,r=n.priorityIndex,a=i.data&&i.data.eventId;if(null==a||!this._stoppedPropagationEventIds.has(a))for(t.currentHandler=this._handlersPriority[r];t.currentHandler;){if(t.currentHandler.removed)t.needsHandlerGarbageCollect=!0;else{if(t.currentHandler.active&&!i.shouldStopPropagation()&&t.currentHandler.eventCallback(i),i.shouldStopPropagation()){null!=a&&this._stoppedPropagationEventIds.add(a);break}if(i.shouldPausePropagation((function(){return e._continuePropagation()})))return void this._pausePropagation({event:i,priorityIndex:t.currentHandler.priorityIndex+1})}t.currentHandler=this._handlersPriority[t.currentHandler.priorityIndex+1]}}t.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}},{key:"_pausePropagation",value:function(e){var t=new q.e;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}},{key:"_compareHandlerPriority",value:function(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;var n,i=(0,d.Z)(e.handler.incomingEventMatches);try{for(i.s();!(n=i.n()).done;){var r,a=n.value,o=(0,d.Z)(t.handler.incomingEventMatches);try{var s=function(){var e=r.value;if(a.eventType!==e.eventType)return"continue";var t=a.keyModifiers.filter((function(t){return e.keyModifiers.includes(t)}));return t.length===a.keyModifiers.length!==(t.length===e.keyModifiers.length)?{v:a.keyModifiers.length>e.keyModifiers.length?-1:1}:void 0};for(o.s();!(r=o.n()).done;){var u=s();if("continue"!==u&&"object"===typeof u)return u.v}}catch(l){o.e(l)}finally{o.f()}}}catch(l){i.e(l)}finally{i.f()}return e.priorityIndex>t.priorityIndex?-1:1}},{key:"_sortHandlersPriority",value:function(e){var t,n=[],i=(0,d.Z)(e);try{for(i.s();!(t=i.n()).done;){for(var r=t.value,a=0;a<n.length&&this._compareHandlerPriority(r,n[a])>=0;)a++;n.splice(a,0,r)}}catch(o){i.e(o)}finally{i.f()}return n}},{key:"debug",get:function(){var e=this,t=function(t){var n=e._setPointerCapture;e._setPointerCapture=function(){},t(),e._setPointerCapture=n};return{injectEvent:function(n,i){t((function(){e._onEventReceived(n,i)}))},disablePointerCapture:t}}}]),n}(g.y);(0,g.e)([(0,g.d)({readOnly:!0})],ze.prototype,"hasPendingInputs",null),(0,g.e)([(0,g.d)()],ze.prototype,"eventSource",void 0),(0,g.e)([(0,g.d)()],ze.prototype,"recognizers",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],ze.prototype,"latestPointerType",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],ze.prototype,"latestPointerLocation",void 0),ze=(0,g.e)([(0,g.n)("esri.views.input.InputManager")],ze);var Ue,Be=function(){function e(t,n,i,r,a){(0,p.Z)(this,e),this.type=t,this.data=n,this.timestamp=i,this.modifiers=r,this.cancelable=a,this._propagationState=Ue.NONE,this._resumeCallback=null}return(0,v.Z)(e,[{key:"stopPropagation",value:function(){this._propagationState|=Ue.STOPPED}},{key:"shouldStopPropagation",value:function(){return 0!=(this._propagationState&Ue.STOPPED)}},{key:"async",value:function(e){var t=this;this._propagationState|=Ue.PAUSED;var n=function(e,n){t._propagationState&=~Ue.PAUSED;var i=t._resumeCallback;if(t._resumeCallback=null,i&&i(),n)throw e;return e};return("function"==typeof e?e():e).then((function(e){return n(e,!1)}),(function(e){return n(e,!0)}))}},{key:"shouldPausePropagation",value:function(e){return!!(this._propagationState&Ue.PAUSED)&&(this._resumeCallback=e,!0)}},{key:"preventDefault",value:function(){this.data.native.preventDefault()}}]),e}();!function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"}(Ue||(Ue={}));var Ge={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3},He=(0,v.Z)((function e(){(0,p.Z)(this,e)})),je="esri-icon-zoom-in-magnifying-glass",We="esri-icon-trash",qe="esri-icon-table",Ke=new A.a({id:"zoom-to-feature",title:"{messages.zoom}",className:je}),Qe=new A.a({id:"remove-selected-feature",title:"{messages.remove}",className:We}),Ye=new A.a({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:je}),Xe=new A.a({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:qe}),Je=g.s.getLogger("esri.widgets.Popup.PopupViewModel"),$e=function(e){var t=e.event,n=e.view,i=t.action,r=n&&n.popup;if(!i)return Promise.reject(new g.a("trigger-action:missing-arguments","Event has no action"));if(!r)return Promise.reject(new g.a("trigger-action:missing-arguments","view.popup is missing"));var a=i.disabled,o=i.id;if(!o)return Promise.reject(new g.a("trigger-action:invalid-action","action.id is missing"));if(a)return Promise.reject(new g.a("trigger-action:invalid-action","Action is disabled"));if(o===Ke.id)return function(e){return it.apply(this,arguments)}(r.viewModel).catch(g.l);if(o===Ye.id)return function(e){return rt.apply(this,arguments)}(r.viewModel);if(o===Xe.id)return r.featureMenuOpen=!r.featureMenuOpen,r.viewModel.browseClusterEnabled=!r.viewModel.browseClusterEnabled,Promise.resolve();if(r.viewModel.browseClusterEnabled=!1,o===Qe.id){r.close();var s=r.selectedFeature;if(!s)return Promise.reject(new g.a("trigger-action:".concat(Qe.id),"selectedFeature is required",{selectedFeature:s}));var u=s.sourceLayer;return u?u.remove(s):n.graphics.remove(s),Promise.resolve()}return Promise.resolve()};function et(e){var t=e.selectedFeature,n=e.location,i=e.view;return i?"3d"===i.type?t||n:e.get("selectedFeature.geometry")||n:null}function tt(e){var t,n;return(null===e||void 0===e?void 0:e.isAggregate)&&"cluster"===(null===e||void 0===e||null===(t=e.sourceLayer)||void 0===t||null===(n=t.featureReduction)||void 0===n?void 0:n.type)}function nt(e,t){if("3d"!==(null===t||void 0===t?void 0:t.type)||!e||"esri.Graphic"!==e.declaredClass)return!0;var n=t.getViewForGraphic(e);if(n&&"whenGraphicBounds"in n){var i=!1;return n.whenGraphicBounds(e,{useViewElevation:!0}).then((function(e){i=!e||!e.boundingBox||e.boundingBox[0]===e.boundingBox[3]&&e.boundingBox[1]===e.boundingBox[4]&&e.boundingBox[2]===e.boundingBox[5]})).catch((function(){var t=new g.a("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});Je.error(t)})),i}return!0}function it(){return it=(0,u.Z)((0,s.Z)().mark((function e(t){var n,i,r,a,o,u,l,c,d;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.location,i=t.selectedFeature,r=t.view,a=t.zoomFactor,o=et(t)){e.next=4;break}throw u=new g.a("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:o,view:r}),Je.error(u),u;case 4:return l=r.scale/a,c=t.get("selectedFeature.geometry")||n,d=c&&"point"===c.type&&nt(i,r),Ke.active=!0,Ke.disabled=!0,e.prev=6,e.next=9,t.view.goTo({target:o,scale:d?l:void 0});case 9:return e.prev=9,Ke.active=!1,Ke.disabled=!1,t.zoomToLocation=null,d&&(t.location=c),e.finish(9);case 12:case"end":return e.stop()}}),e,null,[[6,,9,12]])}))),it.apply(this,arguments)}function rt(){return rt=(0,u.Z)((0,s.Z)().mark((function e(t){var n,i,r,a,o,u,l,c,d;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selectedFeature,"2d"===(null===(i=t.view)||void 0===i?void 0:i.type)){e.next=4;break}throw r=new g.a("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i}),Je.error(r),r;case 4:if(tt(n)){e.next=7;break}throw a=new g.a("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:n}),Je.error(a),a;case 7:return o=n.sourceLayer,e.next=10,i.whenLayerView(o);case 10:return u=e.sent,(l=u.createQuery()).aggregateIds=[n.getObjectId()],Ye.active=!0,Ye.disabled=!0,e.next=15,u.queryExtent(l);case 15:return c=e.sent,d=c.extent,e.next=19,i.goTo({target:d});case 19:Ye.active=!1,Ye.disabled=!1;case 21:case"end":return e.stop()}}),e)}))),rt.apply(this,arguments)}function at(e){return ot.apply(this,arguments)}function ot(){return ot=(0,u.Z)((0,s.Z)().mark((function e(t){var n,i,r,a,o,u,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.selectedFeature,i=t.view,r=n.sourceLayer,e.next=5,i.whenLayerView(r);case 5:return a=e.sent,(o=a.createQuery()).aggregateIds=[n.getObjectId()],e.next=10,a.queryExtent(o);case 10:u=e.sent,l=u.extent,t.selectedClusterBoundaryFeature.geometry=l,i.graphics.add(t.selectedClusterBoundaryFeature);case 13:case"end":return e.stop()}}),e)}))),ot.apply(this,arguments)}function st(e){return ut.apply(this,arguments)}function ut(){return ut=(0,u.Z)((0,s.Z)().mark((function e(t){var n,i,r,a,o,u,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.selectedFeature,i=t.view,r=n.sourceLayer,e.next=5,i.whenLayerView(r);case 5:return a=e.sent,(o=a.createQuery()).aggregateIds=[n.getObjectId()],Xe.active=!0,Xe.disabled=!0,e.next=10,a.queryFeatures(o);case 10:u=e.sent,l=u.features,Xe.active=!1,Xe.disabled=!1,i.popup.open({features:[n].concat(l),featureMenuOpen:!0});case 13:case"end":return e.stop()}}),e)}))),ut.apply(this,arguments)}var lt=b.j.ofType({key:"type",defaultKeyValue:"button",base:A.c,typeMap:{button:A.a,toggle:A.b}}),ct="esri.widgets.Popup.PopupViewModel",dt=g.s.getLogger(ct),ht=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._handles=new m.u,i._pendingPromises=new Set,i._fetchFeaturesController=null,i._selectedClusterFeature=null,i.featurePage=null,i.actions=new lt,i.activeFeature=null,i.defaultPopupTemplateEnabled=!1,i.autoCloseEnabled=!1,i.autoOpenEnabled=!0,i.browseClusterEnabled=!1,i.content=null,i.featuresPerPage=20,i.featureViewModelAbilities=null,i.featureViewModels=[],i.highlightEnabled=!0,i.includeDefaultActions=!0,i.selectedClusterBoundaryFeature=new C.g({symbol:new P.S({outline:{width:1.5,color:"cyan"},style:"none"})}),i.title=null,i.updateLocationEnabled=!1,i.view=null,i.visible=!1,i.zoomFactor=4,i.zoomToLocation=null,i}return(0,v.Z)(n,[{key:"isLoadingFeature",get:function(){return this.featureViewModels.some((function(e){return e.waitingForContent}))}},{key:"initialize",value:function(){var e=this;this._handles.add([(0,w.l)((function(){return[e.autoOpenEnabled,e.view]}),(function(){return e._autoOpenEnabledChange()})),this.on("view-change",(function(){return e._autoClose()})),(0,w.l)((function(){return[e.highlightEnabled,e.selectedFeature,e.visible,e.view]}),(function(){return e._highlightSelectedFeature()})),(0,w.l)((function(){return[e.highlightEnabled,e.activeFeature,e.visible,e.view]}),(function(){return e._highlightActiveFeature()})),(0,w.l)((function(){var t,n;return null===(t=e.view)||void 0===t||null===(n=t.animation)||void 0===n?void 0:n.state}),(function(t){return e._animationStateChange(t)})),(0,w.l)((function(){return e.location}),(function(t){return e._locationChange(t)})),(0,w.l)((function(){return e.selectedFeature}),(function(t){return e._selectedFeatureChange(t)})),(0,w.l)((function(){return[e.selectedFeatureIndex,e.featureCount,e.featuresPerPage]}),(function(){return e._selectedFeatureIndexChange()})),(0,w.l)((function(){return[e.featurePage,e.selectedFeatureIndex,e.featureCount,e.featuresPerPage,e.featureViewModels]}),(function(){return e._setGraphicOnFeatureViewModels()})),(0,w.l)((function(){return e.featureViewModels}),(function(){return e._featureViewModelsChange()})),this.on("trigger-action",(function(t){return $e({event:t,view:e.view})})),(0,w.f)((function(){return!e.waitingForResult}),(function(){return e._waitingForResultChange()}),w.U),(0,w.l)((function(){var t,n;return[e.features,null===(t=e.view)||void 0===t?void 0:t.map,null===(n=e.view)||void 0===n?void 0:n.spatialReference]}),(function(){return e._updateFeatureVMs()})),(0,w.l)((function(){var t;return null===(t=e.view)||void 0===t?void 0:t.scale}),(function(){return e._viewScaleChange()})),(0,w.f)((function(){return!e.visible}),(function(){return e.browseClusterEnabled=!1})),(0,w.l)((function(){return e.browseClusterEnabled}),(function(t){return t?e.enableClusterBrowsing():e.disableClusterBrowsing()}))])}},{key:"destroy",value:function(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}},{key:"active",get:function(){return!(!this.visible||this.waitingForResult)}},{key:"allActions",get:function(){var e=this._get("allActions")||new lt;e.removeAll();var t=this.actions,n=this.defaultActions,i=this.defaultPopupTemplateEnabled,r=this.includeDefaultActions,a=this.selectedFeature,o=r?n.concat(t):t,s=a&&("function"==typeof a.getEffectivePopupTemplate&&a.getEffectivePopupTemplate(i)||a.popupTemplate),u=s&&s.actions,l=s&&s.overwriteActions?u:u?u.concat(o):o;return l&&l.filter(Boolean).forEach((function(t){return e.add(t)})),e}},{key:"defaultActions",get:function(){var e=this._get("defaultActions")||new lt;return e.removeAll(),e.addMany(tt(this.selectedFeature)?[Ye.clone(),Xe.clone()]:[Ke.clone()]),e}},{key:"featureCount",get:function(){return this.features.length}},{key:"features",get:function(){return this._get("features")||[]},set:function(e){var t=e||[];this._set("features",t);var n=this.pendingPromisesCount,i=this.promiseCount,r=this.selectedFeatureIndex,a=i&&t.length;a&&n&&-1===r?this.selectedFeatureIndex=0:a&&-1!==r||(this.selectedFeatureIndex=t.length?0:-1)}},{key:"location",get:function(){return this._get("location")||null},set:function(e){var t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=(0,I.R)(e)),this._set("location",e)}},{key:"pendingPromisesCount",get:function(){return this._pendingPromises.size}},{key:"waitingForResult",get:function(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}},{key:"promiseCount",get:function(){return this.promises.length}},{key:"promises",get:function(){return this._get("promises")||[]},set:function(e){var t=this;if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((function(e){t._pendingPromises.add(e);e.then((function(n){t._pendingPromises.has(e)&&t._updateFeatures(n),t._updatePendingPromises(e)}),(function(){return t._updatePendingPromises(e)}))})),this.notifyChange("pendingPromisesCount")}},{key:"selectedFeature",get:function(){var e=this.features,t=this.selectedFeatureIndex;return-1===t?null:e[t]||null}},{key:"selectedFeatureIndex",get:function(){var e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1},set:function(e){var t=this.featureCount;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}},{key:"selectedFeatureViewModel",get:function(){return this.featureViewModels[this.selectedFeatureIndex]||null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"centerAtLocation",value:function(){var e=this.view,t=et(this);if(!t){var n=new g.a("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return dt.error(n),Promise.reject(n)}return this.callGoTo({target:{target:t,scale:e.scale}})}},{key:"clear",value:function(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}},{key:"fetchFeatures",value:function(e,t){var n=this.view;if(!n||!e){var i=new g.a("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:n});return dt.error(i),Promise.reject(i)}return n.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}},{key:"open",value:function(e){var t=(0,h.Z)((0,h.Z)({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{},{visible:!0}),n=t.fetchFeatures;delete t.fetchFeatures,n&&this._setFetchFeaturesPromises(t.location);for(var i=0,r=["actionsMenuOpen","collapsed","featureMenuOpen"];i<r.length;i++){delete t[r[i]]}this.set(t)}},{key:"triggerAction",value:function(e){var t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}},{key:"next",value:function(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}},{key:"previous",value:function(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}},{key:"disableClusterBrowsing",value:function(){(function(e){var t=e.features.filter((function(e){return tt(e)}));t.length&&(e.features=t)})(this),this._clearBrowsedClusterGraphics()}},{key:"enableClusterBrowsing",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.view,n=this.selectedFeature,"2d"!==(null===t||void 0===t?void 0:t.type)){e.next=12;break}if(!tt(n)){e.next=9;break}return e.next=5,at(this);case 5:return e.next=7,st(this);case 7:e.next=10;break;case 9:dt.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",n);case 10:e.next=13;break;case 12:dt.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_animationStateChange",value:function(e){this.zoomToLocation||(Ke.disabled="waiting-for-target"===e)}},{key:"_clearBrowsedClusterGraphics",value:function(){var e,t=null===(e=this.view)||void 0===e?void 0:e.graphics;t&&(t.remove(this.selectedClusterBoundaryFeature),t.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}},{key:"_viewScaleChange",value:function(){if(tt(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}},{key:"_locationChange",value:function(e){var t=this.selectedFeature;this.updateLocationEnabled&&e&&(!t||t.geometry)&&this.centerAtLocation()}},{key:"_selectedFeatureIndexChange",value:function(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}},{key:"_featureViewModelsChange",value:function(){this.featurePage=this.featureCount>1?1:null}},{key:"_setGraphicOnFeatureViewModels",value:function(){var e=this.features,t=this.featureCount,n=this.featurePage,i=this.featuresPerPage,r=this.featureViewModels;if(null!==n){var a=((n-1)*i+t)%t,o=a+i;r.slice(a,o).forEach((function(t,n){t&&!t.graphic&&(t.graphic=e[a+n])}))}}},{key:"_selectedFeatureChange",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n,i,r,a=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(n=this.location,i=this.updateLocationEnabled,r=this.view,!this.browseClusterEnabled){e.next=11;break}if(this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),!tt(t)){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,(0,S.x)(t);case 8:return t.symbol=e.sent,this._selectedClusterFeature=t,e.abrupt("return",void r.graphics.add(this._selectedClusterFeature));case 11:!i&&n||!t.geometry?i&&!t.geometry&&this.centerAtLocation().then((function(){a.location=r.center.clone()})):this.location=(0,_.e)(this._getPointFromGeometry(t.geometry));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_waitingForResultChange",value:function(){!this.featureCount&&this.promises&&(this.visible=!1)}},{key:"_setFetchFeaturesPromises",value:function(e){var t=this;return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then((function(e){var n=e.clientOnlyGraphics,i=e.promisesPerLayerView,r=Promise.resolve(n),a=i.map((function(e){return e.promise}));t.promises=[r].concat((0,o.Z)(a))}))}},{key:"_destroyFeatureVMs",value:function(){this.featureViewModels.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureViewModels",[])}},{key:"_updateFeatureVMs",value:function(){var e=this,t=this.selectedFeature,n=this.features,i=this.featureViewModels;if(tt(t)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),n&&n.length){var r=i.slice(0),a=[];n.forEach((function(n,i){if(n){var o=null;if(r.some((function(e,t){return e&&e.graphic===n&&(o=e,r.splice(t,1)),!!o})),o)a[i]=o;else{var s,u,l=new x.J({abilities:e.featureViewModelAbilities,defaultPopupTemplateEnabled:e.defaultPopupTemplateEnabled,spatialReference:null===(s=e.view)||void 0===s?void 0:s.spatialReference,graphic:n===t?n:null,map:null===(u=e.view)||void 0===u?void 0:u.map,view:e.view});a[i]=l}}})),r.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureViewModels",a)}}},{key:"_getScreenPoint",value:function(e){var t=this.view;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}},{key:"_autoOpenEnabledChange",value:function(){var e=this,t="auto-fetch-features",n=this._handles,i=this.autoOpenEnabled;if(n.remove(t),i&&this.view){var r=this.view.on("click",(function(t){"mouse"===t.pointerType&&0!==t.button||e._fetchFeaturesAndOpen(t)}),Ge.WIDGET);n.add(r,t)}}},{key:"_cancelFetchingFeatures",value:function(){var e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}},{key:"_fetchFeaturesWithController",value:function(e,t){var n=this;this._cancelFetchingFeatures();var i=new AbortController,r=i.signal;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");var a=this.fetchFeatures(e,{signal:r,event:t});return a.catch((function(){})).then((function(){n._fetchFeaturesController=null,n.notifyChange("waitingForResult")})),a}},{key:"_fetchFeaturesAndOpen",value:function(e){var t=e.screenPoint,n=e.mapPoint,i=this.view;this._fetchFeaturesWithController(t,e).then((function(e){var t=e.clientOnlyGraphics,r=e.promisesPerLayerView,a=e.location,s=[Promise.resolve(t)].concat((0,o.Z)(r.map((function(e){return e.promise}))));return i.popup.open({location:a||n,promises:s}),e}))}},{key:"_updatePendingPromises",value:function(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}},{key:"_autoClose",value:function(){this.autoCloseEnabled&&(this.visible=!1)}},{key:"_getPointFromGeometry",value:function(e){return(0,_.t)(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?e.extent.center:null}},{key:"_getLayerView",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.when();case 2:return e.abrupt("return",t.whenLayerView(n));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getHighlightLayer",value:function(e){var t=e.layer,n=e.sourceLayer;return"map-notes"===(null===n||void 0===n?void 0:n.type)||"subtype-group"===(null===n||void 0===n?void 0:n.type)?n:t}},{key:"_getHighlightTarget",value:function(e,t){var n="imagery"===t.type?void 0:"objectIdField"in t&&t.objectIdField,i=e.attributes;return i&&n&&i[n]||e}},{key:"_highlightActiveFeature",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n,i,r,a,o,u,l,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="highlight-active-feature",this._handles.remove(t),n=this.highlightEnabled,i=this.view,r=this.activeFeature,a=this.visible,r&&i&&n&&a){e.next=5;break}return e.abrupt("return");case 5:if((o=this._getHighlightLayer(r))&&o instanceof Z.b){e.next=8;break}return e.abrupt("return");case 8:return u=this._getLayerView(i,o),this._highlightActiveFeaturePromise=u,e.next=12,u;case 12:if((l=e.sent)&&(0,R.a)(l)&&this._highlightActiveFeaturePromise===u&&this.activeFeature&&this.highlightEnabled){e.next=15;break}return e.abrupt("return");case 15:c=l.highlight(this._getHighlightTarget(r,o)),this._handles.add(c,t);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_highlightSelectedFeature",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n,i,r,a,o,u,l,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="highlight-selected-feature",this._handles.remove(t),n=this.selectedFeature,i=this.highlightEnabled,r=this.view,a=this.visible,n&&r&&i&&a){e.next=5;break}return e.abrupt("return");case 5:if((o=this._getHighlightLayer(n))&&o instanceof Z.b){e.next=8;break}return e.abrupt("return");case 8:return u=this._getLayerView(r,o),this._highlightSelectedFeaturePromise=u,e.next=12,u;case 12:if((l=e.sent)&&(0,R.a)(l)&&this._highlightSelectedFeaturePromise===u&&this.selectedFeature&&this.highlightEnabled&&this.visible){e.next=15;break}return e.abrupt("return");case 15:c=l.highlight(this._getHighlightTarget(n,o)),this._handles.add(c,t);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_updateFeatures",value:function(e){var t=this.features;if(e&&e.length)if(t.length){var n=e.filter((function(e){return!t.includes(e)}));this.features=t.concat(n)}else this.features=e}}]),n}((0,R.e)(me));(0,g.e)([(0,g.d)()],ht.prototype,"featurePage",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"isLoadingFeature",null),(0,g.e)([(0,g.d)({type:lt})],ht.prototype,"actions",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],ht.prototype,"active",null),(0,g.e)([(0,g.d)()],ht.prototype,"activeFeature",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],ht.prototype,"allActions",null),(0,g.e)([(0,g.d)({type:Boolean})],ht.prototype,"defaultPopupTemplateEnabled",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"autoCloseEnabled",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"autoOpenEnabled",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"browseClusterEnabled",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"content",void 0),(0,g.e)([(0,g.d)({type:lt,readOnly:!0})],ht.prototype,"defaultActions",null),(0,g.e)([(0,g.d)({readOnly:!0})],ht.prototype,"featureCount",null),(0,g.e)([(0,g.d)()],ht.prototype,"features",null),(0,g.e)([(0,g.d)()],ht.prototype,"featuresPerPage",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"featureViewModelAbilities",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],ht.prototype,"featureViewModels",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"highlightEnabled",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"includeDefaultActions",void 0),(0,g.e)([(0,g.d)({type:I.j})],ht.prototype,"location",null),(0,g.e)([(0,g.d)({readOnly:!0})],ht.prototype,"pendingPromisesCount",null),(0,g.e)([(0,g.d)({readOnly:!0})],ht.prototype,"selectedClusterBoundaryFeature",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],ht.prototype,"waitingForResult",null),(0,g.e)([(0,g.d)({readOnly:!0})],ht.prototype,"promiseCount",null),(0,g.e)([(0,g.d)()],ht.prototype,"promises",null),(0,g.e)([(0,g.d)({value:null,readOnly:!0})],ht.prototype,"selectedFeature",null),(0,g.e)([(0,g.d)({value:-1})],ht.prototype,"selectedFeatureIndex",null),(0,g.e)([(0,g.d)({readOnly:!0})],ht.prototype,"selectedFeatureViewModel",null),(0,g.e)([(0,g.d)({readOnly:!0})],ht.prototype,"state",null),(0,g.e)([(0,g.d)()],ht.prototype,"title",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"updateLocationEnabled",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"view",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"visible",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"zoomFactor",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"zoomToLocation",void 0),(0,g.e)([(0,g.d)()],ht.prototype,"centerAtLocation",null);var pt=ht=(0,g.e)([(0,g.n)(ct)],ht),vt="selected-index",ft="popup-spinner",yt="esri-icon-left-triangle-arrow",gt="esri-icon-right-triangle-arrow",mt="esri-icon-maximize",_t="esri-icon-dock-bottom",wt="esri-icon-dock-left",kt="esri-icon-dock-right",bt="esri-icon-close",Mt="esri-icon-minimize",Et="esri-icon-check-mark",xt="esri-icon-loading-indicator",Tt="esri-icon-default-action",Ct="esri-icon-handle-horizontal",Pt="esri-rotating",It="esri-popup",Zt="esri-widget",At="esri-popup__main-container",St="esri-popup__loading-container",Rt="esri-popup--is-collapsible",Ft="esri-popup--is-collapsed",Lt="esri-popup--shadow",Ot="esri-popup--is-docked",Dt="esri-popup--is-docked-top-left",Vt="esri-popup--is-docked-top-center",Nt="esri-popup--is-docked-top-right",zt="esri-popup--is-docked-bottom-left",Ut="esri-popup--is-docked-bottom-center",Bt="esri-popup--is-docked-bottom-right",Gt="esri-popup--aligned-top-center",Ht="esri-popup--aligned-bottom-center",jt="esri-popup--aligned-top-left",Wt="esri-popup--aligned-bottom-left",qt="esri-popup--aligned-top-right",Kt="esri-popup--aligned-bottom-right",Qt="esri-popup--feature-menu-open",Yt="esri-popup--actions-menu-open",Xt="esri-popup--feature-updated",Jt="esri-popup__header",$t="esri-popup__header-buttons",en="esri-popup__header-container",tn="esri-popup__header-container--button",nn="esri-popup__header-title",rn="esri-popup__content",an="esri-popup__footer",on="esri-popup__footer--has-pagination",sn="esri-popup__footer--has-actions",un="esri-popup__footer--has-actions-menu",ln="esri-popup__button",cn="esri-popup__button--disabled",dn="esri-popup__button--dock",hn="esri-popup__icon",pn="esri-popup__icon--dock-icon",vn="esri-popup__inline-actions-container",fn="esri-popup__actions-menu-button",yn="esri-popup__actions",gn="esri-popup__action",mn="esri-popup__action-image",_n="esri-popup__action-text",wn="esri-popup__action-toggle",kn="esri-popup__action-toggle--on",bn="esri-popup__pointer",Mn="esri-popup__pointer-direction",En="esri-popup__navigation",xn="esri-popup__pagination-previous",Tn="esri-popup__pagination-next",Cn="esri-popup__pagination-previous-icon",Pn="esri-popup__pagination-previous-icon--rtl",In="esri-popup__pagination-next-icon",Zn="esri-popup__pagination-next-icon--rtl",An="esri-popup__feature-menu",Sn="esri-popup__feature-menu-list",Rn="esri-popup__feature-menu-item",Fn="esri-popup__feature-menu-viewport",Ln="esri-popup__feature-menu-header",On="esri-popup__feature-menu-item--selected",Dn="esri-popup__feature-menu-button",Vn="esri-popup__feature-menu-title",Nn="esri-popup__feature-menu-observer",zn="esri-popup__feature-menu-loader",Un={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Bn="esri-popup";function Gn(e,t){return void 0===t?"".concat(Bn,"__").concat(e):"".concat(Bn,"__").concat(e,"-").concat(t)}var Hn="esri.widgets.Popup",jn=g.s.getLogger(Hn),Wn={closeButton:!0,featureNavigation:!0},qn=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i){var r;return(0,p.Z)(this,n),(r=t.call(this,e,i))._blurClose=!1,r._blurContainer=!1,r._containerNode=null,r._mainContainerNode=null,r._featureMenuNode=null,r._actionsMenuNode=null,r._focusClose=!1,r._focusContainer=!1,r._focusDockButton=!1,r._focusFeatureMenuButton=!1,r._focusActionsMenuButton=!1,r._focusFirstFeature=!1,r._focusFirstAction=!1,r._handles=new m.u,r._pointerOffsetInPx=16,r._spinner=null,r._feature=null,r._featureMenuIntersectionObserverCallback=function(e){var t=(0,a.Z)(e,1)[0];(null===t||void 0===t?void 0:t.isIntersecting)&&r.viewModel.featurePage++},r._featureMenuIntersectionObserver=new IntersectionObserver(r._featureMenuIntersectionObserverCallback,{root:window.document}),r._displaySpinnerThrottled=(0,x.e)((function(){return r._displaySpinner()}),0),r.actions=null,r.alignment="auto",r.autoCloseEnabled=null,r.autoOpenEnabled=null,r.defaultPopupTemplateEnabled=null,r.content=null,r.collapsed=!1,r.collapseEnabled=!0,r.dockEnabled=!1,r.featureCount=null,r.featureMenuOpen=!1,r.features=null,r.goToOverride=null,r.headingLevel=2,r.highlightEnabled=null,r.location=null,r.label=void 0,r.maxInlineActions=3,r.messages=null,r.messagesCommon=null,r.promises=null,r.selectedFeature=null,r.selectedFeatureIndex=null,r.spinnerEnabled=!0,r.title=null,r.updateLocationEnabled=null,r.view=null,r.viewModel=new pt,r.visible=null,r.visibleElements=(0,h.Z)({},Wn),r._addSelectedFeatureIndexHandle(),r.own([(0,w.l)((function(){var e;return null===(e=r.viewModel)||void 0===e?void 0:e.screenLocation}),(function(){return r._positionContainer()})),(0,w.l)((function(){var e;return[null===(e=r.viewModel)||void 0===e?void 0:e.active,r.dockEnabled]}),(function(){return r._toggleScreenLocationEnabled()})),(0,w.l)((function(){var e;return null===(e=r.viewModel)||void 0===e?void 0:e.screenLocation}),(function(e,t){!!e!=!!t&&r.reposition()})),(0,w.l)((function(){var e,t,n,i,a,o;return[null===(e=r.viewModel)||void 0===e||null===(t=e.view)||void 0===t?void 0:t.padding,null===(n=r.viewModel)||void 0===n||null===(i=n.view)||void 0===i?void 0:i.size,null===(a=r.viewModel)||void 0===a?void 0:a.active,null===(o=r.viewModel)||void 0===o?void 0:o.location,r.alignment]}),(function(){return r.reposition()})),(0,w.l)((function(){return r.spinnerEnabled}),(function(e){return r._spinnerEnabledChange(e)})),(0,w.l)((function(){var e,t;return null===(e=r.viewModel)||void 0===e||null===(t=e.view)||void 0===t?void 0:t.size}),(function(e,t){return r._updateDockEnabledForViewSize(e,t)})),(0,w.l)((function(){var e;return null===(e=r.viewModel)||void 0===e?void 0:e.view}),(function(e,t){return r._viewChange(e,t)})),(0,w.l)((function(){var e,t;return null===(e=r.viewModel)||void 0===e||null===(t=e.view)||void 0===t?void 0:t.ready}),(function(e,t){return r._viewReadyChange(e,t)})),(0,w.l)((function(){var e,t;return[null===(e=r.viewModel)||void 0===e?void 0:e.waitingForResult,null===(t=r.viewModel)||void 0===t?void 0:t.location]}),(function(){r._hideSpinner(),r._displaySpinnerThrottled()})),(0,w.l)((function(){var e,t,n,i;return[null===(e=r.selectedFeatureWidget)||void 0===e||null===(t=e.viewModel)||void 0===t?void 0:t.title,null===(n=r.selectedFeatureWidget)||void 0===n||null===(i=n.viewModel)||void 0===i?void 0:i.state]}),(function(){return r._setTitleFromFeatureWidget()})),(0,w.l)((function(){var e,t,n,i;return[null===(e=r.selectedFeatureWidget)||void 0===e||null===(t=e.viewModel)||void 0===t?void 0:t.content,null===(n=r.selectedFeatureWidget)||void 0===n||null===(i=n.viewModel)||void 0===i?void 0:i.state]}),(function(){return r._setContentFromFeatureWidget()})),(0,w.f)((function(){return!r.collapsed}),(function(){var e,t;"xsmall"===(null===(e=r.viewModel)||void 0===e||null===(t=e.view)||void 0===t?void 0:t.widthBreakpoint)&&r.viewModel.active&&r.collapseEnabled&&r.viewModel.centerAtLocation()})),(0,w.a)((function(){var e;return null===(e=r.viewModel)||void 0===e?void 0:e.allActions}),"change",(function(){return r._watchActions()})),(0,w.l)((function(){var e;return null===(e=r.viewModel)||void 0===e?void 0:e.allActions}),(function(){return r._watchActions()}),w.h),(0,w.l)((function(){var e;return null===(e=r.viewModel)||void 0===e?void 0:e.featureViewModels}),(function(){return r._featureMenuViewportScrollTop()}))]),r}return(0,v.Z)(n,[{key:"destroy",value:function(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),null!==(e=this._handles)&&void 0!==e&&e.destroy(),this._unobserveFeatureMenuObserver(),null!==(t=this._featureMenuIntersectionObserver)&&void 0!==t&&t.disconnect(),this._handles=null}},{key:"actionsMenuId",get:function(){return"".concat(this.id,"-actions-menu")}},{key:"actionsMenuButtonId",get:function(){return"".concat(this.id,"-actions-menu-button")}},{key:"featureMenuId",get:function(){return"".concat(this.id,"-feature-menu")}},{key:"titleId",get:function(){return"".concat(this.id,"-popup-title")}},{key:"contentId",get:function(){return"".concat(this.id,"-popup-content")}},{key:"hasContent",get:function(){var e,t,n,i,r,a,o;return!!(this.selectedFeatureWidget?(null===(e=this.selectedFeatureWidget)||void 0===e||null===(t=e.viewModel)||void 0===t?void 0:t.waitingForContent)||"error"===(null===(n=this.selectedFeatureWidget)||void 0===n||null===(i=n.viewModel)||void 0===i?void 0:i.state)||(null===(r=this.selectedFeatureWidget)||void 0===r||null===(a=r.viewModel)||void 0===a?void 0:a.content):null===(o=this.viewModel)||void 0===o?void 0:o.content)}},{key:"featureNavigationVisible",get:function(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}},{key:"collapsible",get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}},{key:"featureMenuVisible",get:function(){return this.featureNavigationVisible&&this.featureMenuOpen}},{key:"contentCollapsed",get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}},{key:"dividedActions",get:function(){return this._divideActions()}},{key:"actionsMenuOpen",get:function(){return!!this.viewModel.active&&this._get("actionsMenuOpen")},set:function(e){this._set("actionsMenuOpen",!!e)}},{key:"currentAlignment",get:function(){return this._getCurrentAlignment()}},{key:"currentDockPosition",get:function(){return this._getCurrentDockPosition()}},{key:"dockOptions",get:function(){return this._get("dockOptions")||Un},set:function(e){var t=(0,h.Z)({},Un),n=this.get("viewModel.view.breakpoints"),i={};n&&(i.width=n.xsmall,i.height=n.xsmall);var r=(0,h.Z)((0,h.Z)({},t),e),a=(0,h.Z)((0,h.Z)({},t.breakpoint),i),o=r.breakpoint;!0===o?r.breakpoint=a:"object"==typeof o&&(r.breakpoint=(0,h.Z)((0,h.Z)({},a),o)),this._set("dockOptions",r),this._setCurrentDockPosition(),this.reposition()}},{key:"selectedFeatureWidget",get:function(){var e=this._feature,t=this.visibleElements,n=this.headingLevel,i=this.viewModel.selectedFeatureViewModel,r=(0,h.Z)((0,h.Z)({},t),{},{title:!1});return i?(e?(e.viewModel=i,e.visibleElements=r):this._feature=new x.E({headingLevel:n+1,viewModel:i,visibleElements:r}),this._feature):null}},{key:"castVisibleElements",value:function(e){return(0,h.Z)((0,h.Z)({},Wn),e)}},{key:"blur",value:function(){this.viewModel.active||jn.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}},{key:"clear",value:function(){this.viewModel.clear()}},{key:"close",value:function(){this.visible=!1}},{key:"fetchFeatures",value:function(e,t){return this.viewModel.fetchFeatures(e,t)}},{key:"focus",value:function(){this.viewModel.active||jn.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}},{key:"next",value:function(){return this.viewModel.next()}},{key:"open",value:function(e){var t,n;this._handles.remove(vt);var i=!!e&&!!e.featureMenuOpen,r=!!e&&!!e.actionsMenuOpen,a={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:r,featureMenuOpen:i};"xsmall"===(null===(t=this.viewModel)||void 0===t||null===(n=t.view)||void 0===n?void 0:n.widthBreakpoint)&&(a.collapsed=!0),this.set(a),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}},{key:"previous",value:function(){return this.viewModel.previous()}},{key:"reposition",value:function(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}},{key:"triggerAction",value:function(e){this.viewModel.triggerAction(e)}},{key:"render",value:function(){var e,t,n,i,r,a=this.actionsMenuOpen,o=this.dockEnabled,s=this.featureMenuVisible,u=this.dividedActions,l=this.currentAlignment,d=this.currentDockPosition,h=this.viewModel.active,p=u.menuActions,v=h&&p.length>1&&a,f=h&&o,y=h&&!o,g=null===(e=this.selectedFeature)||void 0===e||null===(t=e.layer)||void 0===t?void 0:t.title,m=null===(n=this.selectedFeature)||void 0===n||null===(i=n.layer)||void 0===i?void 0:i.id,_=(r={},(0,c.Z)(r,Gt,"top-center"===l),(0,c.Z)(r,Ht,"bottom-center"===l),(0,c.Z)(r,jt,"top-left"===l),(0,c.Z)(r,Wt,"bottom-left"===l),(0,c.Z)(r,qt,"top-right"===l),(0,c.Z)(r,Kt,"bottom-right"===l),(0,c.Z)(r,Ot,f),(0,c.Z)(r,Lt,y),(0,c.Z)(r,Dt,"top-left"===d),(0,c.Z)(r,Vt,"top-center"===d),(0,c.Z)(r,Nt,"top-right"===d),(0,c.Z)(r,zt,"bottom-left"===d),(0,c.Z)(r,Ut,"bottom-center"===d),(0,c.Z)(r,Bt,"bottom-right"===d),(0,c.Z)(r,Qt,s),(0,c.Z)(r,Yt,v),r);return(0,k.n)("div",{class:this.classes(It,_),role:"presentation","data-layer-title":g,"data-layer-id":m,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},h?[this.renderMainContainer(),this.renderPointer()]:null)}},{key:"renderLoadingIcon",value:function(){return(0,k.n)("span",{"aria-hidden":"true",class:this.classes(hn,xt,Pt)})}},{key:"renderNavigationLoading",value:function(){var e=this.messagesCommon;return this.viewModel.pendingPromisesCount?(0,k.n)("div",{key:Gn("loading-container"),role:"presentation",class:St,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}},{key:"renderPreviousIcon",value:function(){var e,t=(0,k.f)(this.container),n=(e={},(0,c.Z)(e,gt,t),(0,c.Z)(e,Pn,t),(0,c.Z)(e,yt,!t),(0,c.Z)(e,Cn,!t),e);return(0,k.n)("span",{"aria-hidden":"true",class:this.classes(hn,n)})}},{key:"renderPreviousButton",value:function(){var e=this.messages;return(0,k.n)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(ln,xn),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}},{key:"renderNextIcon",value:function(){var e,t=(0,k.f)(this.container),n=(e={},(0,c.Z)(e,yt,t),(0,c.Z)(e,Zn,t),(0,c.Z)(e,gt,!t),(0,c.Z)(e,In,!t),e);return(0,k.n)("span",{"aria-hidden":"true",class:this.classes(hn,n)})}},{key:"renderNextButton",value:function(){var e=this.messages;return(0,k.n)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(ln,Tn),"aria-label":e.next,title:e.next},this.renderNextIcon())}},{key:"renderFeatureMenuButton",value:function(){var e=this.featureMenuOpen,t=this.featureMenuId,n=this.messagesCommon,i=this.viewModel,r=i.featureCount,a=i.selectedFeatureIndex;return(0,k.n)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(ln,Dn),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":n.menu,title:n.menu},this._getPageText(r,a))}},{key:"renderNavigationButtons",value:function(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}},{key:"renderDockIcon",value:function(){var e,t=this.dockEnabled,n=this._wouldDockTo(),i=(e={},(0,c.Z)(e,Mt,t),(0,c.Z)(e,pn,!t),(0,c.Z)(e,kt,!t&&("top-right"===n||"bottom-right"===n)),(0,c.Z)(e,wt,!t&&("top-left"===n||"bottom-left"===n)),(0,c.Z)(e,mt,!t&&"top-center"===n),(0,c.Z)(e,_t,!t&&"bottom-center"===n),e);return(0,k.n)("span",{"aria-hidden":"true",class:this.classes(i,hn)})}},{key:"renderDockButton",value:function(){var e,t,n,i=this.dockEnabled,r=this.messages,a=null===(e=this.viewModel)||void 0===e||null===(t=e.view)||void 0===t?void 0:t.widthBreakpoint,o=i?r.undock:r.dock;return"xsmall"!==a&&null!==(n=this.dockOptions)&&void 0!==n&&n.buttonEnabled?(0,k.n)("div",{role:"button","aria-label":o,title:o,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(ln,dn)},this.renderDockIcon()):null}},{key:"renderTitle",value:function(){var e=this.viewModel.title,t=this.titleId,n=this.collapsible,i=this.contentCollapsed,r=this.messagesCommon,a=(0,c.Z)({},tn,n),o=(0,k.n)(F.n,{level:this.headingLevel,class:nn,innerHTML:e}),s=n?(0,k.n)("button",{key:"".concat(e,"--collapsible"),id:t,title:i?r.expand:r.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(en,a),"aria-expanded":i?"false":"true",onclick:this._toggleCollapsed,type:"button"},o):(0,k.n)("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(en,a)},o);return e?s:null}},{key:"renderCloseIcon",value:function(){return(0,k.n)("span",{"aria-hidden":"true",class:this.classes(hn,bt)})}},{key:"renderCloseButton",value:function(){var e=this.visibleElements,t=this.messagesCommon;return e.closeButton?(0,k.n)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:ln,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}},{key:"renderHeader",value:function(){return(0,k.n)("header",{class:Jt},this.renderTitle(),(0,k.n)("div",{class:$t},this.renderDockButton(),this.renderCloseButton()))}},{key:"renderContentContainer",value:function(){var e=this.contentId,t=this.hasContent,n=this.contentCollapsed,i=this.viewModel.content;return t&&!n?(0,k.n)("article",{key:i,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:rn},this.renderContent()):null}},{key:"renderActionsMenuButton",value:function(){var e=this.actionsMenuId,t=this.actionsMenuButtonId,n=this.actionsMenuOpen,i=this.dividedActions,r=this.messagesCommon,a=n?r.close:r.open;return i.menuActions.length?(0,k.n)("div",{key:Gn("actions-menu-button"),class:this.classes(ln,fn),role:"button",id:t,"aria-haspopup":"true","aria-controls":n?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":a,title:a},(0,k.n)("span",{"aria-hidden":"true",class:Ct})):null}},{key:"renderMenuActions",value:function(){var e=this,t=this.actionsMenuId,n=this.actionsMenuButtonId,i=this.actionsMenuOpen,r=this.dividedActions.menuActions;return r.length&&i?(0,k.n)("ul",{id:t,role:"menu","aria-labelledby":n,key:Gn("actions"),class:yn,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},r.toArray().map((function(t){return e.renderAction({action:t,type:"menu-item"})}))):null}},{key:"renderInlineActions",value:function(){var e=this,t=this.dividedActions.inlineActions;return!!t.length&&t.toArray().map((function(t){return e.renderAction({action:t,type:"inline"})}))}},{key:"renderInlineActionsContainer",value:function(){var e=this.dividedActions,t=e.inlineActions,n=e.menuActions,i=!!t.length,r=!!n.length;return i||r?(0,k.n)("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:vn},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}},{key:"renderNavigation",value:function(){return this.featureNavigationVisible?(0,k.n)("section",{key:Gn("navigation"),class:this.classes(En)},this.renderNavigationButtons()):null}},{key:"renderFooter",value:function(){var e,t=this.featureNavigationVisible,n=this.dividedActions,i=n.inlineActions,r=n.menuActions,a=!!i.length,o=!!r.length,s=(e={},(0,c.Z)(e,on,t),(0,c.Z)(e,sn,a),(0,c.Z)(e,un,o),e);return t||a?(0,k.n)("div",{key:Gn("feature-buttons"),class:this.classes(an,s)},this.renderInlineActionsContainer(),this.renderNavigation()):null}},{key:"renderFeatureMenuContainer",value:function(){var e=this.messages,t=this.viewModel,n=t.featureViewModels,i=t.isLoadingFeature,r=(0,E.s)(e.selectedFeatures,{total:n.length});return(0,k.n)("section",{key:Gn("menu"),class:An},(0,k.n)("strong",{class:Ln},r),(0,k.n)("nav",{bind:this,class:Fn,"data-node-ref":"_featureMenuViewportNode",afterCreate:k.v},this.renderFeatureMenu(),(0,k.n)("div",{class:Nn,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?(0,k.n)("div",{class:zn},this.renderLoadingIcon()):null))}},{key:"renderPointer",value:function(){return this.dockEnabled?null:(0,k.n)("div",{key:Gn("pointer"),class:bn,role:"presentation"},(0,k.n)("div",{class:this.classes(Mn,Lt)}))}},{key:"renderMainContainer",value:function(){var e,t=this.dockEnabled,n=this.currentAlignment,i=this.currentDockPosition,r=this.titleId,a=this.contentId,o=this.collapsible,s=this.hasContent,u=this.contentCollapsed,l=this.visibleElements,d=this.viewModel.title,h="bottom-left"===n||"bottom-center"===n||"bottom-right"===n||"top-left"===i||"top-center"===i||"top-right"===i,p="top-left"===n||"top-center"===n||"top-right"===n||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i,v=(e={},(0,c.Z)(e,Lt,t),(0,c.Z)(e,Rt,o),(0,c.Z)(e,Ft,u),e);return(0,k.n)("div",{class:this.classes(At,Zt,v),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":d?r:"","aria-describedby":s&&!u?a:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}},{key:"renderContent",value:function(){var e,t=null===(e=this.viewModel)||void 0===e?void 0:e.content;return t?"string"==typeof t?(0,k.n)("div",{key:t,innerHTML:t}):this.renderNodeContent(t):null}},{key:"renderActionText",value:function(e){return(0,k.n)("span",{key:"text",class:_n},e)}},{key:"renderActionIcon",value:function(e){var t,n=this._getActionClass(e),i=this._getActionImage(e),r=(t={},(0,c.Z)(t,xt,e.active),(0,c.Z)(t,Pt,e.active),(0,c.Z)(t,hn,!!n),(0,c.Z)(t,mn,!e.active&&!!i),t);return n&&(r[n]=!e.active),(0,k.n)("span",{key:"icon","aria-hidden":"true",class:this.classes(hn,r),styles:this._getIconStyles(i)})}},{key:"renderAction",value:function(e){var t,n=e.action,i=e.type,r=this._getActionTitle(n),a=(t={},(0,c.Z)(t,gn,"toggle"!==n.type),(0,c.Z)(t,wn,"toggle"===n.type),(0,c.Z)(t,kn,"toggle"===n.type&&n.value),(0,c.Z)(t,cn,n.disabled),t),o=[this.renderActionIcon(n),this.renderActionText(r)],s="menu-item"===i?(0,k.n)("li",{key:n.uid,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes(ln,a),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":n.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o):(0,k.n)("div",{key:n.uid,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes(ln,a),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":n.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},o);return n.visible?s:null}},{key:"renderFeatureMenuItem",value:function(e,t){var n=this.messages,i=this.messagesCommon,r=this.viewModel,a=r.selectedFeatureIndex,o=e===r.selectedFeatureViewModel,s=(0,c.Z)({},On,o),u=o?(0,k.n)("span",{key:Gn("feature-menu-selected-feature-".concat(a)),title:n.selectedFeature,"aria-label":n.selectedFeature,class:Et}):null,l=(0,k.n)("span",{innerHTML:e.title||i.untitled});return(0,k.n)("li",{role:"menuitem",tabIndex:-1,key:Gn("feature-menu-feature-".concat(a)),class:this.classes(s,Rn),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},(0,k.n)("span",{class:Vn},l,u))}},{key:"renderFeatureMenu",value:function(){var e=this,t=this.featureMenuId,n=this.viewModel.featureViewModels;return n.length>1?(0,k.n)("ol",{class:Sn,id:t,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},n.filter((function(e){return!!e.graphic})).map((function(t,n){return e.renderFeatureMenuItem(t,n)}))):null}},{key:"_getActionTitle",value:function(e){var t=this.messages,n=this.selectedFeature,i=this.messagesCommon,r=e.id,a=null===n||void 0===n?void 0:n.attributes,o="zoom-to-feature"===r?(0,E.s)(e.title,{messages:t}):"remove-selected-feature"===r?(0,E.s)(e.title,{messages:i}):"zoom-to-clustered-features"===r||"browse-clustered-features"===r?(0,E.s)(e.title,{messages:t}):e.title;return o&&a?(0,E.s)(o,a):o}},{key:"_getActionClass",value:function(e){var t=this.selectedFeature,n=null===t||void 0===t?void 0:t.attributes,i=e.className,r=e.image||i?i:Tt;return r&&n?(0,E.s)(r,n):r}},{key:"_getActionImage",value:function(e){var t=this.selectedFeature,n=null===t||void 0===t?void 0:t.attributes,i=e.image;return i&&n?(0,E.s)(i,n):i}},{key:"_createFeatureUpdatedAnimation",value:function(){return(0,k.w)("enter",Xt)}},{key:"_getInlineActionCount",value:function(){var e=this.maxInlineActions,t=this.featureNavigationVisible;if("number"!=typeof e)return null;var n=Math.round(e);return Math.max(t?n-1:n,0)}},{key:"_watchActions",value:function(){var e=this,t=this.viewModel.allActions;this.notifyChange("dividedActions");var n="actions";this._handles.remove(n),t&&t.forEach((function(t){e._handles.add((0,w.l)((function(){return[t.uid,t.active,t.className,t.disabled,t.id,t.title,t.image,t.visible]}),(function(){return e.scheduleRender()})),n)}))}},{key:"_divideActions",value:function(){var e=this.viewModel.allActions.filter((function(e){return e.visible})),t=this._getInlineActionCount(),n=null===t,i=0===t;return{inlineActions:n?e.slice(0):i?new b.j:e.slice(0,t),menuActions:n?new b.j:i?e.slice(0):e.slice(t)}}},{key:"_featureMenuOpenChanged",value:function(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}},{key:"_actionsMenuOpenChanged",value:function(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}},{key:"_setTitleFromFeatureWidget",value:function(){var e,t,n=this.selectedFeatureWidget,i=this.messagesCommon;n&&(this.viewModel.title="error"===(null===(e=n.viewModel)||void 0===e?void 0:e.state)?i.errorMessage:(null===(t=n.viewModel)||void 0===t?void 0:t.title)||"")}},{key:"_setContentFromFeatureWidget",value:function(){var e=this.selectedFeatureWidget;e&&(this.viewModel.content=e)}},{key:"_unobserveFeatureMenuObserver",value:function(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}},{key:"_featureMenuIntersectionObserverCreated",value:function(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}},{key:"_handleFeatureMenuKeyup",value:function(e){"Escape"===(0,g.i)(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}},{key:"_handleActionMenuKeyup",value:function(e){"Escape"===(0,g.i)(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}},{key:"_setActiveFeature",value:function(e){var t=this.viewModel,n=e.currentTarget["data-feature-index"];t.activeFeature=t.features[n]||null}},{key:"_removeActiveFeature",value:function(){this.viewModel.activeFeature=null}},{key:"_handleFeatureMenuItemKeyup",value:function(e){var t=(0,g.i)(e),n=this._featureMenuNode,i=e.currentTarget["data-feature-index"];if(n){var r=n.querySelectorAll("li"),a=r.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),r[r.length-1].focus()):(e.stopPropagation(),r[0].focus()):(e.stopPropagation(),r[(i+1+a)%a].focus()):(e.stopPropagation(),r[(i-1+a)%a].focus())}}},{key:"_handleActionMenuItemKeyup",value:function(e){var t=(0,g.i)(e),n=this._actionsMenuNode,i=e.currentTarget.dataset.actionUid,r=this.dividedActions.menuActions.findIndex((function(e){return e.uid===i}));if(n){var a=n.querySelectorAll("li"),o=a.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),a[a.length-1].focus()):(e.stopPropagation(),a[0].focus()):(e.stopPropagation(),a[(r+1+o)%o].focus()):(e.stopPropagation(),a[(r-1+o)%o].focus())}}},{key:"_handleMainKeyup",value:function(e){var t=(0,g.i)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}},{key:"_spinnerEnabledChange",value:function(e){if(this._destroySpinner(),e){var t=this.get("viewModel.view");this._createSpinner(t)}}},{key:"_hideSpinner",value:function(){var e=this._spinner;e&&(e.location=null,e.hide())}},{key:"_displaySpinner",value:function(){var e=this._spinner;if(e){var t=this.viewModel,n=t.location;t.waitingForResult?e.show({location:n}):e.hide()}}},{key:"_getIconStyles",value:function(e){return{"background-image":e?"url(".concat(e,")"):""}}},{key:"_shouldFocus",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.shouldFocus,!e.t0){e.next=5;break}return e.next=4,(0,w.j)((function(){var e;return!0===(null===(e=n.viewModel)||void 0===e?void 0:e.active)}));case 4:this.focus();case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_addSelectedFeatureIndexHandle",value:function(){var e=this,t=(0,w.l)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.selectedFeatureIndex}),(function(t,n){return e._selectedFeatureIndexUpdated(t,n)}));this._handles.add(t,vt)}},{key:"_selectedFeatureIndexUpdated",value:function(e,t){this.featureCount&&e!==t&&-1!==e&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}},{key:"_destroySelectedFeatureWidget",value:function(){var e=this._feature;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}},{key:"_isScreenLocationWithinView",value:function(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}},{key:"_isOutsideView",value:function(e){var t=e.popupHeight,n=e.popupWidth,i=e.screenLocation,r=e.side,a=e.view;if(isNaN(n)||isNaN(t)||!a||!i)return!1;var o=a.padding;return"right"===r&&i.x+n/2>a.width-o.right||"left"===r&&i.x-n/2<o.left||"top"===r&&i.y-t<o.top||"bottom"===r&&i.y+t>a.height-o.bottom}},{key:"_calculateAutoAlignment",value:function(e){if("auto"!==e)return e;var t=this._pointerOffsetInPx,n=this._containerNode,i=this._mainContainerNode,r=this.viewModel,a=r.screenLocation,o=r.view;if((0,_.t)(a)||!o||!n)return"top-center";if(!this._isScreenLocationWithinView(a,o))return this._get("currentAlignment")||"top-center";function s(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}var u=i?window.getComputedStyle(i,null):null,l=u?s(u.getPropertyValue("max-height")):0,c=u?s(u.getPropertyValue("height")):0,d=n.getBoundingClientRect(),h=d.height,p=d.width+t,v=Math.max(h,l,c)+t,f=this._isOutsideView({popupHeight:v,popupWidth:p,screenLocation:a,side:"right",view:o}),y=this._isOutsideView({popupHeight:v,popupWidth:p,screenLocation:a,side:"left",view:o}),g=this._isOutsideView({popupHeight:v,popupWidth:p,screenLocation:a,side:"top",view:o}),m=this._isOutsideView({popupHeight:v,popupWidth:p,screenLocation:a,side:"bottom",view:o});return y?g?"bottom-right":"top-right":f?g?"bottom-left":"top-left":g?m?"top-center":"bottom-center":"top-center"}},{key:"_callCurrentAlignment",value:function(e){return"function"==typeof e?e.call(this):e}},{key:"_getCurrentAlignment",value:function(){var e=this.alignment;return this.dockEnabled||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}},{key:"_setCurrentAlignment",value:function(){this._set("currentAlignment",this._getCurrentAlignment())}},{key:"_setCurrentDockPosition",value:function(){this._set("currentDockPosition",this._getCurrentDockPosition())}},{key:"_calculatePositionResult",value:function(e){var t=["left","right"];return(0,k.f)(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}},{key:"_callDockPosition",value:function(e){return"function"==typeof e?e.call(this):e}},{key:"_getDockPosition",value:function(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null===(e=this.dockOptions)||void 0===e?void 0:e.position)))}},{key:"_getCurrentDockPosition",value:function(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}},{key:"_wouldDockTo",value:function(){return this.dockEnabled?null:this._getDockPosition()}},{key:"_calculateAutoDockPosition",value:function(e){var t;if("auto"!==e)return e;var n=null===(t=this.viewModel)||void 0===t?void 0:t.view,i=(0,k.f)(this.container)?"top-left":"top-right";if(!n)return i;var r=n.padding||{left:0,right:0,top:0,bottom:0},a=n.width-r.left-r.right,o=n.breakpoints;return o&&a<=o.xsmall?"bottom-center":i}},{key:"_positionContainer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._containerNode;if(e&&(this._containerNode=e),e){var t=this.viewModel.screenLocation,n=e.getBoundingClientRect(),i=n.width,r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}}},{key:"_calculateFullWidth",value:function(e){var t=this.currentAlignment,n=this._pointerOffsetInPx;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+n:e}},{key:"_calculateAlignmentPosition",value:function(e,t,n,i){var r=this.currentAlignment,a=this._pointerOffsetInPx,o=i/2,s=n.height-t,u=n.width-e,l=this.view.padding;return"bottom-center"===r?{top:t+a-l.top,left:e-o-l.left}:"top-left"===r?{bottom:s+a-l.bottom,right:u+a-l.right}:"bottom-left"===r?{top:t+a-l.top,right:u+a-l.right}:"top-right"===r?{bottom:s+a-l.bottom,left:e+a-l.left}:"bottom-right"===r?{top:t+a-l.top,left:e+a-l.left}:"top-center"===r?{bottom:s+a-l.bottom,left:e-o-l.left}:void 0}},{key:"_calculatePositionStyle",value:function(e,t){var n=this.dockEnabled,i=this.view;if(i){if(n)return{left:"",top:"",right:"",bottom:""};if(!(0,_.t)(e)&&t){var r=this._calculateFullWidth(t),a=this._calculateAlignmentPosition(e.x,e.y,i,r);return a?{top:void 0!==a.top?"".concat(a.top,"px"):"auto",left:void 0!==a.left?"".concat(a.left,"px"):"auto",bottom:void 0!==a.bottom?"".concat(a.bottom,"px"):"auto",right:void 0!==a.right?"".concat(a.right,"px"):"auto"}:void 0}}}},{key:"_viewChange",value:function(e,t){e&&t&&(this.close(),this.clear())}},{key:"_viewReadyChange",value:function(e,t){if(e){var n=this.get("viewModel.view");this._wireUpView(n)}else t&&(this.close(),this.clear())}},{key:"_wireUpView",value:function(e){(this._destroySpinner(),e)&&(this.spinnerEnabled&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions))}},{key:"_dockingThresholdCrossed",value:function(e,t,n){var i=(0,a.Z)(e,2),r=i[0],o=i[1],s=(0,a.Z)(t,2),u=s[0],l=s[1],c=n.width,d=n.height;return r<=c&&u>c||r>c&&u<=c||o<=d&&l>d||o>d&&l<=d}},{key:"_updateDockEnabledForViewSize",value:function(e,t){if(e&&t){var n=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},i=n.left+n.right,r=n.top+n.bottom,a=[],o=[];a[0]=e[0]-i,a[1]=e[1]-r,o[0]=t[0]-i,o[1]=t[1]-r;var s=this.dockOptions,u=s.breakpoint;this._dockingThresholdCrossed(a,o,u)&&this._setDockEnabledForViewSize(s),this._setCurrentDockPosition()}}},{key:"_focusDockButtonNode",value:function(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}},{key:"_closeButtonNodeUpdated",value:function(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}},{key:"_mainContainerNodeUpdated",value:function(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}},{key:"_featureMenuNodeUpdated",value:function(e){if(this._featureMenuNode=e,e&&this._focusFirstFeature){this._focusFirstFeature=!1;var t=e.querySelectorAll("li");t.length&&t[0].focus()}}},{key:"_actionsMenuNodeUpdated",value:function(e){if(this._actionsMenuNode=e,e&&this._focusFirstAction){this._focusFirstAction=!1;var t=e.querySelectorAll("li");t.length&&t[0].focus()}}},{key:"_focusFeatureMenuButtonNode",value:function(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}},{key:"_focusActionsMenuButtonNode",value:function(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}},{key:"_featureMenuViewportScrollTop",value:function(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}},{key:"_toggleScreenLocationEnabled",value:function(){var e=this.dockEnabled,t=this.viewModel;if(t){var n=t.active&&!e;t.screenLocationEnabled=n}}},{key:"_shouldDockAtCurrentViewSize",value:function(e){var t,n,i=e.breakpoint,r=null===(t=this.viewModel)||void 0===t||null===(n=t.view)||void 0===n?void 0:n.ui;if(!r)return!1;var a=r.width,o=r.height;if(isNaN(a)||isNaN(o))return!1;var s=i.hasOwnProperty("width")&&a<=i.width,u=i.hasOwnProperty("height")&&o<=i.height;return s||u}},{key:"_setDockEnabledForViewSize",value:function(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}},{key:"_getPageText",value:function(e,t){return this.featureNavigationVisible?(0,E.s)(this.messages.pageText,{index:t+1,total:e}):null}},{key:"_destroySpinner",value:function(){var e=this._spinner,t=this.view;e&&(t&&t.ui&&t.ui.remove(this._spinner,ft),e.destroy(),this._spinner=null)}},{key:"_createSpinner",value:function(e){e&&(this._spinner=new xe({view:e}),e.ui.add(this._spinner,{key:ft,position:"manual"}))}},{key:"_toggleCollapsed",value:function(){this.collapsed=!this.collapsed}},{key:"_close",value:function(){this.close(),this.view&&this.view.focus()}},{key:"_toggleDockEnabled",value:function(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}},{key:"_toggleFeatureMenu",value:function(){var e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}},{key:"_toggleActionsMenu",value:function(){var e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}},{key:"_triggerAction",value:function(e){var t=e.currentTarget.dataset.actionUid,n=this.viewModel.allActions,i=n.findIndex((function(e){return e.uid===t})),r=n.getItemAt(i);r&&"toggle"===r.type&&(r.value=!r.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(i)}},{key:"_selectFeature",value:function(e){var t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}},{key:"_next",value:function(){this.next()}},{key:"_previous",value:function(){this.previous()}}]),n}((0,x.i)(k.O));(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"actionsMenuId",null),(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"actionsMenuButtonId",null),(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"featureMenuId",null),(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"titleId",null),(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"contentId",null),(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"hasContent",null),(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"featureNavigationVisible",null),(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"collapsible",null),(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"featureMenuVisible",null),(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"contentCollapsed",null),(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"dividedActions",null),(0,g.e)([(0,T.o)("viewModel.actions")],qn.prototype,"actions",void 0),(0,g.e)([(0,g.d)()],qn.prototype,"actionsMenuOpen",null),(0,g.e)([(0,g.d)()],qn.prototype,"alignment",void 0),(0,g.e)([(0,T.o)("viewModel.autoCloseEnabled")],qn.prototype,"autoCloseEnabled",void 0),(0,g.e)([(0,T.o)("viewModel.autoOpenEnabled")],qn.prototype,"autoOpenEnabled",void 0),(0,g.e)([(0,T.o)("viewModel.defaultPopupTemplateEnabled")],qn.prototype,"defaultPopupTemplateEnabled",void 0),(0,g.e)([(0,T.o)("viewModel.content")],qn.prototype,"content",void 0),(0,g.e)([(0,g.d)()],qn.prototype,"collapsed",void 0),(0,g.e)([(0,g.d)()],qn.prototype,"collapseEnabled",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"currentAlignment",null),(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"currentDockPosition",null),(0,g.e)([(0,g.d)()],qn.prototype,"dockOptions",null),(0,g.e)([(0,g.d)()],qn.prototype,"dockEnabled",void 0),(0,g.e)([(0,T.o)("viewModel.featureCount")],qn.prototype,"featureCount",void 0),(0,g.e)([(0,g.d)()],qn.prototype,"featureMenuOpen",void 0),(0,g.e)([(0,T.o)("viewModel.features")],qn.prototype,"features",void 0),(0,g.e)([(0,T.o)("viewModel.goToOverride")],qn.prototype,"goToOverride",void 0),(0,g.e)([(0,g.d)()],qn.prototype,"headingLevel",void 0),(0,g.e)([(0,T.o)("viewModel.highlightEnabled")],qn.prototype,"highlightEnabled",void 0),(0,g.e)([(0,T.o)("viewModel.location")],qn.prototype,"location",void 0),(0,g.e)([(0,g.d)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],qn.prototype,"label",void 0),(0,g.e)([(0,g.d)()],qn.prototype,"maxInlineActions",void 0),(0,g.e)([(0,g.d)(),(0,k.e)("esri/widgets/Popup/t9n/Popup")],qn.prototype,"messages",void 0),(0,g.e)([(0,g.d)(),(0,k.e)("esri/t9n/common")],qn.prototype,"messagesCommon",void 0),(0,g.e)([(0,T.o)("viewModel.promises")],qn.prototype,"promises",void 0),(0,g.e)([(0,T.o)("viewModel.selectedFeature")],qn.prototype,"selectedFeature",void 0),(0,g.e)([(0,T.o)("viewModel.selectedFeatureIndex")],qn.prototype,"selectedFeatureIndex",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],qn.prototype,"selectedFeatureWidget",null),(0,g.e)([(0,g.d)()],qn.prototype,"spinnerEnabled",void 0),(0,g.e)([(0,T.o)("viewModel.title")],qn.prototype,"title",void 0),(0,g.e)([(0,T.o)("viewModel.updateLocationEnabled")],qn.prototype,"updateLocationEnabled",void 0),(0,g.e)([(0,T.o)("viewModel.view")],qn.prototype,"view",void 0),(0,g.e)([(0,g.d)({type:pt}),(0,O.t)(["triggerAction","trigger-action"])],qn.prototype,"viewModel",void 0),(0,g.e)([(0,T.o)("viewModel.visible")],qn.prototype,"visible",void 0),(0,g.e)([(0,g.d)()],qn.prototype,"visibleElements",void 0),(0,g.e)([(0,g.q)("visibleElements")],qn.prototype,"castVisibleElements",null),(0,g.e)([(0,L.t)()],qn.prototype,"_close",null),(0,g.e)([(0,L.t)()],qn.prototype,"_toggleDockEnabled",null),(0,g.e)([(0,L.t)()],qn.prototype,"_toggleFeatureMenu",null),(0,g.e)([(0,L.t)()],qn.prototype,"_toggleActionsMenu",null),(0,g.e)([(0,L.t)()],qn.prototype,"_triggerAction",null),(0,g.e)([(0,L.t)()],qn.prototype,"_selectFeature",null),(0,g.e)([(0,L.t)()],qn.prototype,"_next",null),(0,g.e)([(0,L.t)()],qn.prototype,"_previous",null);var Kn=qn=(0,g.e)([(0,g.n)(Hn)],qn),Qn=[0,0];function Yn(e){e&&((0,k.t)(e),e.parentNode&&e.parentNode.removeChild(e))}var Xn=16,Jn=750,$n=function(e){var t=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;(0,p.Z)(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r)))._freqInfo={freq:Xn,time:Jn},e._overlayRenderTaskHandle=null,e.height=0,e.position=null,e.resizing=!1,e.root=null,e.surface=null,e.suspended=!0,e.ui=null,e.userContent=null,e.width=0,e.widthBreakpoint=null,e.handles.add([(0,w.l)((function(){return e.cursor}),(function(t){var n=(0,l.Z)(e).surface;n&&n.setAttribute("data-cursor",t)})),(0,w.l)((function(){return e.interacting}),(function(t){var n=(0,l.Z)(e).surface;n&&n.setAttribute("data-interacting",t.toString())}))]),e}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.handles.add((0,w.l)((function(){return e.ui}),(function(t,n){return e._handleUIChange(t,n)}))),this._wireUI(this.ui),this.handles.add([this.on("focus",(function(){return e.notifyChange("focused")})),this.on("blur",(function(){return e.notifyChange("focused")}))])}},{key:"destroy",value:function(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}},{key:"container",set:function(e){var t=this,n=this._get("container");if(n!==e){var i="dom-size";if(this.handles.remove(i),this._stopMeasuring(),n&&(n.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),Yn(this.root),this._set("root",null),(0,k.r)(this.userContent,n),Yn(this.userContent),this._set("userContent",null)),e){e.classList.add("esri-view");var r=document.createElement("div");r.className="esri-view-user-storage",(0,k.r)(e,r),e.appendChild(r),this._set("userContent",r);var o=document.createElement("div");o.className="esri-view-root",e.insertBefore(o,e.firstChild),this._set("root",o);var s=document.createElement("div");s.className="esri-view-surface",s.setAttribute("role","application"),s.tabIndex=0,o.appendChild(s),this._set("surface",s);var u=new fe;o.appendChild(u.surface),this._set("overlay",u),(0,w.l)((function(){return u.needsRender}),(function(e){e&&!t._overlayRenderTaskHandle?t._overlayRenderTaskHandle=(0,g.ad)({render:function(){t.overlay.render()}}):t._overlayRenderTaskHandle&&(t._overlayRenderTaskHandle.remove(),t._overlayRenderTaskHandle=null)})),this.forceDOMReadyCycle(),this.handles.add((0,w.l)((function(){return t.size}),(function(e){var t=(0,a.Z)(e,2),n=t[0],i=t[1],r="esri-view-surface--inset-outline";n>=document.body.clientWidth||i>=document.body.clientHeight?s.classList.add(r):s.classList.remove(r)}),w.h),i),this._set("container",e),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}}},{key:"focused",get:function(){var e=document.activeElement===this.surface;return document.hasFocus()&&e}},{key:"popup",get:function(){return this._get("popup")||new Kn({view:this})},set:function(e){var t=this._get("popup");t&&t!==e&&t.destroy(),this._set("popup",e)}},{key:"size",get:function(){return[this.width,this.height]}},{key:"blur",value:function(){this.surface&&this.surface.blur()}},{key:"focus",value:function(){this.surface&&this.surface.focus()}},{key:"pageToContainer",value:function(e,t,n){var i=this.position;return e-=i[0],t-=i[1],n?(n[0]=e,n[1]=t):n=[e,t],n}},{key:"containerToPage",value:function(e,t,n){var i=this.position;return e+=i[0],t+=i[1],n?(n[0]=e,n[1]=t):n=[e,t],n}},{key:"_handleUIChange",value:function(e,t){t&&(this.handles.remove("ui"),t.destroy()),e&&this._wireUI(e),this._set("ui",e)}},{key:"_wireUI",value:function(e){var t=this;this.handles.remove("ui"),e&&(e.view=this,this.handles.add([(0,w.l)((function(){return t.root}),(function(t){e.container=t?function(e){var t=document.createElement("div");return e.appendChild(t),t}(t):null}),w.h),(0,w.l)((function(){return t.popup}),(function(t,n){var i="popup";n&&e.remove(n,i),t&&(t.view=e.view,e.add(t,{key:i,position:"manual"}))}),w.h)],"ui"))}},{key:"_stopMeasuring",value:function(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}},{key:"_startMeasuring",value:function(){var e=this,t=this._freqInfo;t.freq=Xn,t.time=Jn,this.handles.add([function(){var e=function(){t.freq=Xn,t.time=Jn};return window.addEventListener("resize",e),{remove:function(){window.removeEventListener("resize",e)}}}(),(0,g.ad)({prepare:function(t){var n=e._measure(),i=e._freqInfo;if(i.time+=t.deltaTime,n&&(i.freq=Xn,e._get("resizing")||e._set("resizing",!0)),!(i.time<i.freq)){i.time=0;var r=e._position();i.freq=r||n?Xn:Math.min(Jn,2*i.freq),!n&&i.freq>=512&&e._get("resizing")&&e._set("resizing",!1)}}})],"measuring"),this._measure(),this._position()}},{key:"_measure",value:function(){var e=this.container,t=e?e.clientWidth:0,n=e?e.clientHeight:0;if(0===t||0===n)return this.suspended||this._set("suspended",!0),!1;var i=this.width,r=this.height;return t===i&&n===r?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:i,oldHeight:r,width:t,height:n}),!0)}},{key:"_position",value:function(){var e=this.container,t=this.position,n=function(e){var t=(e.ownerDocument||window.document).defaultView,n=e.getBoundingClientRect();return Qn[0]=n.left+t.pageXOffset,Qn[1]=n.top+t.pageYOffset,Qn}(e);return(!t||n[0]!==t[0]||n[1]!==t[1])&&(this._set("position",[n[0],n[1]]),!0)}},{key:"forceDOMReadyCycle",value:function(){}}]),n}(e);return(0,g.e)([(0,g.d)({value:null,cast:function(e){return(0,k.a)(e)}})],t.prototype,"container",null),(0,g.e)([(0,g.d)({readOnly:!0})],t.prototype,"focused",null),(0,g.e)([(0,g.d)({readOnly:!0})],t.prototype,"height",void 0),(0,g.e)([(0,g.d)({type:Kn})],t.prototype,"popup",null),(0,g.e)([(0,g.d)({type:fe})],t.prototype,"overlay",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],t.prototype,"position",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],t.prototype,"resizing",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],t.prototype,"root",void 0),(0,g.e)([(0,g.d)({value:null,readOnly:!0})],t.prototype,"size",null),(0,g.e)([(0,g.d)({readOnly:!0})],t.prototype,"surface",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],t.prototype,"suspended",void 0),(0,g.e)([(0,g.d)()],t.prototype,"ui",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],t.prototype,"userContent",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],t.prototype,"width",void 0),(0,g.e)([(0,g.d)()],t.prototype,"widthBreakpoint",void 0),t=(0,g.e)([(0,g.n)("esri.views.DOMContainer")],t)};function ei(e){return e&&"focus"in e}var ti=function(e){var t=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"fetchPopupFeatures",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,n){var i,r,a,u,l,c,d,h;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.when();case 2:return e.next=4,this._prepareFetchPopupFeatures(t,n);case 4:return i=e.sent,r=i.location,a=i.queryArea,u=i.layerViewsAndGraphics,l=i.clientOnlyGraphics,c=Promise.resolve(l),d=this._queryLayerPopupFeatures(a,u,n),h=d.map((function(e){return e.promise})),e.abrupt("return",{location:r,clientOnlyGraphics:l,allGraphicsPromise:(0,g.ak)([c].concat((0,o.Z)(h))).then((function(e){return Array.from(new Set(e.flat()))})),promisesPerLayerView:d});case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_queryLayerPopupFeatures",value:function(e,t,n){return t.map((function(t){var i=t.layerView,r={clientGraphics:t.graphics,event:(0,_.r)(n)?n.event:null,signal:(0,_.r)(n)?n.signal:null,defaultPopupTemplateEnabled:!!(0,_.r)(n)&&!!n.defaultPopupTemplateEnabled},a=i.fetchPopupFeatures(e,r);return{layerView:i,promise:a}}))}},{key:"_isValidPopupGraphic",value:function(e,t){return e&&!!e.getEffectivePopupTemplate((0,_.r)(t)&&t.defaultPopupTemplateEnabled)}},{key:"_prepareFetchPopupFeatures",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,n){var i,r,a,o,u,l,c,d;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._popupHitTestGraphics(t,n);case 2:return i=e.sent,r=i.clientGraphics,a=i.queryArea,o=i.location,u=this._getFetchPopupLayerViews(),l=this._graphicsPerFetchPopupLayerView(r,u),c=l.layerViewsAndGraphics,d=l.clientOnlyGraphics,e.abrupt("return",{clientOnlyGraphics:d,layerViewsAndGraphics:c,queryArea:a,location:o});case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_popupHitTestGraphics",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,n){var i,r,a,o,u,l=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.popupHitTest(t);case 2:return i=e.sent,r=i.results,a=i.mapPoint,o=r.filter((function(e){return"graphic"===e.type&&l._isValidPopupGraphic(e.graphic,n)})),u=o.length?o[0].mapPoint:null,e.abrupt("return",{clientGraphics:o.map((function(e){return e.graphic})),queryArea:a,location:a||u});case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getFetchPopupLayerViews",value:function(){var e=this,t=[];return this.allLayerViews.forEach((function(n){e._isValidPopupLayerView(n)&&t.push(n)})),(0,_.r)(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&t.push(this.graphicsView),t.reverse()}},{key:"_isValidPopupLayerView",value:function(e){return(0,_.r)(e)&&(!("layer"in e)||!e.suspended)&&"fetchPopupFeatures"in e}},{key:"_graphicsPerFetchPopupLayerView",value:function(e,t){var n,i=[],r=new Map,a=t.map((function(e){var t=[];return"layer"in e?r.set(e.layer,t):r.set(e.graphics,t),{layerView:e,graphics:t}})),o=(0,d.Z)(e);try{for(o.s();!(n=o.n()).done;){var s=n.value,u=r.get(s.layer)||r.get(s.sourceLayer)||null;u?u.push(s):i.push(s)}}catch(l){o.e(l)}finally{o.f()}return{layerViewsAndGraphics:a,clientOnlyGraphics:i}}}]),n}(e);return t=(0,g.e)([(0,g.n)("esri.views.PopupView")],t)},ni=g.s.getLogger("esri.support.AnalysesCollection"),ii=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).handles.add(i.on("before-add",(function(e){(0,_.t)(e.item)||e.item.parent===i.owner&&(ni.warn("Analysis inside the collection must be unique. Not adding this element again."),e.preventDefault())}))),i}return(0,v.Z)(n,[{key:"_own",value:function(e){e.parent=this.owner}},{key:"_release",value:function(e){e.parent=null}}]),n}(B.m);ii=(0,g.e)([(0,g.n)("esri.support.AnalysesCollection")],ii);var ri=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).view=null,i.baseLayerViews=new b.j,i.referenceLayerViews=new b.j,i._loadingHandle=(0,w.l)((function(){var e,t;return null===(e=i.view)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.basemap}),(function(e){e&&e.load().catch((function(){}))}),w.h),i}return(0,v.Z)(n,[{key:"destroy",value:function(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}},{key:"suspended",get:function(){return!this.view||this.view.suspended}},{key:"updating",get:function(){var e,t;if(this.view&&this.view.suspended)return!1;var n=null===(e=this.view)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.basemap;return!!n&&!!n.loaded&&(this.baseLayerViews.some((function(e){return e.updating}))||this.referenceLayerViews.some((function(e){return e.updating})))}}]),n}(g.y);(0,g.e)([(0,g.d)({constructOnly:!0})],ri.prototype,"view",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],ri.prototype,"baseLayerViews",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],ri.prototype,"referenceLayerViews",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],ri.prototype,"suspended",null),(0,g.e)([(0,g.d)({type:Boolean,readOnly:!0})],ri.prototype,"updating",null),ri=(0,g.e)([(0,g.n)("esri.views.BasemapView")],ri);var ai=g.s.getLogger("esri.views.LayerViewManager"),oi=function(){function e(t,n,i){var r=this;(0,p.Z)(this,e),this.layer=t,this.view=n,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=(0,g.T)(),this._started=!1,this.done=!1,(0,g.v)(this._controller.signal,(function(){var e=new g.a("cancelled:layerview-create","layerview creation cancelled",{layer:t});r._deferred.reject(e)}))}return(0,v.Z)(e,[{key:"promise",get:function(){return this._deferred.promise}},{key:"destroy",value:function(){this._controller.abort();var e=this.layerView;if(e){var t=this.layer,n=this.view;t.emit("layerview-destroy",{view:n,layerView:e}),n.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}}},{key:"start",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,n,i,r,a,o,u,l,c,d=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._started){e.next=2;break}return e.abrupt("return");case 2:return this._started=!0,t=this._controller.signal,n=this.layer,i=this.view,this._map=i.map,e.prev=5,e.next=8,n.load({signal:t});case 8:if(e.t0="prefetchResources"in n,!e.t0){e.next=12;break}return e.next=12,n.prefetchResources({signal:t});case 12:if(!n.createLayerView){e.next=18;break}return e.next=15,n.createLayerView(i,{signal:t});case 15:o=e.sent,e.next=24;break;case 18:if(this.layerViewImporter.hasLayerViewModule(n)){e.next=20;break}throw new g.a("layer:view-not-supported","No layerview implementation was found");case 20:return e.next=22,this.layerViewImporter.importLayerView(n);case 22:l=e.sent,(0,g.H)(t),o="default"in l?new l.default({layer:n,view:i}):new l({layer:n,view:i});case 24:return c=function(){u=(0,_.d)(u),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,d.done=!0},u=(0,g.v)(t,c),(0,g.H)(t),e.prev=26,e.next=29,o.when();case 29:e.next=34;break;case 31:throw e.prev=31,e.t1=e.catch(26),c(),e.t1;case 34:if(null===(r=this._map)||void 0===r||null===(a=r.allLayers)||void 0===a?void 0:a.includes(n)){e.next=37;break}return e.abrupt("return",(c(),void this._deferred.reject(new g.a("view:no-layerview-for-layer","The layer has been removed from the map",{layer:n}))));case 37:this.layerView=o,n.emit("layerview-create",{view:i,layerView:o}),i.emit("layerview-create",{layer:n,layerView:o}),this.done=!0,this._deferred.resolve(o),e.next=43;break;case 40:e.prev=40,e.t2=e.catch(5),n.emit("layerview-create-error",{view:i,error:e.t2}),i.emit("layerview-create-error",{layer:n,error:e.t2}),this.done=!0,this._deferred.reject(new g.a("layerview:create-error","layerview creation failed",{layer:n,error:e.t2}));case 43:case"end":return e.stop()}}),e,this,[[5,40],[26,31]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),si=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._layerLayerViewInfoMap=new Map,i._watchUpdatingTracking=new M.c,i.supportsGround=!0,i._preloadLayerViewModules=function(){var e,t=null===(e=i.view.map)||void 0===e?void 0:e.allLayers;if(t){var n,r=(0,d.Z)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;i.layerViewImporter.hasLayerViewModule(a)&&i.layerViewImporter.importLayerView(a)}}catch(o){r.e(o)}finally{r.f()}}},i._reschedule=function(){return(0,_.t)(i._workPromise)&&(i._workPromise=(0,g.T)()),i.handles.remove("reschedule"),i.handles.add((0,g.B)(i._doWork),"reschedule"),i._workPromise.promise},i._doWork=function(){var e,t,n,r=i.view.map;if(i._map!==r&&(i.clear(),i._map=r),(0,_.t)(i._workPromise))i.notifyChange("updating");else{i.handles.remove("reschedule"),i.handles.remove("collection-change");var s=new N.p({getCollections:function(){return i._rootCollectionNames.map((function(e){return i.get(e)}))},getChildrenFunction:function(e){return e&&"layers"in e?e.layers:null}});if(!s)return i._workPromise.resolve(),void(i._workPromise=null);var u,l=(0,d.Z)(s);try{for(l.s();!(u=l.n()).done;){var c=u.value;i._createLayerView(c)}}catch(w){l.e(w)}finally{l.f()}i._refreshCollections();var h,p=(0,d.Z)(i._layerLayerViewInfoMap);try{for(p.s();!(h=p.n()).done;){var v=(0,a.Z)(h.value,2),f=v[0],y=v[1];s.includes(f)||(i._layerLayerViewInfoMap.delete(y.layer),y.destroy())}}catch(w){p.e(w)}finally{p.f()}var g=s.filter((function(e){return"group"===e.type})).map((function(e){return e.layers})),m=[null===r||void 0===r||null===(e=r.ground)||void 0===e?void 0:e.layers,null===r||void 0===r||null===(t=r.basemap)||void 0===t?void 0:t.baseLayers,null===r||void 0===r||null===(n=r.basemap)||void 0===n?void 0:n.referenceLayers,null===r||void 0===r?void 0:r.layers].concat((0,o.Z)(g)).filter((function(e){return!!e}));i.handles.add(m.map((function(e){return i._watchUpdatingTracking.addOnCollectionChange((function(){return e}),i._reschedule)})),"collection-change"),i._workPromise.resolve(),i._workPromise=null}},i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.handles.add([(0,w.a)((function(){var t,n;return null===(t=e.view)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.allLayers}),"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),(0,w.l)((function(){var t=e.view,n=null===t||void 0===t?void 0:t.map;return[null===n||void 0===n?void 0:n.basemap,null===n||void 0===n?void 0:n.ground,null===n||void 0===n?void 0:n.layers,null===t||void 0===t?void 0:t.ready]}),(function(){return e._reschedule()}),w.w)]),this._preloadLayerViewModules(),this._reschedule()}},{key:"destroy",value:function(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}},{key:"_layersToLayerViews",get:function(){var e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}},{key:"_rootCollectionNames",get:function(){return Array.from(this._layersToLayerViews.keys())}},{key:"updating",get:function(){return(0,_.r)(this._workPromise)||this._watchUpdatingTracking.updating||(0,g.af)(this._layerLayerViewInfoMap,(function(e){return!e.done}))}},{key:"updatingRemaining",get:function(){var e,t=0,n=(0,d.Z)(this._layerLayerViewInfoMap.values());try{for(n.s();!(e=n.n()).done;){e.value.done||++t}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"clear",value:function(){if(!this.destroyed){var e,t=(0,d.Z)(this._layerLayerViewInfoMap.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}},{key:"whenLayerView",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._reschedule();case 2:if(this._layerLayerViewInfoMap.has(t)){e.next=4;break}throw new g.a("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:t});case 4:return e.abrupt("return",this._layerLayerViewInfoMap.get(t).promise);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_refreshCollections",value:function(){var e,t=(0,d.Z)(this._layersToLayerViews);try{for(t.s();!(e=t.n()).done;){var n=(0,a.Z)(e.value,2),i=n[0],r=n[1];this._populateLayerViewsOwners(this.get(i),this.get(r),this.view)}}catch(o){t.e(o)}finally{t.f()}this.notifyChange("updating"),this.notifyChange("updatingRemaining")}},{key:"_populateLayerViewsOwners",value:function(e,t,n){if(e&&t){var i,r=0,a=(0,d.Z)(e);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=this._layerLayerViewInfoMap.get(o);if(s&&s.layerView){var u=s.layerView;u.layer=o,u.parent=n,t.getItemAt(r)!==u&&t.splice(r,0,u),o.layers&&this._populateLayerViewsOwners(o.layers,u.layerViews,u),r+=1}}}catch(l){a.e(l)}finally{a.f()}r<t.length&&t.splice(r,t.length)}else t&&t.removeAll()}},{key:"_createLayerView",value:function(e){var t=this;if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch((function(){})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);var n=new oi(e,this.view,this.layerViewImporter);n.promise.then((function(){return t._refreshCollections()}),(function(n){var i,r;n&&((0,g.u)(n)||"cancelled:layerview-create"===n.name)||ai.error("Failed to create layerview for layer title:'".concat(null!==(i=e.title)&&void 0!==i?i:"no title","', id:'").concat(null!==(r=e.id)&&void 0!==r?r:"no id","' of type '").concat(e.type,"'."),{layer:e,error:n}),t._refreshCollections()})),this._layerLayerViewInfoMap.set(e,n),this.view.ready&&n.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}}]),n}(M.d);(0,g.e)([(0,g.d)()],si.prototype,"_workPromise",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],si.prototype,"_watchUpdatingTracking",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],si.prototype,"_layersToLayerViews",null),(0,g.e)([(0,g.d)({readOnly:!0})],si.prototype,"_rootCollectionNames",null),(0,g.e)([(0,g.d)()],si.prototype,"layerViewImporter",void 0),(0,g.e)([(0,g.d)()],si.prototype,"supportsGround",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],si.prototype,"updating",null),(0,g.e)([(0,g.d)({readOnly:!0})],si.prototype,"updatingRemaining",null),(0,g.e)([(0,g.d)({constructOnly:!0})],si.prototype,"view",void 0);var ui=si=(0,g.e)([(0,g.n)("esri.views.LayerViewManager")],si),li=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).factor=1.5,i.offset=(0,j.c)(0,0),i.position=null,i.size=120,i.maskUrl=null,i.maskEnabled=!0,i.overlayUrl=null,i.overlayEnabled=!0,i.visible=!0,i}return(0,v.Z)(n,[{key:"version",get:function(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}}]),n}(g.y);(0,g.e)([(0,g.d)({type:Number})],li.prototype,"factor",void 0),(0,g.e)([(0,g.d)({nonNullable:!0})],li.prototype,"offset",void 0),(0,g.e)([(0,g.d)()],li.prototype,"position",void 0),(0,g.e)([(0,g.d)({type:Number,range:{min:0}})],li.prototype,"size",void 0),(0,g.e)([(0,g.d)()],li.prototype,"maskUrl",void 0),(0,g.e)([(0,g.d)()],li.prototype,"maskEnabled",void 0),(0,g.e)([(0,g.d)()],li.prototype,"overlayUrl",void 0),(0,g.e)([(0,g.d)()],li.prototype,"overlayEnabled",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],li.prototype,"version",null),(0,g.e)([(0,g.d)({type:Boolean})],li.prototype,"visible",void 0);var ci,di=li=(0,g.e)([(0,g.n)("esri.views.Magnifier")],li),hi=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i){var r,a;return(0,p.Z)(this,n),(a=t.call(this,{}))._stage=e,a._textureRequests=new Map,a._frameTask=null!==(r=null===i||void 0===i?void 0:i.registerTask(W.L.TEXTURE_UNLOAD))&&void 0!==r?r:W.Q,a}return(0,v.Z)(n,[{key:"normalizeCtorArgs",value:function(){return{}}},{key:"destroy",value:function(){var e=this;(0,i.Z)((0,r.Z)(n.prototype),"destroy",this).call(this),this._frameTask.remove(),this._textureRequests.forEach((function(t){return e._releaseTextureRequest(t)})),this._textureRequests.clear()}},{key:"updating",get:function(){return this._frameTask.updating}},{key:"fromData",value:function(e,t,n){var i=this,r=this.makeUid(e),a=this._textureRequests.get(r);return a||(a={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:n},this._stage&&(this._stage.add(a.texture),this._stage.loadImmediate(a.texture)),this._textureRequests.set(r,a)),a.referenceCount++,{uid:r,texture:a.texture,release:function(){return i._release(r)}}}},{key:"_release",value:function(e){var t=this,n=this._textureRequests.get(e);n?(n.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),n.referenceCount--,n.referenceCount<1&&this._frameTask.schedule((function(){return t._releaseNow(e)}))):console.warn("TextureCollection: texture doesn't exist: '".concat(e,"'"))}},{key:"test",get:function(){return{textureRequests:this._textureRequests}}},{key:"_releaseNow",value:function(e){if(this._textureRequests){var t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}}},{key:"_releaseTextureRequest",value:function(e){var t;e.onRemove&&e.onRemove(),e.texture?null===(t=this._stage)||void 0===t||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}},{key:"makeUid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,_.r)(t)?"".concat(e,".").concat(t,"px"):e}}]),n}(g.y);(0,g.e)([(0,g.d)()],hi.prototype,"_frameTask",void 0),(0,g.e)([(0,g.d)()],hi.prototype,"updating",null),hi=(0,g.e)([(0,g.n)("esri.views.3d.support.TextureCollection")],hi),function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(ci||(ci={}));var pi=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],vi={};function fi(e){return!!vi[e]}pi.forEach((function(e){vi[e]=!0}));var yi,gi,mi,_i=function(){function e(t){(0,p.Z)(this,e),this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}return(0,v.Z)(e,[{key:"connect",value:function(e){var t=this;e&&this.disconnect(),this.inputManager=e,this.handlers.forEach((function(e,n){var i=e.handler,r=e.priority;return t.inputManager.installHandlers(n,[i],r)}))}},{key:"disconnect",value:function(){var e=this;this.inputManager&&this.handlers.forEach((function(t,n){return e.inputManager.uninstallHandlers(n)})),this.inputManager=null}},{key:"destroy",value:function(){this.disconnect(),this.handlers.clear(),this.view=null}},{key:"on",value:function(e,t,n,i){var r,a,o=this,s=Array.isArray(e)?e:e.split(",");if(!function(e){var t,n=(0,d.Z)(e);try{for(n.s();!(t=n.n()).done;)if(!fi(t.value))return!1}catch(i){n.e(i)}finally{n.f()}return!0}(s))return s.some(fi)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;Array.isArray(t)?a=t:(r=t,a=[]),"function"==typeof n?r=n:i=n,i=null!=i?i:Ge.DEFAULT;var u=this._createUniqueGroupName(),l=new wi(this.view,s,a,r);this.handlers.set(u,{handler:l,priority:i});var c,h=(0,d.Z)(s);try{for(h.s();!(c=h.n()).done;){var p=c.value,v=this.handlerCounts.get(p)||0;this.handlerCounts.set(p,v+1)}}catch(f){h.e(f)}finally{h.f()}return this.inputManager&&this.inputManager.installHandlers(u,[l],i),{remove:function(){return o._removeHandler(u,s)}}}},{key:"hasHandler",value:function(e){return!!this.handlerCounts.get(e)}},{key:"_removeHandler",value:function(e,t){if(this.handlers.has(e)){this.handlers.delete(e);var n,i=(0,d.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=this.handlerCounts.get(r);void 0===a?console.error("Trying to remove handler for event that has no handlers registered: ",r):1===a?this.handlerCounts.delete(r):this.handlerCounts.set(r,a-1)}}catch(o){i.e(o)}finally{i.f()}}this.inputManager&&this.inputManager.uninstallHandlers(e)}},{key:"_createUniqueGroupName",value:function(){return this.counter+=1,"viewEvents_".concat(this.counter)}}]),e}(),wi=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i,r,a){var o;(0,p.Z)(this,n),(o=t.call(this,!0)).view=e;var s,u=(0,d.Z)(i);try{for(u.s();!(s=u.n()).done;){switch(s.value){case"click":o.registerIncoming("click",r,(function(e){return a(o._wrapClick(e))}));break;case"double-click":o.registerIncoming("double-click",r,(function(e){return a(o._wrapDoubleClick(e))}));break;case"immediate-click":o.registerIncoming("immediate-click",r,(function(e){return a(o._wrapImmediateClick(e))}));break;case"immediate-double-click":o.registerIncoming("immediate-double-click",r,(function(e){return a(o._wrapImmediateDoubleClick(e))}));break;case"hold":o.registerIncoming("hold",r,(function(e){return a(o._wrapHold(e))}));break;case"drag":o.registerIncoming("drag",r,(function(e){var t=o._wrapDrag(e);t&&a(t)}));break;case"key-down":o.registerIncoming("key-down",r,(function(e){return a(o._wrapKeyDown(e))}));break;case"key-up":o.registerIncoming("key-up",r,(function(e){return a(o._wrapKeyUp(e))}));break;case"pointer-down":o.registerIncoming("pointer-down",r,(function(e){return a(o._wrapPointer(e,"pointer-down"))}));break;case"pointer-move":o.registerIncoming("pointer-move",r,(function(e){return a(o._wrapPointer(e,"pointer-move"))}));break;case"pointer-up":o.registerIncoming("pointer-up",r,(function(e){return a(o._wrapPointer(e,"pointer-up"))}));break;case"pointer-drag":o.registerIncoming("pointer-drag",r,(function(e){return a(o._wrapPointerDrag(e))}));break;case"mouse-wheel":o.registerIncoming("mouse-wheel",r,(function(e){return a(o._wrapMouseWheel(e))}));break;case"pointer-enter":o.registerIncoming("pointer-enter",r,(function(e){return a(o._wrapPointer(e,"pointer-enter"))}));break;case"pointer-leave":o.registerIncoming("pointer-leave",r,(function(e){return a(o._wrapPointer(e,"pointer-leave"))}));break;case"gamepad":o.registerIncoming("gamepad",r,(function(e){a(o._wrapGamepad(e))}));break;case"focus":o.registerIncoming("focus",r,(function(e){a(o._wrapFocus(e))}));break;case"blur":o.registerIncoming("blur",r,(function(e){a(o._wrapBlur(e))}))}}}catch(l){u.e(l)}finally{u.f()}return o}return(0,v.Z)(n,[{key:"_wrapFocus",value:function(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapBlur",value:function(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapClick",value:function(e){var t=e.data,n=t.pointerType,i=t.button,r=t.buttons,a=t.x,o=t.y,s=t.native,u=t.eventId,l=e.cancelable;return{type:"click",pointerType:n,button:i,buttons:r,x:a,y:o,native:s,timestamp:e.timestamp,screenPoint:(0,j.c)(a,o),mapPoint:this._getMapPoint(a,o),eventId:u,cancelable:l,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapDoubleClick",value:function(e){var t=e.data,n=t.pointerType,i=t.button,r=t.buttons,a=t.x,o=t.y,s=t.native,u=t.eventId,l=e.cancelable;return{type:"double-click",pointerType:n,button:i,buttons:r,x:a,y:o,native:s,timestamp:e.timestamp,mapPoint:this._getMapPoint(a,o),eventId:u,cancelable:l,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapImmediateClick",value:function(e){var t=e.data,n=t.pointerType,i=t.button,r=t.buttons,a=t.x,o=t.y,s=t.native,u=t.eventId,l=s.pointerId,c=e.cancelable;return{type:"immediate-click",pointerId:l,pointerType:n,button:i,buttons:r,x:a,y:o,native:s,timestamp:e.timestamp,mapPoint:this._getMapPoint(a,o),eventId:u,cancelable:c,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapImmediateDoubleClick",value:function(e){var t=e.data,n=t.pointerType,i=t.button,r=t.buttons,a=t.x,o=t.y,s=t.native,u=t.eventId,l=s.pointerId,c=e.cancelable;return{type:"immediate-double-click",pointerId:l,pointerType:n,button:i,buttons:r,x:a,y:o,native:s,timestamp:e.timestamp,mapPoint:this._getMapPoint(a,o),eventId:u,cancelable:c,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapHold",value:function(e){var t=e.data,n=t.pointerType,i=t.button,r=t.buttons,a=t.x,o=t.y,s=t.native,u=e.cancelable;return{type:"hold",pointerType:n,button:i,buttons:r,x:a,y:o,native:s,timestamp:e.timestamp,mapPoint:this._getMapPoint(a,o),cancelable:u,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_getMapPoint",value:function(e,t){return this.view.toMap((0,j.c)(e,t),{exclude:[]})}},{key:"_wrapDrag",value:function(e){var t=e.data,n=t.center,i=n.x,r=n.y,a=t.action,o=t.pointerType,s=t.button;if("start"===a&&(this.latestDragStart=t),this.latestDragStart){var u=t.pointer.native,l=t.buttons,c=e.cancelable,d=e.timestamp,h={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===a&&(this.latestDragStart=void 0),{type:"drag",action:a,x:i,y:r,origin:h,pointerType:o,button:s,buttons:l,radius:t.radius,angle:(0,K.m)(t.angle),native:u,timestamp:d,cancelable:c,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}}},{key:"_wrapKeyDown",value:function(e){var t=e.data,n=t.key,i=t.repeat,r=t.native,a=e.cancelable;return{type:"key-down",key:n,repeat:i,native:r,timestamp:e.timestamp,cancelable:a,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapKeyUp",value:function(e){var t=e.data,n=t.key,i=t.native,r=e.cancelable;return{type:"key-up",key:n,native:i,timestamp:e.timestamp,cancelable:r,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapPointer",value:function(e,t){var n=e.data,i=n.x,r=n.y,a=n.button,o=n.buttons,s=n.native,u=n.eventId,l=s.pointerId,c=s.pointerType,d=e.cancelable;return{type:t,x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:o,native:s,timestamp:e.timestamp,eventId:u,cancelable:d,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapPointerDrag",value:function(e){var t=e.data.currentEvent,n=t.x,i=t.y,r=t.buttons,a=t.native,o=t.eventId,s=e.data.startEvent.button,u=e.data.startEvent.native.pointerId,l=e.data.startEvent.native.pointerType,c=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},h=e.cancelable;return{type:"pointer-drag",x:n,y:i,pointerId:u,pointerType:l,button:s,buttons:r,action:c,origin:d,native:a,timestamp:e.timestamp,eventId:o,cancelable:h,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapMouseWheel",value:function(e){var t=e.cancelable,n=e.data,i=e.timestamp;return{type:"mouse-wheel",x:n.x,y:n.y,deltaY:n.deltaY,native:n.native,timestamp:i,cancelable:t,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapGamepad",value:function(e){var t=e.data,n=t.action,i=t.state,r=t.device,a=e.cancelable;return{type:"gamepad",device:r,timestamp:e.timestamp,action:n,buttons:i.buttons,axes:i.axes,cancelable:a,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}}]),n}(Le);!function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"}(yi||(yi={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(gi||(gi={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(mi||(mi={}));var ki=g.s.getLogger("esri.views.interactive.interactiveToolUtils");function bi(e){return e.visible&&e.getEditableFlag(yi.USER)&&e.getEditableFlag(yi.MANAGER)}function Mi(e){return(0,j.c)(e.x,e.y)}function Ei(e){return(0,j.i)(e.x,e.y)}function xi(e,t){var n=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return(0,j.c)(t.clientX-n.left,t.clientY-n.top)}function Ti(e,t){return t instanceof Event?xi(e,t):Mi(t)}function Ci(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}var Pi=function(){function e(){(0,p.Z)(this,e),this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}return(0,v.Z)(e,[{key:"cursor",get:function(){return this._cursor}},{key:"handleInputEvent",value:function(e,t){var n=function(){return e.stopPropagation()};switch(e.type){case"pointer-move":Ii(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(n(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":if(!Zi(e))break;var i=Mi(e),r=this._intersect(i,e.pointerType,t.forEachTool);if((0,_.t)(r))break;var a=this._findToolAndManipulatorByKey(r,t.forEachTool,Ai),o=(0,_.h)(a,(function(e){return e.manipulator})),s=(0,_.h)(a,(function(e){return e.tool}));!((0,_.r)(o)&&(0,_.r)(s)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,s,e),(0,_.r)(o)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{key:r,start:i,pointerType:e.pointerType}),1===this._grabbedManipulators.size&&t.activeTool!==r.tool&&(this._currentlyActiveTool=t.activeTool,this._revertToActiveTool=!0,t.setActiveTool(r.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:i}),n());break;case"pointer-up":this._handlePointerEnd(e,t);break;case"pointer-drag":if(!Zi(e))break;var u=this._grabbedManipulators.get(e.pointerId),l=this._draggedManipulators.get(e.pointerId),c=(0,_.h)(u||l,(function(e){return e.key})),d=this._findManipulatorByKey(c,t.forEachTool);if((0,_.t)(d))break;var h=Mi(e);h.x=(0,K.o)(h.x,0,t.view.width),h.y=(0,K.o)(h.y,0,t.view.height);var p=(0,_.e)(u||l).start;switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(d.dragging=!0,l?d.events.emit("drag",{action:"update",start:p,screenPoint:h}):d.events.emit("drag",{action:"start",start:p,screenPoint:h,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{key:(0,_.e)(c),start:p}));break;case"end":d.dragging=!1,l&&d.events.emit("drag",{action:"end",start:p,screenPoint:h}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}n();break;case"immediate-click":var v=Mi(e),f=this._intersect(v,e.pointerType,t.forEachTool),y=this._findToolAndManipulatorByKey(f,t.forEachTool,Ai);if(function(e){return!!e.native.shiftKey}(e)||t.forEachTool((function(e){if((!(0,_.r)(y)||y.tool!==e||e.automaticManipulatorSelection)&&e.manipulators){var t=!1;e.manipulators.forEach((function(e){var n=e.manipulator;n.selected&&(n.selected=!1,t=!0)})),t&&e.manipulatorSelectionChanged&&e.manipulatorSelectionChanged()}})),(0,_.t)(y))break;var g=y.manipulator,m=y.tool;if(!g.interactive)break;g.selectable&&m.automaticManipulatorSelection&&(g.selected=!g.selected,m.manipulatorSelectionChanged&&m.manipulatorSelectionChanged());var w=e.native.shiftKey;g.events.emit("immediate-click",{screenPoint:v,button:e.button,pointerType:e.pointerType,shiftKey:w,stopPropagation:n});break;case"click":var k=Mi(e),b=this._intersect(k,e.pointerType,t.forEachTool),M=this._findManipulatorByKey(b,t.forEachTool);if((0,_.t)(M)||!M.interactive)break;var E=e.native.shiftKey;M.events.emit(e.type,{screenPoint:k,button:e.button,pointerType:e.pointerType,shiftKey:E}),n();break;case"double-click":var x=Mi(e),T=this._intersect(x,e.pointerType,t.forEachTool),C=this._findManipulatorByKey(T,t.forEachTool);if((0,_.t)(C)||!C.interactive)break;var P=e.native.shiftKey;C.events.emit("double-click",{screenPoint:x,button:e.button,pointerType:e.pointerType,shiftKey:P,stopPropagation:n});break;case"immediate-double-click":var I=Mi(e),Z=this._intersect(I,e.pointerType,t.forEachTool),A=this._findManipulatorByKey(Z,t.forEachTool);if((0,_.t)(A)||!A.interactive)break;var S=e.native.shiftKey;A.events.emit("immediate-double-click",{screenPoint:I,button:e.button,pointerType:e.pointerType,shiftKey:S,stopPropagation:n})}this._onFocusChange(t.forEachTool)}},{key:"_ungrabManipulatorBeforeDragging",value:function(e,t,n){var i=this;e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:n.pointerType,screenPoint:Mi(n)}),this._grabbedManipulators.forEach((function(n,r){var a=n.key;a.tool===t&&t.manipulators.findById(a.manipulatorId)===e&&i._grabbedManipulators.delete(r)}))}},{key:"_handlePointerEnd",value:function(e,t){var n=(0,_.h)(this._grabbedManipulators.get(e.pointerId),(function(e){return e.key})),i=this._findManipulatorByKey(n,t.forEachTool);(0,_.r)(i)&&!i.dragging&&(1===this._grabbedManipulators.size&&0===this._draggedManipulators.size&&this._revertToActiveTool&&(t.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Mi(e)})),this._grabbedManipulators.delete(e.pointerId))}},{key:"_cursorFromMap",value:function(e,t){var n=this,i=null;return(0,g.af)(e,(function(e){var r=e.key,a=n._findManipulatorByKey(r,t);return!!((0,_.r)(a)&&a.interactive&&"cursor"in a&&a.cursor)&&(i=a.cursor,!0)})),i}},{key:"_onFocusChange",value:function(e){this._updateCursor(e),this._updateFocusedManipulatorTools(e)}},{key:"_updateCursor",value:function(e){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,e)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,e)||"pointer":this._cursor=null}},{key:"_updateFocusedManipulatorTools",value:function(e){var t=new Set;this._grabbedManipulators.forEach((function(e){var n=e.key.tool;t.add(n)})),this._hoveredManipulators.forEach((function(e){var n=e.key.tool;t.add(n)})),e((function(e){e.hasFocusedManipulators=t.has(e)}))}},{key:"clearPointers",value:function(e,t){var n=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,a=function(t){return t.tool===e&&((0,_.t)(r)||t.manipulatorId===r)};this._grabbedManipulators.forEach((function(e,i){var r=e.key,o=e.pointerType;if(a(r)){n._grabbedManipulators.delete(i);var s=n._findManipulatorByKey(r,t);(0,_.r)(s)&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:o}))}})),this._draggedManipulators.forEach((function(e,i){var r=e.key;if(a(r)){n._draggedManipulators.delete(i);var o=n._findManipulatorByKey(r,t);(0,_.r)(o)&&(o.dragging=!1,o.events.emit("drag",{action:"cancel"}))}})),i&&this._hoveredManipulators.forEach((function(e,i){var r=e.key;if(a(r)){n._hoveredManipulators.delete(i);var o=n._findManipulatorByKey(r,t);(0,_.r)(o)&&(o.hovering=!1)}})),this._onFocusChange(t)}},{key:"_intersect",value:function(e,t,n){var i=null;return n((function(n){if(null==n.manipulators||!bi(n))return!1;var r=n.manipulators.intersect(e,t);return!(0,_.t)(r)&&(i={manipulatorId:r.id,tool:n},!0)})),i}},{key:"updateHoveredStateFromKnownPointers",value:function(e){var t=this;this._pointerLocations.forEach((function(n,i){t._updateHoveredStateForPointerAtScreenPosition((0,j.c)(n.x,n.y),i,n.pointerType,e)}))}},{key:"handleHoverEvent",value:function(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!Ii(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Mi(e),e.pointerId,e.pointerType,t)}},{key:"_updateHoveredStateForPointerAtScreenPosition",value:function(e,t,n,i){var r=this._intersect(e,n,i),a=this._findManipulatorByKey(r,i),o=(0,_.h)(this._hoveredManipulators.get(t),(function(e){return e.key})),s=this._findManipulatorByKey(o,i);(0,_.r)(a)&&!a.interactive&&(a=null),s!==a&&((0,_.r)(s)&&(s.hovering=!1),(0,_.r)(a)?(a.hovering=!0,this._hoveredManipulators.set(t,{key:(0,_.e)(r)})):this._hoveredManipulators.delete(t),this._onFocusChange(i))}},{key:"_findManipulatorByKey",value:function(e,t){return this._findToolAndManipulatorByKey(e,t,Ai)?Ai.manipulator:null}},{key:"_findToolAndManipulatorByKey",value:function(e,t,n){return(0,_.t)(e)?null:(n.tool=null,n.manipulator=null,t((function(t){if(t!==e.tool||null==t.manipulators||!bi(t))return!1;var i=t.manipulators.findById(e.manipulatorId);return!!(0,_.r)(i)&&(n.manipulator=i,n.tool=t,!0)})),n.manipulator?n:null)}}]),e}();function Ii(e){return"mouse"===e}function Zi(e){return"mouse"!==e.pointerType||0===e.button}var Ai={manipulator:null,tool:null},Si=g.s.getLogger("esri.views.ToolViewManager"),Ri="attached",Fi="tools",Li=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._manipulatorState=new Pi,i.tools=new b.j,i.cursor=null,i._forEachTool=function(e){var t,n=(0,d.Z)(i.tools.items);try{for(n.s();!(t=n.n()).done;){if(e(t.value))return}}catch(r){n.e(r)}finally{n.f()}},i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.handles.add([this.view.on(pi,(function(t){e._handleInputEvent(t)}),Ge.TOOL)].concat((0,o.Z)(function(e){return[e.on("before-add",(function(t){var n=t.item;if(null==n||e.includes(n))return ki.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();n.onAdd()})),e.on("after-remove",(function(e){var t=e.item;t.visible=!1,t.active&&(t.view.activeTool=null),t.destroy()}))]}(this.tools)),[this.tools.on("before-remove",(function(t){var n=t.item;e._manipulatorState.clearPointers(n,e._forEachTool)})),this.tools.on("change",(function(){e._refreshToolWatchers()}))]))}},{key:"destroy",value:function(){this.detach(),this.handles.removeAll()}},{key:"activeTool",set:function(e){if(!(0,_.r)(e)||this.view.ready){if(e!==this.activeTool){var t=this.activeTool;this._set("activeTool",e),(0,_.r)(t)&&t.deactivate(),(0,_.r)(e)&&e.activate(),this._removeIncompleteTools(e);var n,i=(0,_.t)(this.activeTool),r=(0,d.Z)(this.tools);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.setEditableFlag(yi.MANAGER,i||a===this.activeTool);var o=bi(a);!i&&o||this._manipulatorState.clearPointers(a,this._forEachTool,!o)}}catch(s){r.e(s)}finally{r.f()}this._updateCursor()}}else Si.error("Cannot set active tool while view is not ready.")}},{key:"updating",get:function(){var e,t;return this.updatingHandles.updating||this.tools.some((function(e){return e.updating}))||null!==(e=null===(t=this.textures)||void 0===t?void 0:t.updating)&&void 0!==e&&e}},{key:"attach",value:function(){var e=this;"3d"===this.view.type?(this._set("textures",new hi(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([(0,w.l)((function(){var t=e.view.state;return"camera"in t&&t.camera}),(function(){e._forEachManipulator((function(e){null!=e.onViewChange&&e.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(function(t){e._forEachManipulator((function(e){null!=e.onElevationChange&&e.onElevationChange(t)}))})),(0,g.g)((function(){return e._set("textures",(0,_.l)(e.textures))}))],Ri)):this.handles.add((0,w.l)((function(){return e.view.extent}),(function(){e._forEachManipulator((function(e){null!=e.onViewChange&&e.onViewChange()}))})))}},{key:"detach",value:function(){(0,_.r)(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(Ri)}},{key:"_forEachManipulator",value:function(e){this._forEachTool((function(t){t.manipulators&&t.manipulators.forEach((function(n){var i=n.manipulator;return e(i,t)}))}))}},{key:"_handleInputEvent",value:function(e){var t=this,n=!1,i=(0,h.Z)((0,h.Z)({},e),{},{stopPropagation:function(){n=!0,e.stopPropagation()}});(0,_.r)(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool((function(e){!n&&e.visible&&e.handleInputEvent(i)})),!n&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:function(e){t.activeTool=e},view:this.view}),!n&&(0,_.r)(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}},{key:"_refreshToolWatchers",value:function(){var e=this;this.handles.remove(Fi),this._forEachTool((function(t){if(t instanceof g.y){var n=(0,w.l)((function(){return[t.cursor,t.visible,t.editable]}),(function(){bi(t)||e._manipulatorState.clearPointers(t,e._forEachTool),e._updateCursor()}));e.handles.add(n,Fi)}t.manipulators&&e.handles.add(t.manipulators.on("change",(function(n){n.removed.forEach((function(n){var i=n.id;e._manipulatorState.clearPointers(t,e._forEachTool,!0,i)})),e._manipulatorState.updateHoveredStateFromKnownPointers(e._forEachTool),e._updateCursor()})),Fi)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}},{key:"_updateCursor",value:function(){var e=this._manipulatorState.cursor,t=e;this._forEachTool((function(n){return!(!(0,_.r)(n.cursor)||!n.visible||!(0,_.t)(e)&&n.preferManipulatorCursor)&&(t=n.cursor,!0)})),this._get("cursor")!==t&&this._set("cursor",t)}},{key:"_removeIncompleteTools",value:function(e){var t=this;this.tools.filter((function(t){return((0,_.t)(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel})).forEach((function(e){t.tools.remove(e)}))}}]),n}(M.d);(0,g.e)([(0,g.d)({constructOnly:!0,nonNullable:!0})],Li.prototype,"view",void 0),(0,g.e)([(0,g.d)({readOnly:!0,nonNullable:!0})],Li.prototype,"textures",void 0),(0,g.e)([(0,g.d)({value:null})],Li.prototype,"activeTool",null),(0,g.e)([(0,g.d)({readOnly:!0,type:b.j})],Li.prototype,"tools",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],Li.prototype,"cursor",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],Li.prototype,"updating",null);var Oi=Li=(0,g.e)([(0,g.n)("esri.views.ToolViewManager")],Li),Di=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this)).nativeIndex=null,i._detectedDeviceType="unknown","standard"===e.mapping?i._detectedDeviceType="standard":Vi.test(e.id)?i._detectedDeviceType="spacemouse":i._detectedDeviceType="unknown",i.nativeIndex=e.index,i}return(0,v.Z)(n,[{key:"native",get:function(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}},{key:"deviceType",get:function(){return this._detectedDeviceType}},{key:"axisThreshold",get:function(){return Ni[this.deviceType]}}]),n}(g.y);(0,g.e)([(0,g.d)({nonNullable:!0,readOnly:!0})],Di.prototype,"nativeIndex",void 0),(0,g.e)([(0,g.d)({type:String,readOnly:!0})],Di.prototype,"deviceType",null),(0,g.e)([(0,g.d)({type:Number,readOnly:!0})],Di.prototype,"axisThreshold",null),Di=(0,g.e)([(0,g.n)("esri.views.input.gamepad.GamepadInputDevice")],Di);var Vi=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Ni={standard:.15,spacemouse:.025,unknown:0},zi=Di,Ui=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;(0,p.Z)(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).devices=new b.j,e.enabledFocusMode="document",e}return(0,v.Z)(n)}(g.y);(0,g.e)([(0,g.d)({type:b.j.ofType(zi),readOnly:!0})],Ui.prototype,"devices",void 0),(0,g.e)([(0,g.d)({type:["document","view","none"]})],Ui.prototype,"enabledFocusMode",void 0);var Bi=Ui=(0,g.e)([(0,g.n)("esri.views.input.gamepad.GamepadSettings")],Ui),Gi=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;return(0,p.Z)(this,n),(e=t.apply(this,arguments)).gamepad=new Bi,e}return(0,v.Z)(n)}(g.y);(0,g.e)([(0,g.d)({readOnly:!0})],Gi.prototype,"gamepad",void 0);var Hi=Gi=(0,g.e)([(0,g.n)("esri.views.input.Input")],Gi),ji=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).enabled=!0,i.device=null,i.mode="pan",i.tiltDirection="forward-down",i.velocityFactor=1,i}return(0,v.Z)(n)}(g.y);(0,g.e)([(0,g.d)({type:Boolean,nonNullable:!0})],ji.prototype,"enabled",void 0),(0,g.e)([(0,g.d)({type:zi})],ji.prototype,"device",void 0),(0,g.e)([(0,g.d)({type:["pan","zoom"],nonNullable:!0})],ji.prototype,"mode",void 0),(0,g.e)([(0,g.d)({type:["forward-down","forward-up"],nonNullable:!0})],ji.prototype,"tiltDirection",void 0),(0,g.e)([(0,g.d)({type:Number,nonNullable:!0})],ji.prototype,"velocityFactor",void 0);var Wi=ji=(0,g.e)([(0,g.n)("esri.views.navigation.gamepad.GamepadSettings")],ji),qi=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).browserTouchPanEnabled=!0,i.gamepad=new Wi,i.momentumEnabled=!0,i.mouseWheelZoomEnabled=!0,i}return(0,v.Z)(n)}(g.y);(0,g.e)([(0,g.d)({type:Boolean})],qi.prototype,"browserTouchPanEnabled",void 0),(0,g.e)([(0,g.d)({type:Wi,nonNullable:!0})],qi.prototype,"gamepad",void 0),(0,g.e)([(0,g.d)({type:Boolean})],qi.prototype,"momentumEnabled",void 0),(0,g.e)([(0,g.d)({type:Boolean})],qi.prototype,"mouseWheelZoomEnabled",void 0);var Ki,Qi=qi=(0,g.e)([(0,g.n)("esri.views.navigation.Navigation")],qi),Yi=null;function Xi(e){return Ji.apply(this,arguments)}function Ji(){return Ji=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Yi||(Yi=n.e(7603).then(n.bind(n,87603)).then((function(e){return Ki=e}))),e.next=3,Yi;case 3:(0,g.H)(t);case 4:case"end":return e.stop()}}),e)}))),Ji.apply(this,arguments)}function $i(e,t,n,i){return er.apply(this,arguments)}function er(){return er=(0,u.Z)((0,s.Z)().mark((function e(t,n,i,r){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(a=t.spatialReference,!(0,X.e)()&&!(0,X.A)(a,n)){e.next=7;break}e.t0=(0,X.r)(t,n),e.next=15;break;case 7:if(!Ki){e.next=11;break}e.t1=Ki.projectGeometry(t,n,i,r),e.next=14;break;case 11:return e.next=13,Promise.race([Xi(r),(0,X.t)(r)]);case 13:e.t1=$i(t,n,i,r);case 14:e.t0=e.t1;case 15:return e.abrupt("return",e.t0);case 16:case"end":return e.stop()}}),e)}))),er.apply(this,arguments)}var tr,nr=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).required={tileInfo:!1,heightModelInfo:!1,extent:!1},i.defaultSpatialReference=null,i.userSpatialReference=null,i.sourcePreloadCount=10,i.priorityCollection=null,i.requiresExtentInSpatialReference=!0,i.suspended=!1,i._projectExtentTask={task:null,input:null,output:null,spatialReference:null},i}return(0,v.Z)(n,[{key:"destroy",value:function(){this._projectExtentTask.task&&(this._projectExtentTask.task=(0,_.C)(this._projectExtentTask.task)),this._set("map",null)}},{key:"ready",get:function(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}},{key:"heightModelInfoReady",get:function(){return!this._heightModelInfoTask.updating}},{key:"spatialReference",get:function(){return(0,_.r)(this.userSpatialReference)?this.userSpatialReference:(0,_.e)(this._spatialReferenceTask.spatialReference)}},{key:"extent",get:function(){return(0,_.e)(this._extentTask.extent)}},{key:"heightModelInfo",get:function(){return(0,_.e)(this._heightModelInfoTask.heightModelInfo)}},{key:"vcsWkid",get:function(){return(0,_.e)(this._heightModelInfoTask.vcsWkid)}},{key:"latestVcsWkid",get:function(){return(0,_.e)(this._heightModelInfoTask.latestVcsWkid)}},{key:"viewingMode",get:function(){return(0,_.t)(this.userSpatialReference)||this.userSpatialReference.equals((0,_.e)(this._spatialReferenceTask.spatialReference))?(0,_.e)(this._spatialReferenceTask.viewingMode):null}},{key:"tileInfo",get:function(){return(0,_.e)(this._tileInfoTask.tileInfo)}},{key:"mapCollections",get:function(){var e,t,n,i,r=null===(e=this.map)||void 0===e?void 0:e.call(this),a=[];return(0,_.r)(this.priorityCollection)&&a.push(this.priorityCollection),a.push({parent:null===r||void 0===r?void 0:r.basemap,layers:null===r||void 0===r||null===(t=r.basemap)||void 0===t?void 0:t.baseLayers},{layers:null===r||void 0===r?void 0:r.layers},{parent:null===r||void 0===r?void 0:r.ground,layers:null===r||void 0===r||null===(n=r.ground)||void 0===n?void 0:n.layers},{parent:null===r||void 0===r?void 0:r.basemap,layers:null===r||void 0===r||null===(i=r.basemap)||void 0===i?void 0:i.referenceLayers}),a}},{key:"_allLayers",get:function(){return this._collectLayers(this.mapCollections)}},{key:"_spatialReferenceTask",get:function(){var e;if(this.suspended)return null!==(e=this._get("_spatialReferenceTask"))&&void 0!==e?e:{updating:!1};var t,n=this._allLayers,i=n.layers,r=n.updating,a=null,o=(0,d.Z)(i);try{for(o.s();!(t=o.n()).done;){var s=t.value,u=this._getSupportedSpatialReferences(s);if(u.length>0){var l=this._narrowDownSpatialReferenceCandidates(a,u);(0,_.r)(l)&&(a=l)}if((0,_.r)(a)&&1===a.length)break}}catch(h){o.e(h)}finally{o.f()}if(r&&((0,_.t)(a)||1!==a.length))return{updating:!0};var c=this._pickSpatialReferenceCandidate(a);return{spatialReference:(0,_.r)(c)?c.spatialReference:null,viewingMode:(0,_.r)(c)?c.viewingMode:null,updating:!1}}},{key:"_tileInfoTask",get:function(){var e,t,n,i,r,a,o,s;if(!this.required.tileInfo)return null!==(e=this._get("_tileInfoTask"))&&void 0!==e?e:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};var u=this._collectLayers([{parent:null===(t=this.map)||void 0===t||null===(n=t.call(this))||void 0===n?void 0:n.basemap,layers:null===(i=this.map)||void 0===i||null===(r=i.call(this))||void 0===r||null===(a=r.basemap)||void 0===a?void 0:a.baseLayers},{layers:null===(o=this.map)||void 0===o||null===(s=o.call(this))||void 0===s?void 0:s.layers}]),l=u.layers,c=u.updating;if(l&&l.length>0&&"tileInfo"in l[0]){var d=l[0].tileInfo;return{tileInfo:d&&d.spatialReference.equals(this.spatialReference)?d:null,updating:!1}}return{updating:c}}},{key:"_heightModelInfoTask",get:function(){var e,t;if(!this.required.heightModelInfo||this.suspended&&null!==(e=this._get("_heightModelInfoTask"))&&void 0!==e&&e.heightModelInfo)return null!==(t=this._get("_heightModelInfoTask"))&&void 0!==t?t:{updating:!1};var n,i=this._allLayers,r=i.layers,a=i.updating,o=(0,d.Z)(r);try{for(o.s();!(n=o.n()).done;){var s=n.value;if((0,Q.g)(s)){var u,l,c=(0,Q.h)(s);if(c)return{heightModelInfo:c,vcsWkid:null===(u=s.spatialReference)||void 0===u?void 0:u.vcsWkid,latestVcsWkid:null===(l=s.spatialReference)||void 0===l?void 0:l.latestVcsWkid,updating:!1}}}}catch(h){o.e(h)}finally{o.f()}return{updating:a}}},{key:"_extentCandidatesTask",get:function(){var e,t=this;if(this.suspended||!this.required.extent)return null!==(e=this._get("_extentCandidatesTask"))&&void 0!==e?e:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};var n,i=this._allLayers,r=i.updating,a=[],o=(0,d.Z)(i.layers);try{for(o.s();!(n=o.n()).done;){var s,u=n.value,l="fullExtents"in u&&u.fullExtents||((0,_.r)(u.fullExtent)?[u.fullExtent]:[]),c=this.requiresExtentInSpatialReference?null:l[0],h=null!==(s=l.find((function(e){return e.spatialReference.equals(t.spatialReference)})))&&void 0!==s?s:c;if(h)return{candidates:[{extent:h,layer:u}],updating:!1};if(this._getSupportedSpatialReferences(u).length>0){var p,v=(0,d.Z)(l);try{for(v.s();!(p=v.n()).done;){var f=p.value;a.push({extent:f,layer:u})}}catch(y){v.e(y)}finally{v.f()}}}}catch(y){o.e(y)}finally{o.f()}return{candidates:a,updating:r}}},{key:"_extentTask",get:function(){var e=this,t=this._extentCandidatesTask,n=t.candidates,i=t.updating;if(i)return{updating:i};if((0,_.t)(n)||0===n.length)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};var r=this._pickExtentCandidate(n),a=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&a.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:(0,_.r)(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:((0,_.r)(this._projectExtentTask.task)&&(this._projectExtentTask.task=(0,_.C)(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:a.clone(),task:(0,g.al)(function(){var t=(0,u.Z)((0,s.Z)().mark((function t(n){var i;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,$i(r.extent,a,r.layer.portalItem,n);case 3:i=t.sent,e._projectExtentTask=(0,h.Z)((0,h.Z)({},e._projectExtentTask),{},{task:null,output:i}),t.next=12;break;case 7:if(t.prev=7,t.t0=t.catch(0),!(0,g.p)(n)){t.next=11;break}return t.abrupt("return");case 11:e._projectExtentTask=(0,h.Z)((0,h.Z)({},e._projectExtentTask),{},{task:null});case 12:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}())},{updating:!0})}},{key:"_narrowDownSpatialReferenceCandidates",value:function(e,t){if((0,_.t)(e))return t;var n,i=[],r=function(e,t){return(0,_.r)(e)?(0,_.r)(t)?e===t&&e:e:t},a=(0,d.Z)(e);try{for(a.s();!(n=a.n()).done;){var o,s=n.value,u=(0,d.Z)(t);try{for(u.s();!(o=u.n()).done;){var l=o.value;if(s.spatialReference.equals(l.spatialReference)){var c=r(s.viewingMode,l.viewingMode);if(!1!==c){i.push({spatialReference:s.spatialReference,viewingMode:c});break}}}}catch(h){u.e(h)}finally{u.f()}}}catch(h){a.e(h)}finally{a.f()}return i.length>0?i:null}},{key:"_pickSpatialReferenceCandidate",value:function(e){var t=this.defaultSpatialReference;return(0,_.t)(e)||e.length<1?(0,_.r)(t)?{spatialReference:t,viewingMode:null}:null:((0,_.r)(t)&&e.length>1&&e.some((function(e){return e.spatialReference.equals(t)}))&&(e=e.filter((function(e){return e.spatialReference.equals(t)}))),e.length>1&&e.some((function(e){return e.viewingMode!==Y.l.Local}))&&(e=e.filter((function(e){return e.viewingMode!==Y.l.Local}))),e[0])}},{key:"_getSupportedSpatialReferences",value:function(e){var t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return[];var n,i=[],r=(0,d.Z)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value,o=this.getSpatialReferenceSupport({spatialReference:a,layer:e});if((0,_.r)(o)){var s,u=(0,_.r)(o.constraints)?o.constraints:[{spatialReference:a,viewingMode:null}],l=(0,d.Z)(u);try{for(l.s();!(s=l.n()).done;){var c=s.value,h=c.spatialReference,p=c.viewingMode;(!this.requiresExtentInSpatialReference||(0,_.t)(this.userSpatialReference)||h.equals(this.userSpatialReference))&&i.push({spatialReference:h,viewingMode:p})}}catch(v){l.e(v)}finally{l.f()}}}}catch(v){r.e(v)}finally{r.f()}return i}},{key:"_pickExtentCandidate",value:function(e){var t=this.spatialReference;return e.find((function(e){var n=e.extent;return t.equals(n.spatialReference)}))||e[0]}},{key:"_collectLayers",value:function(e){var t;if("loaded"!==this._loadMaybe(null===(t=this.map)||void 0===t?void 0:t.call(this)))return{layers:[],updating:!0};var n,i={layers:[],preloading:-1,updating:!1},r=(0,d.Z)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(this._collectCollection(a,i),i.preloading===this.sourcePreloadCount)break}}catch(o){r.e(o)}finally{r.f()}return{layers:i.layers,updating:i.updating}}},{key:"_collectCollection",value:function(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}var n,i=(0,d.Z)(e.layers);try{for(i.s();!(n=i.n()).done;){var r=n.value;switch(this._loadMaybe(r)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}catch(a){i.e(a)}finally{i.f()}}}},{key:"_loadMaybe",value:function(e){return e&&"loadStatus"in e?"not-loaded"===e.loadStatus?(e.load(),"loading"):e.loadStatus:"loaded"}}]),n}(g.y);(0,g.e)([(0,g.d)()],nr.prototype,"required",void 0),(0,g.e)([(0,g.d)({constructOnly:!0})],nr.prototype,"map",void 0),(0,g.e)([(0,g.d)({constructOnly:!0})],nr.prototype,"getSpatialReferenceSupport",void 0),(0,g.e)([(0,g.d)()],nr.prototype,"defaultSpatialReference",void 0),(0,g.e)([(0,g.d)()],nr.prototype,"userSpatialReference",void 0),(0,g.e)([(0,g.d)()],nr.prototype,"sourcePreloadCount",void 0),(0,g.e)([(0,g.d)()],nr.prototype,"priorityCollection",void 0),(0,g.e)([(0,g.d)()],nr.prototype,"requiresExtentInSpatialReference",void 0),(0,g.e)([(0,g.d)()],nr.prototype,"suspended",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"ready",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"heightModelInfoReady",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"spatialReference",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"extent",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"heightModelInfo",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"vcsWkid",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"latestVcsWkid",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"viewingMode",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"tileInfo",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"mapCollections",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"_allLayers",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"_spatialReferenceTask",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"_tileInfoTask",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"_heightModelInfoTask",null),(0,g.e)([(0,g.d)({readOnly:!0})],nr.prototype,"_extentCandidatesTask",null),(0,g.e)([(0,g.d)()],nr.prototype,"_extentTask",null),(0,g.e)([(0,g.d)()],nr.prototype,"_projectExtentTask",void 0),nr=(0,g.e)([(0,g.n)("esri.views.support.DefaultsFromMap")],nr);var ir=g.s.getLogger("esri.views.View"),rr=tr=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._userSpatialReference=null,i._cursor=null,i.allLayerViews=new N.p({getCollections:function(){var e,t,n;return[null===(e=i.basemapView)||void 0===e?void 0:e.baseLayerViews,null===(t=i.groundView)||void 0===t?void 0:t.layerViews,i.layerViews,null===(n=i.basemapView)||void 0===n?void 0:n.referenceLayerViews]},getChildrenFunction:function(e){return e.layerViews}}),i.groundView=null,i.animation=null,i.basemapView=null,i.fatalError=null,i.extent=null,i.graphics=new B.c,i.analyses=new ii,i.navigating=!1,i.typeSpecificPreconditionsReady=!0,i.layerViews=new b.j,i.magnifier=new di,i.padding={left:0,top:0,right:0,bottom:0},i.ready=!1,i.spatialReferenceWarningDelay=1e3,i.supportsGround=!0,i.timeExtent=null,i.type=null,i.scale=null,i.updating=!1,i.initialExtentRequired=!0,i.input=new Hi,i.navigation=new Qi,i.layerViewManager=null,i.analysisViewManager=null,i.isHeightModelInfoRequired=!1,i.width=null,i.height=null,i.resizing=!1,i.suspended=!1,i.viewEvents=new _i((0,l.Z)(i)),i.persistableViewModels=new b.j,i._isValid=!1,i._readyCycleForced=!1,i.handles.add((0,w.l)((function(){return i.preconditionsReady}),(function(e){var t,n;e?(i._currentSpatialReference=i.spatialReference,tr.views.add((0,l.Z)(i))):(i._currentSpatialReference=null,tr.views.remove((0,l.Z)(i))),i.notifyChange("spatialReference"),!e&&i.ready?(null!==(t=i.layerViewManager)&&void 0!==t&&t.clear(),null!==(n=i.toolViewManager)&&void 0!==n&&n.detach(),(0,_.r)(i.analysisViewManager)&&i.analysisViewManager.detach(),i._teardown()):e&&!i.ready&&(i._startup(),(0,_.r)(i.analysisViewManager)&&i.analysisViewManager.attach(),i.toolViewManager.attach())}),w.U)),i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.addResolvingPromise(this.validate().then((function(){return e._isValid=!0,(0,w.j)((function(){return e.ready}))}))),this.basemapView=new ri({view:this}),this.layerViewManager=new ui({view:this,layerViewImporter:{importLayerView:function(t){return e.importLayerView(t)},hasLayerViewModule:function(t){return e.hasLayerViewModule(t)}},supportsGround:this.supportsGround}),this.toolViewManager=new Oi({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([(0,w.l)((function(){return e.initialExtentRequired}),(function(t){return e.defaultsFromMap.required=(0,h.Z)((0,h.Z)({},e.defaultsFromMap.required),{},{extent:t})}),{sync:!0,initial:!0}),(0,w.l)((function(){return e.ready}),(function(t){e.defaultsFromMap&&(e.defaultsFromMap.suspended=t,e.defaultsFromMap.userSpatialReference=t?e.spatialReference:e._userSpatialReference)}),{sync:!0}),(0,w.l)((function(){return e._userSpatialReference}),(function(t){e.defaultsFromMap&&(e.defaultsFromMap.userSpatialReference=t)}),{sync:!0,initial:!0})])}},{key:"_setupSpatialReferenceLogger",value:function(){var e=this,t=null;this.handles.add([(0,w.l)((function(){var t;return null===(t=e.defaultsFromMap)||void 0===t?void 0:t.ready}),(function(n){var i,r=(null===(i=e.map)||void 0===i?void 0:i.allLayers.length)>0;if(n&&!e.spatialReference&&r){if((0,_.r)(t))return;var a=(0,g.g)((function(){return t=(0,_.C)(t)}));t=(0,g.al)(function(){var n=(0,u.Z)((0,s.Z)().mark((function n(i){return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,g.L)(e.spatialReferenceWarningDelay,null,i);case 3:n.next=8;break;case 5:return n.prev=5,n.t0=n.catch(0),n.abrupt("return");case 8:return n.prev=8,t=null,n.finish(8);case 11:ir.warn("#spatialReference","no spatial reference could be derived from the currently added map layers");case 12:case"end":return n.stop()}}),n,null,[[0,5,8,11]])})));return function(e){return n.apply(this,arguments)}}()),e.handles.add(a,"spatial-reference-logger-task")}else e.handles.remove("spatial-reference-logger-task")}),{sync:!0})])}},{key:"destroy",value:function(){if(!this.destroyed){this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=(0,_.l)(this.graphics),this.analyses=(0,_.l)(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),(0,_.l)(this.analysisViewManager),this.toolViewManager=(0,_.l)(this.toolViewManager),this.layerViewManager=(0,_.l)(this.layerViewManager),this.basemapView=(0,_.l)(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();var e=this.map;this.map=null,null===e||void 0===e||e.destroy()}}},{key:"_startup",value:function(){this._set("ready",!0)}},{key:"_teardown",value:function(){this._set("ready",!1)}},{key:"whenReady",value:function(){return Promise.resolve(this)}},{key:"toMap",value:function(){return ir.error("#toMap()","Not implemented on this instance of View"),null}},{key:"_defaultsFromMapSettings",get:function(){return{}}},{key:"defaultsFromMap",get:function(){var e=this;return new nr((0,h.Z)({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:function(){return e.map},getSpatialReferenceSupport:function(t){return e.getSpatialReferenceSupport(t)}},this._defaultsFromMapSettings))}},{key:"heightModelInfo",get:function(){return this.getDefaultHeightModelInfo()}},{key:"interacting",get:function(){return this.navigating}},{key:"preconditionsReady",get:function(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||z.m.isLoadable(this.map)&&!this.map.loaded||0===this.width||0===this.height||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&(null===(e=this.defaultsFromMap)||void 0===e||!e.ready)||!this.typeSpecificPreconditionsReady)}},{key:"map",set:function(e){var t;e!==this._get("map")&&(null!==(t=e)&&void 0!==t&&t.destroyed&&(ir.warn("#map","The provided map is already destroyed",{map:e}),e=null),z.m.isLoadable(e)&&e.load().catch((function(){})),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}},{key:"spatialReference",get:function(){var e,t,n=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return n&&null!==(e=this.defaultsFromMap)&&void 0!==e&&null!==(t=e.required)&&void 0!==t&&t.heightModelInfo&&((n=n.clone()).vcsWkid=this.defaultsFromMap.vcsWkid,n.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),n},set:function(e){var t=!(0,I.E)(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}},{key:"_spatialReferenceChanged",value:function(e){}},{key:"stationary",get:function(){return!this.animation&&!this.navigating&&!this.resizing}},{key:"initialExtent",get:function(){var e;return null===(e=this.defaultsFromMap)||void 0===e?void 0:e.extent}},{key:"cursor",get:function(){var e=this.toolViewManager?this.toolViewManager.cursor:null;return(0,_.r)(e)?e:this._cursor||"default"},set:function(e){this._cursor=e,this.notifyChange("cursor")}},{key:"size",get:function(){return[this.width,this.height]}},{key:"whenLayerView",value:function(e){return this.layerViewManager.whenLayerView(e)}},{key:"getDefaultSpatialReference",value:function(){var e;return null===(e=this.defaultsFromMap)||void 0===e?void 0:e.spatialReference}},{key:"getDefaultHeightModelInfo",value:function(){var e,t,n;return null!==(e=null!==(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)&&void 0!==t?t:null===(n=this.defaultsFromMap)||void 0===n?void 0:n.heightModelInfo)&&void 0!==e?e:null}},{key:"importLayerView",value:function(e){throw new g.a("importLayerView() not implemented")}},{key:"hasLayerViewModule",value:function(e){return!1}},{key:"validate",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"invalidate",value:function(){this._isValid=!1}},{key:"getSpatialReferenceSupport",value:function(){return{constraints:null}}},{key:"_validateSpatialReference",value:function(e){return(0,_.r)(this.getSpatialReferenceSupport({spatialReference:e}))}},{key:"when",value:function(e,t){return this.isResolved()&&!this.ready&&ir.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),(0,i.Z)((0,r.Z)(n.prototype),"when",this).call(this,e,t)}},{key:"forceReadyCycle",value:function(){var e=this;this.ready&&((0,w.f)((function(){return!1===e.preconditionsReady}),(function(){return e._readyCycleForced=!1}),{once:!0}),this._readyCycleForced=!0)}},{key:"addAndActivateTool",value:function(e){this.toolViewManager.tools.add(e),this.activeTool=e}},{key:"tryFatalErrorRecovery",value:function(){this.fatalError=null}}]),n}((0,M.a)(b.n.EventedMixin((0,U.m)(g.y))));rr.views=new b.j,(0,g.e)([(0,g.d)()],rr.prototype,"_userSpatialReference",void 0),(0,g.e)([(0,T.o)("toolViewManager.activeTool")],rr.prototype,"activeTool",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"allLayerViews",void 0),(0,g.e)([(0,g.d)()],rr.prototype,"groundView",void 0),(0,g.e)([(0,g.d)()],rr.prototype,"animation",void 0),(0,g.e)([(0,g.d)()],rr.prototype,"basemapView",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"_defaultsFromMapSettings",null),(0,g.e)([(0,g.d)()],rr.prototype,"defaultsFromMap",null),(0,g.e)([(0,g.d)()],rr.prototype,"fatalError",void 0),(0,g.e)([(0,g.d)({type:G.M})],rr.prototype,"extent",void 0),(0,g.e)([(0,g.d)((0,B.a)(B.c,"graphics"))],rr.prototype,"graphics",void 0),(0,g.e)([(0,g.d)((0,B.a)(ii,"analyses"))],rr.prototype,"analyses",void 0),(0,g.e)([(0,g.d)({readOnly:!0,type:H.v})],rr.prototype,"heightModelInfo",null),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"interacting",null),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"navigating",void 0),(0,g.e)([(0,g.d)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],rr.prototype,"preconditionsReady",null),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"typeSpecificPreconditionsReady",void 0),(0,g.e)([(0,g.d)({type:b.j,readOnly:!0})],rr.prototype,"layerViews",void 0),(0,g.e)([(0,g.d)({type:di})],rr.prototype,"magnifier",void 0),(0,g.e)([(0,g.d)({value:null,type:D.L})],rr.prototype,"map",null),(0,g.e)([(0,g.d)()],rr.prototype,"padding",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"ready",void 0),(0,g.e)([(0,g.d)({type:I.k})],rr.prototype,"spatialReference",null),(0,g.e)([(0,g.d)()],rr.prototype,"spatialReferenceWarningDelay",void 0),(0,g.e)([(0,g.d)()],rr.prototype,"stationary",null),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"supportsGround",void 0),(0,g.e)([(0,g.d)({type:V.y})],rr.prototype,"timeExtent",void 0),(0,g.e)([(0,T.o)("toolViewManager.tools")],rr.prototype,"tools",void 0),(0,g.e)([(0,g.d)()],rr.prototype,"toolViewManager",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"type",void 0),(0,g.e)([(0,g.d)({type:Number})],rr.prototype,"scale",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"updating",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"initialExtentRequired",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"initialExtent",null),(0,g.e)([(0,g.d)()],rr.prototype,"cursor",null),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"input",void 0),(0,g.e)([(0,g.d)({type:Qi,nonNullable:!0})],rr.prototype,"navigation",void 0),(0,g.e)([(0,g.d)()],rr.prototype,"layerViewManager",void 0),(0,g.e)([(0,g.d)()],rr.prototype,"analysisViewManager",void 0),(0,g.e)([(0,g.d)()],rr.prototype,"width",void 0),(0,g.e)([(0,g.d)()],rr.prototype,"height",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"resizing",void 0),(0,g.e)([(0,g.d)({value:null,readOnly:!0})],rr.prototype,"size",null),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"suspended",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"viewEvents",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],rr.prototype,"persistableViewModels",void 0),(0,g.e)([(0,g.d)()],rr.prototype,"_isValid",void 0),(0,g.e)([(0,g.d)()],rr.prototype,"_readyCycleForced",void 0),(0,g.e)([(0,g.d)()],rr.prototype,"_currentSpatialReference",void 0);var ar=rr=tr=(0,g.e)([(0,g.n)("esri.views.View")],rr),or=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).state="running",i.target=null,i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.addResolvingPromise(new Promise((function(t,n){return e._dfd={resolve:t,reject:n}})))}},{key:"done",get:function(){return"finished"===this.state||"stopped"===this.state}},{key:"stop",value:function(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._dfd.reject(new g.a("ViewAnimation stopped")))}},{key:"finish",value:function(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._dfd.resolve())}},{key:"update",value:function(e,t){t||(t=(0,g.D)(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}}]),n}(U._);(0,g.e)([(0,g.d)({readOnly:!0})],or.prototype,"done",null),(0,g.e)([(0,g.d)({readOnly:!0,type:String})],or.prototype,"state",void 0),(0,g.e)([(0,g.d)()],or.prototype,"target",void 0),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}((or=(0,g.e)([(0,g.n)("esri.views.ViewAnimation")],or))||(or={}));var sr=or;function ur(){return[1,0,0,1,0,0]}Object.freeze(Object.defineProperty({__proto__:null,create:ur,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]},fromValues:function(e,t,n,i,r,a){return[e,t,n,i,r,a]},createView:function(e,t){return new Float64Array(e,t,6)}},Symbol.toStringTag,{value:"Module"}));var lr=39.37,cr=180/Math.PI;function dr(e){return e.wkid?e:e.spatialReference||I.k.WGS84}function hr(e,t){return t.type?(0,ne.r)(e,t.x,t.y):(0,ne.a)(e,t)}function pr(e){return(0,ae.z)(e)}function vr(e,t){var n=Math.max(1,t[0]),i=Math.max(1,t[1]);return Math.max(e.width/n,e.height/i)*function(e){return(0,I.I)(e)?pr(e)*lr*96:1}(e.spatialReference)}function fr(e,t,n,i){return yr.apply(this,arguments)}function yr(){return yr=(0,u.Z)((0,s.Z)().mark((function e(t,n,i,r){var a,o,u,l,c,h,p,v,f,y,g,m,w,k,M,E,x,T,C,P,Z,A,S,R,F,L,O,D,V;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(!Array.isArray(t)||t.length){e.next=4;break}return e.abrupt("return",null);case 4:if(b.j.isCollection(t)&&(t=t.toArray()),!Array.isArray(t)||!t.length||"object"!=typeof t[0]){e.next=39;break}if(u=t.every((function(e){return"attributes"in e})),l=t.some((function(e){return!e.geometry})),c=t,!(u&&l&&n&&n.allLayerViews)){e.next=20;break}h=new Map,p=(0,d.Z)(t);try{for(p.s();!(v=p.n()).done;)f=v.value,y=f.layer,g=h.get(y)||[],null!=(m=f.attributes[y.objectIdField])&&g.push(m),h.set(y,g)}catch(s){p.e(s)}finally{p.f()}return w=[],h.forEach((function(e,t){var i=n.allLayerViews.find((function(e){return e.layer.id===t.id}));if("queryFeatures"in i){var r=t.createQuery();r.objectIds=e,r.returnGeometry=!0,w.push(i.queryFeatures(r))}})),e.next=15,Promise.all(w);case 15:k=e.sent,M=[],E=(0,d.Z)(k);try{for(E.s();!(x=E.n()).done;)if((T=x.value)&&T.features&&T.features.length){C=(0,d.Z)(T.features);try{for(C.s();!(P=C.n()).done;)Z=P.value,(0,_.r)(Z.geometry)&&M.push(Z.geometry)}catch(s){C.e(s)}finally{C.f()}}}catch(s){E.e(s)}finally{E.f()}c=M;case 20:A=(0,d.Z)(c),e.prev=21,A.s();case 23:if((S=A.n()).done){e.next=30;break}return R=S.value,e.next=27,fr(R,n,i,r);case 27:r=e.sent;case 28:e.next=23;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(21),A.e(e.t0);case 35:return e.prev=35,A.f(),e.finish(35);case 38:return e.abrupt("return",r);case 39:if(!Array.isArray(t)||2!==t.length||"number"!=typeof t[0]||"number"!=typeof t[1]){e.next=43;break}a=new I.j(t),e.next=61;break;case 43:if(!(t instanceof I.p)){e.next=47;break}a=t,e.next=61;break;case 47:if(!("geometry"in t)){e.next=61;break}if(!t.geometry){e.next=52;break}a=t.geometry,e.next=61;break;case 52:if(!t.layer){e.next=61;break}if(F=t.layer,L=n.allLayerViews.find((function(e){return e.layer.id===F.id})),!("queryFeatures"in L)){e.next=61;break}return(O=F.createQuery()).objectIds=[t.attributes[F.objectIdField]],O.returnGeometry=!0,e.next=59,L.queryFeatures(O);case 59:D=e.sent,a=(0,_.p)(D,"features",0,"geometry");case 61:if(!(0,_.t)(a)){e.next=63;break}return e.abrupt("return",null);case 63:if(o="point"===a.type?new G.M({xmin:a.x,ymin:a.y,xmax:a.x,ymax:a.y,spatialReference:a.spatialReference}):a.extent){e.next=65;break}return e.abrupt("return",null);case 65:if(e.t1=(0,X.e)()||(0,X.A)(o.spatialReference,i),e.t1){e.next=69;break}return e.next=69,(0,X.t)();case 69:return V=(0,X.r)(o,i),e.abrupt("return",V?r=r?r.union(V):V:null);case 71:case"end":return e.stop()}}),e,null,[[21,32,35,38]])}))),yr.apply(this,arguments)}function gr(e){if(e&&(!Array.isArray(e)||"number"!=typeof e[0])&&("object"==typeof e||Array.isArray(e)&&"object"==typeof e[0])){if("layer"in e&&e.layer&&e.layer.minScale&&e.layer.maxScale){var t=e.layer;return{min:t.minScale,max:t.maxScale}}if(Array.isArray(e)&&e.length&&e.every((function(e){return"layer"in e}))){var n,i=0,r=0,a=(0,d.Z)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value.layer;o&&o.minScale&&o.maxScale&&(i=o.minScale<i?o.minScale:i,r=o.maxScale>r?o.maxScale:r)}}catch(s){a.e(s)}finally{a.f()}return i&&r?{min:i,max:r}:null}}}function mr(e,t){return(0,I.E)(dr(e),t)?e:(0,X.r)(e,t)}function _r(e,t){return wr.apply(this,arguments)}function wr(){return wr=(0,u.Z)((0,s.Z)().mark((function e(t,n){var i,r,a,o,u,l,c,d,h,p,v,f,y,g;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}return e.abrupt("return",new J.u({targetGeometry:new I.j,scale:0,rotation:0}));case 2:if(i=n.spatialReference,r=n.constraints,a=n.padding,o=n.viewpoint,u=n.size,l=[a?u[0]-a.left-a.right:u[0],a?u[1]-a.top-a.bottom:u[1]],c=null,t instanceof J.u?c=t:t.viewpoint?c=t.viewpoint:t.target&&"esri.Viewpoint"===t.target.declaredClass&&(c=t.target),d=null,!c||!c.targetGeometry){e.next=11;break}d=c.targetGeometry,e.next=35;break;case 11:if(!(t instanceof G.M)){e.next=15;break}d=t,e.next=35;break;case 15:if(e.t0=t||t&&("center"in t||"extent"in t||"target"in t),!e.t0){e.next=35;break}return e.next=19,fr(t.center,n,i);case 19:if(e.t3=e.sent,e.t3){e.next=24;break}return e.next=23,fr(t.extent,n,i);case 23:e.t3=e.sent;case 24:if(e.t2=e.t3,e.t2){e.next=29;break}return e.next=28,fr(t.target,n,i);case 28:e.t2=e.sent;case 29:if(e.t1=e.t2,e.t1){e.next=34;break}return e.next=33,fr(t,n,i);case 33:e.t1=e.sent;case 34:d=e.t1;case 35:if(!d&&o&&o.targetGeometry?d=o.targetGeometry:!d&&n.extent&&(d=n.extent),i||(i=dr(n.spatialReference||n.extent||d)),e.t4=(0,X.e)()||(0,I.E)(d.spatialReference,i)||(0,X.A)(d,i),e.t4){e.next=41;break}return e.next=41,(0,X.t)();case 41:return h=mr(d.center?d.center:d,i),p=null,c&&(0,_.r)(c.targetGeometry)&&"point"===c.targetGeometry.type?p=c.scale:"scale"in t&&t.scale?p=t.scale:"zoom"in t&&-1!==t.zoom&&r&&r.effectiveLODs?p=r.zoomToScale(t.zoom):Array.isArray(d)||"point"===d.type||"extent"===d.type&&0===d.width&&0===d.height?(v=mr(n.extent,i),p=(0,_.r)(v)?vr(v,l):n.extent?vr(n.extent,l):o.scale):p=vr(mr(d.extent,i),l),(f=gr(t))&&(f.min&&f.min>p?p=f.min:f.max&&f.max<p&&(p=f.max)),y=0,c?y=c.rotation:t.hasOwnProperty("rotation")?y=t.rotation:o&&(y=o.rotation),g=new J.u({targetGeometry:h,scale:p,rotation:y}),e.abrupt("return",(r&&(g=r.fit(g),r.constrainByGeometry(g),r.rotationEnabled||(g.rotation=y)),g));case 50:case"end":return e.stop()}}),e)}))),wr.apply(this,arguments)}function kr(e,t){var n=e.targetGeometry,i=t.targetGeometry;return n.x=i.x,n.y=i.y,n.spatialReference=i.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}function br(e,t,n){return n?(0,ne.r)(e,.5*(t[0]-n.right+n.left),.5*(t[1]-n.bottom+n.top)):(0,ne.l)(e,t,.5)}var Mr=function(){var e=(0,re.n)();return function(t,n,i){var r=n.targetGeometry;hr(e,r);var a=.5*Cr(n);return t.xmin=e[0]-a*i[0],t.ymin=e[1]-a*i[1],t.xmax=e[0]+a*i[0],t.ymax=e[1]+a*i[1],t.spatialReference=r.spatialReference,t}}();function Er(e,t,n,i,r){return Lr(e,t,n.center),e.scale=vr(n,i),r&&r.constraints&&r.constraints.constrain(e),e}var xr=function(){var e=(0,re.n)();return function(t,n,i){return(0,ne.C)(t,function(e,t){return(0,ne.l)(e,t,.5)}(t,n),br(e,n,i))}}(),Tr=function(){var e=[1,0,0,1,0,0],t=(0,re.n)();return function(n,i,r,a){var o=Cr(i),s=Pr(i);return(0,ne.r)(t,o,o),(0,ee.M)(e,t),(0,ee.e)(e,e,s),(0,ee.i)(e,e,xr(t,r,a)),(0,ee.i)(e,e,[0,a.top-a.bottom]),(0,ne.r)(n,e[4],e[5])}}();function Cr(e){return e.scale*function(e){return(0,_.r)(e)&&(0,I.I)(e.spatialReference)?1/(pr(e.spatialReference)*lr*96):1}(e.targetGeometry)}function Pr(e){return(0,K.c)(e.rotation)||0}var Ir=function(){var e=(0,re.n)(),t=(0,re.n)(),n=(0,re.n)();return function(i,r,a,o,s,u){return(0,ne.x)(e,r),(0,ne.l)(t,a,.5*u),(0,ne.r)(n,1/o*u,-1/o*u),(0,ee.f)(i,t),s&&(0,ee.e)(i,i,s),(0,ee.c)(i,i,n),(0,ee.i)(i,i,e),i}}(),Zr=function(){var e=(0,re.n)();return function(t,n,i,r){var a=Cr(n),o=Pr(n);return hr(e,n.targetGeometry),Ir(t,e,i,a,o,r)}}(),Ar=function(){var e=(0,re.n)();return function(t,n,i,r){var a=Cr(n);return hr(e,n.targetGeometry),Ir(t,e,i,a,0,r)}}();function Sr(e){var t=(0,I.b)(e);return t?t.valid[1]-t.valid[0]:0}var Rr=function(){var e=(0,re.n)(),t=(0,re.n)(),n=[0,0,0];return function(i,r,a){(0,ne.o)(e,i,r),(0,ne.v)(e,e),(0,ne.o)(t,i,a),(0,ne.v)(t,t),(0,ne.y)(n,e,t);var o=Math.acos((0,ne.j)(e,t)/((0,ne.q)(e)*(0,ne.q)(t)))*cr;return n[2]<0&&(o=-o),isNaN(o)&&(o=0),o}}(),Fr=function(){var e=(0,re.n)();return function(t,n,i,r){var a=t.targetGeometry;return kr(t,n),Tr(e,n,i,r),a.x+=e[0],a.y+=e[1],t}}(),Lr=function(e,t,n){kr(e,t);var i=e.targetGeometry;return i.x=n.x,i.y=n.y,i.spatialReference=n.spatialReference,e},Or=function(){var e=(0,re.n)();return function(t,n,i,r,a){a||(a="center"),(0,ne.C)(e,i,r),(0,ne.l)(e,e,.5);var o=e[0],s=e[1];switch(a){case"center":(0,ne.r)(e,0,0);break;case"left":(0,ne.r)(e,-o,0);break;case"top":(0,ne.r)(e,0,s);break;case"right":(0,ne.r)(e,o,0);break;case"bottom":(0,ne.r)(e,0,-s);break;case"top-left":(0,ne.r)(e,-o,s);break;case"bottom-left":(0,ne.r)(e,-o,-s);break;case"top-right":(0,ne.r)(e,o,s);break;case"bottom-right":(0,ne.r)(e,o,-s)}return Wr(t,n,e),t}}();function Dr(e,t,n){return kr(e,t),e.rotation+=n,e}function Vr(e,t,n){return kr(e,t),e.rotation=n,e}var Nr=function(){var e=(0,re.n)();return function(t,n,i,r,a){return kr(t,n),isNaN(i)||0===i||(Hr(e,r,n,a),t.scale=n.scale*i,jr(e,e,t,a),Wr(t,t,(0,ne.r)(e,e[0]-r[0],r[1]-e[1]))),t}}();function zr(e,t,n){return kr(e,t),e.scale=n,e}var Ur,Br=function(){var e=(0,re.n)();return function(t,n,i,r,a,o){return kr(t,n),isNaN(i)||0===i||(Hr(e,a,n,o),t.scale=n.scale*i,t.rotation+=r,jr(e,e,t,o),Wr(t,t,(0,ne.r)(e,e[0]-a[0],a[1]-e[1]))),t}}(),Gr=function(){var e=(0,re.n)(),t=(0,re.n)();return function(n,i,r,a,o,s,u){return xr(t,s,u),(0,ne.s)(e,o,t),a?Br(n,i,r,a,e,s):Nr(n,i,r,e,s)}}(),Hr=function(){var e=[1,0,0,1,0,0];return function(t,n,i,r){return(0,ne.z)(t,n,function(e,t,n,i){return Zr(e,t,n,i),(0,ee.r)(e,e)}(e,i,r,1))}}(),jr=function(){var e=[1,0,0,1,0,0];return function(t,n,i,r){return(0,ne.z)(t,n,Zr(e,i,r,1))}}(),Wr=function(){var e=(0,re.n)(),t=[1,0,0,1,0,0];return function(n,i,r){kr(n,i);var a=Cr(i),o=n.targetGeometry;return(0,ee.h)(t,Pr(i)),(0,ee.c)(t,t,(0,re.r)(a,a)),(0,ne.z)(e,r,t),o.x+=e[0],o.y+=e[1],n}}();function qr(){var e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function Kr(e){var t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Qr(e,t,n,i,r,a,o,s,u){var l=new Float32Array(9);return l[0]=e,l[1]=t,l[2]=n,l[3]=i,l[4]=r,l[5]=a,l[6]=o,l[7]=s,l[8]=u,l}function Yr(e){return function(e){return e instanceof Float32Array&&e.length>=2}(e)||function(e){return Array.isArray(e)&&e.length>=2}(e)}Object.freeze(Object.defineProperty({__proto__:null,create:qr,clone:Kr,fromValues:Qr,createView:function(e,t){return new Float32Array(e,t,9)}},Symbol.toStringTag,{value:"Module"}));var Xr=[0,0],Jr=Ur=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._viewpoint2D={center:(0,re.n)(),rotation:0,scale:0,spatialReference:null},i.center=[0,0],i.extent=new G.M,i.id=0,i.inverseTransform=[1,0,0,1,0,0],i.resolution=0,i.rotation=0,i.scale=0,i.transform=[1,0,0,1,0,0],i.transformNoRotation=[1,0,0,1,0,0],i.displayMat3=qr(),i.displayViewMat3=qr(),i.viewMat3=qr(),i.viewMat2d=(0,ee.n)(),i.worldScreenWidth=0,i.size=[0,0],i}return(0,v.Z)(n,[{key:"pixelRatio",set:function(e){this._set("pixelRatio",e),this._update()}},{key:"size",set:function(e){this._set("size",e),this._update()}},{key:"viewpoint",set:function(e){if(e){var t=this._viewpoint2D,n=e.targetGeometry;t.center[0]=n.x,t.center[1]=n.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=n.spatialReference}this._update()}},{key:"copy",value:function(e){var t=this.size,n=this.viewpoint;return n&&t?(this.viewpoint=kr(n,e.viewpoint),this._set("size",(0,ne.a)(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}},{key:"clone",value:function(){return new Ur({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}},{key:"toMap",value:function(e,t,n){return Yr(t)?(0,ne.z)(e,t,this.inverseTransform):(Xr[0]=t,Xr[1]=n,(0,ne.z)(e,Xr,this.inverseTransform))}},{key:"toScreen",value:function(e,t,n){return Yr(t)?(0,ne.z)(e,t,this.transform):(Xr[0]=t,Xr[1]=n,(0,ne.z)(e,Xr,this.transform))}},{key:"toScreenNoRotation",value:function(e,t,n){return Yr(t)?(0,ne.z)(e,t,this.transformNoRotation):(Xr[0]=t,Xr[1]=n,(0,ne.z)(e,Xr,this.transformNoRotation))}},{key:"getScreenTransform",value:function(e,t){var n=this._viewpoint2D.center,i=this._get("pixelRatio")||1,r=this._get("size");return Ir(e,n,r,t,0,i),e}},{key:"_update",value:function(){var e=this._viewpoint2D,t=e.center,n=e.spatialReference,i=e.scale,r=e.rotation,a=this._get("pixelRatio")||1,o=this._get("size"),s=new J.u({targetGeometry:new I.j(t[0],t[1],n),scale:i,rotation:r});if(this._set("viewpoint",s),o&&n&&i){this.resolution=Cr(s),this.rotation=r,this.scale=i,this.spatialReference=n,(0,ne.a)(this.center,t);var u=0!==o[0]?2/o[0]:0,l=0!==o[1]?-2/o[1]:0;(0,te.s)(this.displayMat3,u,0,0,0,l,0,-1,1,1);var c=(0,te.r)(this.viewMat3),d=(0,ie.t)(o[0]/2,o[1]/2),h=(0,ie.t)(-o[0]/2,-o[1]/2),p=(0,K.c)(r);(0,te.M)(c,c,d),(0,te.h)(c,c,p),(0,te.M)(c,c,h),(0,te.i)(this.displayViewMat3,this.displayMat3,c);var v=(0,ee.f)(this.viewMat2d,d);return(0,ee.e)(v,v,p),(0,ee.i)(v,v,h),Mr(this.extent,s,o),Zr(this.transform,s,o,a),(0,ee.r)(this.inverseTransform,this.transform),Ar(this.transformNoRotation,s,o,a),this.worldScreenWidth=function(e,t){return Math.round(Sr(e)/t)}(this.spatialReference,this.resolution),this._set("id",this.id+1),this}}}]),n}($.l);(0,g.e)([(0,g.d)({readOnly:!0})],Jr.prototype,"id",void 0),(0,g.e)([(0,g.d)({value:1,json:{write:!0}})],Jr.prototype,"pixelRatio",null),(0,g.e)([(0,g.d)({json:{write:!0}})],Jr.prototype,"size",null),(0,g.e)([(0,g.d)()],Jr.prototype,"spatialReference",void 0),(0,g.e)([(0,g.d)({type:J.u,json:{write:!0}})],Jr.prototype,"viewpoint",null);var $r=Jr=Ur=(0,g.e)([(0,g.n)("esri.views.2d.ViewState")],Jr);function ea(e,t){switch(t){case"primary":return"touch"===e.pointerType||0===e.button;case"secondary":return"touch"!==e.pointerType&&2===e.button;case"tertiary":return"touch"!==e.pointerType&&1===e.button}}function ta(e,t){if("touch"===e.pointerType)return!1;switch(t){case"primary":return 0===e.button;case"secondary":return 2===e.button;case"tertiary":return 1===e.button}}var na=function(){function e(t){(0,p.Z)(this,e),this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=function(){return!0})}return(0,v.Z)(e,[{key:"handle",value:function(e){var t=e.data,n=t.pointers.size;switch(t.action){case"start":this.currentCount=n,this._emitStart(e);break;case"added":this._emitEnd(this.previousEvent),this.currentCount=n,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this.startEvent&&this._emitEnd(this.previousEvent),this.currentCount=n,this._emitStart(e);break;case"end":this._emitEnd(e),this.currentCount=0}this.previousEvent=e}},{key:"_emitStart",value:function(e){this.startEvent=e,this.callbacks.condition(this.currentCount,e)&&this.callbacks.start(this.currentCount,e,this.startEvent)}},{key:"_emitUpdate",value:function(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.update(this.currentCount,e,this.startEvent)}},{key:"_emitEnd",value:function(e){this.callbacks.condition(this.currentCount,e)&&this.callbacks.end(this.currentCount,e,this.startEvent),this.startEvent=null}}]),e}();function ia(e){var t=e*e;return e<0&&(t*=-1),t}function ra(e){return e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0,e}function aa(e,t,n){var i=n,r=e.state,a=e.device,o="forward-down"===t.tiltDirection?1:-1;return"standard"===a.deviceType?(i.translation[0]=ia(r.axes[0]),i.translation[1]=ia(r.axes[1]),i.translation[2]=ia(r.buttons[7])-ia(r.buttons[6]),i.heading=ia(r.axes[2]),i.tilt=ia(r.axes[3])):"spacemouse"===a.deviceType&&(i.translation[0]=1.2*ia(r.axes[0]),i.translation[1]=1.2*ia(r.axes[1]),i.translation[2]=2*-ia(r.axes[2]),i.heading=1.2*ia(r.axes[5]),i.tilt=1.2*ia(r.axes[3])),i.tilt*=o,(0,K.q)(i.translation,i.translation,1),i}function oa(e,t){var n=t;return n.translation[0]=e[1]-e[0],n.translation[1]=e[3]-e[2],n.translation[2]=e[4]-e[5],n.heading=e[7]-e[6],n.tilt=e[8]-e[9],n.zoom=e[10]-e[11],n}function sa(e){return 0===e.translation[0]&&0===e.translation[1]&&0===e.translation[2]&&0===e.heading&&0===e.tilt&&0===e.zoom}function ua(e){var t=e.native;return t?{buttons:t.buttons.map((function(e){return e.pressed?e.value?e.value:1:0})),axes:t.axes.map((function(t){return function(e,t){var n=Math.abs(e);return n<t?0:Math.sign(e)*(n-t)/(1-t)}(t,e.axisThreshold)}))}:{buttons:[],axes:[]}}var la=function(){function e(t,n){var i=this;(0,p.Z)(this,e),this.element=t,this.input=n,this._hasEventListeners=!1,this._onConnectGamepad=function(e){i._connectGamepad(e.gamepad)},this._onDisconnectGamepad=function(e){var t=e.gamepad,n=t.index,r=i.inputDevices[n];r&&(i._emitGamepadEvent(t,ua(r),!1),i.inputDevices.splice(n,1),i.latestUpdate.splice(n,1),i.input.gamepad.devices.remove(r),i.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;var r="getGamepads"in window.navigator,a=window.isSecureContext;this.supported=r&&a,this.supported&&(this._forEachGamepad((function(e){return i._connectGamepad(e)})),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}return(0,v.Z)(e,[{key:"destroy",value:function(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}},{key:"hasEventListeners",set:function(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}},{key:"eventsEnabled",get:function(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}},{key:"onEvent",set:function(e){this.callback=e}},{key:"_connectGamepad",value:function(e){var t=new zi(e);"unknown"!==t.deviceType&&(this.inputDevices[e.index]=t,this.input.gamepad.devices.add(t)),this.ensurePollingState()}},{key:"ensurePollingState",value:function(){this.eventsEnabled?this._startPolling():this._stopPolling()}},{key:"_startPolling",value:function(){var e=this;null==this.frameTask&&(this.frameTask=(0,g.ad)({update:function(){return e._readGamepadState()}}))}},{key:"_stopPolling",value:function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}},{key:"_readGamepadState",value:function(){var e=this,t=document.hasFocus(),n=this.element.contains(document.activeElement),i="document"===this.input.gamepad.enabledFocusMode&&!t||"view"===this.input.gamepad.enabledFocusMode&&!n;this._forEachGamepad((function(t){var n=e.inputDevices[t.index];if(n){var r=e.latestUpdate[t.index],a=ua(n),o=i||function(e){for(var t=0;t<e.axes.length;t++)if(0!==e.axes[t])return!1;for(var n=0;n<e.buttons.length;n++)if(0!==e.buttons[n])return!1;return!0}(a);if(r){if(r.timestamp===t.timestamp)return;if(!r.active&&o)return;if(function(e,t){if(e.axes.length!==t.axes.length)return!1;if(e.buttons.length!==t.buttons.length)return!1;for(var n=0;n<e.axes.length;n++)if(e.axes[n]!==t.axes[n])return!1;for(var i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}(r.state,a))return}e._emitGamepadEvent(t,a,!o)}}))}},{key:"_forEachGamepad",value:function(e){for(var t=window.navigator.getGamepads(),n=0;n<t.length;n++){var i=t[n];this._validate(i)&&e(i)}}},{key:"_emitGamepadEvent",value:function(e,t,n){var i=this.latestUpdate[e.index],r=i&&i.active;if(r||n){var a=!r&&n?"start":r&&n?"update":"end";this.latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:n},this.callback&&this.callback({device:this.inputDevices[e.index],state:t,action:a})}}},{key:"_validate",value:function(e){if(!e)return!1;if(!e.connected)return!1;for(var t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}}]),e}(),ca=(0,_.a)("trident"),da=(0,_.a)("edge"),ha=(0,_.a)("chrome"),pa=(0,_.a)("ff"),va=(0,_.a)("safari"),fa="esri-view-surface--touch-none",ya="esri-view-surface--touch-pan",ga=function(){function e(t,n){var i=this;(0,p.Z)(this,e),this.input=n,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new la(t,this.input),this._gamepadSource.onEvent=function(e){return i._callback("gamepad",e)}}return(0,v.Z)(e,[{key:"destroy",value:function(){var e=this;this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach((function(t){e._releasePointerCaptureSafe(t)})),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}},{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(e){this._callback=e}},{key:"activeEvents",set:function(e){var t=this;for(var n in this._active)if(!e||!e.has(n)){var i=this._active[n];this._element.removeEventListener(ma[n],i),delete this._active[n]}e&&e.forEach((function(e){if(!t._active[e]&&ma[e]){var n=(t._eventHandlers[e]||t._handleDefault).bind(t,e);t._element.addEventListener(ma[e],n),t._active[e]=n}})),this._gamepadSource.hasEventListeners=e&&e.has("gamepad")}},{key:"setPointerCapture",value:function(e,t){t?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}},{key:"_updateTouchAction",value:function(){this._element.classList.remove(this._browserTouchPanningEnabled?fa:ya),this._element.classList.add(this._browserTouchPanningEnabled?ya:fa)}},{key:"_updateTouchEventHandling",value:function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}},{key:"_removeTouchAction",value:function(){this._element.classList.remove(fa),this._element.classList.remove(ya),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}},{key:"_releasePointerCaptureSafe",value:function(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch(ua){}}},{key:"_updateNormalizedPointerLikeEvent",value:function(t,n){var i=xi(this._element,t);return e.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),n.x=i.x,n.y=i.y,n}},{key:"_handleKey",value:function(e,t){var n=function(e){if(void 0!==e.key)return(0,g.i)(e);var t=Pe[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}(t);n&&"key-up"===e&&this._keyDownState.delete(n);var i={native:t,key:n,repeat:n&&this._keyDownState.has(n)};n&&"key-down"===e&&this._keyDownState.add(i.key),this._callback(e,i)}},{key:"_handlePointer",value:function(e,t){var n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,n)}},{key:"_handlePointerPreventDefault",value:function(e,t){var n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,n)}},{key:"_handleMouseWheel",value:function(e,t){var n=t.deltaY;switch(t.deltaMode){case 0:(ca||da)&&(n=n/document.documentElement.clientHeight*600);break;case 1:n*=30;break;case 2:n*=900}ca||da?n*=.7:ha||va?n*=.6:pa&&(n*=1.375);var i=Math.abs(n);if(i>100){n=n/i*200/(1+Math.exp(-.02*(i-100)))}var r=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:n});this._callback(e,r)}},{key:"_handlePointerCaptureLost",value:function(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}},{key:"_handleDefault",value:function(e,t){var n={native:t};t.preventDefault(),this._callback(e,n)}},{key:"_preventAltKeyDefault",value:function(e){"Alt"===e.key&&e.preventDefault()}},{key:"_preventMultiTouchPanning",value:function(e){e.touches.length>1&&e.preventDefault()}}]),e}();ga.test={disableSubpixelCoordinates:!1};var ma={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"},_a=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;return(0,p.Z)(this,n),(e=t.call(this,!0)).registerIncoming("context-menu",(function(e){e.data.native.preventDefault()})),e}return(0,v.Z)(n)}(Le);function wa(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}var ka,ba={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35},Ma=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ba.maximumDoubleClickDelay,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ba.maximumDoubleClickDistance,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ba.maximumDoubleTouchDelay,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ba.maximumDoubleTouchDistance,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:g.ae;return(0,p.Z)(this,n),(e=t.call(this,!1)).maximumDoubleClickDelay=i,e.maximumDoubleClickDistance=r,e.maximumDoubleTouchDelay=a,e.maximumDoubleTouchDistance=o,e._clock=s,e._pointerState=new Map,e._click=e.registerOutgoing("click"),e._doubleClick=e.registerOutgoing("double-click"),e.registerIncoming("immediate-click",e._handleImmediateClick.bind((0,l.Z)(e))),e.registerIncoming("pointer-drag",e._handlePointerDrag.bind((0,l.Z)(e))),e.registerIncoming("drag",e._handleDrag.bind((0,l.Z)(e))),e}return(0,v.Z)(n,[{key:"onUninstall",value:function(){this._pointerState.forEach((function(e){return e.doubleClickTimeout=(0,_.d)(e.doubleClickTimeout)}))}},{key:"hasPendingInputs",get:function(){return(0,g.af)(this._pointerState,(function(e){return null!=e.doubleClickTimeout}))}},{key:"_pointerId",value:function(e){var t=e.native;return"mouse"===t.pointerType?"".concat(t.pointerId,":").concat(t.button):"".concat(t.pointerType)}},{key:"_handleImmediateClick",value:function(e){var t=e.data,n=this._pointerId(t),i=this._pointerState.get(n);if(i){var r="touch"===t.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;wa(i.event.data,t)>r?(this._clearDoubleClickTimeout(n,!0),this._startClick(e)):(this._clearDoubleClickTimeout(n,!1),this._doubleClick.emit(i.event.data,void 0,i.event.modifiers))}else this._startClick(e)}},{key:"_startClick",value:function(e){var t=this,n=this._pointerId(e.data),i="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(n,{event:e,doubleClickTimeout:this._clock.setTimeout((function(){return t._doubleClickTimeoutExceeded(n)}),i)}),this.refreshHasPendingInputs()}},{key:"_handlePointerDrag",value:function(e){var t=this._pointerId(e.data.currentEvent);this._clearDoubleClickTimeout(t,!0)}},{key:"_handleDrag",value:function(e){var t=this._pointerId(e.data.pointer);this._clearDoubleClickTimeout(t,!0)}},{key:"_clearDoubleClickTimeout",value:function(e,t){var n=this._pointerState.get(e);n&&(n.doubleClickTimeout.remove(),n.doubleClickTimeout=null,t&&this._doubleClickTimeoutExceeded(e),this._pointerState.delete(e),this.refreshHasPendingInputs())}},{key:"_doubleClickTimeoutExceeded",value:function(e){var t=this._pointerState.get(e);this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimeout=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}}]),n}(Le),Ea=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,!1)).navigationTouch=e,i.startStateModifiers=new Set,i.activePointerMap=new Map,i.isDragging=!1,i.isCurrentDragSuppressed=!1,i.drag=i.registerOutgoing("drag"),i.registerIncoming("pointer-drag",i._handlePointerDrag.bind((0,l.Z)(i))),i.registerIncoming("pointer-up",i._handlePointerUpAndPointerLost.bind((0,l.Z)(i))),i.registerIncoming("pointer-capture-lost",i._handlePointerUpAndPointerLost.bind((0,l.Z)(i))),i.registerIncoming("pointer-cancel",i._handlePointerUpAndPointerLost.bind((0,l.Z)(i))),i}return(0,v.Z)(n,[{key:"_createPayload",value:function(e,t,n,i){return{action:e,pointerType:this.pointerType,button:this.mouseButton,buttons:t.buttons,timestamp:i,pointers:Ca(this.activePointerMap),pointer:t,angle:n.angle,radius:n.radius,center:n.center}}},{key:"_addPointer",value:function(e){var t=e.native.pointerId,n=Ta(this.activePointerMap).angle,i={event:e,initialAngle:0,lastAngle:0};this.activePointerMap.set(t,i);var r=Pa(i,xa(this.activePointerMap));i.initialAngle=r,i.lastAngle=r,this._updatePointerAngles(n)}},{key:"_updatePointer",value:function(e){if(!e||null!=e.x||null!=e.y){var t=e.native.pointerId,n=this.activePointerMap.get(t);n?n.event=e:this._addPointer(e)}}},{key:"_removePointer",value:function(e){var t=Ta(this.activePointerMap).angle;this.activePointerMap.delete(e),this._updatePointerAngles(t)}},{key:"_updatePointerAngles",value:function(e){var t=Ta(this.activePointerMap);this.activePointerMap.forEach((function(n){n.initialAngle=Pa(n,t)-e,n.lastAngle=Pa(n,t)-e}))}},{key:"_emitEvent",value:function(e,t,n){var i=Ta(this.activePointerMap);this.drag.emit(this._createPayload(e,t,i,n),void 0,this.startStateModifiers)}},{key:"_handlePointerUpAndPointerLost",value:function(e){var t=e.data.native.pointerId,n=(0,g.am)(e.timestamp);this.activePointerMap.get(t)&&(1===this.activePointerMap.size?(this._updatePointer(e.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",e.data,n),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this._removePointer(t)):(this._removePointer(t),this._emitEvent("removed",e.data,(0,g.am)(e.timestamp))))}},{key:"_handlePointerDrag",value:function(e){var t=e.data,n=t.currentEvent,i=(0,g.am)(e.timestamp);switch(t.action){case"start":case"update":this.isDragging?this.activePointerMap.has(n.native.pointerId)?(this._updatePointer(n),!this.isCurrentDragSuppressed&&this._emitEvent("update",n,i)):(this._addPointer(n),this._emitEvent("added",n,i),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(n),this.pointerType=e.data.startEvent.pointerType,this.mouseButton=e.data.startEvent.button,this.startStateModifiers=e.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",n,i))}}},{key:"isSuppressed",get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}]),n}(Le);function xa(e){var t=[];return e.forEach((function(e){t.push((0,j.c)(e.event.x,e.event.y))})),function(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:(0,j.c)()},0===e.length)return t;if(1===e.length)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(2===e.length){var n=(0,a.Z)(e,2),i=n[0],r=n[1],o=r.x-i.x,s=r.y-i.y;return t.radius=Math.sqrt(o*o+s*s)/2,t.center.x=(i.x+r.x)/2,t.center.y=(i.y+r.y)/2,t}for(var u=0,l=0,c=0;c<e.length;c++)u+=e[c].x,l+=e[c].y;u/=e.length,l/=e.length;for(var d=e.map((function(e){return e.x-u})),h=e.map((function(e){return e.y-l})),p=0,v=0,f=0,y=0,g=0,m=0,_=0,w=0;w<d.length;w++){var k=d[w],b=h[w],M=k*k,E=b*b;p+=M,v+=E,f+=k*b,y+=M*k,g+=E*b,m+=k*E,_+=b*M}var x=.5*(y+m),T=.5*(g+_),C=p*v-f*f,P=(x*v-T*f)/C,I=(p*T-f*x)/C,Z=(0,j.c)(P+u,I+l);return{radius:Math.sqrt(P*P+I*I+(p+v)/e.length),center:Z}}(t)}function Ta(e){var t=xa(e),n=0;return e.forEach((function(e){for(var i=Pa(e,t),r=i-e.lastAngle;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;i=e.lastAngle+r,e.lastAngle=i;var a=i-e.initialAngle;n+=a})),{angle:n/=e.size||1,radius:t.radius,center:t.center}}function Ca(e){var t=new Map;return e.forEach((function(e,n){return t.set(n,e.event)})),t}function Pa(e,t){var n=e.event,i=n.x-t.center.x,r=n.y-t.center.y;return Math.atan2(r,i)}!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"}(ka||(ka={}));var Ia=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ba.maximumDoubleClickDelay,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ba.maximumDoubleClickDistance,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ba.maximumDoubleTouchDelay,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ba.maximumDoubleTouchDistance,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:g.ae;return(0,p.Z)(this,n),(e=t.call(this,!1)).maximumDoubleClickDelay=i,e.maximumDoubleClickDistance=r,e.maximumDoubleTouchDelay=a,e.maximumDoubleTouchDistance=o,e._clock=s,e._pointerState=new Map,e._immediateDoubleClick=e.registerOutgoing("immediate-double-click"),e.registerIncoming("pointer-down",e._handlePointerDown.bind((0,l.Z)(e))),e.registerIncoming("pointer-up",(function(t){e._handlePointerLoss(t,"pointer-up")})),e.registerIncoming("pointer-capture-lost",(function(t){e._handlePointerLoss(t,"pointer-capture-lost")})),e.registerIncoming("pointer-cancel",(function(t){e._handlePointerLoss(t,"pointer-cancel")})),e}return(0,v.Z)(n,[{key:"onUninstall",value:function(){this._pointerState.forEach((function(e){e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()})),(0,i.Z)((0,r.Z)(n.prototype),"onUninstall",this).call(this)}},{key:"_handlePointerDown",value:function(e){var t=e.data,n=this._pointerId(t);if(!this._pointerState.has(n)){var i={downButton:t.native.button,immediateDoubleClick:null};this._pointerState.set(n,i),this.startCapturingPointer(t.native)}}},{key:"_handlePointerLoss",value:function(e,t){var n=e.data,i=this._pointerId(n),r=this._pointerState.get(i);if(r&&"pointer-up"===t&&r.downButton===n.native.button){var a=r.immediateDoubleClick;if(a){a.timeoutHandle.remove();var o="touch"===e.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;wa(a,e.data)>o?this._startImmediateDoubleClick(e,r):(this._immediateDoubleClick.emit(e.data,void 0,a.modifiers),this._removeState(n))}else this._startImmediateDoubleClick(e,r)}}},{key:"_startImmediateDoubleClick",value:function(e,t){var n=this,i="touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout((function(){return n._removeState(e.data)}),i)}}},{key:"_pointerId",value:function(e){var t=e.native;return"mouse"===t.pointerType?"".concat(t.pointerId,":").concat(t.button):"".concat(t.pointerType)}},{key:"_removeState",value:function(e){var t=this._pointerId(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}}]),n}(Le),Za=300,Aa=1.5,Sa=6,Ra=6,Fa=500,La=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Za,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Aa,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Sa,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ra,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Fa,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:g.ae;return(0,p.Z)(this,n),(e=t.call(this,!1)).maximumClickDelay=i,e.movementUntilMouseDrag=r,e.movementUntilPenDrag=a,e.movementUntilTouchDrag=o,e.holdDelay=s,e._clock=u,e._pointerState=new Map,e._pointerDrag=e.registerOutgoing("pointer-drag"),e._immediateClick=e.registerOutgoing("immediate-click"),e._pointerHold=e.registerOutgoing("hold"),e.registerIncoming("pointer-down",e._handlePointerDown.bind((0,l.Z)(e))),e.registerIncoming("pointer-up",(function(t){e._handlePointerLoss(t,"pointer-up")})),e.registerIncoming("pointer-capture-lost",(function(t){e._handlePointerLoss(t,"pointer-capture-lost")})),e.registerIncoming("pointer-cancel",(function(t){e._handlePointerLoss(t,"pointer-cancel")})),e._moveHandle=e.registerIncoming("pointer-move",e._handlePointerMove.bind((0,l.Z)(e))),e._moveHandle.pause(),e}return(0,v.Z)(n,[{key:"onUninstall",value:function(){this._pointerState.forEach((function(e){null!=e.holdTimeout&&(e.holdTimeout.remove(),e.holdTimeout=null)})),(0,i.Z)((0,r.Z)(n.prototype),"onUninstall",this).call(this)}},{key:"_handlePointerDown",value:function(e){var t=this,n=e.data,i=n.native.pointerId,r=null;0===this._pointerState.size&&(r=this._clock.setTimeout((function(){var n=t._pointerState.get(i);if(n){if(!n.isDragging){var r=n.previousEvent;t._pointerHold.emit(r,void 0,e.modifiers),n.holdEmitted=!0}n.holdTimeout=null}}),this.holdDelay));var a={startEvent:n,previousEvent:n,startTimestamp:e.timestamp,isDragging:!1,downButton:n.native.button,holdTimeout:r,modifiers:new Set};this._pointerState.set(i,a),this.startCapturingPointer(n.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}},{key:"_createPointerDragData",value:function(e,t,n){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:n}}},{key:"_handlePointerMove",value:function(e){var t=e.data,n=t.native.pointerId,i=this._pointerState.get(n);i&&(i.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",i,t),void 0,i.modifiers):function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}(t,i.startEvent)>this._getDragThreshold(t.native.pointerType)&&this._startDragging(e),i.previousEvent=t)}},{key:"_getDragThreshold",value:function(e){switch(e){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}},{key:"_startDragging",value:function(e){var t=this,n=e.data,i=n.native.pointerId;this._pointerState.forEach((function(r){null!=r.holdTimeout&&(r.holdTimeout.remove(),r.holdTimeout=null),r.isDragging||(r.modifiers=e.modifiers,r.isDragging=!0,i===r.startEvent.native.pointerId?t._pointerDrag.emit(t._createPointerDragData("start",r,n)):t._pointerDrag.emit(t._createPointerDragData("start",r,r.previousEvent),e.timestamp))}))}},{key:"_handlePointerLoss",value:function(e,t){var n=e.data,i=n.native.pointerId,r=this._pointerState.get(i);r&&(null!=r.holdTimeout&&(r.holdTimeout.remove(),r.holdTimeout=null),r.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",r,"pointer-up"===t?n:r.previousEvent),void 0,r.modifiers):"pointer-up"===t&&r.downButton===n.native.button&&e.timestamp-r.startTimestamp<=this.maximumClickDelay&&!r.holdEmitted&&this._immediateClick.emit(n),this._pointerState.delete(i),this.stopCapturingPointer(n.native),0===this._pointerState.size&&this._moveHandle.pause())}}]),n}(Le);function Oa(e){var t=(0,oe.l)(e);if(!t.available)return new g.a("webgl:required","WebGL is required but not supported.");if("3d"===e&&t.majorPerformanceCaveat)return new g.a("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new g.a("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new g.a("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===se.o.WEBGL1){if(!t.supportsElementIndexUint)return new g.a("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new g.a("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new g.a("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}var Da="esri-component",Va=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;return(0,p.Z)(this,n),(e=t.apply(this,arguments)).widget=null,e}return(0,v.Z)(n,[{key:"destroy",value:function(){this.widget&&this.widget.destroy(),this.node=null}},{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(e){var t=this._get("node");e!==t&&(e&&e.classList.add(Da),t&&t.classList.remove(Da),this._set("node",e))}},{key:"castNode",value:function(e){return e?"string"==typeof e||function(e){return e&&"nodeType"in e}(e)?(this._set("widget",null),(0,k.a)(e)):(function(e){return e&&"function"==typeof e.render}(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}}]),n}(g.y);(0,g.e)([(0,g.d)({dependsOn:[]})],Va.prototype,"id",null),(0,g.e)([(0,g.d)()],Va.prototype,"node",null),(0,g.e)([(0,g.q)("node")],Va.prototype,"castNode",null),(0,g.e)([(0,g.d)({readOnly:!0})],Va.prototype,"widget",void 0);var Na=Va=(0,g.e)([(0,g.n)("esri.views.ui.Component")],Va),za={left:0,top:0,bottom:0,right:0},Ua={bottom:30,top:15,right:15,left:15},Ba="manual",Ga="esri-ui",Ha="esri-ui-corner",ja="esri-ui-inner-container",Wa="esri-ui-manual-container",qa="esri-ui-corner-container",Ka="esri-ui-top-left",Qa="esri-ui-top-right",Ya="esri-ui-bottom-left",Xa="esri-ui-bottom-right";function Ja(e){var t=e,n="object"==typeof t&&null!==t&&Object.getPrototypeOf(t);return null!==n&&n!==Object.prototype||!("component"in t||"index"in t||"position"in t)?null:e}function $a(e,t){var n=t.top,i=t.bottom,r=t.left,a=t.right;e.style.top=n,e.style.bottom=i,e.style.left=r,e.style.right=a}var eo=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._cornerNameToContainerLookup={},i._positionNameToContainerLookup={},i._components=new Array,i._componentToKey=new Map,i._handles=new m.u,i.view=null,i._applyViewPadding=function(){var e=i.container;e&&$a(e,i._toPxPosition(i._getViewPadding()))},i._applyUIPadding=function(){var e=i._innerContainer;e&&$a(e,i._toPxPosition(i.padding))},i._initContainers(),i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this._handles.add([(0,w.l)((function(){var t;return[null===(t=e.view)||void 0===t?void 0:t.padding,e.container]}),this._applyViewPadding,w.h),(0,w.l)((function(){return e.padding}),this._applyUIPadding,w.h)])}},{key:"destroy",value:function(){this.container=null;var e,t=(0,d.Z)(this._components);try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}},{key:"container",set:function(e){var t=this._get("container");e!==t&&(e&&(e.classList.add(Ga),(0,F.a)(e),this._attachContainers(e)),t&&(t.classList.remove(Ga),$a(t,{top:"",bottom:"",left:"",right:""}),(0,k.t)(t)),this._set("container",e))}},{key:"height",get:function(){var e=this.get("view.height")||0;if(0===e)return e;var t=this._getViewPadding(),n=t.top+t.bottom;return Math.max(e-n,0)}},{key:"padding",get:function(){return this._get("padding")},set:function(e){e?this._override("padding",e):this._clearOverride("padding")}},{key:"castPadding",value:function(e){return"number"==typeof e?{bottom:e,top:e,right:e,left:e}:(0,h.Z)((0,h.Z)({},Ua),e)}},{key:"width",get:function(){var e=this.get("view.width")||0;if(0===e)return e;var t=this._getViewPadding(),n=t.left+t.right;return Math.max(e-n,0)}},{key:"add",value:function(e,t){var n,i,r,a,o=this;if(Array.isArray(e))e.forEach((function(e){return o.add(e,t)}));else{var s=Ja(e);s&&(r=(n=s).index,t=n.position,e=n.component,a=n.key),t&&"object"==typeof t&&(r=(i=t).index,a=i.key,t=i.position),!e||t&&!this._isValidPosition(t)||this._add(e,t,r,a)}}},{key:"remove",value:function(e,t){var n=this;if(e){if(Array.isArray(e))return e.map((function(e){return n.remove(e,t)}));var i=this._find(e);if(i){var r=this._componentToKey;if(r.has(e)&&r.get(e)!==t)return;var a=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(a,1)[0]}}}},{key:"empty",value:function(e){var t=this;return Array.isArray(e)?e.map((function(e){return t.empty(e)})).reduce((function(e,t){return e.concat(t)})):(e=e||Ba)===Ba?Array.prototype.slice.call(this._manualContainer.children).filter((function(e){return!e.classList.contains(Ha)})).map((function(e){return t.remove(e)})):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}},{key:"move",value:function(e,t){var n=this;if(Array.isArray(e)&&e.forEach((function(e){return n.move(e,t)})),e){var i,r=Ja(e)||Ja(t);if(r&&(i=r.index,t=r.position,e=r.component||e),!t||this._isValidPosition(t)){var a=this.remove(e);a&&this.add(a,{position:t,index:i})}}}},{key:"find",value:function(e){if(!e)return null;var t=this._findById(e);return t&&(t.widget||t.node)}},{key:"getPosition",value:function(e){for(var t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}},{key:"_add",value:function(e,t,n,i){e instanceof Na||(e=new Na({node:e})),this._place({component:e,position:t,index:n}),this._components.push(e),i&&this._componentToKey.set(e,i)}},{key:"_find",value:function(e){return e?e instanceof Na?this._findByComponent(e):"string"==typeof e?this._findById(e):this._findByNode(e.domNode||e):null}},{key:"_getViewPadding",value:function(){return this.get("view.padding")||za}},{key:"_attachContainers",value:function(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}},{key:"_initContainers",value:function(){var e=document.createElement("div");e.classList.add(ja),e.classList.add(qa);var t=document.createElement("div");t.classList.add(ja),t.classList.add(Wa);var n=document.createElement("div");n.classList.add(Ka),n.classList.add(Ha),e.appendChild(n);var i=document.createElement("div");i.classList.add(Qa),i.classList.add(Ha),e.appendChild(i);var r=document.createElement("div");r.classList.add(Ya),r.classList.add(Ha),e.appendChild(r);var a=document.createElement("div");a.classList.add(Xa),a.classList.add(Ha),e.appendChild(a),this._innerContainer=e,this._manualContainer=t;var o=(0,k.f)();this._cornerNameToContainerLookup={"top-left":n,"top-right":i,"bottom-left":r,"bottom-right":a,"top-leading":o?i:n,"top-trailing":o?n:i,"bottom-leading":o?a:r,"bottom-trailing":o?r:a},this._positionNameToContainerLookup=(0,h.Z)({manual:t},this._cornerNameToContainerLookup)}},{key:"_isValidPosition",value:function(e){return!!this._positionNameToContainerLookup[e]}},{key:"_place",value:function(e){var t=e.component,n=e.position||Ba,i=e.index,r=this._positionNameToContainerLookup[n],a=i>-1;if(function(e){return e&&!e._started&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}(t.widget)&&t.widget.startup(),a){var o=Array.prototype.slice.call(r.children);0!==i?i>=o.length?r.appendChild(t.node):(0,k.o)(t.node,o[i]):r.firstChild?(0,k.o)(t.node,r.firstChild):r.appendChild(t.node)}else r.appendChild(t.node)}},{key:"_toPxPosition",value:function(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}},{key:"_toPxUnit",value:function(e){return 0===e?"0":e+"px"}},{key:"_findByComponent",value:function(e){var t,n=null;return this._components.some((function(i){return(t=i===e)&&(n=i),t})),n}},{key:"_findById",value:function(e){var t,n=null;return this._components.some((function(i){return(t=i.id===e)&&(n=i),t})),n}},{key:"_findByNode",value:function(e){var t,n=null;return this._components.some((function(i){return(t=i.node===e)&&(n=i),t})),n}}]),n}(b.n.EventedAccessor);(0,g.e)([(0,g.d)()],eo.prototype,"container",null),(0,g.e)([(0,g.d)()],eo.prototype,"height",null),(0,g.e)([(0,g.d)({value:Ua})],eo.prototype,"padding",null),(0,g.e)([(0,g.q)("padding")],eo.prototype,"castPadding",null),(0,g.e)([(0,g.d)()],eo.prototype,"view",void 0),(0,g.e)([(0,g.d)()],eo.prototype,"width",null);var to=eo=(0,g.e)([(0,g.n)("esri.views.ui.UI")],eo);function no(e,t){return e&&"copyright"in e&&(!t||"function"==typeof e.originOf&&"user"===e.originOf("copyright"))}function io(e,t,n){n&&t&&(e.find((function(e){return e.layerView===t&&e.text===n}))||e.push({text:n,layerView:t}))}function ro(e){return"bing-maps"===e.type}var ao=[],oo=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._clear=function(){i._fetchedAttributionData.clear(),i._pendingAttributions.clear(),i.handles.remove("suspension"),i.notifyChange("state")},i._pendingAttributions=new Set,i._fetchedAttributionData=new Map,i.items=new b.j,i.view=null,i._allLayerViewsChange=function(e){i.handles.remove("suspension");var t=i.get("view.allLayerViews");t&&i.handles.add(t.map((function(e){return(0,w.l)((function(){var t;return[e.suspended,null===(t=e.layer)||void 0===t?void 0:t.attributionVisible]}),(function(){return i._updateAttributionItems()}))})),"suspension"),e&&e.removed&&e.removed.forEach((function(e){i._pendingAttributions.delete(e),i._fetchedAttributionData.delete(e)})),i._updateAttributionItems()},i.handles.add([(0,w.a)((function(){var e;return null===(e=i.view)||void 0===e?void 0:e.allLayerViews}),"change",(function(e){return i._allLayerViewsChange(e)}),{onListenerAdd:function(){return i._allLayerViewsChange()},onListenerRemove:i._clear}),(0,w.f)((function(){var e;return!0===(null===(e=i.view)||void 0===e?void 0:e.stationary)}),(function(){return i._updateAttributionItems()}))]),i}return(0,v.Z)(n,[{key:"destroy",value:function(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}},{key:"state",get:function(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}},{key:"_updateAttributionItems",value:function(){var e=this,t=this.get("view.allLayerViews");ao.length=0,t?(t.forEach((function(t){var n;if(!t.suspended&&null!==(n=t.layer)&&void 0!==n&&n.attributionVisible){var i=t.layer;if(no(i,"user"))io(ao,t,i.copyright);else if(i.hasAttributionData){if(e._fetchedAttributionData.has(t)){var r=e._fetchedAttributionData.get(t);return void(r?io(ao,t,e._getDynamicAttribution(r,e.view,i)):no(i)&&io(ao,t,i.copyright))}e._fetchAttributionData(t)}else{var a=i.get("portalItem.accessInformation");io(ao,t,a||i.copyright)}}})),function(e,t){return e.length!==t.length||e.some((function(e,n){return e.text!==t[n].text}))}(this.items,ao)&&(this.items.removeAll(),this.items.addMany(ao)),ao.length=0,this.notifyChange("state")):this._clear()}},{key:"_fetchAttributionData",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var n,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._pendingAttributions.has(t)){e.next=2;break}return e.abrupt("return");case 2:return this._pendingAttributions.add(t),e.next=5,(0,ue.a)(t.layer.fetchAttributionData());case 5:n=e.sent,this._pendingAttributions.has(t)&&(i=n.ok?this._createContributionIndex(n.value,ro(t.layer)):null,this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,i)),this._updateAttributionItems();case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createContributionIndex",value:function(e,t){var n=e.contributors,i={};if(!n)return i;for(var r=0;r<n.length;r++){var a=n[r],o=a.coverageAreas;if(!o)return;var s,u=(0,d.Z)(o);try{for(u.s();!(s=u.n()).done;)for(var l=s.value,c=l.bbox,h=l.zoomMin-(t&&l.zoomMin?1:0),p=l.zoomMax-(t&&l.zoomMax?1:0),v={xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:I.k.WGS84},f={extent:(0,I.R)(v),attribution:a.attribution||"",score:null!=l.score?l.score:100,id:r},y=h;y<=p;y++)i[y]=i[y]||[],i[y].push(f)}catch(g){u.e(g)}finally{u.f()}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}},{key:"_getDynamicAttribution",value:function(e,t,n){var i=t.extent,r=t.scale,a=n.tileInfo.scaleToZoom(r);if(a=Math.min(e.maxKey,Math.round(a)),!i||null==a||a<=-1)return"";var o=e[a],s=(0,I.M)(i.center.clone().normalize(),t.spatialReference),u={};return o?o.filter((function(e){var t=!u[e.id]&&s&&(0,G.r)(e.extent,s);return t&&(u[e.id]=!0),t})).sort((function(e,t){return t.score-e.score||e.objectId-t.objectId})).map((function(e){return e.attribution})).join(", "):""}}]),n}(M.d);(0,g.e)([(0,g.d)({readOnly:!0,type:b.j})],oo.prototype,"items",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],oo.prototype,"state",null),(0,g.e)([(0,g.d)()],oo.prototype,"view",void 0);var so=oo=(0,g.e)([(0,g.n)("esri.widgets.Attribution.AttributionViewModel")],oo),uo="esri-attribution esri-widget",lo="esri-attribution__powered-by",co="esri-attribution__sources",ho="esri-attribution--open",po="esri-attribution__sources--open",vo="esri-attribution__link",fo="esri-icon-description",yo="esri-interactive",go=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i){var r;return(0,p.Z)(this,n),(r=t.call(this,e,i))._isOpen=!1,r._attributionTextOverflowed=!1,r._prevSourceNodeHeight=0,r._resizeObserver=new ResizeObserver((function(e){return e.forEach((function(e){var t=e.target;return r._checkSourceTextOverflow(t)}))})),r.iconClass=fo,r.itemDelimiter=" | ",r.label=void 0,r.messages=null,r.view=null,r.viewModel=new so,r}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.own((0,w.a)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.items}),"change",(function(){return e.scheduleRender()})))}},{key:"destroy",value:function(){var e;null===(e=this._resizeObserver)||void 0===e||e.disconnect()}},{key:"_isInteractive",get:function(){return this._isOpen||this._attributionTextOverflowed}},{key:"attributionText",get:function(){return this.viewModel.items.reduce((function(e,t){return e.includes(t.text)||e.push(t.text),e}),[]).join(this.itemDelimiter)}},{key:"render",value:function(){var e=(0,c.Z)({},ho,this._isOpen);return(0,k.n)("div",{bind:this,class:this.classes(uo,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}},{key:"renderPoweredBy",value:function(){return(0,k.n)("div",{class:lo},"Powered by"," ",(0,k.n)("a",{class:vo,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}},{key:"renderSourcesNode",value:function(){var e,t=this._isOpen,n=this._isInteractive,i=n?"0":"",r=this.attributionText,a=(e={},(0,c.Z)(e,po,t),(0,c.Z)(e,yo,n),e);return(0,k.n)("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(co,a),innerHTML:r,tabindex:i})}},{key:"_afterSourcesNodeCreate",value:function(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}},{key:"_checkSourceTextOverflow",value:function(e){var t=!1,n=e.clientHeight,i=e.clientWidth,r=e.scrollWidth>i,a=this._attributionTextOverflowed!==r;if(this._attributionTextOverflowed=r,a&&(t=!0),this._isOpen){var o=n<this._prevSourceNodeHeight;this._prevSourceNodeHeight=n,o&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}},{key:"_toggleState",value:function(){this._isInteractive&&(this._isOpen=!this._isOpen)}}]),n}(k.O);(0,g.e)([(0,g.d)()],go.prototype,"_isOpen",void 0),(0,g.e)([(0,g.d)()],go.prototype,"_isInteractive",null),(0,g.e)([(0,g.d)()],go.prototype,"_attributionTextOverflowed",void 0),(0,g.e)([(0,g.d)()],go.prototype,"_prevSourceNodeHeight",void 0),(0,g.e)([(0,g.d)({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],go.prototype,"attributionText",null),(0,g.e)([(0,g.d)()],go.prototype,"iconClass",void 0),(0,g.e)([(0,g.d)()],go.prototype,"itemDelimiter",void 0),(0,g.e)([(0,g.d)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],go.prototype,"label",void 0),(0,g.e)([(0,g.d)(),(0,k.e)("esri/widgets/Attribution/t9n/Attribution")],go.prototype,"messages",void 0),(0,g.e)([(0,T.o)("viewModel.view")],go.prototype,"view",void 0),(0,g.e)([(0,g.d)({type:so})],go.prototype,"viewModel",void 0),(0,g.e)([(0,L.t)()],go.prototype,"_toggleState",null);var mo=go=(0,g.e)([(0,g.n)("esri.widgets.Attribution")],go),_o=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._handles=new m.u,i.orientation={x:0,y:0,z:0},i.view=null,i._updateForCamera=i._updateForCamera.bind((0,l.Z)(i)),i._updateForRotation=i._updateForRotation.bind((0,l.Z)(i)),i._updateRotationWatcher=i._updateRotationWatcher.bind((0,l.Z)(i)),i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this._handles.add((0,w.l)((function(){return e.view}),this._updateRotationWatcher,w.h))}},{key:"destroy",value:function(){this._handles=(0,_.d)(this._handles),this.view=null}},{key:"canShowNorth",get:function(){var e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}},{key:"reset",value:function(){if(this.get("view.ready")){var e={};"2d"===this.view.type?e.rotation=0:e.heading=0,this.callGoTo({target:e})}}},{key:"_updateForRotation",value:function(e){null!=e&&(this.orientation={z:e})}},{key:"_updateForCamera",value:function(e){if(e){var t=-e.heading;this.orientation={x:0,y:0,z:t}}}},{key:"_updateRotationWatcher",value:function(e){this._handles.removeAll(),e&&this._handles.add("2d"===e.type?(0,w.l)((function(){return null===e||void 0===e?void 0:e.rotation}),this._updateForRotation,w.h):(0,w.l)((function(){return null===e||void 0===e?void 0:e.camera}),this._updateForCamera,w.h))}}]),n}((0,R.e)(g.y));(0,g.e)([(0,g.d)({readOnly:!0})],_o.prototype,"canShowNorth",null),(0,g.e)([(0,g.d)()],_o.prototype,"orientation",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],_o.prototype,"state",null),(0,g.e)([(0,g.d)()],_o.prototype,"view",void 0);var wo=_o=(0,g.e)([(0,g.n)("esri.widgets.CompassViewModel")],_o),ko="esri-compass esri-widget--button esri-widget",bo="esri-icon-font-fallback-text",Mo="esri-compass__icon",Eo="esri-icon-dial",xo="esri-icon-compass",To="esri-icon-locate-circled",Co="esri-interactive",Po="esri-disabled",Io=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i){var r;return(0,p.Z)(this,n),(r=t.call(this,e,i)).goToOverride=null,r.iconClass=To,r.label=void 0,r.messages=null,r.view=null,r.viewModel=new wo,r}return(0,v.Z)(n,[{key:"reset",value:function(){return this.viewModel.reset()}},{key:"render",value:function(){var e,t,n=this.viewModel,i=n.orientation,r=n.state,a="disabled"===r,o="compass"===("rotation"===r?"rotation":"compass"),s=a?-1:0,u=(e={},(0,c.Z)(e,Po,a),(0,c.Z)(e,Co,!a),e),l=(t={},(0,c.Z)(t,xo,o),(0,c.Z)(t,Eo,!o),t),d=this.messages;return(0,k.n)("div",{bind:this,class:this.classes(ko,u),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":d.reset,title:d.reset},(0,k.n)("span",{"aria-hidden":"true",class:this.classes(Mo,l),styles:this._toRotationTransform(i)}),(0,k.n)("span",{class:bo},d.reset))}},{key:"_reset",value:function(){this.viewModel.reset()}},{key:"_toRotationTransform",value:function(e){return{transform:"rotateZ(".concat(e.z,"deg)")}}}]),n}(k.O);(0,g.e)([(0,T.o)("viewModel.goToOverride")],Io.prototype,"goToOverride",void 0),(0,g.e)([(0,g.d)()],Io.prototype,"iconClass",void 0),(0,g.e)([(0,g.d)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Io.prototype,"label",void 0),(0,g.e)([(0,g.d)(),(0,k.e)("esri/widgets/Compass/t9n/Compass")],Io.prototype,"messages",void 0),(0,g.e)([(0,T.o)("viewModel.view")],Io.prototype,"view",void 0),(0,g.e)([(0,g.d)({type:wo})],Io.prototype,"viewModel",void 0),(0,g.e)([(0,L.t)()],Io.prototype,"_reset",null);var Zo=Io=(0,g.e)([(0,g.n)("esri.widgets.Compass")],Io),Ao=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._handles=new m.u,i.navigationMode="pan",i.view=null,i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this._handles.add((0,w.f)((function(){var t;return null===(t=e.view)||void 0===t?void 0:t.inputManager}),(function(){return e._setNavigationMode()})))}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this.view=null}},{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}},{key:"toggle",value:function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}},{key:"_setNavigationMode",value:function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"}}]),n}(g.y);(0,g.e)([(0,g.d)({readOnly:!0})],Ao.prototype,"state",null),(0,g.e)([(0,g.d)()],Ao.prototype,"navigationMode",void 0),(0,g.e)([(0,g.d)()],Ao.prototype,"view",void 0);var So=Ao=(0,g.e)([(0,g.n)("esri.widgets.NavigationToggleViewModel")],Ao),Ro="esri-navigation-toggle esri-widget",Fo="esri-navigation-toggle__button esri-widget--button",Lo="esri-navigation-toggle__button--active",Oo="esri-navigation-toggle__button--pan",Do="esri-navigation-toggle__button--rotate",Vo="esri-navigation-toggle--horizontal",No="esri-icon-rotate",zo="esri-icon-pan",Uo="esri-icon-pan2",Bo="esri-disabled",Go=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i){var r;return(0,p.Z)(this,n),(r=t.call(this,e,i)).iconClass=Uo,r.label=void 0,r.messages=null,r.view=null,r.viewModel=new So,r}return(0,v.Z)(n,[{key:"layout",set:function(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}},{key:"toggle",value:function(){return this.viewModel.toggle()}},{key:"render",value:function(){var e,t="disabled"===this.get("viewModel.state"),n="pan"===this.get("viewModel.navigationMode"),i=(e={},(0,c.Z)(e,Bo,t),(0,c.Z)(e,Vo,"horizontal"===this.layout),e),r=(0,c.Z)({},Lo,n),a=(0,c.Z)({},Lo,!n),o=t?-1:0,s=this.messages.toggle;return(0,k.n)("div",{bind:this,class:this.classes(Ro,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":s,title:s},(0,k.n)("div",{class:this.classes(Fo,Oo,r)},(0,k.n)("span",{class:zo})),(0,k.n)("div",{class:this.classes(Fo,Do,a)},(0,k.n)("span",{class:No})))}},{key:"_toggle",value:function(){this.toggle()}}]),n}(k.O);(0,g.e)([(0,g.d)()],Go.prototype,"iconClass",void 0),(0,g.e)([(0,g.d)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Go.prototype,"label",void 0),(0,g.e)([(0,g.d)({value:"vertical"})],Go.prototype,"layout",null),(0,g.e)([(0,g.d)(),(0,k.e)("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Go.prototype,"messages",void 0),(0,g.e)([(0,T.o)("viewModel.view")],Go.prototype,"view",void 0),(0,g.e)([(0,g.d)({type:So})],Go.prototype,"viewModel",void 0),(0,g.e)([(0,L.t)()],Go.prototype,"_toggle",null);var Ho=Go=(0,g.e)([(0,g.n)("esri.widgets.NavigationToggle")],Go),jo="esri-widget--button esri-widget",Wo="esri-disabled",qo="esri-interactive",Ko="esri-icon-font-fallback-text",Qo="esri-icon",Yo=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;return(0,p.Z)(this,n),(e=t.apply(this,arguments)).enabled=!0,e.iconClass="",e.title="",e}return(0,v.Z)(n,[{key:"render",value:function(){var e,t=this.enabled?0:-1,n=(e={},(0,c.Z)(e,Wo,!this.enabled),(0,c.Z)(e,qo,this.enabled),e),i=(0,c.Z)({},this.iconClass,!!this.iconClass);return(0,k.n)("div",{bind:this,class:this.classes(jo,n),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:t,title:this.title},(0,k.n)("span",{"aria-hidden":"true",role:"presentation",class:this.classes(Qo,i)}),(0,k.n)("span",{class:Ko},this.title))}},{key:"_triggerAction",value:function(){this.action.call(this)}}]),n}(k.O);(0,g.e)([(0,g.d)()],Yo.prototype,"action",void 0),(0,g.e)([(0,g.d)()],Yo.prototype,"enabled",void 0),(0,g.e)([(0,g.d)()],Yo.prototype,"iconClass",void 0),(0,g.e)([(0,g.d)()],Yo.prototype,"title",void 0),(0,g.e)([(0,L.t)()],Yo.prototype,"_triggerAction",null);var Xo=Yo=(0,g.e)([(0,g.n)("esri.widgets.IconButton")],Yo),Jo=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;var e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return 0===t||e>t}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;var e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return 0===t||e<t}}]),n}(g.y);(0,g.e)([(0,g.d)({readOnly:!0})],Jo.prototype,"canZoomIn",null),(0,g.e)([(0,g.d)({readOnly:!0})],Jo.prototype,"canZoomOut",null),(0,g.e)([(0,g.d)()],Jo.prototype,"view",void 0);var $o=Jo=(0,g.e)([(0,g.n)("esri.widgets.Zoom.ZoomConditions2D")],Jo),es=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"canZoomIn",get:function(){return!!this.get("view.ready")}},{key:"canZoomOut",get:function(){return!!this.get("view.ready")}}]),n}(g.y);(0,g.e)([(0,g.d)({readOnly:!0})],es.prototype,"canZoomIn",null),(0,g.e)([(0,g.d)({readOnly:!0})],es.prototype,"canZoomOut",null),(0,g.e)([(0,g.d)()],es.prototype,"view",void 0);var ts=es=(0,g.e)([(0,g.n)("esri.widgets.Zoom.ZoomConditions3D")],es),ns=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).canZoomIn=!1,i.canZoomOut=!1,i}return(0,v.Z)(n,[{key:"destroy",value:function(){this.view=null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"view",set:function(e){e?"2d"===e.type?this._zoomConditions=new $o({view:e}):"3d"===e.type&&(this._zoomConditions=new ts({view:e})):this._zoomConditions=null,this._set("view",e)}},{key:"zoomIn",value:function(){if(this.canZoomIn){var e=this.view;"2d"===e.type?e.mapViewNavigation.zoomIn():(0,g.a9)(e.goTo({zoomFactor:2}))}}},{key:"zoomOut",value:function(){if(this.canZoomOut){var e=this.view;"2d"===e.type?e.mapViewNavigation.zoomOut():(0,g.a9)(e.goTo({zoomFactor:.5}))}}}]),n}(g.y);(0,g.e)([(0,g.d)()],ns.prototype,"_zoomConditions",void 0),(0,g.e)([(0,g.d)({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],ns.prototype,"canZoomIn",void 0),(0,g.e)([(0,g.d)({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],ns.prototype,"canZoomOut",void 0),(0,g.e)([(0,g.d)({readOnly:!0})],ns.prototype,"state",null),(0,g.e)([(0,g.d)()],ns.prototype,"view",null);var is=ns=(0,g.e)([(0,g.n)("esri.widgets.Zoom.ZoomViewModel")],ns),rs="esri-zoom esri-widget",as="esri-zoom--horizontal",os="esri-icon-plus",ss="esri-icon-minus",us="esri-icon-zoom-in-magnifying-glass",ls=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i){var r;return(0,p.Z)(this,n),(r=t.call(this,e,i)).iconClass=us,r.label=void 0,r.messages=null,r.view=null,r.viewModel=new is,r}return(0,v.Z)(n,[{key:"initialize",value:function(){this._zoomInButton=new Xo({action:this.zoomIn.bind(this),iconClass:os}),this._zoomOutButton=new Xo({action:this.zoomOut.bind(this),iconClass:ss})}},{key:"destroy",value:function(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}},{key:"layout",set:function(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}},{key:"render",value:function(){var e=this.viewModel,t=(0,c.Z)({},as,"horizontal"===this.layout);return this._zoomInButton.enabled="ready"===e.state&&e.canZoomIn,this._zoomOutButton.enabled="ready"===e.state&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,(0,k.n)("div",{class:this.classes(rs,t)},this._zoomInButton.render(),this._zoomOutButton.render())}},{key:"zoomIn",value:function(){return this.viewModel.zoomIn()}},{key:"zoomOut",value:function(){return this.viewModel.zoomOut()}}]),n}(k.O);(0,g.e)([(0,g.d)()],ls.prototype,"iconClass",void 0),(0,g.e)([(0,g.d)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ls.prototype,"label",void 0),(0,g.e)([(0,g.d)({value:"vertical"})],ls.prototype,"layout",null),(0,g.e)([(0,g.d)(),(0,k.e)("esri/widgets/Zoom/t9n/Zoom")],ls.prototype,"messages",void 0),(0,g.e)([(0,T.o)("viewModel.view")],ls.prototype,"view",void 0),(0,g.e)([(0,g.d)({type:is})],ls.prototype,"viewModel",void 0);var cs=ls=(0,g.e)([(0,g.n)("esri.widgets.Zoom")],ls),ds="esri.views.ui.DefaultUI";g.s.getLogger(ds);var hs=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},i.components=[],i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this._handles.add([(0,w.l)((function(){return e.components}),this._componentsWatcher.bind(this),w.h),(0,w.l)((function(){return e.view}),this._updateViewAwareWidgets.bind(this),w.h)])}},{key:"_add",value:function(e,t,a,o){if("string"==typeof e&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}(0,i.Z)((0,r.Z)(n.prototype),"_add",this).call(this,e,t,a,o)}},{key:"_removeComponents",value:function(e){var t=this;e.forEach((function(e){var n=t._find(e);n&&(t.remove(n),n.destroy())}))}},{key:"_updateViewAwareWidgets",value:function(e){var t=this;this.components.forEach((function(n){var i=t._find(n),r=i&&i.widget;(function(e){return e&&void 0!==e.view})(r)&&(r.view=e)}))}},{key:"_componentsWatcher",value:function(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}},{key:"_adjustPadding",value:function(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){var t=this.padding.top;this.padding=t}}},{key:"_addComponents",value:function(e){var t=this;this.initialized&&e.forEach((function(e){return t.add(t._createComponent(e),t._defaultPositionLookup[e])}))}},{key:"_createComponent",value:function(e){var t=this._createWidget(e);if(t)return new Na({id:e,node:t})}},{key:"_createWidget",value:function(e){return"attribution"===e?this._createAttribution():"compass"===e?this._createCompass():"navigation-toggle"===e?this._createNavigationToggle():"zoom"===e?this._createZoom():void 0}},{key:"_createAttribution",value:function(){return new mo({view:this.view})}},{key:"_createCompass",value:function(){return new Zo({view:this.view})}},{key:"_createNavigationToggle",value:function(){return new Ho({view:this.view})}},{key:"_createZoom",value:function(){return new cs({view:this.view})}}]),n}(to);(0,g.e)([(0,g.d)()],hs.prototype,"components",void 0);var ps=hs=(0,g.e)([(0,g.n)(ds)],hs)},38425:function(e,t,n){n.d(t,{a:function(){return l},c:function(){return d},e:function(){return v},o:function(){return h},r:function(){return p},t:function(){return c}});var i=n(15671),r=n(43144),a=n(60136),o=n(29388),s=n(75610),u=n(23132);function l(e){return e&&"function"==typeof e.highlight}function c(e){return e&&"function"==typeof e.maskOccludee}function d(e,t,n){return(0,s.t)(e)||e>n&&(0===t||e<t)}function h(e,t){return e>0||t>0}function p(e){var t,n,i=e.effectiveScaleRange;return{minScale:null!==(t=null===i||void 0===i?void 0:i.minScale)&&void 0!==t?t:0,maxScale:null!==(n=null===i||void 0===i?void 0:i.maxScale)&&void 0!==n?n:0}}var v=function(e){var t=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,i.Z)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).goToOverride=null,e.view=null,e}return(0,r.Z)(n,[{key:"callGoTo",value:function(e){var t=this.view;return this.goToOverride?this.goToOverride(t,e):t.goTo(e.target,e.options)}}]),n}(e);return(0,u.e)([(0,u.d)()],t.prototype,"goToOverride",void 0),(0,u.e)([(0,u.d)()],t.prototype,"view",void 0),t=(0,u.e)([(0,u.n)("esri.widgets.support.GoTo")],t)}},81663:function(e,t,n){n.d(t,{a:function(){return f},c:function(){return y},m:function(){return v}});var i=n(37762),r=n(15671),a=n(43144),o=n(60136),s=n(29388),u=n(23132),l=n(83822),c=n(75610),d=n(80175),h=n(9055),p=n(97033);u.s.getLogger("esri.core.support.OwningCollection");var v=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).handles.add([i.on("before-add",(function(e){(0,c.t)(e.item)&&e.preventDefault()})),i.on("after-add",(function(e){return i._own(e.item)})),i.on("after-remove",(function(e){return i._release(e.item)}))]),i}return(0,a.Z)(n,[{key:"owner",get:function(){return this._get("owner")},set:function(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}},{key:"_ownAll",value:function(){var e,t=(0,i.Z)(this.items);try{for(t.s();!(e=t.n()).done;){var n=e.value;this._own(n)}}catch(r){t.e(r)}finally{t.f()}}},{key:"_releaseAll",value:function(){var e,t=(0,i.Z)(this.items);try{for(t.s();!(e=t.n()).done;){var n=e.value;this._release(n)}}catch(r){t.e(r)}finally{t.f()}}},{key:"_createNewInstance",value:function(e){return this.itemType?new(d.j.ofType(this.itemType.Type))(e):new d.j(e)}}]),n}((0,p.a)(d.j));function f(e,t){return{type:e,cast:h.t,set:function(n){var i=(0,h.n)(n,this._get(t),e);i.owner=this,this._set(t,i)}}}(0,u.e)([(0,u.d)()],v.prototype,"owner",null);var y=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"_own",value:function(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}},{key:"_release",value:function(e){e.layer===this.owner&&(e.layer=null)}}]),n}(v=(0,u.e)([(0,u.n)("esri.core.support.OwningCollection")],v));(0,u.e)([(0,d.a)({Type:l.g,ensureType:(0,u.b)(l.g)})],y.prototype,"itemType",void 0),y=(0,u.e)([(0,u.n)("esri.support.GraphicsCollection")],y)},14181:function(e,t,n){n.d(t,{A:function(){return w},L:function(){return y},N:function(){return k},Q:function(){return R},i:function(){return p},p:function(){return m},w:function(){return A}});var i=n(97326),r=n(37762),a=n(15671),o=n(43144),s=n(60136),u=n(29388),l=n(23132),c=n(77470),d=n(75610),h=n(36551),p=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments))._tasks=new Array,e.running=!1,e}return(0,o.Z)(n,[{key:"length",get:function(){return this._tasks.length}},{key:"destroy",value:function(){this.cancelAll()}},{key:"runTask",value:function(e){for(;!e.done&&this._process(e);)e.madeProgress()}},{key:"push",value:function(e,t,n){var i=this;return this.running=!0,new Promise((function(r,a){return i._tasks.push(new v(r,a,e,t,n))}))}},{key:"unshift",value:function(e,t,n){var i=this;return this.running=!0,new Promise((function(r,a){return i._tasks.unshift(new v(r,a,e,t,n))}))}},{key:"_process",value:function(e){if(0===this._tasks.length)return!1;var t=this._tasks.shift();try{var n=(0,l.p)(t.signal);if(n&&!t.abortCallback)t.reject((0,l.m)());else{var i=n?t.abortCallback((0,l.m)()):t.callback(e);(0,l.D)(i)?i.then(t.resolve,t.reject):t.resolve(i)}}catch(r){t.reject(r)}return this.running=this._tasks.length>0,!0}},{key:"cancelAll",value:function(){var e,t=(0,l.m)(),n=(0,r.Z)(this._tasks);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i.abortCallback){var a=i.abortCallback(t);i.resolve(a)}else i.reject(t)}}catch(o){n.e(o)}finally{n.f()}this._tasks.length=0,this.running=!1}}]),n}(l.y);(0,l.e)([(0,l.d)()],p.prototype,"running",void 0),p=(0,l.e)([(0,l.n)("esri.layers.support.PromiseQueue")],p);var v=(0,o.Z)((function e(t,n,i,r,o){(0,a.Z)(this,e),this.resolve=t,this.reject=n,this.callback=i,this.signal=r,this.abortCallback=o})),f=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments)).SCHEDULER_LOG_SLOW_TASKS=!1,e.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1,e}return(0,o.Z)(n)}(l.y);(0,l.e)([(0,l.d)()],f.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,l.e)([(0,l.d)()],f.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);var y,g,m=new(f=(0,l.e)([(0,l.n)("esri.views.support.DebugFlags")],f)),_=l.s.getLogger("esri.views.support.Scheduler");function w(){return new E.Scheduler}(g=y||(y={})).RESOURCE_CONTROLLER="schedule",g.SLIDE="slide",g.STREAM_DATA_LOADER="stream loader",g.ELEVATION_QUERY="elevation query",g.TERRAIN_SURFACE="terrain",g.SURFACE_GEOMETRY_UPDATES="surface geometry updates",g.GRAPHICS_CORE="Graphics3D",g.I3S_CONTROLLER="I3S",g.POINT_CLOUD_LAYER="point cloud",g.FEATURE_TILE_FETCHER="feature fetcher",g.OVERLAY="overlay",g.STAGE="stage",g.GRAPHICS_DECONFLICTOR="graphics deconflictor",g.FILTER_VISIBILITY="Graphics3D filter visibility",g.SCALE_VISIBILITY="Graphics3D scale visibility",g.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",g.POINT_OF_INTEREST_FREQUENT="POI frequent",g.POINT_OF_INTEREST_INFREQUENT="POI infrequent",g.LABELER="labeler",g.FEATURE_QUERY_ENGINE="feature query",g.FEATURE_TILE_TREE="feature tile tree",g.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",g.ELEVATION_ALIGNMENT="elevation alignment",g.TEXT_TEXTURE_ATLAS="text texture atlas",g.TEXTURE_UNLOAD="texture unload",g.LINE_OF_SIGHT_TOOL="line of sight tool",g.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",g.ELEVATION_PROFILE="elevation profile",g.SNAPPING="snapping",g.SHADOW_ACCUMULATOR="shadow accumulator",g.CLOUDS_GENERATOR="cloud generator",g[g.TEST_PRIO=1]="TEST_PRIO";var k,b=new Map([[y.RESOURCE_CONTROLLER,0],[y.SLIDE,0],[y.STREAM_DATA_LOADER,0],[y.ELEVATION_QUERY,0],[y.TERRAIN_SURFACE,1],[y.SURFACE_GEOMETRY_UPDATES,1],[y.GRAPHICS_CORE,2],[y.I3S_CONTROLLER,2],[y.POINT_CLOUD_LAYER,2],[y.FEATURE_TILE_FETCHER,2],[y.OVERLAY,4],[y.STAGE,4],[y.GRAPHICS_DECONFLICTOR,4],[y.FILTER_VISIBILITY,4],[y.SCALE_VISIBILITY,4],[y.FRUSTUM_VISIBILITY,4],[y.POINT_OF_INTEREST_FREQUENT,6],[y.POINT_OF_INTEREST_INFREQUENT,30],[y.LABELER,8],[y.FEATURE_QUERY_ENGINE,8],[y.FEATURE_TILE_TREE,16],[y.FEATURE_TILE_TREE_ACTIVE,0],[y.ELEVATION_ALIGNMENT,12],[y.TEXT_TEXTURE_ATLAS,12],[y.CLOUDS_GENERATOR,12],[y.TEXTURE_UNLOAD,12],[y.LINE_OF_SIGHT_TOOL,16],[y.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[y.SNAPPING,0],[y.SHADOW_ACCUMULATOR,30]]);function M(e){return b.has(e)?b.get(e):"number"==typeof e?e:1}!function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(k||(k={}));var E,x,T=(0,l.am)(6.5),C=(0,l.am)(1),P=(0,l.am)(30),I=(0,l.am)(1e3/30),Z=(0,l.am)(100);!function(e){var t=function(e){(0,s.Z)(c,e);var t=(0,u.Z)(c);function c(){var e,n;(0,a.Z)(this,c),(e=t.call(this)).updating=!0,e._microTaskQueued=!1,e.performanceInfo={total:new l.an("total"),tasks:new Map},e._frameTaskTimes=new Map,e._budget=new r,e._state=k.INTERACTING,e._tasks=new l.ab,e._runQueue=new l.ab,e._load=0,e._idleStateCallbacks=new l.ab,e._idleUpdatesStartFired=!1,e._maxReschedule=F,e._forceTask=!1,e._debug=!1,e._debugHandle=(0,h.l)((function(){return m.SCHEDULER_LOG_SLOW_TASKS}),(function(t){return e._debug=t}),h.h);for(var o=0,s=Object.keys(y);o<s.length;o++){var u=s[o];e.performanceInfo.tasks.set(y[u],new l.an(y[u]))}var p=(0,i.Z)(e);return e._test={get state(){return(0,d.n)(n,p._state)},set state(e){n=e},FRAME_SAFETY_BUDGET:T,INTERACTING_BUDGET:I,IDLE_BUDGET:Z,get availableBudget(){return p._budget.budget},usedBudget:0,getBudget:function(){return p._budget},setBudget:function(e){return p._budget=e},updateTask:function(t){return e._updateTask(t)},getState:function(t){return e._getState(t)},getRuntime:function(t){return e._getRuntime(t)},frameTaskTimes:e._frameTaskTimes,resetRuntimes:function(){return e._resetRuntimes()},getRunning:function(){return e._getRunning()}},e}return(0,o.Z)(c,[{key:"destroy",value:function(){this._tasks.toArray().forEach((function(e){return e.remove()})),this._tasks.clear(),(0,d.d)(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}},{key:"activate",value:function(){var e=this;this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask((function(){e._microTaskQueued&&(e._microTaskQueued=!1,e._budget.done||(e._maxReschedule=F,e._schedule(),e.frame()))})))}},{key:"registerTask",value:function(e,t){var i=M(e),r=new n(this,e,t,i);return this._tasks.push(r),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new l.an(e)),r}},{key:"registerIdleStateCallbacks",value:function(e,t){var n=this,i={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(i),this.state===k.IDLE&&this._idleUpdatesStartFired&&i.idleBegin();var r=this;return{remove:function(){return n._removeIdleStateCallbacks(i)},set idleBegin(e){r._idleUpdatesStartFired&&(i.idleEnd(),r._state===k.IDLE&&e()),i.idleBegin=e},set idleEnd(e){i.idleEnd=e}}}},{key:"load",get:function(){return this._load}},{key:"state",get:function(){return(0,d.t)(this._test.state)?this._state:this._test.state},set:function(e){this._state!==e&&(this._state=e,this.state!==k.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((function(e){return e.idleEnd()}))))}},{key:"updateBudget",value:function(e){this._test.usedBudget=0;var t=T,n=e.frameDuration,i=C;switch(this.state){case k.IDLE:t=(0,l.am)(0),n=(0,l.am)(Math.max(Z,e.frameDuration)),i=P;break;case k.INTERACTING:n=(0,l.am)(Math.max(I,e.frameDuration))}return n=(0,l.am)(n-e.elapsedFrameTime-t),this.state!==k.IDLE&&n<C&&!this._forceTask?(this._forceTask=!0,!1):(n=(0,l.am)(Math.max(n,i)),this._budget.reset(n,this.state),this._maxReschedule=F,this._updateLoad(),this._schedule())}},{key:"frame",value:function(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case k.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((function(e){return e.idleBegin()}))),this._runIdle();break;case k.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}},{key:"stopFrame",value:function(){this._budget.reset((0,l.am)(0),this._state),this._budget.madeProgress()}},{key:"_removeIdleStateCallbacks",value:function(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}},{key:"removeTask",value:function(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}},{key:"_updateTask",value:function(e){this._tasks.forAll((function(t){t.name===e&&t.setPriority(e)}))}},{key:"_getState",value:function(e){if(this._runQueue.some((function(t){return t.name===e})))return x.SCHEDULED;var t=x.IDLE;return this._tasks.forAll((function(n){n.name===e&&n.needsUpdate&&(n.schedulePriority<=1?t=x.READY:t!==x.READY&&(t=x.WAITING))})),t}},{key:"_getRuntime",value:function(e){var t=0;return this._tasks.forAll((function(n){n.name===e&&(t+=n.runtime)})),t}},{key:"_resetRuntimes",value:function(){this._tasks.forAll((function(e){return e.runtime=0}))}},{key:"_getRunning",value:function(){var e=new Map;if(this._tasks.forAll((function(t){t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;var t="";return e.forEach((function(e,n){t+=e>1?" ".concat(e,"x ").concat(n):" ".concat(n)})),t}},{key:"_runIdle",value:function(){this._run()}},{key:"_runInteracting",value:function(){this._run()}},{key:"_runAnimating",value:function(){this._run()}},{key:"_updateLoad",value:function(){var e=this._tasks.reduce((function(e,t){return t.needsUpdate?++e:e}),0);this._load=.9*this._load+e*(1-.9)}},{key:"_schedule",value:function(){var e=this;if(this._maxReschedule<=0)return!1;var t=function(){var t=!1,n=0;if(e._tasks.forAll((function(i){i.needsUpdate&&0!==i.schedulePriority&&0!==i.basePriority&&(t=!0,n=Math.max(n,i.basePriority),1===i.schedulePriority?(i.schedulePriority=0,e._runQueue.push(i)):--i.schedulePriority)})),!t)return{v:(e.updating=!1,!1)};e._maxReschedule===F&&(e._maxReschedule=n),--e._maxReschedule};for(this._runQueue.filterInPlace((function(e){return!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1)})),this._tasks.forAll((function(t){0===t.basePriority&&t.needsUpdate&&!e._runQueue.includes(t)&&e._runQueue.unshift(t)}));0===this._runQueue.length;){var n=t();if("object"===typeof n)return n.v}return this.updating=!0,!0}},{key:"_run",value:function(){var e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){var t=this._budget.now(),n=this._runQueue.pop();this._budget.resetProgress();try{n.task.runTask(this._budget)}catch(f){_.error('Exception in task "'.concat(n.name,'"'),f)}n.schedulePriority=n.basePriority;var i=this._budget.now()-t;if(n.runtime+=i,this._frameTaskTimes.set(n.priority,this._frameTaskTimes.get(n.priority)+i),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",n.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some((function(e){return e.needsUpdate})),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this.updating=this._tasks.some((function(e){return e.needsUpdate})),this._recordFrameTaskTimes(this._budget.now()-e)}},{key:"_startFrameTaskTimes",value:function(){for(var e=0,t=Object.keys(y);e<t.length;e++){var n=t[e];this._frameTaskTimes.set(y[n],0)}}},{key:"_recordFrameTaskTimes",value:function(e){var t=this;this._frameTaskTimes.forEach((function(e,n){return t.performanceInfo.tasks.get(n).record(e)})),this.performanceInfo.total.record(e)}},{key:"test",get:function(){return this._test}}]),c}(l.y);(0,l.e)([(0,l.d)()],t.prototype,"updating",void 0),t=(0,l.e)([(0,l.n)("esri.views.support.Scheduler")],t),e.Scheduler=t;var n=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,i,r,o){var s;return(0,a.Z)(this,n),(s=t.call(this,{}))._scheduler=e,s.name=i,s._basePriority=o,s.runtime=0,s._queue=new p,s._handles=new c.u,s.schedulePriority=s._basePriority,s.task=(0,d.r)(r)?r:s._queue,s._handles.add((0,h.f)((function(){return s.task.running}),(function(){return e.activate()}))),s}return(0,o.Z)(n,[{key:"updating",get:function(){return this._queue.running}},{key:"normalizeCtorArgs",value:function(){return{}}},{key:"remove",value:function(){this.processQueue(A),this._scheduler.removeTask(this),this.schedule=R.schedule,this.reschedule=R.reschedule,this._handles.destroy()}},{key:"basePriority",get:function(){return this._basePriority}},{key:"setPriority",value:function(e){this.name=e;var t=M(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}},{key:"priority",get:function(){return this.name},set:function(e){this.setPriority(e)}},{key:"needsUpdate",get:function(){return this.updating||this.task.running}},{key:"schedule",value:function(e,t,n){return this._queue.push(e,t,n)}},{key:"reschedule",value:function(e,t,n){return this._queue.unshift(e,t,n)}},{key:"processQueue",value:function(e){this._queue.runTask(e)}}]),n}(l.y);(0,l.e)([(0,l.d)({constructOnly:!0})],n.prototype,"task",void 0),(0,l.e)([(0,l.d)({readOnly:!0})],n.prototype,"updating",null),n=(0,l.e)([(0,l.n)("esri.views.support.SchedulerTask")],n);var r=function(){function e(){(0,a.Z)(this,e),this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=k.IDLE,this._didWork=!1,this._enabled=!0}return(0,o.Z)(e,[{key:"run",value:function(e){return!this.done&&(!0===e()&&(this._didWork=!0),!0)}},{key:"done",get:function(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}},{key:"budget",get:function(){return this._budget}},{key:"madeProgress",value:function(){this._didWork=!0}},{key:"state",get:function(){return this._state}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"reset",value:function(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._didWork=!1}},{key:"remaining",get:function(){return Math.max(this._budget-this.elapsed,0)}},{key:"now",value:function(){return performance.now()}},{key:"elapsed",get:function(){return performance.now()-this._begin}},{key:"resetProgress",value:function(){this._didWork=!1}},{key:"hasProgressed",get:function(){return this._didWork}}]),e}();e.Budget=r}(E||(E={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(x||(x={}));var A=function(){var e=new E.Budget;return e.enabled=!1,e}(),S=function(){function e(){(0,a.Z)(this,e)}return(0,o.Z)(e,[{key:"remove",value:function(){}},{key:"processQueue",value:function(){}},{key:"schedule",value:function(e,t,n){try{if((0,l.p)(t)){var i=(0,l.m)();return n?Promise.resolve(n(i)):Promise.reject(i)}return(0,l.ao)(e(A))}catch(r){return Promise.reject(r)}}},{key:"reschedule",value:function(e,t,n){return this.schedule(e,t,n)}}]),e}(),R=new S,F=Number.MAX_SAFE_INTEGER},4720:function(e,t,n){n.d(t,{S:function(){return k},p:function(){return m}});var i,r=n(1413),a=n(15671),o=n(43144),s=n(60136),u=n(29388),l=n(23132),c=n(57714),d=n(70441),h=n(75610),p=n(44455),v=n(30709),f=n(78311),y=i=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).cols=null,i.level=0,i.levelValue=null,i.origin=null,i.resolution=0,i.rows=null,i.scale=0,i}return(0,o.Z)(n,[{key:"clone",value:function(){return new i({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}}]),n}(d.l);(0,l.e)([(0,l.d)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],y.prototype,"cols",void 0),(0,l.e)([(0,l.d)({type:l.S,json:{write:!0}})],y.prototype,"level",void 0),(0,l.e)([(0,l.d)({type:String,json:{write:!0}})],y.prototype,"levelValue",void 0),(0,l.e)([(0,l.d)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],y.prototype,"origin",void 0),(0,l.e)([(0,l.d)({type:Number,json:{write:!0}})],y.prototype,"resolution",void 0),(0,l.e)([(0,l.d)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],y.prototype,"rows",void 0),(0,l.e)([(0,l.d)({type:Number,json:{write:!0}})],y.prototype,"scale",void 0);var g,m=y=i=(0,l.e)([(0,l.n)("esri.layers.support.LOD")],y),_=new c.s({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"}),w=g=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,a.Z)(this,n),(i=t.call(this,e)).dpi=96,i.format=null,i.origin=null,i.minScale=0,i.maxScale=0,i.size=null,i.spatialReference=null,i}return(0,o.Z)(n,[{key:"isWrappable",get:function(){var e=this.spatialReference,t=this.origin;if(e&&t){var n=(0,v.b)(e);return e.isWrappable&&Math.abs(n.origin[0]-t.x)<=n.dx}return!1}},{key:"readOrigin",value:function(e,t){return v.j.fromJSON((0,r.Z)({spatialReference:t.spatialReference},e))}},{key:"lods",set:function(e){var t=this,n=0,i=0,r=[];this._levelToLOD={},e&&(n=-1/0,i=1/0,e.forEach((function(e){r.push(e.scale),n=e.scale>n?e.scale:n,i=e.scale<i?e.scale:i,t._levelToLOD[e.level]=e}))),this._set("scales",r),this._set("minScale",n),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}},{key:"readSize",value:function(e,t){return[t.cols,t.rows]}},{key:"writeSize",value:function(e,t){t.cols=e[0],t.rows=e[1]}},{key:"zoomToScale",value:function(e){var t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];var n=Math.floor(e),i=n+1;return t[n]/Math.pow(t[n]/t[i],e-n)}},{key:"scaleToZoom",value:function(e){for(var t=this.scales,n=t.length-1,i=0;i<n;i++){var r=t[i],a=t[i+1];if(r<=e)return i;if(a===e)return i+1;if(r>e&&a<e)return i+Math.log(r/e)/Math.log(r/a)}return i}},{key:"snapScale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=this.scaleToZoom(e);return n%Math.floor(n)>=t?this.zoomToScale(Math.ceil(n)):this.zoomToScale(Math.floor(n))}},{key:"tileAt",value:function(e,t,n,i){var r,a,o=this.lodAt(e);if(!o)return null;if("number"==typeof t)r=t,a=n;else if((0,v.E)(t.spatialReference,this.spatialReference))r=t.x,a=t.y,i=n;else{var s=(0,v.M)(t,this.spatialReference);if((0,h.t)(s))return null;r=s.x,a=s.y,i=n}var u=o.resolution*this.size[0],l=o.resolution*this.size[1];return i||(i={id:null,level:0,row:0,col:0,extent:(0,f.u)()}),i.level=e,i.row=Math.floor((this.origin.y-a)/l+.001),i.col=Math.floor((r-this.origin.x)/u+.001),this.updateTileInfo(i),i}},{key:"updateTileInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.ExtrapolateOptions.NONE,n=this.lodAt(e.level);if(!n&&t===g.ExtrapolateOptions.POWER_OF_TWO){var i=this.lods[this.lods.length-1];i.level<e.level&&(n=i)}if(n){var r=e.level-n.level,a=n.resolution*this.size[0]/Math.pow(2,r),o=n.resolution*this.size[1]/Math.pow(2,r);e.id="".concat(e.level,"/").concat(e.row,"/").concat(e.col),e.extent||(e.extent=(0,f.u)()),e.extent[0]=this.origin.x+e.col*a,e.extent[1]=this.origin.y-(e.row+1)*o,e.extent[2]=e.extent[0]+a,e.extent[3]=e.extent[1]+o}}},{key:"upsampleTile",value:function(e){var t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}},{key:"getTileBounds",value:function(e,t){var n=this.lodAt(t.level).resolution,i=n*this.size[0],r=n*this.size[1];return e[0]=this.origin.x+t.col*i,e[1]=this.origin.y-(t.row+1)*r,e[2]=e[0]+i,e[3]=e[1]+r,e}},{key:"lodAt",value:function(e){return this._levelToLOD&&this._levelToLOD[e]||null}},{key:"clone",value:function(){return g.fromJSON(this.write({}))}},{key:"getOrCreateCompatible",value:function(e,t){if(256===this.size[0]&&256===this.size[1])return 256===e?this:null;for(var n=[],i=this.lods.length,r=0;r<i;r++){var a=this.lods[r],o=a.resolution*t;n.push(new m({level:a.level,scale:a.scale,resolution:o}))}return new g({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:n})}},{key:"_initializeUpsampleLevels",value:function(){var e=this.lods;this._upsampleLevels=[];for(var t=null,n=0;n<e.length;n++){var i=e[n];this._upsampleLevels[i.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/i.resolution:0},t=i}}}],[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.resolutionFactor,n=void 0===t?1:t,i=e.scales,r=e.size,a=void 0===r?256:r,o=e.spatialReference,s=void 0===o?v.k.WebMercator:o,u=e.numLODs,l=void 0===u?24:u;if(!(0,v.I)(s)){var c=[];if(i)for(var d=0;d<i.length;d++){var h=i[d];c.push({level:d,scale:h,resolution:h})}else for(var f=5e-4,y=l-1;y>=0;y--)c.unshift({level:y,scale:f,resolution:f}),f*=2;return new g({dpi:96,lods:c,origin:new v.j(0,0,s),size:[a,a],spatialReference:s})}var m=(0,v.b)(s),_=e.origin?new v.j({x:e.origin.x,y:e.origin.y,spatialReference:s}):new v.j(m?{x:m.origin[0],y:m.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),w=96,k=1/(39.37*(0,p.z)(s)*w),b=[];if(i)for(var M=0;M<i.length;M++){var E=i[M],x=E*k;b.push({level:M,scale:E,resolution:x})}else{var T=(0,v.h)(s)?512/a*591657527.5917094:256/a*591657527.591555,C=Math.ceil(l/n);b.push({level:0,scale:T,resolution:T*k});for(var P=1;P<C;P++){var I=T/Math.pow(2,n),Z=I*k;b.push({level:P,scale:I,resolution:Z}),T=I}}return new g({dpi:w,lods:b,origin:_,size:[a,a],spatialReference:s})}}]),n}(d.l);(0,l.e)([(0,l.d)({type:Number,json:{write:!0}})],w.prototype,"compressionQuality",void 0),(0,l.e)([(0,l.d)({type:Number,json:{write:!0}})],w.prototype,"dpi",void 0),(0,l.e)([(0,l.d)({type:String,json:{read:_.read,write:_.write,origins:{"web-scene":{read:!1,write:!1}}}})],w.prototype,"format",void 0),(0,l.e)([(0,l.d)({readOnly:!0})],w.prototype,"isWrappable",null),(0,l.e)([(0,l.d)({type:v.j,json:{write:!0}})],w.prototype,"origin",void 0),(0,l.e)([(0,v.o)("origin")],w.prototype,"readOrigin",null),(0,l.e)([(0,l.d)({type:[m],value:null,json:{write:!0}})],w.prototype,"lods",null),(0,l.e)([(0,l.d)({readOnly:!0})],w.prototype,"minScale",void 0),(0,l.e)([(0,l.d)({readOnly:!0})],w.prototype,"maxScale",void 0),(0,l.e)([(0,l.d)({readOnly:!0})],w.prototype,"scales",void 0),(0,l.e)([(0,l.d)({cast:function(e){return Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]}})],w.prototype,"size",void 0),(0,l.e)([(0,v.o)("size",["rows","cols"])],w.prototype,"readSize",null),(0,l.e)([(0,v.r)("size",{cols:{type:l.S},rows:{type:l.S}})],w.prototype,"writeSize",null),(0,l.e)([(0,l.d)({type:v.k,json:{write:!0}})],w.prototype,"spatialReference",void 0),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}((w=g=(0,l.e)([(0,l.n)("esri.layers.support.TileInfo")],w))||(w={}));var k=w},59819:function(e,t,n){n.d(t,{e:function(){return s}});var i=n(29439),r=n(15671),a=n(43144),o=n(23132),s=function(){function e(t,n,i,a){(0,r.Z)(this,e),this.set(t,n,i,a)}return(0,a.Z)(e,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(e){this.set(e)}},{key:"hash",get:function(){var e=4095&this.row,t=4095&this.col,n=63&this.level;return(3&this.world)<<30|t<<22|e<<8|n}},{key:"acquire",value:function(e,t,n,i){this.set(e,t,n,i)}},{key:"contains",value:function(e){var t=e.level-this.level;return this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}},{key:"equals",value:function(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}},{key:"clone",value:function(){return new e(this)}},{key:"release",value:function(){this.level=0,this.row=0,this.col=0,this.world=0}},{key:"set",value:function(e,t,n,r){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){var a=e.split("/"),o=(0,i.Z)(a,4),s=o[0],u=o[1],l=o[2],c=o[3];this.level=parseFloat(s),this.row=parseFloat(u),this.col=parseFloat(l),this.world=parseFloat(c)}else this.level=+e,this.row=+t,this.col=+n,this.world=+r||0;return this}},{key:"toString",value:function(){return"".concat(this.level,"/").concat(this.row,"/").concat(this.col,"/").concat(this.world)}},{key:"getParentKey",value:function(){return this.level<=0?null:new e(this.level-1,this.row>>1,this.col>>1,this.world)}},{key:"getChildKeys",value:function(){var t=this.level+1,n=this.row<<1,i=this.col<<1,r=this.world;return[new e(t,n,i,r),new e(t,n,i+1,r),new e(t,n+1,i,r),new e(t,n+1,i+1,r)]}},{key:"compareRowMajor",value:function(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}}],[{key:"getId",value:function(e,t,n,i){return"object"==typeof e?"".concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.world):"".concat(e,"/").concat(t,"/").concat(n,"/").concat(i)}}]),e}();s.pool=new o.z(s,null,null,25,50)},47672:function(e,t,n){var i;function r(e){return"global"===e?i.Global:i.Local}function a(e){return e===i.Global?"global":"local"}n.d(t,{a:function(){return a},l:function(){return i},o:function(){return r}}),function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"}(i||(i={}))},10815:function(e,t,n){n.d(t,{d:function(){return m},u:function(){return k}});var i=n(15671),r=n(43144),a=n(60136),o=n(29388),s=n(23132),u=n(2157),l=n(55269),c=n(70441),d=n(2760),h=n(75610),p=n(30709),v=n(91204),f=n(30604),y=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;(0,i.Z)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).position=new p.j([0,0,0]),e.heading=0,e.tilt=0,e.fov=55,e}return(0,r.Z)(n,[{key:"normalizeCtorArgs",value:function(e,t,n,i){if(e&&"object"==typeof e&&("x"in e||Array.isArray(e))){var r={position:e};return null!=t&&(r.heading=t),null!=n&&(r.tilt=n),null!=i&&(r.fov=i),r}return e}},{key:"writePosition",value:function(e,t,n,i){var r=e.clone();r.x=(0,s.F)(e.x||0),r.y=(0,s.F)(e.y||0),r.z=e.hasZ?(0,s.F)(e.z||0):e.z,t[n]=r.write({},i)}},{key:"readPosition",value:function(e,t){var n=new p.j;return n.read(e,t),n.x=(0,s.F)(n.x||0),n.y=(0,s.F)(n.y||0),n.z=n.hasZ?(0,s.F)(n.z||0):n.z,n}},{key:"equals",value:function(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}}]),n}((0,u.l)(c.l));(0,s.e)([(0,s.d)({type:p.j,json:{write:{isRequired:!0}}})],y.prototype,"position",void 0),(0,s.e)([(0,p.r)("position")],y.prototype,"writePosition",null),(0,s.e)([(0,p.o)("position")],y.prototype,"readPosition",null),(0,s.e)([(0,s.d)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,s.q)((function(e){return l.s.normalize((0,s.F)(e))}))],y.prototype,"heading",void 0),(0,s.e)([(0,s.d)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,s.q)((function(e){return(0,d.o)((0,s.F)(e),-180,180)}))],y.prototype,"tilt",void 0),(0,s.e)([(0,s.d)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],y.prototype,"fov",void 0);var g,m=y=(0,s.e)([(0,s.n)("esri.Camera")],y),_=g=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).rotation=0,r.scale=0,r.targetGeometry=null,r.camera=null,r}return(0,r.Z)(n,[{key:"castRotation",value:function(e){return(e%=360)<0&&(e+=360),e}},{key:"clone",value:function(){return new g({rotation:this.rotation,scale:this.scale,targetGeometry:(0,h.r)(this.targetGeometry)?this.targetGeometry.clone():null,camera:(0,h.r)(this.camera)?this.camera.clone():null})}}]),n}(c.l);function w(){return{enabled:!this.camera}}(0,s.e)([(0,s.d)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:w}}}}})],_.prototype,"rotation",void 0),(0,s.e)([(0,s.q)("rotation")],_.prototype,"castRotation",null),(0,s.e)([(0,s.d)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:w}}}}})],_.prototype,"scale",void 0),(0,s.e)([(0,s.d)({types:v.i,json:{read:f.d,write:!0,origins:{"web-scene":{read:f.d,write:{overridePolicy:w}}}}})],_.prototype,"targetGeometry",void 0),(0,s.e)([(0,s.d)({type:m,json:{write:!0}})],_.prototype,"camera",void 0);var k=_=g=(0,s.e)([(0,s.n)("esri.Viewpoint")],_)},42471:function(e,t,n){n.d(t,{t:function(){return r}});var i=n(84538);function r(){return function(e,t){if(!e[t])throw new TypeError("Cannot auto bind undefined function '".concat(t,"'"));return{value:o(e[t])}}}function a(e){var t=e.type;return e instanceof KeyboardEvent||"keyup"===t||"keydown"===t||"keypress"===t}function o(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];a(t)?(0,i.k)(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call.apply(e,[this,t].concat(r))}}},71710:function(e,t,n){n.d(t,{l:function(){return d}});var i,r,a=n(60136),o=n(29388),s=n(43144),u=n(15671),l=n(75610),c=n(45332);function d(e){for(var t=(0,c.i)(e);t.length>1;){var n=h(t.shift());if(n.available)return n}return h(t.shift())}function h(e){switch(e){case c.o.WEBGL1:return i||(i=function(){var e=new v,t=y(c.o.WEBGL1,e);return(0,l.t)(t)||(e.supportsElementIndexUint=null!==t.getExtension("OES_element_index_uint"),e.supportsStandardDerivatives=null!==t.getExtension("OES_standard_derivatives"),e.supportsInstancedArrays=null!==t.getExtension("ANGLE_instanced_arrays"),e.supportsTextureFloat=null!==t.getExtension("OES_texture_float"),e.supportsTextureHalfFloat=null!==t.getExtension("OES_texture_half_float"),e.supportsColorBufferFloat=null!==t.getExtension("WEBGL_color_buffer_float"),e.supportsColorBufferFloatBlend=null!==t.getExtension("EXT_float_blend"),e.supportsColorBufferHalfFloat=null!==t.getExtension("EXT_color_buffer_half_float")),e}()),i;case c.o.WEBGL2:return r||(r=function(){var e=new f,t=y(c.o.WEBGL2,e);return(0,l.t)(t)||(e.supportsColorBufferFloat=null!==t.getExtension("EXT_color_buffer_float"),e.supportsColorBufferFloatBlend=null!==t.getExtension("EXT_float_blend"),e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||null!==t.getExtension("EXT_color_buffer_half_float")),e}()),r}}var p=(0,s.Z)((function e(){(0,u.Z)(this,e),this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1})),v=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,u.Z)(this,n),(e=t.apply(this,arguments)).type=c.o.WEBGL1,e}return(0,s.Z)(n)}(p),f=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(){var e;return(0,u.Z)(this,n),(e=t.apply(this,arguments)).type=c.o.WEBGL2,e.supportsElementIndexUint=!0,e.supportsStandardDerivatives=!0,e.supportsInstancedArrays=!0,e.supportsTextureFloat=!0,e.supportsTextureHalfFloat=!0,e}return(0,s.Z)(n)}(p);function y(e,t){if(e===c.o.WEBGL1&&void 0===typeof WebGLRenderingContext||e===c.o.WEBGL2&&void 0===typeof WebGL2RenderingContext)return null;var n=document.createElement("canvas");if(!n)return null;var i=(0,c.l)(n,e,{failIfMajorPerformanceCaveat:!0});if((0,l.t)(i)&&(i=(0,c.l)(n,e),(0,l.r)(i)&&(t.majorPerformanceCaveat=!0)),(0,l.t)(i))return i;if(e===c.o.WEBGL1){var r,a=null===(r=i.getParameter(i.VERSION))||void 0===r?void 0:r.match(/^WebGL\s+([\d.]*)/);if(a){var o=parseFloat(a[1]);t.available=o>=.94}}else t.available=!0;t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),i}},45332:function(e,t,n){n.d(t,{i:function(){return s},l:function(){return l},n:function(){return o},o:function(){return i}});var i,r,a=n(75610);function o(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=s(e);i.length>1;){var r=l(t,i.shift(),n);if((0,a.r)(r))return r}return u(t,i.shift(),n)}function s(e){var t=(0,a.a)("esri-force-webgl");if(t===i.WEBGL1||t===i.WEBGL2)return[t];switch(e){case"2d":return(0,a.a)("mac")&&(0,a.a)("chrome")?[i.WEBGL1,i.WEBGL2]:[i.WEBGL2,i.WEBGL1];case"3d":return[i.WEBGL2,i.WEBGL1]}}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!window.WebGLRenderingContext)return c(e,d),null;var i=l(e,t,n);return(0,a.t)(i)&&c(e,h),i}function l(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t===i.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"],a=null,o=0,s=r;o<s.length;o++){var l=s[o];try{a=e.getContext(l,n)}catch(u){}if(a)break}return a}function c(e,t){var n=e.parentNode;n&&(n.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(r=i||(i={}))[r.WEBGL1=1]="WEBGL1",r[r.WEBGL2=2]="WEBGL2";var d='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',h='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'},86270:function(e,t,n){n.d(t,{g:function(){return g},h:function(){return p},o:function(){return c},r:function(){return l}});var i,r,a=n(75610),o=n(23132),s=n(83996),u=n(97866);function l(e,t){if(!e)return null;if(!h(e))return new o.a("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:e});var n=e.heightUnit,i=s.v.deriveUnitFromSR(e,t).heightUnit;return n!==i?new o.a("webscene:incompatible-height-unit","The vertical units of the scene (".concat(n,") must match the horizontal units of the scene (").concat(i,")"),{verticalUnit:n,horizontalUnit:i}):null}function c(e,t,n){var r,a=p(e),u=t,l=d(a,u,n);if(a){var c=s.v.deriveUnitFromSR(a,e.spatialReference).heightUnit;if(!n&&c!==a.heightUnit){var h=new o.a("layerview:unmatched-height-unit","The vertical units of the layer must match the horizontal units (".concat(c,")"),{horizontalUnit:c});return new o.a("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:a,error:h})}}if(!("heightModelInfo"in(r=e)&&null!=r.heightModelInfo||null!=r.spatialReference)&&y(r)||l===i.Unsupported)return new o.a("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:a});switch(l){case i.Units:var v=a.heightUnit||"unknown",f=u.heightUnit||"unknown",g=new o.a("layerview:incompatible-height-unit","The vertical units of the layer (".concat(v,") must match the vertical units of the scene (").concat(f,")"),{layerUnit:v,sceneUnit:f});return new o.a("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:a,sceneHeightModelInfo:u,error:g});case i.HeightModel:var m=a.heightModel||"unknown",_=u.heightModel||"unknown",w=new o.a("layerview:incompatible-height-model","The height model of the layer (".concat(m,") must match the height model of the scene (").concat(_,")"),{layerHeightModel:m,sceneHeightModel:_});return new o.a("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:a,sceneHeightModelInfo:u,error:w});case i.CRS:var k=a.vertCRS||"unknown",b=u.vertCRS||"unknown",M=new o.a("layerview:incompatible-vertical-datum","The vertical datum of the layer (".concat(k,") must match the vertical datum of the scene (").concat(b,")"),{layerDatum:k,sceneDatum:b});return new o.a("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:a,sceneHeightModelInfo:u,error:M})}return null}function d(e,t,n){if(!h(e)||!h(t))return i.Unsupported;if(null==e||null==t)return i.Ok;if(!n&&e.heightUnit!==t.heightUnit)return i.Units;if(e.heightModel!==t.heightModel)return i.HeightModel;switch(e.heightModel){case"gravity-related-height":return i.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?i.Ok:i.CRS;default:return i.Unsupported}}function h(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function p(e){var t=e.url&&(0,u.m)(e.url);return null==(e.spatialReference&&e.spatialReference.vcsWkid)&&(0,a.r)(t)&&"ImageServer"===t.serverType||!v(e)||!e.heightModelInfo?y(e)?s.v.deriveUnitFromSR(_,e.spatialReference):null:e.heightModelInfo}function v(e){return"heightModelInfo"in e}function f(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function y(e){return f(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):m(e)}function g(e){return null!=e.layers||m(e)||f(e)||v(e)}function m(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"line-of-sight":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(r=i||(i={}))[r.Ok=0]="Ok",r[r.Units=1]="Units",r[r.HeightModel=2]="HeightModel",r[r.CRS=3]="CRS",r[r.Unsupported=4]="Unsupported";var _=new s.v({heightModel:"gravity-related-height"})},96401:function(e,t,n){n.d(t,{M:function(){return c},a:function(){return r},b:function(){return p},f:function(){return h},h:function(){return d},i:function(){return l},j:function(){return g},l:function(){return v},o:function(){return s},p:function(){return f},r:function(){return o},s:function(){return a},u:function(){return u},y:function(){return y},z:function(){return _}});var i=n(2760);function r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function a(e,t,n,i,r,a,o,s,u,l){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=l,e}function o(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function s(e,t){if(e===t){var n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function u(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],d=c*o-s*l,h=-c*a+s*u,p=l*a-o*u,v=n*d+i*h+r*p;return v?(v=1/v,e[0]=d*v,e[1]=(-c*i+r*l)*v,e[2]=(s*i-r*o)*v,e[3]=h*v,e[4]=(c*n-r*u)*v,e[5]=(-s*n+r*a)*v,e[6]=p*v,e[7]=(-l*n+i*u)*v,e[8]=(o*n-i*a)*v,e):null}function l(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],d=t[8],h=n[0],p=n[1],v=n[2],f=n[3],y=n[4],g=n[5],m=n[6],_=n[7],w=n[8];return e[0]=h*i+p*o+v*l,e[1]=h*r+p*s+v*c,e[2]=h*a+p*u+v*d,e[3]=f*i+y*o+g*l,e[4]=f*r+y*s+g*c,e[5]=f*a+y*u+g*d,e[6]=m*i+_*o+w*l,e[7]=m*r+_*s+w*c,e[8]=m*a+_*u+w*d,e}function c(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],d=t[8],h=n[0],p=n[1];return e[0]=i,e[1]=r,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=h*i+p*o+l,e[7]=h*r+p*s+c,e[8]=h*a+p*u+d,e}function d(e,t,n){var i=t[0],r=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],d=t[8],h=Math.sin(n),p=Math.cos(n);return e[0]=p*i+h*o,e[1]=p*r+h*s,e[2]=p*a+h*u,e[3]=p*o-h*i,e[4]=p*s-h*r,e[5]=p*u-h*a,e[6]=l,e[7]=c,e[8]=d,e}function h(e,t,n){var i=n[0],r=n[1],a=n[2];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=a*t[6],e[7]=a*t[7],e[8]=a*t[8],e}function p(e,t,n){var i=n[0],r=n[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e}function v(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function f(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=n+n,s=i+i,u=r+r,l=n*o,c=i*o,d=i*s,h=r*o,p=r*s,v=r*u,f=a*o,y=a*s,g=a*u;return e[0]=1-d-v,e[3]=c-g,e[6]=h+y,e[1]=c+g,e[4]=1-l-v,e[7]=p-f,e[2]=h-y,e[5]=p+f,e[8]=1-l-d,e}function y(e,t){var n=t[0],i=t[1],r=t[2],a=t[4],o=t[5],s=t[6],u=t[8],l=t[9],c=t[10],d=c*o-s*l,h=-c*a+s*u,p=l*a-o*u,v=n*d+i*h+r*p;if(!v)return null;var f=1/v;return e[0]=d*f,e[1]=(-c*i+r*l)*f,e[2]=(s*i-r*o)*f,e[3]=h*f,e[4]=(c*n-r*u)*f,e[5]=(-s*n+r*a)*f,e[6]=p*f,e[7]=(-l*n+i*u)*f,e[8]=(o*n-i*a)*f,e}function g(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],d=t[9],h=t[10],p=t[11],v=t[12],f=t[13],y=t[14],g=t[15],m=n*s-i*o,_=n*u-r*o,w=n*l-a*o,k=i*u-r*s,b=i*l-a*s,M=r*l-a*u,E=c*f-d*v,x=c*y-h*v,T=c*g-p*v,C=d*y-h*f,P=d*g-p*f,I=h*g-p*y,Z=m*I-_*P+w*C+k*T-b*x+M*E;return Z?(Z=1/Z,e[0]=(s*I-u*P+l*C)*Z,e[1]=(u*T-o*I-l*x)*Z,e[2]=(o*P-s*T+l*E)*Z,e[3]=(r*P-i*I-a*C)*Z,e[4]=(n*I-r*T+a*x)*Z,e[5]=(i*T-n*P-a*E)*Z,e[6]=(f*M-y*b+g*k)*Z,e[7]=(y*w-v*M-g*_)*Z,e[8]=(v*b-f*w+g*m)*Z,e):null}function m(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function _(e){var t=i.t,n=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],d=e[8];return Math.abs(1-(n*n+o*o+l*l))<=t&&Math.abs(1-(r*r+s*s+c*c))<=t&&Math.abs(1-(a*a+u*u+d*d))<=t}var w=l,k=m;Object.freeze(Object.defineProperty({__proto__:null,fromMat4:r,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},set:a,identity:o,transpose:s,invert:u,adjoint:function(e,t){var n=t[0],i=t[1],r=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8];return e[0]=o*c-s*l,e[1]=r*l-i*c,e[2]=i*s-r*o,e[3]=s*u-a*c,e[4]=n*c-r*u,e[5]=r*a-n*s,e[6]=a*l-o*u,e[7]=i*u-n*l,e[8]=n*o-i*a,e},determinant:function(e){var t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*(l*a-o*u)+n*(-l*r+o*s)+i*(u*r-a*s)},multiply:l,translate:c,rotate:d,scale:h,scaleByVec2:p,fromTranslation:v,fromRotation:function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:f,normalFromMat4Legacy:y,normalFromMat4:g,projection:function(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},subtract:m,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},multiplyScalarAndAdd:function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,t){var n=e[0],r=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],d=e[8],h=t[0],p=t[1],v=t[2],f=t[3],y=t[4],g=t[5],m=t[6],_=t[7],w=t[8];return Math.abs(n-h)<=i.t*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-p)<=i.t*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(a-v)<=i.t*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(o-f)<=i.t*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-y)<=i.t*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(u-g)<=i.t*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(l-m)<=i.t*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(c-_)<=i.t*Math.max(1,Math.abs(c),Math.abs(_))&&Math.abs(d-w)<=i.t*Math.max(1,Math.abs(d),Math.abs(w))},isOrthoNormal:_,mul:w,sub:k},Symbol.toStringTag,{value:"Module"}))},25459:function(e,t,n){n.d(t,{M:function(){return y},a:function(){return s},l:function(){return l},m:function(){return f},p:function(){return g},r:function(){return u},s:function(){return p},w:function(){return v},y:function(){return m}});var i=n(1413),r=n(75610),a=n(2760);function o(e,t){var n=e||{},i=n.format,r=n.quality,o=n.rotation,s=n.disableDecorations,u=b(e,t.padding),l=function(e,t){var n={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){null!=e.area.x&&(n.x=Math.floor(e.area.x)),null!=e.area.y&&(n.y=Math.floor(e.area.y));var i=null!=e.area.width?Math.floor(e.area.width):null,r=null!=e.area.height?Math.floor(e.area.height):null;if(n.width=t.width-n.x,n.height=t.height-n.y,null!=i&&null!=r)n.width=Math.min(n.width,i),n.height=Math.min(n.height,r);else if(null==i&&null!=r){var a=Math.min(n.width,i);n.height=a/n.width*n.height,n.width=a}else if(null!=i&&null==r){var o=Math.min(n.height,r);n.width=o/n.height*n.width,n.height=o}}return function(e,t){var n=Math.floor(Math.max(e.x,0)),i=Math.floor(Math.max(e.y,0)),r={x:n,y:i,width:Math.floor(Math.min(e.width,t.width-n)),height:Math.floor(Math.min(e.height,t.height-i))},a=r.width/r.height,o=e.width/e.height;if(o===a)return r;if(o>a){var s=Math.floor(r.width/o),u=r.height-s;return{x:r.x,y:Math.floor(r.y+u/2),width:r.width,height:s}}var l=Math.floor(r.height*o),c=r.width-l;return{x:Math.floor(r.x+c/2),y:r.y,width:l,height:r.height}}(function(e,t){if(!t||null==t.width||null==t.height)return e;var n=t.width/t.height,i=e.width/e.height;if(i===n)return e;if(i<n){var r=Math.floor(e.height*n);return e.x-=(r-e.width)/2,e.width=r,e}var a=Math.floor(e.width/n);return e.y-=(a-e.height)/2,e.height=a,e}(n,e),t)}(e,{width:t.width-u.left-u.right,height:t.height-u.top-u.bottom}),c=function(e,t){if(!e)return t;var n=e.width,i=e.height;if(null!=n&&null!=i)return{width:Math.floor(n),height:Math.floor(i)};if(null==n&&null==i)return t;var r=t.width/t.height;return null==i?{width:Math.floor(n),height:Math.floor(n/r)}:{width:Math.floor(i*r),height:Math.floor(i)}}(e,l),d=c.width,h=c.height,p=M(i),v=T[p];return{format:p,quality:(0,a.o)(null!=r?r:v,0,100),area:l,width:d,height:h,rotation:o,disableDecorations:!!s,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function s(e,t){var n=o(e,t),i=n.area,r=n.width/i.width,a=b(n,t.padding),s=a.left+a.right,u=a.top+a.bottom,l=t.width-s,c=t.height-u,d=Math.floor(l*r+s),h=Math.floor(c*r+u),p=e&&e.layers?e.layers:[],v=n.ignoreBackground,f=n.ignorePadding;return{framebufferWidth:d,framebufferHeight:h,region:{x:Math.floor(i.x*r)+a.left,y:Math.floor(i.y*r)+a.top,width:n.width,height:n.height},format:n.format,quality:n.quality,rotation:n.rotation,pixelRatio:r,layers:p,disableDecorations:n.disableDecorations,ignoreBackground:v,ignorePadding:f}}function u(e,t,n){var i=c(e,n),r=i.ctx,a=i.canvas,o=r.getImageData(0,0,e.width,e.height),s=function(e,t){var n=E[t.format],i=t.quality/100;return e.toDataURL(n,i)}(a,t);return d(a),{dataUrl:s,data:o}}function l(e,t){var n=c(e,t),i=n.ctx,r=n.canvas,a=i.getImageData(0,0,e.width,e.height);return d(r),a}function c(e,t){var n=((0,r.t)(h)&&(h=document.createElement("canvas")),h);t.premultipliedAlpha&&function(e){for(var t=e.data,n=t.length,i=0;i<n;i+=4){var r=t[i+3];if(255!==r&&r>0){var a=255/r;t[i+0]=t[i+0]*a,t[i+1]=t[i+1]*a,t[i+2]=t[i+2]*a}}}(e),n.width=e.width,n.height=e.height;var i=n.getContext("2d");return i.putImageData(e,0,0),t.flipY&&function(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}(i),{ctx:i,canvas:n}}function d(e){e.width=0,e.height=0}var h=null;function p(e,t){var n=M(e),i=T[n];return{format:n,quality:(0,a.o)(null!=t?t:i,0,100)}}function v(e,t){return t/Math.max(e[0],e[1])}function f(e,t,n){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(k)try{return new ImageData(e,t)}catch(i){k=!1}return _(e,t,n)}function y(e,t,n,i){if(!t||!n)throw new Error("Cannot construct image data without dimensions");if(k)try{return new ImageData(e,t,n)}catch(o){k=!1}var r=_(t,n,i);return r.data.set(e,0),r}function g(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.width-i,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e.height-r,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=e.data,l=t.width,c=t.height,d=t.data,h=a/l,p=o/c,v=Math.ceil(h/2),f=Math.ceil(p/2),y=e.width,g=0;g<c;g++)for(var m=0;m<l;m++){for(var _=4*(m+(s?c-g-1:g)*l),w=0,k=0,b=0,M=0,E=0,x=0,T=(g+.5)*p,C=Math.floor(g*p);C<(g+1)*p;C++)for(var P=Math.abs(T-(C+.5))/f,I=(m+.5)*h,Z=P*P,A=Math.floor(m*h);A<(m+1)*h;A++){var S=Math.abs(I-(A+.5))/v,R=Math.sqrt(Z+S*S);if(!(R>=1)){var F=2*R*R*R-3*R*R+1,L=4*(i+A+(r+C)*y);x+=F*u[L+3],k+=F,!n&&u[L+3]<255&&(F=F*u[L+3]/255),b+=F*u[L],M+=F*u[L+1],E+=F*u[L+2],w+=F}}d[_]=b/w,d[_+1]=M/w,d[_+2]=E/w,d[_+3]=x/k}return t}function m(e,t,n){if(!t)return e;var r=e.framebufferWidth,a=e.framebufferHeight,o=e.pixelRatio,s=e.region,u=b(e,n),l=u.left+u.right,c=u.top+u.bottom,d=r-l,h=a-c,p=Math.min(8,Math.min((2048-l)/d,(2048-c)/h));return p<1.5?e:(0,i.Z)((0,i.Z)({},e),{},{framebufferWidth:Math.round(d*p)+l,framebufferHeight:Math.round(h*p)+c,pixelRatio:o*p,resample:{region:{x:Math.round((s.x-u.left)*p)+u.left,y:Math.round((s.y-u.top)*p)+u.top,width:Math.round(s.width*p),height:Math.round(s.height*p)},width:r,height:a}})}function _(e,t,n){return n||(w||((w=document.createElement("canvas")).width=1,w.height=1),n=w),n.getContext("2d").createImageData(e,t)}var w=null,k=!0;function b(e,t){return!t||e&&e.ignorePadding?C:t}function M(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return x}}var E={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},x="png",T={png:100,jpg:98,jpeg:98},C={top:0,right:0,bottom:0,left:0}},87833:function(e,t,n){n.d(t,{A:function(){return w},C:function(){return C},H:function(){return Z},I:function(){return M},S:function(){return E},_:function(){return k},a:function(){return r},b:function(){return p},d:function(){return d},j:function(){return m},l:function(){return c},m:function(){return h},o:function(){return s},p:function(){return f},q:function(){return v},r:function(){return a},s:function(){return o},v:function(){return g},w:function(){return x},x:function(){return y},y:function(){return _},z:function(){return b}});var i=n(2760);function r(e,t){return e[0]=t[0],e[1]=t[1],e}function a(e,t,n){return e[0]=t,e[1]=n,e}function o(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function s(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function u(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function l(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function c(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function d(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e}function h(e,t){var n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)}function p(e,t){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}function v(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}function f(e){var t=e[0],n=e[1];return t*t+n*n}function y(e,t){return e[0]=-t[0],e[1]=-t[1],e}function g(e,t){var n=t[0],i=t[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r),e}function m(e,t){return e[0]*t[0]+e[1]*t[1]}function _(e,t,n){var i=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=i,e}function w(e,t,n,i){var r=t[0],a=t[1];return e[0]=r+i*(n[0]-r),e[1]=a+i*(n[1]-a),e}function k(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e}function b(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r+n[4],e[1]=n[1]*i+n[3]*r+n[5],e}function M(e,t,n,i){var r=t[0]-n[0],a=t[1]-n[1],o=Math.sin(i),s=Math.cos(i);return e[0]=r*s-a*o+n[0],e[1]=r*o+a*s+n[1],e}function E(e,t){return e[0]===t[0]&&e[1]===t[1]}function x(e,t,n,i,r){var a=t[0]-n[0],o=t[1]-n[1],s=(i[0]*a+i[1]*o)*(r-1);return a=i[0]*s,o=i[1]*s,e[0]=t[0]+a,e[1]=t[1]+o,e}var T=v,C=s,P=u,I=l,Z=h,A=p,S=f;Object.freeze(Object.defineProperty({__proto__:null,copy:r,set:a,add:o,subtract:s,multiply:u,divide:l,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:c,scaleAndAdd:d,distance:h,squaredDistance:p,length:v,squaredLength:f,negate:y,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:g,dot:m,cross:_,lerp:w,random:function(e,t){t=t||1;var n=2*(0,i.d)()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},transformMat2:k,transformMat2d:b,transformMat3:function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[3]*r+n[6],e[1]=n[1]*i+n[4]*r+n[7],e},transformMat4:function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e},rotate:M,angle:function(e,t){var n=e[0],i=e[1],r=t[0],a=t[1],o=n*n+i*i;o>0&&(o=1/Math.sqrt(o));var s=r*r+a*a;s>0&&(s=1/Math.sqrt(s));var u=(n*r+i*a)*o*s;return u>1?0:u<-1?Math.PI:Math.acos(u)},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:E,equals:function(e,t){var n=e[0],r=e[1],a=t[0],o=t[1];return Math.abs(n-a)<=i.t*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=i.t*Math.max(1,Math.abs(r),Math.abs(o))},projectAndScale:x,len:T,sub:C,mul:P,div:I,dist:Z,sqrDist:A,sqrLen:S},Symbol.toStringTag,{value:"Module"}))},21523:function(e,t,n){function i(){return new Float32Array(2)}function r(e,t){var n=new Float32Array(2);return n[0]=e,n[1]=t,n}function a(){return i()}function o(){return r(1,1)}function s(){return r(1,0)}function u(){return r(0,1)}n.d(t,{n:function(){return i},t:function(){return r}});var l=a(),c=o(),d=s(),h=u();Object.freeze(Object.defineProperty({__proto__:null,create:i,clone:function(e){var t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},fromValues:r,createView:function(e,t){return new Float32Array(e,t,2)},zeros:a,ones:o,unitX:s,unitY:u,ZEROS:l,ONES:c,UNIT_X:d,UNIT_Y:h},Symbol.toStringTag,{value:"Module"}))},82162:function(e,t,n){n.d(t,{t:function(){return r}});var i=n(93433);function r(e){return function(t){t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);var n=t._delegatedEventNames,r=Array.isArray(e)?e:function(e){return e.split(",").map((function(e){return e.trim()}))}(e);n.push.apply(n,(0,i.Z)(r))}}}}]);
//# sourceMappingURL=7129.f88f4744.chunk.js.map