"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[2317],{32043:function(e,t,n){n.d(t,{$:function(){return _r},A:function(){return Ti},B:function(){return Ci},C:function(){return Fo},D:function(){return Lo},E:function(){return Qo},F:function(){return Rr},G:function(){return Vr},H:function(){return dr},I:function(){return Zr},J:function(){return nr},K:function(){return zo},L:function(){return Vo},M:function(){return Te},N:function(){return Qr},O:function(){return eo},P:function(){return He},Q:function(){return pi},R:function(){return Uo},S:function(){return Br},T:function(){return oi},U:function(){return qr},V:function(){return Ro},W:function(){return Go},X:function(){return Ce},Y:function(){return yr},Z:function(){return mr},_:function(){return br},a:function(){return Yr},a0:function(){return Fr},a1:function(){return zr},a2:function(){return Ir},a3:function(){return Hr},a4:function(){return mi},a5:function(){return _i},a6:function(){return Ei},a7:function(){return gi},a8:function(){return di},a9:function(){return Mi},b:function(){return Jr},c:function(){return $r},d:function(){return yo},e:function(){return fo},f:function(){return _o},g:function(){return Ar},h:function(){return wo},i:function(){return Oe},j:function(){return Ue},k:function(){return vo},l:function(){return mo},m:function(){return xo},n:function(){return Es},o:function(){return ri},p:function(){return rr},q:function(){return kr},r:function(){return Ao},s:function(){return to},t:function(){return Kr},u:function(){return ho},v:function(){return Lr},w:function(){return he},x:function(){return Sr},y:function(){return Dr},z:function(){return ii}});var i=n(11752),r=n(61120),o=n(29439),a=n(93433),s=n(97326),u=n(4942),l=n(74165),c=n(15861),d=n(37762),h=n(1413),p=n(15671),v=n(43144),f=n(60136),y=n(29388),g=n(48848),m=n(93661),_=n(50690),w=n(42467),k=n(93314),b=n(630),M=n(46737),E=n(98598),x=n(37856),C=(n(74384),n(64998)),T=n(37944),P=n(82474),I=n(45999),Z=n(60369),A=n(39769),S=n(85700),R=n(51219),F=n(3719),L=n(60530),O=n(32161),D=n(89181),N=n(59389),V=n(90316),z=n(93116),U=n(65094),G=n(23585),B=n(46817),H=n(82396),j=n(77956),W=n(47748),q=n(85113),K=n(71802),Q=n(70522),Y=n(17332),X=n(95249),J=n(17455),$=n(40114),ee=n(70607),te=n(26313),ne=n(43066),ie=n(29048),re=n(68136),oe=n(13239),ae=n(47855),se=n(50253),ue=n(27205),le={widthBreakpoint:{getValue:function(e){var t=e.viewSize[0],n=e.breakpoints,i=this.values;return t<=n.xsmall?i.xsmall:t<=n.small?i.small:t<=n.medium?i.medium:t<=n.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue:function(e){var t=e.viewSize[1],n=e.breakpoints,i=this.values;return t<=n.xsmall?i.xsmall:t<=n.small?i.small:t<=n.medium?i.medium:t<=n.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue:function(e){var t=e.viewSize,n=t[0],i=t[1],r=this.values;return i>=n?r.portrait:r.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},ce={xsmall:544,small:768,medium:992,large:1200};function de(e,t){return t?le[e].valueToClassName[t].split(" "):[]}var he=function(e){var t=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;(0,p.Z)(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r)))._breakpointsHandles=new g.X,e.orientation=null,e.widthBreakpoint=null,e.heightBreakpoint=null,e.breakpoints=ce,e}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this._breakpointsHandles.add((0,_.l)((function(){return[e.breakpoints,e.size]}),(function(){return e._updateClassNames()}),_.h))}},{key:"destroy",value:function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=(0,m.g)(this._breakpointsHandles))}},{key:"breakpoints",set:function(e){if(e!==this._get("breakpoints")){var t=function(e){var t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}(e);if(!t){var n=JSON.stringify(ce,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}e=t?e:ce,this._set("breakpoints",(0,h.Z)({},e))}}},{key:"_updateClassNames",value:function(){if(this.container){var e,t=g.t.acquire(),n=g.t.acquire(),i=!1;for(e in le){var r=this[e],o=le[e].getValue({viewSize:this.size,breakpoints:this.breakpoints});r!==o&&(i=!0,this[e]=o,de(e,r).forEach((function(e){return n.push(e)})),de(e,o).forEach((function(e){return t.push(e)})))}i&&(this._applyClassNameChanges(t,n),g.t.release(t),g.t.release(n))}}},{key:"_applyClassNameChanges",value:function(e,t){var n=this.container;n&&(t.forEach((function(e){return n.classList.remove(e)})),e.forEach((function(e){return n.classList.add(e)})))}},{key:"_removeActiveClassNames",value:function(){var e,t=this.container;if(t)for(e in le)de(e,this[e]).forEach((function(e){return t.classList.remove(e)}))}}]),n}(e);return(0,g.e)([(0,g.y)()],t.prototype,"breakpoints",null),(0,g.e)([(0,g.y)()],t.prototype,"orientation",void 0),(0,g.e)([(0,g.y)()],t.prototype,"widthBreakpoint",void 0),(0,g.e)([(0,g.y)()],t.prototype,"heightBreakpoint",void 0),t=(0,g.e)([(0,g.n)("esri.views.BreakpointsOwner")],t)},pe=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;return(0,p.Z)(this,n),(e=t.apply(this,arguments)).items=new k.j,e._watchUpdatingTracking=new b.c,e._callbacks=new Map,e._projector=(0,w.i)(),e._hiddenProjector=(0,w.i)(),e}return(0,v.Z)(n,[{key:"needsRender",get:function(){return this.items.length>0}},{key:"updating",get:function(){var e,t;return null!==(e=null===(t=this._watchUpdatingTracking)||void 0===t?void 0:t.updating)&&void 0!==e&&e}},{key:"initialize",value:function(){var e=this,t=document.createElement("div");t.className="esri-overlay-surface",this._set("surface",t),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),t.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange((function(){return e.items}),(function(t){var n,i=(0,d.Z)(t.added);try{var r=function(){var t=n.value,i=function(){return t.render()};e._callbacks.set(t,i),e._projector.append(e.surface,i)};for(i.s();!(n=i.n()).done;)r()}catch(l){i.e(l)}finally{i.f()}var o,a=(0,d.Z)(t.removed);try{for(a.s();!(o=a.n()).done;){var s=o.value,u=e._projector.detach(e._callbacks.get(s));e.surface.removeChild(u.domNode),e._callbacks.delete(s)}}catch(l){a.e(l)}finally{a.f()}}))}},{key:"addItem",value:function(e){this.items.add(e)}},{key:"removeItem",value:function(e){this.items.remove(e)}},{key:"destroy",value:function(){var e=this;this.items.removeAll(),this._callbacks.forEach((function(t){return e._projector.detach(t)})),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}},{key:"render",value:function(){this._projector.renderNow()}},{key:"computeBoundingRect",value:function(e){var t=this._hiddenSurface,n=this._hiddenProjector,i=null,r=function(){return i=e.render()};n.append(t,r),n.renderNow();var o={left:0,top:0,right:0,bottom:0};if(i&&i.domNode){var a=i.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(n.detach(r);t.firstChild;)t.removeChild(t.firstChild);return o}},{key:"overlaps",value:function(e,t){var n=this.computeBoundingRect(e),i=this.computeBoundingRect(t);return Math.max(n.left,i.left)<=Math.min(n.right,i.right)&&Math.max(n.top,i.top)<=Math.min(n.bottom,i.bottom)}},{key:"hasVisibleItems",get:function(){return this.items.some((function(e){return e.visible}))}},{key:"prepare",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,document.fonts.load(this._fontString()).catch((function(){}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderCanvas",value:function(e){if(this.items.some((function(e){return e.visible}))){var t=e.getContext("2d");t.save(),t.font=this._fontString(),this.items.forEach((function(e){t.save(),e.renderCanvas(t),t.restore()})),t.restore()}}},{key:"_fontString",value:function(){return"10px ".concat(getComputedStyle(this.surface).fontFamily)}}]),n}(g.m);(0,g.e)([(0,g.y)({readOnly:!0})],pe.prototype,"surface",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],pe.prototype,"items",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],pe.prototype,"needsRender",null),(0,g.e)([(0,g.y)({readOnly:!0})],pe.prototype,"_watchUpdatingTracking",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],pe.prototype,"updating",null);var ve,fe=pe=(0,g.e)([(0,g.n)("esri.views.overlay.ViewOverlay")],pe),ye=Symbol("anchorHandles"),ge=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))[ve]=new g.X,i.location=null,i.screenLocationEnabled=!1,i.view=null,i[ye].add([(0,_.f)((function(){return(0,m.n)(i.screenLocationEnabled?i.view:null,(function(e){return[e.size,"3d"===e.type?e.camera:e.viewpoint]}))}),(function(){return i.notifyChange("screenLocation")})),(0,_.l)((function(){return i.screenLocation}),(function(e,t){(0,m.r)(e)&&(0,m.r)(t)&&i.emit("view-change")}))]),i}return(0,v.Z)(n,[{key:"destroy",value:function(){this.view=null,this[ye]=(0,m.g)(this[ye])}},{key:"screenLocation",get:function(){var e=this.location,t=this.view;return this.screenLocationEnabled&&(0,m.r)(e)&&(0,m.r)(t)&&t.ready?t.toScreen(e):null}}]),n}(x.n.EventedAccessor);ve=ye,(0,g.e)([(0,g.y)()],ge.prototype,"location",void 0),(0,g.e)([(0,g.y)()],ge.prototype,"screenLocation",null),(0,g.e)([(0,g.y)()],ge.prototype,"screenLocationEnabled",void 0),(0,g.e)([(0,g.y)()],ge.prototype,"view",void 0);var me=ge=(0,g.e)([(0,g.n)("esri.widgets.support.AnchorElementViewModel")],ge),_e=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).visible=!1,i}return(0,v.Z)(n)}(me);(0,g.e)([(0,g.y)()],_e.prototype,"visible",void 0);var we=_e=(0,g.e)([(0,g.n)("esri.widgets.CompassViewModel")],_e),ke="esri-spinner",be="esri-spinner--start",Me="esri-spinner--finish",Ee=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i){var r;return(0,p.Z)(this,n),(r=t.call(this,e,i))._animationDelay=500,r._animationPromise=null,r.viewModel=new we,r}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,_.l)((function(){return e.visible}),(function(t){return e._visibleChange(t)})))}},{key:"destroy",value:function(){this._animationPromise=null}},{key:"location",get:function(){return this.viewModel.location},set:function(e){this.viewModel.location=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"visible",get:function(){return this.viewModel.visible},set:function(e){this.viewModel.visible=e}},{key:"show",value:function(e){var t=this,n=e.location,i=e.promise;n&&(this.viewModel.location=n),this.visible=!0;i&&i.catch((function(){})).then((function(){return t.hide()}))}},{key:"hide",value:function(){this.visible=!1}},{key:"render",value:function(){var e,t=this.visible,n=!!this.viewModel.screenLocation,i=t&&n,r=!t&&n,o=(e={},(0,u.Z)(e,be,i),(0,u.Z)(e,Me,r),e),a=this._getPositionStyles();return(0,w.n)("div",{class:this.classes(ke,o),styles:a})}},{key:"_visibleChange",value:function(e){var t=this;if(e)this.viewModel.screenLocationEnabled=!0;else{var n=(0,g.ab)(this._animationDelay);this._animationPromise=n,n.catch((function(){})).then((function(){t._animationPromise===n&&(t.viewModel.screenLocationEnabled=!1,t._animationPromise=null)}))}}},{key:"_getPositionStyles",value:function(){var e=this.viewModel,t=e.screenLocation,n=e.view;if((0,m.t)(n)||(0,m.t)(t))return{};var i=n.padding;return{left:t.x-i.left+"px",top:t.y-i.top+"px"}}}]),n}(w.M);(0,g.e)([(0,g.y)()],Ee.prototype,"location",null),(0,g.e)([(0,g.y)()],Ee.prototype,"view",null),(0,g.e)([(0,g.y)({type:we})],Ee.prototype,"viewModel",void 0),(0,g.e)([(0,g.y)()],Ee.prototype,"visible",null);for(var xe=Ee=(0,g.e)([(0,g.n)("esri.widgets.Spinner")],Ee),Ce="OBJECTID",Te=function(){function e(t,n){var i=this;for(var r in(0,p.Z)(this,e),this._owner=n,this._properties={},this._afterDispatchHandle=null,t){var o=t[r],a=new g.ac(o,void 0,void 0,2,2);this._properties[r]={pool:a,acquired:[]}}this._afterDispatchHandle=(0,g.ad)((function(){return i._release()}))}return(0,v.Z)(e,[{key:"destroy",value:function(){for(var e in this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null),this._properties){var t,n=this._properties[e],i=(0,d.Z)(n.acquired);try{for(i.s();!(t=i.n()).done;){var r=t.value;(0,g.ae)(r)||n.pool.release(r)}}catch(o){i.e(o)}finally{i.f()}n.pool.destroy(),n.pool=null,n.acquired=null}this._properties=null,this._owner=null}},{key:"get",value:function(e){var t=this._owner._get(e),n=this._properties[e],i=n.pool.acquire();for(n.acquired.push(i);i===t;)n.acquired.push(i),i=n.pool.acquire();return i}},{key:"_release",value:function(){for(var e in this._properties){var t,n=this._properties[e],i=0,r=(0,d.Z)(n.acquired);try{for(r.s();!(t=r.n()).done;){var o=t.value;(0,g.ae)(o)?n.acquired[i++]=o:n.pool.release(o)}}catch(a){r.e(a)}finally{r.f()}n.acquired.length=i}}}]),e}(),Pe=(0,m.h)("mac")?"Meta":"Ctrl",Ie={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"},Ze=48;Ze<58;Ze++)Ie[Ze]=String.fromCharCode(Ze);for(var Ae=1;Ae<25;Ae++)Ie[111+Ae]="F".concat(Ae);for(var Se=65;Se<91;Se++)Ie[Se]=[String.fromCharCode(Se+32),String.fromCharCode(Se)];function Re(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}var Fe=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];(0,p.Z)(this,e),this.eventType=t,this.keyModifiers=n}return(0,v.Z)(e,[{key:"matches",value:function(e){if(e.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;var t,n=e.modifiers,i=(0,d.Z)(this.keyModifiers);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(!n.has(r))return!1}}catch(o){i.e(o)}finally{i.f()}return!0}}]),e}(),Le=g.a.getLogger("esri.views.input.InputHandler"),Oe=function(){function e(t){(0,p.Z)(this,e),this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}return(0,v.Z)(e,[{key:"incomingEventMatches",get:function(){if(!this._incomingEventMatches)for(var e in this._incomingEventMatches=[],this._incoming){var t,n=this._incoming[e],i=(0,d.Z)(n);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._incomingEventMatches.push(r.match)}}catch(o){i.e(o)}finally{i.f()}}return this._incomingEventMatches}},{key:"incomingEventTypes",get:function(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map((function(e){return e.eventType}))),this._incomingEventTypes}},{key:"outgoingEventTypes",get:function(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}},{key:"hasSideEffects",get:function(){return this._hasSideEffects}},{key:"hasPendingInputs",get:function(){return!1}},{key:"onInstall",value:function(e){var t=this;this._manager?Le.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback((function(e){return t._handleEvent(e)})),e.setUninstallCallback((function(){return t._onUninstall()})),this._manager=e)}},{key:"onUninstall",value:function(){}},{key:"registerIncoming",value:function(e,t,n){var i,r=this;"function"==typeof t?(n=t,i=[]):i=t||[];var o="string"==typeof e?new Fe(e,i):e,a=function(){r._incomingEventTypes=null,r._incomingEventMatches=null},s=function(e){var t=r._incoming[e.match.eventType];if(t){var n=t.indexOf(e);t.splice(n,1),a(),r._manager&&r._manager.updateDependencies()}},u=new De(o,n,{onPause:s,onRemove:s,onResume:function(e){var t=r._incoming[e.match.eventType];t&&!t.includes(e)&&(t.push(e),a(),r._manager&&r._manager.updateDependencies())}}),l=this._incoming[o.eventType];return l||(l=[],this._incoming[o.eventType]=l),l.push(u),a(),this._manager&&this._manager.updateDependencies(),u}},{key:"registerOutgoing",value:function(e){var t=this;if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);var n=new Ne(e,{onEmit:function(e,n,i,r){var o;null===(o=t._manager)||void 0===o||o.emit(e.eventType,n,i,r)},onRemove:function(e){var n;delete t._outgoing[e.eventType],null===(n=t._manager)||void 0===n||n.updateDependencies()}});return this._outgoing[e]=n,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),n}},{key:"startCapturingPointer",value:function(e){var t;null===(t=this._manager)||void 0===t||t.setPointerCapture(e,!0)}},{key:"stopCapturingPointer",value:function(e){var t;null===(t=this._manager)||void 0===t||t.setPointerCapture(e,!1)}},{key:"refreshHasPendingInputs",value:function(){var e;null===(e=this._manager)||void 0===e||e.refreshHasPendingInputs()}},{key:"_onUninstall",value:function(){this._manager?(this.onUninstall(),this._manager=null):Le.error("This InputHandler is not registered with an InputManager")}},{key:"_handleEvent",value:function(e){var t=this._incoming[e.type];if(t){var n,i=(0,d.Z)(t);try{for(i.s();!(n=i.n()).done;){var r,o=n.value;if(o.match.matches(e)&&(null!==(r=o.callback)&&void 0!==r&&r.call(o,e),e.shouldStopPropagation()))break}}catch(a){i.e(a)}finally{i.f()}}}}]),e}(),De=function(){function e(t,n,i){(0,p.Z)(this,e),this.match=t,this._callback=n,this._handler=i}return(0,v.Z)(e,[{key:"pause",value:function(){this._handler.onPause(this)}},{key:"resume",value:function(){this._handler.onResume(this)}},{key:"remove",value:function(){this._handler.onRemove(this)}},{key:"callback",get:function(){return this._callback}}]),e}(),Ne=function(){function e(t,n){(0,p.Z)(this,e),this.eventType=t,this._removed=!1,this._handler=n}return(0,v.Z)(e,[{key:"emit",value:function(e,t,n){this._removed||this._handler.onEmit(this,e,t,n)}},{key:"remove",value:function(){this._removed=!0,this._handler.onRemove(this)}}]),e}(),Ve=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,!0))._onChange=e,i._value="mouse",i._x=null,i._y=null,i.registerIncoming("pointer-move",(function(e){i._update(e.data)})),i}return(0,v.Z)(n,[{key:"_update",value:function(e){var t="touch"===e.native.pointerType?"touch":"mouse",n=e.x,i=e.y;t===this._value&&this._x===n&&this._y===i||(this._value=t,this._x=n,this._y=i,this._onChange(t,n,i))}}]),n}(Oe),ze=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;return(0,p.Z)(this,n),(e=t.call(this,!0))._activeTouchPointerIds=new Set,e._multiTouchActive=new W.t(!1),e._onPointerAdd=function(t){var n=t.data;"touch"===n.pointerType&&(e._activeTouchPointerIds.add(n.native.pointerId),e._update())},e._onPointerRemove=function(t){var n=t.data;"touch"===n.pointerType&&(e._activeTouchPointerIds.delete(n.native.pointerId),e._update())},e.registerIncoming("pointer-down",e._onPointerAdd),e.registerIncoming("pointer-up",e._onPointerRemove),e.registerIncoming("pointer-capture-lost",e._onPointerRemove),e.registerIncoming("pointer-cancel",e._onPointerRemove),e}return(0,v.Z)(n,[{key:"multiTouchActive",get:function(){return this._multiTouchActive.get()}},{key:"_update",value:function(){this._multiTouchActive.set(this._activeTouchPointerIds.size>1)}}]),n}(Oe),Ue=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._pointerCaptures=new Map,i._nameToGroup={},i._handlers=[],i._handlersPriority=[],i._currentPropagation=null,i._updateDependenciesAfterPropagation=!1,i._sourceEvents=new Set,i._keyModifiers=new Set,i._activeKeyModifiers=new Set,i._stoppedPropagationEventIds=new Set,i.primaryKey=Pe,i._latestPointerType="mouse",i._propertiesPool=new Te({latestPointerLocation:je},(0,s.Z)(i)),i.latestPointerLocation=null,i.test={timestamp:void 0,hasCurrentPropagation:function(){return!!i._currentPropagation}},i}return(0,v.Z)(n,[{key:"initialize",value:function(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}},{key:"destroy",value:function(){for(var e=0,t=Object.keys(this._nameToGroup);e<t.length;e++){var n=t[e];this.uninstallHandlers(n)}this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}},{key:"hasPendingInputs",get:function(){return this._handlers.some((function(e){return e.handler.hasPendingInputs}))}},{key:"latestPointerType",get:function(){return this._latestPointerType}},{key:"multiTouchActive",get:function(){return this._multiTouchHandler.multiTouchActive}},{key:"installHandlers",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:He.INTERNAL;if(this._nameToGroup[e])g.a.getLogger(this.declaredClass).error("There is already an InputHandler group registered under the name `"+e+"`");else if(0!==t.length){var r={name:e,handlers:t.map((function(e){return{handler:e,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}}))};this._nameToGroup[e]=r;for(var o=function(e){var t=r.handlers[e];n._handlers.push(t),t.handler.onInstall({updateDependencies:function(){n.updateDependencies()},emit:function(e,i,r,o,a){n._emitInputEvent(t.priorityIndex+1,e,i,r,a,o)},setPointerCapture:function(e,i){n._setPointerCapture(r,t,e,i)},setEventCallback:function(e){t.eventCallback=e},setUninstallCallback:function(e){t.uninstallCallback=e},refreshHasPendingInputs:function(){n.notifyChange("hasPendingInputs")}})},a=r.handlers.length-1;a>=0;a--)o(a);this.updateDependencies()}else g.a.getLogger(this.declaredClass).error("Can't register a group of zero handlers")}},{key:"uninstallHandlers",value:function(e){var t=this._nameToGroup[e];t?(t.handlers.forEach((function(e){var t;e.removed=!0,null===(t=e.uninstallCallback)||void 0===t||t.call(e)})),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):g.a.getLogger(this.declaredClass).error("There is no InputHandler group registered under the name `"+e+"`")}},{key:"hasHandlers",value:function(e){return void 0!==this._nameToGroup[e]}},{key:"updateDependencies",value:function(){if(this._currentPropagation)this._updateDependenciesAfterPropagation=!0;else{this._updateDependenciesAfterPropagation=!1;var e=new Set,t=new Set;this._handlersPriority=[];for(var n=this._handlers.length-1;n>=0;n--){var i=this._handlers[n];i.priorityIndex=n,this._handlersPriority.push(i)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(var r=this._handlersPriority.length-1;r>=0;r--){var o=this._handlersPriority[r];o.priorityIndex=r;var a=o.handler.hasSideEffects;if(!a){var s,u=(0,d.Z)(o.handler.outgoingEventTypes);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(e.has(l)){a=!0;break}}}catch(g){u.e(g)}finally{u.f()}}if(a){var c,h=(0,d.Z)(o.handler.incomingEventMatches);try{for(h.s();!(c=h.n()).done;){var p=c.value;e.add(p.eventType);var v,f=(0,d.Z)(p.keyModifiers);try{for(f.s();!(v=f.n()).done;){var y=v.value;Re(y)||t.add(y)}}catch(g){f.e(g)}finally{f.f()}}}catch(g){h.e(g)}finally{h.f()}}o.active=a}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}}},{key:"_setLatestPointer",value:function(e,t,n){this._latestPointerType=e;var i=this._get("latestPointerLocation");if((0,m.t)(i)||i.x!==t||i.y!==n){var r=this._propertiesPool.get("latestPointerLocation");r.x=t,r.y=n,this._set("latestPointerLocation",r)}}},{key:"_onEventReceived",value:function(e,t){if("pointer-capture-lost"===e){var n=t;this._pointerCaptures.delete(n.native.pointerId)}this._updateKeyModifiers(e,t);var i=null!=this.test.timestamp?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}},{key:"_updateKeyModifiers",value:function(e,t){var n=this;if(t){var i=!1,r=function(){if(!i){var e=new Set;n._activeKeyModifiers.forEach((function(t){e.add(t)})),n._activeKeyModifiers=e,i=!0}},o=function(e,t){t&&!n._activeKeyModifiers.has(e)?(r(),n._activeKeyModifiers.add(e)):!t&&n._activeKeyModifiers.has(e)&&(r(),n._activeKeyModifiers.delete(e))};if("key-down"===e||"key-up"===e){var a=t.key;this._keyModifiers.has(a)&&o(a,"key-down"===e)}var s=t.native;o("Alt",!(!s||!s.altKey)),o("Ctrl",!(!s||!s.ctrlKey)),o("Shift",!(!s||!s.shiftKey)),o("Meta",!(!s||!s.metaKey)),o("Primary",this._activeKeyModifiers.has(this.primaryKey))}}},{key:"_installRecognizers",value:function(){var e=this;this._latestPointerHandler=new Ve((function(t,n,i){return e._setLatestPointer(t,n,i)})),this._multiTouchHandler=new ze,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],He.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,He.INTERNAL)}},{key:"_setPointerCapture",value:function(e,t,n,i){var r=e.name+"-"+t.priorityIndex,o=this._pointerCaptures.get(n.pointerId)||new Set;this._pointerCaptures.set(n.pointerId,o),i?(o.add(r),1===o.size&&this.eventSource&&this.eventSource.setPointerCapture(n,!0)):o.has(r)&&(o.delete(r),0===o.size&&(this._pointerCaptures.delete(n.pointerId),this.eventSource&&this.eventSource.setPointerCapture(n,!1)))}},{key:"_garbageCollectRemovedHandlers",value:function(){this._handlers=this._handlers.filter((function(e){return!e.removed})),this.updateDependencies()}},{key:"_emitInputEventFromSource",value:function(e,t,n,i){this._emitInputEvent(0,e,t,n,i)}},{key:"_emitInputEvent",value:function(e,t,n,i,r,o){var a=void 0!==i?i:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),s=void 0!==r&&r,u={event:new Be(t,n,a,o||this._activeKeyModifiers,s),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(u):this._doNewPropagation(u)}},{key:"_doNewPropagation",value:function(e){this._currentPropagation={events:new q.e,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}},{key:"_continuePropagation",value:function(){for(var e=this,t=(0,m.i)(this._currentPropagation);t.events.length>0;){var n=t.events.pop(),i=n.event,r=n.priorityIndex,o=i.data&&i.data.eventId;if(null==o||!this._stoppedPropagationEventIds.has(o))for(t.currentHandler=this._handlersPriority[r];t.currentHandler;){if(t.currentHandler.removed)t.needsHandlerGarbageCollect=!0;else{var a,s;if(t.currentHandler.active&&!i.shouldStopPropagation()&&null!==(a=(s=t.currentHandler).eventCallback)&&void 0!==a&&a.call(s,i),i.shouldStopPropagation()){null!=o&&this._stoppedPropagationEventIds.add(o);break}if(i.shouldPausePropagation((function(){return e._continuePropagation()})))return void this._pausePropagation({event:i,priorityIndex:t.currentHandler.priorityIndex+1})}t.currentHandler=this._handlersPriority[t.currentHandler.priorityIndex+1]}}t.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}},{key:"_pausePropagation",value:function(e){var t=new q.e;t.push(e);var n=this._currentPropagation;if(n){for(;n.events.length;)t.push(n.events.pop());n.events=t,n.currentHandler=null}}},{key:"_compareHandlerPriority",value:function(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;var n,i=(0,d.Z)(e.handler.incomingEventMatches);try{for(i.s();!(n=i.n()).done;){var r,o=n.value,a=(0,d.Z)(t.handler.incomingEventMatches);try{var s=function(){var e=r.value;if(o.eventType!==e.eventType)return"continue";var t=o.keyModifiers.filter((function(t){return e.keyModifiers.includes(t)}));return t.length===o.keyModifiers.length!==(t.length===e.keyModifiers.length)?{v:o.keyModifiers.length>e.keyModifiers.length?-1:1}:void 0};for(a.s();!(r=a.n()).done;){var u=s();if("continue"!==u&&"object"===typeof u)return u.v}}catch(l){a.e(l)}finally{a.f()}}}catch(l){i.e(l)}finally{i.f()}return e.priorityIndex>t.priorityIndex?-1:1}},{key:"_sortHandlersPriority",value:function(e){var t,n=[],i=(0,d.Z)(e);try{for(i.s();!(t=i.n()).done;){for(var r=t.value,o=0;o<n.length&&this._compareHandlerPriority(r,n[o])>=0;)o++;n.splice(o,0,r)}}catch(a){i.e(a)}finally{i.f()}return n}},{key:"debug",get:function(){var e=this,t=function(t){var n=e._setPointerCapture;e._setPointerCapture=function(){},t(),e._setPointerCapture=n};return{injectEvent:function(n,i){t((function(){e._onEventReceived(n,i)}))},disablePointerCapture:t}}}]),n}(g.m);(0,g.e)([(0,g.y)({readOnly:!0})],Ue.prototype,"hasPendingInputs",null),(0,g.e)([(0,g.y)({constructOnly:!0})],Ue.prototype,"eventSource",void 0),(0,g.e)([(0,g.y)({constructOnly:!0})],Ue.prototype,"recognizers",void 0),(0,g.e)([(0,g.y)()],Ue.prototype,"_latestPointerType",void 0),(0,g.e)([(0,g.y)()],Ue.prototype,"latestPointerType",null),(0,g.e)([(0,g.y)()],Ue.prototype,"multiTouchActive",null),(0,g.e)([(0,g.y)({readOnly:!0})],Ue.prototype,"latestPointerLocation",void 0),Ue=(0,g.e)([(0,g.n)("esri.views.input.InputManager")],Ue);var Ge,Be=function(){function e(t,n,i,r,o){(0,p.Z)(this,e),this.type=t,this.data=n,this.timestamp=i,this.modifiers=r,this.cancelable=o,this._propagationState=Ge.NONE,this._resumeCallback=null}return(0,v.Z)(e,[{key:"stopPropagation",value:function(){this._propagationState|=Ge.STOPPED}},{key:"shouldStopPropagation",value:function(){return 0!=(this._propagationState&Ge.STOPPED)}},{key:"async",value:function(e){var t=this;this._propagationState|=Ge.PAUSED;var n=function(e,n){t._propagationState&=~Ge.PAUSED;var i=t._resumeCallback;if(t._resumeCallback=null,i&&i(),n)throw e;return e};return("function"==typeof e?e():e).then((function(e){return n(e,!1)}),(function(e){return n(e,!0)}))}},{key:"shouldPausePropagation",value:function(e){return!!(this._propagationState&Ge.PAUSED)&&(this._resumeCallback=e,!0)}},{key:"preventDefault",value:function(){this.data.native.preventDefault()}}]),e}();!function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"}(Ge||(Ge={}));var He={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3},je=(0,v.Z)((function e(){(0,p.Z)(this,e)})),We="esri-icon-zoom-in-magnifying-glass",qe="esri-icon-trash",Ke="esri-icon-table",Qe=new Z.a({id:"zoom-to-feature",title:"{messages.zoom}",className:We}),Ye=new Z.a({id:"remove-selected-feature",title:"{messages.remove}",className:qe}),Xe=new Z.a({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:We}),Je=new Z.a({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:Ke}),$e=g.a.getLogger("esri.widgets.Popup.PopupViewModel"),et=function(e){var t=e.event,n=e.view,i=t.action,r=n&&n.popup;if(!i)return Promise.reject(new g.s("trigger-action:missing-arguments","Event has no action"));if(!r)return Promise.reject(new g.s("trigger-action:missing-arguments","view.popup is missing"));var o=i.disabled,a=i.id;if(!a)return Promise.reject(new g.s("trigger-action:invalid-action","action.id is missing"));if(o)return Promise.reject(new g.s("trigger-action:invalid-action","Action is disabled"));if(a===Qe.id)return function(e){return ot.apply(this,arguments)}(r.viewModel).catch(g.ag);if(a===Xe.id)return function(e){return at.apply(this,arguments)}(r.viewModel);if(a===Je.id)return r.featureMenuOpen=!r.featureMenuOpen,r.viewModel.browseClusterEnabled=!r.viewModel.browseClusterEnabled,Promise.resolve();if(r.viewModel.browseClusterEnabled=!1,a===Ye.id){r.close();var s=r.selectedFeature;if(!s)return Promise.reject(new g.s("trigger-action:".concat(Ye.id),"selectedFeature is required",{selectedFeature:s}));var u=s.sourceLayer;return u?u.remove(s):n.graphics.remove(s),Promise.resolve()}return Promise.resolve()};function tt(e){var t=e.selectedFeature,n=e.location,i=e.view;return i?"3d"===i.type?t||n:e.get("selectedFeature.geometry")||n:null}function nt(e){var t,n;return(null===e||void 0===e?void 0:e.isAggregate)&&"cluster"===(null===e||void 0===e||null===(t=e.sourceLayer)||void 0===t||null===(n=t.featureReduction)||void 0===n?void 0:n.type)}function it(e,t){return rt.apply(this,arguments)}function rt(){return rt=(0,c.Z)((0,l.Z)().mark((function e(t,n){var i,r;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("3d"===(null===n||void 0===n?void 0:n.type)&&t&&"esri.Graphic"===t.declaredClass){e.next=2;break}return e.abrupt("return",!0);case 2:if(!(i=n.getViewForGraphic(t))||!("whenGraphicBounds"in i)){e.next=13;break}return e.prev=4,e.next=7,i.whenGraphicBounds(t,{useViewElevation:!0});case 7:r=e.sent,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(4);case 12:return e.abrupt("return",!r||!r.boundingBox||r.boundingBox[0]===r.boundingBox[3]&&r.boundingBox[1]===r.boundingBox[4]&&r.boundingBox[2]===r.boundingBox[5]);case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e,null,[[4,10]])}))),rt.apply(this,arguments)}function ot(){return ot=(0,c.Z)((0,l.Z)().mark((function e(t){var n,i,r,o,a,s,u,c,d,h;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.location,i=t.selectedFeature,r=t.view,o=t.zoomFactor,a=tt(t)){e.next=4;break}throw s=new g.s("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:a,view:r}),$e.error(s),s;case 4:if(u=r.scale/o,c=t.get("selectedFeature.geometry")||n,e.t0=c&&"point"===c.type,!e.t0){e.next=11;break}return e.next=10,it(i,r);case 10:e.t0=e.sent;case 11:return d=e.t0,Qe.active=!0,Qe.disabled=!0,e.prev=13,e.next=16,t.zoomTo({target:{target:a,scale:d?u:void 0}});case 16:e.next=22;break;case 18:e.prev=18,e.t1=e.catch(13),h=new g.s("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:i}),$e.error(h);case 22:return e.prev=22,Qe.active=!1,Qe.disabled=!1,t.zoomToLocation=null,d&&(t.location=c),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[13,18,22,25]])}))),ot.apply(this,arguments)}function at(){return at=(0,c.Z)((0,l.Z)().mark((function e(t){var n,i,r,o,a,s,u,c,d;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selectedFeature,"2d"===(null===(i=t.view)||void 0===i?void 0:i.type)){e.next=4;break}throw r=new g.s("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i}),$e.error(r),r;case 4:if(nt(n)){e.next=7;break}throw o=new g.s("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:n}),$e.error(o),o;case 7:return a=n.sourceLayer,e.next=10,i.whenLayerView(a);case 10:return s=e.sent,(u=s.createQuery()).aggregateIds=[n.getObjectId()],Xe.active=!0,Xe.disabled=!0,e.next=15,s.queryExtent(u);case 15:return c=e.sent,d=c.extent,e.next=19,t.zoomTo({target:d});case 19:Xe.active=!1,Xe.disabled=!1;case 21:case"end":return e.stop()}}),e)}))),at.apply(this,arguments)}function st(e){return ut.apply(this,arguments)}function ut(){return ut=(0,c.Z)((0,l.Z)().mark((function e(t){var n,i,r,o,a,s,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.selectedFeature,i=t.view,r=n.sourceLayer,e.next=5,i.whenLayerView(r);case 5:return o=e.sent,(a=o.createQuery()).aggregateIds=[n.getObjectId()],e.next=10,o.queryExtent(a);case 10:s=e.sent,u=s.extent,t.selectedClusterBoundaryFeature.geometry=u,i.graphics.add(t.selectedClusterBoundaryFeature);case 13:case"end":return e.stop()}}),e)}))),ut.apply(this,arguments)}function lt(e){return ct.apply(this,arguments)}function ct(){return ct=(0,c.Z)((0,l.Z)().mark((function e(t){var n,i,r,o,a,s,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.selectedFeature,i=t.view,r=n.sourceLayer,e.next=5,i.whenLayerView(r);case 5:return o=e.sent,(a=o.createQuery()).aggregateIds=[n.getObjectId()],Je.active=!0,Je.disabled=!0,e.next=10,o.queryFeatures(a);case 10:s=e.sent,u=s.features,Je.active=!1,Je.disabled=!1,i.popup.open({features:[n].concat(u),featureMenuOpen:!0});case 13:case"end":return e.stop()}}),e)}))),ct.apply(this,arguments)}var dt=k.j.ofType({key:"type",defaultKeyValue:"button",base:Z.c,typeMap:{button:Z.a,toggle:Z.b}}),ht=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._handles=new g.X,i._pendingPromises=new Set,i._fetchFeaturesController=null,i._selectedClusterFeature=null,i.featurePage=null,i.actions=new dt,i.activeFeature=null,i.defaultPopupTemplateEnabled=!1,i.autoCloseEnabled=!1,i.autoOpenEnabled=!0,i.browseClusterEnabled=!1,i.content=null,i.featuresPerPage=20,i.featureViewModelAbilities=null,i.featureViewModels=[],i.highlightEnabled=!0,i.includeDefaultActions=!0,i.selectedClusterBoundaryFeature=new C.g({symbol:new T.a({outline:{width:1.5,color:"cyan"},style:"none"})}),i.title=null,i.updateLocationEnabled=!1,i.view=null,i.visible=!1,i.zoomFactor=4,i.zoomToLocation=null,i}return(0,v.Z)(n,[{key:"isLoadingFeature",get:function(){return this.featureViewModels.some((function(e){return e.waitingForContent}))}},{key:"initialize",value:function(){var e=this;this._handles.add([(0,_.l)((function(){return[e.autoOpenEnabled,e.view]}),(function(){return e._autoOpenEnabledChange()})),this.on("view-change",(function(){return e._autoClose()})),(0,_.l)((function(){return[e.highlightEnabled,e.selectedFeature,e.visible,e.view]}),(function(){return e._highlightSelectedFeature()})),(0,_.l)((function(){return[e.highlightEnabled,e.activeFeature,e.visible,e.view]}),(function(){return e._highlightActiveFeature()})),(0,_.l)((function(){var t,n;return null===(t=e.view)||void 0===t||null===(n=t.animation)||void 0===n?void 0:n.state}),(function(t){return e._animationStateChange(t)})),(0,_.l)((function(){return e.location}),(function(t){return e._locationChange(t)})),(0,_.l)((function(){return e.selectedFeature}),(function(t){return e._selectedFeatureChange(t)})),(0,_.l)((function(){return[e.selectedFeatureIndex,e.featureCount,e.featuresPerPage]}),(function(){return e._selectedFeatureIndexChange()})),(0,_.l)((function(){return[e.featurePage,e.selectedFeatureIndex,e.featureCount,e.featuresPerPage,e.featureViewModels]}),(function(){return e._setGraphicOnFeatureViewModels()})),(0,_.l)((function(){return e.featureViewModels}),(function(){return e._featureViewModelsChange()})),this.on("trigger-action",(function(t){return et({event:t,view:e.view})})),(0,_.f)((function(){return!e.waitingForResult}),(function(){return e._waitingForResultChange()}),_.U),(0,_.l)((function(){var t,n;return[e.features,null===(t=e.view)||void 0===t?void 0:t.map,null===(n=e.view)||void 0===n?void 0:n.spatialReference]}),(function(){return e._updateFeatureVMs()})),(0,_.l)((function(){var t;return null===(t=e.view)||void 0===t?void 0:t.scale}),(function(){return e._viewScaleChange()})),(0,_.f)((function(){return!e.visible}),(function(){return e.browseClusterEnabled=!1})),(0,_.l)((function(){return e.browseClusterEnabled}),(function(t){return t?e.enableClusterBrowsing():e.disableClusterBrowsing()}))])}},{key:"destroy",value:function(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}},{key:"active",get:function(){return!(!this.visible||this.waitingForResult)}},{key:"allActions",get:function(){var e=this._get("allActions")||new dt;e.removeAll();var t=this.actions,n=this.defaultActions,i=this.defaultPopupTemplateEnabled,r=this.includeDefaultActions,o=this.selectedFeature,a=r?n.concat(t):t,s=o&&("function"==typeof o.getEffectivePopupTemplate&&o.getEffectivePopupTemplate(i)||o.popupTemplate),u=s&&s.actions,l=s&&s.overwriteActions?u:u?u.concat(a):a;return l&&l.filter(Boolean).forEach((function(t){return e.add(t)})),e}},{key:"defaultActions",get:function(){var e=this._get("defaultActions")||new dt;return e.removeAll(),e.addMany(nt(this.selectedFeature)?[Xe.clone(),Je.clone()]:[Qe.clone()]),e}},{key:"featureCount",get:function(){return this.features.length}},{key:"features",get:function(){return this._get("features")||[]},set:function(e){var t=e||[];this._set("features",t);var n=this.pendingPromisesCount,i=this.promiseCount,r=this.selectedFeatureIndex,o=i&&t.length;o&&n&&-1===r?this.selectedFeatureIndex=0:o&&-1!==r||(this.selectedFeatureIndex=t.length?0:-1)}},{key:"location",get:function(){return this._get("location")||null},set:function(e){var t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=(0,P.R)(e)),this._set("location",e)}},{key:"pendingPromisesCount",get:function(){return this._pendingPromises.size}},{key:"waitingForResult",get:function(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}},{key:"promiseCount",get:function(){return this.promises.length}},{key:"promises",get:function(){return this._get("promises")||[]},set:function(e){var t=this;if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach((function(e){t._pendingPromises.add(e);e.then((function(n){t._pendingPromises.has(e)&&t._updateFeatures(n),t._updatePendingPromises(e)}),(function(){return t._updatePendingPromises(e)}))})),this.notifyChange("pendingPromisesCount")}},{key:"selectedFeature",get:function(){var e=this.features,t=this.selectedFeatureIndex;return-1===t?null:e[t]||null}},{key:"selectedFeatureIndex",get:function(){var e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1},set:function(e){var t=this.featureCount;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}},{key:"selectedFeatureViewModel",get:function(){return this.featureViewModels[this.selectedFeatureIndex]||null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"centerAtLocation",value:function(){var e=this.view,t=tt(this);return t?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new g.s("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}},{key:"zoomTo",value:function(e){return this.callGoTo(e)}},{key:"clear",value:function(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}},{key:"fetchFeatures",value:function(e,t){var n=this.view;if(!n||!e)throw new g.s("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:n});return n.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}},{key:"open",value:function(e){var t=(0,h.Z)((0,h.Z)({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{},{visible:!0}),n=t.fetchFeatures;delete t.fetchFeatures,n&&this._setFetchFeaturesPromises(t.location);for(var i=0,r=["actionsMenuOpen","collapsed","featureMenuOpen"];i<r.length;i++){delete t[r[i]]}this.set(t)}},{key:"triggerAction",value:function(e){var t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}},{key:"next",value:function(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}},{key:"previous",value:function(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}},{key:"disableClusterBrowsing",value:function(){(function(e){var t=e.features.filter((function(e){return nt(e)}));t.length&&(e.features=t)})(this),this._clearBrowsedClusterGraphics()}},{key:"enableClusterBrowsing",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(){var t,n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.view,n=this.selectedFeature,"2d"!==(null===t||void 0===t?void 0:t.type)){e.next=12;break}if(!nt(n)){e.next=9;break}return e.next=5,st(this);case 5:return e.next=7,lt(this);case 7:e.next=10;break;case 9:g.a.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",n);case 10:e.next=13;break;case 12:g.a.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_animationStateChange",value:function(e){this.zoomToLocation||(Qe.disabled="waiting-for-target"===e)}},{key:"_clearBrowsedClusterGraphics",value:function(){var e,t=null===(e=this.view)||void 0===e?void 0:e.graphics;t&&(t.remove(this.selectedClusterBoundaryFeature),t.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}},{key:"_viewScaleChange",value:function(){if(nt(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}},{key:"_locationChange",value:function(e){var t=this.selectedFeature;this.updateLocationEnabled&&e&&(!t||t.geometry)&&this.centerAtLocation()}},{key:"_selectedFeatureIndexChange",value:function(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}},{key:"_featureViewModelsChange",value:function(){this.featurePage=this.featureCount>1?1:null}},{key:"_setGraphicOnFeatureViewModels",value:function(){var e=this.features,t=this.featureCount,n=this.featurePage,i=this.featuresPerPage,r=this.featureViewModels;if(null!==n){var o=((n-1)*i+t)%t,a=o+i;r.slice(o,a).forEach((function(t,n){t&&!t.graphic&&(t.graphic=e[o+n])}))}}},{key:"_selectedFeatureChange",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(t){var n,i,r,o=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(n=this.location,i=this.updateLocationEnabled,r=this.view,!this.browseClusterEnabled){e.next=11;break}if(this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),!nt(t)){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,(0,A.x)(t);case 8:return t.symbol=e.sent,this._selectedClusterFeature=t,e.abrupt("return",void r.graphics.add(this._selectedClusterFeature));case 11:!i&&n||!t.geometry?i&&!t.geometry&&this.centerAtLocation().then((function(){o.location=r.center.clone()})):this.location=(0,m.e)(this._getPointFromGeometry(t.geometry));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_waitingForResultChange",value:function(){!this.featureCount&&this.promises&&(this.visible=!1)}},{key:"_setFetchFeaturesPromises",value:function(e){var t=this;return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then((function(e){var n=e.clientOnlyGraphics,i=e.promisesPerLayerView,r=Promise.resolve(n),o=i.map((function(e){return e.promise}));t.promises=[r].concat((0,a.Z)(o))}))}},{key:"_destroyFeatureVMs",value:function(){this.featureViewModels.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureViewModels",[])}},{key:"_updateFeatureVMs",value:function(){var e=this,t=this.selectedFeature,n=this.features,i=this.featureViewModels;if(nt(t)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),n&&n.length){var r=i.slice(0),o=[];n.forEach((function(n,i){if(n){var a=null;if(r.some((function(e,t){return e&&e.graphic===n&&(a=e,r.splice(t,1)),!!a})),a)o[i]=a;else{var s,u,l=new E.W({abilities:e.featureViewModelAbilities,defaultPopupTemplateEnabled:e.defaultPopupTemplateEnabled,spatialReference:null===(s=e.view)||void 0===s?void 0:s.spatialReference,graphic:n===t?n:null,map:null===(u=e.view)||void 0===u?void 0:u.map,view:e.view});o[i]=l}}})),r.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureViewModels",o)}}},{key:"_getScreenPoint",value:function(e){var t=this.view;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}},{key:"_autoOpenEnabledChange",value:function(){var e=this,t="auto-fetch-features",n=this._handles,i=this.autoOpenEnabled;if(n.remove(t),i&&this.view){var r=this.view.on("click",(function(t){"mouse"===t.pointerType&&0!==t.button||e._fetchFeaturesAndOpen(t)}),He.WIDGET);n.add(r,t)}}},{key:"_cancelFetchingFeatures",value:function(){var e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}},{key:"_fetchFeaturesWithController",value:function(e,t){var n=this;this._cancelFetchingFeatures();var i=new AbortController,r=i.signal;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");var o=this.fetchFeatures(e,{signal:r,event:t});return o.catch((function(){})).then((function(){n._fetchFeaturesController=null,n.notifyChange("waitingForResult")})),o}},{key:"_fetchFeaturesAndOpen",value:function(e){var t=e.screenPoint,n=e.mapPoint,i=this.view;this._fetchFeaturesWithController(t,e).then((function(e){var t=e.clientOnlyGraphics,r=e.promisesPerLayerView,o=e.location,s=[Promise.resolve(t)].concat((0,a.Z)(r.map((function(e){return e.promise}))));return i.popup.open({location:o||n,promises:s}),e}))}},{key:"_updatePendingPromises",value:function(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}},{key:"_autoClose",value:function(){this.autoCloseEnabled&&(this.visible=!1)}},{key:"_getPointFromGeometry",value:function(e){var t;return(0,m.t)(e)?null:"point"===e.type?e:"extent"===e.type?e.center:"polygon"===e.type?e.centroid:"multipoint"===e.type||"polyline"===e.type?null===(t=e.extent)||void 0===t?void 0:t.center:null}},{key:"_getLayerView",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.when();case 2:return e.abrupt("return",t.whenLayerView(n));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getHighlightLayer",value:function(e){var t=e.layer,n=e.sourceLayer;return n&&"layer"in n&&n.layer?n.layer:"map-notes"===(null===n||void 0===n?void 0:n.type)||"subtype-group"===(null===n||void 0===n?void 0:n.type)?n:t}},{key:"_getHighlightTarget",value:function(e,t){var n="imagery"===t.type?void 0:"objectIdField"in t?t.objectIdField||Ce:null,i=e.attributes;return i&&n&&i[n]||e}},{key:"_highlightActiveFeature",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(){var t,n,i,r,o,a,s,u,c;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="highlight-active-feature",this._handles.remove(t),n=this.highlightEnabled,i=this.view,r=this.activeFeature,o=this.visible,r&&i&&n&&o){e.next=5;break}return e.abrupt("return");case 5:if((a=this._getHighlightLayer(r))&&a instanceof I.b){e.next=8;break}return e.abrupt("return");case 8:return s=this._getLayerView(i,a),this._highlightActiveFeaturePromise=s,e.next=12,s;case 12:if((u=e.sent)&&(0,S.a)(u)&&this._highlightActiveFeaturePromise===s&&this.activeFeature&&this.highlightEnabled){e.next=15;break}return e.abrupt("return");case 15:c=u.highlight(this._getHighlightTarget(r,a)),this._handles.add(c,t);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_highlightSelectedFeature",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(){var t,n,i,r,o,a,s,u,c;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="highlight-selected-feature",this._handles.remove(t),n=this.selectedFeature,i=this.highlightEnabled,r=this.view,o=this.visible,n&&r&&i&&o){e.next=5;break}return e.abrupt("return");case 5:if((a=this._getHighlightLayer(n))&&a instanceof I.b){e.next=8;break}return e.abrupt("return");case 8:return s=this._getLayerView(r,a),this._highlightSelectedFeaturePromise=s,e.next=12,s;case 12:if((u=e.sent)&&(0,S.a)(u)&&this._highlightSelectedFeaturePromise===s&&this.selectedFeature&&this.highlightEnabled&&this.visible){e.next=15;break}return e.abrupt("return");case 15:c=u.highlight(this._getHighlightTarget(n,a)),this._handles.add(c,t);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_updateFeatures",value:function(e){var t=this.features;if(e&&e.length)if(t.length){var n=e.filter((function(e){return!t.includes(e)}));this.features=t.concat(n)}else this.features=e}}]),n}((0,S.e)(me));(0,g.e)([(0,g.y)()],ht.prototype,"featurePage",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"isLoadingFeature",null),(0,g.e)([(0,g.y)({type:dt})],ht.prototype,"actions",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],ht.prototype,"active",null),(0,g.e)([(0,g.y)()],ht.prototype,"activeFeature",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],ht.prototype,"allActions",null),(0,g.e)([(0,g.y)({type:Boolean})],ht.prototype,"defaultPopupTemplateEnabled",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"autoCloseEnabled",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"autoOpenEnabled",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"browseClusterEnabled",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"content",void 0),(0,g.e)([(0,g.y)({type:dt,readOnly:!0})],ht.prototype,"defaultActions",null),(0,g.e)([(0,g.y)({readOnly:!0})],ht.prototype,"featureCount",null),(0,g.e)([(0,g.y)()],ht.prototype,"features",null),(0,g.e)([(0,g.y)()],ht.prototype,"featuresPerPage",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"featureViewModelAbilities",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],ht.prototype,"featureViewModels",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"highlightEnabled",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"includeDefaultActions",void 0),(0,g.e)([(0,g.y)({type:P.w})],ht.prototype,"location",null),(0,g.e)([(0,g.y)({readOnly:!0})],ht.prototype,"pendingPromisesCount",null),(0,g.e)([(0,g.y)({readOnly:!0})],ht.prototype,"selectedClusterBoundaryFeature",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],ht.prototype,"waitingForResult",null),(0,g.e)([(0,g.y)({readOnly:!0})],ht.prototype,"promiseCount",null),(0,g.e)([(0,g.y)()],ht.prototype,"promises",null),(0,g.e)([(0,g.y)({value:null,readOnly:!0})],ht.prototype,"selectedFeature",null),(0,g.e)([(0,g.y)({value:-1})],ht.prototype,"selectedFeatureIndex",null),(0,g.e)([(0,g.y)({readOnly:!0})],ht.prototype,"selectedFeatureViewModel",null),(0,g.e)([(0,g.y)({readOnly:!0})],ht.prototype,"state",null),(0,g.e)([(0,g.y)()],ht.prototype,"title",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"updateLocationEnabled",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"view",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"visible",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"zoomFactor",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"zoomToLocation",void 0),(0,g.e)([(0,g.y)()],ht.prototype,"centerAtLocation",null);var pt=ht=(0,g.e)([(0,g.n)("esri.widgets.Popup.PopupViewModel")],ht),vt="selected-index",ft="popup-spinner",yt="calcite-theme-light",gt="calcite-theme-dark",mt="esri-icon-left-triangle-arrow",_t="esri-icon-right-triangle-arrow",wt="esri-icon-maximize",kt="esri-icon-dock-bottom",bt="esri-icon-dock-left",Mt="esri-icon-dock-right",Et="esri-icon-close",xt="esri-icon-minimize",Ct="esri-icon-check-mark",Tt="esri-icon-loading-indicator",Pt="esri-icon-default-action",It="esri-icon-handle-horizontal",Zt="esri-rotating",At="esri-popup",St="esri-widget",Rt="esri-popup__main-container",Ft="esri-popup__loading-container",Lt="esri-popup--is-collapsible",Ot="esri-popup--is-collapsed",Dt="esri-popup--shadow",Nt="esri-popup--is-docked",Vt="esri-popup--is-docked-top-left",zt="esri-popup--is-docked-top-center",Ut="esri-popup--is-docked-top-right",Gt="esri-popup--is-docked-bottom-left",Bt="esri-popup--is-docked-bottom-center",Ht="esri-popup--is-docked-bottom-right",jt="esri-popup--aligned-top-center",Wt="esri-popup--aligned-bottom-center",qt="esri-popup--aligned-top-left",Kt="esri-popup--aligned-bottom-left",Qt="esri-popup--aligned-top-right",Yt="esri-popup--aligned-bottom-right",Xt="esri-popup--feature-menu-open",Jt="esri-popup--actions-menu-open",$t="esri-popup--feature-updated",en="esri-popup__header",tn="esri-popup__header-buttons",nn="esri-popup__header-container",rn="esri-popup__header-container--button",on="esri-popup__header-title",an="esri-popup__content",sn="esri-content--has-flows",un="esri-content__flow-item",ln="esri-popup__footer",cn="esri-popup__footer--has-pagination",dn="esri-popup__footer--has-actions",hn="esri-popup__footer--has-actions-menu",pn="esri-popup__button",vn="esri-popup__button--disabled",fn="esri-popup__button--dock",yn="esri-popup__icon",gn="esri-popup__icon--dock-icon",mn="esri-popup__inline-actions-container",_n="esri-popup__actions-menu-button",wn="esri-popup__actions",kn="esri-popup__action",bn="esri-popup__action-image",Mn="esri-popup__action-text",En="esri-popup__action-toggle",xn="esri-popup__action-toggle--on",Cn="esri-popup__action--exit",Tn="esri-popup__pointer",Pn="esri-popup__pointer-direction",In="esri-popup__navigation",Zn="esri-popup__pagination-previous",An="esri-popup__pagination-next",Sn="esri-popup__pagination-previous-icon",Rn="esri-popup__pagination-previous-icon--rtl",Fn="esri-popup__pagination-next-icon",Ln="esri-popup__pagination-next-icon--rtl",On="esri-popup__feature-menu",Dn="esri-popup__feature-menu-list",Nn="esri-popup__feature-menu-item",Vn="esri-popup__feature-menu-viewport",zn="esri-popup__feature-menu-header",Un="esri-popup__feature-menu-item--selected",Gn="esri-popup__feature-menu-button",Bn="esri-popup__feature-menu-title",Hn="esri-popup__feature-menu-observer",jn="esri-popup__feature-menu-loader",Wn="esri-popup__collapse-icon",qn={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},Kn="esri-popup";function Qn(e,t){return void 0===t?"".concat(Kn,"__").concat(e):"".concat(Kn,"__").concat(e,"-").concat(t)}var Yn={closeButton:!0,featureNavigation:!0},Xn=function(e){(0,f.Z)(i,e);var t=(0,y.Z)(i);function i(e,n){var r;return(0,p.Z)(this,i),(r=t.call(this,e,n))._blurClose=!1,r._blurContainer=!1,r._containerNode=null,r._mainContainerNode=null,r._featureMenuNode=null,r._actionsMenuNode=null,r._focusClose=!1,r._focusContainer=!1,r._focusDockButton=!1,r._focusFeatureMenuButton=!1,r._focusActionsMenuButton=!1,r._focusFirstFeature=!1,r._focusFirstAction=!1,r._handles=new g.X,r._pointerOffsetInPx=16,r._spinner=null,r._feature=null,r._featureMenuIntersectionObserverCallback=function(e){var t=(0,o.Z)(e,1)[0];(null===t||void 0===t?void 0:t.isIntersecting)&&r.viewModel.featurePage++},r._featureMenuIntersectionObserver=new IntersectionObserver(r._featureMenuIntersectionObserverCallback,{root:window.document}),r._displaySpinnerThrottled=(0,E.e)((function(){return r._displaySpinner()}),0),r._exitRelatedRecordsActions=new WeakMap,r._flowItems=new k.j,r.alignment="auto",r.collapsed=!1,r.collapseEnabled=!0,r.dockEnabled=!1,r.featureMenuOpen=!1,r.headingLevel=2,r.maxInlineActions=3,r.messages=null,r.messagesCommon=null,r.spinnerEnabled=!0,r.viewModel=new pt,r.visibleElements=(0,h.Z)({},Yn),r._addSelectedFeatureIndexHandle(),r.addHandles([(0,_.l)((function(){var e;return null===(e=r.viewModel)||void 0===e?void 0:e.screenLocation}),(function(){return r._positionContainer()})),(0,_.l)((function(){var e;return[null===(e=r.viewModel)||void 0===e?void 0:e.active,r.dockEnabled]}),(function(){return r._toggleScreenLocationEnabled()})),(0,_.l)((function(){var e;return null===(e=r.viewModel)||void 0===e?void 0:e.screenLocation}),(function(e,t){!!e!=!!t&&r.reposition()})),(0,_.l)((function(){var e,t,n,i,o,a;return[null===(e=r.viewModel)||void 0===e||null===(t=e.view)||void 0===t?void 0:t.padding,null===(n=r.viewModel)||void 0===n||null===(i=n.view)||void 0===i?void 0:i.size,null===(o=r.viewModel)||void 0===o?void 0:o.active,null===(a=r.viewModel)||void 0===a?void 0:a.location,r.alignment]}),(function(){return r.reposition()})),(0,_.l)((function(){return r.spinnerEnabled}),(function(e){return r._spinnerEnabledChange(e)})),(0,_.l)((function(){var e,t;return null===(e=r.viewModel)||void 0===e||null===(t=e.view)||void 0===t?void 0:t.size}),(function(e,t){return r._updateDockEnabledForViewSize(e,t)})),(0,_.l)((function(){var e;return null===(e=r.viewModel)||void 0===e?void 0:e.view}),(function(e,t){return r._viewChange(e,t)})),(0,_.l)((function(){var e,t;return null===(e=r.viewModel)||void 0===e||null===(t=e.view)||void 0===t?void 0:t.ready}),(function(e,t){return r._viewReadyChange(e,t)})),(0,_.l)((function(){var e,t;return[null===(e=r.viewModel)||void 0===e?void 0:e.waitingForResult,null===(t=r.viewModel)||void 0===t?void 0:t.location]}),(function(){r._hideSpinner(),r._displaySpinnerThrottled()})),(0,_.l)((function(){return r.selectedFeatureWidget}),(function(){return r._destroyFlowItemWidgets()})),(0,_.l)((function(){var e,t,n,i;return[null===(e=r.selectedFeatureWidget)||void 0===e||null===(t=e.viewModel)||void 0===t?void 0:t.title,null===(n=r.selectedFeatureWidget)||void 0===n||null===(i=n.viewModel)||void 0===i?void 0:i.state]}),(function(){return r._setTitleFromFeatureWidget()})),(0,_.l)((function(){var e,t,n,i;return[null===(e=r.selectedFeatureWidget)||void 0===e||null===(t=e.viewModel)||void 0===t?void 0:t.content,null===(n=r.selectedFeatureWidget)||void 0===n||null===(i=n.viewModel)||void 0===i?void 0:i.state]}),(function(){return r._setContentFromFeatureWidget()})),(0,_.f)((function(){return!r.collapsed}),(function(){var e,t;"xsmall"===(null===(e=r.viewModel)||void 0===e||null===(t=e.view)||void 0===t?void 0:t.widthBreakpoint)&&r.viewModel.active&&r.collapseEnabled&&r.viewModel.centerAtLocation()})),(0,_.a)((function(){var e;return null===(e=r.viewModel)||void 0===e?void 0:e.allActions}),"change",(function(){return r._watchActions()})),(0,_.l)((function(){var e;return null===(e=r.viewModel)||void 0===e?void 0:e.allActions}),(function(){return r._watchActions()}),_.h),(0,_.l)((function(){var e;return null===(e=r.viewModel)||void 0===e?void 0:e.featureViewModels}),(function(){return r._featureMenuViewportScrollTop()})),(0,_.a)((function(){return r._flowItems}),"change",(function(){r.notifyChange("_activeFlowItemWidget"),r.scheduleRender()})),(0,_.l)((function(){var e,t,n,i;return[null===(e=r._activeFlowItemWidget)||void 0===e||null===(t=e.viewModel)||void 0===t?void 0:t.state,null===(n=r._activeFlowItemWidget)||void 0===n||null===(i=n.viewModel)||void 0===i?void 0:i.title]}),(function(){return r.scheduleRender()}))]),r}return(0,v.Z)(i,[{key:"loadDependencies",value:function(){return Promise.all([n.e(8517).then(n.bind(n,88517)),Promise.all([n.e(7701),n.e(3386),n.e(5471)]).then(n.bind(n,55471)),Promise.all([n.e(3386),n.e(4562)]).then(n.bind(n,78224)),Promise.all([n.e(7701),n.e(774)]).then(n.bind(n,20774)),n.e(1903).then(n.bind(n,1903))])}},{key:"destroy",value:function(){var e,t;this._destroyFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),null!==(e=this._handles)&&void 0!==e&&e.destroy(),this._unobserveFeatureMenuObserver(),null!==(t=this._featureMenuIntersectionObserver)&&void 0!==t&&t.disconnect(),this._handles=null}},{key:"actionsMenuId",get:function(){return"".concat(this.id,"-actions-menu")}},{key:"actionsMenuButtonId",get:function(){return"".concat(this.id,"-actions-menu-button")}},{key:"featureMenuId",get:function(){return"".concat(this.id,"-feature-menu")}},{key:"titleId",get:function(){return"".concat(this.id,"-popup-title")}},{key:"contentId",get:function(){return"".concat(this.id,"-popup-content")}},{key:"hasContent",get:function(){var e=this.selectedFeatureWidget,t=this.viewModel;if(!e)return!(null===t||void 0===t||!t.content);var n=e.viewModel;if(null!==n&&void 0!==n&&n.waitingForContent||"error"===(null===n||void 0===n?void 0:n.state))return!0;var i=null===n||void 0===n?void 0:n.content;return Array.isArray(i)?!!i.length:!!i}},{key:"featureNavigationVisible",get:function(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}},{key:"collapsible",get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}},{key:"featureMenuVisible",get:function(){return this.featureNavigationVisible&&this.featureMenuOpen}},{key:"contentCollapsed",get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}},{key:"dividedActions",get:function(){return this._divideActions()}},{key:"_activeFlowItemWidget",get:function(){var e=this._flowItems;return e.getItemAt(e.length-1)||null}},{key:"actions",get:function(){return this.viewModel.actions},set:function(e){this.viewModel.actions=e}},{key:"actionsMenuOpen",get:function(){return!!this.viewModel.active&&this._get("actionsMenuOpen")},set:function(e){this._set("actionsMenuOpen",!!e)}},{key:"autoCloseEnabled",get:function(){return this.viewModel.autoCloseEnabled},set:function(e){this.viewModel.autoCloseEnabled=e}},{key:"autoOpenEnabled",get:function(){return this.viewModel.autoOpenEnabled},set:function(e){this.viewModel.autoOpenEnabled=e}},{key:"defaultPopupTemplateEnabled",get:function(){return this.viewModel.defaultPopupTemplateEnabled},set:function(e){this.viewModel.defaultPopupTemplateEnabled=e}},{key:"content",get:function(){return this.viewModel.content},set:function(e){this.viewModel.content=e}},{key:"currentAlignment",get:function(){return this._getCurrentAlignment()}},{key:"currentDockPosition",get:function(){return this._getCurrentDockPosition()}},{key:"dockOptions",get:function(){return this._get("dockOptions")||qn},set:function(e){var t=(0,h.Z)({},qn),n=this.get("viewModel.view.breakpoints"),i={};n&&(i.width=n.xsmall,i.height=n.xsmall);var r=(0,h.Z)((0,h.Z)({},t),e),o=(0,h.Z)((0,h.Z)({},t.breakpoint),i),a=r.breakpoint;!0===a?r.breakpoint=o:"object"==typeof a&&(r.breakpoint=(0,h.Z)((0,h.Z)({},o),a)),this._set("dockOptions",r),this._setCurrentDockPosition(),this.reposition()}},{key:"featureCount",get:function(){return this.viewModel.featureCount}},{key:"features",get:function(){return this.viewModel.features},set:function(e){this.viewModel.features=e}},{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(e){this.viewModel.goToOverride=e}},{key:"highlightEnabled",get:function(){return this.viewModel.highlightEnabled},set:function(e){this.viewModel.highlightEnabled=e}},{key:"location",get:function(){return this.viewModel.location},set:function(e){this.viewModel.location=e}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"promises",get:function(){return this.viewModel.promises},set:function(e){this.viewModel.promises=e}},{key:"selectedFeature",get:function(){return this.viewModel.selectedFeature}},{key:"selectedFeatureIndex",get:function(){return this.viewModel.selectedFeatureIndex},set:function(e){this.viewModel.selectedFeatureIndex=e}},{key:"selectedFeatureWidget",get:function(){var e=this._feature,t=this.visibleElements,n=this.headingLevel,i=this._flowItems,r=this.viewModel.selectedFeatureViewModel,o=(0,h.Z)((0,h.Z)({},t),{},{title:!1});return r?(e?(e.viewModel=r,e.visibleElements=o):this._feature=new E.C({flowItems:i,headingLevel:n+1,viewModel:r,visibleElements:o}),this._feature):null}},{key:"title",get:function(){return this.viewModel.title},set:function(e){this.viewModel.title=e}},{key:"updateLocationEnabled",get:function(){return this.viewModel.updateLocationEnabled},set:function(e){this.viewModel.updateLocationEnabled=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"visible",get:function(){return this.viewModel.visible},set:function(e){this.viewModel.visible=e}},{key:"castVisibleElements",value:function(e){return(0,h.Z)((0,h.Z)({},Yn),e)}},{key:"blur",value:function(){this.viewModel.active||g.a.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}},{key:"clear",value:function(){return this.viewModel.clear()}},{key:"close",value:function(){this.visible=!1}},{key:"fetchFeatures",value:function(e,t){return this.viewModel.fetchFeatures(e,t)}},{key:"focus",value:function(){this.viewModel.active||g.a.getLogger(this.declaredClass).warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}},{key:"next",value:function(){return this.viewModel.next()}},{key:"open",value:function(e){var t,n;this._handles.remove(vt);var i=!!e&&!!e.featureMenuOpen,r=!!e&&!!e.actionsMenuOpen,o={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:r,featureMenuOpen:i};"xsmall"===(null===(t=this.viewModel)||void 0===t||null===(n=t.view)||void 0===n?void 0:n.widthBreakpoint)&&(o.collapsed=!0),this.set(o),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}},{key:"previous",value:function(){return this.viewModel.previous()}},{key:"reposition",value:function(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}},{key:"triggerAction",value:function(e){return this.viewModel.triggerAction(e)}},{key:"render",value:function(){var e,t,n,i,r,o=this.actionsMenuOpen,a=this.dockEnabled,s=this.featureMenuVisible,l=this.dividedActions,c=this.currentAlignment,d=this.currentDockPosition,h=this.viewModel.active,p=l.menuActions,v=h&&p.length>1&&o,f=h&&a,y=h&&!a,g=null===(e=this.selectedFeature)||void 0===e||null===(t=e.layer)||void 0===t?void 0:t.title,m=null===(n=this.selectedFeature)||void 0===n||null===(i=n.layer)||void 0===i?void 0:i.id,_=(r={},(0,u.Z)(r,jt,"top-center"===c),(0,u.Z)(r,Wt,"bottom-center"===c),(0,u.Z)(r,qt,"top-left"===c),(0,u.Z)(r,Kt,"bottom-left"===c),(0,u.Z)(r,Qt,"top-right"===c),(0,u.Z)(r,Yt,"bottom-right"===c),(0,u.Z)(r,Nt,f),(0,u.Z)(r,Dt,y),(0,u.Z)(r,Vt,"top-left"===d),(0,u.Z)(r,zt,"top-center"===d),(0,u.Z)(r,Ut,"top-right"===d),(0,u.Z)(r,Gt,"bottom-left"===d),(0,u.Z)(r,Bt,"bottom-center"===d),(0,u.Z)(r,Ht,"bottom-right"===d),(0,u.Z)(r,Xt,s),(0,u.Z)(r,Jt,v),r);return(0,w.n)("div",{class:this.classes(At,_),role:"presentation","data-layer-title":g,"data-layer-id":m,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},h?[this.renderMainContainer(),this.renderPointer()]:null)}},{key:"renderLoadingIcon",value:function(){return(0,w.n)("span",{"aria-hidden":"true",class:this.classes(yn,Tt,Zt)})}},{key:"renderNavigationLoading",value:function(){var e=this.messagesCommon;return this.viewModel.pendingPromisesCount?(0,w.n)("div",{key:Qn("loading-container"),role:"presentation",class:Ft,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}},{key:"renderPreviousIcon",value:function(){var e,t=(0,w.f)(this.container),n=(e={},(0,u.Z)(e,_t,t),(0,u.Z)(e,Rn,t),(0,u.Z)(e,mt,!t),(0,u.Z)(e,Sn,!t),e);return(0,w.n)("span",{"aria-hidden":"true",class:this.classes(yn,n)})}},{key:"renderPreviousButton",value:function(){var e=this.messages;return(0,w.n)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(pn,Zn),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}},{key:"renderNextIcon",value:function(){var e,t=(0,w.f)(this.container),n=(e={},(0,u.Z)(e,mt,t),(0,u.Z)(e,Ln,t),(0,u.Z)(e,_t,!t),(0,u.Z)(e,Fn,!t),e);return(0,w.n)("span",{"aria-hidden":"true",class:this.classes(yn,n)})}},{key:"renderNextButton",value:function(){var e=this.messages;return(0,w.n)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(pn,An),"aria-label":e.next,title:e.next},this.renderNextIcon())}},{key:"renderFeatureMenuButton",value:function(){var e=this.featureMenuOpen,t=this.featureMenuId,n=this.messagesCommon,i=this.viewModel,r=i.featureCount,o=i.selectedFeatureIndex;return(0,w.n)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(pn,Gn),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":n.menu,title:n.menu},this._getPageText(r,o))}},{key:"renderNavigationButtons",value:function(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}},{key:"renderDockIcon",value:function(){var e,t=this.dockEnabled,n=this._wouldDockTo(),i=(e={},(0,u.Z)(e,xt,t),(0,u.Z)(e,gn,!t),(0,u.Z)(e,Mt,!t&&("top-right"===n||"bottom-right"===n)),(0,u.Z)(e,bt,!t&&("top-left"===n||"bottom-left"===n)),(0,u.Z)(e,wt,!t&&"top-center"===n),(0,u.Z)(e,kt,!t&&"bottom-center"===n),e);return(0,w.n)("span",{"aria-hidden":"true",class:this.classes(i,yn)})}},{key:"renderDockButton",value:function(){var e,t,n,i=this.dockEnabled,r=this.messages,o=null===(e=this.viewModel)||void 0===e||null===(t=e.view)||void 0===t?void 0:t.widthBreakpoint,a=i?r.undock:r.dock;return"xsmall"!==o&&null!==(n=this.dockOptions)&&void 0!==n&&n.buttonEnabled?(0,w.n)("div",{role:"button","aria-label":a,title:a,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(pn,fn)},this.renderDockIcon()):null}},{key:"renderTitle",value:function(){var e=this.viewModel.title,t=this.titleId,n=this.collapsible,i=this.contentCollapsed,r=this.messagesCommon,o=(0,u.Z)({},rn,n),a=(0,w.n)(R.n,{level:this.headingLevel,class:on,innerHTML:e}),s=n?(0,w.n)("button",{key:"".concat(e,"--collapsible"),id:t,title:i?r.expand:r.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(nn,o),"aria-expanded":i?"false":"true",onclick:this._toggleCollapsed,type:"button"},a,(0,w.n)("calcite-icon",{class:Wn,key:"collapse-icon",icon:i?"chevron-down":"chevron-up",scale:"m"})):(0,w.n)("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(nn,o)},a);return e?s:null}},{key:"renderCloseIcon",value:function(){return(0,w.n)("span",{"aria-hidden":"true",class:this.classes(yn,Et)})}},{key:"renderCloseButton",value:function(){var e=this.visibleElements,t=this.messagesCommon;return e.closeButton?(0,w.n)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:pn,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}},{key:"renderHeader",value:function(){return(0,w.n)("header",{class:en},this.renderTitle(),(0,w.n)("div",{class:tn},this.renderDockButton(),this.renderCloseButton()))}},{key:"renderContentContainer",value:function(){var e=this,t=this.contentId,n=this.hasContent,i=this.contentCollapsed,r=this._flowItems,o=this.messagesCommon,a=this.viewModel.content,s=r.toArray(),l=(0,u.Z)({},sn,!!s.length);return n&&!i?(0,w.n)("div",{key:a,enterAnimation:this._createFeatureUpdatedAnimation(),id:t,class:this.classes(an,l)},(0,w.n)("calcite-flow",{bind:this,onCalciteFlowItemBack:this._handleBackClick},(0,w.n)("calcite-flow-item",{bind:this,"data-node-ref":"_rootFlowItemNode","intl-back":o.back,afterCreate:w.v,key:"root-flow-item"},this.renderContent()),s.map((function(t){return e.renderFlowItem(t)}))),s.map((function(t){return e.renderFlowItemTooltip(t)}))):null}},{key:"renderFlowItem",value:function(e){var t,n,i=this,r=this.messages,o=this.messagesCommon,a=(0,R.r)();return(0,w.n)("calcite-flow-item",{class:this.classes((t={},(0,u.Z)(t,gt,!a),(0,u.Z)(t,yt,a),t)),heading:e.title,"intl-back":o.back,description:this._getFlowItemDescription(e),key:"flow-item-".concat(e.viewModel.uid)},(0,w.n)("calcite-action",{class:Cn,icon:"move-up",label:null===r||void 0===r?void 0:r.exitRelatedRecords,text:null===r||void 0===r?void 0:r.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:function(t){return i._storeExitRelatedRecordsAction(e,t)},onclick:this._destroyFlowItemWidgets}),(0,w.n)("div",{class:this.classes(un,(n={},(0,u.Z)(n,gt,a),(0,u.Z)(n,yt,!a),n))},e.render()))}},{key:"renderFlowItemTooltip",value:function(e){var t,n=this.messages,i=this._exitRelatedRecordsActions,r=(0,R.r)();return(0,w.n)("calcite-tooltip",{class:this.classes((t={},(0,u.Z)(t,gt,!r),(0,u.Z)(t,yt,r),t)),key:"exit-related-records-tooltip-".concat(e.viewModel.uid),label:null===n||void 0===n?void 0:n.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:i.get(e),placement:"top"},null===n||void 0===n?void 0:n.exitRelatedRecords)}},{key:"renderActionsMenuButton",value:function(){var e=this.actionsMenuId,t=this.actionsMenuButtonId,n=this.actionsMenuOpen,i=this.dividedActions,r=this.messagesCommon,o=n?r.close:r.open;return i.menuActions.length?(0,w.n)("div",{key:Qn("actions-menu-button"),class:this.classes(pn,_n),role:"button",id:t,"aria-haspopup":"true","aria-controls":n?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":o,title:o},(0,w.n)("span",{"aria-hidden":"true",class:It})):null}},{key:"renderMenuActions",value:function(){var e=this,t=this.actionsMenuId,n=this.actionsMenuButtonId,i=this.actionsMenuOpen,r=this.dividedActions.menuActions;return r.length&&i?(0,w.n)("ul",{id:t,role:"menu","aria-labelledby":n,key:Qn("actions"),class:wn,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},r.toArray().map((function(t){return e.renderAction({action:t,type:"menu-item"})}))):null}},{key:"renderInlineActions",value:function(){var e=this,t=this.dividedActions.inlineActions;return!!t.length&&t.toArray().map((function(t){return e.renderAction({action:t,type:"inline"})}))}},{key:"renderInlineActionsContainer",value:function(){var e=this.dividedActions,t=e.inlineActions,n=e.menuActions,i=!!t.length,r=!!n.length;return i||r?(0,w.n)("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:mn},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}},{key:"renderNavigation",value:function(){return this.featureNavigationVisible?(0,w.n)("section",{key:Qn("navigation"),class:this.classes(In)},this.renderNavigationButtons()):null}},{key:"renderFooter",value:function(){var e,t=this.featureNavigationVisible,n=this.dividedActions,i=n.inlineActions,r=n.menuActions,o=!!i.length,a=!!r.length,s=(e={},(0,u.Z)(e,cn,t),(0,u.Z)(e,dn,o),(0,u.Z)(e,hn,a),e);return t||o?(0,w.n)("div",{key:Qn("feature-buttons"),class:this.classes(ln,s)},this.renderInlineActionsContainer(),this.renderNavigation()):null}},{key:"renderFeatureMenuContainer",value:function(){var e=this.messages,t=this.viewModel,n=t.featureViewModels,i=t.isLoadingFeature,r=(0,M.s)(e.selectedFeatures,{total:n.length});return(0,w.n)("section",{key:Qn("menu"),class:On},(0,w.n)("strong",{class:zn},r),(0,w.n)("nav",{bind:this,class:Vn,"data-node-ref":"_featureMenuViewportNode",afterCreate:w.v},this.renderFeatureMenu(),(0,w.n)("div",{class:Hn,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?(0,w.n)("div",{class:jn},this.renderLoadingIcon()):null))}},{key:"renderPointer",value:function(){return this.dockEnabled?null:(0,w.n)("div",{key:Qn("pointer"),class:Tn,role:"presentation"},(0,w.n)("div",{class:this.classes(Pn,Dt)}))}},{key:"renderMainContainer",value:function(){var e,t=this.dockEnabled,n=this.currentAlignment,i=this.currentDockPosition,r=this.titleId,o=this.contentId,a=this.collapsible,s=this.hasContent,l=this.contentCollapsed,c=this.visibleElements,d=this.viewModel.title,h="bottom-left"===n||"bottom-center"===n||"bottom-right"===n||"top-left"===i||"top-center"===i||"top-right"===i,p="top-left"===n||"top-center"===n||"top-right"===n||"bottom-left"===i||"bottom-center"===i||"bottom-right"===i,v=(e={},(0,u.Z)(e,Dt,t),(0,u.Z)(e,Lt,a),(0,u.Z)(e,Ot,l),e);return(0,w.n)("div",{class:this.classes(Rt,St,v),tabIndex:c.closeButton?null:-1,role:"dialog","aria-labelledby":d?r:"","aria-describedby":s&&!l?o:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}},{key:"renderContent",value:function(){var e,t=null===(e=this.viewModel)||void 0===e?void 0:e.content;return t?"string"==typeof t?(0,w.n)("div",{class:E.a.contentNode,key:t,innerHTML:t}):this.renderNodeContent(t):null}},{key:"renderActionText",value:function(e){return(0,w.n)("span",{key:"text",class:Mn},e)}},{key:"renderActionIcon",value:function(e){var t,n=this._getActionClass(e),i=this._getActionImage(e),r=(t={},(0,u.Z)(t,Tt,e.active),(0,u.Z)(t,Zt,e.active),(0,u.Z)(t,yn,!!n),(0,u.Z)(t,bn,!e.active&&!!i),t);return n&&(r[n]=!e.active),(0,w.n)("span",{key:"icon","aria-hidden":"true",class:this.classes(yn,r),styles:this._getIconStyles(i)})}},{key:"renderAction",value:function(e){var t,n=e.action,i=e.type,r=this._getActionTitle(n),o=(t={},(0,u.Z)(t,kn,"toggle"!==n.type),(0,u.Z)(t,En,"toggle"===n.type),(0,u.Z)(t,xn,"toggle"===n.type&&n.value),(0,u.Z)(t,vn,n.disabled),t),a=[this.renderActionIcon(n),this.renderActionText(r)],s="menu-item"===i?(0,w.n)("li",{key:n.uid,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes(pn,o),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":n.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},a):(0,w.n)("div",{key:n.uid,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes(pn,o),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":n.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},a);return n.visible?s:null}},{key:"renderFeatureMenuItem",value:function(e,t){var n=this.messages,i=this.messagesCommon,r=this.viewModel,o=r.selectedFeatureIndex,a=e===r.selectedFeatureViewModel,s=(0,u.Z)({},Un,a),l=a?(0,w.n)("span",{key:Qn("feature-menu-selected-feature-".concat(o)),title:n.selectedFeature,"aria-label":n.selectedFeature,class:Ct}):null,c=(0,w.n)("span",{innerHTML:e.title||i.untitled});return(0,w.n)("li",{role:"menuitem",tabIndex:-1,key:Qn("feature-menu-feature-".concat(o)),class:this.classes(s,Nn),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},(0,w.n)("span",{class:Bn},c,l))}},{key:"renderFeatureMenu",value:function(){var e=this,t=this.featureMenuId,n=this.viewModel.featureViewModels;return n.length>1?(0,w.n)("ol",{class:Dn,id:t,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},n.filter((function(e){return!!e.graphic})).map((function(t,n){return e.renderFeatureMenuItem(t,n)}))):null}},{key:"_storeExitRelatedRecordsAction",value:function(e,t){this._exitRelatedRecordsActions.set(e,t),this.scheduleRender()}},{key:"_getFlowItemDescription",value:function(e){return"featureCountDescription"in e?e.featureCountDescription:e.viewModel.description}},{key:"_destroyFlowItemWidgets",value:function(){this._flowItems.removeAll().forEach((function(e){"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()}))}},{key:"_handleBackClick",value:function(){var e=this._flowItems.pop();this._exitRelatedRecordsActions.delete(e),"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy())}},{key:"_getActionTitle",value:function(e){var t=this.messages,n=this.selectedFeature,i=this.messagesCommon,r=e.id,o=null===n||void 0===n?void 0:n.attributes,a="zoom-to-feature"===r?(0,M.s)(e.title,{messages:t}):"remove-selected-feature"===r?(0,M.s)(e.title,{messages:i}):"zoom-to-clustered-features"===r||"browse-clustered-features"===r?(0,M.s)(e.title,{messages:t}):e.title;return a&&o?(0,M.s)(a,o):a}},{key:"_getActionClass",value:function(e){var t=this.selectedFeature,n=null===t||void 0===t?void 0:t.attributes,i=e.className,r=e.image||i?i:Pt;return r&&n?(0,M.s)(r,n):r}},{key:"_getActionImage",value:function(e){var t=this.selectedFeature,n=null===t||void 0===t?void 0:t.attributes,i=e.image;return i&&n?(0,M.s)(i,n):i}},{key:"_createFeatureUpdatedAnimation",value:function(){return(0,w.w)("enter",$t)}},{key:"_getInlineActionCount",value:function(){var e=this.maxInlineActions,t=this.featureNavigationVisible;if("number"!=typeof e)return null;var n=Math.round(e);return Math.max(t?n-1:n,0)}},{key:"_watchActions",value:function(){var e=this,t=this.viewModel.allActions;this.notifyChange("dividedActions");var n="actions";this._handles.remove(n),t&&t.forEach((function(t){e._handles.add((0,_.l)((function(){return[t.uid,t.active,t.className,t.disabled,t.id,t.title,t.image,t.visible]}),(function(){return e.scheduleRender()})),n)}))}},{key:"_divideActions",value:function(){var e=this.viewModel.allActions.filter((function(e){return e.visible})),t=this._getInlineActionCount(),n=null===t,i=0===t;return{inlineActions:n?e.slice(0):i?new k.j:e.slice(0,t),menuActions:n?new k.j:i?e.slice(0):e.slice(t)}}},{key:"_featureMenuOpenChanged",value:function(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}},{key:"_actionsMenuOpenChanged",value:function(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}},{key:"_setTitleFromFeatureWidget",value:function(){var e,t,n=this.selectedFeatureWidget,i=this.messagesCommon;n&&(this.viewModel.title="error"===(null===(e=n.viewModel)||void 0===e?void 0:e.state)?i.errorMessage:(null===(t=n.viewModel)||void 0===t?void 0:t.title)||"")}},{key:"_setContentFromFeatureWidget",value:function(){var e=this.selectedFeatureWidget;e&&(this.viewModel.content=e)}},{key:"_unobserveFeatureMenuObserver",value:function(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}},{key:"_featureMenuIntersectionObserverCreated",value:function(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}},{key:"_handleFeatureMenuKeyup",value:function(e){"Escape"===(0,g.af)(e)&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}},{key:"_handleActionMenuKeyup",value:function(e){"Escape"===(0,g.af)(e)&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}},{key:"_setActiveFeature",value:function(e){var t=this.viewModel,n=e.currentTarget["data-feature-index"];t.activeFeature=t.features[n]||null}},{key:"_removeActiveFeature",value:function(){this.viewModel.activeFeature=null}},{key:"_handleFeatureMenuItemKeyup",value:function(e){var t=(0,g.af)(e),n=this._featureMenuNode,i=e.currentTarget["data-feature-index"];if(n){var r=n.querySelectorAll("li"),o=r.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),r[r.length-1].focus()):(e.stopPropagation(),r[0].focus()):(e.stopPropagation(),r[(i+1+o)%o].focus()):(e.stopPropagation(),r[(i-1+o)%o].focus())}}},{key:"_handleActionMenuItemKeyup",value:function(e){var t=(0,g.af)(e),n=this._actionsMenuNode,i=e.currentTarget.dataset.actionUid,r=this.dividedActions.menuActions.findIndex((function(e){return e.uid===i}));if(n){var o=n.querySelectorAll("li"),a=o.length;"ArrowUp"!==t?"ArrowDown"!==t?"Home"!==t?"End"!==t||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(r+1+a)%a].focus()):(e.stopPropagation(),o[(r-1+a)%a].focus())}}},{key:"_handleMainKeyup",value:function(e){var t=(0,g.af)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.next())}},{key:"_spinnerEnabledChange",value:function(e){if(this._destroySpinner(),e){var t=this.get("viewModel.view");this._createSpinner(t)}}},{key:"_hideSpinner",value:function(){var e=this._spinner;e&&(e.location=null,e.hide())}},{key:"_displaySpinner",value:function(){var e=this._spinner;if(e){var t=this.viewModel,n=t.location;t.waitingForResult?e.show({location:n}):e.hide()}}},{key:"_getIconStyles",value:function(e){return{"background-image":e?"url(".concat(e,")"):""}}},{key:"_shouldFocus",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(t){var n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.shouldFocus,!e.t0){e.next=5;break}return e.next=4,(0,_.j)((function(){var e;return!0===(null===(e=n.viewModel)||void 0===e?void 0:e.active)}));case 4:this.focus();case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_addSelectedFeatureIndexHandle",value:function(){var e=this,t=(0,_.l)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.selectedFeatureIndex}),(function(t,n){return e._selectedFeatureIndexUpdated(t,n)}));this._handles.add(t,vt)}},{key:"_selectedFeatureIndexUpdated",value:function(e,t){this.featureCount&&e!==t&&-1!==e&&(this._destroyFlowItemWidgets(),this.actionsMenuOpen=!1,this.featureMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}},{key:"_destroySelectedFeatureWidget",value:function(){var e=this._feature;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}},{key:"_isScreenLocationWithinView",value:function(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}},{key:"_isOutsideView",value:function(e){var t=e.popupHeight,n=e.popupWidth,i=e.screenLocation,r=e.side,o=e.view;if(isNaN(n)||isNaN(t)||!o||!i)return!1;var a=o.padding;return"right"===r&&i.x+n/2>o.width-a.right||"left"===r&&i.x-n/2<a.left||"top"===r&&i.y-t<a.top||"bottom"===r&&i.y+t>o.height-a.bottom}},{key:"_calculateAutoAlignment",value:function(e){if("auto"!==e)return e;var t=this._pointerOffsetInPx,n=this._containerNode,i=this._mainContainerNode,r=this.viewModel,o=r.screenLocation,a=r.view;if((0,m.t)(o)||!a||!n)return"top-center";if(!this._isScreenLocationWithinView(o,a))return this._get("currentAlignment")||"top-center";function s(e){return parseInt(e.replace(/[^-\d\.]/g,""),10)}var u=i?window.getComputedStyle(i,null):null,l=u?s(u.getPropertyValue("max-height")):0,c=u?s(u.getPropertyValue("height")):0,d=n.getBoundingClientRect(),h=d.height,p=d.width+t,v=Math.max(h,l,c)+t,f=this._isOutsideView({popupHeight:v,popupWidth:p,screenLocation:o,side:"right",view:a}),y=this._isOutsideView({popupHeight:v,popupWidth:p,screenLocation:o,side:"left",view:a}),g=this._isOutsideView({popupHeight:v,popupWidth:p,screenLocation:o,side:"top",view:a}),_=this._isOutsideView({popupHeight:v,popupWidth:p,screenLocation:o,side:"bottom",view:a});return y?g?"bottom-right":"top-right":f?g?"bottom-left":"top-left":g?_?"top-center":"bottom-center":"top-center"}},{key:"_callCurrentAlignment",value:function(e){return"function"==typeof e?e.call(this):e}},{key:"_getCurrentAlignment",value:function(){var e=this.alignment;return this.dockEnabled||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}},{key:"_setCurrentAlignment",value:function(){this._set("currentAlignment",this._getCurrentAlignment())}},{key:"_setCurrentDockPosition",value:function(){this._set("currentDockPosition",this._getCurrentDockPosition())}},{key:"_calculatePositionResult",value:function(e){var t=["left","right"];return(0,w.f)(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}},{key:"_callDockPosition",value:function(e){return"function"==typeof e?e.call(this):e}},{key:"_getDockPosition",value:function(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null===(e=this.dockOptions)||void 0===e?void 0:e.position)))}},{key:"_getCurrentDockPosition",value:function(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}},{key:"_wouldDockTo",value:function(){return this.dockEnabled?null:this._getDockPosition()}},{key:"_calculateAutoDockPosition",value:function(e){var t;if("auto"!==e)return e;var n=null===(t=this.viewModel)||void 0===t?void 0:t.view,i=(0,w.f)(this.container)?"top-left":"top-right";if(!n)return i;var r=n.padding||{left:0,right:0,top:0,bottom:0},o=n.width-r.left-r.right,a=n.breakpoints;return a&&o<=a.xsmall?"bottom-center":i}},{key:"_positionContainer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._containerNode;if(e&&(this._containerNode=e),e){var t=this.viewModel.screenLocation,n=e.getBoundingClientRect(),i=n.width,r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}}},{key:"_calculateFullWidth",value:function(e){var t=this.currentAlignment,n=this._pointerOffsetInPx;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+n:e}},{key:"_calculateAlignmentPosition",value:function(e,t,n,i){var r=this.currentAlignment,o=this._pointerOffsetInPx,a=i/2,s=n.height-t,u=n.width-e,l=this.view.padding;return"bottom-center"===r?{top:t+o-l.top,left:e-a-l.left}:"top-left"===r?{bottom:s+o-l.bottom,right:u+o-l.right}:"bottom-left"===r?{top:t+o-l.top,right:u+o-l.right}:"top-right"===r?{bottom:s+o-l.bottom,left:e+o-l.left}:"bottom-right"===r?{top:t+o-l.top,left:e+o-l.left}:"top-center"===r?{bottom:s+o-l.bottom,left:e-a-l.left}:void 0}},{key:"_calculatePositionStyle",value:function(e,t){var n=this.dockEnabled,i=this.view;if(i){if(n)return{left:"",top:"",right:"",bottom:""};if(!(0,m.t)(e)&&t){var r=this._calculateFullWidth(t),o=this._calculateAlignmentPosition(e.x,e.y,i,r);return o?{top:void 0!==o.top?"".concat(o.top,"px"):"auto",left:void 0!==o.left?"".concat(o.left,"px"):"auto",bottom:void 0!==o.bottom?"".concat(o.bottom,"px"):"auto",right:void 0!==o.right?"".concat(o.right,"px"):"auto"}:void 0}}}},{key:"_viewChange",value:function(e,t){e&&t&&(this.close(),this.clear())}},{key:"_viewReadyChange",value:function(e,t){if(e){var n=this.get("viewModel.view");this._wireUpView(n)}else t&&(this.close(),this.clear())}},{key:"_wireUpView",value:function(e){(this._destroySpinner(),e)&&(this.spinnerEnabled&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions))}},{key:"_dockingThresholdCrossed",value:function(e,t,n){var i=(0,o.Z)(e,2),r=i[0],a=i[1],s=(0,o.Z)(t,2),u=s[0],l=s[1],c=n.width,d=n.height;return r<=c&&u>c||r>c&&u<=c||a<=d&&l>d||a>d&&l<=d}},{key:"_updateDockEnabledForViewSize",value:function(e,t){if(e&&t){var n=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},i=n.left+n.right,r=n.top+n.bottom,o=[],a=[];o[0]=e[0]-i,o[1]=e[1]-r,a[0]=t[0]-i,a[1]=t[1]-r;var s=this.dockOptions,u=s.breakpoint;this._dockingThresholdCrossed(o,a,u)&&this._setDockEnabledForViewSize(s),this._setCurrentDockPosition()}}},{key:"_focusDockButtonNode",value:function(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}},{key:"_closeButtonNodeUpdated",value:function(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}},{key:"_mainContainerNodeUpdated",value:function(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}},{key:"_featureMenuNodeUpdated",value:function(e){if(this._featureMenuNode=e,e&&this._focusFirstFeature){this._focusFirstFeature=!1;var t=e.querySelectorAll("li");t.length&&t[0].focus()}}},{key:"_actionsMenuNodeUpdated",value:function(e){if(this._actionsMenuNode=e,e&&this._focusFirstAction){this._focusFirstAction=!1;var t=e.querySelectorAll("li");t.length&&t[0].focus()}}},{key:"_focusFeatureMenuButtonNode",value:function(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}},{key:"_focusActionsMenuButtonNode",value:function(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}},{key:"_featureMenuViewportScrollTop",value:function(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}},{key:"_toggleScreenLocationEnabled",value:function(){var e=this.dockEnabled,t=this.viewModel;if(t){var n=t.active&&!e;t.screenLocationEnabled=n}}},{key:"_shouldDockAtCurrentViewSize",value:function(e){var t,n,i=e.breakpoint,r=null===(t=this.viewModel)||void 0===t||null===(n=t.view)||void 0===n?void 0:n.ui;if(!r)return!1;var o=r.width,a=r.height;if(isNaN(o)||isNaN(a))return!1;var s=i.hasOwnProperty("width")&&o<=i.width,u=i.hasOwnProperty("height")&&a<=i.height;return s||u}},{key:"_setDockEnabledForViewSize",value:function(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}},{key:"_getPageText",value:function(e,t){return this.featureNavigationVisible?(0,M.s)(this.messages.pageText,{index:t+1,total:e}):null}},{key:"_destroySpinner",value:function(){var e=this._spinner,t=this.view;e&&(t&&t.ui&&t.ui.remove(this._spinner,ft),e.destroy(),this._spinner=null)}},{key:"_createSpinner",value:function(e){e&&(this._spinner=new xe({view:e}),e.ui.add(this._spinner,{key:ft,position:"manual"}))}},{key:"_toggleCollapsed",value:function(){this.collapsed=!this.collapsed}},{key:"_close",value:function(){this.close(),this.view&&this.view.focus()}},{key:"_toggleDockEnabled",value:function(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}},{key:"_toggleFeatureMenu",value:function(){var e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}},{key:"_toggleActionsMenu",value:function(){var e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}},{key:"_triggerAction",value:function(e){var t=e.currentTarget.dataset.actionUid,n=this.viewModel.allActions,i=n.findIndex((function(e){return e.uid===t})),r=n.getItemAt(i);r&&"toggle"===r.type&&(r.value=!r.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(i)}},{key:"_selectFeature",value:function(e){var t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}},{key:"_next",value:function(){this.next()}},{key:"_previous",value:function(){this.previous()}}]),i}((0,E.i)(w.M));(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"actionsMenuId",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"actionsMenuButtonId",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"featureMenuId",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"titleId",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"contentId",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"hasContent",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"featureNavigationVisible",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"collapsible",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"featureMenuVisible",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"contentCollapsed",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"dividedActions",null),(0,g.e)([(0,g.y)({readOnly:!0,dependsOn:["_flowItems.length"]})],Xn.prototype,"_activeFlowItemWidget",null),(0,g.e)([(0,g.y)()],Xn.prototype,"actions",null),(0,g.e)([(0,g.y)()],Xn.prototype,"actionsMenuOpen",null),(0,g.e)([(0,g.y)()],Xn.prototype,"alignment",void 0),(0,g.e)([(0,g.y)()],Xn.prototype,"autoCloseEnabled",null),(0,g.e)([(0,g.y)()],Xn.prototype,"autoOpenEnabled",null),(0,g.e)([(0,g.y)()],Xn.prototype,"defaultPopupTemplateEnabled",null),(0,g.e)([(0,g.y)()],Xn.prototype,"content",null),(0,g.e)([(0,g.y)()],Xn.prototype,"collapsed",void 0),(0,g.e)([(0,g.y)()],Xn.prototype,"collapseEnabled",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"currentAlignment",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"currentDockPosition",null),(0,g.e)([(0,g.y)()],Xn.prototype,"dockOptions",null),(0,g.e)([(0,g.y)()],Xn.prototype,"dockEnabled",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"featureCount",null),(0,g.e)([(0,g.y)()],Xn.prototype,"featureMenuOpen",void 0),(0,g.e)([(0,g.y)()],Xn.prototype,"features",null),(0,g.e)([(0,g.y)()],Xn.prototype,"goToOverride",null),(0,g.e)([(0,g.y)()],Xn.prototype,"headingLevel",void 0),(0,g.e)([(0,g.y)()],Xn.prototype,"highlightEnabled",null),(0,g.e)([(0,g.y)()],Xn.prototype,"location",null),(0,g.e)([(0,g.y)()],Xn.prototype,"label",null),(0,g.e)([(0,g.y)()],Xn.prototype,"maxInlineActions",void 0),(0,g.e)([(0,g.y)(),(0,w.e)("esri/widgets/Popup/t9n/Popup")],Xn.prototype,"messages",void 0),(0,g.e)([(0,g.y)(),(0,w.e)("esri/t9n/common")],Xn.prototype,"messagesCommon",void 0),(0,g.e)([(0,g.y)()],Xn.prototype,"promises",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"selectedFeature",null),(0,g.e)([(0,g.y)()],Xn.prototype,"selectedFeatureIndex",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xn.prototype,"selectedFeatureWidget",null),(0,g.e)([(0,g.y)()],Xn.prototype,"spinnerEnabled",void 0),(0,g.e)([(0,g.y)()],Xn.prototype,"title",null),(0,g.e)([(0,g.y)()],Xn.prototype,"updateLocationEnabled",null),(0,g.e)([(0,g.y)()],Xn.prototype,"view",null),(0,g.e)([(0,g.y)({type:pt}),(0,L.e)(["triggerAction","trigger-action"])],Xn.prototype,"viewModel",void 0),(0,g.e)([(0,g.y)()],Xn.prototype,"visible",null),(0,g.e)([(0,g.y)()],Xn.prototype,"visibleElements",void 0),(0,g.e)([(0,g.c)("visibleElements")],Xn.prototype,"castVisibleElements",null),(0,g.e)([(0,F.t)()],Xn.prototype,"_close",null),(0,g.e)([(0,F.t)()],Xn.prototype,"_toggleDockEnabled",null),(0,g.e)([(0,F.t)()],Xn.prototype,"_toggleFeatureMenu",null),(0,g.e)([(0,F.t)()],Xn.prototype,"_toggleActionsMenu",null),(0,g.e)([(0,F.t)()],Xn.prototype,"_triggerAction",null),(0,g.e)([(0,F.t)()],Xn.prototype,"_selectFeature",null),(0,g.e)([(0,F.t)()],Xn.prototype,"_next",null),(0,g.e)([(0,F.t)()],Xn.prototype,"_previous",null);var Jn=Xn=(0,g.e)([(0,g.n)("esri.widgets.Popup")],Xn),$n=[0,0];function ei(e){e&&((0,w.t)(e),e.parentNode&&e.parentNode.removeChild(e))}var ti=16,ni=750,ii=function(e){var t=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e,i;(0,p.Z)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(i=t.call.apply(t,[this].concat(o)))._freqInfo={freq:ti,time:ni},i._overlayRenderTaskHandle=null,i.height=0,i.overlay=null,i.position=null,i.resizing=!1,i.root=null,i.surface=null,i.suspended=!0,i.ui=null,i.userContent=null,i.width=0,i.widthBreakpoint=null,0!==o.length&&void 0!==(null===(e=o[0])||void 0===e?void 0:e.popup)||(i.popup=new Jn({view:(0,s.Z)(i)})),i.handles.add([(0,_.l)((function(){return i.cursor}),(function(e){var t=(0,s.Z)(i).surface;t&&t.setAttribute("data-cursor",e)})),(0,_.l)((function(){return i.interacting}),(function(e){var t=(0,s.Z)(i).surface;t&&t.setAttribute("data-interacting",e.toString())}))]),i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.handles.add((0,_.l)((function(){return e.ui}),(function(t,n){return e._handleUIChange(t,n)}))),this._wireUI(this.ui),this.handles.add([this.on("focus",(function(){return e.notifyChange("focused")})),this.on("blur",(function(){return e.notifyChange("focused")}))])}},{key:"destroy",value:function(){this.destroyed||(this.ui=(0,m.g)(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}},{key:"container",get:function(){var e;return null!==(e=this._get("container"))&&void 0!==e?e:null},set:function(e){var t=this,n=this._get("container"),i=(0,w.a)(e),r=i instanceof HTMLDivElement?i:null;if(r||"string"!=typeof e||g.a.getLogger(this.declaredClass).error("#container","element with id '".concat(e,"' not found")),n!==r){var a="dom-size";if(this.handles.remove(a),this._stopMeasuring(),n&&(n.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(ei(this.root),this._set("root",null)),this.userContent&&((0,w.r)(this.userContent,n),ei(this.userContent),this._set("userContent",null))),!r)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);r.classList.add("esri-view");var s=document.createElement("div");s.className="esri-view-user-storage",(0,w.r)(r,s),r.appendChild(s),this._set("userContent",s);var u=document.createElement("div");u.className="esri-view-root",r.insertBefore(u,r.firstChild),this._set("root",u);var l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,u.appendChild(l),this._set("surface",l);var c=new fe;u.appendChild(c.surface),this._set("overlay",c),(0,_.l)((function(){return c.needsRender}),(function(e){e&&!t._overlayRenderTaskHandle?t._overlayRenderTaskHandle=(0,g.a7)({render:function(){var e;return null===(e=t.overlay)||void 0===e?void 0:e.render()}}):t._overlayRenderTaskHandle=(0,m.f)(t._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this.handles.add((0,_.l)((function(){return t.size}),(function(e){var t=(0,o.Z)(e,2),n=t[0],i=t[1],r="esri-view-surface--inset-outline";n>=document.body.clientWidth||i>=document.body.clientHeight?l.classList.add(r):l.classList.remove(r)}),_.h),a),this._set("container",r),this._startMeasuring()}}},{key:"focused",get:function(){var e=document.activeElement===this.surface;return document.hasFocus()&&e}},{key:"popup",set:function(e){var t=this._get("popup");t&&t!==e&&t.destroy(),this._set("popup",e)}},{key:"size",get:function(){return[this.width,this.height]}},{key:"blur",value:function(){this.surface&&this.surface.blur()}},{key:"focus",value:function(){this.surface&&this.surface.focus()}},{key:"pageToContainer",value:function(e,t,n){var i=this.position;return e-=i?i[0]:0,t-=i?i[1]:0,n?(n[0]=e,n[1]=t):n=[e,t],n}},{key:"containerToPage",value:function(e,t,n){var i=this.position;return e+=i?i[0]:0,t+=i?i[1]:0,n?(n[0]=e,n[1]=t):n=[e,t],n}},{key:"_handleUIChange",value:function(e,t){t&&(this.handles.remove("ui"),t.destroy()),e&&this._wireUI(e),this._set("ui",e)}},{key:"_wireUI",value:function(e){var t=this;this.handles.remove("ui"),e&&(e.view=this,this.handles.add([(0,_.l)((function(){return t.root}),(function(t){e.container=t?function(e){var t=document.createElement("div");return e.appendChild(t),t}(t):null}),_.h),(0,_.l)((function(){return t.popup}),(function(t,n){var i="popup";n&&e.remove(n,i),t&&(t.view=e.view,e.add(t,{key:i,position:"manual"}))}),_.h)],"ui"))}},{key:"_stopMeasuring",value:function(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}},{key:"_startMeasuring",value:function(){var e=this,t=this._freqInfo;t.freq=ti,t.time=ni,this.handles.add([function(){var e=function(){t.freq=ti,t.time=ni};return window.addEventListener("resize",e),{remove:function(){window.removeEventListener("resize",e)}}}(),(0,g.a7)({prepare:function(t){var n=e._measure(),i=e._freqInfo;if(i.time+=t.deltaTime,n&&(i.freq=ti,e._get("resizing")||e._set("resizing",!0)),!(i.time<i.freq)){i.time=0;var r=e._position();i.freq=r||n?ti:Math.min(ni,2*i.freq),!n&&i.freq>=512&&e._get("resizing")&&e._set("resizing",!1)}}})],"measuring"),this._measure(),this._position()}},{key:"_measure",value:function(){var e=this.container,t=e?e.clientWidth:0,n=e?e.clientHeight:0;if(0===t||0===n)return this.suspended||this._set("suspended",!0),!1;var i=this.width,r=this.height;return t===i&&n===r?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:i,oldHeight:r,width:t,height:n}),!0)}},{key:"_position",value:function(){var e=this.container,t=this.position,n=e&&function(e){var t,n,i=(e.ownerDocument||window.document).defaultView,r=e.getBoundingClientRect();return $n[0]=r.left+(null!==(t=null===i||void 0===i?void 0:i.pageXOffset)&&void 0!==t?t:0),$n[1]=r.top+(null!==(n=null===i||void 0===i?void 0:i.pageYOffset)&&void 0!==n?n:0),$n}(e);return!!n&&(!t||n[0]!==t[0]||n[1]!==t[1])&&(this._set("position",[n[0],n[1]]),!0)}},{key:"forceDOMReadyCycle",value:function(){}}]),n}(e);return(0,g.e)([(0,g.y)()],t.prototype,"container",null),(0,g.e)([(0,g.y)({readOnly:!0})],t.prototype,"focused",null),(0,g.e)([(0,g.y)({readOnly:!0})],t.prototype,"height",void 0),(0,g.e)([(0,g.y)({type:Jn})],t.prototype,"popup",null),(0,g.e)([(0,g.y)({type:fe})],t.prototype,"overlay",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],t.prototype,"position",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],t.prototype,"resizing",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],t.prototype,"root",void 0),(0,g.e)([(0,g.y)({value:null,readOnly:!0})],t.prototype,"size",null),(0,g.e)([(0,g.y)({readOnly:!0})],t.prototype,"surface",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],t.prototype,"suspended",void 0),(0,g.e)([(0,g.y)()],t.prototype,"ui",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],t.prototype,"userContent",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],t.prototype,"width",void 0),(0,g.e)([(0,g.y)()],t.prototype,"widthBreakpoint",void 0),t=(0,g.e)([(0,g.n)("esri.views.DOMContainer")],t)},ri=function(e){var t=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"fetchPopupFeatures",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(t,n){var i,r,o,s,u,c,d,h;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.when();case 2:return e.next=4,this._prepareFetchPopupFeatures(t,n);case 4:return i=e.sent,r=i.location,o=i.queryArea,s=i.layerViewsAndGraphics,u=i.clientOnlyGraphics,c=Promise.resolve(u),d=this._queryLayerPopupFeatures(o,s,n),h=d.map((function(e){return e.promise})),e.abrupt("return",{location:r,clientOnlyGraphics:u,allGraphicsPromise:(0,g.ah)([c].concat((0,a.Z)(h))).then((function(e){return Array.from(new Set(e.flat()))})),promisesPerLayerView:d});case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_queryLayerPopupFeatures",value:function(e,t,n){return t.map((function(t){var i=t.layerView,r={clientGraphics:t.graphics,event:(0,m.r)(n)?n.event:null,signal:(0,m.r)(n)?n.signal:null,defaultPopupTemplateEnabled:!!(0,m.r)(n)&&!!n.defaultPopupTemplateEnabled},o=i.fetchPopupFeatures(e,r);return{layerView:i,promise:o}}))}},{key:"_isValidPopupGraphic",value:function(e,t){return e&&!!e.getEffectivePopupTemplate((0,m.r)(t)&&t.defaultPopupTemplateEnabled)}},{key:"_prepareFetchPopupFeatures",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(t,n){var i,r,o,a,s,u,c,d;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._popupHitTestGraphics(t,n);case 2:return i=e.sent,r=i.clientGraphics,o=i.queryArea,a=i.location,s=this._getFetchPopupLayerViews(),u=this._graphicsPerFetchPopupLayerView(r,s),c=u.layerViewsAndGraphics,d=u.clientOnlyGraphics,e.abrupt("return",{clientOnlyGraphics:d,layerViewsAndGraphics:c,queryArea:o,location:a});case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_popupHitTestGraphics",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(t,n){var i,r,o,a,s,u=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.popupHitTest(t);case 2:return i=e.sent,r=i.results,o=i.mapPoint,a=r.filter((function(e){return"graphic"===e.type&&u._isValidPopupGraphic(e.graphic,n)})),s=a.length?a[0].mapPoint:null,e.abrupt("return",{clientGraphics:a.map((function(e){return e.graphic})),queryArea:o,location:o||s});case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getFetchPopupLayerViews",value:function(){var e=this,t=[];return this.allLayerViews.forEach((function(n){e._isValidPopupLayerView(n)&&t.push(n)})),(0,m.r)(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&t.push(this.graphicsView),t.reverse()}},{key:"_isValidPopupLayerView",value:function(e){return(0,m.r)(e)&&(!("layer"in e)||!e.suspended)&&"fetchPopupFeatures"in e}},{key:"_graphicsPerFetchPopupLayerView",value:function(e,t){var n,i=[],r=new Map,o=t.map((function(e){var t=[];return"layer"in e?r.set(e.layer,t):r.set(e.graphics,t),{layerView:e,graphics:t}})),a=(0,d.Z)(e);try{for(a.s();!(n=a.n()).done;){var s=n.value,u=r.get(s.layer)||r.get(s.sourceLayer)||null;u?u.push(s):i.push(s)}}catch(l){a.e(l)}finally{a.f()}return{layerViewsAndGraphics:o,clientOnlyGraphics:i}}}]),n}(e);return t=(0,g.e)([(0,g.n)("esri.views.PopupView")],t)},oi=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).handles.add(i.on("before-add",(function(e){(0,m.t)(e.item)||e.item.parent===i.owner&&(g.a.getLogger(i.declaredClass).warn("Analysis inside the collection must be unique. Not adding this element again."),e.preventDefault())}))),i}return(0,v.Z)(n,[{key:"_own",value:function(e){e.parent=this.owner}},{key:"_release",value:function(e){e.parent=null}}]),n}(G.l);oi=(0,g.e)([(0,g.n)("esri.support.AnalysesCollection")],oi);var ai=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).view=null,i.baseLayerViews=new k.j,i.referenceLayerViews=new k.j,i._loadingHandle=(0,_.l)((function(){var e,t;return null===(e=i.view)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.basemap}),(function(e){e&&e.load().catch((function(){}))}),_.h),i}return(0,v.Z)(n,[{key:"destroy",value:function(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}},{key:"suspended",get:function(){return!this.view||this.view.suspended}},{key:"updating",get:function(){var e,t;if(this.view&&this.view.suspended)return!1;var n=null===(e=this.view)||void 0===e||null===(t=e.map)||void 0===t?void 0:t.basemap;return!!n&&!!n.loaded&&(this.baseLayerViews.some((function(e){return e.updating}))||this.referenceLayerViews.some((function(e){return e.updating})))}}]),n}(g.m);(0,g.e)([(0,g.y)({constructOnly:!0})],ai.prototype,"view",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],ai.prototype,"baseLayerViews",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],ai.prototype,"referenceLayerViews",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],ai.prototype,"suspended",null),(0,g.e)([(0,g.y)({type:Boolean,readOnly:!0})],ai.prototype,"updating",null),ai=(0,g.e)([(0,g.n)("esri.views.BasemapView")],ai);var si=function(){function e(t,n,i){var r=this;(0,p.Z)(this,e),this.layer=t,this.view=n,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=(0,g.A)(),this._started=!1,this.done=!1,(0,g.v)(this._controller.signal,(function(){var e=new g.s("cancelled:layerview-create","layerview creation cancelled",{layer:t});r._deferred.reject(e)}))}return(0,v.Z)(e,[{key:"promise",get:function(){return this._deferred.promise}},{key:"destroy",value:function(){this._controller.abort();var e=this.layerView;if(e){var t=this.layer,n=this.view;t.emit("layerview-destroy",{view:n,layerView:e}),n.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}}},{key:"start",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(){var t,n,i,r,o,a,s,u,c,d=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._started){e.next=2;break}return e.abrupt("return");case 2:return this._started=!0,t=this._controller.signal,n=this.layer,i=this.view,this._map=i.map,e.prev=5,e.next=8,n.load({signal:t});case 8:if(e.t0="prefetchResources"in n,!e.t0){e.next=12;break}return e.next=12,n.prefetchResources({signal:t});case 12:if(!n.createLayerView){e.next=18;break}return e.next=15,n.createLayerView(i,{signal:t});case 15:a=e.sent,e.next=24;break;case 18:if(this.layerViewImporter.hasLayerViewModule(n)){e.next=20;break}throw new g.s("layer:view-not-supported","No layerview implementation was found");case 20:return e.next=22,this.layerViewImporter.importLayerView(n);case 22:u=e.sent,(0,g.f)(t),a="default"in u?new u.default({layer:n,view:i}):new u({layer:n,view:i});case 24:return c=function(){s=(0,m.f)(s),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,d.done=!0},s=(0,g.v)(t,c),(0,g.f)(t),e.prev=26,e.next=29,a.when();case 29:e.next=34;break;case 31:throw e.prev=31,e.t1=e.catch(26),c(),e.t1;case 34:if(null===(r=this._map)||void 0===r||null===(o=r.allLayers)||void 0===o?void 0:o.includes(n)){e.next=37;break}return e.abrupt("return",(c(),void this._deferred.reject(new g.s("view:no-layerview-for-layer","The layer has been removed from the map",{layer:n}))));case 37:this.layerView=a,n.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:n,layerView:a}),this.done=!0,this._deferred.resolve(a),e.next=43;break;case 40:e.prev=40,e.t2=e.catch(5),n.emit("layerview-create-error",{view:i,error:e.t2}),i.emit("layerview-create-error",{layer:n,error:e.t2}),this.done=!0,this._deferred.reject(new g.s("layerview:create-error","layerview creation failed",{layer:n,error:e.t2}));case 43:case"end":return e.stop()}}),e,this,[[5,40],[26,31]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),ui=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._layerLayerViewInfoMap=new Map,i._watchUpdatingTracking=new b.c,i.supportsGround=!0,i._preloadLayerViewModules=function(){var e,t=null===(e=i.view.map)||void 0===e?void 0:e.allLayers;if(t){var n,r=(0,d.Z)(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;i.layerViewImporter.hasLayerViewModule(o)&&i.layerViewImporter.importLayerView(o)}}catch(a){r.e(a)}finally{r.f()}}},i._reschedule=function(){return(0,m.t)(i._workPromise)&&(i._workPromise=(0,g.A)(),i._workPromise.promise.catch((function(){}))),i.removeHandles("reschedule"),i.addHandles((0,g.k)(i._doWork),"reschedule"),i._workPromise.promise},i._doWork=function(){var e,t,n,r=i.view.map;if(i._map!==r&&(i.clear(),i._map=r),(0,m.t)(i._workPromise))i.notifyChange("updating");else{i.removeHandles("reschedule"),i.removeHandles("collection-change");var s,u=[],l=function e(t){if(!(0,m.t)(t)){var n,r=(0,d.Z)(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;o&&(u.push(o),i._createLayerView(o),"layers"in o&&o.layers&&e(o.layers))}}catch(a){r.e(a)}finally{r.f()}}},c=(0,d.Z)(i._rootCollectionNames);try{for(c.s();!(s=c.n()).done;){var h=s.value;l(i.get(h))}}catch(k){c.e(k)}finally{c.f()}i._refreshCollections();var p,v=(0,d.Z)(i._layerLayerViewInfoMap);try{for(v.s();!(p=v.n()).done;){var f=(0,o.Z)(p.value,2),y=f[0],g=f[1];u.includes(y)||(i._layerLayerViewInfoMap.delete(g.layer),g.destroy())}}catch(k){v.e(k)}finally{v.f()}var _=u.filter((function(e){return"group"===e.type})).map((function(e){return e.layers})),w=[null===r||void 0===r||null===(e=r.ground)||void 0===e?void 0:e.layers,null===r||void 0===r||null===(t=r.basemap)||void 0===t?void 0:t.baseLayers,null===r||void 0===r||null===(n=r.basemap)||void 0===n?void 0:n.referenceLayers,null===r||void 0===r?void 0:r.layers].concat((0,a.Z)(_)).filter((function(e){return!!e}));i.addHandles(w.map((function(e){return i._watchUpdatingTracking.addOnCollectionChange((function(){return e}),i._reschedule)})),"collection-change"),i._workPromise.resolve(),i._workPromise=null}},i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.own([(0,_.a)((function(){var t,n;return null===(t=e.view)||void 0===t||null===(n=t.map)||void 0===n?void 0:n.allLayers}),"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),(0,_.l)((function(){var t=e.view,n=null===t||void 0===t?void 0:t.map;return[null===n||void 0===n?void 0:n.basemap,null===n||void 0===n?void 0:n.ground,null===n||void 0===n?void 0:n.layers,null===t||void 0===t?void 0:t.ready]}),(function(){return e._reschedule()}),_.w)]),this._preloadLayerViewModules(),this._reschedule()}},{key:"destroy",value:function(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null,(0,m.r)(this._workPromise)&&(this._workPromise.reject((0,g.d)()),this._workPromise=null)}},{key:"_layersToLayerViews",get:function(){var e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}},{key:"_rootCollectionNames",get:function(){return Array.from(this._layersToLayerViews.keys())}},{key:"updating",get:function(){return(0,m.r)(this._workPromise)||this._watchUpdatingTracking.updating||(0,g.a9)(this._layerLayerViewInfoMap,(function(e){return!e.done}))}},{key:"updatingRemaining",get:function(){var e,t=0,n=(0,d.Z)(this._layerLayerViewInfoMap.values());try{for(n.s();!(e=n.n()).done;){e.value.done||++t}}catch(i){n.e(i)}finally{n.f()}return t}},{key:"clear",value:function(){if(!this.destroyed){var e,t=(0,d.Z)(this._layerLayerViewInfoMap.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}},{key:"whenLayerView",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._reschedule();case 2:if(this._layerLayerViewInfoMap.has(t)){e.next=4;break}throw new g.s("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:t});case 4:return e.abrupt("return",this._layerLayerViewInfoMap.get(t).promise);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_refreshCollections",value:function(){var e,t=(0,d.Z)(this._layersToLayerViews);try{for(t.s();!(e=t.n()).done;){var n=(0,o.Z)(e.value,2),i=n[0],r=n[1];this._populateLayerViewsOwners(this.get(i),this.get(r),this.view)}}catch(a){t.e(a)}finally{t.f()}this.notifyChange("updating"),this.notifyChange("updatingRemaining")}},{key:"_populateLayerViewsOwners",value:function(e,t,n){if(e&&t){var i,r=0,o=(0,d.Z)(e);try{for(o.s();!(i=o.n()).done;){var a=i.value,s=this._layerLayerViewInfoMap.get(a);if(s&&s.layerView){var u=s.layerView;u.layer=a,u.parent=n,t.getItemAt(r)!==u&&t.splice(r,0,u),a.layers&&this._populateLayerViewsOwners(a.layers,u.layerViews,u),r+=1}}}catch(l){o.e(l)}finally{o.f()}r<t.length&&t.splice(r,t.length)}else t&&t.removeAll()}},{key:"_createLayerView",value:function(e){var t=this;if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch((function(){})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);var n=new si(e,this.view,this.layerViewImporter);n.promise.then((function(){return t._refreshCollections()}),(function(n){var i,r;n&&((0,g.j)(n)||"cancelled:layerview-create"===n.name)||g.a.getLogger(t.declaredClass).error("Failed to create layerview for layer title:'".concat(null!==(i=e.title)&&void 0!==i?i:"no title","', id:'").concat(null!==(r=e.id)&&void 0!==r?r:"no id","' of type '").concat(e.type,"'."),{layer:e,error:n}),t._refreshCollections()})),this._layerLayerViewInfoMap.set(e,n),this.view.ready&&n.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}}]),n}(g.m);(0,g.e)([(0,g.y)()],ui.prototype,"_workPromise",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],ui.prototype,"_watchUpdatingTracking",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],ui.prototype,"_layersToLayerViews",null),(0,g.e)([(0,g.y)({readOnly:!0})],ui.prototype,"_rootCollectionNames",null),(0,g.e)([(0,g.y)()],ui.prototype,"layerViewImporter",void 0),(0,g.e)([(0,g.y)()],ui.prototype,"supportsGround",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],ui.prototype,"updating",null),(0,g.e)([(0,g.y)({readOnly:!0})],ui.prototype,"updatingRemaining",null),(0,g.e)([(0,g.y)({constructOnly:!0})],ui.prototype,"view",void 0);var li=ui=(0,g.e)([(0,g.n)("esri.views.LayerViewManager")],ui),ci=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).factor=1.5,i.offset=(0,j.c)(0,0),i.position=null,i.size=120,i.maskUrl=null,i.maskEnabled=!0,i.overlayUrl=null,i.overlayEnabled=!0,i.visible=!0,i}return(0,v.Z)(n,[{key:"version",get:function(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}}]),n}(g.m);(0,g.e)([(0,g.y)({type:Number})],ci.prototype,"factor",void 0),(0,g.e)([(0,g.y)({nonNullable:!0})],ci.prototype,"offset",void 0),(0,g.e)([(0,g.y)()],ci.prototype,"position",void 0),(0,g.e)([(0,g.y)({type:Number,range:{min:0}})],ci.prototype,"size",void 0),(0,g.e)([(0,g.y)()],ci.prototype,"maskUrl",void 0),(0,g.e)([(0,g.y)()],ci.prototype,"maskEnabled",void 0),(0,g.e)([(0,g.y)()],ci.prototype,"overlayUrl",void 0),(0,g.e)([(0,g.y)()],ci.prototype,"overlayEnabled",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],ci.prototype,"version",null),(0,g.e)([(0,g.y)({type:Boolean})],ci.prototype,"visible",void 0);var di,hi=ci=(0,g.e)([(0,g.n)("esri.views.Magnifier")],ci),pi=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i){var r,o;return(0,p.Z)(this,n),(o=t.call(this,{}))._stage=e,o._textureRequests=new Map,o._frameTask=null!==(r=null===i||void 0===i?void 0:i.registerTask(W.I.TEXTURE_UNLOAD))&&void 0!==r?r:W.y,o}return(0,v.Z)(n,[{key:"normalizeCtorArgs",value:function(){return{}}},{key:"destroy",value:function(){var e=this;(0,i.Z)((0,r.Z)(n.prototype),"destroy",this).call(this),this._frameTask.remove(),this._textureRequests.forEach((function(t){return e._releaseTextureRequest(t)})),this._textureRequests.clear()}},{key:"updating",get:function(){return this._frameTask.updating}},{key:"fromData",value:function(e,t,n){var i=this,r=this.makeUid(e),o=this._textureRequests.get(r);return o||(o={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:n},this._stage&&(this._stage.add(o.texture),this._stage.loadImmediate(o.texture)),this._textureRequests.set(r,o)),o.referenceCount++,{uid:r,texture:o.texture,release:function(){return i._release(r)}}}},{key:"_release",value:function(e){var t=this,n=this._textureRequests.get(e);n?(n.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),n.referenceCount--,n.referenceCount<1&&this._frameTask.schedule((function(){return t._releaseNow(e)}))):console.warn("TextureCollection: texture doesn't exist: '".concat(e,"'"))}},{key:"test",get:function(){return{textureRequests:this._textureRequests}}},{key:"_releaseNow",value:function(e){if(this._textureRequests){var t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}}},{key:"_releaseTextureRequest",value:function(e){var t;e.onRemove&&e.onRemove(),e.texture?null===(t=this._stage)||void 0===t||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}},{key:"makeUid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,m.r)(t)?"".concat(e,".").concat(t,"px"):e}}]),n}(g.m);(0,g.e)([(0,g.y)()],pi.prototype,"_frameTask",void 0),(0,g.e)([(0,g.y)()],pi.prototype,"updating",null),pi=(0,g.e)([(0,g.n)("esri.views.3d.support.TextureCollection")],pi),function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"}(di||(di={}));var vi=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],fi={};function yi(e){return!!fi[e]}vi.forEach((function(e){fi[e]=!0}));var gi,mi,_i,wi=function(){function e(t){(0,p.Z)(this,e),this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=t,this.inputManager=null}return(0,v.Z)(e,[{key:"connect",value:function(e){var t=this;e&&this.disconnect(),this.inputManager=e,this._handlers.forEach((function(e,n){var i=e.handler,r=e.priority;return t.inputManager.installHandlers(n,[i],r)}))}},{key:"disconnect",value:function(){var e=this;this.inputManager&&this._handlers.forEach((function(t,n){return e.inputManager.uninstallHandlers(n)})),this.inputManager=null}},{key:"destroy",value:function(){this.disconnect(),this._handlers.clear(),this.view=null}},{key:"on",value:function(e,t,n,i){var r,o,a=this,s=Array.isArray(e)?e:e.split(",");if(!function(e){var t,n=(0,d.Z)(e);try{for(n.s();!(t=n.n()).done;)if(!yi(t.value))return!1}catch(i){n.e(i)}finally{n.f()}return!0}(s))return s.some(yi)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;Array.isArray(t)?o=t:(r=t,o=[]),"function"==typeof n?r=n:i=n,i=null!=i?i:He.DEFAULT;var u=this._createUniqueGroupName(),l=new ki(this.view,s,o,r);this._handlers.set(u,{handler:l,priority:i});var c,h=(0,d.Z)(s);try{for(h.s();!(c=h.n()).done;){var p=c.value,v=this._handlerCounts.get(p)||0;this._handlerCounts.set(p,v+1)}}catch(f){h.e(f)}finally{h.f()}return this.inputManager&&this.inputManager.installHandlers(u,[l],i),{remove:function(){return a._removeHandler(u,s)}}}},{key:"hasHandler",value:function(e){return!!this._handlerCounts.get(e)}},{key:"_removeHandler",value:function(e,t){if(this._handlers.has(e)){this._handlers.delete(e);var n,i=(0,d.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value,o=this._handlerCounts.get(r);void 0===o?console.error("Trying to remove handler for event that has no handlers registered: ",r):1===o?this._handlerCounts.delete(r):this._handlerCounts.set(r,o-1)}}catch(a){i.e(a)}finally{i.f()}}this.inputManager&&this.inputManager.uninstallHandlers(e)}},{key:"_createUniqueGroupName",value:function(){return this._counter+=1,"viewEvents_".concat(this._counter)}}]),e}(),ki=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i,r,o){var a;(0,p.Z)(this,n),(a=t.call(this,!0)).view=e;var s,u=(0,d.Z)(i);try{for(u.s();!(s=u.n()).done;){switch(s.value){case"click":a.registerIncoming("click",r,(function(e){return o(a._wrapClick(e))}));break;case"double-click":a.registerIncoming("double-click",r,(function(e){return o(a._wrapDoubleClick(e))}));break;case"immediate-click":a.registerIncoming("immediate-click",r,(function(e){return o(a._wrapImmediateClick(e))}));break;case"immediate-double-click":a.registerIncoming("immediate-double-click",r,(function(e){return o(a._wrapImmediateDoubleClick(e))}));break;case"hold":a.registerIncoming("hold",r,(function(e){return o(a._wrapHold(e))}));break;case"drag":a.registerIncoming("drag",r,(function(e){var t=a._wrapDrag(e);t&&o(t)}));break;case"key-down":a.registerIncoming("key-down",r,(function(e){return o(a._wrapKeyDown(e))}));break;case"key-up":a.registerIncoming("key-up",r,(function(e){return o(a._wrapKeyUp(e))}));break;case"pointer-down":a.registerIncoming("pointer-down",r,(function(e){return o(a._wrapPointer(e,"pointer-down"))}));break;case"pointer-move":a.registerIncoming("pointer-move",r,(function(e){return o(a._wrapPointer(e,"pointer-move"))}));break;case"pointer-up":a.registerIncoming("pointer-up",r,(function(e){return o(a._wrapPointer(e,"pointer-up"))}));break;case"pointer-drag":a.registerIncoming("pointer-drag",r,(function(e){return o(a._wrapPointerDrag(e))}));break;case"mouse-wheel":a.registerIncoming("mouse-wheel",r,(function(e){return o(a._wrapMouseWheel(e))}));break;case"pointer-enter":a.registerIncoming("pointer-enter",r,(function(e){return o(a._wrapPointer(e,"pointer-enter"))}));break;case"pointer-leave":a.registerIncoming("pointer-leave",r,(function(e){return o(a._wrapPointer(e,"pointer-leave"))}));break;case"gamepad":a.registerIncoming("gamepad",r,(function(e){o(a._wrapGamepad(e))}));break;case"focus":a.registerIncoming("focus",r,(function(e){o(a._wrapFocus(e))}));break;case"blur":a.registerIncoming("blur",r,(function(e){o(a._wrapBlur(e))}))}}}catch(l){u.e(l)}finally{u.f()}return a}return(0,v.Z)(n,[{key:"_wrapFocus",value:function(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapBlur",value:function(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapClick",value:function(e){var t=e.data,n=t.pointerType,i=t.button,r=t.buttons,o=t.x,a=t.y,s=t.native,u=t.eventId,l=e.cancelable;return{type:"click",pointerType:n,button:i,buttons:r,x:o,y:a,native:s,timestamp:e.timestamp,screenPoint:(0,j.c)(o,a),mapPoint:this._getMapPoint(o,a),eventId:u,cancelable:l,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapDoubleClick",value:function(e){var t=e.data,n=t.pointerType,i=t.button,r=t.buttons,o=t.x,a=t.y,s=t.native,u=t.eventId,l=e.cancelable;return{type:"double-click",pointerType:n,button:i,buttons:r,x:o,y:a,native:s,timestamp:e.timestamp,mapPoint:this._getMapPoint(o,a),eventId:u,cancelable:l,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapImmediateClick",value:function(e){var t=e.data,n=t.pointerType,i=t.button,r=t.buttons,o=t.x,a=t.y,s=t.native,u=t.eventId,l=s.pointerId,c=e.cancelable;return{type:"immediate-click",pointerId:l,pointerType:n,button:i,buttons:r,x:o,y:a,native:s,timestamp:e.timestamp,mapPoint:this._getMapPoint(o,a),eventId:u,cancelable:c,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapImmediateDoubleClick",value:function(e){var t=e.data,n=t.pointerType,i=t.button,r=t.buttons,o=t.x,a=t.y,s=t.native,u=t.eventId,l=s.pointerId,c=e.cancelable;return{type:"immediate-double-click",pointerId:l,pointerType:n,button:i,buttons:r,x:o,y:a,native:s,timestamp:e.timestamp,mapPoint:this._getMapPoint(o,a),eventId:u,cancelable:c,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapHold",value:function(e){var t=e.data,n=t.pointerType,i=t.button,r=t.buttons,o=t.x,a=t.y,s=t.native,u=e.cancelable;return{type:"hold",pointerType:n,button:i,buttons:r,x:o,y:a,native:s,timestamp:e.timestamp,mapPoint:this._getMapPoint(o,a),cancelable:u,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_getMapPoint",value:function(e,t){return this.view.toMap((0,j.c)(e,t),{exclude:[]})}},{key:"_wrapDrag",value:function(e){var t=e.data,n=t.center,i=n.x,r=n.y,o=t.action,a=t.pointerType,s=t.button;if("start"===o&&(this._latestDragStart=t),this._latestDragStart){var u=t.pointer.native,l=t.buttons,c=e.cancelable,d=e.timestamp,h={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return"end"===o&&(this._latestDragStart=void 0),{type:"drag",action:o,x:i,y:r,origin:h,pointerType:a,button:s,buttons:l,radius:t.radius,angle:(0,K.b)(t.angle),native:u,timestamp:d,cancelable:c,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}}},{key:"_wrapKeyDown",value:function(e){var t=e.data,n=t.key,i=t.repeat,r=t.native,o=e.cancelable;return{type:"key-down",key:n,repeat:i,native:r,timestamp:e.timestamp,cancelable:o,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapKeyUp",value:function(e){var t=e.data,n=t.key,i=t.native,r=e.cancelable;return{type:"key-up",key:n,native:i,timestamp:e.timestamp,cancelable:r,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapPointer",value:function(e,t){var n=e.data,i=n.x,r=n.y,o=n.button,a=n.buttons,s=n.native,u=n.eventId,l=s.pointerId,c=s.pointerType,d=e.cancelable;return{type:t,x:i,y:r,pointerId:l,pointerType:c,button:o,buttons:a,native:s,timestamp:e.timestamp,eventId:u,cancelable:d,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapPointerDrag",value:function(e){var t=e.data.currentEvent,n=t.x,i=t.y,r=t.buttons,o=t.native,a=t.eventId,s=e.data.startEvent.button,u=e.data.startEvent.native.pointerId,l=e.data.startEvent.native.pointerType,c=e.data.action,d={x:e.data.startEvent.x,y:e.data.startEvent.y},h=e.cancelable;return{type:"pointer-drag",x:n,y:i,pointerId:u,pointerType:l,button:s,buttons:r,action:c,origin:d,native:o,timestamp:e.timestamp,eventId:a,cancelable:h,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapMouseWheel",value:function(e){var t=e.cancelable,n=e.data,i=e.timestamp;return{type:"mouse-wheel",x:n.x,y:n.y,deltaY:n.deltaY,native:n.native,timestamp:i,cancelable:t,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}},{key:"_wrapGamepad",value:function(e){var t=e.data,n=t.action,i=t.state,r=t.device,o=e.cancelable;return{type:"gamepad",device:r,timestamp:e.timestamp,action:n,buttons:i.buttons,axes:i.axes,cancelable:o,stopPropagation:function(){return e.stopPropagation()},async:function(t){return e.async(t)},preventDefault:function(){return e.preventDefault()}}}}]),n}(Oe);function bi(e){return e.visible&&e.getEditableFlag(gi.USER)&&e.getEditableFlag(gi.MANAGER)}function Mi(e){return(0,j.c)(e.x,e.y)}function Ei(e){return(0,j.i)(e.x,e.y)}function xi(e,t){var n=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return(0,j.c)(t.clientX-n.left,t.clientY-n.top)}function Ci(e,t){return t instanceof Event?xi(e,t):Mi(t)}function Ti(e){if(e instanceof Event)return!0;if("object"==typeof e&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}!function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"}(gi||(gi={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(mi||(mi={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(_i||(_i={}));var Pi=function(){function e(){(0,p.Z)(this,e),this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}return(0,v.Z)(e,[{key:"cursor",get:function(){return this._cursor}},{key:"handleInputEvent",value:function(e,t){var n=function(){return e.stopPropagation()};switch(e.type){case"pointer-move":Ii(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(n(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":if(!Zi(e))break;var i=Mi(e),r=this._intersect(i,e.pointerType,t.forEachTool);if((0,m.t)(r))break;var o=r.manipulator,a=r.tool;!((0,m.r)(o)&&(0,m.r)(a)&&o.interactive)||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,t),(0,m.r)(o)&&(0,m.r)(a)&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:i,pointerType:e.pointerType}),1===this._grabbedManipulators.size&&(0,m.t)(t.activeTool)&&(this._revertToNullActiveTool=!0,t.setActiveTool(r.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:i}),n());break;case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,t);break;case"pointer-drag":if(!Zi(e))break;var s=this._grabbedManipulators.get(e.pointerId),u=(0,m.n)(s,(function(e){return e.manipulator})),l=(0,m.n)(s,(function(e){return e.tool}));if((0,m.t)(u)||(0,m.t)(l))break;var c=Mi(e);c.x=(0,K.a)(c.x,0,t.view.width),c.y=(0,K.a)(c.y,0,t.view.height);var d=(0,m.e)(s).start,h=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(u.dragging=!0,h?u.events.emit("drag",{action:"update",start:d,screenPoint:c}):u.events.emit("drag",{action:"start",start:d,screenPoint:c,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:l,manipulator:u,start:d}));break;case"end":u.dragging=!1,h&&u.events.emit("drag",{action:"end",start:d,screenPoint:c}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}n();break;case"immediate-click":var p=Mi(e),v=this._intersect(p,e.pointerType,t.forEachTool);if(function(e){return!!e.native.shiftKey}(e)||t.forEachTool((function(e){if((!(0,m.r)(v)||v.tool!==e||e.automaticManipulatorSelection)&&e.manipulators){var t=!1;e.manipulators.forEach((function(e){var n=e.manipulator;n.selected&&(n.selected=!1,t=!0)})),t&&e.onManipulatorSelectionChanged&&e.onManipulatorSelectionChanged()}})),(0,m.t)(v))break;var f=v.manipulator,y=v.tool;if(!f.interactive)break;f.selectable&&y.automaticManipulatorSelection&&(f.selected=!f.selected,y.onManipulatorSelectionChanged&&y.onManipulatorSelectionChanged());var g=e.native.shiftKey;f.events.emit("immediate-click",{screenPoint:p,button:e.button,pointerType:e.pointerType,shiftKey:g,stopPropagation:n});break;case"click":var _=Mi(e),w=this._intersect(_,e.pointerType,t.forEachTool),k=(0,m.r)(w)?w.manipulator:null;if((0,m.t)(k)||!k.interactive)break;var b=e.native.shiftKey;k.events.emit(e.type,{screenPoint:_,button:e.button,pointerType:e.pointerType,shiftKey:b}),n();break;case"double-click":var M=Mi(e),E=this._intersect(M,e.pointerType,t.forEachTool),x=(0,m.r)(E)?E.manipulator:null;if((0,m.t)(x)||!x.interactive)break;var C=e.native.shiftKey;x.events.emit("double-click",{screenPoint:M,button:e.button,pointerType:e.pointerType,shiftKey:C,stopPropagation:n});break;case"immediate-double-click":var T=Mi(e),P=this._intersect(T,e.pointerType,t.forEachTool),I=(0,m.r)(P)?P.manipulator:null;if((0,m.t)(I)||!I.interactive)break;var Z=e.native.shiftKey;I.events.emit("immediate-double-click",{screenPoint:T,button:e.button,pointerType:e.pointerType,shiftKey:Z,stopPropagation:n})}this._onFocusChange(t.forEachTool)}},{key:"_ungrabManipulatorBeforeDragging",value:function(e,t,n){var i=this;e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:Mi(t)}),this._grabbedManipulators.forEach((function(t,n){t.manipulator===e&&i._grabbedManipulators.delete(n)})),this._afterManipulatorUngrab(n.setActiveTool)}},{key:"_handlePointerEnd",value:function(e,t){var n=(0,m.n)(this._grabbedManipulators.get(e.pointerId),(function(e){return e.manipulator}));(0,m.t)(n)||n.grabbing&&(n.grabbing=!1,n.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:Mi(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(t.setActiveTool))}},{key:"_cursorFromMap",value:function(e){var t=null;return(0,g.a9)(e,(function(e){var n=e.manipulator;return!((0,m.t)(n)||!n.interactive)&&(n.grabbing&&n.grabCursor?(t=n.grabCursor,!0):!!n.cursor&&(t=n.cursor,!0))})),t}},{key:"_onFocusChange",value:function(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}},{key:"_updateCursor",value:function(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}},{key:"_updateFocusedManipulatorTools",value:function(e){var t=this,n=new Set,i=new Set;this._grabbedManipulators.forEach((function(e){var t=e.tool;n.add(t)})),this._hoveredManipulators.forEach((function(e){var t=e.tool;i.add(t)})),e((function(e){e.hasGrabbedManipulators=n.has(e),e.hasHoveredManipulators=i.has(e);var r=t._grabbedManipulators.values(),o=(0,g.ai)(r,(function(t){return t.tool===e}));e.firstGrabbedManipulator=(0,m.r)(o)?o.manipulator:null}))}},{key:"clearPointers",value:function(e,t){var n=this,i=t.forEachTool,r=t.setActiveTool,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3?arguments[3]:void 0,s=function(t,n){return t===e&&((0,m.t)(a)||a===n)};this._grabbedManipulators.forEach((function(e,t){var i=e.tool,r=e.manipulator,o=e.pointerType;s(i,r)&&(n._grabbedManipulators.delete(t),r.grabbing=!1,r.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:o}))})),this._draggedManipulators.forEach((function(e,t){var i=e.tool,r=e.manipulator;s(i,r)&&(n._draggedManipulators.delete(t),r.dragging=!1,r.events.emit("drag",{action:"cancel"}))})),o&&this._hoveredManipulators.forEach((function(e,t){var i=e.tool,r=e.manipulator;s(i,r)&&(n._hoveredManipulators.delete(t),r.hovering=!1)})),this._afterManipulatorUngrab(r),this._onFocusChange(i)}},{key:"_intersect",value:function(e,t,n){var i=null;return n((function(n){if(null==n.manipulators||!bi(n))return!1;var r=n.manipulators.intersect(e,t);return!(0,m.t)(r)&&(i={tool:n,manipulator:r},!0)})),i}},{key:"updateHoveredStateFromKnownPointers",value:function(e){var t=this;this._pointerLocations.forEach((function(n,i){t._updateHoveredStateForPointerAtScreenPosition((0,j.c)(n.x,n.y),i,n.pointerType,e)}))}},{key:"handleHoverEvent",value:function(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!Ii(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Mi(e),e.pointerId,e.pointerType,t)}},{key:"_updateHoveredStateForPointerAtScreenPosition",value:function(e,t,n,i){var r=this._intersect(e,n,i),o=(0,m.n)(this._hoveredManipulators.get(t),(function(e){return e.manipulator}));(0,m.r)(r)&&!r.manipulator.interactive&&(r=null),(0,m.r)(r)&&o===r.manipulator||((0,m.r)(o)&&(o.hovering=!1),(0,m.r)(r)?(r.manipulator.hovering=!0,this._hoveredManipulators.set(t,r)):this._hoveredManipulators.delete(t),this._onFocusChange(i))}},{key:"_afterManipulatorUngrab",value:function(e){0===this._grabbedManipulators.size&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}}]),e}();function Ii(e){return"mouse"===e}function Zi(e){return"mouse"!==e.pointerType||0===e.button}var Ai="attached",Si="tools",Ri=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._manipulatorState=new Pi,i.tools=new k.j,i.cursor=null,i._forEachTool=function(e){var t,n=(0,d.Z)(i.tools.items);try{for(n.s();!(t=n.n()).done;){if(e(t.value))return}}catch(r){n.e(r)}finally{n.f()}},i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.handles.add([this.view.on(vi,(function(t){e._handleInputEvent(t)}),He.TOOL)].concat((0,a.Z)(function(e){return[e.on("before-add",(function(t){var n=t.item;if(null==n||e.includes(n))return g.a.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();n.onAdd()})),e.on("after-remove",(function(e){var t=e.item;t.active&&(t.view.activeTool=null),t.destroy()}))]}(this.tools)),[this.tools.on("before-add",(function(t){var n=t.item;e._updateToolEditableFlag(n)})),this.tools.on("before-remove",(function(t){var n=t.item;e._manipulatorState.clearPointers(n,e._manipulatorStateEventArgs),e._updateCursor()})),this.tools.on("change",(function(){e._refreshToolWatchers()}))]))}},{key:"destroy",value:function(){this.detach(),this.handles.removeAll()}},{key:"_manipulatorStateEventArgs",get:function(){var e=this;return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:function(t){e.activeTool=t},view:this.view}}},{key:"activeTool",set:function(e){if(!(0,m.r)(e)||this.view.ready){if(e!==this.activeTool){var t=this.activeTool;this._set("activeTool",e),(0,m.r)(t)&&t.deactivate(),(0,m.r)(e)&&e.activate(),this._removeIncompleteTools(e);var n,i=(0,d.Z)(this.tools);try{for(i.s();!(n=i.n()).done;){var r=n.value;this._updateToolEditableFlag(r);var o=bi(r);!(0,m.t)(this.activeTool)&&o||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!o)}}catch(a){i.e(a)}finally{i.f()}this._updateCursor()}}else g.a.getLogger(this.declaredClass).error("Cannot set active tool while view is not ready.")}},{key:"updating",get:function(){var e,t;return this.updatingHandles.updating||this.tools.some((function(e){return e.updating}))||null!==(e=null===(t=this.textures)||void 0===t?void 0:t.updating)&&void 0!==e&&e}},{key:"attach",value:function(){var e=this;"3d"===this.view.type?(this._set("textures",new pi(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([(0,_.l)((function(){var t=e.view.state;return"camera"in t&&t.camera}),(function(){e._forEachManipulator((function(e){null!=e.onViewChange&&e.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(function(t){e._forEachManipulator((function(e){null!=e.onElevationChange&&e.onElevationChange(t)}))})),(0,g.D)((function(){return e._set("textures",(0,m.g)(e.textures))}))],Ai)):this.handles.add((0,_.l)((function(){return e.view.extent}),(function(){e._forEachManipulator((function(e){null!=e.onViewChange&&e.onViewChange()}))})))}},{key:"detach",value:function(){(0,m.r)(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(Ai)}},{key:"_forEachManipulator",value:function(e){this._forEachTool((function(t){t.manipulators&&t.manipulators.forEach((function(n){var i=n.manipulator;return e(i,t)}))}))}},{key:"_handleInputEvent",value:function(e){var t=!1,n=(0,h.Z)((0,h.Z)({},e),{},{stopPropagation:function(){t=!0,e.stopPropagation()}});(0,m.r)(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(n):this._forEachTool((function(e){!t&&e.visible&&e.handleInputEvent(n)})),!t&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(n,this._manipulatorStateEventArgs),!t&&(0,m.r)(this.activeTool)&&this.activeTool.handleInputEventAfter(n),this._manipulatorState.handleHoverEvent(n,this._forEachTool),this._updateCursor()}},{key:"_refreshToolWatchers",value:function(){var e=this;this.handles.remove(Si),this._forEachTool((function(t){if(t instanceof g.m){var n=(0,_.l)((function(){return[t.cursor,t.visible,t.editable]}),(function(){bi(t)||e._manipulatorState.clearPointers(t,e._manipulatorStateEventArgs),e._updateCursor()}));e.handles.add(n,Si)}t.manipulators&&e.handles.add([t.manipulators.on("after-remove",(function(n){e._manipulatorState.clearPointers(t,e._manipulatorStateEventArgs,!0,n.item.manipulator)})),t.manipulators.on("change",(function(){e._manipulatorState.updateHoveredStateFromKnownPointers(e._forEachTool),e._updateCursor()}))],Si)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}},{key:"_updateToolEditableFlag",value:function(e){e.setEditableFlag(gi.MANAGER,(0,m.t)(this.activeTool)||e===this.activeTool)}},{key:"_updateCursor",value:function(){var e=this._manipulatorState.cursor;(0,m.t)(e)&&this._forEachTool((function(t){return!(!(0,m.r)(t.cursor)||!t.visible)&&(e=t.cursor,!0)})),this._get("cursor")!==e&&this._set("cursor",e)}},{key:"_removeIncompleteTools",value:function(e){var t=this;this.tools.filter((function(t){return((0,m.t)(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel})).forEach((function(e){t.tools.remove(e)}))}}]),n}(b.d);(0,g.e)([(0,g.y)({constructOnly:!0,nonNullable:!0})],Ri.prototype,"view",void 0),(0,g.e)([(0,g.y)({readOnly:!0,nonNullable:!0})],Ri.prototype,"textures",void 0),(0,g.e)([(0,g.y)({value:null})],Ri.prototype,"activeTool",null),(0,g.e)([(0,g.y)({readOnly:!0,type:k.j})],Ri.prototype,"tools",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],Ri.prototype,"cursor",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],Ri.prototype,"updating",null);var Fi=Ri=(0,g.e)([(0,g.n)("esri.views.ToolViewManager")],Ri),Li=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this)).nativeIndex=null,i._detectedDeviceType="unknown","standard"===e.mapping?i._detectedDeviceType="standard":Oi.test(e.id)?i._detectedDeviceType="spacemouse":i._detectedDeviceType="unknown",i.nativeIndex=e.index,i}return(0,v.Z)(n,[{key:"native",get:function(){var e=navigator.getGamepads?navigator.getGamepads():[];return null!=this.nativeIndex&&this.nativeIndex<e.length?e[this.nativeIndex]:null}},{key:"deviceType",get:function(){return this._detectedDeviceType}},{key:"axisThreshold",get:function(){return Di[this.deviceType]}}]),n}(g.m);(0,g.e)([(0,g.y)({nonNullable:!0,readOnly:!0})],Li.prototype,"nativeIndex",void 0),(0,g.e)([(0,g.y)({type:String,readOnly:!0})],Li.prototype,"deviceType",null),(0,g.e)([(0,g.y)({type:Number,readOnly:!0})],Li.prototype,"axisThreshold",null),Li=(0,g.e)([(0,g.n)("esri.views.input.gamepad.GamepadInputDevice")],Li);var Oi=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),Di={standard:.15,spacemouse:.025,unknown:0},Ni=Li,Vi=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;(0,p.Z)(this,n);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).devices=new k.j,e.enabledFocusMode="document",e}return(0,v.Z)(n)}(g.m);(0,g.e)([(0,g.y)({type:k.j.ofType(Ni),readOnly:!0})],Vi.prototype,"devices",void 0),(0,g.e)([(0,g.y)({type:["document","view","none"]})],Vi.prototype,"enabledFocusMode",void 0);var zi=Vi=(0,g.e)([(0,g.n)("esri.views.input.gamepad.GamepadSettings")],Vi),Ui=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;return(0,p.Z)(this,n),(e=t.apply(this,arguments)).gamepad=new zi,e}return(0,v.Z)(n)}(g.m);(0,g.e)([(0,g.y)({readOnly:!0})],Ui.prototype,"gamepad",void 0);var Gi=Ui=(0,g.e)([(0,g.n)("esri.views.input.Input")],Ui),Bi=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).enabled=!0,i.device=null,i.mode="pan",i.tiltDirection="forward-down",i.velocityFactor=1,i}return(0,v.Z)(n)}(g.m);(0,g.e)([(0,g.y)({type:Boolean,nonNullable:!0})],Bi.prototype,"enabled",void 0),(0,g.e)([(0,g.y)({type:Ni})],Bi.prototype,"device",void 0),(0,g.e)([(0,g.y)({type:["pan","zoom"],nonNullable:!0})],Bi.prototype,"mode",void 0),(0,g.e)([(0,g.y)({type:["forward-down","forward-up"],nonNullable:!0})],Bi.prototype,"tiltDirection",void 0),(0,g.e)([(0,g.y)({type:Number,nonNullable:!0})],Bi.prototype,"velocityFactor",void 0);var Hi=Bi=(0,g.e)([(0,g.n)("esri.views.navigation.gamepad.GamepadSettings")],Bi),ji=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).browserTouchPanEnabled=!0,i.gamepad=new Hi,i.momentumEnabled=!0,i.mouseWheelZoomEnabled=!0,i}return(0,v.Z)(n)}(g.m);(0,g.e)([(0,g.y)({type:Boolean})],ji.prototype,"browserTouchPanEnabled",void 0),(0,g.e)([(0,g.y)({type:Hi,nonNullable:!0})],ji.prototype,"gamepad",void 0),(0,g.e)([(0,g.y)({type:Boolean})],ji.prototype,"momentumEnabled",void 0),(0,g.e)([(0,g.y)({type:Boolean})],ji.prototype,"mouseWheelZoomEnabled",void 0);var Wi,qi=ji=(0,g.e)([(0,g.n)("esri.views.navigation.Navigation")],ji),Ki=null;function Qi(e){return Yi.apply(this,arguments)}function Yi(){return Yi=(0,c.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ki||(Ki=n.e(5526).then(n.bind(n,5526)).then((function(e){return Wi=e}))),e.next=3,Ki;case 3:(0,g.f)(t);case 4:case"end":return e.stop()}}),e)}))),Yi.apply(this,arguments)}function Xi(e,t,n,i){return Ji.apply(this,arguments)}function Ji(){return Ji=(0,c.Z)((0,l.Z)().mark((function e(t,n,i,r){var o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(o=t.spatialReference,!(0,X.e)()&&!(0,X.A)(o,n)){e.next=7;break}e.t0=(0,X.r)(t,n),e.next=15;break;case 7:if(!Wi){e.next=11;break}e.t1=Wi.projectGeometry(t,n,i,r),e.next=14;break;case 11:return e.next=13,Promise.race([Qi(r),(0,X.t)(r)]);case 13:e.t1=Xi(t,n,i,r);case 14:e.t0=e.t1;case 15:return e.abrupt("return",e.t0);case 16:case"end":return e.stop()}}),e)}))),Ji.apply(this,arguments)}var $i,er=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).required={tileInfo:!1,heightModelInfo:!1,extent:!1},i.defaultSpatialReference=null,i.userSpatialReference=null,i.sourcePreloadCount=10,i.priorityCollection=null,i.requiresExtentInSpatialReference=!0,i.suspended=!1,i._projectExtentTask={task:null,input:null,output:null,spatialReference:null},i}return(0,v.Z)(n,[{key:"destroy",value:function(){this._projectExtentTask.task&&(this._projectExtentTask.task=(0,m.l)(this._projectExtentTask.task)),this._set("map",null)}},{key:"ready",get:function(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}},{key:"heightModelInfoReady",get:function(){return!this._heightModelInfoTask.updating}},{key:"spatialReference",get:function(){return(0,m.r)(this.userSpatialReference)?this.userSpatialReference:(0,m.e)(this._spatialReferenceTask.spatialReference)}},{key:"extent",get:function(){return(0,m.e)(this._extentTask.extent)}},{key:"heightModelInfo",get:function(){return(0,m.e)(this._heightModelInfoTask.heightModelInfo)}},{key:"vcsWkid",get:function(){return(0,m.e)(this._heightModelInfoTask.vcsWkid)}},{key:"latestVcsWkid",get:function(){return(0,m.e)(this._heightModelInfoTask.latestVcsWkid)}},{key:"viewingMode",get:function(){return(0,m.t)(this.userSpatialReference)||this.userSpatialReference.equals((0,m.e)(this._spatialReferenceTask.spatialReference))?(0,m.e)(this._spatialReferenceTask.viewingMode):null}},{key:"tileInfo",get:function(){return(0,m.e)(this._tileInfoTask.tileInfo)}},{key:"mapCollections",get:function(){var e,t,n,i,r=null===(e=this.map)||void 0===e?void 0:e.call(this),o=[];return(0,m.r)(this.priorityCollection)&&o.push(this.priorityCollection),o.push({parent:null===r||void 0===r?void 0:r.basemap,layers:null===r||void 0===r||null===(t=r.basemap)||void 0===t?void 0:t.baseLayers},{layers:null===r||void 0===r?void 0:r.layers},{parent:null===r||void 0===r?void 0:r.ground,layers:null===r||void 0===r||null===(n=r.ground)||void 0===n?void 0:n.layers},{parent:null===r||void 0===r?void 0:r.basemap,layers:null===r||void 0===r||null===(i=r.basemap)||void 0===i?void 0:i.referenceLayers}),o}},{key:"_allLayers",get:function(){return this._collectLayers(this.mapCollections)}},{key:"_spatialReferenceTask",get:function(){var e;if(this.suspended)return null!==(e=this._get("_spatialReferenceTask"))&&void 0!==e?e:{updating:!1};var t,n=this._allLayers,i=n.layers,r=n.updating,o=null,a=(0,d.Z)(i);try{for(a.s();!(t=a.n()).done;){var s=t.value,u=this._getSupportedSpatialReferences(s);if(u.length>0){var l=this._narrowDownSpatialReferenceCandidates(o,u);(0,m.r)(l)&&(o=l)}if((0,m.r)(o)&&1===o.length)break}}catch(h){a.e(h)}finally{a.f()}if(r&&((0,m.t)(o)||1!==o.length))return{updating:!0};var c=this._pickSpatialReferenceCandidate(o);return{spatialReference:(0,m.r)(c)?c.spatialReference:null,viewingMode:(0,m.r)(c)?c.viewingMode:null,updating:!1}}},{key:"_tileInfoTask",get:function(){var e,t,n,i,r,o,a,s;if(!this.required.tileInfo)return null!==(e=this._get("_tileInfoTask"))&&void 0!==e?e:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};var u=this._collectLayers([{parent:null===(t=this.map)||void 0===t||null===(n=t.call(this))||void 0===n?void 0:n.basemap,layers:null===(i=this.map)||void 0===i||null===(r=i.call(this))||void 0===r||null===(o=r.basemap)||void 0===o?void 0:o.baseLayers},{layers:null===(a=this.map)||void 0===a||null===(s=a.call(this))||void 0===s?void 0:s.layers}]),l=u.layers,c=u.updating;if(l&&l.length>0&&"tileInfo"in l[0]){var d=l[0].tileInfo;return{tileInfo:d&&d.spatialReference.equals(this.spatialReference)?d:null,updating:!1}}return{updating:c}}},{key:"_heightModelInfoTask",get:function(){var e,t;if(!this.required.heightModelInfo||this.suspended&&null!==(e=this._get("_heightModelInfoTask"))&&void 0!==e&&e.heightModelInfo)return null!==(t=this._get("_heightModelInfoTask"))&&void 0!==t?t:{updating:!1};var n,i=this._allLayers,r=i.layers,o=i.updating,a=(0,d.Z)(r);try{for(a.s();!(n=a.n()).done;){var s=n.value;if((0,Q.g)(s)){var u,l,c=(0,Q.h)(s);if(c)return{heightModelInfo:c,vcsWkid:null===(u=s.spatialReference)||void 0===u?void 0:u.vcsWkid,latestVcsWkid:null===(l=s.spatialReference)||void 0===l?void 0:l.latestVcsWkid,updating:!1}}}}catch(h){a.e(h)}finally{a.f()}return{updating:o}}},{key:"_extentCandidatesTask",get:function(){var e,t=this;if(this.suspended||!this.required.extent)return null!==(e=this._get("_extentCandidatesTask"))&&void 0!==e?e:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};var n,i=this._allLayers,r=i.updating,o=[],a=(0,d.Z)(i.layers);try{for(a.s();!(n=a.n()).done;){var s,u=n.value,l="fullExtents"in u&&u.fullExtents||((0,m.r)(u.fullExtent)?[u.fullExtent]:[]),c=this.requiresExtentInSpatialReference?null:l[0],h=null!==(s=l.find((function(e){return e.spatialReference.equals(t.spatialReference)})))&&void 0!==s?s:c;if(h)return{candidates:[{extent:h,layer:u}],updating:!1};if(this._getSupportedSpatialReferences(u).length>0){var p,v=(0,d.Z)(l);try{for(v.s();!(p=v.n()).done;){var f=p.value;o.push({extent:f,layer:u})}}catch(y){v.e(y)}finally{v.f()}}}}catch(y){a.e(y)}finally{a.f()}return{candidates:o,updating:r}}},{key:"_extentTask",get:function(){var e=this,t=this._extentCandidatesTask,n=t.candidates,i=t.updating;if(i)return{updating:i};if((0,m.t)(n)||0===n.length)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};var r=this._pickExtentCandidate(n),o=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&o.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:(0,m.r)(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:((0,m.r)(this._projectExtentTask.task)&&(this._projectExtentTask.task=(0,m.l)(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:o.clone(),task:(0,N.j)(function(){var t=(0,c.Z)((0,l.Z)().mark((function t(n){var i;return(0,l.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Xi(r.extent,o,r.layer.portalItem,n);case 3:i=t.sent,e._projectExtentTask=(0,h.Z)((0,h.Z)({},e._projectExtentTask),{},{task:null,output:i}),t.next=12;break;case 7:if(t.prev=7,t.t0=t.catch(0),!(0,g.p)(n)){t.next=11;break}return t.abrupt("return");case 11:e._projectExtentTask=(0,h.Z)((0,h.Z)({},e._projectExtentTask),{},{task:null});case 12:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}())},{updating:!0})}},{key:"_narrowDownSpatialReferenceCandidates",value:function(e,t){if((0,m.t)(e))return t;var n,i=[],r=function(e,t){return(0,m.r)(e)?(0,m.r)(t)?e===t&&e:e:t},o=(0,d.Z)(e);try{for(o.s();!(n=o.n()).done;){var a,s=n.value,u=(0,d.Z)(t);try{for(u.s();!(a=u.n()).done;){var l=a.value;if(s.spatialReference.equals(l.spatialReference)){var c=r(s.viewingMode,l.viewingMode);if(!1!==c){i.push({spatialReference:s.spatialReference,viewingMode:c});break}}}}catch(h){u.e(h)}finally{u.f()}}}catch(h){o.e(h)}finally{o.f()}return i.length>0?i:null}},{key:"_pickSpatialReferenceCandidate",value:function(e){var t=this.defaultSpatialReference;return(0,m.t)(e)||e.length<1?(0,m.r)(t)?{spatialReference:t,viewingMode:null}:null:((0,m.r)(t)&&e.length>1&&e.some((function(e){return e.spatialReference.equals(t)}))&&(e=e.filter((function(e){return e.spatialReference.equals(t)}))),e.length>1&&e.some((function(e){return e.viewingMode!==Y.l.Local}))&&(e=e.filter((function(e){return e.viewingMode!==Y.l.Local}))),e[0])}},{key:"_getSupportedSpatialReferences",value:function(e){var t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return[];var n,i=[],r=(0,d.Z)(t);try{for(r.s();!(n=r.n()).done;){var o=n.value,a=this.getSpatialReferenceSupport({spatialReference:o,layer:e});if((0,m.r)(a)){var s,u=(0,m.r)(a.constraints)?a.constraints:[{spatialReference:o,viewingMode:null}],l=(0,d.Z)(u);try{for(l.s();!(s=l.n()).done;){var c=s.value,h=c.spatialReference,p=c.viewingMode;(!this.requiresExtentInSpatialReference||(0,m.t)(this.userSpatialReference)||h.equals(this.userSpatialReference))&&i.push({spatialReference:h,viewingMode:p})}}catch(v){l.e(v)}finally{l.f()}}}}catch(v){r.e(v)}finally{r.f()}return i}},{key:"_pickExtentCandidate",value:function(e){var t=this.spatialReference;return e.find((function(e){var n=e.extent;return t.equals(n.spatialReference)}))||e[0]}},{key:"_collectLayers",value:function(e){var t;if("loaded"!==this._loadMaybe(null===(t=this.map)||void 0===t?void 0:t.call(this)))return{layers:[],updating:!0};var n,i={layers:[],preloading:-1,updating:!1},r=(0,d.Z)(e);try{for(r.s();!(n=r.n()).done;){var o=n.value;if(this._collectCollection(o,i),i.preloading===this.sourcePreloadCount)break}}catch(a){r.e(a)}finally{r.f()}return{layers:i.layers,updating:i.updating}}},{key:"_collectCollection",value:function(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}var n,i=(0,d.Z)(e.layers);try{for(i.s();!(n=i.n()).done;){var r=n.value;switch(this._loadMaybe(r)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}catch(o){i.e(o)}finally{i.f()}}}},{key:"_loadMaybe",value:function(e){return e&&"loadStatus"in e?"not-loaded"===e.loadStatus?(e.load().catch((function(){})),"loading"):e.loadStatus:"loaded"}}]),n}(g.m);(0,g.e)([(0,g.y)()],er.prototype,"required",void 0),(0,g.e)([(0,g.y)({constructOnly:!0})],er.prototype,"map",void 0),(0,g.e)([(0,g.y)({constructOnly:!0})],er.prototype,"getSpatialReferenceSupport",void 0),(0,g.e)([(0,g.y)()],er.prototype,"defaultSpatialReference",void 0),(0,g.e)([(0,g.y)()],er.prototype,"userSpatialReference",void 0),(0,g.e)([(0,g.y)()],er.prototype,"sourcePreloadCount",void 0),(0,g.e)([(0,g.y)()],er.prototype,"priorityCollection",void 0),(0,g.e)([(0,g.y)()],er.prototype,"requiresExtentInSpatialReference",void 0),(0,g.e)([(0,g.y)()],er.prototype,"suspended",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"ready",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"heightModelInfoReady",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"spatialReference",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"extent",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"heightModelInfo",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"vcsWkid",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"latestVcsWkid",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"viewingMode",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"tileInfo",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"mapCollections",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"_allLayers",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"_spatialReferenceTask",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"_tileInfoTask",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"_heightModelInfoTask",null),(0,g.e)([(0,g.y)({readOnly:!0})],er.prototype,"_extentCandidatesTask",null),(0,g.e)([(0,g.y)()],er.prototype,"_extentTask",null),(0,g.e)([(0,g.y)()],er.prototype,"_projectExtentTask",void 0),er=(0,g.e)([(0,g.n)("esri.views.support.DefaultsFromMap")],er);var tr=$i=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._userSpatialReference=null,i._cursor=null,i.allLayerViews=new V.l({getCollections:function(){var e,t,n;return[null===(e=i.basemapView)||void 0===e?void 0:e.baseLayerViews,null===(t=i.groundView)||void 0===t?void 0:t.layerViews,i.layerViews,null===(n=i.basemapView)||void 0===n?void 0:n.referenceLayerViews]},getChildrenFunction:function(e){return e.layerViews}}),i.groundView=null,i.basemapView=null,i.fatalError=null,i.graphics=new G.i,i.analyses=new oi,i.typeSpecificPreconditionsReady=!0,i.layerViews=new k.j,i.magnifier=new hi,i.padding={left:0,top:0,right:0,bottom:0},i.ready=!1,i.spatialReferenceWarningDelay=1e3,i.supportsGround=!0,i.timeExtent=null,i.type=null,i.scale=null,i.updating=!1,i.initialExtentRequired=!0,i.input=new Gi,i.navigation=new qi,i.layerViewManager=null,i.analysisViewManager=null,i.isHeightModelInfoRequired=!1,i.width=null,i.height=null,i.resizing=!1,i.suspended=!1,i.viewEvents=new wi((0,s.Z)(i)),i.persistableViewModels=new k.j,i._isValid=!1,i._readyCycleForced=!1,i.handles.add((0,_.l)((function(){return i.preconditionsReady}),(function(e){var t,n;e?(i._currentSpatialReference=i.spatialReference,$i.views.add((0,s.Z)(i))):(i._currentSpatialReference=null,$i.views.remove((0,s.Z)(i))),i.notifyChange("spatialReference"),!e&&i.ready?(null!==(t=i.toolViewManager)&&void 0!==t&&t.detach(),(0,m.r)(i.analysisViewManager)&&i.analysisViewManager.detach(),null!==(n=i.layerViewManager)&&void 0!==n&&n.clear(),i._teardown()):e&&!i.ready&&(i._startup(),(0,m.r)(i.analysisViewManager)&&i.analysisViewManager.attach(),i.toolViewManager.attach())}),_.U)),i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.addResolvingPromise(this.validate().then((function(){return e._isValid=!0,(0,_.j)((function(){return e.ready}))}))),this.basemapView=new ai({view:this}),this.layerViewManager=new li({view:this,layerViewImporter:{importLayerView:function(t){return e.importLayerView(t)},hasLayerViewModule:function(t){return e.hasLayerViewModule(t)}},supportsGround:this.supportsGround}),this.toolViewManager=new Fi({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([(0,_.l)((function(){return e.initialExtentRequired}),(function(t){return e.defaultsFromMap.required=(0,h.Z)((0,h.Z)({},e.defaultsFromMap.required),{},{extent:t})}),{sync:!0,initial:!0}),(0,_.l)((function(){return e.ready}),(function(t){e.defaultsFromMap&&(e.defaultsFromMap.suspended=t,e.defaultsFromMap.userSpatialReference=t?e.spatialReference:e._userSpatialReference)}),{sync:!0}),(0,_.l)((function(){return e._userSpatialReference}),(function(t){e.defaultsFromMap&&(e.defaultsFromMap.userSpatialReference=t)}),{sync:!0,initial:!0})])}},{key:"_setupSpatialReferenceLogger",value:function(){var e=this,t=null;this.handles.add([(0,_.l)((function(){var t;return null===(t=e.defaultsFromMap)||void 0===t?void 0:t.ready}),(function(n){var i,r=(null===(i=e.map)||void 0===i?void 0:i.allLayers.length)>0;if(n&&!e.spatialReference&&r){if((0,m.r)(t))return;var o=(0,g.D)((function(){return t=(0,m.l)(t)}));t=(0,N.j)(function(){var n=(0,c.Z)((0,l.Z)().mark((function n(i){return(0,l.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,g.ab)(e.spatialReferenceWarningDelay,null,i);case 3:n.next=8;break;case 5:return n.prev=5,n.t0=n.catch(0),n.abrupt("return");case 8:return n.prev=8,t=null,n.finish(8);case 11:g.a.getLogger(e.declaredClass).warn("#spatialReference","no spatial reference could be derived from the currently added map layers");case 12:case"end":return n.stop()}}),n,null,[[0,5,8,11]])})));return function(e){return n.apply(this,arguments)}}()),e.handles.add(o,"spatial-reference-logger-task")}else e.handles.remove("spatial-reference-logger-task")}),{sync:!0})])}},{key:"destroy",value:function(){if(!this.destroyed){this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=(0,m.g)(this.graphics),this.analyses=(0,m.g)(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),(0,m.g)(this.analysisViewManager),this.toolViewManager=(0,m.g)(this.toolViewManager),this.layerViewManager=(0,m.g)(this.layerViewManager),this.basemapView=(0,m.g)(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();var e=this.map;this.map=null,null===e||void 0===e||e.destroy()}}},{key:"_startup",value:function(){this._set("ready",!0)}},{key:"_teardown",value:function(){this._set("ready",!1)}},{key:"whenReady",value:function(){return Promise.resolve(this)}},{key:"toMap",value:function(){return g.a.getLogger(this.declaredClass).error("#toMap()","Not implemented on this instance of View"),null}},{key:"activeTool",get:function(){var e;return null===(e=this.toolViewManager)||void 0===e?void 0:e.activeTool},set:function(e){this.toolViewManager&&(this.toolViewManager.activeTool=e)}},{key:"animation",get:function(){return this._get("animation")},set:function(e){this._set("animation",e)}},{key:"_defaultsFromMapSettings",get:function(){return{}}},{key:"defaultsFromMap",get:function(){var e=this;return new er((0,h.Z)({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:function(){return e.map},getSpatialReferenceSupport:function(t){return e.getSpatialReferenceSupport(t)}},this._defaultsFromMapSettings))}},{key:"extent",get:function(){return this._get("extent")},set:function(e){this._set("extent",e)}},{key:"heightModelInfo",get:function(){return this.getDefaultHeightModelInfo()}},{key:"interacting",get:function(){return this.navigating}},{key:"navigating",get:function(){return!1}},{key:"preconditionsReady",get:function(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||z.m.isLoadable(this.map)&&!this.map.loaded||0===this.width||0===this.height||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&(null===(e=this.defaultsFromMap)||void 0===e||!e.ready)||!this.typeSpecificPreconditionsReady)}},{key:"map",set:function(e){var t;e!==this._get("map")&&(null!==(t=e)&&void 0!==t&&t.destroyed&&(g.a.getLogger(this.declaredClass).warn("#map","The provided map is already destroyed",{map:e}),e=null),z.m.isLoadable(e)&&e.load().catch((function(){})),this.constructed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}},{key:"spatialReference",get:function(){var e,t,n=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return n&&null!==(e=this.defaultsFromMap)&&void 0!==e&&null!==(t=e.required)&&void 0!==t&&t.heightModelInfo&&((n=n.clone()).vcsWkid=this.defaultsFromMap.vcsWkid,n.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),n},set:function(e){var t=!(0,P.E)(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}},{key:"_spatialReferenceChanged",value:function(e){}},{key:"stationary",get:function(){return!this.animation&&!this.navigating&&!this.resizing}},{key:"tools",get:function(){var e;return null===(e=this.toolViewManager)||void 0===e?void 0:e.tools}},{key:"initialExtent",get:function(){var e;return null===(e=this.defaultsFromMap)||void 0===e?void 0:e.extent}},{key:"cursor",get:function(){var e=this.toolViewManager?this.toolViewManager.cursor:null;return(0,m.r)(e)?e:this._cursor||"default"},set:function(e){this._cursor=e,this.notifyChange("cursor")}},{key:"size",get:function(){return[this.width,this.height]}},{key:"whenLayerView",value:function(e){return this.layerViewManager.whenLayerView(e)}},{key:"getDefaultSpatialReference",value:function(){var e;return null===(e=this.defaultsFromMap)||void 0===e?void 0:e.spatialReference}},{key:"getDefaultHeightModelInfo",value:function(){var e,t,n;return null!==(e=null!==(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)&&void 0!==t?t:null===(n=this.defaultsFromMap)||void 0===n?void 0:n.heightModelInfo)&&void 0!==e?e:null}},{key:"importLayerView",value:function(e){throw new g.s("importLayerView() not implemented")}},{key:"hasLayerViewModule",value:function(e){return!1}},{key:"validate",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"invalidate",value:function(){this._isValid=!1}},{key:"getSpatialReferenceSupport",value:function(){return{constraints:null}}},{key:"_validateSpatialReference",value:function(e){return(0,m.r)(this.getSpatialReferenceSupport({spatialReference:e}))}},{key:"when",value:function(e,t){return this.isResolved()&&!this.ready&&g.a.getLogger(this.declaredClass).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),(0,i.Z)((0,r.Z)(n.prototype),"when",this).call(this,e,t)}},{key:"forceReadyCycle",value:function(){var e=this;this.ready&&((0,_.f)((function(){return!1===e.preconditionsReady}),(function(){return e._readyCycleForced=!1}),{once:!0}),this._readyCycleForced=!0)}},{key:"addAndActivateTool",value:function(e){this.toolViewManager.tools.add(e),this.activeTool=e}},{key:"tryFatalErrorRecovery",value:function(){this.fatalError=null}}]),n}((0,b.a)(x.n.EventedMixin((0,U.m)(g.m))));tr.views=new k.j,(0,g.e)([(0,g.y)()],tr.prototype,"_userSpatialReference",void 0),(0,g.e)([(0,g.y)()],tr.prototype,"activeTool",null),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"allLayerViews",void 0),(0,g.e)([(0,g.y)()],tr.prototype,"groundView",void 0),(0,g.e)([(0,g.y)()],tr.prototype,"animation",null),(0,g.e)([(0,g.y)()],tr.prototype,"basemapView",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"_defaultsFromMapSettings",null),(0,g.e)([(0,g.y)()],tr.prototype,"defaultsFromMap",null),(0,g.e)([(0,g.y)()],tr.prototype,"fatalError",void 0),(0,g.e)([(0,g.y)({type:B.w})],tr.prototype,"extent",null),(0,g.e)([(0,g.y)((0,G.a)(G.i,"graphics"))],tr.prototype,"graphics",void 0),(0,g.e)([(0,g.y)((0,G.a)(oi,"analyses"))],tr.prototype,"analyses",void 0),(0,g.e)([(0,g.y)({readOnly:!0,type:H.v})],tr.prototype,"heightModelInfo",null),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"interacting",null),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"navigating",null),(0,g.e)([(0,g.y)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],tr.prototype,"preconditionsReady",null),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"typeSpecificPreconditionsReady",void 0),(0,g.e)([(0,g.y)({type:k.j,readOnly:!0})],tr.prototype,"layerViews",void 0),(0,g.e)([(0,g.y)({type:hi})],tr.prototype,"magnifier",void 0),(0,g.e)([(0,g.y)({value:null,type:O.L})],tr.prototype,"map",null),(0,g.e)([(0,g.y)()],tr.prototype,"padding",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"ready",void 0),(0,g.e)([(0,g.y)({type:P.k})],tr.prototype,"spatialReference",null),(0,g.e)([(0,g.y)()],tr.prototype,"spatialReferenceWarningDelay",void 0),(0,g.e)([(0,g.y)()],tr.prototype,"stationary",null),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"supportsGround",void 0),(0,g.e)([(0,g.y)({type:D.T})],tr.prototype,"timeExtent",void 0),(0,g.e)([(0,g.y)()],tr.prototype,"tools",null),(0,g.e)([(0,g.y)()],tr.prototype,"toolViewManager",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"type",void 0),(0,g.e)([(0,g.y)({type:Number})],tr.prototype,"scale",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"updating",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"initialExtentRequired",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"initialExtent",null),(0,g.e)([(0,g.y)()],tr.prototype,"cursor",null),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"input",void 0),(0,g.e)([(0,g.y)({type:qi,nonNullable:!0})],tr.prototype,"navigation",void 0),(0,g.e)([(0,g.y)()],tr.prototype,"layerViewManager",void 0),(0,g.e)([(0,g.y)()],tr.prototype,"analysisViewManager",void 0),(0,g.e)([(0,g.y)()],tr.prototype,"width",void 0),(0,g.e)([(0,g.y)()],tr.prototype,"height",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"resizing",void 0),(0,g.e)([(0,g.y)({value:null,readOnly:!0})],tr.prototype,"size",null),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"suspended",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"viewEvents",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],tr.prototype,"persistableViewModels",void 0),(0,g.e)([(0,g.y)()],tr.prototype,"_isValid",void 0),(0,g.e)([(0,g.y)()],tr.prototype,"_readyCycleForced",void 0),(0,g.e)([(0,g.y)()],tr.prototype,"_currentSpatialReference",void 0);var nr=tr=$i=(0,g.e)([(0,g.n)("esri.views.View")],tr),ir=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).state="running",i.target=null,i._dfd=null,i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.addResolvingPromise(new Promise((function(t,n){return e._dfd={resolve:t,reject:n}})))}},{key:"done",get:function(){return"finished"===this.state||"stopped"===this.state}},{key:"stop",value:function(){var e;"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),null===(e=this._dfd)||void 0===e||e.reject(new g.s("ViewAnimation stopped")))}},{key:"finish",value:function(){var e;"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),null===(e=this._dfd)||void 0===e||e.resolve())}},{key:"update",value:function(e,t){t||(t=(0,g.V)(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}}]),n}(U._);(0,g.e)([(0,g.y)({readOnly:!0})],ir.prototype,"done",null),(0,g.e)([(0,g.y)({readOnly:!0,type:String})],ir.prototype,"state",void 0),(0,g.e)([(0,g.y)()],ir.prototype,"target",void 0),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}((ir=(0,g.e)([(0,g.n)("esri.views.ViewAnimation")],ir))||(ir={}));var rr=ir;function or(){return[1,0,0,1,0,0]}Object.freeze(Object.defineProperty({__proto__:null,create:or,clone:function(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]},fromValues:function(e,t,n,i,r,o){return[e,t,n,i,r,o]},createView:function(e,t){return new Float64Array(e,t,6)}},Symbol.toStringTag,{value:"Module"}));var ar=39.37,sr=180/Math.PI;function ur(e){return e.wkid?e:e.spatialReference||P.k.WGS84}function lr(e,t){return t.type?(0,ie.r)(e,t.x,t.y):(0,ie.a)(e,t)}function cr(e){return(0,ae.$)(e)}function dr(e,t){var n=Math.max(1,t[0]),i=Math.max(1,t[1]);return Math.max(e.width/n,e.height/i)*function(e){return(0,P.I)(e)?cr(e)*ar*96:1}(e.spatialReference)}function hr(e,t,n,i){return pr.apply(this,arguments)}function pr(){return pr=(0,c.Z)((0,l.Z)().mark((function e(t,n,i,r){var o,a,s,u,c,h,p,v,f,y,g,_,w,b,M,E,x,C,T,I,Z,A,S,R,F,L,O,D,N;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(!Array.isArray(t)||t.length){e.next=4;break}return e.abrupt("return",null);case 4:if(k.j.isCollection(t)&&(t=t.toArray()),!Array.isArray(t)||!t.length||"object"!=typeof t[0]){e.next=39;break}if(s=t.every((function(e){return"attributes"in e})),u=t.some((function(e){return!e.geometry})),c=t,!(s&&u&&n&&n.allLayerViews)){e.next=20;break}h=new Map,p=(0,d.Z)(t);try{for(p.s();!(v=p.n()).done;)f=v.value,y=f.layer,g=h.get(y)||[],null!=(_=f.attributes[y.objectIdField])&&g.push(_),h.set(y,g)}catch(l){p.e(l)}finally{p.f()}return w=[],h.forEach((function(e,t){var i=n.allLayerViews.find((function(e){return e.layer.id===t.id}));if("queryFeatures"in i){var r=t.createQuery();r.objectIds=e,r.returnGeometry=!0,w.push(i.queryFeatures(r))}})),e.next=15,Promise.all(w);case 15:b=e.sent,M=[],E=(0,d.Z)(b);try{for(E.s();!(x=E.n()).done;)if((C=x.value)&&C.features&&C.features.length){T=(0,d.Z)(C.features);try{for(T.s();!(I=T.n()).done;)Z=I.value,(0,m.r)(Z.geometry)&&M.push(Z.geometry)}catch(l){T.e(l)}finally{T.f()}}}catch(l){E.e(l)}finally{E.f()}c=M;case 20:A=(0,d.Z)(c),e.prev=21,A.s();case 23:if((S=A.n()).done){e.next=30;break}return R=S.value,e.next=27,hr(R,n,i,r);case 27:r=e.sent;case 28:e.next=23;break;case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(21),A.e(e.t0);case 35:return e.prev=35,A.f(),e.finish(35);case 38:return e.abrupt("return",r);case 39:if(!Array.isArray(t)||2!==t.length||"number"!=typeof t[0]||"number"!=typeof t[1]){e.next=43;break}o=new P.w(t),e.next=61;break;case 43:if(!(t instanceof P.p)){e.next=47;break}o=t,e.next=61;break;case 47:if(!("geometry"in t)){e.next=61;break}if(!t.geometry){e.next=52;break}o=t.geometry,e.next=61;break;case 52:if(!t.layer){e.next=61;break}if(F=t.layer,L=n.allLayerViews.find((function(e){return e.layer.id===F.id})),!("queryFeatures"in L)){e.next=61;break}return(O=F.createQuery()).objectIds=[t.attributes[F.objectIdField]],O.returnGeometry=!0,e.next=59,L.queryFeatures(O);case 59:D=e.sent,o=(0,m.q)(D,"features",0,"geometry");case 61:if(!(0,m.t)(o)){e.next=63;break}return e.abrupt("return",null);case 63:if(a="point"===o.type?new B.w({xmin:o.x,ymin:o.y,xmax:o.x,ymax:o.y,spatialReference:o.spatialReference}):o.extent){e.next=65;break}return e.abrupt("return",null);case 65:if(e.t1=(0,X.e)()||(0,X.A)(a.spatialReference,i),e.t1){e.next=69;break}return e.next=69,(0,X.t)();case 69:return N=(0,X.r)(a,i),e.abrupt("return",N?r=r?r.union(N):N:null);case 71:case"end":return e.stop()}}),e,null,[[21,32,35,38]])}))),pr.apply(this,arguments)}function vr(e){if(e&&(!Array.isArray(e)||"number"!=typeof e[0])&&("object"==typeof e||Array.isArray(e)&&"object"==typeof e[0])){if("layer"in e&&e.layer&&e.layer.minScale&&e.layer.maxScale){var t=e.layer;return{min:t.minScale,max:t.maxScale}}if(Array.isArray(e)&&e.length&&e.every((function(e){return"layer"in e}))){var n,i=0,r=0,o=(0,d.Z)(e);try{for(o.s();!(n=o.n()).done;){var a=n.value.layer;a&&a.minScale&&a.maxScale&&(i=a.minScale<i?a.minScale:i,r=a.maxScale>r?a.maxScale:r)}}catch(s){o.e(s)}finally{o.f()}return i&&r?{min:i,max:r}:null}}}function fr(e,t){return(0,P.E)(ur(e),t)?e:(0,X.r)(e,t)}function yr(e,t){return gr.apply(this,arguments)}function gr(){return gr=(0,c.Z)((0,l.Z)().mark((function e(t,n){var i,r,o,a,s,u,c,d,h,p,v,f,y,g;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}return e.abrupt("return",new J.u({targetGeometry:new P.w,scale:0,rotation:0}));case 2:if(i=n.spatialReference,r=n.constraints,o=n.padding,a=n.viewpoint,s=n.size,u=[o?s[0]-o.left-o.right:s[0],o?s[1]-o.top-o.bottom:s[1]],c=null,t instanceof J.u?c=t:t.viewpoint?c=t.viewpoint:t.target&&"esri.Viewpoint"===t.target.declaredClass&&(c=t.target),d=null,!c||!c.targetGeometry){e.next=11;break}d=c.targetGeometry,e.next=35;break;case 11:if(!(t instanceof B.w)){e.next=15;break}d=t,e.next=35;break;case 15:if(e.t0=t||t&&("center"in t||"extent"in t||"target"in t),!e.t0){e.next=35;break}return e.next=19,hr(t.center,n,i);case 19:if(e.t3=e.sent,e.t3){e.next=24;break}return e.next=23,hr(t.extent,n,i);case 23:e.t3=e.sent;case 24:if(e.t2=e.t3,e.t2){e.next=29;break}return e.next=28,hr(t.target,n,i);case 28:e.t2=e.sent;case 29:if(e.t1=e.t2,e.t1){e.next=34;break}return e.next=33,hr(t,n,i);case 33:e.t1=e.sent;case 34:d=e.t1;case 35:if(!d&&a&&a.targetGeometry?d=a.targetGeometry:!d&&n.extent&&(d=n.extent),i||(i=ur(n.spatialReference||n.extent||d)),e.t4=(0,X.e)()||(0,P.E)(d.spatialReference,i)||(0,X.A)(d,i),e.t4){e.next=41;break}return e.next=41,(0,X.t)();case 41:return h=fr(d.center?d.center:d,i),p=null,c&&(0,m.r)(c.targetGeometry)&&"point"===c.targetGeometry.type?p=c.scale:"scale"in t&&t.scale?p=t.scale:"zoom"in t&&-1!==t.zoom&&r&&r.effectiveLODs?p=r.zoomToScale(t.zoom):Array.isArray(d)||"point"===d.type||"extent"===d.type&&0===d.width&&0===d.height?(v=fr(n.extent,i),p=(0,m.r)(v)?dr(v,u):n.extent?dr(n.extent,u):a.scale):p=dr(fr(d.extent,i),u),(f=vr(t))&&(f.min&&f.min>p?p=f.min:f.max&&f.max<p&&(p=f.max)),y=0,c?y=c.rotation:t.hasOwnProperty("rotation")?y=t.rotation:a&&(y=a.rotation),g=new J.u({targetGeometry:h,scale:p,rotation:y}),e.abrupt("return",(r&&(g=r.fit(g),r.constrainByGeometry(g),r.rotationEnabled||(g.rotation=y)),g));case 50:case"end":return e.stop()}}),e)}))),gr.apply(this,arguments)}function mr(e,t){var n=e.targetGeometry,i=t.targetGeometry;return n.x=i.x,n.y=i.y,n.spatialReference=i.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}function _r(e,t,n){return n?(0,ie.r)(e,.5*(t[0]-n.right+n.left),.5*(t[1]-n.bottom+n.top)):(0,ie.l)(e,t,.5)}var wr=function(){var e=(0,oe.n)();return function(t,n,i){var r=n.targetGeometry;lr(e,r);var o=.5*Er(n);return t.xmin=e[0]-o*i[0],t.ymin=e[1]-o*i[1],t.xmax=e[0]+o*i[0],t.ymax=e[1]+o*i[1],t.spatialReference=r.spatialReference,t}}();function kr(e,t,n,i,r){return Sr(e,t,n.center),e.scale=dr(n,i),r&&r.constraints&&r.constraints.constrain(e),e}var br=function(){var e=(0,oe.n)();return function(t,n,i){return(0,ie.C)(t,function(e,t){return(0,ie.l)(e,t,.5)}(t,n),_r(e,n,i))}}(),Mr=function(){var e=[1,0,0,1,0,0],t=(0,oe.n)();return function(n,i,r,o){var a=Er(i),s=xr(i);return(0,ie.r)(t,a,a),(0,ee.M)(e,t),(0,ee.e)(e,e,s),(0,ee.i)(e,e,br(t,r,o)),(0,ee.i)(e,e,[0,o.top-o.bottom]),(0,ie.r)(n,e[4],e[5])}}();function Er(e){return e.scale*function(e){return(0,m.r)(e)&&(0,P.I)(e.spatialReference)?1/(cr(e.spatialReference)*ar*96):1}(e.targetGeometry)}function xr(e){return(0,K.f)(e.rotation)||0}var Cr=function(){var e=(0,oe.n)(),t=(0,oe.n)(),n=(0,oe.n)();return function(i,r,o,a,s,u){return(0,ie.g)(e,r),(0,ie.l)(t,o,.5*u),(0,ie.r)(n,1/a*u,-1/a*u),(0,ee.f)(i,t),s&&(0,ee.e)(i,i,s),(0,ee.c)(i,i,n),(0,ee.i)(i,i,e),i}}(),Tr=function(){var e=(0,oe.n)();return function(t,n,i,r){var o=Er(n),a=xr(n);return lr(e,n.targetGeometry),Cr(t,e,i,o,a,r)}}(),Pr=function(){var e=(0,oe.n)();return function(t,n,i,r){var o=Er(n);return lr(e,n.targetGeometry),Cr(t,e,i,o,0,r)}}();function Ir(e){var t=(0,P.a)(e);return t?t.valid[1]-t.valid[0]:0}var Zr=function(){var e=(0,oe.n)(),t=(0,oe.n)(),n=[0,0,0];return function(i,r,o){(0,ie.o)(e,i,r),(0,ie.v)(e,e),(0,ie.o)(t,i,o),(0,ie.v)(t,t),(0,ie.y)(n,e,t);var a=Math.acos((0,ie.j)(e,t)/((0,ie.q)(e)*(0,ie.q)(t)))*sr;return n[2]<0&&(a=-a),isNaN(a)&&(a=0),a}}(),Ar=function(){var e=(0,oe.n)();return function(t,n,i,r){var o=t.targetGeometry;return mr(t,n),Mr(e,n,i,r),o.x+=e[0],o.y+=e[1],t}}(),Sr=function(e,t,n){mr(e,t);var i=e.targetGeometry;return i.x=n.x,i.y=n.y,i.spatialReference=n.spatialReference,e},Rr=function(){var e=(0,oe.n)();return function(t,n,i,r,o){o||(o="center"),(0,ie.C)(e,i,r),(0,ie.l)(e,e,.5);var a=e[0],s=e[1];switch(o){case"center":(0,ie.r)(e,0,0);break;case"left":(0,ie.r)(e,-a,0);break;case"top":(0,ie.r)(e,0,s);break;case"right":(0,ie.r)(e,a,0);break;case"bottom":(0,ie.r)(e,0,-s);break;case"top-left":(0,ie.r)(e,-a,s);break;case"bottom-left":(0,ie.r)(e,-a,-s);break;case"top-right":(0,ie.r)(e,a,s);break;case"bottom-right":(0,ie.r)(e,a,-s)}return Br(t,n,e),t}}();function Fr(e,t,n){return mr(e,t),e.rotation+=n,e}function Lr(e,t,n){return mr(e,t),e.rotation=n,e}var Or=function(){var e=(0,oe.n)();return function(t,n,i,r,o){return mr(t,n),isNaN(i)||0===i||(Ur(e,r,n,o),t.scale=n.scale*i,Gr(e,e,t,o),Br(t,t,(0,ie.r)(e,e[0]-r[0],r[1]-e[1]))),t}}();function Dr(e,t,n){return mr(e,t),e.scale=n,e}var Nr,Vr=function(){var e=(0,oe.n)();return function(t,n,i,r,o,a){return mr(t,n),isNaN(i)||0===i||(Ur(e,o,n,a),t.scale=n.scale*i,t.rotation+=r,Gr(e,e,t,a),Br(t,t,(0,ie.r)(e,e[0]-o[0],o[1]-e[1]))),t}}(),zr=function(){var e=(0,oe.n)(),t=(0,oe.n)();return function(n,i,r,o,a,s,u){return br(t,s,u),(0,ie.s)(e,a,t),o?Vr(n,i,r,o,e,s):Or(n,i,r,e,s)}}(),Ur=function(){var e=[1,0,0,1,0,0];return function(t,n,i,r){return(0,ie.z)(t,n,function(e,t,n,i){return Tr(e,t,n,i),(0,ee.r)(e,e)}(e,i,r,1))}}(),Gr=function(){var e=[1,0,0,1,0,0];return function(t,n,i,r){return(0,ie.z)(t,n,Tr(e,i,r,1))}}(),Br=function(){var e=(0,oe.n)(),t=[1,0,0,1,0,0];return function(n,i,r){mr(n,i);var o=Er(i),a=n.targetGeometry;return(0,ee.h)(t,xr(i)),(0,ee.c)(t,t,(0,oe.r)(o,o)),(0,ie.z)(e,r,t),a.x+=e[0],a.y+=e[1],n}}();function Hr(e){return function(e){return e instanceof Float32Array&&e.length>=2}(e)||function(e){return Array.isArray(e)&&e.length>=2}(e)}var jr=[0,0],Wr=Nr=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._viewpoint2D={center:(0,oe.n)(),rotation:0,scale:0,spatialReference:null},i.center=[0,0],i.extent=new B.w,i.id=0,i.inverseTransform=[1,0,0,1,0,0],i.resolution=0,i.rotation=0,i.scale=0,i.transform=[1,0,0,1,0,0],i.transformNoRotation=[1,0,0,1,0,0],i.displayMat3=(0,ne.e)(),i.displayViewMat3=(0,ne.e)(),i.viewMat3=(0,ne.e)(),i.viewMat2d=(0,ee.n)(),i.worldScreenWidth=0,i.size=[0,0],i}return(0,v.Z)(n,[{key:"pixelRatio",set:function(e){this._set("pixelRatio",e),this._update()}},{key:"size",set:function(e){this._set("size",e),this._update()}},{key:"viewpoint",set:function(e){if(e){var t=this._viewpoint2D,n=e.targetGeometry;t.center[0]=n.x,t.center[1]=n.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=n.spatialReference}this._update()}},{key:"copy",value:function(e){var t=this.size,n=this.viewpoint;return n&&t?(this.viewpoint=mr(n,e.viewpoint),this._set("size",(0,ie.a)(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}},{key:"clone",value:function(){return new Nr({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}},{key:"toMap",value:function(e,t,n){return Hr(t)?(0,ie.z)(e,t,this.inverseTransform):(jr[0]=t,jr[1]=n,(0,ie.z)(e,jr,this.inverseTransform))}},{key:"toScreen",value:function(e,t,n){return Hr(t)?(0,ie.z)(e,t,this.transform):(jr[0]=t,jr[1]=n,(0,ie.z)(e,jr,this.transform))}},{key:"toScreenNoRotation",value:function(e,t,n){return Hr(t)?(0,ie.z)(e,t,this.transformNoRotation):(jr[0]=t,jr[1]=n,(0,ie.z)(e,jr,this.transformNoRotation))}},{key:"getScreenTransform",value:function(e,t){var n=this._viewpoint2D.center,i=this._get("pixelRatio")||1,r=this._get("size");return Cr(e,n,r,t,0,i),e}},{key:"_update",value:function(){var e=this._viewpoint2D,t=e.center,n=e.spatialReference,i=e.scale,r=e.rotation,o=this._get("pixelRatio")||1,a=this._get("size"),s=new J.u({targetGeometry:new P.w(t[0],t[1],n),scale:i,rotation:r});if(this._set("viewpoint",s),a&&n&&i){this.resolution=Er(s),this.rotation=r,this.scale=i,this.spatialReference=n,(0,ie.a)(this.center,t);var u=0!==a[0]?2/a[0]:0,l=0!==a[1]?-2/a[1]:0;(0,te.s)(this.displayMat3,u,0,0,0,l,0,-1,1,1);var c=(0,te.r)(this.viewMat3),d=(0,re.t)(a[0]/2,a[1]/2),h=(0,re.t)(-a[0]/2,-a[1]/2),p=(0,K.f)(r);(0,te.M)(c,c,d),(0,te.h)(c,c,p),(0,te.M)(c,c,h),(0,te.i)(this.displayViewMat3,this.displayMat3,c);var v=(0,ee.f)(this.viewMat2d,d);return(0,ee.e)(v,v,p),(0,ee.i)(v,v,h),wr(this.extent,s,a),Tr(this.transform,s,a,o),(0,ee.r)(this.inverseTransform,this.transform),Pr(this.transformNoRotation,s,a,o),this.worldScreenWidth=function(e,t){return Math.round(Ir(e)/t)}(this.spatialReference,this.resolution),this._set("id",this.id+1),this}}}]),n}($.l);(0,g.e)([(0,g.y)({readOnly:!0})],Wr.prototype,"id",void 0),(0,g.e)([(0,g.y)({value:1,json:{write:!0}})],Wr.prototype,"pixelRatio",null),(0,g.e)([(0,g.y)({json:{write:!0}})],Wr.prototype,"size",null),(0,g.e)([(0,g.y)()],Wr.prototype,"spatialReference",void 0),(0,g.e)([(0,g.y)({type:J.u,json:{write:!0}})],Wr.prototype,"viewpoint",null);var qr=Wr=Nr=(0,g.e)([(0,g.n)("esri.views.2d.ViewState")],Wr);function Kr(e,t){switch(t){case"primary":return"touch"===e.pointerType||0===e.button;case"secondary":return"touch"!==e.pointerType&&2===e.button;case"tertiary":return"touch"!==e.pointerType&&1===e.button}}function Qr(e,t){if("touch"===e.pointerType)return!1;switch(t){case"primary":return 0===e.button;case"secondary":return 2===e.button;case"tertiary":return 1===e.button}}var Yr=function(){function e(t){(0,p.Z)(this,e),this._callbacks=t,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=function(){return!0})}return(0,v.Z)(e,[{key:"handle",value:function(e){var t=e.data,n=t.pointers.size;switch(t.action){case"start":this._currentCount=n,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=n,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=n,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}},{key:"_emitStart",value:function(e){var t,n;this._startEvent=e,(null===(t=(n=this._callbacks).condition)||void 0===t?void 0:t.call(n,this._currentCount,e))&&this._callbacks.start(this._currentCount,e,this._startEvent)}},{key:"_emitUpdate",value:function(e){var t,n;(null===(t=(n=this._callbacks).condition)||void 0===t?void 0:t.call(n,this._currentCount,e))&&this._callbacks.update(this._currentCount,e,this._startEvent)}},{key:"_emitEnd",value:function(e){var t,n;null!==(t=(n=this._callbacks).condition)&&void 0!==t&&t.call(n,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}}]),e}();function Xr(e){var t=e*e;return e<0&&(t*=-1),t}function Jr(e){return e.translation[0]=0,e.translation[1]=0,e.translation[2]=0,e.heading=0,e.tilt=0,e}function $r(e,t,n){var i=n,r=e.state,o=e.device,a="forward-down"===t.tiltDirection?1:-1;return"standard"===o.deviceType?(i.translation[0]=Xr(r.axes[0]),i.translation[1]=Xr(r.axes[1]),i.translation[2]=Xr(r.buttons[7])-Xr(r.buttons[6]),i.heading=Xr(r.axes[2]),i.tilt=Xr(r.axes[3])):"spacemouse"===o.deviceType&&(i.translation[0]=1.2*Xr(r.axes[0]),i.translation[1]=1.2*Xr(r.axes[1]),i.translation[2]=2*-Xr(r.axes[2]),i.heading=1.2*Xr(r.axes[5]),i.tilt=1.2*Xr(r.axes[3])),i.tilt*=a,(0,K.g)(i.translation,i.translation,1),i}function eo(e,t){var n=t;return n.translation[0]=e[1]-e[0],n.translation[1]=e[3]-e[2],n.translation[2]=e[4]-e[5],n.heading=e[7]-e[6],n.tilt=e[8]-e[9],n.zoom=e[10]-e[11],n}function to(e){return 0===e.translation[0]&&0===e.translation[1]&&0===e.translation[2]&&0===e.heading&&0===e.tilt&&0===e.zoom}function no(e){var t=e.native;return t?{buttons:t.buttons.map((function(e){return e.pressed?e.value?e.value:1:0})),axes:t.axes.map((function(t){return function(e,t){var n=Math.abs(e);return n<t?0:Math.sign(e)*(n-t)/(1-t)}(t,e.axisThreshold)}))}:{buttons:[],axes:[]}}var io=function(){function e(t,n){var i=this;(0,p.Z)(this,e),this._element=t,this._input=n,this._hasEventListeners=!1,this._onConnectGamepad=function(e){i._connectGamepad(e.gamepad)},this._onDisconnectGamepad=function(e){var t=e.gamepad,n=t.index,r=i._inputDevices[n];r&&(i._emitGamepadEvent(t,no(r),!1),i._inputDevices.splice(n,1),i._latestUpdate.splice(n,1),i._input.gamepad.devices.remove(r),i.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;var r="getGamepads"in window.navigator,o=window.isSecureContext;this.supported=r&&o,this.supported&&(this._forEachGamepad((function(e){return i._connectGamepad(e)})),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}return(0,v.Z)(e,[{key:"destroy",value:function(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}},{key:"hasEventListeners",set:function(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}},{key:"_eventsEnabled",get:function(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}},{key:"onEvent",set:function(e){this._callback=e}},{key:"_connectGamepad",value:function(e){var t=new Ni(e);"unknown"!==t.deviceType&&(this._inputDevices[e.index]=t,this._input.gamepad.devices.add(t)),this.ensurePollingState()}},{key:"ensurePollingState",value:function(){this._eventsEnabled?this._startPolling():this._stopPolling()}},{key:"_startPolling",value:function(){var e=this;null==this._frameTask&&(this._frameTask=(0,g.a7)({update:function(){return e._readGamepadState()}}))}},{key:"_stopPolling",value:function(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}},{key:"_readGamepadState",value:function(){var e=this,t=document.hasFocus(),n=this._element.contains(document.activeElement),i="document"===this._input.gamepad.enabledFocusMode&&!t||"view"===this._input.gamepad.enabledFocusMode&&!n;this._forEachGamepad((function(t){var n=e._inputDevices[t.index];if(n){var r=e._latestUpdate[t.index],o=no(n),a=i||function(e){for(var t=0;t<e.axes.length;t++)if(0!==e.axes[t])return!1;for(var n=0;n<e.buttons.length;n++)if(0!==e.buttons[n])return!1;return!0}(o);if(r){if(r.timestamp===t.timestamp)return;if(!r.active&&a)return;if(function(e,t){if(e.axes.length!==t.axes.length)return!1;if(e.buttons.length!==t.buttons.length)return!1;for(var n=0;n<e.axes.length;n++)if(e.axes[n]!==t.axes[n])return!1;for(var i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}(r.state,o))return}e._emitGamepadEvent(t,o,!a)}}))}},{key:"_forEachGamepad",value:function(e){for(var t=window.navigator.getGamepads(),n=0;n<t.length;n++){var i=t[n];this._validate(i)&&e(i)}}},{key:"_emitGamepadEvent",value:function(e,t,n){var i=this._latestUpdate[e.index],r=i&&i.active;if(r||n){var o=!r&&n?"start":r&&n?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:t,active:n},this._callback&&this._callback({device:this._inputDevices[e.index],state:t,action:o})}}},{key:"_validate",value:function(e){if(!e)return!1;if(!e.connected)return!1;for(var t=0;t<e.axes.length;t++)if(isNaN(e.axes[t]))return!1;return!0}}]),e}(),ro=(0,m.h)("trident"),oo=(0,m.h)("edge"),ao=(0,m.h)("chrome"),so=(0,m.h)("ff"),uo=(0,m.h)("safari"),lo="esri-view-surface--touch-none",co="esri-view-surface--touch-pan",ho=function(){function e(t,n){var i=this;(0,p.Z)(this,e),this._input=n,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new io(t,this._input),this._gamepadSource.onEvent=function(e){return i._callback("gamepad",e)}}return(0,v.Z)(e,[{key:"destroy",value:function(){var e=this;this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach((function(t){e._releasePointerCaptureSafe(t)})),this._gamepadSource=(0,m.g)(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}},{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(e){this._callback=e}},{key:"activeEvents",set:function(e){var t=this;for(var n in this._active)if(!e||!e.has(n)){var i=this._active[n];this._element.removeEventListener(po[n],i),delete this._active[n]}e&&e.forEach((function(e){if(!t._active[e]&&po[e]){var n=(t._eventHandlers[e]||t._handleDefault).bind(t,e);t._element.addEventListener(po[e],n),t._active[e]=n}})),this._gamepadSource.hasEventListeners=e&&e.has("gamepad")}},{key:"setPointerCapture",value:function(e,t){t?(this._element.setPointerCapture(e.pointerId),this._activePointerCaptures.add(e.pointerId)):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}},{key:"_updateTouchAction",value:function(){this._element.classList.remove(this._browserTouchPanningEnabled?lo:co),this._element.classList.add(this._browserTouchPanningEnabled?co:lo)}},{key:"_updateTouchEventHandling",value:function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}},{key:"_removeTouchAction",value:function(){this._element.classList.remove(lo),this._element.classList.remove(co),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}},{key:"_releasePointerCaptureSafe",value:function(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch(hs){}}},{key:"_updateNormalizedPointerLikeEvent",value:function(t,n){var i=xi(this._element,t);return e.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),n.x=i.x,n.y=i.y,n}},{key:"_handleKey",value:function(e,t){var n=function(e){if(void 0!==e.key)return(0,g.af)(e);var t=Ie[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}(t);n&&"key-up"===e&&this._keyDownState.delete(n);var i={native:t,key:n,repeat:n&&this._keyDownState.has(n)};n&&"key-down"===e&&this._keyDownState.add(i.key),this._callback(e,i)}},{key:"_handlePointer",value:function(e,t){var n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(e,n)}},{key:"_handlePointerPreventDefault",value:function(e,t){var n=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault(),this._callback(e,n)}},{key:"_handleMouseWheel",value:function(e,t){var n=t.deltaY;switch(t.deltaMode){case 0:(ro||oo)&&(n=n/document.documentElement.clientHeight*600);break;case 1:n*=30;break;case 2:n*=900}ro||oo?n*=.7:ao||uo?n*=.6:so&&(n*=1.375);var i=Math.abs(n);if(i>100){n=n/i*200/(1+Math.exp(-.02*(i-100)))}var r=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:n});this._callback(e,r)}},{key:"_handlePointerCaptureLost",value:function(e,t){this._activePointerCaptures.delete(t.pointerId),this._handleDefault(e,t)}},{key:"_handleDefault",value:function(e,t){var n={native:t};t.preventDefault(),this._callback(e,n)}},{key:"_preventAltKeyDefault",value:function(e){"Alt"===e.key&&e.preventDefault()}},{key:"_preventMultiTouchPanning",value:function(e){e.touches.length>1&&e.preventDefault()}}]),e}();ho.test={disableSubpixelCoordinates:!1};var po={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"},vo=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;return(0,p.Z)(this,n),(e=t.call(this,!0)).registerIncoming("context-menu",(function(e){e.data.native.preventDefault()})),e}return(0,v.Z)(n)}(Oe);function fo(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function yo(e){var t=e.native,n=t.pointerId,i=t.button,r=t.pointerType;return"mouse"===r?"".concat(n,":").concat(i):"".concat(r)}var go,mo={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35},_o=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mo.maximumDoubleClickDelay,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mo.maximumDoubleClickDistance,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:mo.maximumDoubleTouchDelay,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:mo.maximumDoubleTouchDistance,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:g.a8;return(0,p.Z)(this,n),(e=t.call(this,!1))._maximumDoubleClickDelay=i,e._maximumDoubleClickDistance=r,e._maximumDoubleTouchDelay=o,e._maximumDoubleTouchDistance=a,e._clock=u,e._pointerState=new Map,e._click=e.registerOutgoing("click"),e._doubleClick=e.registerOutgoing("double-click"),e.registerIncoming("immediate-click",e._handleImmediateClick.bind((0,s.Z)(e))),e.registerIncoming("pointer-down",e._handlePointerDown.bind((0,s.Z)(e))),e}return(0,v.Z)(n,[{key:"onUninstall",value:function(){this._pointerState.forEach((function(e){return e.doubleClickTimer=(0,m.f)(e.doubleClickTimer)}))}},{key:"hasPendingInputs",get:function(){return(0,g.a9)(this._pointerState,(function(e){return null!=e.doubleClickTimer}))}},{key:"_clearDoubleClickTimer",value:function(e,t){var n=this._pointerState.get(e);n&&(n.doubleClickTimer=(0,m.f)(n.doubleClickTimer),t&&this._click.emit(n.event.data,void 0,n.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}},{key:"_doubleClickTimeoutExceeded",value:function(e){var t=this._pointerState.get(e);1===t.pointerDownCount&&this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}},{key:"_getPointerId",value:function(e){var t=e.native,n=t.pointerId,i=t.pointerType,r=t.button;return"mouse"===i?"".concat(n,":").concat(r):"".concat(i)}},{key:"_handleImmediateClick",value:function(e){var t=e.data,n=t.native.pointerType,i=this._getPointerId(t);if(this._pointerState.has(i)){var r=this._pointerState.get(i),o=r.event,a=o.data,s=o.modifiers,u="touch"===n?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;fo(a,t)>u?(this._clearDoubleClickTimer(i,!0),this._startClick(e)):(this._clearDoubleClickTimer(i,!1),2===r.pointerDownCount&&this._doubleClick.emit(a,void 0,s))}else this._startClick(e)}},{key:"_handlePointerDown",value:function(e){var t=yo(e.data),n=this._pointerState.get(t);n&&(n.pointerDownCount+=1)}},{key:"_startClick",value:function(e){var t=this,n=e.data,i=n.native.pointerType,r=yo(n),o="touch"===i?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,a=this._clock.setTimeout((function(){return t._doubleClickTimeoutExceeded(r)}),o);this._pointerState.set(r,{event:e,doubleClickTimer:a,pointerDownCount:1}),this.refreshHasPendingInputs()}}]),n}(Oe),wo=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,!1))._navigationTouch=e,i._startStateModifiers=new Set,i._activePointerMap=new Map,i._isDragging=!1,i._isCurrentDragSuppressed=!1,i._drag=i.registerOutgoing("drag"),i.registerIncoming("pointer-drag",i._handlePointerDrag.bind((0,s.Z)(i))),i.registerIncoming("pointer-up",i._handlePointerUpAndPointerLost.bind((0,s.Z)(i))),i.registerIncoming("pointer-capture-lost",i._handlePointerUpAndPointerLost.bind((0,s.Z)(i))),i.registerIncoming("pointer-cancel",i._handlePointerUpAndPointerLost.bind((0,s.Z)(i))),i}return(0,v.Z)(n,[{key:"_createPayload",value:function(e,t,n,i){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:t.buttons,timestamp:i,pointers:Mo(this._activePointerMap),pointer:t,angle:n.angle,radius:n.radius,center:n.center}}},{key:"_addPointer",value:function(e){var t=e.native.pointerId,n=bo(this._activePointerMap).angle,i={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(t,i);var r=Eo(i,ko(this._activePointerMap));i.initialAngle=r,i.lastAngle=r,this._updatePointerAngles(n)}},{key:"_updatePointer",value:function(e){if(!e||null!=e.x||null!=e.y){var t=e.native.pointerId,n=this._activePointerMap.get(t);n?n.event=e:this._addPointer(e)}}},{key:"_removePointer",value:function(e){var t=bo(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(t)}},{key:"_updatePointerAngles",value:function(e){var t=bo(this._activePointerMap);this._activePointerMap.forEach((function(n){n.initialAngle=Eo(n,t)-e,n.lastAngle=Eo(n,t)-e}))}},{key:"_emitEvent",value:function(e,t,n){var i=bo(this._activePointerMap);this._drag.emit(this._createPayload(e,t,i,n),void 0,this._startStateModifiers)}},{key:"_handlePointerUpAndPointerLost",value:function(e){var t=e.data.native.pointerId,n=(0,g.aj)(e.timestamp);this._activePointerMap.get(t)&&(1===this._activePointerMap.size?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,n),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(t)):(this._removePointer(t),this._emitEvent("removed",e.data,(0,g.aj)(e.timestamp))))}},{key:"_handlePointerDrag",value:function(e){var t=e.data,n=t.currentEvent,i=(0,g.aj)(e.timestamp);switch(t.action){case"start":case"update":this._isDragging?this._activePointerMap.has(n.native.pointerId)?(this._updatePointer(n),!this._isCurrentDragSuppressed&&this._emitEvent("update",n,i)):(this._addPointer(n),this._emitEvent("added",n,i),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(n),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",n,i))}}},{key:"_isSuppressed",get:function(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&"touch"===this._pointerType&&1===this._activePointerMap.size}}]),n}(Oe);function ko(e){var t=[];return e.forEach((function(e){t.push((0,j.c)(e.event.x,e.event.y))})),function(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:(0,j.c)()},0===e.length)return t;if(1===e.length)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(2===e.length){var n=(0,o.Z)(e,2),i=n[0],r=n[1],a=r.x-i.x,s=r.y-i.y;return t.radius=Math.sqrt(a*a+s*s)/2,t.center.x=(i.x+r.x)/2,t.center.y=(i.y+r.y)/2,t}for(var u=0,l=0,c=0;c<e.length;c++)u+=e[c].x,l+=e[c].y;u/=e.length,l/=e.length;for(var d=e.map((function(e){return e.x-u})),h=e.map((function(e){return e.y-l})),p=0,v=0,f=0,y=0,g=0,m=0,_=0,w=0;w<d.length;w++){var k=d[w],b=h[w],M=k*k,E=b*b;p+=M,v+=E,f+=k*b,y+=M*k,g+=E*b,m+=k*E,_+=b*M}var x=.5*(y+m),C=.5*(g+_),T=p*v-f*f,P=(x*v-C*f)/T,I=(p*C-f*x)/T,Z=(0,j.c)(P+u,I+l);return{radius:Math.sqrt(P*P+I*I+(p+v)/e.length),center:Z}}(t)}function bo(e){var t=ko(e),n=0;return e.forEach((function(e){for(var i=Eo(e,t),r=i-e.lastAngle;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;i=e.lastAngle+r,e.lastAngle=i;var o=i-e.initialAngle;n+=o})),{angle:n/=e.size||1,radius:t.radius,center:t.center}}function Mo(e){var t=new Map;return e.forEach((function(e,n){return t.set(n,e.event)})),t}function Eo(e,t){var n=e.event,i=n.x-t.center.x,r=n.y-t.center.y;return Math.atan2(r,i)}!function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"}(go||(go={}));var xo=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mo.maximumDoubleClickDelay,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mo.maximumDoubleClickDistance,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:mo.maximumDoubleTouchDelay,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:mo.maximumDoubleTouchDistance,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:g.a8;return(0,p.Z)(this,n),(e=t.call(this,!1))._maximumDoubleClickDelay=i,e._maximumDoubleClickDistance=r,e._maximumDoubleTouchDelay=o,e._maximumDoubleTouchDistance=a,e._clock=u,e._pointerState=new Map,e._immediateDoubleClick=e.registerOutgoing("immediate-double-click"),e.registerIncoming("pointer-down",e._handlePointerDown.bind((0,s.Z)(e))),e.registerIncoming("pointer-up",e._handlePointerUp.bind((0,s.Z)(e))),e}return(0,v.Z)(n,[{key:"onUninstall",value:function(){this._pointerState.forEach((function(e){e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()})),(0,i.Z)((0,r.Z)(n.prototype),"onUninstall",this).call(this)}},{key:"_handlePointerDown",value:function(e){var t=e.data,n=yo(t);if(!this._pointerState.has(n)){var i={downButton:t.native.button,immediateDoubleClick:null};this._pointerState.set(n,i),this.startCapturingPointer(t.native)}}},{key:"_handlePointerUp",value:function(e){var t=e.data,n=yo(t),i=this._pointerState.get(n);if(i&&i.downButton===t.native.button){var r=i.immediateDoubleClick;if(r){r.timeoutHandle.remove();var o="touch"===e.data.native.pointerType?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;fo(r,e.data)>o?this._startImmediateDoubleClick(e,i):(this._immediateDoubleClick.emit(e.data,void 0,r.modifiers),this._removeState(t))}else this._startImmediateDoubleClick(e,i)}}},{key:"_startImmediateDoubleClick",value:function(e,t){var n=this,i="touch"===e.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;t.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout((function(){return n._removeState(e.data)}),i)}}},{key:"_removeState",value:function(e){var t=yo(e);this._pointerState.delete(t),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}}]),n}(Oe),Co=300,To=1.5,Po=6,Io=6,Zo=500,Ao=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Co,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:To,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Po,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Io,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Zo,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:g.a8;return(0,p.Z)(this,n),(e=t.call(this,!1))._maximumClickDelay=i,e._movementUntilMouseDrag=r,e._movementUntilPenDrag=o,e._movementUntilTouchDrag=a,e._holdDelay=u,e._clock=l,e._pointerState=new Map,e._pointerDrag=e.registerOutgoing("pointer-drag"),e._immediateClick=e.registerOutgoing("immediate-click"),e._pointerHold=e.registerOutgoing("hold"),e.registerIncoming("pointer-down",e._handlePointerDown.bind((0,s.Z)(e))),e.registerIncoming("pointer-up",(function(t){e._handlePointerLoss(t,"pointer-up")})),e.registerIncoming("pointer-capture-lost",(function(t){e._handlePointerLoss(t,"pointer-capture-lost")})),e.registerIncoming("pointer-cancel",(function(t){e._handlePointerLoss(t,"pointer-cancel")})),e._moveHandle=e.registerIncoming("pointer-move",e._handlePointerMove.bind((0,s.Z)(e))),e._moveHandle.pause(),e}return(0,v.Z)(n,[{key:"onUninstall",value:function(){this._pointerState.forEach((function(e){e.holdTimeout=(0,m.f)(e.holdTimeout)})),(0,i.Z)((0,r.Z)(n.prototype),"onUninstall",this).call(this)}},{key:"_handlePointerDown",value:function(e){var t=this,n=e.data,i=n.native.pointerId,r=null;0===this._pointerState.size&&(r=this._clock.setTimeout((function(){var n=t._pointerState.get(i);if(n){if(!n.isDragging){var r=n.previousEvent;t._pointerHold.emit(r,void 0,e.modifiers),n.holdEmitted=!0}n.holdTimeout=null}}),this._holdDelay));var o={startEvent:n,previousEvent:n,startTimestamp:e.timestamp,isDragging:!1,downButton:n.native.button,holdTimeout:r,modifiers:new Set};this._pointerState.set(i,o),this.startCapturingPointer(n.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}},{key:"_createPointerDragData",value:function(e,t,n){return{action:e,startEvent:t.startEvent,previousEvent:t.previousEvent,currentEvent:n}}},{key:"_handlePointerMove",value:function(e){var t=e.data,n=t.native.pointerId,i=this._pointerState.get(n);i&&(i.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",i,t),void 0,i.modifiers):function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)}(t,i.startEvent)>this._getDragThreshold(t.native.pointerType)&&this._startDragging(e),i.previousEvent=t)}},{key:"_getDragThreshold",value:function(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}},{key:"_startDragging",value:function(e){var t=this,n=e.data,i=n.native.pointerId;this._pointerState.forEach((function(r){null!=r.holdTimeout&&(r.holdTimeout.remove(),r.holdTimeout=null),r.isDragging||(r.modifiers=e.modifiers,r.isDragging=!0,i===r.startEvent.native.pointerId?t._pointerDrag.emit(t._createPointerDragData("start",r,n)):t._pointerDrag.emit(t._createPointerDragData("start",r,r.previousEvent),e.timestamp))}))}},{key:"_handlePointerLoss",value:function(e,t){var n=e.data,i=n.native.pointerId,r=this._pointerState.get(i);r&&(null!=r.holdTimeout&&(r.holdTimeout.remove(),r.holdTimeout=null),r.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",r,"pointer-up"===t?n:r.previousEvent),void 0,r.modifiers):"pointer-up"===t&&r.downButton===n.native.button&&e.timestamp-r.startTimestamp<=this._maximumClickDelay&&!r.holdEmitted&&this._immediateClick.emit(n),this._pointerState.delete(i),this.stopCapturingPointer(n.native),0===this._pointerState.size&&this._moveHandle.pause())}}]),n}(Oe);function So(e,t){var n=e||{},i=n.format,r=n.quality,o=n.rotation,a=n.disableDecorations,s=Bo(e,t.padding),u=function(e,t){var n={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){null!=e.area.x&&(n.x=Math.floor(e.area.x)),null!=e.area.y&&(n.y=Math.floor(e.area.y));var i=null!=e.area.width?Math.floor(e.area.width):null,r=null!=e.area.height?Math.floor(e.area.height):null;if(n.width=t.width-n.x,n.height=t.height-n.y,null!=i&&null!=r)n.width=Math.min(n.width,i),n.height=Math.min(n.height,r);else if(null==i&&null!=r){var o=Math.min(n.width,i);n.height=o/n.width*n.height,n.width=o}else if(null!=i&&null==r){var a=Math.min(n.height,r);n.width=a/n.height*n.width,n.height=a}}return function(e,t){var n=Math.floor(Math.max(e.x,0)),i=Math.floor(Math.max(e.y,0)),r={x:n,y:i,width:Math.floor(Math.min(e.width,t.width-n)),height:Math.floor(Math.min(e.height,t.height-i))},o=r.width/r.height,a=e.width/e.height;if(a===o)return r;if(a>o){var s=Math.floor(r.width/a),u=r.height-s;return{x:r.x,y:Math.floor(r.y+u/2),width:r.width,height:s}}var l=Math.floor(r.height*a),c=r.width-l;return{x:Math.floor(r.x+c/2),y:r.y,width:l,height:r.height}}(function(e,t){if(!t||null==t.width||null==t.height)return e;var n=t.width/t.height,i=e.width/e.height;if(i===n)return e;if(i<n){var r=Math.floor(e.height*n);return e.x-=(r-e.width)/2,e.width=r,e}var o=Math.floor(e.width/n);return e.y-=(o-e.height)/2,e.height=o,e}(n,e),t)}(e,{width:t.width-s.left-s.right,height:t.height-s.top-s.bottom}),l=function(e,t){if(!e)return t;var n=e.width,i=e.height;if(null!=n&&null!=i)return{width:Math.floor(n),height:Math.floor(i)};if(null==n&&null==i)return t;var r=t.width/t.height;return null==i?{width:Math.floor(n),height:Math.floor(n/r)}:{width:Math.floor(i*r),height:Math.floor(i)}}(e,u),c=l.width,d=l.height,h=Ho(i),p=qo[h];return{format:h,quality:(0,K.a)(null!=r?r:p,0,100),area:u,width:c,height:d,rotation:o,disableDecorations:!!a,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function Ro(e,t){var n=So(e,t),i=n.area,r=n.width/i.width,o=Bo(n,t.padding),a=o.left+o.right,s=o.top+o.bottom,u=t.width-a,l=t.height-s,c=Math.floor(u*r+a),d=Math.floor(l*r+s),h=e&&e.layers?e.layers:[],p=n.ignoreBackground,v=n.ignorePadding;return{framebufferWidth:c,framebufferHeight:d,region:{x:Math.floor(i.x*r)+o.left,y:Math.floor(i.y*r)+o.top,width:n.width,height:n.height},format:n.format,quality:n.quality,rotation:n.rotation,pixelRatio:r,layers:h,disableDecorations:n.disableDecorations,ignoreBackground:p,ignorePadding:v,objectAndLayerIdColor:!1}}function Fo(e,t,n){var i=Oo(e,n),r=i.ctx,o=i.canvas,a=r.getImageData(0,0,e.width,e.height),s=function(e,t){var n=jo[t.format],i=t.quality/100;return e.toDataURL(n,i)}(o,t);return Do(o),{dataUrl:s,data:a}}function Lo(e,t){var n=Oo(e,t),i=n.ctx,r=n.canvas,o=i.getImageData(0,0,e.width,e.height);return Do(r),o}function Oo(e,t){var n=((0,m.t)(No)&&(No=document.createElement("canvas")),No);t.premultipliedAlpha&&function(e){for(var t=e.data,n=t.length,i=0;i<n;i+=4){var r=t[i+3];if(255!==r&&r>0){var o=255/r;t[i+0]=t[i+0]*o,t[i+1]=t[i+1]*o,t[i+2]=t[i+2]*o}}}(e),n.width=e.width,n.height=e.height;var i=n.getContext("2d");return i.putImageData(e,0,0),t.flipY&&function(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}(i),{ctx:i,canvas:n}}function Do(e){e.width=0,e.height=0}var No=null;function Vo(e,t){var n=Ho(e),i=qo[n];return{format:n,quality:(0,K.a)(null!=t?t:i,0,100)}}function zo(e,t){return t/Math.max(e[0],e[1])}function Uo(e,t,n){for(var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:e.width-i,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e.height-r,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=e.data,l=t.width,c=t.height,d=t.data,h=o/l,p=a/c,v=Math.ceil(h/2),f=Math.ceil(p/2),y=e.width,g=0;g<c;g++)for(var m=0;m<l;m++){for(var _=4*(m+(s?c-g-1:g)*l),w=0,k=0,b=0,M=0,E=0,x=0,C=(g+.5)*p,T=Math.floor(g*p);T<(g+1)*p;T++)for(var P=Math.abs(C-(T+.5))/f,I=(m+.5)*h,Z=P*P,A=Math.floor(m*h);A<(m+1)*h;A++){var S=Math.abs(I-(A+.5))/v,R=Math.sqrt(Z+S*S);if(!(R>=1)){var F=2*R*R*R-3*R*R+1,L=4*(i+A+(r+T)*y);x+=F*u[L+3],k+=F,!n&&u[L+3]<255&&(F=F*u[L+3]/255),b+=F*u[L],M+=F*u[L+1],E+=F*u[L+2],w+=F}}d[_]=b/w,d[_+1]=M/w,d[_+2]=E/w,d[_+3]=x/k}return t}function Go(e,t,n){if(!t)return e;var i=e.framebufferWidth,r=e.framebufferHeight,o=e.pixelRatio,a=e.region,s=Bo(e,n),u=s.left+s.right,l=s.top+s.bottom,c=i-u,d=r-l,p=Math.min(8,Math.min((2048-u)/c,(2048-l)/d));return p<1.5?e:(0,h.Z)((0,h.Z)({},e),{},{framebufferWidth:Math.round(c*p)+u,framebufferHeight:Math.round(d*p)+l,pixelRatio:o*p,resample:{region:{x:Math.round((a.x-s.left)*p)+s.left,y:Math.round((a.y-s.top)*p)+s.top,width:Math.round(a.width*p),height:Math.round(a.height*p)},width:i,height:r}})}function Bo(e,t){return!t||e&&e.ignorePadding?Ko:t}function Ho(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return Wo}}var jo={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Wo="png",qo={png:100,jpg:98,jpeg:98},Ko={top:0,right:0,bottom:0,left:0};function Qo(e){var t=(0,se.l)(e);if(!t.available)return new g.s("webgl:required","WebGL is required but not supported.");if("3d"===e&&t.majorPerformanceCaveat)return new g.s("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new g.s("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new g.s("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===ue.r.WEBGL1){if(!t.supportsElementIndexUint)return new g.s("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new g.s("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new g.s("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}var Yo="esri-component",Xo=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;return(0,p.Z)(this,n),(e=t.apply(this,arguments)).widget=null,e}return(0,v.Z)(n,[{key:"destroy",value:function(){this.widget&&this.widget.destroy(),this.node=null}},{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(e){var t=this._get("node");e!==t&&(e&&e.classList.add(Yo),t&&t.classList.remove(Yo),this._set("node",e))}},{key:"castNode",value:function(e){return e?"string"==typeof e||function(e){return e&&"nodeType"in e}(e)?(this._set("widget",null),(0,w.a)(e)):(function(e){return e&&"function"==typeof e.render}(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}}]),n}(g.m);(0,g.e)([(0,g.y)({dependsOn:[]})],Xo.prototype,"id",null),(0,g.e)([(0,g.y)()],Xo.prototype,"node",null),(0,g.e)([(0,g.c)("node")],Xo.prototype,"castNode",null),(0,g.e)([(0,g.y)({readOnly:!0})],Xo.prototype,"widget",void 0);var Jo=Xo=(0,g.e)([(0,g.n)("esri.views.ui.Component")],Xo),$o={left:0,top:0,bottom:0,right:0},ea={bottom:30,top:15,right:15,left:15},ta="manual",na="esri-ui",ia="esri-ui-corner",ra="esri-ui-inner-container",oa="esri-ui-manual-container",aa="esri-ui-corner-container",sa="esri-ui-top-left",ua="esri-ui-top-right",la="esri-ui-bottom-left",ca="esri-ui-bottom-right";function da(e){var t=e,n="object"==typeof t&&null!==t&&Object.getPrototypeOf(t);return null!==n&&n!==Object.prototype||!("component"in t||"index"in t||"position"in t)?null:e}function ha(e,t){var n=t.top,i=t.bottom,r=t.left,o=t.right;e.style.top=n,e.style.bottom=i,e.style.left=r,e.style.right=o}var pa=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._cornerNameToContainerLookup={},i._positionNameToContainerLookup={},i._components=new Array,i._componentToKey=new Map,i._handles=new g.X,i.view=null,i._applyViewPadding=function(){var e=i.container;e&&ha(e,i._toPxPosition(i._getViewPadding()))},i._applyUIPadding=function(){var e=i._innerContainer;e&&ha(e,i._toPxPosition(i.padding))},i._initContainers(),i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this._handles.add([(0,_.l)((function(){var t;return[null===(t=e.view)||void 0===t?void 0:t.padding,e.container]}),this._applyViewPadding,_.h),(0,_.l)((function(){return e.padding}),this._applyUIPadding,_.h)])}},{key:"destroy",value:function(){this.container=null;var e,t=(0,d.Z)(this._components);try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}},{key:"container",set:function(e){var t=this._get("container");e!==t&&(e&&(e.classList.add(na),(0,R.a)(e),this._attachContainers(e)),t&&(t.classList.remove(na),ha(t,{top:"",bottom:"",left:"",right:""}),(0,w.t)(t)),this._set("container",e))}},{key:"height",get:function(){var e=this.get("view.height")||0;if(0===e)return e;var t=this._getViewPadding(),n=t.top+t.bottom;return Math.max(e-n,0)}},{key:"padding",get:function(){return this._get("padding")},set:function(e){this._overrideIfSome("padding",e)}},{key:"castPadding",value:function(e){return"number"==typeof e?{bottom:e,top:e,right:e,left:e}:(0,h.Z)((0,h.Z)({},ea),e)}},{key:"width",get:function(){var e=this.get("view.width")||0;if(0===e)return e;var t=this._getViewPadding(),n=t.left+t.right;return Math.max(e-n,0)}},{key:"add",value:function(e,t){var n,i,r,o,a=this;if(Array.isArray(e))e.forEach((function(e){return a.add(e,t)}));else{var s=da(e);s&&(r=(n=s).index,t=n.position,e=n.component,o=n.key),t&&"object"==typeof t&&(r=(i=t).index,o=i.key,t=i.position),!e||t&&!this._isValidPosition(t)||this._add(e,t,r,o)}}},{key:"remove",value:function(e,t){var n=this;if(e){if(Array.isArray(e))return e.map((function(e){return n.remove(e,t)}));var i=this._find(e);if(i){var r=this._componentToKey;if(r.has(e)&&r.get(e)!==t)return;var o=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(o,1)[0]}}}},{key:"empty",value:function(e){var t=this;return Array.isArray(e)?e.map((function(e){return t.empty(e)})).reduce((function(e,t){return e.concat(t)})):(e=e||ta)===ta?Array.prototype.slice.call(this._manualContainer.children).filter((function(e){return!e.classList.contains(ia)})).map((function(e){return t.remove(e)})):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}},{key:"move",value:function(e,t){var n=this;if(Array.isArray(e)&&e.forEach((function(e){return n.move(e,t)})),e){var i,r=da(e)||da(t);if(r&&(i=r.index,t=r.position,e=r.component||e),!t||this._isValidPosition(t)){var o=this.remove(e);o&&this.add(o,{position:t,index:i})}}}},{key:"find",value:function(e){if(!e)return null;var t=this._findById(e);return t&&(t.widget||t.node)}},{key:"getPosition",value:function(e){for(var t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}},{key:"_add",value:function(e,t,n,i){e instanceof Jo||(e=new Jo({node:e})),this._place({component:e,position:t,index:n}),this._components.push(e),i&&this._componentToKey.set(e,i)}},{key:"_find",value:function(e){return e?e instanceof Jo?this._findByComponent(e):"string"==typeof e?this._findById(e):this._findByNode(e.domNode||e):null}},{key:"_getViewPadding",value:function(){return this.get("view.padding")||$o}},{key:"_attachContainers",value:function(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}},{key:"_initContainers",value:function(){var e=document.createElement("div");e.classList.add(ra),e.classList.add(aa);var t=document.createElement("div");t.classList.add(ra),t.classList.add(oa);var n=document.createElement("div");n.classList.add(sa),n.classList.add(ia),e.appendChild(n);var i=document.createElement("div");i.classList.add(ua),i.classList.add(ia),e.appendChild(i);var r=document.createElement("div");r.classList.add(la),r.classList.add(ia),e.appendChild(r);var o=document.createElement("div");o.classList.add(ca),o.classList.add(ia),e.appendChild(o),this._innerContainer=e,this._manualContainer=t;var a=(0,w.f)();this._cornerNameToContainerLookup={"top-left":n,"top-right":i,"bottom-left":r,"bottom-right":o,"top-leading":a?i:n,"top-trailing":a?n:i,"bottom-leading":a?o:r,"bottom-trailing":a?r:o},this._positionNameToContainerLookup=(0,h.Z)({manual:t},this._cornerNameToContainerLookup)}},{key:"_isValidPosition",value:function(e){return!!this._positionNameToContainerLookup[e]}},{key:"_place",value:function(e){var t=e.component,n=e.position||ta,i=e.index,r=this._positionNameToContainerLookup[n],o=i>-1;if(function(e){return e&&!e._started&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}(t.widget)&&t.widget.startup(),o){var a=Array.prototype.slice.call(r.children);0!==i?i>=a.length?r.appendChild(t.node):(0,w.o)(t.node,a[i]):r.firstChild?(0,w.o)(t.node,r.firstChild):r.appendChild(t.node)}else r.appendChild(t.node)}},{key:"_toPxPosition",value:function(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}},{key:"_toPxUnit",value:function(e){return 0===e?"0":e+"px"}},{key:"_findByComponent",value:function(e){var t,n=null;return this._components.some((function(i){return(t=i===e)&&(n=i),t})),n}},{key:"_findById",value:function(e){var t,n=null;return this._components.some((function(i){return(t=i.id===e)&&(n=i),t})),n}},{key:"_findByNode",value:function(e){var t,n=null;return this._components.some((function(i){return(t=i.node===e)&&(n=i),t})),n}}]),n}(x.n.EventedAccessor);(0,g.e)([(0,g.y)()],pa.prototype,"container",null),(0,g.e)([(0,g.y)()],pa.prototype,"height",null),(0,g.e)([(0,g.y)({value:ea})],pa.prototype,"padding",null),(0,g.e)([(0,g.c)("padding")],pa.prototype,"castPadding",null),(0,g.e)([(0,g.y)()],pa.prototype,"view",void 0),(0,g.e)([(0,g.y)()],pa.prototype,"width",null);var va=pa=(0,g.e)([(0,g.n)("esri.views.ui.UI")],pa);function fa(e,t){return e&&"copyright"in e&&(!t||"function"==typeof e.originOf&&"user"===e.originOf("copyright"))}function ya(e,t,n){n&&t&&(e.find((function(e){return e.layerView===t&&e.text===n}))||e.push({text:n,layerView:t}))}function ga(e){return"bing-maps"===e.type}var ma=[],_a=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._clear=function(){i._fetchedAttributionData.clear(),i._pendingAttributions.clear(),i.handles.remove("suspension"),i.notifyChange("state")},i._pendingAttributions=new Set,i._fetchedAttributionData=new Map,i.items=new k.j,i.view=null,i._allLayerViewsChange=function(e){i.handles.remove("suspension");var t=i.get("view.allLayerViews");t&&i.handles.add(t.map((function(e){return(0,_.l)((function(){var t;return[e.suspended,null===(t=e.layer)||void 0===t?void 0:t.attributionVisible]}),(function(){return i._updateAttributionItems()}))})),"suspension"),e&&e.removed&&e.removed.forEach((function(e){i._pendingAttributions.delete(e),i._fetchedAttributionData.delete(e)})),i._updateAttributionItems()},i.handles.add([(0,_.a)((function(){var e;return null===(e=i.view)||void 0===e?void 0:e.allLayerViews}),"change",(function(e){return i._allLayerViewsChange(e)}),{onListenerAdd:function(){return i._allLayerViewsChange()},onListenerRemove:i._clear}),(0,_.f)((function(){var e;return!0===(null===(e=i.view)||void 0===e?void 0:e.stationary)}),(function(){return i._updateAttributionItems()}))]),i}return(0,v.Z)(n,[{key:"destroy",value:function(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}},{key:"state",get:function(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}},{key:"_updateAttributionItems",value:function(){var e=this,t=this.get("view.allLayerViews");ma.length=0,t?(t.forEach((function(t){var n;if(!t.suspended&&null!==(n=t.layer)&&void 0!==n&&n.attributionVisible){var i=t.layer;if(fa(i,"user"))ya(ma,t,i.copyright);else if(i.hasAttributionData){if(e._fetchedAttributionData.has(t)){var r=e._fetchedAttributionData.get(t);return void(r?ya(ma,t,e._getDynamicAttribution(r,e.view,i)):fa(i)&&ya(ma,t,i.copyright))}e._fetchAttributionData(t)}else{var o=i.get("portalItem.accessInformation");ya(ma,t,o||i.copyright)}}})),function(e,t){return e.length!==t.length||e.some((function(e,n){return e.text!==t[n].text}))}(this.items,ma)&&(this.items.removeAll(),this.items.addMany(ma)),ma.length=0,this.notifyChange("state")):this._clear()}},{key:"_fetchAttributionData",value:function(){var e=(0,c.Z)((0,l.Z)().mark((function e(t){var n,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._pendingAttributions.has(t)){e.next=2;break}return e.abrupt("return");case 2:return this._pendingAttributions.add(t),e.next=5,(0,N.b)(t.layer.fetchAttributionData());case 5:n=e.sent,this._pendingAttributions.has(t)&&(i=n.ok?this._createContributionIndex(n.value,ga(t.layer)):null,this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,i)),this._updateAttributionItems();case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createContributionIndex",value:function(e,t){var n=e.contributors,i={};if(!n)return i;for(var r=0;r<n.length;r++){var o=n[r],a=o.coverageAreas;if(!a)return;var s,u=(0,d.Z)(a);try{for(u.s();!(s=u.n()).done;)for(var l=s.value,c=l.bbox,h=l.zoomMin-(t&&l.zoomMin?1:0),p=l.zoomMax-(t&&l.zoomMax?1:0),v={xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:P.k.WGS84},f={extent:(0,P.R)(v),attribution:o.attribution||"",score:null!=l.score?l.score:100,id:r},y=h;y<=p;y++)i[y]=i[y]||[],i[y].push(f)}catch(g){u.e(g)}finally{u.f()}}return i.maxKey=Math.max.apply(null,Object.keys(i)),i}},{key:"_getDynamicAttribution",value:function(e,t,n){var i=t.extent,r=t.scale,o=n.tileInfo.scaleToZoom(r);if(o=Math.min(e.maxKey,Math.round(o)),!i||null==o||o<=-1)return"";var a=e[o],s=(0,P.M)(i.center.clone().normalize(),t.spatialReference),u={};return a?a.filter((function(e){var t=!u[e.id]&&s&&(0,B.r)(e.extent,s);return t&&(u[e.id]=!0),t})).sort((function(e,t){return t.score-e.score||e.objectId-t.objectId})).map((function(e){return e.attribution})).join(", "):""}}]),n}(b.d);(0,g.e)([(0,g.y)({readOnly:!0,type:k.j})],_a.prototype,"items",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],_a.prototype,"state",null),(0,g.e)([(0,g.y)()],_a.prototype,"view",void 0);var wa=_a=(0,g.e)([(0,g.n)("esri.widgets.Attribution.AttributionViewModel")],_a),ka="esri-attribution esri-widget",ba="esri-attribution__powered-by",Ma="esri-attribution__sources",Ea="esri-attribution--open",xa="esri-attribution__sources--open",Ca="esri-attribution__link",Ta="esri-icon-description",Pa="esri-interactive",Ia=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i){var r;return(0,p.Z)(this,n),(r=t.call(this,e,i))._isOpen=!1,r._attributionTextOverflowed=!1,r._prevSourceNodeHeight=0,r._resizeObserver=new ResizeObserver((function(e){return e.forEach((function(e){var t=e.target;return r._checkSourceTextOverflow(t)}))})),r.iconClass=Ta,r.itemDelimiter=" | ",r.messages=null,r.viewModel=new wa,r}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,_.a)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.items}),"change",(function(){return e.scheduleRender()})))}},{key:"destroy",value:function(){var e;null===(e=this._resizeObserver)||void 0===e||e.disconnect()}},{key:"_isInteractive",get:function(){return this._isOpen||this._attributionTextOverflowed}},{key:"attributionText",get:function(){return this.viewModel.items.reduce((function(e,t){return e.includes(t.text)||e.push(t.text),e}),[]).join(this.itemDelimiter)}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"render",value:function(){var e=(0,u.Z)({},Ea,this._isOpen);return(0,w.n)("div",{bind:this,class:this.classes(ka,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}},{key:"renderPoweredBy",value:function(){return(0,w.n)("div",{class:ba},"Powered by"," ",(0,w.n)("a",{class:Ca,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}},{key:"renderSourcesNode",value:function(){var e,t=this._isOpen,n=this._isInteractive,i=n?"0":"",r=this.attributionText,o=(e={},(0,u.Z)(e,xa,t),(0,u.Z)(e,Pa,n),e);return(0,w.n)("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(Ma,o),innerHTML:r,tabindex:i})}},{key:"_afterSourcesNodeCreate",value:function(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}},{key:"_checkSourceTextOverflow",value:function(e){var t=!1,n=e.clientHeight,i=e.clientWidth,r=e.scrollWidth>i,o=this._attributionTextOverflowed!==r;if(this._attributionTextOverflowed=r,o&&(t=!0),this._isOpen){var a=n<this._prevSourceNodeHeight;this._prevSourceNodeHeight=n,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}},{key:"_toggleState",value:function(){this._isInteractive&&(this._isOpen=!this._isOpen)}}]),n}(w.M);(0,g.e)([(0,g.y)()],Ia.prototype,"_isOpen",void 0),(0,g.e)([(0,g.y)()],Ia.prototype,"_isInteractive",null),(0,g.e)([(0,g.y)()],Ia.prototype,"_attributionTextOverflowed",void 0),(0,g.e)([(0,g.y)()],Ia.prototype,"_prevSourceNodeHeight",void 0),(0,g.e)([(0,g.y)({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Ia.prototype,"attributionText",null),(0,g.e)([(0,g.y)()],Ia.prototype,"iconClass",void 0),(0,g.e)([(0,g.y)()],Ia.prototype,"itemDelimiter",void 0),(0,g.e)([(0,g.y)()],Ia.prototype,"label",null),(0,g.e)([(0,g.y)(),(0,w.e)("esri/widgets/Attribution/t9n/Attribution")],Ia.prototype,"messages",void 0),(0,g.e)([(0,g.y)()],Ia.prototype,"view",null),(0,g.e)([(0,g.y)({type:wa})],Ia.prototype,"viewModel",void 0),(0,g.e)([(0,F.t)()],Ia.prototype,"_toggleState",null);var Za=Ia=(0,g.e)([(0,g.n)("esri.widgets.Attribution")],Ia),Aa=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._handles=new g.X,i.orientation={x:0,y:0,z:0},i.view=null,i._updateForCamera=i._updateForCamera.bind((0,s.Z)(i)),i._updateForRotation=i._updateForRotation.bind((0,s.Z)(i)),i._updateRotationWatcher=i._updateRotationWatcher.bind((0,s.Z)(i)),i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this._handles.add((0,_.l)((function(){return e.view}),this._updateRotationWatcher,_.h))}},{key:"destroy",value:function(){this._handles=(0,m.f)(this._handles),this.view=null}},{key:"canShowNorth",get:function(){var e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}},{key:"reset",value:function(){if(this.get("view.ready")){var e={};"2d"===this.view.type?e.rotation=0:e.heading=0,this.callGoTo({target:e})}}},{key:"_updateForRotation",value:function(e){null!=e&&(this.orientation={z:e})}},{key:"_updateForCamera",value:function(e){if(e){var t=-e.heading;this.orientation={x:0,y:0,z:t}}}},{key:"_updateRotationWatcher",value:function(e){this._handles.removeAll(),e&&this._handles.add("2d"===e.type?(0,_.l)((function(){return null===e||void 0===e?void 0:e.rotation}),this._updateForRotation,_.h):(0,_.l)((function(){return null===e||void 0===e?void 0:e.camera}),this._updateForCamera,_.h))}}]),n}((0,S.e)(g.m));(0,g.e)([(0,g.y)({readOnly:!0})],Aa.prototype,"canShowNorth",null),(0,g.e)([(0,g.y)()],Aa.prototype,"orientation",void 0),(0,g.e)([(0,g.y)({readOnly:!0})],Aa.prototype,"state",null),(0,g.e)([(0,g.y)()],Aa.prototype,"view",void 0);var Sa=Aa=(0,g.e)([(0,g.n)("esri.widgets.CompassViewModel")],Aa),Ra="esri-compass esri-widget--button esri-widget",Fa="esri-icon-font-fallback-text",La="esri-compass__icon",Oa="esri-icon-dial",Da="esri-icon-compass",Na="esri-icon-locate-circled",Va="esri-interactive",za="esri-disabled",Ua=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i){var r;return(0,p.Z)(this,n),(r=t.call(this,e,i)).iconClass=Na,r.messages=null,r.viewModel=new Sa,r}return(0,v.Z)(n,[{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(e){this.viewModel.goToOverride=e}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"reset",value:function(){return this.viewModel.reset()}},{key:"render",value:function(){var e,t,n=this.viewModel,i=n.orientation,r=n.state,o="disabled"===r,a="compass"===("rotation"===r?"rotation":"compass"),s=o?-1:0,l=(e={},(0,u.Z)(e,za,o),(0,u.Z)(e,Va,!o),e),c=(t={},(0,u.Z)(t,Da,a),(0,u.Z)(t,Oa,!a),t),d=this.messages;return(0,w.n)("div",{bind:this,class:this.classes(Ra,l),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":d.reset,title:d.reset},(0,w.n)("span",{"aria-hidden":"true",class:this.classes(La,c),styles:this._toRotationTransform(i)}),(0,w.n)("span",{class:Fa},d.reset))}},{key:"_reset",value:function(){this.viewModel.reset()}},{key:"_toRotationTransform",value:function(e){return{transform:"rotateZ(".concat(e.z,"deg)")}}}]),n}(w.M);(0,g.e)([(0,g.y)()],Ua.prototype,"goToOverride",null),(0,g.e)([(0,g.y)()],Ua.prototype,"iconClass",void 0),(0,g.e)([(0,g.y)()],Ua.prototype,"label",null),(0,g.e)([(0,g.y)(),(0,w.e)("esri/widgets/Compass/t9n/Compass")],Ua.prototype,"messages",void 0),(0,g.e)([(0,g.y)()],Ua.prototype,"view",null),(0,g.e)([(0,g.y)({type:Sa})],Ua.prototype,"viewModel",void 0),(0,g.e)([(0,F.t)()],Ua.prototype,"_reset",null);var Ga=Ua=(0,g.e)([(0,g.n)("esri.widgets.Compass")],Ua),Ba=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e)).navigationMode="pan",i.view=null,i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this.own((0,_.f)((function(){var t;return null===(t=e.view)||void 0===t?void 0:t.inputManager}),(function(){return e._setNavigationMode()})))}},{key:"destroy",value:function(){this.view=null}},{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}},{key:"toggle",value:function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}},{key:"_setNavigationMode",value:function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"}}]),n}(g.m);(0,g.e)([(0,g.y)({readOnly:!0})],Ba.prototype,"state",null),(0,g.e)([(0,g.y)()],Ba.prototype,"navigationMode",void 0),(0,g.e)([(0,g.y)()],Ba.prototype,"view",void 0);var Ha=Ba=(0,g.e)([(0,g.n)("esri.widgets.NavigationToggleViewModel")],Ba),ja="esri-navigation-toggle esri-widget",Wa="esri-navigation-toggle__button esri-widget--button",qa="esri-navigation-toggle__button--active",Ka="esri-navigation-toggle__button--pan",Qa="esri-navigation-toggle__button--rotate",Ya="esri-navigation-toggle--horizontal",Xa="esri-icon-rotate",Ja="esri-icon-pan",$a="esri-icon-pan2",es="esri-disabled",ts=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i){var r;return(0,p.Z)(this,n),(r=t.call(this,e,i)).iconClass=$a,r.messages=null,r.viewModel=new Ha,r}return(0,v.Z)(n,[{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"layout",set:function(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"toggle",value:function(){return this.viewModel.toggle()}},{key:"render",value:function(){var e,t="disabled"===this.get("viewModel.state"),n="pan"===this.get("viewModel.navigationMode"),i=(e={},(0,u.Z)(e,es,t),(0,u.Z)(e,Ya,"horizontal"===this.layout),e),r=(0,u.Z)({},qa,n),o=(0,u.Z)({},qa,!n),a=t?-1:0,s=this.messages.toggle;return(0,w.n)("div",{bind:this,class:this.classes(ja,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:a,"aria-label":s,title:s},(0,w.n)("div",{class:this.classes(Wa,Ka,r)},(0,w.n)("span",{class:Ja})),(0,w.n)("div",{class:this.classes(Wa,Qa,o)},(0,w.n)("span",{class:Xa})))}},{key:"_toggle",value:function(){this.toggle()}}]),n}(w.M);(0,g.e)([(0,g.y)()],ts.prototype,"iconClass",void 0),(0,g.e)([(0,g.y)()],ts.prototype,"label",null),(0,g.e)([(0,g.y)({value:"vertical"})],ts.prototype,"layout",null),(0,g.e)([(0,g.y)(),(0,w.e)("esri/widgets/NavigationToggle/t9n/NavigationToggle")],ts.prototype,"messages",void 0),(0,g.e)([(0,g.y)()],ts.prototype,"view",null),(0,g.e)([(0,g.y)({type:Ha})],ts.prototype,"viewModel",void 0),(0,g.e)([(0,F.t)()],ts.prototype,"_toggle",null);var ns=ts=(0,g.e)([(0,g.n)("esri.widgets.NavigationToggle")],ts),is="esri-widget--button esri-widget",rs="esri-disabled",os="esri-interactive",as="esri-icon-font-fallback-text",ss="esri-icon",us=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){var e;return(0,p.Z)(this,n),(e=t.apply(this,arguments)).enabled=!0,e.iconClass="",e.title="",e}return(0,v.Z)(n,[{key:"render",value:function(){var e,t=this.enabled?0:-1,n=(e={},(0,u.Z)(e,rs,!this.enabled),(0,u.Z)(e,os,this.enabled),e),i=(0,u.Z)({},this.iconClass,!!this.iconClass);return(0,w.n)("div",{bind:this,class:this.classes(is,n),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:t,title:this.title},(0,w.n)("span",{"aria-hidden":"true",role:"presentation",class:this.classes(ss,i)}),(0,w.n)("span",{class:as},this.title))}},{key:"_triggerAction",value:function(){this.action.call(this)}}]),n}(w.M);(0,g.e)([(0,g.y)()],us.prototype,"action",void 0),(0,g.e)([(0,g.y)()],us.prototype,"enabled",void 0),(0,g.e)([(0,g.y)()],us.prototype,"iconClass",void 0),(0,g.e)([(0,g.y)()],us.prototype,"title",void 0),(0,g.e)([(0,F.t)()],us.prototype,"_triggerAction",null);var ls=us=(0,g.e)([(0,g.n)("esri.widgets.IconButton")],us),cs=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;var e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return 0===t||e>t}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;var e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return 0===t||e<t}}]),n}(g.m);(0,g.e)([(0,g.y)({readOnly:!0})],cs.prototype,"canZoomIn",null),(0,g.e)([(0,g.y)({readOnly:!0})],cs.prototype,"canZoomOut",null),(0,g.e)([(0,g.y)()],cs.prototype,"view",void 0);var ds=cs=(0,g.e)([(0,g.n)("esri.widgets.Zoom.ZoomConditions2D")],cs),hs=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,v.Z)(n,[{key:"canZoomIn",get:function(){return!!this.view.ready}},{key:"canZoomOut",get:function(){return!!this.view.ready}}]),n}(g.m);(0,g.e)([(0,g.y)({readOnly:!0})],hs.prototype,"canZoomIn",null),(0,g.e)([(0,g.y)({readOnly:!0})],hs.prototype,"canZoomOut",null),(0,g.e)([(0,g.y)()],hs.prototype,"view",void 0);var ps=hs=(0,g.e)([(0,g.n)("esri.widgets.Zoom.ZoomConditions3D")],hs),vs=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){return(0,p.Z)(this,n),t.call(this,e)}return(0,v.Z)(n,[{key:"destroy",value:function(){this.view=null}},{key:"canZoomIn",get:function(){return(0,m.r)(this._zoomConditions)&&this._zoomConditions.canZoomIn}},{key:"canZoomOut",get:function(){var e;return(0,m.r)(this._zoomConditions)&&(null===(e=this._zoomConditions)||void 0===e?void 0:e.canZoomOut)}},{key:"state",get:function(){var e;return null!==(e=this.view)&&void 0!==e&&e.ready?"ready":"disabled"}},{key:"view",set:function(e){e?"2d"===e.type?this._zoomConditions=new ds({view:e}):"3d"===e.type&&(this._zoomConditions=new ps({view:e})):this._zoomConditions=null,this._set("view",e)}},{key:"zoomIn",value:function(){if(this.canZoomIn){var e=this.view;"2d"===e.type?e.mapViewNavigation.zoomIn():(0,g.a2)(e.goTo({zoomFactor:2}))}}},{key:"zoomOut",value:function(){if(this.canZoomOut){var e=this.view;"2d"===e.type?e.mapViewNavigation.zoomOut():(0,g.a2)(e.goTo({zoomFactor:.5}))}}}]),n}(g.m);(0,g.e)([(0,g.y)()],vs.prototype,"_zoomConditions",void 0),(0,g.e)([(0,g.y)()],vs.prototype,"canZoomIn",null),(0,g.e)([(0,g.y)()],vs.prototype,"canZoomOut",null),(0,g.e)([(0,g.y)({readOnly:!0})],vs.prototype,"state",null),(0,g.e)([(0,g.y)()],vs.prototype,"view",null);var fs=vs=(0,g.e)([(0,g.n)("esri.widgets.Zoom.ZoomViewModel")],vs),ys="esri-zoom esri-widget",gs="esri-zoom--horizontal",ms="esri-icon-plus",_s="esri-icon-minus",ws="esri-icon-zoom-in-magnifying-glass",ks=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e,i){var r;return(0,p.Z)(this,n),(r=t.call(this,e,i)).iconClass=ws,r.messages=null,r.viewModel=new fs,r}return(0,v.Z)(n,[{key:"initialize",value:function(){this._zoomInButton=new ls({action:this.zoomIn.bind(this),iconClass:ms}),this._zoomOutButton=new ls({action:this.zoomOut.bind(this),iconClass:_s})}},{key:"destroy",value:function(){this._zoomInButton=(0,m.g)(this._zoomInButton),this._zoomOutButton=(0,m.g)(this._zoomOutButton)}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"layout",set:function(e){"horizontal"!==e&&(e="vertical"),this._set("layout",e)}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"render",value:function(){var e=this.viewModel,t=(0,u.Z)({},gs,"horizontal"===this.layout),n=e.canZoomIn,i=e.canZoomOut;this._zoomInButton.enabled=n,this._zoomOutButton.enabled=i;var r=this.messages,o=r.zoomIn,a=r.zoomOut;return this._zoomInButton.title=o,this._zoomOutButton.title=a,(0,w.n)("div",{class:this.classes(ys,t)},this._zoomInButton.render(),this._zoomOutButton.render())}},{key:"zoomIn",value:function(){return this.viewModel.zoomIn()}},{key:"zoomOut",value:function(){return this.viewModel.zoomOut()}}]),n}(w.M);(0,g.e)([(0,g.y)()],ks.prototype,"iconClass",void 0),(0,g.e)([(0,g.y)()],ks.prototype,"label",null),(0,g.e)([(0,g.y)({value:"vertical"})],ks.prototype,"layout",null),(0,g.e)([(0,g.y)(),(0,w.e)("esri/widgets/Zoom/t9n/Zoom")],ks.prototype,"messages",void 0),(0,g.e)([(0,g.y)()],ks.prototype,"view",null),(0,g.e)([(0,g.y)({type:fs})],ks.prototype,"viewModel",void 0);var bs=ks=(0,g.e)([(0,g.n)("esri.widgets.Zoom")],ks);var Ms=function(e){(0,f.Z)(n,e);var t=(0,y.Z)(n);function n(e){var i;return(0,p.Z)(this,n),(i=t.call(this,e))._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},i.components=[],i}return(0,v.Z)(n,[{key:"initialize",value:function(){var e=this;this._handles.add([(0,_.l)((function(){return e.components}),this._componentsWatcher.bind(this),_.h),(0,_.l)((function(){return e.view}),this._updateViewAwareWidgets.bind(this),_.h)])}},{key:"_add",value:function(e,t,o,a){if("string"==typeof e&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}(0,i.Z)((0,r.Z)(n.prototype),"_add",this).call(this,e,t,o,a)}},{key:"_removeComponents",value:function(e){var t=this;e.forEach((function(e){var n=t._find(e);n&&(t.remove(n),n.destroy())}))}},{key:"_updateViewAwareWidgets",value:function(e){var t=this;this.components.forEach((function(n){var i=t._find(n),r=i&&i.widget;(function(e){return e&&void 0!==e.view})(r)&&(r.view=e)}))}},{key:"_componentsWatcher",value:function(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}},{key:"_adjustPadding",value:function(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){var t=this.padding.top;this.padding=t}}},{key:"_addComponents",value:function(e){var t=this;this.constructed&&e.forEach((function(e){return t.add(t._createComponent(e),t._defaultPositionLookup[e])}))}},{key:"_createComponent",value:function(e){var t=this._createWidget(e);if(t)return new Jo({id:e,node:t})}},{key:"_createWidget",value:function(e){return"attribution"===e?this._createAttribution():"compass"===e?this._createCompass():"navigation-toggle"===e?this._createNavigationToggle():"zoom"===e?this._createZoom():void 0}},{key:"_createAttribution",value:function(){return new Za({view:this.view})}},{key:"_createCompass",value:function(){return new Ga({view:this.view})}},{key:"_createNavigationToggle",value:function(){return new ns({view:this.view})}},{key:"_createZoom",value:function(){return new bs({view:this.view})}}]),n}(va);(0,g.e)([(0,g.y)()],Ms.prototype,"components",void 0);var Es=Ms=(0,g.e)([(0,g.n)("esri.views.ui.DefaultUI")],Ms)},85700:function(e,t,n){n.d(t,{a:function(){return l},c:function(){return d},e:function(){return v},o:function(){return h},r:function(){return p},t:function(){return c}});var i=n(15671),r=n(43144),o=n(60136),a=n(29388),s=n(93661),u=n(48848);function l(e){return e&&"function"==typeof e.highlight}function c(e){return e&&"function"==typeof e.maskOccludee}function d(e,t,n){return(0,s.t)(e)||e>n&&(0===t||e<t)}function h(e,t){return e>0||t>0}function p(e){var t,n,i=e.effectiveScaleRange;return{minScale:null!==(t=null===i||void 0===i?void 0:i.minScale)&&void 0!==t?t:0,maxScale:null!==(n=null===i||void 0===i?void 0:i.maxScale)&&void 0!==n?n:0}}var v=function(e){var t=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(){var e;(0,i.Z)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).goToOverride=null,e.view=null,e}return(0,r.Z)(n,[{key:"callGoTo",value:function(e){var t=this.view;return this.goToOverride?this.goToOverride(t,e):t.goTo(e.target,e.options)}}]),n}(e);return(0,u.e)([(0,u.y)()],t.prototype,"goToOverride",void 0),(0,u.e)([(0,u.y)()],t.prototype,"view",void 0),t=(0,u.e)([(0,u.n)("esri.widgets.support.GoTo")],t)}},23585:function(e,t,n){n.d(t,{a:function(){return v},i:function(){return f},l:function(){return p}});var i=n(37762),r=n(15671),o=n(43144),a=n(60136),s=n(29388),u=n(48848),l=n(64998),c=n(93661),d=n(93314),h=n(81556),p=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).handles.add([i.on("before-add",(function(e){(0,c.t)(e.item)&&e.preventDefault()})),i.on("after-add",(function(e){return i._own(e.item)})),i.on("after-remove",(function(e){return i._release(e.item)}))]),i}return(0,o.Z)(n,[{key:"owner",get:function(){return this._get("owner")},set:function(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}},{key:"_ownAll",value:function(){var e,t=(0,i.Z)(this.items);try{for(t.s();!(e=t.n()).done;){var n=e.value;this._own(n)}}catch(r){t.e(r)}finally{t.f()}}},{key:"_releaseAll",value:function(){var e,t=(0,i.Z)(this.items);try{for(t.s();!(e=t.n()).done;){var n=e.value;this._release(n)}}catch(r){t.e(r)}finally{t.f()}}},{key:"_createNewInstance",value:function(e){return this.itemType?new(d.j.ofType(this.itemType.Type))(e):new d.j(e)}}]),n}((0,n(630).a)(d.j));function v(e,t){return{type:e,cast:h.t,set:function(n){var i=(0,h.n)(n,this._get(t),e);i.owner=this,this._set(t,i)}}}(0,u.e)([(0,u.y)()],p.prototype,"owner",null);var f=function(e){(0,a.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,o.Z)(n,[{key:"_own",value:function(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}},{key:"_release",value:function(e){e.layer===this.owner&&(e.layer=null)}}]),n}(p=(0,u.e)([(0,u.n)("esri.core.support.OwningCollection")],p));(0,u.e)([(0,d.n)({Type:l.g,ensureType:(0,u.b)(l.g)})],f.prototype,"itemType",void 0),f=(0,u.e)([(0,u.n)("esri.support.GraphicsCollection")],f)},47748:function(e,t,n){n.d(t,{F:function(){return Z},I:function(){return g},a:function(){return y},g:function(){return w},n:function(){return p},p:function(){return _},t:function(){return h},y:function(){return S}});var i=n(60136),r=n(29388),o=n(37762),a=n(15671),s=n(43144),u=n(48848),l=n(93661),c=n(50690),d=n(15751),h=function(){function e(t){(0,a.Z)(this,e),this._observable=new d.e,this._value=t}return(0,s.Z)(e,[{key:"get",value:function(){return(0,u.i)(this._observable),this._value}},{key:"set",value:function(e){e!==this._value&&(this._value=e,this._observable.notify())}}]),e}(),p=function(){function e(){(0,a.Z)(this,e),this._tasks=new Array,this._running=new h(!1)}return(0,s.Z)(e,[{key:"length",get:function(){return this._tasks.length}},{key:"running",get:function(){return this._running.get()}},{key:"destroy",value:function(){this.cancelAll()}},{key:"runTask",value:function(e){for(;!e.done&&this._process(e);)e.madeProgress()}},{key:"push",value:function(e,t,n){var i=this;return this._running.set(!0),new Promise((function(r,o){return i._tasks.push(new v(r,o,e,t,n))}))}},{key:"unshift",value:function(e,t,n){var i=this;return this._running.set(!0),new Promise((function(r,o){return i._tasks.unshift(new v(r,o,e,t,n))}))}},{key:"_process",value:function(e){if(0===this._tasks.length)return!1;var t=this._tasks.shift();try{var n=(0,u.p)(t.signal);if(n&&!t.abortCallback)t.reject((0,u.d)());else{var i,r=n?null===(i=t.abortCallback)||void 0===i?void 0:i.call(t,(0,u.d)()):t.callback(e);(0,u.V)(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(v){t.reject(v)}return this._running.set(this._tasks.length>0),!0}},{key:"cancelAll",value:function(){var e,t=(0,u.d)(),n=(0,o.Z)(this._tasks);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i.abortCallback){var r=i.abortCallback(t);i.resolve(r)}else i.reject(t)}}catch(a){n.e(a)}finally{n.f()}this._tasks.length=0,this._running.set(!1)}}]),e}(),v=(0,s.Z)((function e(t,n,i,r,o){(0,a.Z)(this,e),this.resolve=t,this.reject=n,this.callback=i,this.signal=r,this.abortCallback=o})),f=function(e){(0,i.Z)(n,e);var t=(0,r.Z)(n);function n(){var e;return(0,a.Z)(this,n),(e=t.apply(this,arguments)).SCHEDULER_LOG_SLOW_TASKS=!1,e.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1,e}return(0,s.Z)(n)}(u.m);(0,u.e)([(0,u.y)()],f.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,u.e)([(0,u.y)()],f.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);var y,g,m,_=new(f=(0,u.e)([(0,u.n)("esri.views.support.DebugFlags")],f));function w(){return new M.Scheduler}!function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(y||(y={})),(m=g||(g={})).RESOURCE_CONTROLLER="schedule",m.SLIDE="slide",m.STREAM_DATA_LOADER="stream loader",m.ELEVATION_QUERY="elevation query",m.TERRAIN_SURFACE="terrain",m.SURFACE_GEOMETRY_UPDATES="surface geometry updates",m.GRAPHICS_CORE="Graphics3D",m.I3S_CONTROLLER="I3S",m.POINT_CLOUD_LAYER="point cloud",m.FEATURE_TILE_FETCHER="feature fetcher",m.OVERLAY="overlay",m.STAGE="stage",m.GRAPHICS_DECONFLICTOR="graphics deconflictor",m.FILTER_VISIBILITY="Graphics3D filter visibility",m.SCALE_VISIBILITY="Graphics3D scale visibility",m.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",m.POINT_OF_INTEREST_FREQUENT="POI frequent",m.POINT_OF_INTEREST_INFREQUENT="POI infrequent",m.LABELER="labeler",m.FEATURE_QUERY_ENGINE="feature query",m.FEATURE_TILE_TREE="feature tile tree",m.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",m.ELEVATION_ALIGNMENT="elevation alignment",m.TEXT_TEXTURE_ATLAS="text texture atlas",m.TEXTURE_UNLOAD="texture unload",m.LINE_OF_SIGHT_TOOL="line of sight tool",m.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",m.ELEVATION_PROFILE="elevation profile",m.SNAPPING="snapping",m.SHADOW_ACCUMULATOR="shadow accumulator",m.CLOUDS_GENERATOR="cloud generator",m[m.TEST_PRIO=1]="TEST_PRIO";var k=new Map([[g.RESOURCE_CONTROLLER,0],[g.SLIDE,0],[g.STREAM_DATA_LOADER,0],[g.ELEVATION_QUERY,0],[g.TERRAIN_SURFACE,1],[g.SURFACE_GEOMETRY_UPDATES,1],[g.GRAPHICS_CORE,2],[g.I3S_CONTROLLER,2],[g.POINT_CLOUD_LAYER,2],[g.FEATURE_TILE_FETCHER,2],[g.OVERLAY,4],[g.STAGE,4],[g.GRAPHICS_DECONFLICTOR,4],[g.FILTER_VISIBILITY,4],[g.SCALE_VISIBILITY,4],[g.FRUSTUM_VISIBILITY,4],[g.CLOUDS_GENERATOR,4],[g.POINT_OF_INTEREST_FREQUENT,6],[g.POINT_OF_INTEREST_INFREQUENT,30],[g.LABELER,8],[g.FEATURE_QUERY_ENGINE,8],[g.FEATURE_TILE_TREE,16],[g.FEATURE_TILE_TREE_ACTIVE,0],[g.ELEVATION_ALIGNMENT,12],[g.TEXT_TEXTURE_ATLAS,12],[g.TEXTURE_UNLOAD,12],[g.LINE_OF_SIGHT_TOOL,16],[g.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[g.SNAPPING,0],[g.SHADOW_ACCUMULATOR,30]]);function b(e){return k.has(e)?k.get(e):"number"==typeof e?e:1}var M,E,x=(0,u.aj)(6.5),C=(0,u.aj)(1),T=(0,u.aj)(30),P=(0,u.aj)(1e3/30),I=(0,u.aj)(100);!function(e){var t=function(){function e(){var t=this;(0,a.Z)(this,e),this._updating=new h(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new u.an("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=y.INTERACTING,this._tasks=new u.a6,this._runQueue=new u.a6,this._load=0,this._idleStateCallbacks=new u.a6,this._idleUpdatesStartFired=!1,this._maxReschedule=32,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,c.l)((function(){return _.SCHEDULER_LOG_SLOW_TASKS}),(function(e){return t._debug=e}),c.h);for(var n=0,r=Object.keys(g);n<r.length;n++){var o=r[n];this.performanceInfo.tasks.set(g[o],new u.an(g[o]))}var s=this;this._test={FRAME_SAFETY_BUDGET:x,INTERACTING_BUDGET:P,IDLE_BUDGET:I,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:function(){return s._budget},setBudget:function(e){return s._budget=e},updateTask:function(e){return t._updateTask(e)},getState:function(e){return t._getState(e)},getRuntime:function(e){return t._getRuntime(e)},frameTaskTimes:this._frameTaskTimes,resetRuntimes:function(){return t._resetRuntimes()},getRunning:function(){return t._getRunning()}}}return(0,s.Z)(e,[{key:"updating",get:function(){return this._updating.get()},set:function(e){this._updating.set(e)}},{key:"destroy",value:function(){this._tasks.toArray().forEach((function(e){return e.remove()})),this._tasks.clear(),(0,l.f)(this._debugHandle),this._microTaskQueued=!1,this._updating.set(!1)}},{key:"activate",value:function(){var e=this;this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask((function(){e._microTaskQueued&&(e._microTaskQueued=!1,e._budget.done||(e._maxReschedule=32,e._schedule(),e.frame()))})))}},{key:"registerTask",value:function(e,t){var i=b(e),r=new n(this,e,t,i);return this._tasks.push(r),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new u.an(e)),r}},{key:"registerIdleStateCallbacks",value:function(e,t){var n=this,i={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(i),this.state===y.IDLE&&this._idleUpdatesStartFired&&i.idleBegin();var r=this;return{remove:function(){return n._removeIdleStateCallbacks(i)},set idleBegin(e){r._idleUpdatesStartFired&&(i.idleEnd(),r._state===y.IDLE&&e()),i.idleBegin=e},set idleEnd(e){i.idleEnd=e}}}},{key:"load",get:function(){return this._load}},{key:"state",get:function(){return this._state},set:function(e){this._state!==e&&(this._state=e,this.state!==y.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((function(e){return e.idleEnd()}))))}},{key:"updateBudget",value:function(e){this._test.usedBudget=0,++this._frameNumber;var t=x,n=e.frameDuration,i=C;switch(this.state){case y.IDLE:t=(0,u.aj)(0),n=(0,u.aj)(Math.max(I,e.frameDuration)),i=T;break;case y.INTERACTING:n=(0,u.aj)(Math.max(P,e.frameDuration))}return n=(0,u.aj)(n-e.elapsedFrameTime-t),this.state!==y.IDLE&&n<C&&!this._forceTask?(this._forceTask=!0,!1):(n=(0,u.aj)(Math.max(n,i)),this._budget.reset(n,this.state),this._maxReschedule=32,this._updateLoad(),this._schedule())}},{key:"frame",value:function(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case y.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((function(e){return e.idleBegin()}))),this._runIdle();break;case y.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}},{key:"stopFrame",value:function(){this._budget.reset((0,u.aj)(0),this._state),this._budget.madeProgress()}},{key:"_removeIdleStateCallbacks",value:function(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}},{key:"removeTask",value:function(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e)}},{key:"_updateTask",value:function(e){this._tasks.forAll((function(t){t.name===e&&t.setPriority(e)}))}},{key:"_getState",value:function(e){if(this._runQueue.some((function(t){return t.name===e})))return E.SCHEDULED;var t=E.IDLE;return this._tasks.forAll((function(n){n.name===e&&n.needsUpdate&&(n.schedulePriority<=1?t=E.READY:t!==E.READY&&(t=E.WAITING))})),t}},{key:"_getRuntime",value:function(e){var t=0;return this._tasks.forAll((function(n){n.name===e&&(t+=n.runtime)})),t}},{key:"_resetRuntimes",value:function(){this._tasks.forAll((function(e){return e.runtime=0}))}},{key:"_getRunning",value:function(){var e=new Map;if(this._tasks.forAll((function(t){t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;var t="";return e.forEach((function(e,n){t+=e>1?" ".concat(e,"x ").concat(n):" ".concat(n)})),t}},{key:"_runIdle",value:function(){this._run()}},{key:"_runInteracting",value:function(){this._run()}},{key:"_runAnimating",value:function(){this._run()}},{key:"_updateLoad",value:function(){var e=this._tasks.reduce((function(e,t){return t.needsUpdate?++e:e}),0);this._load=.9*this._load+e*(1-.9)}},{key:"_schedule",value:function(){var e=this;if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace((function(e){return!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1)})),this._tasks.forAll((function(t){0===t.basePriority&&t.needsUpdate&&!e._runQueue.includes(t)&&e._runQueue.unshift(t)}));0===this._runQueue.length;){var t=!1;if(this._tasks.forAll((function(n){!n.needsUpdate||0===n.schedulePriority||0===n.basePriority||n.task.runOncePerFrame&&n.lastFrameRun===e._frameNumber||(t=!0,1===n.schedulePriority?(n.schedulePriority=0,e._runQueue.push(n)):--n.schedulePriority)})),!t)return this._updating.set(!1),!1;--this._maxReschedule}return this._updating.set(!0),!0}},{key:"_run",value:function(){var e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){var t=this._budget.now(),n=this._runQueue.pop();this._budget.resetProgress();try{n.task.runTask(this._budget)}catch(r){u.a.getLogger("esri.views.support.Scheduler").error('Exception in task "'.concat(n.name,'"'),r)}n.schedulePriority=n.basePriority,n.lastFrameRun=this._frameNumber;var i=this._budget.now()-t;if(n.runtime+=i,this._frameTaskTimes.set(n.priority,this._frameTaskTimes.get(n.priority)+i),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",n.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updating.set(this._tasks.some((function(e){return e.needsUpdate}))),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updating.set(this._tasks.some((function(e){return e.needsUpdate}))),this._recordFrameTaskTimes(this._budget.now()-e)}},{key:"_startFrameTaskTimes",value:function(){for(var e=0,t=Object.keys(g);e<t.length;e++){var n=t[e];this._frameTaskTimes.set(g[n],0)}}},{key:"_recordFrameTaskTimes",value:function(e){var t=this;this._frameTaskTimes.forEach((function(e,n){return t.performanceInfo.tasks.get(n).record(e)})),this.performanceInfo.total.record(e)}},{key:"test",get:function(){return this._test}}]),e}();e.Scheduler=t;var n=function(){function e(t,n,i,r){var o=this;(0,a.Z)(this,e),this._scheduler=t,this.name=n,this._basePriority=r,this.lastFrameRun=0,this.runtime=0,this._queue=new p,this._handles=new u.X,this.schedulePriority=this._basePriority,this._task=new h((0,l.r)(i)?i:this._queue),this._handles.add((0,c.f)((function(){return o.task.running}),(function(){return t.activate()})))}return(0,s.Z)(e,[{key:"task",get:function(){return this._task.get()}},{key:"updating",get:function(){return this._queue.running}},{key:"remove",value:function(){this.processQueue(Z),this._scheduler.removeTask(this),this.schedule=S.schedule,this.reschedule=S.reschedule,this._handles.destroy()}},{key:"basePriority",get:function(){return this._basePriority}},{key:"setPriority",value:function(e){this.name=e;var t=b(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}},{key:"priority",get:function(){return this.name},set:function(e){this.setPriority(e)}},{key:"needsUpdate",get:function(){return this.updating||this.task.running}},{key:"schedule",value:function(e,t,n){return this._queue.push(e,t,n)}},{key:"reschedule",value:function(e,t,n){return this._queue.unshift(e,t,n)}},{key:"processQueue",value:function(e){this._queue.runTask(e)}}]),e}(),i=function(){function e(){(0,a.Z)(this,e),this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=y.IDLE,this._done=!1,this._enabled=!0}return(0,s.Z)(e,[{key:"run",value:function(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}},{key:"done",get:function(){return this._done}},{key:"budget",get:function(){return this._budget}},{key:"madeProgress",value:function(){this._done=this.elapsed>=this._budget&&this._enabled}},{key:"state",get:function(){return this._state}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"reset",value:function(e,t){this._begin=this.now(),this._budget=e,this._state=t,this._done=!1}},{key:"remaining",get:function(){return Math.max(this._budget-this.elapsed,0)}},{key:"now",value:function(){return performance.now()}},{key:"elapsed",get:function(){return performance.now()-this._begin}},{key:"resetProgress",value:function(){this._done=!1}},{key:"hasProgressed",get:function(){return this._done}}]),e}();e.Budget=i}(M||(M={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(E||(E={}));var Z=function(){var e=new M.Budget;return e.enabled=!1,e}(),A=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,[{key:"remove",value:function(){}},{key:"processQueue",value:function(){}},{key:"schedule",value:function(e,t,n){try{if((0,u.p)(t)){var i=(0,u.d)();return n?Promise.resolve(n(i)):Promise.reject(i)}return(0,u.ao)(e(Z))}catch(v){return Promise.reject(v)}}},{key:"reschedule",value:function(e,t,n){return this.schedule(e,t,n)}}]),e}(),S=new A},3356:function(e,t,n){n.d(t,{j:function(){return b},p:function(){return _}});var i,r=n(1413),o=n(15671),a=n(43144),s=n(60136),u=n(29388),l=n(48848),c=n(40558),d=n(40114),h=n(93661),p=n(47855),v=n(82474),f=n(25456),y=n(36040),g=i=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).cols=null,i.level=0,i.levelValue=null,i.origin=null,i.resolution=0,i.rows=null,i.scale=0,i}return(0,a.Z)(n,[{key:"clone",value:function(){return new i({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}}]),n}(d.l);(0,l.e)([(0,l.y)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],g.prototype,"cols",void 0),(0,l.e)([(0,l.y)({type:l.T,json:{write:!0}})],g.prototype,"level",void 0),(0,l.e)([(0,l.y)({type:String,json:{write:!0}})],g.prototype,"levelValue",void 0),(0,l.e)([(0,l.y)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],g.prototype,"origin",void 0),(0,l.e)([(0,l.y)({type:Number,json:{write:!0}})],g.prototype,"resolution",void 0),(0,l.e)([(0,l.y)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],g.prototype,"rows",void 0),(0,l.e)([(0,l.y)({type:Number,json:{write:!0}})],g.prototype,"scale",void 0);var m,_=g=i=(0,l.e)([(0,l.n)("esri.layers.support.LOD")],g),w=new c.s({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"}),k=m=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).dpi=96,i.format=null,i.origin=null,i.minScale=0,i.maxScale=0,i.size=null,i.spatialReference=null,i}return(0,a.Z)(n,[{key:"isWrappable",get:function(){var e=this.spatialReference,t=this.origin;if(e&&t){var n=(0,v.a)(e);return e.isWrappable&&!!n&&Math.abs(n.origin[0]-t.x)<=n.dx}return!1}},{key:"readOrigin",value:function(e,t){return v.w.fromJSON((0,r.Z)({spatialReference:t.spatialReference},e))}},{key:"lods",set:function(e){var t=0,n=0,i=[],r=this._levelToLOD={};e&&(t=-1/0,n=1/0,e.forEach((function(e){i.push(e.scale),t=e.scale>t?e.scale:t,n=e.scale<n?e.scale:n,r[e.level]=e}))),this._set("scales",i),this._set("minScale",t),this._set("maxScale",n),this._set("lods",e),this._initializeUpsampleLevels()}},{key:"readSize",value:function(e,t){return[t.cols,t.rows]}},{key:"writeSize",value:function(e,t){t.cols=e[0],t.rows=e[1]}},{key:"zoomToScale",value:function(e){var t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];var n=Math.floor(e),i=n+1;return t[n]/Math.pow(t[n]/t[i],e-n)}},{key:"scaleToZoom",value:function(e){for(var t=this.scales,n=t.length-1,i=0;i<n;i++){var r=t[i],o=t[i+1];if(r<=e)return i;if(o===e)return i+1;if(r>e&&o<e)return i+Math.log(r/e)/Math.log(r/o)}return i}},{key:"snapScale",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=this.scaleToZoom(e);return n%Math.floor(n)>=t?this.zoomToScale(Math.ceil(n)):this.zoomToScale(Math.floor(n))}},{key:"tileAt",value:function(e,t,n,i){var r,o,a=this.lodAt(e);if(!a)return null;if("number"==typeof t)r=t,o=n;else if((0,v.E)(t.spatialReference,this.spatialReference))r=t.x,o=t.y,i=n;else{var s=(0,v.M)(t,this.spatialReference);if((0,h.t)(s))return null;r=s.x,o=s.y,i=n}var u=a.resolution*this.size[0],l=a.resolution*this.size[1];return i||(i=new y.t(null,0,0,0,(0,f.u)())),i.level=e,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((r-this.origin.x)/u+.001),this.updateTileInfo(i),i}},{key:"updateTileInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.ExtrapolateOptions.NONE,n=this.lodAt(e.level);if(!n&&t===m.ExtrapolateOptions.POWER_OF_TWO){var i=this.lods[this.lods.length-1];i.level<e.level&&(n=i)}if(n){var r=e.level-n.level,o=n.resolution*this.size[0]/Math.pow(2,r),a=n.resolution*this.size[1]/Math.pow(2,r);e.id="".concat(e.level,"/").concat(e.row,"/").concat(e.col),e.extent||(e.extent=(0,f.u)()),e.extent[0]=this.origin.x+e.col*o,e.extent[1]=this.origin.y-(e.row+1)*a,e.extent[2]=e.extent[0]+o,e.extent[3]=e.extent[1]+a}}},{key:"upsampleTile",value:function(e){var t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}},{key:"getTileBounds",value:function(e,t){var n=this.lodAt(t.level);if(null==n)return null;var i=n.resolution,r=i*this.size[0],o=i*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*o,e[2]=e[0]+r,e[3]=e[1]+o,e}},{key:"lodAt",value:function(e){var t,n;return null!==(t=null===(n=this._levelToLOD)||void 0===n?void 0:n[e])&&void 0!==t?t:null}},{key:"clone",value:function(){return m.fromJSON(this.write({}))}},{key:"getOrCreateCompatible",value:function(e,t){if(256===this.size[0]&&256===this.size[1])return 256===e?this:null;for(var n=[],i=this.lods.length,r=0;r<i;r++){var o=this.lods[r],a=o.resolution*t;n.push(new _({level:o.level,scale:o.scale,resolution:a}))}return new m({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:n})}},{key:"_initializeUpsampleLevels",value:function(){var e=this.lods;this._upsampleLevels=[];for(var t=null,n=0;n<e.length;n++){var i=e[n];this._upsampleLevels[i.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/i.resolution:0},t=i}}}],[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.resolutionFactor,n=void 0===t?1:t,i=e.scales,r=e.size,o=void 0===r?256:r,a=e.spatialReference,s=void 0===a?v.k.WebMercator:a,u=e.numLODs,l=void 0===u?24:u;if(!(0,v.I)(s)){var c=[];if(i)for(var d=0;d<i.length;d++){var h=i[d];c.push({level:d,scale:h,resolution:h})}else for(var f=5e-4,y=l-1;y>=0;y--)c.unshift({level:y,scale:f,resolution:f}),f*=2;return new m({dpi:96,lods:c,origin:new v.w(0,0,s),size:[o,o],spatialReference:s})}var g=(0,v.a)(s),_=e.origin?new v.w({x:e.origin.x,y:e.origin.y,spatialReference:s}):new v.w(g?{x:g.origin[0],y:g.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),w=96,k=1/(39.37*(0,p.$)(s)*w),b=[];if(i)for(var M=0;M<i.length;M++){var E=i[M],x=E*k;b.push({level:M,scale:E,resolution:x})}else{var C=(0,v.h)(s)?512/o*591657527.5917094:256/o*591657527.591555,T=Math.ceil(l/n);b.push({level:0,scale:C,resolution:C*k});for(var P=1;P<T;P++){var I=C/Math.pow(2,n),Z=I*k;b.push({level:P,scale:I,resolution:Z}),C=I}}return new m({dpi:w,lods:b,origin:_,size:[o,o],spatialReference:s})}}]),n}(d.l);(0,l.e)([(0,l.y)({type:Number,json:{write:!0}})],k.prototype,"compressionQuality",void 0),(0,l.e)([(0,l.y)({type:Number,json:{write:!0}})],k.prototype,"dpi",void 0),(0,l.e)([(0,l.y)({type:String,json:{read:w.read,write:w.write,origins:{"web-scene":{read:!1,write:!1}}}})],k.prototype,"format",void 0),(0,l.e)([(0,l.y)({readOnly:!0})],k.prototype,"isWrappable",null),(0,l.e)([(0,l.y)({type:v.w,json:{write:!0}})],k.prototype,"origin",void 0),(0,l.e)([(0,v.o)("origin")],k.prototype,"readOrigin",null),(0,l.e)([(0,l.y)({type:[_],value:null,json:{write:!0}})],k.prototype,"lods",null),(0,l.e)([(0,l.y)({readOnly:!0})],k.prototype,"minScale",void 0),(0,l.e)([(0,l.y)({readOnly:!0})],k.prototype,"maxScale",void 0),(0,l.e)([(0,l.y)({readOnly:!0})],k.prototype,"scales",void 0),(0,l.e)([(0,l.y)({cast:function(e){return Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]}})],k.prototype,"size",void 0),(0,l.e)([(0,v.o)("size",["rows","cols"])],k.prototype,"readSize",null),(0,l.e)([(0,v.r)("size",{cols:{type:l.T},rows:{type:l.T}})],k.prototype,"writeSize",null),(0,l.e)([(0,l.y)({type:v.k,json:{write:!0}})],k.prototype,"spatialReference",void 0),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}((k=m=(0,l.e)([(0,l.n)("esri.layers.support.TileInfo")],k))||(k={}));var b=k},36040:function(e,t,n){n.d(t,{t:function(){return o}});var i=n(43144),r=n(15671),o=(0,i.Z)((function e(t,n,i,o,a){(0,r.Z)(this,e),this.id=t,this.level=n,this.row=i,this.col=o,this.extent=a}))},51732:function(e,t,n){n.d(t,{e:function(){return s}});var i=n(29439),r=n(15671),o=n(43144),a=n(48848),s=function(){function e(t,n,i,o){(0,r.Z)(this,e),this.set(t,n,i,o)}return(0,o.Z)(e,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(e){this.set(e)}},{key:"hash",get:function(){var e=4095&this.row,t=4095&this.col,n=63&this.level;return(3&this.world)<<30|t<<22|e<<8|n}},{key:"acquire",value:function(e,t,n,i){this.set(e,t,n,i)}},{key:"contains",value:function(e){var t=e.level-this.level;return t>=0&&this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}},{key:"equals",value:function(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}},{key:"clone",value:function(){return new e(this)}},{key:"release",value:function(){this.level=0,this.row=0,this.col=0,this.world=0}},{key:"set",value:function(e,t,n,r){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){var o=e.split("/"),a=(0,i.Z)(o,4),s=a[0],u=a[1],l=a[2],c=a[3];this.level=parseFloat(s),this.row=parseFloat(u),this.col=parseFloat(l),this.world=parseFloat(c)}else this.level=+e,this.row=+t,this.col=+n,this.world=+r||0;return this}},{key:"toString",value:function(){return"".concat(this.level,"/").concat(this.row,"/").concat(this.col,"/").concat(this.world)}},{key:"getParentKey",value:function(){return this.level<=0?null:new e(this.level-1,this.row>>1,this.col>>1,this.world)}},{key:"getChildKeys",value:function(){var t=this.level+1,n=this.row<<1,i=this.col<<1,r=this.world;return[new e(t,n,i,r),new e(t,n,i+1,r),new e(t,n+1,i,r),new e(t,n+1,i+1,r)]}},{key:"compareRowMajor",value:function(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}}],[{key:"getId",value:function(e,t,n,i){return"object"==typeof e?"".concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.world):"".concat(e,"/").concat(t,"/").concat(n,"/").concat(i)}}]),e}();s.pool=new a.h(s,null,null,25,50)},17455:function(e,t,n){n.d(t,{u:function(){return k},y:function(){return m}});var i=n(15671),r=n(43144),o=n(60136),a=n(29388),s=n(48848),u=n(62610),l=n(1500),c=n(40114),d=n(71802),h=n(93661),p=n(82474),v=n(74384),f=n(56162),y=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(){var e;(0,i.Z)(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return(e=t.call.apply(t,[this].concat(o))).position=new p.w([0,0,0]),e.heading=0,e.tilt=0,e.fov=55,e}return(0,r.Z)(n,[{key:"normalizeCtorArgs",value:function(e,t,n,i){if(e&&"object"==typeof e&&("x"in e||Array.isArray(e))){var r={position:e};return null!=t&&(r.heading=t),null!=n&&(r.tilt=n),null!=i&&(r.fov=i),r}return e}},{key:"writePosition",value:function(e,t,n,i){var r=e.clone();r.x=(0,s.g)(e.x||0),r.y=(0,s.g)(e.y||0),r.z=e.hasZ?(0,s.g)(e.z||0):e.z,t[n]=r.write({},i)}},{key:"readPosition",value:function(e,t){var n=new p.w;return n.read(e,t),n.x=(0,s.g)(n.x||0),n.y=(0,s.g)(n.y||0),n.z=n.hasZ?(0,s.g)(n.z||0):n.z,n}},{key:"equals",value:function(e){return!(0,h.t)(e)&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}}]),n}((0,u.i)(c.l));(0,s.e)([(0,s.y)({type:p.w,json:{write:{isRequired:!0}}})],y.prototype,"position",void 0),(0,s.e)([(0,p.r)("position")],y.prototype,"writePosition",null),(0,s.e)([(0,p.o)("position")],y.prototype,"readPosition",null),(0,s.e)([(0,s.y)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,s.c)((function(e){return l.s.normalize((0,s.g)(e))}))],y.prototype,"heading",void 0),(0,s.e)([(0,s.y)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,s.c)((function(e){return(0,d.a)((0,s.g)(e),-180,180)}))],y.prototype,"tilt",void 0),(0,s.e)([(0,s.y)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],y.prototype,"fov",void 0);var g,m=y=(0,s.e)([(0,s.n)("esri.Camera")],y),_=g=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).rotation=0,r.scale=0,r.targetGeometry=null,r.camera=null,r}return(0,r.Z)(n,[{key:"castRotation",value:function(e){return(e%=360)<0&&(e+=360),e}},{key:"clone",value:function(){return new g({rotation:this.rotation,scale:this.scale,targetGeometry:(0,h.r)(this.targetGeometry)?this.targetGeometry.clone():null,camera:(0,h.r)(this.camera)?this.camera.clone():null})}}]),n}(c.l);function w(){return{enabled:!this.camera}}(0,s.e)([(0,s.y)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:w}}}}})],_.prototype,"rotation",void 0),(0,s.e)([(0,s.c)("rotation")],_.prototype,"castRotation",null),(0,s.e)([(0,s.y)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:w}}}}})],_.prototype,"scale",void 0),(0,s.e)([(0,s.y)({types:v.i,json:{read:f.v,write:!0,origins:{"web-scene":{read:f.v,write:{overridePolicy:w}}}}})],_.prototype,"targetGeometry",void 0),(0,s.e)([(0,s.y)({type:m,json:{write:!0}})],_.prototype,"camera",void 0);var k=_=g=(0,s.e)([(0,s.n)("esri.Viewpoint")],_)},3719:function(e,t,n){n.d(t,{t:function(){return r}});var i=n(42467);function r(){return function(e,t){if(!e[t])throw new TypeError("Cannot auto bind undefined function '".concat(t,"'"));return{value:a(e[t])}}}function o(e){var t=e.type;return e instanceof KeyboardEvent||"keyup"===t||"keydown"===t||"keypress"===t}function a(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];o(t)?(0,i.k)(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call.apply(e,[this,t].concat(r))}}},50253:function(e,t,n){n.d(t,{l:function(){return d}});var i,r,o=n(60136),a=n(29388),s=n(43144),u=n(15671),l=n(93661),c=n(27205);function d(e){for(var t=(0,c.n)(e);t.length>1;){var n=h(t.shift());if(n.available)return n}return h(t.shift())}function h(e){switch(e){case c.r.WEBGL1:return i||(i=function(){var e=new v,t=y(c.r.WEBGL1,e);return(0,l.t)(t)||(e.supportsElementIndexUint=null!==t.getExtension("OES_element_index_uint"),e.supportsStandardDerivatives=null!==t.getExtension("OES_standard_derivatives"),e.supportsInstancedArrays=null!==t.getExtension("ANGLE_instanced_arrays"),e.supportsTextureFloat=null!==t.getExtension("OES_texture_float"),e.supportsTextureHalfFloat=null!==t.getExtension("OES_texture_half_float"),e.supportsColorBufferFloat=null!==t.getExtension("WEBGL_color_buffer_float"),e.supportsColorBufferFloatBlend=null!==t.getExtension("EXT_float_blend"),e.supportsColorBufferHalfFloat=null!==t.getExtension("EXT_color_buffer_half_float")),e}()),i;case c.r.WEBGL2:return r||(r=function(){var e=new f,t=y(c.r.WEBGL2,e);return(0,l.t)(t)||(e.supportsColorBufferFloat=null!==t.getExtension("EXT_color_buffer_float"),e.supportsColorBufferFloatBlend=null!==t.getExtension("EXT_float_blend"),e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||null!==t.getExtension("EXT_color_buffer_half_float")),e}()),r}}var p=(0,s.Z)((function e(){(0,u.Z)(this,e),this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1})),v=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(){var e;return(0,u.Z)(this,n),(e=t.apply(this,arguments)).type=c.r.WEBGL1,e}return(0,s.Z)(n)}(p),f=function(e){(0,o.Z)(n,e);var t=(0,a.Z)(n);function n(){var e;return(0,u.Z)(this,n),(e=t.apply(this,arguments)).type=c.r.WEBGL2,e.supportsElementIndexUint=!0,e.supportsStandardDerivatives=!0,e.supportsInstancedArrays=!0,e.supportsTextureFloat=!0,e.supportsTextureHalfFloat=!0,e}return(0,s.Z)(n)}(p);function y(e,t){if(e===c.r.WEBGL1&&"undefined"==typeof WebGLRenderingContext||e===c.r.WEBGL2&&"undefined"==typeof WebGL2RenderingContext)return null;var n=document.createElement("canvas");if(!n)return null;var i=(0,c.c)(n,e,{failIfMajorPerformanceCaveat:!0});if((0,l.t)(i)&&(i=(0,c.c)(n,e),(0,l.r)(i)&&(t.majorPerformanceCaveat=!0)),(0,l.t)(i))return i;if(e===c.r.WEBGL1){var r,o=null===(r=i.getParameter(i.VERSION))||void 0===r?void 0:r.match(/^WebGL\s+([\d.]*)/);if(o){var a=parseFloat(o[1]);t.available=a>=.94}}else t.available=!0;t.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),i}},27205:function(e,t,n){n.d(t,{c:function(){return l},n:function(){return s},o:function(){return a},r:function(){return i}});var i,r,o=n(93661);function a(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=s(e);i.length>1;){var r=l(t,i.shift(),n);if((0,o.r)(r))return r}return u(t,i.shift(),n)}function s(e){var t=(0,o.h)("esri-force-webgl");if(t===i.WEBGL1||t===i.WEBGL2)return[t];switch(e){case"2d":return(0,o.h)("mac")&&(0,o.h)("chrome")?[i.WEBGL1,i.WEBGL2]:[i.WEBGL2,i.WEBGL1];case"3d":return[i.WEBGL2,i.WEBGL1]}}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!window.WebGLRenderingContext)return c(e,d),null;var i=l(e,t,n);return(0,o.t)(i)&&c(e,h),i}function l(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t===i.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"],o=null,a=0,s=r;a<s.length;a++){var u=s[a];try{o=e.getContext(u,n)}catch(l){}if(o)break}return o}function c(e,t){var n=e.parentNode;n&&(n.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(r=i||(i={}))[r.WEBGL1=1]="WEBGL1",r[r.WEBGL2=2]="WEBGL2";var d='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',h='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'},70522:function(e,t,n){n.d(t,{g:function(){return g},h:function(){return p},o:function(){return c},r:function(){return l}});var i,r,o=n(93661),a=n(48848),s=n(82396),u=n(1685);function l(e,t){if(!e)return null;if(!h(e))return new a.s("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:e});var n=e.heightUnit,i=s.v.deriveUnitFromSR(e,t).heightUnit;return n!==i?new a.s("webscene:incompatible-height-unit","The vertical units of the scene (".concat(n,") must match the horizontal units of the scene (").concat(i,")"),{verticalUnit:n,horizontalUnit:i}):null}function c(e,t,n){var r,o=p(e),u=t,l=d(o,u,n);if(o){var c=s.v.deriveUnitFromSR(o,e.spatialReference).heightUnit;if(!n&&c!==o.heightUnit){var h=new a.s("layerview:unmatched-height-unit","The vertical units of the layer must match the horizontal units (".concat(c,")"),{horizontalUnit:c});return new a.s("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:o,error:h})}}if(!("heightModelInfo"in(r=e)&&null!=r.heightModelInfo||null!=r.spatialReference)&&y(r)||l===i.Unsupported)return new a.s("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:o});switch(l){case i.Units:var v=(null===o||void 0===o?void 0:o.heightUnit)||"unknown",f=(null===u||void 0===u?void 0:u.heightUnit)||"unknown",g=new a.s("layerview:incompatible-height-unit","The vertical units of the layer (".concat(v,") must match the vertical units of the scene (").concat(f,")"),{layerUnit:v,sceneUnit:f});return new a.s("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:o,sceneHeightModelInfo:u,error:g});case i.HeightModel:var m=(null===o||void 0===o?void 0:o.heightModel)||"unknown",_=(null===u||void 0===u?void 0:u.heightModel)||"unknown",w=new a.s("layerview:incompatible-height-model","The height model of the layer (".concat(m,") must match the height model of the scene (").concat(_,")"),{layerHeightModel:m,sceneHeightModel:_});return new a.s("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:o,sceneHeightModelInfo:u,error:w});case i.CRS:var k=(null===o||void 0===o?void 0:o.vertCRS)||"unknown",b=(null===u||void 0===u?void 0:u.vertCRS)||"unknown",M=new a.s("layerview:incompatible-vertical-datum","The vertical datum of the layer (".concat(k,") must match the vertical datum of the scene (").concat(b,")"),{layerDatum:k,sceneDatum:b});return new a.s("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:o,sceneHeightModelInfo:u,error:M})}return null}function d(e,t,n){if(!h(e)||!h(t))return i.Unsupported;if(null==e||null==t)return i.Ok;if(!n&&e.heightUnit!==t.heightUnit)return i.Units;if(e.heightModel!==t.heightModel)return i.HeightModel;switch(e.heightModel){case"gravity-related-height":return i.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?i.Ok:i.CRS;default:return i.Unsupported}}function h(e){return null==e||null!=e.heightModel&&null!=e.heightUnit}function p(e){var t,n=e.url?(0,u.m)(e.url):void 0;return null==(null===(t=e.spatialReference)||void 0===t?void 0:t.vcsWkid)&&(0,o.r)(n)&&"ImageServer"===n.serverType||!v(e)||!e.heightModelInfo?y(e)?s.v.deriveUnitFromSR(_,e.spatialReference):null:e.heightModelInfo}function v(e){return"heightModelInfo"in e}function f(e){if("unknown"===e.type||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":return!0;default:return!1}}function y(e){return f(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):m(e)}function g(e){return null!=e.layers||m(e)||f(e)||v(e)}function m(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(r=i||(i={}))[r.Ok=0]="Ok",r[r.Units=1]="Units",r[r.HeightModel=2]="HeightModel",r[r.CRS=3]="CRS",r[r.Unsupported=4]="Unsupported";var _=new s.v({heightModel:"gravity-related-height"})},43066:function(e,t,n){function i(){var e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function r(e){var t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function o(e,t,n,i,r,o,a,s,u){var l=new Float32Array(9);return l[0]=e,l[1]=t,l[2]=n,l[3]=i,l[4]=r,l[5]=o,l[6]=a,l[7]=s,l[8]=u,l}n.d(t,{e:function(){return i},r:function(){return r},t:function(){return o}}),Object.freeze(Object.defineProperty({__proto__:null,create:i,clone:r,fromValues:o,createView:function(e,t){return new Float32Array(e,t,9)}},Symbol.toStringTag,{value:"Module"}))},29048:function(e,t,n){n.d(t,{A:function(){return w},C:function(){return P},E:function(){return E},H:function(){return A},L:function(){return M},_:function(){return k},a:function(){return r},b:function(){return p},d:function(){return d},g:function(){return y},j:function(){return m},k:function(){return x},l:function(){return c},m:function(){return h},o:function(){return s},p:function(){return f},q:function(){return v},r:function(){return o},s:function(){return a},v:function(){return g},w:function(){return C},y:function(){return _},z:function(){return b}});var i=n(71802);function r(e,t){return e[0]=t[0],e[1]=t[1],e}function o(e,t,n){return e[0]=t,e[1]=n,e}function a(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function s(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function u(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function l(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function c(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function d(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e}function h(e,t){var n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)}function p(e,t){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}function v(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}function f(e){var t=e[0],n=e[1];return t*t+n*n}function y(e,t){return e[0]=-t[0],e[1]=-t[1],e}function g(e,t){var n=t[0],i=t[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r),e}function m(e,t){return e[0]*t[0]+e[1]*t[1]}function _(e,t,n){var i=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=i,e}function w(e,t,n,i){var r=t[0],o=t[1];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e}function k(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e}function b(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r+n[4],e[1]=n[1]*i+n[3]*r+n[5],e}function M(e,t,n,i){var r=t[0]-n[0],o=t[1]-n[1],a=Math.sin(i),s=Math.cos(i);return e[0]=r*s-o*a+n[0],e[1]=r*a+o*s+n[1],e}function E(e,t){return e[0]===t[0]&&e[1]===t[1]}function x(e,t){var n=e[0],r=e[1],o=t[0],a=t[1],s=(0,i.d)();return Math.abs(n-o)<=s*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=s*Math.max(1,Math.abs(r),Math.abs(a))}function C(e,t,n,i,r){var o=t[0]-n[0],a=t[1]-n[1],s=(i[0]*o+i[1]*a)*(r-1);return o=i[0]*s,a=i[1]*s,e[0]=t[0]+o,e[1]=t[1]+a,e}var T=v,P=s,I=u,Z=l,A=h,S=p,R=f;Object.freeze(Object.defineProperty({__proto__:null,copy:r,set:o,add:a,subtract:s,multiply:u,divide:l,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:c,scaleAndAdd:d,distance:h,squaredDistance:p,length:v,squaredLength:f,negate:y,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:g,dot:m,cross:_,lerp:w,random:function(e,t){t=t||1;var n=2*(0,i.h)()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},transformMat2:k,transformMat2d:b,transformMat3:function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[3]*r+n[6],e[1]=n[1]*i+n[4]*r+n[7],e},transformMat4:function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e},rotate:M,angle:function(e,t){var n=e[0],i=e[1],r=t[0],o=t[1],a=n*n+i*i;a>0&&(a=1/Math.sqrt(a));var s=r*r+o*o;s>0&&(s=1/Math.sqrt(s));var u=(n*r+i*o)*a*s;return u>1?0:u<-1?Math.PI:Math.acos(u)},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:E,equals:x,projectAndScale:C,len:T,sub:P,mul:I,div:Z,dist:A,sqrDist:S,sqrLen:R},Symbol.toStringTag,{value:"Module"}))},68136:function(e,t,n){function i(){return new Float32Array(2)}function r(e,t){var n=new Float32Array(2);return n[0]=e,n[1]=t,n}function o(){return i()}function a(){return r(1,1)}function s(){return r(1,0)}function u(){return r(0,1)}n.d(t,{c:function(){return l},i:function(){return c},n:function(){return i},t:function(){return r}});var l=o(),c=a(),d=s(),h=u();Object.freeze(Object.defineProperty({__proto__:null,create:i,clone:function(e){var t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t},fromValues:r,createView:function(e,t){return new Float32Array(e,t,2)},zeros:o,ones:a,unitX:s,unitY:u,ZEROS:l,ONES:c,UNIT_X:d,UNIT_Y:h},Symbol.toStringTag,{value:"Module"}))},60530:function(e,t,n){n.d(t,{e:function(){return r}});var i=n(93433);function r(e){return function(t){t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);var n=t._delegatedEventNames,r=Array.isArray(e)?e:function(e){return e.split(",").map((function(e){return e.trim()}))}(e);n.push.apply(n,(0,i.Z)(r))}}}}]);
//# sourceMappingURL=2317.8aa725d5.chunk.js.map