"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[478],{61490:function(e,t,r){r.d(t,{A:function(){return k}});var n=r(37762),i=r(74165),a=r(15861),u=r(93433),l=r(15671),o=r(43144),s=r(11752),d=r(61120),f=r(60136),c=r(29388),p=r(50165),y=r(39853),h=r(73627),v=r(63334),m=r(56389),g=r(4483),b=r(42814),w=r(53089),x=r(33117),F=p.s.getLogger("esri.views.layers.FeatureLayerView"),k=function(e){var t=function(e){(0,f.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;(0,l.Z)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i)))._updatingRequiredFieldsPromise=null,e.filter=null,e.timeExtent=null,e.layer=null,e.requiredFields=[],e.view=null,e}return(0,o.Z)(r,[{key:"initialize",value:function(){var e=this;this.handles.add([(0,h.l)((function(){var t,r=e.layer;return[null===r||void 0===r||null===(t=r.elevationInfo)||void 0===t?void 0:t.featureExpressionInfo,null===r||void 0===r?void 0:r.displayField,null===r||void 0===r?void 0:r.timeInfo,r&&"renderer"in r&&r.renderer,r&&"labelingInfo"in r&&r.labelingInfo,r&&"floorInfo"in r&&r.floorInfo,e.filter,e.featureEffect,e.timeExtent]}),(function(){return e._handleRequiredFieldsChange()}),h.w),(0,h.a)((function(){var t;return null===(t=e.view)||void 0===t?void 0:t.floors}),"change",(function(){return e._handleRequiredFieldsChange()})),(0,h.a)((function(){var t=e.layer;return t&&"sublayers"in t&&t.sublayers}),"change",(function(){return e._handleRequiredFieldsChange()}))])}},{key:"availableFields",get:function(){var e=this.layer,t=this.layer.fieldsIndex,r=this.requiredFields;return"outFields"in e&&e.outFields?(0,g.y)(t,[].concat((0,u.Z)((0,g.I)(t,e.outFields)),(0,u.Z)(r))):(0,g.y)(t,r)}},{key:"effect",get:function(){return(0,y.r)(F,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect},set:function(e){(0,y.r)(F,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect=e}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(e){void 0!==e?this._override("featureEffect",e):this._clearOverride("featureEffect")}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(e){F.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"highlight",value:function(e){throw new Error("missing implementation")}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=(0,p.r)(this.filter)?this.filter.createQuery(e):new w.b(e);if("feature"===this.layer.type){var r=(0,b.o)(this);(0,p.r)(r)&&(t.where=t.where?"(".concat(t.where,") AND (").concat(r,")"):r)}return(0,p.r)(this.timeExtent)&&(t.timeExtent=(0,p.r)(t.timeExtent)?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}},{key:"queryFeatures",value:function(e,t){throw new Error("missing implementation")}},{key:"queryObjectIds",value:function(e,t){throw new Error("missing implementation")}},{key:"queryFeatureCount",value:function(e,t){throw new Error("missing implementation")}},{key:"queryExtent",value:function(e,t){throw new Error("missing implementation")}},{key:"fetchPopupFeatures",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.validateFetchPopupFeatures(r))){e.next=3;break}throw n;case 3:return e.abrupt("return",this.fetchClientPopupFeatures(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_loadArcadeModules",value:function(e){if(e.get("expressionInfos.length")||Array.isArray(e.content)&&e.content.some((function(e){return"expression"===e.type})))return(0,g.a)()}},{key:"_handleRequiredFieldsChange",value:function(){var e=this,t=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",t),t.then((function(){e._updatingRequiredFieldsPromise===t&&e._set("_updatingRequiredFieldsPromise",null)}))}},{key:"_updateRequiredFields",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t,r,a,u,l,o,s,d,f,c,y,h,v,m,b;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layer&&this.view){e.next=2;break}return e.abrupt("return");case 2:return t="3d"===this.view.type,r=this.layer,a=this.layer,u=a.fieldsIndex,l=a.objectIdField,o="renderer"in r&&r.renderer,s="orderBy"in r&&r.orderBy,d=r.featureReduction,f=new Set,e.next=13,(0,p.E)([o?o.collectRequiredFields(f,u):null,(0,g.l)(f,r),t?(0,g.A)(f,r):null,(0,p.r)(this.filter)?(0,g.V)(f,r,this.filter):null,(0,p.r)(this.featureEffect)?(0,g.V)(f,r,this.featureEffect.filter):null,d?(0,g.N)(f,r,d):null,s?(0,g._)(f,r,s):null]);case 13:if(c=e.sent,r.timeInfo&&this.timeExtent&&(0,g.g)(f,r.fieldsIndex,[r.timeInfo.startField,r.timeInfo.endField]),"feature"===r.type&&r.floorInfo&&(0,g.g)(f,r.fieldsIndex,[r.floorInfo.floorField]),"subtype-group"!==r.type){e.next=19;break}return(0,g.F)(f,u,r.subtypeField),y=r.sublayers.map((function(e){var t;return Promise.all([null===(t=e.renderer)||void 0===t?void 0:t.collectRequiredFields(f,u),(0,g.l)(f,e)])})),e.next=19,(0,p.E)(y);case 19:h=(0,n.Z)(c);try{for(h.s();!(v=h.n()).done;)(m=v.value).error&&F.error(m.error)}catch(i){h.e(i)}finally{h.f()}(0,g.F)(f,u,l),t&&"displayField"in r&&r.displayField&&(0,g.F)(f,u,r.displayField),b=Array.from(f).sort(),this._set("requiredFields",b);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"validateFetchPopupFeatures",value:function(e){if((0,p.t)(e))return null;var t,r=(0,n.Z)(e.clientGraphics);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=i.layer;if("popupEnabled"in a&&!a.popupEnabled)return new p.a("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:a});if(i.isAggregate){if(!(a.featureReduction&&"popupTemplate"in a.featureReduction&&a.featureReduction.popupEnabled&&a.featureReduction.popupTemplate))return new p.a("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:a})}else if("popupTemplate"in a&&!(0,x.s)(a,e))return new p.a("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:a})}}catch(u){r.e(u)}finally{r.f()}}},{key:"fetchClientPopupFeatures",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,a,u,l,o,s,d,f,c,y,h,v,m,b;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=(0,p.r)(t)?t.clientGraphics:null)&&0!==r.length){e.next=3;break}return e.abrupt("return",[]);case 3:return a=new Array(r.length),u=new Map,e.next=7,this.createPopupQuery(t);case 7:l=e.sent,o=0;case 9:if(!(o<r.length)){e.next=27;break}if(!(s=r[o]).isAggregate){e.next=14;break}return a[o]=s,e.abrupt("continue",24);case 14:if("popupEnabled"in(d=s.layer)){e.next=17;break}return e.abrupt("continue",24);case 17:if(f=(0,g.I)(this.layer.fieldsIndex,l.outFields),c=(0,x.s)(d,t),!(0,p.t)(c)){e.next=20;break}return e.abrupt("continue",24);case 20:return e.next=22,this._loadArcadeModules(c);case 22:(y=e.sent)&&y.arcadeUtils.hasGeometryOperations(c)||!(0,g.e)(f,s)?u.set(s.getObjectId(),o):a[o]=s;case 24:o++,e.next=9;break;case 27:if("stream"!==this.layer.type&&0!==u.size){e.next=29;break}return e.abrupt("return",a.filter(Boolean));case 29:return l.objectIds=Array.from(u.keys()),e.prev=30,e.next=33,this.layer.queryFeatures(l);case 33:h=e.sent,v=(0,n.Z)(h.features);try{for(v.s();!(m=v.n()).done;)b=m.value,a[u.get(b.getObjectId())]=b}catch(i){v.e(i)}finally{v.f()}e.next=40;break;case 38:e.prev=38,e.t0=e.catch(30);case 40:return e.abrupt("return",a.filter(Boolean));case 41:case"end":return e.stop()}}),e,this,[[30,38]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createPopupQuery",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,a,u,l,o,s,d,f,c,y,h,v,m,g,w;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this.layer.createQuery(),a=new Set,u=!1,l=(0,p.r)(t)&&t.clientGraphics?t.clientGraphics.map((function(e){return e.layer})):[this.layer],o=(0,n.Z)(l),e.prev=4,o.s();case 6:if((s=o.n()).done){e.next=25;break}if("popupEnabled"in(d=s.value)){e.next=10;break}return e.abrupt("continue",23);case 10:if(f=(0,x.s)(d,t),!(0,p.t)(f)){e.next=13;break}return e.abrupt("continue",23);case 13:return e.next=15,this._loadArcadeModules(f);case 15:return c=e.sent,y=c&&c.arcadeUtils.hasGeometryOperations(f),u=!("point"!==this.layer.geometryType&&!y),e.next=20,(0,x.d)(this.layer,f);case 20:h=e.sent,v=(0,n.Z)(h);try{for(v.s();!(m=v.n()).done;)g=m.value,a.add(g)}catch(i){v.e(i)}finally{v.f()}case 23:e.next=6;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(4),o.e(e.t0);case 30:return e.prev=30,o.f(),e.finish(30);case 33:return r.returnGeometry=u,r.returnZ=u,r.returnM=u,r.outFields=Array.from(a),r.outSpatialReference=this.view.spatialReference,"feature"===this.layer.type&&(w=(0,b.o)(this),(0,p.r)(w)&&(r.where=r.where?"(".concat(r.where,") AND (").concat(w,")"):w)),e.abrupt("return",r);case 35:case"end":return e.stop()}}),e,this,[[4,27,30,33]])})));return function(t){return e.apply(this,arguments)}}()},{key:"canResume",value:function(){return!!(0,s.Z)((0,d.Z)(r.prototype),"canResume",this).call(this)&&(!(0,p.r)(this.timeExtent)||!this.timeExtent.isEmpty)}}]),r}(e);return(0,p.e)([(0,p.d)()],t.prototype,"_updatingRequiredFieldsPromise",void 0),(0,p.e)([(0,p.d)({readOnly:!0})],t.prototype,"availableFields",null),(0,p.e)([(0,p.d)()],t.prototype,"effect",null),(0,p.e)([(0,p.d)({type:m.w})],t.prototype,"featureEffect",null),(0,p.e)([(0,p.d)({type:m.y})],t.prototype,"filter",void 0),(0,p.e)([(0,p.d)(v.g)],t.prototype,"timeExtent",void 0),(0,p.e)([(0,p.d)()],t.prototype,"layer",void 0),(0,p.e)([(0,p.d)({type:Number})],t.prototype,"maximumNumberOfFeatures",null),(0,p.e)([(0,p.d)({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null),(0,p.e)([(0,p.d)({readOnly:!0})],t.prototype,"requiredFields",void 0),(0,p.e)([(0,p.d)()],t.prototype,"suspended",void 0),(0,p.e)([(0,p.d)()],t.prototype,"view",void 0),t=(0,p.e)([(0,p.n)("esri.views.layers.FeatureLayerView")],t),t}},60470:function(e,t,r){r.d(t,{u:function(){return p}});var n=r(15671),i=r(43144),a=r(60136),u=r(29388),l=r(50165),o=r(40133),s=r(22984),d=r(17493),f=r(52155),c=function(e){(0,a.Z)(r,e);var t=(0,u.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).layer=null,i.parent=null,i}return(0,i.Z)(r,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",n=e.layer&&e.layer.title||"no title";l.s.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(n,"', id: '").concat(r,"')"),t)}}))}},{key:"fullOpacity",get:function(){return(0,l.af)(this.get("layer.opacity"),1)*(0,l.af)(this.get("parent.fullOpacity"),1)}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}},{key:"updating",get:function(){var e;return!((null===(e=this.updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"canResume",value:function(){var e,t,r;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(r=this.view)||void 0===r?void 0:r.ready)||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),r}((0,s.a)((0,d.s)((0,f.m)(o.n.EventedMixin(l.y)))));(0,l.e)([(0,l.d)()],c.prototype,"fullOpacity",null),(0,l.e)([(0,l.d)()],c.prototype,"layer",void 0),(0,l.e)([(0,l.d)()],c.prototype,"parent",void 0),(0,l.e)([(0,l.d)({readOnly:!0})],c.prototype,"suspended",null),(0,l.e)([(0,l.d)({readOnly:!0})],c.prototype,"suspendInfo",null),(0,l.e)([(0,l.d)({readOnly:!0})],c.prototype,"legendEnabled",null),(0,l.e)([(0,l.d)({type:Boolean,readOnly:!0})],c.prototype,"updating",null),(0,l.e)([(0,l.d)({readOnly:!0})],c.prototype,"updatingProgress",null),(0,l.e)([(0,l.d)()],c.prototype,"visible",null),(0,l.e)([(0,l.d)()],c.prototype,"view",void 0);var p=c=(0,l.e)([(0,l.n)("esri.views.layers.LayerView")],c)},1894:function(e,t,r){r.d(t,{i:function(){return s}});var n=r(15671),i=r(43144),a=r(60136),u=r(29388),l=r(50165),o=r(73627),s=function(e){var t=function(e){(0,a.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"initialize",value:function(){var e=this;this.handles.add((0,o.a)((function(){return e.layer}),"refresh",(function(t){e.doRefresh(t.dataChanged).catch((function(t){(0,l.I)(t)||l.s.getLogger(e.declaredClass).error(t)}))})),"RefreshableLayerView")}}]),r}(e);return(0,l.e)([(0,l.d)()],t.prototype,"layer",void 0),t=(0,l.e)([(0,l.n)("esri.layers.mixins.RefreshableLayerView")],t)}},42814:function(e,t,r){function n(e){var t,r=e.layer;return"floorInfo"in r&&null!==(t=r.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?a(e.view.floors,r.floorInfo.floorField):null}function i(e,t){var r;return"floorInfo"in t&&null!==(r=t.floorInfo)&&void 0!==r&&r.floorField?a(e,t.floorInfo.floorField):null}function a(e,t){if(null===e||void 0===e||!e.length)return null;var r=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return r.push("''"),"".concat(t," IN (").concat(r.join(","),") OR ").concat(t," IS NULL")}r.d(t,{n:function(){return i},o:function(){return n}})},33117:function(e,t,r){r.d(t,{d:function(){return o},s:function(){return d}});var n=r(74165),i=r(93433),a=r(15861),u=r(50165),l=r(4483);function o(e){return s.apply(this,arguments)}function s(){return s=(0,a.Z)((0,n.Z)().mark((function e(t){var r,a,o,s,d,f,c,p,y,h=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=h.length>1&&void 0!==h[1]?h[1]:t.popupTemplate,!(0,u.t)(r)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,r.getRequiredFields(t.fieldsIndex);case 5:if(a=e.sent,o=r.lastEditInfoEnabled,s=t.objectIdField,d=t.typeIdField,f=t.globalIdField,c=t.relationships,!a.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!o){e.next=19;break}return e.next=16,(0,l.L)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return p=e.t0,y=(0,l.y)(t.fieldsIndex,[].concat((0,i.Z)(a),(0,i.Z)(p))),e.abrupt("return",(d&&y.push(d),y&&s&&t.fieldsIndex.has(s)&&!y.includes(s)&&y.push(s),y&&f&&t.fieldsIndex.has(f)&&!y.includes(f)&&y.push(f),c&&c.forEach((function(e){var r=e.keyField;y&&r&&t.fieldsIndex.has(r)&&!y.includes(r)&&y.push(r)})),y));case 23:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}function d(e,t){return e.popupTemplate?e.popupTemplate:(0,u.r)(t)&&t.defaultPopupTemplateEnabled&&(0,u.r)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=478.d879629f.chunk.js.map