"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[8032],{98057:function(e,t,i){i.d(t,{s:function(){return r},t:function(){return a}});var r,s=i(15671),n=i(43144),a=function(){function e(t,i){(0,s.Z)(this,e),this.x=t,this.y=i}return(0,n.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"equals",value:function(e,t){return e===this.x&&t===this.y}},{key:"isEqual",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"setCoords",value:function(e,t){this.x=e,this.y=t}},{key:"normalize",value:function(){var e=this.x,t=this.y,i=Math.sqrt(e*e+t*t);this.x/=i,this.y/=i}},{key:"rightPerpendicular",value:function(){var e=this.x;this.x=this.y,this.y=-e}},{key:"move",value:function(e,t){this.x+=e,this.y+=t}},{key:"assign",value:function(e){this.x=e.x,this.y=e.y}},{key:"assignAdd",value:function(e,t){this.x=e.x+t.x,this.y=e.y+t.y}},{key:"assignSub",value:function(e,t){this.x=e.x-t.x,this.y=e.y-t.y}},{key:"rotate",value:function(e,t){var i=this.x,r=this.y;this.x=i*e-r*t,this.y=i*t+r*e}},{key:"scale",value:function(e){this.x*=e,this.y*=e}},{key:"length",value:function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}}],[{key:"distance",value:function(e,t){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}},{key:"add",value:function(t,i){return new e(t.x+i.x,t.y+i.y)}},{key:"sub",value:function(t,i){return new e(t.x-i.x,t.y-i.y)}}]),e}();!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(r||(r={}))},98898:function(e,t,i){i.d(t,{c:function(){return C},i:function(){return z},l:function(){return q},o:function(){return D},r:function(){return O}});var r=i(74165),s=i(1413),n=i(15861),a=i(29439),o=i(37762),l=i(15671),h=i(43144),u=i(50165),c=i(13994),y=i(49796),f=i(20592),v=i(6819),_=i(47692),d=i(2815),p=i(33265),g=i(49510),m=i(68634),b=i(45180),w=i(85245),x=i(69754),S=function(){function e(t,i){(0,l.Z)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new f.t(0,0,t,i))}return(0,h.Z)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new f.t;for(var i=null,r=-1,s=0;s<this._free.length;++s){var n=this._free[s];e<=n.width&&t<=n.height&&(null===i||n.y<=i.y&&n.x<=i.x)&&(i=n,r=s)}return null===i?new f.t:(this._free.splice(r,1),i.width<i.height?(i.width>e&&this._free.push(new f.t(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new f.t(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new f.t(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new f.t(i.x,i.y+t,e,i.height-t))),new f.t(i.x,i.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}(),k=function(){function e(t,i,r){(0,l.Z)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=i,this._glyphSource=r,this._binPack=new S(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(void 0)}return(0,h.Z)(e,[{key:"getGlyphItems",value:function(e,t){var i,r=this,s=[],n=this._glyphSource,a=new Set,l=(0,o.Z)(t);try{for(l.s();!(i=l.n()).done;){var h=i.value,u=Math.floor(.00390625*h);a.add(u)}}catch(y){l.e(y)}finally{l.f()}var c=[];return a.forEach((function(t){if(t<=256){var i=e+t;if(r._rangePromises.has(i))c.push(r._rangePromises.get(i));else{var s=n.getRange(e,t).then((function(){r._rangePromises.delete(i)}),(function(){r._rangePromises.delete(i)}));r._rangePromises.set(i,s),c.push(s)}}})),Promise.all(c).then((function(){var i=r._glyphIndex[e];i||(i={},r._glyphIndex[e]=i);var a,l=(0,o.Z)(t);try{for(l.s();!(a=l.n()).done;){var h=a.value,u=i[h];if(u)s[h]={sdf:!0,rect:u.rect,metrics:u.metrics,page:u.page,code:h};else{var c=n.getGlyph(e,h);if(c&&c.metrics){var v=c.metrics,_=void 0;if(0===v.width)_=new f.t(0,0,0,0);else{var d=v.width+6,p=v.height+6,g=d%4?4-d%4:4,m=p%4?4-p%4:4;1===g&&(g=5),1===m&&(m=5),(_=r._binPack.allocate(d+g,p+m)).isEmpty&&(r._dirties[r._currentPage]||(r._glyphData[r._currentPage]=null),r._currentPage=r._glyphData.length,r._glyphData.push(new Uint8Array(r.width*r.height)),r._dirties.push(!0),r._textures.push(void 0),r._binPack=new S(r.width-4,r.height-4),_=r._binPack.allocate(d+g,p+m));var b=r._glyphData[r._currentPage],w=c.bitmap,x=void 0,k=void 0;if(w)for(var P=0;P<p;P++){x=d*P,k=r.width*(_.y+P+1)+_.x;for(var Z=0;Z<d;Z++)b[k+Z+1]=w[x+Z]}}i[h]={rect:_,metrics:v,tileIDs:null,page:r._currentPage},s[h]={sdf:!0,rect:_,metrics:v,page:r._currentPage,code:h},r._dirties[r._currentPage]=!0}}}}catch(y){l.e(y)}finally{l.f()}return s}))}},{key:"removeGlyphs",value:function(e){for(var t in this._glyphIndex){var i=this._glyphIndex[t];if(i){var r=void 0;for(var s in i)if((r=i[s]).tileIDs.delete(e),0===r.tileIDs.size){for(var n=this._glyphData[r.page],a=r.rect,o=void 0,l=void 0,h=0;h<a.height;h++)for(o=this.width*(a.y+h)+a.x,l=0;l<a.width;l++)n[o+l]=0;delete i[s],this._dirties[r.page]=!0}}}}},{key:"bind",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new _.u(e,{pixelFormat:v.P.ALPHA,dataType:v.G.UNSIGNED_BYTE,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var s=this._textures[i];s.setSamplingMode(t),this._dirties[i]&&s.setData(this._glyphData[i]),e.bindTexture(s,r),this._dirties[i]=!1}},{key:"dispose",value:function(){this._binPack=null;var e,t=(0,o.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(r){t.e(r)}finally{t.f()}this._textures.length=0}}]),e}(),P=function(){function e(t){if((0,l.Z)(this,e),this._metrics=[],this._bitmaps=[],t)for(;t.next();)if(1===t.tag()){for(var i=t.getMessage();i.next();)if(3===i.tag()){for(var r=i.getMessage(),s=void 0,n=void 0,a=void 0,o=void 0,h=void 0,u=void 0,c=void 0;r.next();)switch(r.tag()){case 1:s=r.getUInt32();break;case 2:n=r.getBytes();break;case 3:a=r.getUInt32();break;case 4:o=r.getUInt32();break;case 5:h=r.getSInt32();break;case 6:u=r.getSInt32();break;case 7:c=r.getUInt32();break;default:r.skip()}r.release(),s&&(this._metrics[s]={width:a,height:o,left:h,top:u,advance:c},this._bitmaps[s]=n)}else i.skip();i.release()}else t.skip()}return(0,h.Z)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),Z=function(){function e(){(0,l.Z)(this,e),this._ranges=[]}return(0,h.Z)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),I=function(){function e(t){(0,l.Z)(this,e),this._glyphInfo={},this._baseURL=t}return(0,h.Z)(e,[{key:"getRange",value:function(e,t){var i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();var r=256*t,s=r+255;if(this._baseURL){var n=this._baseURL.replace("{fontstack}",e).replace("{range}",r+"-"+s);return(0,c.U)(n,{responseType:"array-buffer"}).then((function(e){i.addRange(t,new P(new d.a(new Uint8Array(e.data),new DataView(e.data))))})).catch((function(){i.addRange(t,new P)}))}return i.addRange(t,new P),Promise.resolve()}},{key:"getGlyph",value:function(e,t){var i=this._getFontStack(e);if(i){var r=Math.floor(t/256);if(!(r>256)){var s=i.getRange(r);return s?{metrics:s.getMetrics(t),bitmap:s.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new Z),t}}]),e}(),R="dasharray-",T=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,l.Z)(this,e),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=i,r>0&&(this._maxItemSize=r),this._binPack=new S(t-4,i-4)}return(0,h.Z)(e,[{key:"dispose",value:function(){this._binPack=null,this._mosaicRects={};var e,t=(0,o.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(r){t.e(r)}finally{t.f()}this._textures.length=0}},{key:"getWidth",value:function(e){return e>=this._size.length?-1:this._size[e][0]}},{key:"getHeight",value:function(e){return e>=this._size.length?-1:this._size[e][1]}},{key:"getPageSize",value:function(e){return e>=this._size.length?null:this._size[e]}},{key:"setSpriteSource",value:function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new S(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),r=new Uint32Array(t*i);this._mosaicsData[0]=r,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}},{key:"getSpriteItem",value:function(e){var t,i,r,s,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=this._mosaicRects[e];if(o)return o;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith(R)?(t=this._rasterizeDash(e),r=(i=(0,a.Z)(t,2))[0],s=i[1],n=!0):r=this._sprites.getSpriteInfo(e),!r||!r.width||!r.height||r.width<0||r.height<0)return null;var l=r.width,h=r.height,u=this._allocateImage(l,h),c=(0,a.Z)(u,3),y=c[0],f=c[1],v=c[2];return y.width<=0?null:(this._copy(y,r,f,v,n,s),o={rect:y,width:l,height:h,sdf:r.sdf,simplePattern:!1,pixelRatio:r.pixelRatio,page:f},this._mosaicRects[e]=o,o)}},{key:"getSpriteItems",value:function(e){var t,i={},r=(0,o.Z)(e);try{for(r.s();!(t=r.n()).done;){var s=t.value;i[s.name]=this.getSpriteItem(s.name,s.repeat)}}catch(n){r.e(n)}finally{r.f()}return i}},{key:"getMosaicItemPosition",value:function(e,t){var i=this.getSpriteItem(e,t),r=i&&i.rect;if(!r)return null;r.width=i.width,r.height=i.height;var s=i.width,n=i.height;return{tl:[r.x+2,r.y+2],br:[r.x+2+s,r.y+2+n],page:i.page}}},{key:"bind",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new _.u(e,{pixelFormat:v.P.RGBA,dataType:v.G.UNSIGNED_BYTE,wrapMode:v.D.CLAMP_TO_EDGE,width:this._size[i][0],height:this._size[i][1]},new Uint8Array(this._mosaicsData[i].buffer)));var s=this._textures[i];s.setSamplingMode(t),this._dirties[i]&&s.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(s,r),this._dirties[i]=!1}},{key:"_copy",value:function(t,i,r,s,n,a){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var o=new Uint32Array(a?a.buffer:this._sprites.image.buffer),l=this._mosaicsData[r];l&&o||console.error("Source or target images are uninitialized!");var h=a?i.width:this._sprites.width;e._copyBits(o,h,i.x,i.y,l,s[0],t.x+2,t.y+2,i.width,i.height,n),this._dirties[r]=!0}}},{key:"_allocateImage",value:function(e,t){e+=2,t+=2;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var r=new f.t(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[r,this._mosaicsData.length-1,[e,t]]}var s=e%4?4-e%4:4,n=t%4?4-t%4:4;1===s&&(s=5),1===n&&(n=5);var a=this._binPack.allocate(e+s,t+n);return a.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new S(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[a,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"_rasterizeDash",value:function(e){var t=e.match(/\[(.*?)\]/);if(!t)return null;var i=t[1].split(",").map(Number),r=e.slice(e.lastIndexOf("-")+1),s=p.e.rasterizeDash(i,r),n=(0,a.Z)(s,3),o=n[0];return[{x:0,y:0,width:n[1],height:n[2],sdf:!0,pixelRatio:1},new Uint8Array(o.buffer)]}}],[{key:"_copyBits",value:function(e,t,i,r,s,n,a,o,l,h,u){var c=r*t+i,y=o*n+a;if(u){y-=n;for(var f=-1;f<=h;c=((++f+h)%h+r)*t+i,y+=n)for(var v=-1;v<=l;v++)s[y+v]=e[c+(v+l)%l]}else for(var _=0;_<h;_++){for(var d=0;d<l;d++)s[y+d]=e[c+d];c+=t,y+=n}}}]),e}();function M(e,t,i,r,s,n){e.fillStyle=t,e.fillRect(i,r,s,n)}function A(e,t,i,r,s,n){e.strokeStyle=t,e.strokeRect(i,r,s,n)}function D(e,t){for(var i=window.COLLISION_XRAY,r=0;r<t.length;++r){var s=!t[r].unique.show;if(i||!s){var n,a=(0,o.Z)(t[r].colliders);try{for(a.s();!(n=a.n()).done;){var l=n.value;if(l.enabled){var h=!t[r].unique.parts[l.partIndex].show;if(i||!h){var u=l.xScreen,c=l.yScreen,y=l.dxScreen,f=l.dyScreen;e.globalAlpha=s||h?.2:1,M(e,"green",u-1,c-1,3,3),A(e,"red",u+y,c+f,l.width,l.height),M(e,"blue",u+y-1,c+f-1,3,3),e.globalAlpha=1}}}}catch(v){a.e(v)}finally{a.f()}}}}var C=function(){function e(t,i,r){(0,l.Z)(this,e),this._layer=t,this._styleRepository=i,this.devicePixelRatio=r,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null}return(0,h.Z)(e,[{key:"destroy",value:function(){this._connection&&(this._connection.close(),this._connection=null),this._styleRepository=null,this._layer=null,this._spriteMosaic&&(this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic=null)}},{key:"spriteMosaic",get:function(){var e=this;return this._spriteSourcePromise.then((function(){return e._spriteMosaic}))}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}},{key:"start",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t){var i,n=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then((function(e){n._spriteMosaic=new T(1024,1024,250),n._spriteMosaic.setSpriteSource(e)})),i=new I(this._layer.currentStyleInfo.glyphsUrl?(0,c.B)(this._layer.currentStyleInfo.glyphsUrl,(0,s.Z)((0,s.Z)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),this._glyphMosaic=new k(1024,1024,i),this._broadcastPromise=(0,y.u)("WorkerTileHandler",{client:this,schedule:t.schedule,signal:t.signal}).then((function(e){n._connection=e,n._connection.broadcast("setStyle",n._layer.currentStyleInfo.style,t)}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateStyle",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",t)),e.abrupt("return",this._broadcastPromise);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setSpriteSource",value:function(e){var t=new T(1024,1024,250);return t.setSpriteSource(e),this._spriteMosaic=t,this._spriteSourcePromise=Promise.resolve(e),t}},{key:"setStyle",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t,i){var n,a=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._styleRepository=t,this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,null),this._spriteSourcePromise.then((function(e){a._spriteMosaic=new T(1024,1024,250),a._spriteMosaic.setSpriteSource(e)})),n=new I(this._layer.currentStyleInfo.glyphsUrl?(0,c.B)(this._layer.currentStyleInfo.glyphsUrl,(0,s.Z)((0,s.Z)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),e.abrupt("return",(this._glyphMosaic=new k(1024,1024,n),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",i)),this._broadcastPromise));case 7:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"fetchTileData",value:function(e,t){var i=this;return this._getRefKeys(e,t).then((function(e){var r=i._layer.sourceNameToSource,s=[];for(var n in r)s.push(n);return i._getSourcesData(s,e,t)}))}},{key:"parseTileData",value:function(e,t){var i=this,r=e&&e.data;if(!r)return Promise.resolve(null);var n=r.sourceName2DataAndRefKey,a=r.transferList;return 0===Object.keys(n).length?Promise.resolve(null):this._broadcastPromise.then((function(){return i._connection.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:n,styleLayerUIDs:e.styleLayerUIDs},(0,s.Z)((0,s.Z)({},t),{},{transferList:a}))}))}},{key:"getSprites",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._spriteSourcePromise;case 2:return e.abrupt("return",this._spriteMosaic.getSpriteItems(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGlyphs",value:function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}},{key:"perfReport",value:function(e){!function(e,t,i){if(window.PERFORMANCE_RECORDING_STORAGE){var r=window.PERFORMANCE_RECORDING_STORAGE;r.perf=r.perf||{};var s=r.perf;s[e]=s[e]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:i},s[e].time+=t,s[e].samples.push(t),(null==s[e].min||t<s[e].min)&&(s[e].min=t),(null==s[e].max||t>s[e].max)&&(s[e].max=t)}}(e.key,e.milliseconds,"ms")}},{key:"_getTilePayload",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t,i,s){var n,a,o,l,h;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=g.e.pool.acquire(t.id),a=this._layer.sourceNameToSource[i],o=n.level,l=n.row,h=n.col,g.e.pool.release(n),e.prev=2,e.next=5,a.requestTile(o,l,h,s);case 5:return e.t0=e.sent,e.t1=i,e.abrupt("return",{protobuff:e.t0,sourceName:e.t1});case 10:if(e.prev=10,e.t2=e.catch(2),!(0,u.I)(e.t2)){e.next=14;break}throw e.t2;case 14:return e.abrupt("return",{protobuff:null,sourceName:i});case 15:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t,i,r){return e.apply(this,arguments)}}()},{key:"_getRefKeys",value:function(e,t){var i=this._layer.sourceNameToSource,r=new Array;for(var s in i){var n=i[s].getRefKey(e,t);r.push(n)}return(0,u.E)(r)}},{key:"_getSourcesData",value:function(e,t,i){for(var r=[],s=0;s<t.length;s++)if(null==t[s].value||null==e[s])r.push(null);else{var n=this._getTilePayload(t[s].value,e[s],i);r.push(n)}return(0,u.E)(r).then((function(e){for(var i={},r=[],s=0;s<e.length;s++)if(e[s].value&&e[s].value&&e[s].value.protobuff&&e[s].value.protobuff.byteLength>0){var n=t[s].value.id;i[e[s].value.sourceName]={refKey:n,protobuff:e[s].value.protobuff},r.push(e[s].value.protobuff)}return{sourceName2DataAndRefKey:i,transferList:r}}))}}]),e}();function L(e,t,i,r,s,n){var l,h=r.iconRotationAlignment,u=r.textRotationAlignment,c=r.iconTranslate,y=r.iconTranslateAnchor,f=r.textTranslate,v=r.textTranslateAnchor,_=0,d=(0,o.Z)(e.colliders);try{for(d.s();!(l=d.n()).done;){var p=l.value,g=0===p.partIndex?c:f,m=(0,a.Z)(g,2),b=m[0],w=m[1],S=0===p.partIndex?y:v,k=p.minLod<=n&&n<=p.maxLod;_+=k?0:1,p.enabled=k,p.xScreen=p.xTile*s[0]+p.yTile*s[3]+s[6],p.yScreen=p.xTile*s[1]+p.yTile*s[4]+s[7],S===x.r.MAP?(p.xScreen+=i*b-t*w,p.yScreen+=t*b+i*w):(p.xScreen+=b,p.yScreen+=w),x.l.VIEWPORT===(0===p.partIndex?h:u)?(p.dxScreen=p.dxPixels,p.dyScreen=p.dyPixels):(p.dxScreen=i*(p.dxPixels+p.width/2)-t*(p.dyPixels+p.height/2)-p.width/2,p.dyScreen=t*(p.dxPixels+p.width/2)+i*(p.dyPixels+p.height/2)-p.height/2)}}catch(P){d.e(P)}finally{d.f()}e.colliders.length>0&&_===e.colliders.length&&(e.unique.show=!1)}var q=function(){function e(t,i,r,s,n,a){(0,l.Z)(this,e),this._symbols=t,this._styleRepository=s,this._zoom=n,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new w.n(i,r,b.t),this._si=Math.sin(Math.PI*a/180),this._co=Math.cos(Math.PI*a/180);var h,u=(0,o.Z)(t);try{for(u.s();!(h=u.n()).done;){var c,y=h.value,f=(0,o.Z)(y.symbols);try{for(f.s();!(c=f.n()).done;){var v=c.value;this._allNeededMatrices.has(v.tile)||this._allNeededMatrices.set(v.tile,(0,m.L)(v.tile.transforms.tileUnitsToPixels))}}catch(_){f.e(_)}finally{f.f()}}}catch(_){u.e(_)}finally{u.f()}}return(0,h.Z)(e,[{key:"work",value:function(e){var t=this._gridIndex;function i(e){for(var i=e.xScreen+e.dxScreen,r=e.yScreen+e.dyScreen,s=i+e.width,n=r+e.height,l=t.getCellSpan(i,r,s,n),h=(0,a.Z)(l,4),u=h[0],c=h[1],y=h[2],f=h[3],v=c;v<=f;v++)for(var _=u;_<=y;_++){var d,p=t.cells[v][_],g=(0,o.Z)(p);try{for(g.s();!(d=g.n()).done;){var m=d.value,b=m.xScreen+m.dxScreen,w=m.yScreen+m.dyScreen,x=b+m.width,S=w+m.height;if(!(s<b||i>x||n<w||r>S))return!0}}catch(k){g.e(k)}finally{g.f()}}return!1}for(var r=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0)for(var s=this._symbols[this._currentLayerCursor],n=this._getProperties(s.styleLayerUID);this._currentSymbolCursor<s.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-r>e)return!1;var l=s.symbols[this._currentSymbolCursor];if(l.unique.show){L(l,this._si,this._co,n,this._allNeededMatrices.get(l.tile),this._zoom);var h=l.unique;if(h.show){var u,c=n.iconAllowOverlap,y=n.iconIgnorePlacement,f=n.textAllowOverlap,v=n.textIgnorePlacement,_=(0,o.Z)(l.colliders);try{for(_.s();!(u=_.n()).done;){var d=u.value;if(d.enabled){var p=h.parts[d.partIndex];p.show&&!(d.partIndex?f:c)&&i(d)&&(d.hard?h.show=!1:p.show=!1)}}}catch(C){_.e(C)}finally{_.f()}if(h.show){var g,m=(0,o.Z)(l.colliders);try{for(m.s();!(g=m.n()).done;){var b=g.value;if(b.enabled&&(!(b.partIndex?v:y)&&h.parts[b.partIndex].show))for(var w=b.xScreen+b.dxScreen,x=b.yScreen+b.dyScreen,S=w+b.width,k=x+b.height,P=this._gridIndex.getCellSpan(w,x,S,k),Z=(0,a.Z)(P,4),I=Z[0],R=Z[1],T=Z[2],M=Z[3],A=R;A<=M;A++)for(var D=I;D<=T;D++)this._gridIndex.cells[A][D].push(b)}}catch(C){m.e(C)}finally{m.f()}}}}}return!0}},{key:"_getProperties",value:function(e){var t=this._styleProps.get(e);if(t)return t;var i=this._zoom,r=this._styleRepository.getStyleLayerByUID(e),s=r.getLayoutValue("symbol-placement",i)!==x.n.POINT,n=r.getLayoutValue("icon-rotation-alignment",i);n===x.l.AUTO&&(n=s?x.l.MAP:x.l.VIEWPORT);var a=r.getLayoutValue("text-rotation-alignment",i);a===x.l.AUTO&&(a=s?x.l.MAP:x.l.VIEWPORT);var o=r.getPaintValue("icon-translate",i),l=r.getPaintValue("icon-translate-anchor",i),h=r.getPaintValue("text-translate",i),u=r.getPaintValue("text-translate-anchor",i),c={iconAllowOverlap:r.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:r.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:r.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:r.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:n,textRotationAlignment:a,iconTranslateAnchor:l,iconTranslate:o,textTranslateAnchor:u,textTranslate:h};return this._styleProps.set(e,c),c}}]),e}();function U(e,t){if(e.priority-t.priority)return e.priority-t.priority;var i=e.tile.key,r=t.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}var z=function(){function e(t,i,r,s,n,a){(0,l.Z)(this,e),this._visibleTiles=t,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=s,this._symbolLayerSorter=n,this._isLayerVisible=a,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}return(0,h.Z)(e,[{key:"running",get:function(){return this._running}},{key:"setScreenSize",value:function(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}},{key:"restart",value:function(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}},{key:"continue",value:function(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){var t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){var i=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-i))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){var r=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-r))))return!1}return this._running=!1,!0}},{key:"_createSelectionJob",value:function(){for(var e=this._symbolRepository.uniqueSymbols,t=0;t<e.length;t++)for(var i=e[t],r=0;r<i.uniqueSymbols.length;r++){var s,n=i.uniqueSymbols[r],a=(0,o.Z)(n.tileSymbols);try{for(a.s();!(s=a.n()).done;){s.value.selectedForRendering=!1}}catch(f){a.e(f)}finally{a.f()}}var l=[],h=0,u=0,c=this._isLayerVisible;var y=this._symbolLayerSorter;return{work:function(t){for(var i,r=performance.now();u<e.length;u++,h=0){var s=e[u],n=s.styleLayerUID;if(c(n)){l[u]=l[u]||{styleLayerUID:n,symbols:[]};for(var a=l[u];h<s.uniqueSymbols.length;h++){if(i=s.uniqueSymbols[h],h%100==99&&performance.now()-r>t)return!1;var y,v=null,_=!1,d=!1,p=(0,o.Z)(i.tileSymbols);try{for(p.s();!(y=p.n()).done;){var g=y.value;if(!d||!_){var m=g.tile;(!v||m.isCoverage||m.neededForCoverage&&!_)&&(v=g,(m.neededForCoverage||m.isCoverage)&&(d=!0),m.isCoverage&&(_=!0))}}}catch(f){p.e(f)}finally{p.f()}if(v.selectedForRendering=!0,d){a.symbols.push(v),i.show=!0;var b,w=(0,o.Z)(i.parts);try{for(w.s();!(b=w.n()).done;){b.value.show=!0}}catch(f){w.e(f)}finally{w.f()}}else i.show=!1}}else l[u]||(l[u]={styleLayerUID:n,symbols:[]})}var x,S=(0,o.Z)(l);try{for(S.s();!(x=S.n()).done;){x.value.symbols.sort(U)}}catch(f){S.e(f)}finally{S.f()}return!0},get sortedSymbols(){return l.sort(y)}}}},{key:"_createOpacityJob",value:function(){var e=this._assignTileSymbolsOpacity,t=this._visibleTiles,i=0;function r(t,i){var s,n=t.symbols,l=(0,o.Z)(n);try{for(l.s();!(s=l.n()).done;){var h=(0,a.Z)(s.value,2);h[0];J(h[1],i)}}catch(y){l.e(y)}finally{l.f()}e(t,i);var u,c=(0,o.Z)(t.childrenTiles);try{for(c.s();!(u=c.n()).done;){r(u.value,i)}}catch(y){c.e(y)}finally{c.f()}}return{work:function(e){for(var s=performance.now();i<t.length;i++){if(performance.now()-s>e)return!1;var n=t[i];(0,u.r)(n.parentTile)||r(n,performance.now())}return!0}}}}]),e}();function J(e,t){var i,r=(0,o.Z)(e);try{for(r.s();!(i=r.n()).done;){var s,n=i.value.unique,a=(0,o.Z)(n.parts);try{for(a.s();!(s=a.n()).done;){var l=s.value,h=l.targetOpacity>.5?1:-1;l.startOpacity+=h*((t-l.startTime)/b.e),l.startOpacity=Math.min(Math.max(l.startOpacity,0),1),l.startTime=t,l.targetOpacity=n.show&&l.show?1:0}}catch(u){a.e(u)}finally{a.f()}}}catch(u){r.e(u)}finally{r.f()}}var O=function(){function e(t,i,r){(0,l.Z)(this,e),this.tileCoordRange=t,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}return(0,h.Z)(e,[{key:"uniqueSymbols",get:function(){return(0,u.t)(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}},{key:"add",value:function(e,t){this._uniqueSymbolLayerArray=null;var i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));var r=new Map;if(t){var s,n=(0,o.Z)(t);try{for(n.s();!(s=n.n()).done;){var l=s.value;i.symbols.has(l)&&(r.set(l,i.symbols.get(l)),i.symbols.delete(l))}}catch(I){n.e(I)}finally{n.f()}}else{var h,u=(0,o.Z)(e.layerData);try{for(u.s();!(h=u.n()).done;){var c=(0,a.Z)(h.value,2),y=c[0];c[1];i.symbols.has(y)&&(r.set(y,i.symbols.get(y)),i.symbols.delete(y))}}catch(I){u.e(I)}finally{u.f()}}this._removeSymbols(r);var f,v=e.symbols,_=new Map,d=(0,o.Z)(v);try{for(d.s();!(f=d.n()).done;){var p=(0,a.Z)(f.value,2),g=p[0],m=p[1],b=m.length;if(b>=32){var x=this.tileCoordRange;do{x/=2,b/=4}while(b>8&&x>64);var S=new w.n(this.tileCoordRange,this.tileCoordRange,x);_.set(g,{flat:m,index:S}),i.symbols.set(g,{flat:m,index:S});var k,P=(0,o.Z)(m);try{for(P.s();!(k=P.n()).done;){var Z=k.value;S.getCell(Z.xTile,Z.yTile).push(Z)}}catch(I){P.e(I)}finally{P.f()}}else _.set(g,{flat:m}),i.symbols.set(g,{flat:m})}}catch(I){d.e(I)}finally{d.f()}this._addSymbols(e.key,v)}},{key:"deleteStyleLayers",value:function(e){this._uniqueSymbolLayerArray=null;var t,i=(0,o.Z)(this._tiles);try{for(i.s();!(t=i.n()).done;){var r,s=(0,a.Z)(t.value,2),n=s[0],l=s[1],h=new Map,u=(0,o.Z)(e);try{for(u.s();!(r=u.n()).done;){var c=r.value;l.symbols.has(c)&&(h.set(c,l.symbols.get(c)),l.symbols.delete(c))}}catch(y){u.e(y)}finally{u.f()}this._removeSymbols(h),0===l.symbols.size&&this._tiles.delete(n)}}catch(y){i.e(y)}finally{i.f()}}},{key:"removeTile",value:function(e){this._uniqueSymbolLayerArray=null;var t=this._tiles.get(e.id);if(t){var i,r=new Map,s=(0,o.Z)(e.symbols);try{for(s.s();!(i=s.n()).done;){var n=(0,a.Z)(i.value,2),l=n[0];n[1];t.symbols.has(l)&&(r.set(l,t.symbols.get(l)),t.symbols.delete(l))}}catch(h){s.e(h)}finally{s.f()}this._removeSymbols(r),0===t.symbols.size&&this._tiles.delete(e.id)}}},{key:"_removeSymbols",value:function(e){var t,i=(0,o.Z)(e);try{for(i.s();!(t=i.n()).done;){var r,s=(0,a.Z)(t.value,2),n=s[0],l=s[1].flat,h=(0,o.Z)(l);try{for(h.s();!(r=h.n()).done;){for(var u=r.value,c=u.unique,y=c.tileSymbols,f=y.length-1,v=0;v<f;v++)if(y[v]===u){y[v]=y[f];break}if(y.length=f,0===f){var _=this._uniqueSymbolsReferences.get(n);_.delete(c),0===_.size&&this._uniqueSymbolsReferences.delete(n)}u.unique=null}}catch(d){h.e(d)}finally{h.f()}}}catch(d){i.e(d)}finally{i.f()}}},{key:"_addSymbols",value:function(e,t){if(0!==t.size){var i,r=this._visibleTiles,s=(0,o.Z)(r);try{for(s.s();!(i=s.n()).done;){var n=i.value;n.parentTile||n.key.world!==e.world||n.key.level===e.level&&!n.key.equals(e)||this._matchSymbols(n,e,t)}}catch(m){s.e(m)}finally{s.f()}var l,h=(0,o.Z)(t);try{for(h.s();!(l=h.n()).done;){var c,y=(0,a.Z)(l.value,2),f=y[0],v=y[1],_=(0,o.Z)(v);try{for(_.s();!(c=_.n()).done;){var d=c.value;if((0,u.t)(d.unique)){var p=this._createUnique();d.unique=p,p.tileSymbols.push(d);var g=this._uniqueSymbolsReferences.get(f);g||(g=new Set,this._uniqueSymbolsReferences.set(f,g)),g.add(p)}}}catch(m){_.e(m)}finally{_.f()}}}catch(m){h.e(m)}finally{h.f()}}}},{key:"_matchSymbols",value:function(e,t,i){if(e.key.level>t.level){var r=e.key.level-t.level;if(e.key.row>>r!==t.row||e.key.col>>r!==t.col)return}if(t.level>e.key.level){var s=t.level-e.key.level;if(t.row>>s!==e.key.row||t.col>>s!==e.key.col)return}if(t.equals(e.key)){var n,l=(0,o.Z)(e.childrenTiles);try{for(l.s();!(n=l.n()).done;){var h=n.value;this._matchSymbols(h,t,i)}}catch(G){l.e(G)}finally{l.f()}}else{var c,y=new Map,f=(0,o.Z)(i);try{for(f.s();!(c=f.n()).done;){var v,_=(0,a.Z)(c.value,2),d=_[0],p=_[1],g=[],m=(0,o.Z)(p);try{for(m.s();!(v=m.n()).done;){var b=v.value,x=(0,w.o)(this.tileCoordRange,b.xTile,t.level,t.col,e.key.level,e.key.col),S=(0,w.o)(this.tileCoordRange,b.yTile,t.level,t.row,e.key.level,e.key.row);x>=0&&x<this.tileCoordRange&&S>=0&&S<this.tileCoordRange&&g.push({symbol:b,xTransformed:x,yTransformed:S})}}catch(G){m.e(G)}finally{m.f()}var k=[],P=e.key.level<t.level?1:1<<e.key.level-t.level,Z=this._tiles.get(e.id).symbols.get(d);if(Z){var I,R=Z.flat,T=(0,o.Z)(g);try{for(T.s();!(I=T.n()).done;){var M,A=I.value,D=!1,C=A.xTransformed,L=A.yTransformed;M=(0,u.r)(Z.index)?Z.index.getCell(C,L):R;var q,U=A.symbol,z=U.hash,J=(0,o.Z)(M);try{for(J.s();!(q=J.n()).done;){var O=q.value;if(z===O.hash&&Math.abs(C-O.xTile)<=P&&Math.abs(L-O.yTile)<=P){var N=O.unique;U.unique=N,N.tileSymbols.push(U),D=!0;break}}}catch(G){J.e(G)}finally{J.f()}D||k.push(U)}}catch(G){T.e(G)}finally{T.f()}}k.length>0&&y.set(d,k)}}catch(G){f.e(G)}finally{f.f()}var E,W=(0,o.Z)(e.childrenTiles);try{for(W.s();!(E=W.n()).done;){var V=E.value;this._matchSymbols(V,t,y)}}catch(G){W.e(G)}finally{W.f()}}}},{key:"_createUniqueSymbolLayerArray",value:function(){var e,t,i=this._uniqueSymbolsReferences,r=new Array(i.size),s=0,n=(0,o.Z)(i);try{for(n.s();!(t=n.n()).done;){var l=(0,a.Z)(t.value,2),h=l[0],u=l[1],c=new Array(u.size);e=0;var y,f=(0,o.Z)(u);try{for(f.s();!(y=f.n()).done;){var v=y.value;c[e++]=v}}catch(_){f.e(_)}finally{f.f()}r[s]={styleLayerUID:h,uniqueSymbols:c},s++}}catch(_){n.e(_)}finally{n.f()}return r}}]),e}()}}]);
//# sourceMappingURL=8032.1ceefd07.chunk.js.map