"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[9142],{29142:function(e,t,r){r.r(t);var n,a=r(93433),s=r(74165),u=r(60136),o=r(29388),i=r(15861),c=r(1413),l=r(37762),p=r(15671),d=r(43144),f=r(48848),h=(r(74384),r(64998)),y=r(40558),v=r(89181),m=r(93661),Z=r(93116),b=r(46817),g=r(56162),x=r(55654),k=r(35237),F=r(19941),R=r(39994),_=r(65415),w=r(52559),I=r(49871),S=r(68781),O=r(35865),q=r(75847),j=r(63212),T=r(51816),E=r(95399),C=r(1685),A=r(72973),D=r(82474);r(25577),r(62610),r(93314),r(37856),r(15751),r(40114),r(59984),r(20302),r(53586),r(65094),r(60369),r(92072),r(37944),r(86086),r(21385),r(89794),r(48200),r(71802),r(85253),r(93209),r(25456),r(46337),r(81556),r(67477),r(64854),r(69641),r(15436),r(69768),r(47855),r(62466),r(53409),r(35182),r(69717);function N(e,t){return t}function P(e,t,r,n){switch(r){case 0:return M(e,t+n,0);case 1:return"lowerLeft"===e.originPosition?M(e,t+n,1):function(e,t,r){var n=e.translate,a=e.scale;return n[r]-t*a[r]}(e,t+n,1)}}function G(e,t,r,n){return 2===r?M(e,t,2):P(e,t,r,n)}function J(e,t,r,n){return 2===r?M(e,t,3):P(e,t,r,n)}function U(e,t,r,n){return 3===r?M(e,t,3):G(e,t,r,n)}function M(e,t,r){var n=e.translate,a=e.scale;return n[r]+t*a[r]}!function(e){e[e.PROJECT_VERTICES=1]="PROJECT_VERTICES"}(n||(n={}));var Q=function(){function e(t){(0,p.Z)(this,e),this._options=t,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this._previousCoordinate=[0,0],this._transform=null,this._applyTransform=N,this._lengths=[],this._currentLengthIndex=0,this._toAddInCurrentPath=0,this._vertexDimension=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,this._attributesConstructor=function(){return(0,d.Z)((function e(){(0,p.Z)(this,e)}))}()}return(0,d.Z)(e,[{key:"createFeatureResult",value:function(){return{fields:[],features:[]}}},{key:"finishFeatureResult",value:function(e){if(this._options.applyTransform&&(e.transform=null),this._attributesConstructor=function(){return(0,d.Z)((function e(){(0,p.Z)(this,e)}))}(),this._coordinateBuffer=null,this._lengths.length=0,e.hasZ){var t=(0,_.o)(e.geometryType,this._options.sourceSpatialReference,e.spatialReference);if(!(0,m.t)(t)){var r,n=(0,l.Z)(e.features);try{for(n.s();!(r=n.n()).done;){t(r.value.geometry)}}catch(a){n.e(a)}finally{n.f()}}}}},{key:"createSpatialReference",value:function(){return{}}},{key:"addField",value:function(e,t){var r=e.fields;(0,m.E)(r),r.push(t);var n=r.map((function(e){return e.name}));this._attributesConstructor=function(){var e,t=(0,l.Z)(n);try{for(t.s();!(e=t.n()).done;){this[e.value]=null}}catch(r){t.e(r)}finally{t.f()}}}},{key:"addFeature",value:function(e,t){e.features.push(t)}},{key:"prepareFeatures",value:function(e){var t=this;switch(this._transform=e.transform,this._options.applyTransform&&e.transform&&(this._applyTransform=this._deriveApplyTransform(e)),this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++,e.geometryType){case"esriGeometryPoint":this.addCoordinate=function(e,r,n){return t.addCoordinatePoint(e,r,n)},this.createGeometry=function(e){return t.createPointGeometry(e)};break;case"esriGeometryPolygon":this.addCoordinate=function(e,r,n){return t._addCoordinatePolygon(e,r,n)},this.createGeometry=function(e){return t._createPolygonGeometry(e)};break;case"esriGeometryPolyline":this.addCoordinate=function(e,r,n){return t._addCoordinatePolyline(e,r,n)},this.createGeometry=function(e){return t._createPolylineGeometry(e)};break;case"esriGeometryMultipoint":this.addCoordinate=function(e,r,n){return t._addCoordinateMultipoint(e,r,n)},this.createGeometry=function(e){return t._createMultipointGeometry(e)}}}},{key:"createFeature",value:function(){return this._lengths.length=0,this._currentLengthIndex=0,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0,this._coordinateBuffer=null,this._coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}},{key:"allocateCoordinates",value:function(){}},{key:"addLength",value:function(e,t,r){0===this._lengths.length&&(this._toAddInCurrentPath=t),this._lengths.push(t)}},{key:"addQueryGeometry",value:function(e,t){var r=t.queryGeometry,n=t.queryGeometryType,a=(0,w.p)(r.clone(),r,!1,!1,this._transform),s=(0,w.r)(a,n,!1,!1);e.queryGeometryType=n,e.queryGeometry=(0,c.Z)({},s)}},{key:"createPointGeometry",value:function(e){var t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}},{key:"addCoordinatePoint",value:function(e,t,r){var n=(0,m.i)(this._transform,"transform");switch(t=this._applyTransform(n,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}},{key:"_transformPathLikeValue",value:function(e,t){var r=0;t<=1&&(r=this._previousCoordinate[t],this._previousCoordinate[t]+=e);var n=(0,m.i)(this._transform,"transform");return this._applyTransform(n,e,t,r)}},{key:"_addCoordinatePolyline",value:function(e,t,r){this._dehydratedAddPointsCoordinate(e.paths,t,r)}},{key:"_addCoordinatePolygon",value:function(e,t,r){this._dehydratedAddPointsCoordinate(e.rings,t,r)}},{key:"_addCoordinateMultipoint",value:function(e,t,r){0===r&&e.points.push([]);var n=this._transformPathLikeValue(t,r);e.points[e.points.length-1].push(n)}},{key:"_createPolygonGeometry",value:function(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}},{key:"_createPolylineGeometry",value:function(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}},{key:"_createMultipointGeometry",value:function(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}},{key:"_dehydratedAddPointsCoordinate",value:function(e,t,r){0===r&&0==this._toAddInCurrentPath--&&(e.push([]),this._toAddInCurrentPath=this._lengths[++this._currentLengthIndex]-1,this._previousCoordinate[0]=0,this._previousCoordinate[1]=0);var n=this._transformPathLikeValue(t,r),a=e[e.length-1];0===r&&(this._coordinateBufferPtr=0,this._coordinateBuffer=new Array(this._vertexDimension),a.push(this._coordinateBuffer)),this._coordinateBuffer[this._coordinateBufferPtr++]=n}},{key:"_deriveApplyTransform",value:function(e){var t=e.hasZ,r=e.hasM;return t&&r?U:t?G:r?J:P}}]),e}();function B(e,t,r){return z.apply(this,arguments)}function z(){return z=(0,i.Z)((0,s.Z)().mark((function e(t,r,n){var a,u,o,i,l,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,R.f)(t),u=(0,c.Z)({},n),o=k.x.from(r),i=!o.quantizationParameters,e.next=6,(0,I.f)(a,o,new Q({sourceSpatialReference:o.sourceSpatialReference,applyTransform:i}),u);case 6:return l=e.sent,p=l.data,e.abrupt("return",p);case 9:case"end":return e.stop()}}),e)}))),z.apply(this,arguments)}function V(e){var t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function L(e,t){var r,n={},a=(0,l.Z)(e);try{for(a.s();!(r=a.n()).done;){var s,u=r.value,o=u.parentObjectId,i=u.parentGlobalId,c=u.attachmentInfos,p=(0,l.Z)(c);try{for(p.s();!(s=p.n()).done;){var d=s.value,f=d.id,h=(0,y.l)((0,y.h)("".concat(t,"/").concat(o,"/attachments/").concat(f))),v=F.a.fromJSON(d);v.set({url:h,parentObjectId:o,parentGlobalId:i}),n[o]?n[o].push(v):n[o]=[v]}}catch(m){p.e(m)}finally{p.f()}}}catch(m){a.e(m)}finally{a.f()}return n}function H(e,t,r){var n={query:(0,I.t)((0,c.Z)((0,c.Z)({},e.query),{},{f:"json"},V(t)))};return r&&(n=(0,c.Z)((0,c.Z)((0,c.Z)({},r),n),{},{query:(0,c.Z)((0,c.Z)({},r.query),n.query)})),(0,y.U)(e.path+"/queryAttachments",n)}function Y(){return Y=(0,i.Z)((0,s.Z)().mark((function e(t,r,n){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,R.f)(t),e.abrupt("return",H(a,O.c.from(r),(0,c.Z)({},n)).then((function(e){return L(e.data.attachmentGroups,a.path)})));case 2:case"end":return e.stop()}}),e)}))),Y.apply(this,arguments)}function X(){return X=(0,i.Z)((0,s.Z)().mark((function e(t,r,n){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,R.f)(t),e.abrupt("return",(0,I.x)(a,k.x.from(r),(0,c.Z)({},n)).then((function(e){return{count:e.data.count,extent:b.w.fromJSON(e.data.extent)}})));case 2:case"end":return e.stop()}}),e)}))),X.apply(this,arguments)}function $(e,t){var r=e.toJSON();return r.objectIds&&(r.objectIds=r.objectIds.join(",")),r.orderByFields&&(r.orderByFields=r.orderByFields.join(",")),!r.outFields||null!==t&&void 0!==t&&t.returnCountOnly?delete r.outFields:r.outFields.includes("*")?r.outFields="*":r.outFields=r.outFields.join(","),r.outSpatialReference&&(r.outSR=r.outSR.wkid||JSON.stringify(r.outSR.toJSON()),delete r.outSpatialReference),r.dynamicDataSource&&(r.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r}function K(e,t,r){return W.apply(this,arguments)}function W(){return W=(0,i.Z)((0,s.Z)().mark((function e(t,r,n){var a,u,o,i,p,d,f,h,y,v;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re(t,r,n);case 2:a=e.sent,u=a.data,o=u.geometryType,i=u.spatialReference,p={},d=(0,l.Z)(u.relatedRecordGroups);try{for(d.s();!(f=d.n()).done;)if(h=f.value,y={fields:void 0,objectIdFieldName:void 0,geometryType:o,spatialReference:i,hasZ:!!u.hasZ,hasM:!!u.hasM,features:h.relatedRecords},null!=h.objectId)p[h.objectId]=y;else for(v in h)h.hasOwnProperty(v)&&"relatedRecords"!==v&&(p[h[v]]=y)}catch(s){d.e(s)}finally{d.f()}return e.abrupt("return",(0,c.Z)((0,c.Z)({},a),{},{data:p}));case 10:case"end":return e.stop()}}),e)}))),W.apply(this,arguments)}function ee(e,t,r){return te.apply(this,arguments)}function te(){return te=(0,i.Z)((0,s.Z)().mark((function e(t,r,n){var a,u,o,i,p,d;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re(t,r,n,{returnCountOnly:!0});case 2:a=e.sent,u=a.data,o={},i=(0,l.Z)(u.relatedRecordGroups);try{for(i.s();!(p=i.n()).done;)null!=(d=p.value).objectId&&(o[d.objectId]=d.count)}catch(s){i.e(s)}finally{i.f()}return e.abrupt("return",(0,c.Z)((0,c.Z)({},a),{},{data:o}));case 8:case"end":return e.stop()}}),e)}))),te.apply(this,arguments)}function re(e,t){return ne.apply(this,arguments)}function ne(){return ne=(0,i.Z)((0,s.Z)().mark((function e(t,r){var n,a,u,o=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>2&&void 0!==o[2]?o[2]:{},a=o.length>3?o[3]:void 0,u=(0,I.t)((0,c.Z)((0,c.Z)((0,c.Z)({},t.query),{},{f:"json"},a),$(r,a))),e.abrupt("return",(0,y.U)(t.path+"/queryRelatedRecords",(0,c.Z)((0,c.Z)({},n),{},{query:(0,c.Z)((0,c.Z)({},n.query),u)})));case 4:case"end":return e.stop()}}),e)}))),ne.apply(this,arguments)}function ae(){return ae=(0,i.Z)((0,s.Z)().mark((function e(t,r,n){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O.d.from(r),a=(0,R.f)(t),e.abrupt("return",K(a,r,n).then((function(e){var t=e.data,r={};return Object.keys(t).forEach((function(e){return r[e]=S.default.fromJSON(t[e])})),r})));case 3:case"end":return e.stop()}}),e)}))),ae.apply(this,arguments)}function se(){return se=(0,i.Z)((0,s.Z)().mark((function e(t,r,n){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O.d.from(r),a=(0,R.f)(t),e.abrupt("return",ee(a,r,(0,c.Z)({},n)).then((function(e){return e.data})));case 3:case"end":return e.stop()}}),e)}))),se.apply(this,arguments)}var ue="Layer does not support extent calculation.";function oe(e,t){var r,n,a=e.geometry,s=e.toJSON(),u=s;if((0,m.r)(a)&&(u.geometry=JSON.stringify(a),u.geometryType=(0,g.c)(a),u.inSR=a.spatialReference.wkid||JSON.stringify(a.spatialReference)),null!==(r=s.topFilter)&&void 0!==r&&r.groupByFields&&(u.topFilter.groupByFields=s.topFilter.groupByFields.join(",")),null!==(n=s.topFilter)&&void 0!==n&&n.orderByFields&&(u.topFilter.orderByFields=s.topFilter.orderByFields.join(",")),s.topFilter&&(u.topFilter=JSON.stringify(u.topFilter)),s.objectIds&&(u.objectIds=s.objectIds.join(",")),s.orderByFields&&(u.orderByFields=s.orderByFields.join(",")),s.outFields&&!(null!==t&&void 0!==t&&t.returnCountOnly||null!==t&&void 0!==t&&t.returnExtentOnly||null!==t&&void 0!==t&&t.returnIdsOnly)?s.outFields.includes("*")?u.outFields="*":u.outFields=s.outFields.join(","):delete u.outFields,s.outSR?u.outSR=s.outSR.wkid||JSON.stringify(s.outSR):a&&s.returnGeometry&&(u.outSR=u.inSR),s.returnGeometry&&delete s.returnGeometry,s.timeExtent){var o=s.timeExtent,i=o.start,c=o.end;null==i&&null==c||(u.time=i===c?i:"".concat(null!==i&&void 0!==i?i:"null",",").concat(null!==c&&void 0!==c?c:"null")),delete s.timeExtent}return u}function ie(e,t,r,n){return ce.apply(this,arguments)}function ce(){return ce=(0,i.Z)((0,s.Z)().mark((function e(t,r,n,a){var u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye(t,r,"json",a);case 2:return u=e.sent,e.abrupt("return",((0,T.r)(r,n,u.data),u));case 4:case"end":return e.stop()}}),e)}))),ce.apply(this,arguments)}function le(e,t,r){return pe.apply(this,arguments)}function pe(){return pe=(0,i.Z)((0,s.Z)().mark((function e(t,r,n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,m.r)(r.timeExtent)&&r.timeExtent.isEmpty?{data:{objectIds:[]}}:ye(t,r,"json",n,{returnIdsOnly:!0}));case 1:case"end":return e.stop()}}),e)}))),pe.apply(this,arguments)}function de(e,t,r){return fe.apply(this,arguments)}function fe(){return fe=(0,i.Z)((0,s.Z)().mark((function e(t,r,n){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,m.r)(r.timeExtent)&&r.timeExtent.isEmpty?{data:{count:0,extent:null}}:ye(t,r,"json",n,{returnExtentOnly:!0,returnCountOnly:!0}).then((function(e){var t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(ue);if(t.hasOwnProperty("count"))throw new Error(ue);return e})));case 1:case"end":return e.stop()}}),e)}))),fe.apply(this,arguments)}function he(e,t,r){return(0,m.r)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):ye(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function ye(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s="string"==typeof e?(0,y.j)(e):e,u=t.geometry?[t.geometry]:[];return n.responseType="pbf"===r?"array-buffer":"json",(0,j.v)(u,null,n).then((function(e){var u=e&&e[0];(0,m.r)(u)&&((t=t.clone()).geometry=u);var o=(0,I.t)((0,c.Z)((0,c.Z)((0,c.Z)({},s.query),{},{f:r},a),oe(t,a)));return(0,y.U)((0,y.G)(s.path,"queryTopFeatures"),(0,c.Z)((0,c.Z)({},n),{},{query:(0,c.Z)((0,c.Z)({},o),n.query)}))}))}function ve(){return ve=(0,i.Z)((0,s.Z)().mark((function e(t,r,n,a){var u,o,i,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=(0,R.f)(t),o=(0,c.Z)({},a),e.next=4,ie(u,E.v.from(r),n,o);case 4:return i=e.sent,l=i.data,e.abrupt("return",S.default.fromJSON(l));case 7:case"end":return e.stop()}}),e)}))),ve.apply(this,arguments)}function me(){return me=(0,i.Z)((0,s.Z)().mark((function e(t,r,n){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,R.f)(t),e.next=3,le(a,E.v.from(r),(0,c.Z)({},n));case 3:return e.abrupt("return",e.sent.data.objectIds);case 4:case"end":return e.stop()}}),e)}))),me.apply(this,arguments)}function Ze(){return Ze=(0,i.Z)((0,s.Z)().mark((function e(t,r,n){var a,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,R.f)(t),e.next=3,de(a,E.v.from(r),(0,c.Z)({},n));case 3:return u=e.sent,e.abrupt("return",{count:u.data.count,extent:b.w.fromJSON(u.data.extent)});case 5:case"end":return e.stop()}}),e)}))),Ze.apply(this,arguments)}function be(){return be=(0,i.Z)((0,s.Z)().mark((function e(t,r,n){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,R.f)(t),e.next=3,he(a,E.v.from(r),(0,c.Z)({},n));case 3:return e.abrupt("return",e.sent.data.count);case 4:case"end":return e.stop()}}),e)}))),be.apply(this,arguments)}var ge=function(e){(0,u.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;(0,p.Z)(this,r);for(var n=arguments.length,a=new Array(n),s=0;s<n;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))).requestOptions=null,e.url=null,e}return(0,d.Z)(r,[{key:"normalizeCtorArgs",value:function(e,t){return"string"!=typeof e?e:(0,c.Z)({url:e},t)}},{key:"parsedUrl",get:function(){return this._parseUrl(this.url)}},{key:"_parseUrl",value:function(e){return(0,y.j)(e)}},{key:"_encode",value:function(e,t,r){var n={};for(var a in e)if("declaredClass"!==a){var s=e[a];if(null!=s&&"function"!=typeof s)if(Array.isArray(s)){n[a]=[];for(var u=0;u<s.length;u++)n[a][u]=this._encode(s[u])}else if("object"==typeof s)if(s.toJSON){var o=s.toJSON(r&&r[a]);n[a]=t?o:JSON.stringify(o)}else n[a]=t?s:JSON.stringify(s);else n[a]=s}return n}}]),r}(f.m);(0,f.e)([(0,f.y)({readOnly:!0})],ge.prototype,"parsedUrl",null),(0,f.e)([(0,f.y)()],ge.prototype,"requestOptions",void 0),(0,f.e)([(0,f.y)({type:String})],ge.prototype,"url",void 0);var xe=function(e){(0,u.Z)(n,e);var t=(0,o.Z)(n);function n(e){var r;return(0,p.Z)(this,n),(r=t.call(this,e)).dynamicDataSource=null,r.fieldsIndex=null,r.format="json",r.gdbVersion=null,r.infoFor3D=null,r.sourceSpatialReference=null,r}return(0,d.Z)(n,[{key:"execute",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.executeJSON(t,r);case 2:return n=e.sent,e.abrupt("return",this.featureSetFromJSON(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeJSON",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){var n,a,u,o,i,l,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(0,c.Z)((0,c.Z)({},this.requestOptions),r),u=this._normalizeQuery(t),o=null!=(null===(n=t.outStatistics)||void 0===n?void 0:n[0]),i=(0,m.h)("featurelayer-pbf-statistics"),l=!o||i,"pbf"!==this.format||!l){e.next=13;break}return e.prev=2,e.next=5,B(this.url,u,a);case 5:p=e.sent,e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(2),"query:parsing-pbf"===e.t0.name){e.next=12;break}throw e.t0;case 12:this.format="json";case 13:if(e.t1="json"!==this.format&&l,e.t1){e.next=18;break}return e.next=17,(0,F.b)(this.url,u,a);case 17:p=e.sent;case 18:return this._normalizeFields(p.fields),e.abrupt("return",p);case 20:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"featureSetFromJSON",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,n,a){var u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._queryIs3DObjectFormat(t)&&!(0,m.t)(this.infoFor3D)&&n.assetMaps&&n.features&&n.features.length){e.next=2;break}return e.abrupt("return",S.default.fromJSON(n));case 2:return e.next=4,(0,f.Y)(Promise.all([r.e(5249),r.e(5026),r.e(734),r.e(3586)]).then(r.bind(r,693)),a);case 4:return u=e.sent,o=u.meshFeatureSetFromJSON,e.abrupt("return",o(t,this.infoFor3D,n));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"executeForCount",value:function(e,t){var r=(0,c.Z)((0,c.Z)({},this.requestOptions),t),n=this._normalizeQuery(e);return(0,q.n)(this.url,n,r)}},{key:"executeForExtent",value:function(e,t){var r=(0,c.Z)((0,c.Z)({},this.requestOptions),t),n=this._normalizeQuery(e);return function(e,t,r){return X.apply(this,arguments)}(this.url,n,r)}},{key:"executeForIds",value:function(e,t){var r=(0,c.Z)((0,c.Z)({},this.requestOptions),t),n=this._normalizeQuery(e);return(0,q.s)(this.url,n,r)}},{key:"executeRelationshipQuery",value:function(e,t){e=O.d.from(e);var r=(0,c.Z)((0,c.Z)({},this.requestOptions),t);return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),function(e,t,r){return ae.apply(this,arguments)}(this.url,e,r)}},{key:"executeRelationshipQueryForCount",value:function(e,t){e=O.d.from(e);var r=(0,c.Z)((0,c.Z)({},this.requestOptions),t);return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),function(e,t,r){return se.apply(this,arguments)}(this.url,e,r)}},{key:"executeAttachmentQuery",value:function(e,t){var r=(0,c.Z)((0,c.Z)({},this.requestOptions),t);return function(e,t,r){return Y.apply(this,arguments)}(this.url,e,r)}},{key:"executeTopFeaturesQuery",value:function(e,t){var r=(0,c.Z)((0,c.Z)({},this.requestOptions),t);return function(e,t,r,n){return ve.apply(this,arguments)}(this.parsedUrl,e,this.sourceSpatialReference,r)}},{key:"executeForTopIds",value:function(e,t){var r=(0,c.Z)((0,c.Z)({},this.requestOptions),t);return function(e,t,r){return me.apply(this,arguments)}(this.parsedUrl,e,r)}},{key:"executeForTopExtents",value:function(e,t){var r=(0,c.Z)((0,c.Z)({},this.requestOptions),t);return function(e,t,r){return Ze.apply(this,arguments)}(this.parsedUrl,e,r)}},{key:"executeForTopCount",value:function(e,t){var r=(0,c.Z)((0,c.Z)({},this.requestOptions),t);return function(e,t,r){return be.apply(this,arguments)}(this.parsedUrl,e,r)}},{key:"_normalizeQuery",value:function(e){var t=k.x.from(e);if(t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&((t=t===e?t.clone():t).gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?k.K.from(e.dynamicDataSource):this.dynamicDataSource),(0,m.r)(this.infoFor3D)&&this._queryIs3DObjectFormat(e)){(t=t===e?t.clone():t).formatOf3DObjects=null;var r,n=(0,l.Z)(this.infoFor3D.queryFormats);try{for(n.s();!(r=n.n()).done;){var a=r.value;if("3D_glb"===a){t.formatOf3DObjects=a;break}"3D_gltf"!==a||t.formatOf3DObjects||(t.formatOf3DObjects=a)}}catch(F){n.e(F)}finally{n.f()}if(!t.formatOf3DObjects)throw new f.s("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if((0,m.t)(t.outFields)||!t.outFields.includes("*")){t=t===e?t.clone():t,(0,m.t)(t.outFields)&&(t.outFields=[]);var s=this.infoFor3D.transformFieldRoles,u=s.originX,o=s.originY,i=s.originZ,c=s.translationX,p=s.translationY,d=s.translationZ,h=s.scaleX,y=s.scaleY,v=s.scaleZ,Z=s.rotationX,b=s.rotationY,g=s.rotationZ,x=s.rotationDeg;t.outFields.push(u,o,i,c,p,d,h,y,v,Z,b,g,x)}}return t}},{key:"_normalizeFields",value:function(e){if((0,m.r)(this.fieldsIndex)&&(0,m.r)(e)){var t,r=(0,l.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,a=this.fieldsIndex.get(n.name);a&&Object.assign(n,a.toJSON())}}catch(s){r.e(s)}finally{r.f()}}}},{key:"_queryIs3DObjectFormat",value:function(e){return(0,m.r)(this.infoFor3D)&&e.returnGeometry&&"xyFootprint"!==e.multipatchOption&&!e.outStatistics}}]),n}(ge=(0,f.e)([(0,f.n)("esri.tasks.Task")],ge));(0,f.e)([(0,f.y)({type:k.K})],xe.prototype,"dynamicDataSource",void 0),(0,f.e)([(0,f.y)()],xe.prototype,"fieldsIndex",void 0),(0,f.e)([(0,f.y)()],xe.prototype,"format",void 0),(0,f.e)([(0,f.y)()],xe.prototype,"gdbVersion",void 0),(0,f.e)([(0,f.y)()],xe.prototype,"infoFor3D",void 0),(0,f.e)([(0,f.y)()],xe.prototype,"sourceSpatialReference",void 0);var ke=xe=(0,f.e)([(0,f.n)("esri.tasks.QueryTask")],xe),Fe=new y.s({originalAndCurrentFeatures:"original-and-current-features",none:"none"});function Re(e){return _e.apply(this,arguments)}function _e(){return _e=(0,i.Z)((0,s.Z)().mark((function e(t){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=3;break}return r=(0,y.n)(t),e.abrupt("return",r||{data:t});case 3:return e.abrupt("return",new Promise((function(e,r){var n=new FileReader;n.readAsDataURL(t),n.onload=function(){return e((0,y.n)(n.result))},n.onerror=function(e){return r(e)}})));case 4:case"end":return e.stop()}}),e)}))),_e.apply(this,arguments)}var we=new Set(["Feature Layer","Table"]),Ie=new y.s({Started:"published",Publishing:"publishing",Stopped:"unavailable"}),Se=function(e){(0,u.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,p.Z)(this,r),(e=t.apply(this,arguments)).type="feature-layer",e.refresh=(0,f.a1)((0,i.Z)((0,s.Z)().mark((function t(){var r,n,a,u;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.load();case 2:if(null!=(a=null===(r=e.sourceJSON.editingInfo)||void 0===r?void 0:r.lastEditDate)){t.next=5;break}return t.abrupt("return",{dataChanged:!0,updates:{}});case 5:return t.prev=5,t.next=8,e._fetchService(null);case 8:t.next=13;break;case 10:return t.prev=10,t.t0=t.catch(5),t.abrupt("return",{dataChanged:!0,updates:{}});case 13:return u=a!==(null===(n=e.sourceJSON.editingInfo)||void 0===n?void 0:n.lastEditDate),t.abrupt("return",{dataChanged:u,updates:u?{editingInfo:e.sourceJSON.editingInfo,extent:e.sourceJSON.extent}:null});case 15:case"end":return t.stop()}}),t,null,[[5,10]])})))),e}return(0,d.Z)(r,[{key:"load",value:function(e){var t=(0,m.r)(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON,t)),Promise.resolve(this)}},{key:"queryTask",get:function(){var e=this.layer,t=e.capabilities.query.supportsFormatPBF,r=e.parsedUrl,n=e.dynamicDataSource,a=e.infoFor3D,s=e.gdbVersion,u=e.spatialReference,o=e.fieldsIndex,i=(0,m.h)("featurelayer-pbf")&&t&&(0,m.t)(a)?"pbf":"json";return new ke({url:r.path,format:i,fieldsIndex:o,infoFor3D:a,dynamicDataSource:n,gdbVersion:s,sourceSpatialReference:u})}},{key:"addAttachment",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){var n,a,u,o,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return n=t.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+"/"+n+"/addAttachment",u=this._getLayerRequestOptions(),o=this._getFormDataForAttachment(r,u.query),e.prev=3,e.next=6,(0,y.U)(a,{body:o});case 6:return i=e.sent,e.abrupt("return",this._createFeatureEditResult(i.data.addAttachmentResult));case 10:throw e.prev=10,e.t0=e.catch(3),this._createAttachmentErrorResult(n,e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateAttachment",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r,n){var a,u,o,i,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return a=t.attributes[this.layer.objectIdField],u=this.layer.parsedUrl.path+"/"+a+"/updateAttachment",o=this._getLayerRequestOptions({query:{attachmentId:r}}),i=this._getFormDataForAttachment(n,o.query),e.prev=3,e.next=6,(0,y.U)(u,{body:i});case 6:return c=e.sent,e.abrupt("return",this._createFeatureEditResult(c.data.updateAttachmentResult));case 10:throw e.prev=10,e.t0=e.catch(3),this._createAttachmentErrorResult(a,e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"applyEdits",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){var n,u,o,i,p,d,f,h,v,Z,b,g,x,k,F,R,_,w,I,S,O,q,j,T,E,C,D,N,P,G,J,U,M,Q,B,z,V,L,H,Y,X,$,K,W=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:n=this.layer.infoFor3D,u=(0,m.r)(n),o=u||(null===r||void 0===r?void 0:r.globalIdUsed),i=t.addFeatures.map((function(e){return W._serializeFeature(e,n)})),p=t.updateFeatures.map((function(e){return W._serializeFeature(e,n)})),d=this._getFeatureIds(t.deleteFeatures,o),(0,A.i)(i,p,this.layer.spatialReference),f=[],h=[],v=(0,a.Z)(t.deleteAttachments),Z=(0,l.Z)(t.addAttachments),e.prev=6,Z.s();case 8:if((b=Z.n()).done){e.next=17;break}return g=b.value,e.t0=f,e.next=13,this._serializeAttachment(g);case 13:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 15:e.next=8;break;case 17:e.next=22;break;case 19:e.prev=19,e.t2=e.catch(6),Z.e(e.t2);case 22:return e.prev=22,Z.f(),e.finish(22);case 25:x=(0,l.Z)(t.updateAttachments),e.prev=26,x.s();case 28:if((k=x.n()).done){e.next=37;break}return F=k.value,e.t3=h,e.next=33,this._serializeAttachment(F);case 33:e.t4=e.sent,e.t3.push.call(e.t3,e.t4);case 35:e.next=28;break;case 37:e.next=42;break;case 39:e.prev=39,e.t5=e.catch(26),x.e(e.t5);case 42:return e.prev=42,x.f(),e.finish(42);case 45:if(R=f.length||h.length||v.length?{adds:f,updates:h,deletes:v}:null,w=null,!u){e.next=56;break}w=new Map,I=[],S=(0,l.Z)(t.addAssets);try{for(S.s();!(O=S.n()).done;)q=O.value,I.push(this._serializeAssetMapEditAndUploadAssets(q,w))}catch(s){S.e(s)}finally{S.f()}return e.next=54,Promise.all(I);case 54:j=e.sent,_=j.length?{adds:j,updates:[],deletes:[]}:void 0;case 56:return T={gdbVersion:(null===r||void 0===r?void 0:r.gdbVersion)||this.layer.gdbVersion,rollbackOnFailure:null===r||void 0===r?void 0:r.rollbackOnFailureEnabled,useGlobalIds:o,returnEditMoment:null===r||void 0===r?void 0:r.returnEditMoment,usePreviousEditMoment:null===r||void 0===r?void 0:r.usePreviousEditMoment,sessionId:null===r||void 0===r?void 0:r.sessionId},null!==r&&void 0!==r&&r.returnServiceEditsOption?(T.edits=JSON.stringify([{id:this.layer.layerId,adds:i,updates:p,deletes:d,attachments:R,assetMaps:(0,m.e)(_)}]),T.returnServiceEditsOption=Fe.toJSON(null===r||void 0===r?void 0:r.returnServiceEditsOption),T.returnServiceEditsInSourceSR=null===r||void 0===r?void 0:r.returnServiceEditsInSourceSR):(T.adds=i.length?JSON.stringify(i):null,T.updates=p.length?JSON.stringify(p):null,T.deletes=d.length?o?JSON.stringify(d):d.join(","):null,T.attachments=R&&JSON.stringify(R),T.assetMaps=(0,m.r)(_)?JSON.stringify(_):void 0),E=this._getLayerRequestOptions({method:"post",query:T}),C=null!==r&&void 0!==r&&r.returnServiceEditsOption?this.layer.url:this.layer.parsedUrl.path,e.next=62,(0,y.U)(C+"/applyEdits",E);case 62:if(D=e.sent,!u||null==D.data||null==D.data.assetMaps){e.next=74;break}N=D.data,P=this.layer.objectIdField,G=[],J=(0,l.Z)(N.addResults);try{for(J.s();!(U=J.n()).done;)(M=U.value).success&&G.push(M.objectId)}catch(s){J.e(s)}finally{J.f()}Q=(0,l.Z)(N.updateResults);try{for(Q.s();!(B=Q.n()).done;)(z=B.value).success&&G.push(z.objectId)}catch(s){Q.e(s)}finally{Q.f()}return V=this._createRequestQueryOptions(),e.next=72,(0,y.U)(C+"/query",(0,c.Z)((0,c.Z)({},V),{},{query:{f:"json",formatOf3DObjects:"3D_glb",where:"OBJECTID IN (".concat(G.join(","),")"),outFields:"".concat(P)}}));case 72:if((L=e.sent)&&L.data&&L.data.assetMaps&&(0,m.r)(w)){H=L.data.assetMaps,Y=(0,l.Z)(H);try{for(Y.s();!(X=Y.n()).done;)$=X.value,K=w.get($.parentGlobalId).geometry,(0,m.r)(K)&&"mesh"===K.type&&K.updateExternalSource({source:[{name:$.assetName,source:$.assetName}],extent:K.extent})}catch(s){Y.e(s)}finally{Y.f()}}case 74:return e.abrupt("return",this._createEditsResult(D));case 75:case"end":return e.stop()}}),e,this,[[6,19,22,25],[26,39,42,45]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"deleteAttachments",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){var n,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return n=t.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+"/"+n+"/deleteAttachments",e.prev=3,e.next=6,(0,y.U)(a,this._getLayerRequestOptions({query:{attachmentIds:r.join(",")},method:"post"}));case 6:return e.abrupt("return",e.sent.data.deleteAttachmentResults.map(this._createFeatureEditResult));case 9:throw e.prev=9,e.t0=e.catch(3),this._createAttachmentErrorResult(n,e.t0);case 12:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"fetchRecomputedExtents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.signal;return this.load({signal:r}).then((0,i.Z)((0,s.Z)().mark((function r(){var n,a,u,o,i,l,p,d,f,h,m;return(0,s.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n=e._getLayerRequestOptions((0,c.Z)((0,c.Z)({},t),{},{query:{returnUpdates:!0}})),a=e.layer,u=a.layerId,o=a.url,r.next=6,(0,y.U)("".concat(o,"/").concat(u),n);case 6:return i=r.sent,l=i.data,p=l.id,d=l.extent,f=l.fullExtent,h=l.timeExtent,m=d||f,r.abrupt("return",{id:p,fullExtent:m&&b.w.fromJSON(m),timeExtent:h&&v.T.fromJSON({start:h[0],end:h[1]})});case 14:case"end":return r.stop()}}),r)}))))}},{key:"queryAttachments",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t){var r,n,a,u,o,i,c,p,d,f,h=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.length>1&&void 0!==h[1]?h[1]:{},n=this.layer.parsedUrl,a=n.path,e.next=4,this.load();case 4:if(u=this._getLayerRequestOptions(r),this.layer.get("capabilities.operations.supportsQueryAttachments")){e.next=10;break}o=t.objectIds,i=[],c=(0,l.Z)(o);try{for(c.s();!(p=c.n()).done;)d=p.value,f=a+"/"+d+"/attachments",i.push((0,y.U)(f,u))}catch(s){c.e(s)}finally{c.f()}return e.abrupt("return",Promise.all(i).then((function(e){return o.map((function(t,r){return{parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}}))})).then((function(e){return L(e,a)})));case 10:return e.abrupt("return",this.queryTask.executeAttachmentQuery(t,u));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryFeatures",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.execute(t,(0,c.Z)((0,c.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeaturesJSON",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeJSON(t,(0,c.Z)((0,c.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryObjectIds",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForIds(t,(0,c.Z)((0,c.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForCount(t,(0,c.Z)((0,c.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryExtent",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForExtent(t,(0,c.Z)((0,c.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryRelatedFeatures",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeRelationshipQuery(t,(0,c.Z)((0,c.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryRelatedFeaturesCount",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeRelationshipQueryForCount(t,(0,c.Z)((0,c.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryTopFeatures",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeTopFeaturesQuery(t,(0,c.Z)((0,c.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryTopObjectIds",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForTopIds(t,(0,c.Z)((0,c.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryTopExtents",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForTopExtents(t,(0,c.Z)((0,c.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"queryTopCount",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.load();case 2:return e.abrupt("return",this.queryTask.executeForTopCount(t,(0,c.Z)((0,c.Z)({},r),{},{query:this._createRequestQueryOptions(r)})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"fetchPublishingStatus",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,C.g)(this.layer.url)){e.next=2;break}return e.abrupt("return","unavailable");case 2:return t=(0,y.G)(this.layer.url,"status"),e.next=5,(0,y.U)(t,{query:{f:"json"}});case 5:return r=e.sent,e.abrupt("return",Ie.fromJSON(r.data.status));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_createRequestQueryOptions",value:function(e){var t=(0,c.Z)((0,c.Z)({},this.layer.customParameters),{},{token:this.layer.apiKey},null===e||void 0===e?void 0:e.query);return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}},{key:"_fetchService",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){var n,a,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=6;break}return e.next=3,(0,y.U)(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:(0,m.h)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:r}));case 3:n=e.sent,a=n.data,t=a;case 6:if(this.sourceJSON=this._patchServiceJSON(t),u=t.type,we.has(u)){e.next=10;break}throw new f.s("feature-layer-source:unsupported-type",'Source type "'.concat(u,'" is not supported'));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_patchServiceJSON",value:function(e){var t;if("Table"!==e.type&&e.geometryType&&(null===e||void 0===e||null===(t=e.drawingInfo)||void 0===t||!t.renderer)&&!e.defaultSymbol){var r=(0,x.o)(e.geometryType).renderer;(0,m.o)("drawingInfo.renderer",r,e)}return"esriGeometryMultiPatch"===e.geometryType&&e.infoFor3D&&(e.geometryType="mesh"),e}},{key:"_serializeFeature",value:function(e,t){var r=e.geometry,n=e.attributes;if((0,m.r)(t)&&(0,m.r)(e.geometry)&&"mesh"===e.geometry.type){var a=(0,c.Z)({},n),s=e.geometry,u=s.origin,o=s.transform;if(a[t.transformFieldRoles.originX]=u.x,a[t.transformFieldRoles.originY]=u.y,a[t.transformFieldRoles.originZ]=u.z,(0,m.r)(o)){var i=o.translation,l=o.scale,p=o.rotation;a[t.transformFieldRoles.translationX]=i[0],a[t.transformFieldRoles.translationY]=i[1],a[t.transformFieldRoles.translationZ]=i[2],a[t.transformFieldRoles.scaleX]=l[0],a[t.transformFieldRoles.scaleY]=l[1],a[t.transformFieldRoles.scaleZ]=l[2],a[t.transformFieldRoles.rotationX]=p[0],a[t.transformFieldRoles.rotationY]=p[1],a[t.transformFieldRoles.rotationZ]=p[2],a[t.transformFieldRoles.rotationDeg]=p[3]}return{geometry:null,attributes:a}}return(0,m.t)(r)?{attributes:n}:"mesh"===r.type||"extent"===r.type?null:{geometry:r.toJSON(),attributes:n}}},{key:"_serializeAttachment",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t){var r,n,a,u,o,i,c,l,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.feature,n=t.attachment,a=n.globalId,u=n.name,o=n.contentType,i=n.data,c=n.uploadId,l={globalId:a,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null},r&&(l.parentGlobalId="attributes"in r?r.attributes&&r.attributes[this.layer.globalIdField]:r.globalId),!c){e.next=5;break}l.uploadId=c,e.next=10;break;case 5:if(!i){e.next=10;break}return e.next=8,Re(i);case 8:p=e.sent,l.contentType=p.mediaType,l.data=p.data,i instanceof File&&(l.name=i.name);case 10:return e.abrupt("return",(u&&(l.name=u),o&&(l.contentType=o),l));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_serializeAssetMapEditAndUploadAssets",value:function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,r){var a,u,o,i,c,l,p,d,h,v,Z,b,g;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.layer.url,u=null,e.prev=2,o=new Blob([t.data],{type:t.mimeType}),(i=new FormData).append("f","json"),i.append("file",o,"".concat(t.assetName)),c={body:i,method:"post",responseType:"json"},e.next=8,(0,y.U)("".concat(a,"/uploads/upload"),c);case 8:if(l=e.sent,(p=l.data).success){e.next=12;break}throw new f.s("feature-layer-source:upload-failure","Expected upload to be successfull.");case 12:u={assetType:t.assetType,assetUploadId:p.item.itemID},e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),u=null;case 18:if(!(0,m.t)(u)){e.next=25;break}return e.next=21,Re(new Blob([t.data]));case 21:if((d=e.sent).isBase64){e.next=24;break}throw new f.s("feature-layer-source:uploadAssets-failure","Expected gltf data in base64 format after conversion.");case 24:u={assetType:t.assetType,assetData:d.data};case 25:if(!(0,m.t)(u)){e.next=27;break}throw new f.s("feature-layer-source:uploadAssets-failure","Unable to prepare uploadAsset request options.");case 27:return h={method:"post",query:{f:"json",assets:JSON.stringify([u])},responseType:"json"},e.next=30,(0,y.U)((0,y.G)(this.layer.parsedUrl.path,"uploadAssets"),h);case 30:if(1===(v=e.sent).data.uploadResults.length&&v.data.uploadResults[0].success){e.next=33;break}throw new f.s("feature-layer-source:uploadAssets-failure","Bad response.");case 33:return Z=v.data.uploadResults[0].assetHash,b=[],t.flags&n.PROJECT_VERTICES&&b.push("PROJECT_VERTICES"),g={globalId:t.assetMapGlobalId,parentGlobalId:t.featureGlobalId,assetName:t.assetName,assetHash:Z,flags:b},e.abrupt("return",(r.set(t.featureGlobalId,t.feature),g));case 37:case"end":return e.stop()}}),e,this,[[2,15]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getFeatureIds",value:function(e,t){var r=e[0];return r?this._canUseGlobalIds(t,e)?this._getGlobalIdsFromFeatureIdentifier(e):"objectId"in r?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}},{key:"_getIdsFromFeatures",value:function(e){var t=this.layer.objectIdField;return e.map((function(e){return e.attributes&&e.attributes[t]}))}},{key:"_canUseGlobalIds",value:function(e,t){return e&&"globalId"in t[0]}},{key:"_getObjectIdsFromFeatureIdentifier",value:function(e){return e.map((function(e){return e.objectId}))}},{key:"_getGlobalIdsFromFeatureIdentifier",value:function(e){return e.map((function(e){return e.globalId}))}},{key:"_createEditsResult",value:function(e){var t,r=this,n=e.data,a=this.layer.layerId,s=[],u=null;if(Array.isArray(n)){var o,i=(0,l.Z)(n);try{for(i.s();!(o=i.n()).done;){var c=o.value;s.push({id:c.id,editedFeatures:c.editedFeatures}),c.id===a&&(u={addResults:c.addResults,updateResults:c.updateResults,deleteResults:c.deleteResults,attachments:c.attachments,editMoment:c.editMoment})}}catch(v){i.e(v)}finally{i.f()}}else u=n;var p=null===(t=u)||void 0===t?void 0:t.attachments,d={addFeatureResults:u.addResults?u.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:u.updateResults?u.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:u.deleteResults?u.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:p&&p.addResults?p.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:p&&p.updateResults?p.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:p&&p.deleteResults?p.deleteResults.map(this._createFeatureEditResult,this):[]};if(u.editMoment&&(d.editMoment=u.editMoment),s.length>0){d.editedFeatureResults=[];var f,h=(0,l.Z)(s);try{var y=function(){var e=f.value,t=e.editedFeatures,n=t.adds,a=t.updates,s=t.deletes,u=t.spatialReference,o=u?new D.k(u):null;d.editedFeatureResults.push({layerId:e.id,editedFeatures:{adds:(null===n||void 0===n?void 0:n.map((function(e){return r._createEditedFeature(e,o)})))||[],updates:(null===a||void 0===a?void 0:a.map((function(e){return{original:r._createEditedFeature(e[0],o),current:r._createEditedFeature(e[1],o)}})))||[],deletes:(null===s||void 0===s?void 0:s.map((function(e){return r._createEditedFeature(e,o)})))||[],spatialReference:o}})};for(h.s();!(f=h.n()).done;)y()}catch(v){h.e(v)}finally{h.f()}}return d}},{key:"_createEditedFeature",value:function(e,t){return new h.g({attributes:e.attributes,geometry:(0,g.v)((0,c.Z)((0,c.Z)({},e.geometry),{},{spatialReference:t}))})}},{key:"_createFeatureEditResult",value:function(e){var t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new f.s("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}},{key:"_createAttachmentErrorResult",value:function(e,t){var r=t.details.messages&&t.details.messages[0]||t.message,n=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new f.s("feature-layer-source:attachment-failure",r,{code:n})}}},{key:"_getFormDataForAttachment",value:function(e,t){var r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(var n in t){var a=t[n];null!=a&&(r.set?r.set(n,a):r.append(n,a))}return r}},{key:"_getLayerRequestOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.layer,r=t.parsedUrl,n=t.gdbVersion,a=t.dynamicDataSource;return(0,c.Z)((0,c.Z)({},e),{},{query:(0,c.Z)((0,c.Z)({gdbVersion:n,layer:a?JSON.stringify({source:a}):void 0},r.query),{},{f:"json"},this._createRequestQueryOptions(e)),responseType:"json"})}}]),r}(Z.m);(0,f.e)([(0,f.y)()],Se.prototype,"type",void 0),(0,f.e)([(0,f.y)({constructOnly:!0})],Se.prototype,"layer",void 0),(0,f.e)([(0,f.y)({readOnly:!0})],Se.prototype,"queryTask",null);var Oe=Se=(0,f.e)([(0,f.n)("esri.layers.graphics.sources.FeatureLayerSource")],Se);t.default=Oe},67477:function(e,t,r){r.d(t,{t:function(){return n}});var n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},55654:function(e,t,r){r.d(t,{a:function(){return d},i:function(){return p},l:function(){return f},o:function(){return i}});var n=r(4942),a=r(1413),s=r(93661),u=r(67477),o=r(64854);function i(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?o.l:"esriGeometryPolyline"===e?o.o:o.S}}}var c=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/,l=1;function p(e,t){if((0,s.h)("esri-csp-restrictions"))return function(){return(0,a.Z)((0,n.Z)({},t,null),e)};try{var r="this.".concat(t," = null;");for(var u in e)r+="this".concat(c.test(u)?".".concat(u):'["'.concat(u,'"]')," = ").concat(JSON.stringify(e[u]),";");var o=new Function("\n      return class AttributesClass$".concat(l++," {\n        constructor() {\n          ").concat(r,";\n        }\n      }\n    "))();return function(){return new o}}catch(r){return function(){return(0,a.Z)((0,n.Z)({},t,null),e)}}}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{name:"New Feature",description:"",prototype:{attributes:(0,s.y)(e)}}]}function f(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0},query:u.t,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}},75847:function(e,t,r){r.d(t,{n:function(){return c},s:function(){return p}});var n=r(74165),a=r(1413),s=r(15861),u=r(39994),o=r(49871),i=r(35237);function c(e,t,r){return l.apply(this,arguments)}function l(){return l=(0,s.Z)((0,n.Z)().mark((function e(t,r,s){var c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=(0,u.f)(t),e.abrupt("return",(0,o.S)(c,i.x.from(r),(0,a.Z)({},s)).then((function(e){return e.data.count})));case 2:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}function p(e,t,r){return d.apply(this,arguments)}function d(){return d=(0,s.Z)((0,n.Z)().mark((function e(t,r,s){var c;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=(0,u.f)(t),e.abrupt("return",(0,o.p)(c,i.x.from(r),(0,a.Z)({},s)).then((function(e){return e.data.objectIds})));case 2:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}},19941:function(e,t,r){r.d(t,{a:function(){return g},b:function(){return F},s:function(){return x}});var n,a=r(1413),s=r(74165),u=r(15861),o=r(15671),i=r(43144),c=r(60136),l=r(29388),p=r(48848),d=r(40114),f=(r(93661),r(39994)),h=r(49871),y=r(68781),v=r(35237);function m(e){var t=e.exifInfo,r=e.exifName,n=e.tagName;if(!t||!r||!n)return null;var a=t.find((function(e){return e.name===r}));return a?function(e){var t=e.tagName,r=e.tags;if(!r||!t)return null;var n=r.find((function(e){return e.name===t}));return n&&n.value||null}({tagName:n,tags:a.tags}):null}var Z={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}},b=n=function(e){(0,c.Z)(r,e);var t=(0,l.Z)(r);function r(e){var n;return(0,o.Z)(this,r),(n=t.call(this,e)).contentType=null,n.exifInfo=null,n.id=null,n.globalId=null,n.keywords=null,n.name=null,n.parentGlobalId=null,n.parentObjectId=null,n.size=null,n.url=null,n}return(0,i.Z)(r,[{key:"orientationInfo",get:function(){var e=m({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:this.exifInfo});return Z[e]||null}},{key:"clone",value:function(){return new n({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}}]),r}(d.l);(0,p.e)([(0,p.y)({type:String})],b.prototype,"contentType",void 0),(0,p.e)([(0,p.y)()],b.prototype,"exifInfo",void 0),(0,p.e)([(0,p.y)({readOnly:!0})],b.prototype,"orientationInfo",null),(0,p.e)([(0,p.y)({type:p.T})],b.prototype,"id",void 0),(0,p.e)([(0,p.y)({type:String})],b.prototype,"globalId",void 0),(0,p.e)([(0,p.y)({type:String})],b.prototype,"keywords",void 0),(0,p.e)([(0,p.y)({type:String})],b.prototype,"name",void 0),(0,p.e)([(0,p.y)({json:{read:!1}})],b.prototype,"parentGlobalId",void 0),(0,p.e)([(0,p.y)({json:{read:!1}})],b.prototype,"parentObjectId",void 0),(0,p.e)([(0,p.y)({type:p.T})],b.prototype,"size",void 0),(0,p.e)([(0,p.y)({json:{read:!1}})],b.prototype,"url",void 0);var g=b=n=(0,p.e)([(0,p.n)("esri.layers.support.AttachmentInfo")],b);function x(e,t,r){return k.apply(this,arguments)}function k(){return k=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(t,r,n);case 2:return a=e.sent,e.abrupt("return",y.default.fromJSON(a));case 4:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function F(e,t,r){return R.apply(this,arguments)}function R(){return R=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var u,o,i,c,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=(0,f.f)(t),o=(0,a.Z)({},n),i=v.x.from(r),e.next=5,(0,h.c)(u,i,i.sourceSpatialReference,o);case 5:return c=e.sent,l=c.data,e.abrupt("return",l);case 8:case"end":return e.stop()}}),e)}))),R.apply(this,arguments)}}}]);
//# sourceMappingURL=9142.5f9320da.chunk.js.map