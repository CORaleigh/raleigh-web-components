"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[6902],{66385:function(e,t,i){i.d(t,{C:function(){return b},a:function(){return y},n:function(){return m},t:function(){return g}});var n=i(15671),r=i(43144),a=i(60136),o=i(29388),s=i(50165),l=i(52155),c=i(61340),u=i(57952),h=i(2760),d=i(50463),f=i(73627),v=i(24695),p=i(35691),_=i(92694),y=function(e){var t=function(e){(0,a.Z)(i,e);var t=(0,o.Z)(i);function i(){var e;return(0,n.Z)(this,i),(e=t.apply(this,arguments)).parent=null,e._userInteractive=!1,e._interactiveViewModelCount=0,e}return(0,r.Z)(i,[{key:"interactive",get:function(){return this._interactiveViewModelCount>0||this._userInteractive},set:function(e){this._userInteractive=e}},{key:"updating",get:function(){return!1}},{key:"visible",get:function(){return!(0,s.r)(this.parent)||this.parent.visible&&!this.parent.suspended},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")}},{key:"forceInteractiveForViewModel",value:function(){var e=this;return this._interactiveViewModelCount++,(0,s.p)((function(){return e._interactiveViewModelCount--}))}}]),i}((0,l.m)(e));return(0,s.e)([(0,s.d)({readOnly:!0})],t.prototype,"type",void 0),(0,s.e)([(0,s.d)({constructOnly:!0})],t.prototype,"analysis",void 0),(0,s.e)([(0,s.d)({constructOnly:!0})],t.prototype,"parent",void 0),(0,s.e)([(0,s.d)({constructOnly:!0})],t.prototype,"view",void 0),(0,s.e)([(0,s.d)({type:Boolean})],t.prototype,"interactive",null),(0,s.e)([(0,s.d)()],t.prototype,"_userInteractive",void 0),(0,s.e)([(0,s.d)({readOnly:!0})],t.prototype,"updating",null),(0,s.e)([(0,s.d)()],t.prototype,"visible",null),(0,s.e)([(0,s.d)()],t.prototype,"_interactiveViewModelCount",void 0),t=(0,s.e)([(0,s.n)("esri.views.3d.analysis.AnalysisView3D")],t)},g=function(){function e(t){var i=this;(0,n.Z)(this,e),this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=t,this._handle=(0,f.l)((function(){return i.view.ready}),(function(e){i._resourcesCreated&&(e?i._createResources():i._destroyResources())}))}return(0,r.Z)(e,[{key:"applyProps",value:function(e){var t=!1;for(var i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}},{key:"destroy",value:function(){this.attached=!1,this._handle.remove()}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}},{key:"_createResources",value:function(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}},{key:"_destroyResources",value:function(){this.destroyResources(),this._resourcesCreated=!1}}]),e}(),m=function(e){(0,a.Z)(i,e);var t=(0,o.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e.view))._resources=null,r._transform=(0,u.e)(),r}return(0,r.Z)(i,[{key:"object",get:function(){return(0,s.r)(this._resources)?this._resources.object:null}},{key:"transform",get:function(){return this._transform},set:function(e){(0,c.n)(this._transform,e),(0,s.r)(this._resources)&&(this._resources.object.transformation=this._transform)}},{key:"recreate",value:function(){this.attached&&this.createResources()}},{key:"recreateGeometry",value:function(){if(!(0,s.t)(this._resources)){var e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}}},{key:"createResources",value:function(){this.destroyResources();var e=this.view._stage;if(e){var t=new p.l({isPickable:!1,updatePolicy:v.o.SYNC});e.add(t);var i=new p.aR({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((function(t){return e.add(t)})),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}}},{key:"destroyResources",value:function(){var e=this.view._stage;!(0,s.t)(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((function(t){e.remove(t),t.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}},{key:"updateVisibility",value:function(e){(0,s.t)(this._resources)||this._resources.object.setVisible(e)}}]),i}(g),b=function(e){(0,a.Z)(i,e);var t=(0,o.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this,e))._renderOccluded=_.a9.OccludeAndTransparent,r._width=1,r._color=(0,d.r)(1,0,1,1),r._innerWidth=1,r._innerColor=null,r._stipplePattern=null,r._stippleOffColor=null,r._stipplePreferContinuous=!0,r._writeDepthEnabled=!0,r._falloff=0,r._polygonOffset=!1,r.applyProps(e),r}return(0,r.Z)(i,[{key:"setGeometryFromRenderSpacePoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=[];i.push([[e[0]-t,e[1]+0,e[2]+0],[e[0]+t,e[1]+0,e[2]+0]]),i.push([[e[0]-0,e[1]-t,e[2]+0],[e[0]+0,e[1]+t,e[2]+0]]),i.push([[e[0]-0,e[1]+0,e[2]-t],[e[0]+0,e[1]+0,e[2]+t]]),this.geometry=i}},{key:"setGeometryFromExtent",value:function(e){var t=this.view.spatialReference,i=(0,h.n)(),n=(0,h.n)(),r=100,a=[];(0,h.f)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),(0,h.f)(i,e[2],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),(0,h.f)(i,e[2],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),(0,h.f)(i,e[0],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),(0,h.f)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),(0,h.f)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),this.geometry=[a]}},{key:"setGeometryFromFrustum",value:function(e){var t=[];e.lines.forEach((function(e){t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}},{key:"setGeometryFromBoundedPlane",value:function(e){var t=[],i=e.origin,n=e.basis1,r=e.basis2,a=.5,o=(0,h.n)(),s=(0,h.n)(),l=(0,h.n)(),c=(0,h.n)();o[0]=i[0]-n[0]*a-r[0]*a,o[1]=i[1]-n[1]*a-r[1]*a,o[2]=i[2]-n[2]*a-r[2]*a,s[0]=i[0]-n[0]*a+r[0]*a,s[1]=i[1]-n[1]*a+r[1]*a,s[2]=i[2]-n[2]*a+r[2]*a,l[0]=i[0]+n[0]*a+r[0]*a,l[1]=i[1]+n[1]*a+r[1]*a,l[2]=i[2]+n[2]*a+r[2]*a,c[0]=i[0]+n[0]*a-r[0]*a,c[1]=i[1]+n[1]*a-r[1]*a,c[2]=i[2]+n[2]*a-r[2]*a,t.push([o[0],o[1],o[2]]),t.push([s[0],s[1],s[2]]),t.push([l[0],l[1],l[2]]),t.push([c[0],c[1],c[2]]),t.push([o[0],o[1],o[2]]),this.geometry=[t]}},{key:"setGeometryFromSegment",value:function(e){var t=e.endRenderSpace;this.transform=(0,c.x)(w,t);var i=e.createRenderGeometry(t,this.view.renderCoordsHelper).points;this.geometry=[i]}},{key:"setGeometryFromSegments",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.a5;this.transform=(0,c.x)(w,i),this.geometry=e.map((function(e){return e.createRenderGeometry(i,t.view.renderCoordsHelper).points}))}},{key:"getTransformedGeometry",value:function(){var e=this;return(0,s.t)(this._geometry)?null:this._geometry.map((function(t){return t.map((function(t){return(0,h.L)((0,h.n)(),t,e.transform)}))}))}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,h.Q)(e,this._color)||((0,h.B)(this._color,e),this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){(0,s.r)(e)?!(0,s.t)(this._innerColor)&&(0,h.Q)(e,this._innerColor)||(this._innerColor=(0,h.B)((0,d.n)(),e),this._updateMaterial()):(0,s.r)(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=(0,s.r)(e)!==(0,s.r)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){((0,s.t)(e)||(0,s.t)(this._stippleOffColor)||!(0,h.Q)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,s.r)(e)?(0,d.b)(e):null,this._updateMaterial())}},{key:"stipplePreferContinuous",get:function(){return this._stipplePreferContinuous},set:function(e){this._stipplePreferContinuous!==e&&(this._stipplePreferContinuous=e,this._updateMaterial())}},{key:"writeDepthEnabled",get:function(){return this._writeDepthEnabled},set:function(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}},{key:"polygonOffset",get:function(){return this._polygonOffset},set:function(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}},{key:"createExternalResources",value:function(){this._material=new p.aS(this.materialParameters)}},{key:"destroyExternalResources",value:function(){this._material=null}},{key:"createGeometries",value:function(e){var t=this._createLineGeometries();if(0!==t.length)for(var i=0;i<t.length;++i){var n=(0,p.aT)(t[i]);e.addGeometry(n,this._material)}}},{key:"forEachExternalMaterial",value:function(e){e(this._material)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}},{key:"_updateMaterial",value:function(){this.attached&&this._material.setParameters(this.materialParameters)}},{key:"_createLineGeometries",value:function(){var e=this.geometry;if((0,s.t)(e)||0===e.length)return[];var t=[];return e.forEach((function(e){var i=e.length,n=new Float64Array(3*i);e.forEach((function(e,t){n[3*t+0]=e[0],n[3*t+1]=e[1],n[3*t+2]=e[2]}));var r={overlayInfo:null,attributeData:{position:n},removeDuplicateStartEnd:p.aU.KEEP};t.push(r)})),t}}]),i}(m),w=(0,u.e)()},15621:function(e,t,i){i.d(t,{G:function(){return De},O:function(){return Ae},a:function(){return xe},c:function(){return Ne},f:function(){return ve},k:function(){return Le},m:function(){return qe},p:function(){return Me},s:function(){return Ve},t:function(){return J},w:function(){return Te},y:function(){return Re},z:function(){return Pe}});var n,r,a,o,s,l,c,u,h,d,f=i(74165),v=i(15861),p=i(60136),_=i(29388),y=i(30168),g=i(37762),m=i(15671),b=i(43144),w=i(61340),k=i(2760),E=i(3969),S=i(40438),O=(i(89031),i(50165)),C=(i(96263),i(77322)),T=(i(31278),i(48561),i(33530),i(49961),i(40133)),R=i(78880),A=i(96401),L=i(71573),M=i(57952),P=i(87833),j=i(98643),F=i(73428),D=i(79146),Z=i(12317),z=i(15820),I=i(64747),x=i(35691),V=i(44217),N=i(24695),W=i(68634),G=i(94867),q=i(92694),B=i(9330),H=i(83262),U=i(92820),Q=i(74021),X=i(6819),Y=(i(47672),i(73627)),J=function(){function e(t){for(var i in(0,m.Z)(this,e),this.camera=new x.aX,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,M.e)(),this._worldFrame=null,this._renderLocation=(0,k.n)(),this._renderLocationDirty=!0,this._location=new C.j({x:0,y:0,z:0}),this._elevationAlignedLocation=new C.j,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=W.X.None,this._focused=!1,this.events=new T.n.EventEmitter,this._screenLocation={screenPointArray:(0,R.i)(),renderScreenPointArray:(0,R.x)(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=t.view.spatialReference,t)this[i]=t[i];this.view.state&&this.view.state.camera&&this.camera.copyFrom(this.view.state.camera)}return(0,b.Z)(e,[{key:"destroy",value:function(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this.camera=null}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}},{key:"renderObjects",get:function(){return this._renderObjects},set:function(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}},{key:"available",get:function(){return this._available},set:function(e){e!==this._available&&(this._available=e,this._updateEngineObject())}},{key:"disableDisplay",value:function(){var e=this;return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:(0,O.b7)((function(){e._noDisplayCount--,0===e._noDisplayCount&&e._updateEngineObject()}))}}},{key:"radius",get:function(){return this._radius},set:function(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}},{key:"worldSized",get:function(){return this._worldSized},set:function(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}},{key:"modelTransform",get:function(){return this._modelTransform},set:function(e){K(e)&&(this._screenLocationDirty=!0),(0,w.n)(this._modelTransform,e),this._updateEngineObject()}},{key:"renderLocation",get:function(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,M.e)()),function(e,t,i){switch(e.viewingMode){case"local":return(0,w.r)(i),!0;case"global":var n=(0,F.p)(e.renderCoordsHelper.spatialReference);(0,j.D)(t,0,oe,0,n.radius),(0,j.V)((0,k.M)(oe[0]),(0,k.M)(oe[1]),i)}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation},set:function(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}},{key:"location",get:function(){return this._location},set:function(e){(0,x.aW)(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"elevationAlignedLocation",get:function(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation},set:function(e){(0,x.aW)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}},{key:"_updateElevationAlignedLocation",value:function(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;var e=(0,O.r)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=this.location.spatialReference,this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}},{key:"grabbableForEvent",value:function(){return!0}},{key:"grabbing",get:function(){return this._grabbing},set:function(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"hovering",get:function(){return this._hovering},set:function(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}},{key:"selected",get:function(){return this._selected},set:function(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}},{key:"state",get:function(){return this._state},set:function(e){e!==this._state&&(this._state=e,this._updateEngineObject())}},{key:"updateStateEnabled",value:function(e,t){t?this.state|=e:this.state&=~e}},{key:"_setFocused",value:function(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}},{key:"focused",get:function(){return this._focused}},{key:"screenLocation",get:function(){return this._ensureScreenLocation(),this._screenLocation}},{key:"_ensureScreenLocation",value:function(){if(this._screenLocationDirty){var e;if(this._screenLocation.pixelSize=this.camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,K(this._modelTransform)){var t=this._calculateModelTransformOffset(he);e=(0,k.u)(t,t,this.renderLocation)}else e=this.renderLocation;this.camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this.camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}}},{key:"applyObjectTransform",get:function(){return this._applyObjectTransform},set:function(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"intersectionDistance",value:function(e,t){if(!this.available)return null;var i=(0,R.d)(e,$),n=this._getCollisionRadius(t),r=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,P.b)(this.screenLocation.screenPointArray,i)<n*n)return this.screenLocation.renderScreenPointArray[2]+r;break;case"line":var a=this.collisionType.paths,o=this._getWorldToScreenObjectScale(),s=this._calculateObjectTransform(o,re),l=n*this.screenLocation.pixelSize,c=(0,x.aY)(this.camera,i,te);if((0,O.t)(c))return null;var u,h=(0,g.Z)(a);try{for(h.s();!(u=h.n()).done;){var d=u.value;if(0!==d.length)for(var f=(0,k.L)(oe,d[0],s),v=1;v<d.length;v++){var p=(0,k.L)(se,d[v],s),_=(0,Z.B)((0,Z.l)(f,p,ee),c);if(null!=_&&_<l*l){var y=(0,k.u)(S.c.get(),f,p);(0,k.q)(y,y,.5);var m=(0,R.y)(S.c.get());return this.camera.projectToRenderScreen(y,m),m[2]+r}(0,k.a)(f,p)}}}catch(ye){h.e(ye)}finally{h.f()}break;case"disc":var b,w=this.collisionType.direction,E=null!==(b=this.collisionType.offset)&&void 0!==b?b:k.a5,C=this._getWorldToScreenObjectScale(),T=this._calculateObjectTransform(C,re),L=n*this.screenLocation.pixelSize,M=(0,x.aY)(this.camera,i,te);if((0,O.t)(M))return null;var j=(0,A.a)(ie,T),F=(0,k.O)(ce,w,j),D=(0,k.L)(ue,E,T);(0,z._)(D,F,ae);var I=le;if((0,z.q)(ae,M,I)&&(0,k.p)(I,D)<L*L)return this.screenLocation.renderScreenPointArray[2]+r;break;case"ribbon":var V=this.collisionType,N=V.paths,W=V.direction,G=this._getWorldToScreenObjectScale(),q=this._calculateObjectTransform(G,re),B=n*this.camera.computeScreenPixelSizeAt(this.renderLocation),H=(0,x.aY)(this.camera,i,te);if((0,O.t)(H))return null;var U=(0,A.a)(ie,q),Q=(0,k.O)(ce,W,U),X=this._calculateModelTransformPosition(ue);(0,z._)(X,Q,ae);var Y=le;if(!(0,z.q)(ae,H,Y))break;var J,K=(0,g.Z)(N);try{for(K.s();!(J=K.n()).done;){var ne=J.value;if(0!==ne.length)for(var he=(0,k.L)(oe,ne[0],q),de=1;de<ne.length;de++){var fe=(0,k.L)(se,ne[de],q),ve=(0,Z.b)((0,Z.l)(he,fe,ee),Y);if(null!=ve&&ve<B*B){var pe=(0,k.u)(S.c.get(),he,fe);(0,k.q)(pe,pe,.5);var _e=(0,R.y)(S.c.get());return this.camera.projectToRenderScreen(pe,_e),_e[2]+r}(0,k.a)(he,fe)}}}catch(ye){K.e(ye)}finally{K.f()}}return null}},{key:"attach",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}};if(this.view._stage){var i=t.manipulator3D;if((0,O.t)(i.engineLayerId)){var n=new x.l({isPickable:!1,updatePolicy:N.o.SYNC});this.view._stage.add(n),i.engineLayerId=n.id,this._engineLayer=n}else(null===(e=this.view._stage)||void 0===e?void 0:e.getObject)&&(this._engineLayer=this.view._stage.getObject(i.engineLayerId));i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,(0,O.t)(this._materialIdReferences)&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this.camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,j.A)(this._location.spatialReference,this.view.spatialReference)||(this.location=new C.j({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}}},{key:"detach",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}},t=e.manipulator3D;t.engineLayerReferences--;var i=0===t.engineLayerReferences;i&&(t.engineLayerId=null),this._removeResourcesFromStage(i),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}},{key:"onViewChange",value:function(){this.camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}},{key:"onElevationChange",value:function(e){(0,j.P)(this.location,de,e.spatialReference),(0,D.F)(e.extent,de)&&(this.location=this._location)}},{key:"_evaluateElevationAlignment",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.location;if((0,O.t)(this.elevationInfo))return!1;var t=null,i=0,n=(0,O.af)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=(0,O.af)((0,V.q)(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":i=(0,O.af)((0,V.q)(this.view.elevationProvider,e,"ground"),0)+n;break;case"relative-to-scene":i=(0,O.af)((0,V.q)(this.view.elevationProvider,e,"scene"),0)+n;break;case"absolute-height":i=n}return(i!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=i,this._elevation.override=t,!0)}},{key:"_updateEngineObject",value:function(){if(this._attached)if(this.available){var e=this._getWorldToScreenObjectScale(),t=re;if(!0===this.autoScaleRenderObjects){var i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);var n,r=this._ensureEngineResources().objectsByState,a=(this.focused?W.a0.Focused:W.a0.Unfocused)|(this.selected?W.a0.Selected:W.a0.Unselected),o=this._noDisplayCount>0,s=(0,g.Z)(r);try{for(s.s();!(n=s.n()).done;){var l=n.value,c=l.stateMask,u=l.objects;if(o){var h,d=(0,g.Z)(u);try{for(d.s();!(h=d.n()).done;){h.value.setVisible(!1)}}catch(E){d.e(E)}finally{d.f()}}else{var f=(c&W.a0.All)!==W.a0.None,v=(c&W.X.All)!==W.X.None,p=!f||(a&c)==(c&W.a0.All),_=!v||(this.state&c)==(c&W.X.All);if(p&&_){var y,m=(0,g.Z)(u);try{for(m.s();!(y=m.n()).done;){var b=y.value;b.setVisible(!0),b.transformation=t}}catch(E){m.e(E)}finally{m.f()}}else{var w,k=(0,g.Z)(u);try{for(k.s();!(w=k.n()).done;){w.value.setVisible(!1)}}catch(E){k.e(E)}finally{k.f()}}}}}catch(E){s.e(E)}finally{s.f()}}else this._removeResourcesFromStage()}},{key:"_ensureEngineResources",value:function(){if((0,O.t)(this._engineResources)){var e=(0,O.g)(this._engineLayer),t=[],i=new Set;this.renderObjects.forEach((function(e){var n=e.material;i.has(n)||(t.push(n),i.add(n))}));var n=new Map;this._renderObjects.forEach((function(e){var t=new x.aR({castShadow:!1});!function(e,t){var i=t.geometry,n=t.material,r=t.transform;Array.isArray(i)?i.forEach((function(t){return e.addGeometry(t,n,r)})):e.addGeometry(i,n,r)}(t,e);var i=e.stateMask||0,r=n.get(i)||[];r.push(t),n.set(i,r)}));var r=[];n.forEach((function(e,t){return r.push({stateMask:t,objects:e})})),this._engineResources={objectsByState:r,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}},{key:"_addResourcesToStage",value:function(){var e=this;if(!this._engineResourcesAddedToStage&&!(0,O.t)(this._engineResources)){var t=this._engineResources,i=t.objectsByState,n=t.layer;t.materials.forEach((function(t){var i=(0,O.g)(e._materialIdReferences),n=i.get(t.id)||0;0===n&&e.view._stage.add(t),i.set(t.id,n+1)})),i.forEach((function(t){var i=t.objects;n.addMany(i),e.view._stage.addMany(i)})),this._engineResourcesAddedToStage=!0}}},{key:"_removeResourcesFromStage",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._engineResourcesAddedToStage&&!(0,O.t)(this._engineResources)&&this.view._stage){var i=this._engineResources,n=i.objectsByState,r=i.layer,a=i.materials;n.forEach((function(t){var i=t.objects;r.removeMany(i),e.view._stage.removeMany(i)})),a.forEach((function(t){var i=(0,O.g)(e._materialIdReferences),n=i.get(t.id);1===n?(e.view._stage.remove(t),i.delete(t.id)):i.set(t.id,n-1)})),t&&this.view._stage.remove(r),this._engineResourcesAddedToStage=!1}}},{key:"_getCollisionRadius",value:function(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}},{key:"_getFocusedSize",value:function(e,t){return e*(t?this.focusMultiplier:1)}},{key:"_getWorldToScreenObjectScale",value:function(){return this._worldSized?1:this.screenLocation.pixelSize}},{key:"_calculateModelTransformPosition",value:function(e){var t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,ne);return(0,k.f)(e,i[12],i[13],i[14])}},{key:"_calculateModelTransformOffset",value:function(e){var t=this._calculateModelTransformPosition(e);return(0,k.e)(e,t,this.renderLocation)}},{key:"_calculateObjectTransform",value:function(e,t){return(0,w.s)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&(0,w.u)(t,t,this._worldFrame),(0,w.u)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,(0,O.r)(this._applyObjectTransform)&&this._applyObjectTransform(t),t}},{key:"test",get:function(){var e=!1;if((0,O.r)(this._engineResources))for(var t in this._engineResources.objectsByState){var i,n=this._engineResources.objectsByState[t],r=(0,g.Z)(n.objects);try{for(r.s();!(i=r.n()).done;){if(i.value.isVisible){e=!0;break}}}catch(a){r.e(a)}finally{r.f()}if(e)break}return{areAnyResourcesVisible:e}}}]),e}();function K(e){return 0!==e[12]||0!==e[13]||0!==e[14]}var $=(0,R.i)(),ee=(0,Z.v)(),te=(0,I.d)(),ie=(0,L.e)(),ne=(0,M.e)(),re=(0,M.e)(),ae=(0,z.p)(),oe=(0,k.n)(),se=(0,k.n)(),le=(0,k.n)(),ce=(0,k.n)(),ue=(0,k.n)(),he=(0,k.n)(),de=new C.j({x:0,y:0,z:0,spatialReference:null});function fe(e,t){if(t.screenSizeEnabled){var i=e.vertex;(0,q.Q)(i,t),i.uniforms.add(new q.p("perScreenPixelRatio",(function(e,t){return t.camera.perScreenPixelRatio}))),i.uniforms.add(new q.p("screenSizeScale",(function(e){return e.screenSizeScale}))),i.code.add((0,q.n)(n||(n=(0,y.Z)(["float computeRenderPixelSizeAt( vec3 pWorld ){\nvec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\nfloat viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));\nreturn viewDirectionDistance * perScreenPixelRatio;\n}\nvec3 screenSizeScaling(vec3 position, vec3 anchor){\nreturn position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;\n}"]))))}}function ve(e){var t=new q.a,i=e.hasMultipassTerrain&&(e.output===q.V.Color||e.output===q.V.Alpha);t.include(q.G),t.include(fe,e),t.include(q.U,e);var n=t.vertex,f=t.fragment;return f.include(q.q),(0,q.P)(t,e),f.uniforms.add(new q.J("uColor",(function(e){return e.color}))),t.attributes.add(G.O.POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),i&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add(G.O.OFFSET,"vec3"),e.shadingEnabled&&(n.uniforms.add(new q.e("viewNormal",(function(e,t){return t.camera.viewInverseTransposeMatrix}))),t.attributes.add(G.O.NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3")),n.code.add((0,q.n)(r||(r=(0,y.Z)(["\n    void main(void) {\n      vWorldPosition = ",";\n  "])),e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position")),e.shadingEnabled&&n.code.add((0,q.n)(a||(a=(0,y.Z)(["vec3 worldNormal = normal;\nvViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;"])))),n.code.add((0,q.n)(o||(o=(0,y.Z)(["\n    ","\n    gl_Position = transformPosition(proj, view, vWorldPosition);\n  }\n  "])),i?"depth = (view * vec4(vWorldPosition, 1.0)).z;":"")),i&&t.include(q.ak,e),f.code.add((0,q.n)(s||(s=(0,y.Z)(["\n    void main() {\n      discardBySlice(vWorldPosition);\n      ","\n    "])),i?"terrainDepthTest(gl_FragCoord, depth);":"")),e.shadingEnabled?(f.uniforms.add(new q.b("shadingDirection",(function(e){return e.shadingDirection}))),f.uniforms.add(new q.J("shadedColor",(function(e){return pe(e.shadingTint,e.color)}))),f.code.add((0,q.n)(l||(l=(0,y.Z)(["vec3 viewNormalNorm = normalize(vViewNormal);\nfloat shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\nvec4 finalColor = mix(uColor, shadedColor, shadingFactor);"]))))):f.code.add((0,q.n)(c||(c=(0,y.Z)(["vec4 finalColor = uColor;"])))),f.code.add((0,q.n)(u||(u=(0,y.Z)(["\n      if (finalColor.a < ",") {\n        discard;\n      }\n      ","\n\n      ","\n    }\n    "])),q.n.float(q.$),e.output===q.V.Alpha?(0,q.n)(h||(h=(0,y.Z)(["gl_FragColor = vec4(finalColor.a);"]))):"",e.output===q.V.Color?(0,q.n)(d||(d=(0,y.Z)(["gl_FragColor = highlightSlice(finalColor, vWorldPosition); ",""])),e.transparencyPassType===N.O.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""):"")),t}function pe(e,t){var i=1-e[3],n=e[3]+t[3]*i;return 0===n?(_e[3]=n,_e):(_e[0]=(e[0]*e[3]+t[0]*t[3]*i)/n,_e[1]=(e[1]*e[3]+t[1]*t[3]*i)/n,_e[2]=(e[2]*e[3]+t[2]*t[3]*i)/n,_e[3]=t[3],_e)}var _e=(0,E.n)(),ye=Object.freeze(Object.defineProperty({__proto__:null,build:ve},Symbol.toStringTag,{value:"Module"})),ge=function(e){(0,p.Z)(i,e);var t=(0,_.Z)(i);function i(){return(0,m.Z)(this,i),t.apply(this,arguments)}return(0,b.Z)(i,[{key:"initializeProgram",value:function(e){var t=i.shader.get().build(this.configuration);return new q.h(e.rctx,t,be)}},{key:"_setPipelineState",value:function(e){var t=this.configuration,i=e===N.O.NONE,n=e===N.O.FrontFace;return(0,N.W)({blending:t.output!==q.V.Color&&t.output!==q.V.Alpha||!t.transparent?null:i?N.d:(0,N.E)(e),culling:(0,N.k)(t.cullFace),depthTest:{func:n?X.I.LESS:t.shadingEnabled?X.I.LEQUAL:X.I.LESS},depthWrite:i?t.writeDepth&&N.b:(0,N.S)(e),colorWrite:N.c,polygonOffset:i||n?null:N.f})}},{key:"initializePipeline",value:function(){return this._setPipelineState(this.configuration.transparencyPassType)}}]),i}(q.g);ge.shader=new q.t(ye,(function(){return i.e(4051).then(i.bind(i,14051))}));var me=function(e){(0,p.Z)(i,e);var t=(0,_.Z)(i);function i(){var e;return(0,m.Z)(this,i),(e=t.apply(this,arguments)).output=q.V.Color,e.cullFace=N.n.None,e.transparencyPassType=N.O.NONE,e.hasSlicePlane=!1,e.transparent=!1,e.writeDepth=!0,e.screenSizeEnabled=!0,e.shadingEnabled=!0,e.hasMultipassTerrain=!1,e.cullAboveGround=!1,e}return(0,b.Z)(i)}(q.a2);(0,O.e)([(0,q.j)({count:q.V.COUNT})],me.prototype,"output",void 0),(0,O.e)([(0,q.j)({count:N.n.COUNT})],me.prototype,"cullFace",void 0),(0,O.e)([(0,q.j)({count:N.O.COUNT})],me.prototype,"transparencyPassType",void 0),(0,O.e)([(0,q.j)()],me.prototype,"hasSlicePlane",void 0),(0,O.e)([(0,q.j)()],me.prototype,"transparent",void 0),(0,O.e)([(0,q.j)()],me.prototype,"writeDepth",void 0),(0,O.e)([(0,q.j)()],me.prototype,"screenSizeEnabled",void 0),(0,O.e)([(0,q.j)()],me.prototype,"shadingEnabled",void 0),(0,O.e)([(0,q.j)()],me.prototype,"hasMultipassTerrain",void 0),(0,O.e)([(0,q.j)()],me.prototype,"cullAboveGround",void 0);var be=new Map([[G.O.POSITION,0],[G.O.NORMAL,1],[G.O.OFFSET,2]]),we=function(e){(0,p.Z)(i,e);var t=(0,_.Z)(i);function i(e){var n;return(0,m.Z)(this,i),(n=t.call(this,e,new Ee)).supportsEdges=!0,n.techniqueConfig=new me,n._vertexAttributeLocations=be,n}return(0,b.Z)(i,[{key:"getConfiguration",value:function(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.screenSizeEnabled=this.parameters.screenSizeEnabled,this.techniqueConfig.shadingEnabled=this.parameters.shadingEnabled,this.techniqueConfig.transparencyPassType=t.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=t.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=t.multipassTerrain.cullAboveGround,this.techniqueConfig}},{key:"intersect",value:function(e,t,i,n,r,a,o){var s=this;if(this.parameters.screenSizeEnabled){var l=e.vertexAttributes.get(G.O.OFFSET),c={applyToVertex:function(e,t,i,r){var a=(0,k.f)(Oe,l.data[3*r+0],l.data[3*r+1],l.data[3*r+2]),o=(0,k.f)(Ce,e,t,i);return(0,k.q)(a,a,s.parameters.screenSizeScale*n.camera.computeRenderPixelSizeAt(a)),(0,k.u)(o,o,a),[o[0],o[1],o[2]]},applyToAabb:function(e){var t=(0,B.p)(e,Oe);return(0,B.Y)(e,s.parameters.screenSizeScale*n.camera.computeRenderPixelSizeAt(t))}};(0,q.aA)(e,t,n,r,a,c,o)}else(0,q.aA)(e,t,n,r,a,void 0,o)}},{key:"requiresSlot",value:function(e,t){if((0,x.D)(t)===q.V.Highlight)return e===q.C.OPAQUE_MATERIAL;var i=q.C.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?q.C.TRANSPARENT_MATERIAL:q.C.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i||e===q.C.DRAPED_MATERIAL}},{key:"createGLMaterial",value:function(e){return e.output===q.V.Color||e.output===q.V.Alpha||e.output===q.V.Highlight?new ke(e):null}},{key:"createBufferWriter",value:function(){return new Se(this.parameters.screenSizeEnabled)}}]),i}(q.a3),ke=function(e){(0,p.Z)(i,e);var t=(0,_.Z)(i);function i(){return(0,m.Z)(this,i),t.apply(this,arguments)}return(0,b.Z)(i,[{key:"beginSlot",value:function(e){return this.ensureTechnique(ge,e)}}]),i}(q.ah),Ee=function(e){(0,p.Z)(i,e);var t=(0,_.Z)(i);function i(){var e;return(0,m.Z)(this,i),(e=t.apply(this,arguments)).color=(0,E.r)(1,1,1,1),e.shadingTint=(0,E.r)(0,0,0,.25),e.shadingDirection=(0,k.z)((0,k.n)(),[.5,-.5,-.5]),e.screenSizeScale=14,e.transparent=!1,e.writeDepth=!0,e.hasSlicePlane=!1,e.cullFace=N.n.None,e.screenSizeEnabled=!1,e.shadingEnabled=!0,e}return(0,b.Z)(i)}(q.ai),Se=function(){function e(t){(0,m.Z)(this,e),this.screenSizeEnabled=t;var i=(0,U.T)().vec3f(G.O.POSITION).vec3f(G.O.NORMAL);this.screenSizeEnabled&&i.vec3f(G.O.OFFSET),this.vertexBufferLayout=i}return(0,b.Z)(e,[{key:"allocate",value:function(e){return this.vertexBufferLayout.createBuffer(e)}},{key:"elementCount",value:function(e){return e.indices.get(G.O.POSITION).length}},{key:"write",value:function(e,t,i,n){if((0,q.az)(t,this.vertexBufferLayout,e.transformation,e.invTranspTransformation,i,n),this.screenSizeEnabled){if(!t.vertexAttributes.has(G.O.OFFSET))throw new Error("".concat(G.O.OFFSET," vertex attribute required for screenSizeEnabled ShadedColorMaterial"));var r=t.vertexAttributes.get(G.O.OFFSET),a=t.indices.get(G.O.OFFSET);(0,Q.e)(3===r.size);var o=i.getField(G.O.OFFSET,H.i);if(!o)throw new Error("unable to acquire view for "+G.O.OFFSET);(0,q.aa)(a,r.data,e.invTranspTransformation,o,n)}}}]),e}(),Oe=(0,k.n)(),Ce=(0,k.n)();function Te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.a9.OccludeAndTransparent,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=(0,E.r)(e[0],e[1],e[2],e.length>3?e[3]:1),r=e[3]<1;return i?new we({color:n,transparent:r,writeDepth:!0,cullFace:N.n.Back,renderOccluded:t}):new x.aZ({color:n,transparent:r,writeDepth:!0,cullFace:N.n.Back,renderOccluded:t})}function Re(e,t,i){return new J({view:e,renderObjects:[{geometry:x.T.createSphereGeometry(1,32,32),material:Te((0,E.r)(t[0],t[1],t[2],null!=i?i:1))}]})}function Ae(e,t,i,n){var r=(0,k.e)(S.c.get(),e,i),a=Le(r,(0,k._)(S.c.get(),n,r),i,S.f.get());(0,w.h)(a,a);var o=(0,k.L)(S.c.get(),t,a);return Math.atan2(o[1],o[0])}function Le(e,t,i,n){var r=(0,k.z)(S.c.get(),e),a=(0,k.z)(S.c.get(),t),o=(0,k._)(S.c.get(),r,a);return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=0,n[4]=a[0],n[5]=a[1],n[6]=a[2],n[7]=0,n[8]=o[0],n[9]=o[1],n[10]=o[2],n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n}function Me(e,t){return e.events.on("drag",function(e,t){var i=null,n=null;return function(r){if("cancel"!==r.action){var a={action:r.action,screenStart:r.start,screenEnd:r.screenPoint};"start"===r.action&&(0,O.t)(i)&&(i=new De,n=new De,t(e,i,n,r.pointerType,a)),(0,O.r)(i)&&i.execute(a),"end"===r.action&&(0,O.r)(i)&&(i=null,n=null)}else(0,O.r)(n)&&(n.execute({action:"cancel"}),i=null,n=null)}}(e,t))}function Pe(e,t){var i,n=new Map,r=(0,g.Z)(t);try{for(r.s();!(i=r.n()).done;){var a=i.value;n.set(a,(0,O.m)(e[a]))}}catch(o){r.e(o)}finally{r.f()}return function(t){return n.forEach((function(t,i){e[i]=t})),t}}var je,Fe,De=function(){function e(){(0,m.Z)(this,e),this.execute=function(){}}return(0,b.Z)(e,[{key:"next",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new e;return(0,O.r)(t)&&(this.execute=function(e){var n=t(e);(0,O.r)(n)&&i.execute(n)}),i}}]),e}();(Fe=je||(je={}))[Fe.WhenToolEditable=0]="WhenToolEditable",Fe[Fe.WhenToolNotEditable=1]="WhenToolNotEditable",Fe[Fe.Always=2]="Always";var Ze=function(){function e(){(0,m.Z)(this,e),this._isToolEditable=!0,this._manipulators=new T.j,this._nextManipulatorId=0,this._resourceContexts={manipulator3D:{}},this._attached=!1}return(0,b.Z)(e,[{key:"isToolEditable",set:function(e){this._isToolEditable=e}},{key:"length",get:function(){return this._manipulators.length}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:je.WhenToolEditable;return this.addMany([e],t)[0]}},{key:"addMany",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:je.WhenToolEditable;return e.map((function(e){var n=t._nextManipulatorId++,r={id:n,manipulator:e,visibilityPredicate:i,attached:!1};return t._manipulators.add(r),t._attached&&t._updateManipulatorAttachment(r),n}))}},{key:"remove",value:function(e){if("number"==typeof e){for(var t=e,i=0;i<this._manipulators.length;i++)if(this._manipulators.getItemAt(i).id===t){var n=this._manipulators.splice(i,1)[0];return this._detachManipulator(n),n.id}return null}for(var r=e,a=0;a<this._manipulators.length;a++)if(this._manipulators.getItemAt(a).manipulator===r){var o=this._manipulators.splice(a,1)[0];return this._detachManipulator(o),o.id}return null}},{key:"removeAll",value:function(){var e=this;this._manipulators.forEach((function(t){e._detachManipulator(t)})),this._manipulators.removeAll()}},{key:"attach",value:function(){var e=this;this._manipulators.forEach((function(t){e._updateManipulatorAttachment(t)})),this._attached=!0}},{key:"detach",value:function(){var e=this;this._manipulators.forEach((function(t){e._detachManipulator(t)})),this._attached=!1}},{key:"destroy",value:function(){this._manipulators.forEach((function(e){var t=e.manipulator;t.destroy&&t.destroy()})),this._manipulators.destroy(),this._resourceContexts=null}},{key:"on",value:function(e,t){return this._manipulators.on(e,(function(e){t(e)}))}},{key:"forEach",value:function(e){var t,i=(0,g.Z)(this._manipulators.items);try{for(i.s();!(t=i.n()).done;){e(t.value)}}catch(n){i.e(n)}finally{i.f()}}},{key:"some",value:function(e){return this._manipulators.items.some(e)}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){return e.push(t.manipulator)})),e}},{key:"intersect",value:function(e,t){var i=null,n=Number.MAX_VALUE;return this._manipulators.forEach((function(r){var a=r.id,o=r.manipulator;if(r.attached&&o.interactive){var s=o.intersectionDistance(e,t);(0,O.r)(s)&&s<n&&(n=s,i={id:a,manipulator:o})}})),i}},{key:"findById",value:function(e){if((0,O.t)(e))return null;var t,i=(0,g.Z)(this._manipulators.items);try{for(i.s();!(t=i.n()).done;){var n=t.value;if(e===n.id)return n.manipulator}}catch(r){i.e(r)}finally{i.f()}return null}},{key:"_updateManipulatorAttachment",value:function(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}},{key:"_attachManipulator",value:function(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}},{key:"_detachManipulator",value:function(e){if(e.attached){var t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}}},{key:"_isManipulatorItemVisible",value:function(e){return e.visibilityPredicate===je.Always||(this._isToolEditable?e.visibilityPredicate===je.WhenToolEditable:e.visibilityPredicate===je.WhenToolNotEditable)}}]),e}(),ze=O.s.getLogger("esri.views.interactive.InteractiveToolBase"),Ie=function(e){(0,p.Z)(i,e);var t=(0,_.Z)(i);function i(e){var n;return(0,m.Z)(this,i),(n=t.call(this,e)).manipulators=new Ze,n.preferManipulatorCursor=!1,n.automaticManipulatorSelection=!0,n.hasFocusedManipulators=!1,n.created=!1,n.removeIncompleteOnCancel=!0,n._editableFlags=new Map([[W.a1.MANAGER,!0],[W.a1.USER,!0]]),n._creationFinishedResolver=(0,O.aO)(),n}return(0,b.Z)(i,[{key:"active",get:function(){return null!=this.view&&this.view.activeTool===this}},{key:"visible",set:function(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}},{key:"editable",get:function(){return this.getEditableFlag(W.a1.USER)},set:function(e){this.setEditableFlag(W.a1.USER,e)}},{key:"updating",get:function(){return!1}},{key:"cursor",get:function(){return null}},{key:"destroy",value:function(){this.manipulators.destroy(),this._set("view",null)}},{key:"onAdd",value:function(){this._syncVisible()}},{key:"activate",value:function(){(0,O.t)(this.view)?ze.error("Can't activate tool if view is not defined."):((0,W.a2)(this.view)&&this.view.focus(),this.onActivate())}},{key:"deactivate",value:function(){this.onDeactivate()}},{key:"handleInputEvent",value:function(e){this.onInputEvent(e)}},{key:"handleInputEventAfter",value:function(e){this.onInputEventAfter(e)}},{key:"setEditableFlag",value:function(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===W.a1.USER&&this.notifyChange("editable"),this.onEditableChange()}},{key:"getEditableFlag",value:function(e){return this._editableFlags.get(e)}},{key:"whenCreated",value:function(){return this._creationFinishedResolver.promise}},{key:"onActivate",value:function(){}},{key:"onDeactivate",value:function(){}},{key:"onShow",value:function(){}},{key:"onHide",value:function(){}},{key:"onEditableChange",value:function(){}},{key:"onInputEvent",value:function(e){}},{key:"onInputEventAfter",value:function(e){}},{key:"internallyEditable",get:function(){return this.getEditableFlag(W.a1.USER)&&this.getEditableFlag(W.a1.MANAGER)}},{key:"finishToolCreation",value:function(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}},{key:"_syncVisible",value:function(){if(this.constructed)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}},{key:"_show",value:function(){this._updateManipulatorAttachment(),this.onShow()}},{key:"_hide",value:function(){this._updateManipulatorAttachment(),this.onHide()}},{key:"_updateManipulatorAttachment",value:function(){this.visible?this.manipulators.attach():this.manipulators.detach()}}]),i}(O.y);(0,O.e)([(0,O.d)({constructOnly:!0})],Ie.prototype,"view",void 0),(0,O.e)([(0,O.d)({readOnly:!0})],Ie.prototype,"active",null),(0,O.e)([(0,O.d)({value:!0})],Ie.prototype,"visible",null),(0,O.e)([(0,O.d)({value:!0})],Ie.prototype,"editable",null),(0,O.e)([(0,O.d)({readOnly:!0})],Ie.prototype,"manipulators",void 0),(0,O.e)([(0,O.d)({readOnly:!0})],Ie.prototype,"updating",null),(0,O.e)([(0,O.d)()],Ie.prototype,"cursor",null),(0,O.e)([(0,O.d)({readOnly:!0})],Ie.prototype,"preferManipulatorCursor",void 0),(0,O.e)([(0,O.d)({readOnly:!0})],Ie.prototype,"automaticManipulatorSelection",void 0),(0,O.e)([(0,O.d)()],Ie.prototype,"hasFocusedManipulators",void 0),(0,O.e)([(0,O.d)({readOnly:!0})],Ie.prototype,"created",void 0),(0,O.e)([(0,O.d)({readOnly:!0})],Ie.prototype,"removeIncompleteOnCancel",void 0);var xe=function(e){(0,p.Z)(i,e);var t=(0,_.Z)(i);function i(e){return(0,m.Z)(this,i),t.call(this,e)}return(0,b.Z)(i,[{key:"initialize",value:function(){var e=this;this.own((0,Y.l)((function(){return e.analysisViewData.visible}),(function(t){return e.visible=t}),Y.w))}},{key:"deactivate",value:function(){this.onDeactivate(),this.created||this.analysis.clear()}},{key:"resetCreated",value:function(){this._set("created",!1)}}]),i}(Ie=(0,O.e)([(0,O.n)("esri.views.interactive.InteractiveToolBase")],Ie));function Ve(e,t,i){var n=Ge(e,t);e.view.activeTool=n;var r=(0,O.x)(i,(function(){return We(e,t)}));return(0,O.aK)(function(){var i=(0,v.Z)((0,f.Z)().mark((function i(a){return(0,f.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(0,Y.j)((function(){return!n.active}),a);case 2:r=(0,O.z)(r),We(e,t);case 4:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}(),i)}function Ne(e,t){return(0,Y.l)((function(){return e.interactive}),(function(){return We(e,t)}),Y.w)}function We(e,t){e.interactive?Ge(e,t):qe(e)}function Ge(e,t){qe(e);var i=e.view,n=new t({view:i,analysis:e.analysis,analysisViewData:e});return e.tool=n,i.tools.add(n),n}function qe(e){var t=e.view,i=e.tool;(0,O.t)(i)||(t.tools.remove(i),e.tool=null)}(0,O.e)([(0,O.d)({constructOnly:!0})],xe.prototype,"analysis",void 0),(0,O.e)([(0,O.d)()],xe.prototype,"analysisViewData",void 0),xe=(0,O.e)([(0,O.n)("esri.views.interactive.AnalysisToolBase")],xe)}}]);
//# sourceMappingURL=6902.c671cd6e.chunk.js.map