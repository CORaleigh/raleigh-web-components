"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[7340],{55944:function(e,t,i){i.d(t,{s:function(){return r},t:function(){return a}});var r,n=i(15671),s=i(43144),a=function(){function e(t,i){(0,n.Z)(this,e),this.x=t,this.y=i}return(0,s.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"equals",value:function(e,t){return e===this.x&&t===this.y}},{key:"isEqual",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"setCoords",value:function(e,t){this.x=e,this.y=t}},{key:"normalize",value:function(){var e=this.x,t=this.y,i=Math.sqrt(e*e+t*t);this.x/=i,this.y/=i}},{key:"rightPerpendicular",value:function(){var e=this.x;this.x=this.y,this.y=-e}},{key:"move",value:function(e,t){this.x+=e,this.y+=t}},{key:"assign",value:function(e){this.x=e.x,this.y=e.y}},{key:"assignAdd",value:function(e,t){this.x=e.x+t.x,this.y=e.y+t.y}},{key:"assignSub",value:function(e,t){this.x=e.x-t.x,this.y=e.y-t.y}},{key:"rotate",value:function(e,t){var i=this.x,r=this.y;this.x=i*e-r*t,this.y=i*t+r*e}},{key:"scale",value:function(e){this.x*=e,this.y*=e}},{key:"length",value:function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}}],[{key:"distance",value:function(e,t){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}},{key:"add",value:function(t,i){return new e(t.x+i.x,t.y+i.y)}},{key:"sub",value:function(t,i){return new e(t.x-i.x,t.y-i.y)}}]),e}();!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(r||(r={}))},43924:function(e,t,i){i.d(t,{P:function(){return c},a:function(){return h},b:function(){return y},f:function(){return o},h:function(){return u},n:function(){return r},r:function(){return s},t:function(){return n}});var r=Number.POSITIVE_INFINITY,n=Math.PI,s=2*n,a=128/n,o=n/180,l=1/Math.LN2;function h(e,t){return(e%=t)>=0?e:e+t}function u(e){return h(e*a,256)}function c(e){return Math.log(e)*l}function y(e,t,i){return e*(1-i)+t*i}},52195:function(e,t,i){i.d(t,{u:function(){return v}});var r=i(15671),n=i(43144),s=i(60136),a=i(29388),o=i(48848),l=i(37856),h=i(630),u=i(92072),c=i(93661),y=i(65094),f=function(e){(0,s.Z)(i,e);var t=(0,a.Z)(i);function i(e){var n;return(0,r.Z)(this,i),(n=t.call(this,e)).layer=null,n.parent=null,n}return(0,n.Z)(i,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){if("layerview:create-error"!==t.name){var i=e.layer&&e.layer.id||"no id",r=e.layer&&e.layer.title||"no title";o.a.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(i,"')"),t)}}))}},{key:"fullOpacity",get:function(){return(0,c.v)(this.get("layer.opacity"),1)*(0,c.v)(this.get("parent.fullOpacity"),1)}},{key:"suspended",get:function(){return!this.canResume()}},{key:"suspendInfo",get:function(){return this.getSuspendInfo()}},{key:"legendEnabled",get:function(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}},{key:"updating",get:function(){var e;return!((null===(e=this.updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}},{key:"updatingProgress",get:function(){return this.updating?0:1}},{key:"visible",get:function(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)},set:function(e){this._overrideIfSome("visible",e)}},{key:"canResume",value:function(){var e,t,i;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&!(null!==(t=this.parent)&&void 0!==t&&t.suspended)&&(null===(i=this.view)||void 0===i?void 0:i.ready)||!1}},{key:"getSuspendInfo",value:function(){var e=this.parent&&this.parent.suspended?this.parent.suspendInfo:{};return this.view&&this.view.ready||(e.viewNotReady=!0),this.layer&&this.layer.loaded||(e.layerNotLoaded=!0),this.visible||(e.layerInvisible=!0),e}},{key:"isUpdating",value:function(){return!1}}]),i}((0,h.a)((0,u.s)((0,y.m)(l.n.EventedMixin(o.m)))));(0,o.e)([(0,o.y)()],f.prototype,"fullOpacity",null),(0,o.e)([(0,o.y)()],f.prototype,"layer",void 0),(0,o.e)([(0,o.y)()],f.prototype,"parent",void 0),(0,o.e)([(0,o.y)({readOnly:!0})],f.prototype,"suspended",null),(0,o.e)([(0,o.y)({readOnly:!0})],f.prototype,"suspendInfo",null),(0,o.e)([(0,o.y)({readOnly:!0})],f.prototype,"legendEnabled",null),(0,o.e)([(0,o.y)({type:Boolean,readOnly:!0})],f.prototype,"updating",null),(0,o.e)([(0,o.y)({readOnly:!0})],f.prototype,"updatingProgress",null),(0,o.e)([(0,o.y)()],f.prototype,"visible",null),(0,o.e)([(0,o.y)()],f.prototype,"view",void 0);var v=f=(0,o.e)([(0,o.n)("esri.views.layers.LayerView")],f)},36748:function(e,t,i){i.d(t,{t:function(){return s}});var r=i(15671),n=i(43144),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,r.Z)(this,e),this.x=t,this.y=i,this.width=n,this.height=s}return(0,n.Z)(e,[{key:"isEmpty",get:function(){return this.width<=0||this.height<=0}},{key:"union",value:function(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}]),e}()},42525:function(e,t,i){i.d(t,{i:function(){return N},l:function(){return O},n:function(){return z},r:function(){return V},t:function(){return W}});var r=i(11752),n=i(61120),s=i(60136),a=i(29388),o=i(74165),l=i(1413),h=i(15861),u=i(29439),c=i(37762),y=i(15671),f=i(43144),v=i(48848),d=i(40558),g=i(85113),_=i(36748),p=i(93122),m=i(75833),w=i(35182),b=i(72448),x=i(51732),S=i(43066),k=i(65636),Z=i(2467),P=i(92739),I=i(93661),T=i(3356),M=i(65703),R=function(){function e(t,i){(0,y.Z)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new _.t(0,0,t,i))}return(0,f.Z)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new _.t;for(var i=null,r=-1,n=0;n<this._free.length;++n){var s=this._free[n];e<=s.width&&t<=s.height&&(null===i||s.y<=i.y&&s.x<=i.x)&&(i=s,r=n)}return null===i?new _.t:(this._free.splice(r,1),i.width<i.height?(i.width>e&&this._free.push(new _.t(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new _.t(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new _.t(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new _.t(i.x,i.y+t,e,i.height-t))),new _.t(i.x,i.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}(),C=function(){function e(t,i,r){(0,y.Z)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=i,this._glyphSource=r,this._binPack=new R(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(void 0)}return(0,f.Z)(e,[{key:"getGlyphItems",value:function(e,t){var i,r=this,n=[],s=this._glyphSource,a=new Set,o=(0,c.Z)(t);try{for(o.s();!(i=o.n()).done;){var l=i.value,h=Math.floor(.00390625*l);a.add(h)}}catch(y){o.e(y)}finally{o.f()}var u=[];return a.forEach((function(t){if(t<=256){var i=e+t;if(r._rangePromises.has(i))u.push(r._rangePromises.get(i));else{var n=s.getRange(e,t).then((function(){r._rangePromises.delete(i)}),(function(){r._rangePromises.delete(i)}));r._rangePromises.set(i,n),u.push(n)}}})),Promise.all(u).then((function(){var i=r._glyphIndex[e];i||(i={},r._glyphIndex[e]=i);var a,o=(0,c.Z)(t);try{for(o.s();!(a=o.n()).done;){var l=a.value,h=i[l];if(h)n[l]={sdf:!0,rect:h.rect,metrics:h.metrics,page:h.page,code:l};else{var u=s.getGlyph(e,l);if(u&&u.metrics){var f=u.metrics,v=void 0;if(0===f.width)v=new _.t(0,0,0,0);else{var d=f.width+6,g=f.height+6,p=d%4?4-d%4:4,m=g%4?4-g%4:4;1===p&&(p=5),1===m&&(m=5),(v=r._binPack.allocate(d+p,g+m)).isEmpty&&(r._dirties[r._currentPage]||(r._glyphData[r._currentPage]=null),r._currentPage=r._glyphData.length,r._glyphData.push(new Uint8Array(r.width*r.height)),r._dirties.push(!0),r._textures.push(void 0),r._binPack=new R(r.width-4,r.height-4),v=r._binPack.allocate(d+p,g+m));var w=r._glyphData[r._currentPage],b=u.bitmap,x=void 0,S=void 0;if(b)for(var k=0;k<g;k++){x=d*k,S=r.width*(v.y+k+1)+v.x;for(var Z=0;Z<d;Z++)w[S+Z+1]=b[x+Z]}}i[l]={rect:v,metrics:f,tileIDs:null,page:r._currentPage},n[l]={sdf:!0,rect:v,metrics:f,page:r._currentPage,code:l},r._dirties[r._currentPage]=!0}}}}catch(y){o.e(y)}finally{o.f()}return n}))}},{key:"removeGlyphs",value:function(e){for(var t in this._glyphIndex){var i=this._glyphIndex[t];if(i){var r=void 0;for(var n in i)if((r=i[n]).tileIDs.delete(e),0===r.tileIDs.size){for(var s=this._glyphData[r.page],a=r.rect,o=void 0,l=void 0,h=0;h<a.height;h++)for(o=this.width*(a.y+h)+a.x,l=0;l<a.width;l++)s[o+l]=0;delete i[n],this._dirties[r.page]=!0}}}}},{key:"bind",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[i]||(this._textures[i]=new m.E(e,{pixelFormat:p.P.ALPHA,dataType:p.G.UNSIGNED_BYTE,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var n=this._textures[i];n.setSamplingMode(t),this._dirties[i]&&n.setData(this._glyphData[i]),e.bindTexture(n,r),this._dirties[i]=!1}},{key:"dispose",value:function(){this._binPack=null;var e,t=(0,c.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(r){t.e(r)}finally{t.f()}this._textures.length=0}}]),e}(),D=function(){function e(t){if((0,y.Z)(this,e),this._metrics=[],this._bitmaps=[],t)for(;t.next();)if(1===t.tag()){for(var i=t.getMessage();i.next();)if(3===i.tag()){for(var r=i.getMessage(),n=void 0,s=void 0,a=void 0,o=void 0,l=void 0,h=void 0,u=void 0;r.next();)switch(r.tag()){case 1:n=r.getUInt32();break;case 2:s=r.getBytes();break;case 3:a=r.getUInt32();break;case 4:o=r.getUInt32();break;case 5:l=r.getSInt32();break;case 6:h=r.getSInt32();break;case 7:u=r.getUInt32();break;default:r.skip()}r.release(),n&&(this._metrics[n]={width:a,height:o,left:l,top:h,advance:u},this._bitmaps[n]=s)}else i.skip();i.release()}else t.skip()}return(0,f.Z)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),L=function(){function e(){(0,y.Z)(this,e),this._ranges=[]}return(0,f.Z)(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),A=function(){function e(t){(0,y.Z)(this,e),this._glyphInfo={},this._baseURL=t}return(0,f.Z)(e,[{key:"getRange",value:function(e,t){var i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();var r=256*t,n=r+255;if(this._baseURL){var s=this._baseURL.replace("{fontstack}",e).replace("{range}",r+"-"+n);return(0,d.U)(s,{responseType:"array-buffer"}).then((function(e){i.addRange(t,new D(new w.n(new Uint8Array(e.data),new DataView(e.data))))})).catch((function(){i.addRange(t,new D)}))}return i.addRange(t,new D),Promise.resolve()}},{key:"getGlyph",value:function(e,t){var i=this._getFontStack(e);if(i){var r=Math.floor(t/256);if(!(r>256)){var n=i.getRange(r);return n?{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new L),t}}]),e}(),U="dasharray-",q=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,y.Z)(this,e),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=i,r>0&&(this._maxItemSize=r),this._binPack=new R(t-4,i-4)}return(0,f.Z)(e,[{key:"dispose",value:function(){this._binPack=null,this._mosaicRects={};var e,t=(0,c.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(r){t.e(r)}finally{t.f()}this._textures.length=0}},{key:"getWidth",value:function(e){return e>=this._size.length?-1:this._size[e][0]}},{key:"getHeight",value:function(e){return e>=this._size.length?-1:this._size[e][1]}},{key:"getPageSize",value:function(e){return e>=this._size.length?null:this._size[e]}},{key:"setSpriteSource",value:function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new R(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),r=new Uint32Array(t*i);this._mosaicsData[0]=r,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}},{key:"getSpriteItem",value:function(e){var t,i,r,n,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this._mosaicRects[e];if(a)return a;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith(U)?(t=this._rasterizeDash(e),r=(i=(0,u.Z)(t,2))[0],n=i[1],s=!0):r=this._sprites.getSpriteInfo(e),!r||!r.width||!r.height||r.width<0||r.height<0)return null;var o=r.width,l=r.height,h=this._allocateImage(o,l),c=(0,u.Z)(h,3),y=c[0],f=c[1],v=c[2];return y.width<=0?null:(this._copy(y,r,f,v,s,n),a={rect:y,width:o,height:l,sdf:r.sdf,simplePattern:!1,pixelRatio:r.pixelRatio,page:f},this._mosaicRects[e]=a,a)}},{key:"getSpriteItems",value:function(e){var t,i={},r=(0,c.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;i[n.name]=this.getSpriteItem(n.name,n.repeat)}}catch(s){r.e(s)}finally{r.f()}return i}},{key:"getMosaicItemPosition",value:function(e,t){var i=this.getSpriteItem(e,t),r=i&&i.rect;if(!r)return null;r.width=i.width,r.height=i.height;var n=i.width,s=i.height;return{tl:[r.x+2,r.y+2],br:[r.x+2+n,r.y+2+s],page:i.page}}},{key:"bind",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!(i>=this._size.length||i>=this._mosaicsData.length)){this._textures[i]||(this._textures[i]=new m.E(e,{pixelFormat:p.P.RGBA,dataType:p.G.UNSIGNED_BYTE,wrapMode:p.D.CLAMP_TO_EDGE,width:this._size[i][0],height:this._size[i][1]},new Uint8Array(this._mosaicsData[i].buffer)));var n=this._textures[i];n.setSamplingMode(t),this._dirties[i]&&n.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(n,r),this._dirties[i]=!1}}},{key:"_copy",value:function(t,i,r,n,s,a){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var o=new Uint32Array(a?a.buffer:this._sprites.image.buffer),l=this._mosaicsData[r];l&&o||console.error("Source or target images are uninitialized!");var h=a?i.width:this._sprites.width;e._copyBits(o,h,i.x,i.y,l,n[0],t.x+2,t.y+2,i.width,i.height,s),this._dirties[r]=!0}}},{key:"_allocateImage",value:function(e,t){e+=2,t+=2;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var r=new _.t(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[r,this._mosaicsData.length-1,[e,t]]}var n=e%4?4-e%4:4,s=t%4?4-t%4:4;1===n&&(n=5),1===s&&(s=5);var a=this._binPack.allocate(e+n,t+s);return a.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new R(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[a,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"_rasterizeDash",value:function(e){var t=e.match(/\[(.*?)\]/);if(!t)return null;var i=t[1].split(",").map(Number),r=e.slice(e.lastIndexOf("-")+1),n=(0,b.e)(i,r),s=(0,u.Z)(n,3),a=s[0];return[{x:0,y:0,width:s[1],height:s[2],sdf:!0,pixelRatio:1},new Uint8Array(a.buffer)]}}],[{key:"_copyBits",value:function(e,t,i,r,n,s,a,o,l,h,u){var c=r*t+i,y=o*s+a;if(u){y-=s;for(var f=-1;f<=h;c=((++f+h)%h+r)*t+i,y+=s)for(var v=-1;v<=l;v++)n[y+v]=e[c+(v+l)%l]}else for(var d=0;d<h;d++){for(var g=0;g<l;g++)n[y+g]=e[c+g];c+=t,y+=s}}}]),e}(),z=function(){function e(t,i,r){(0,y.Z)(this,e),this._layer=t,this._styleRepository=i,this.devicePixelRatio=r,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null}return(0,f.Z)(e,[{key:"destroy",value:function(){this._connection&&(this._connection.close(),this._connection=null),this._styleRepository=null,this._layer=null,this._spriteMosaic&&(this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic=null)}},{key:"spriteMosaic",get:function(){var e=this;return this._spriteSourcePromise.then((function(){return e._spriteMosaic}))}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}},{key:"start",value:function(){var e=(0,h.Z)((0,o.Z)().mark((function e(t){var i,r=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then((function(e){r._spriteMosaic=new q(1024,1024,250),r._spriteMosaic.setSpriteSource(e)})),i=new A(this._layer.currentStyleInfo.glyphsUrl?(0,d.B)(this._layer.currentStyleInfo.glyphsUrl,(0,l.Z)((0,l.Z)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),this._glyphMosaic=new C(1024,1024,i),this._broadcastPromise=(0,g.u)("WorkerTileHandler",{client:this,schedule:t.schedule,signal:t.signal}).then((function(e){if(r._connection=e,r._layer&&!r._connection.closed){var i=e.broadcast("setStyle",r._layer.currentStyleInfo.style,t);Promise.all(i).catch((function(e){return(0,v.ag)(e)}))}}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateStyle",value:function(){var e=(0,h.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",t)),e.abrupt("return",this._broadcastPromise);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setSpriteSource",value:function(e){var t=new q(1024,1024,250);return t.setSpriteSource(e),this._spriteMosaic=t,this._spriteSourcePromise=Promise.resolve(e),t}},{key:"setStyle",value:function(){var e=(0,h.Z)((0,o.Z)().mark((function e(t,i){var r,n=this;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._styleRepository=t,this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,null),this._spriteSourcePromise.then((function(e){n._spriteMosaic=new q(1024,1024,250),n._spriteMosaic.setSpriteSource(e)})),r=new A(this._layer.currentStyleInfo.glyphsUrl?(0,d.B)(this._layer.currentStyleInfo.glyphsUrl,(0,l.Z)((0,l.Z)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),e.abrupt("return",(this._glyphMosaic=new C(1024,1024,r),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",i)),this._broadcastPromise));case 7:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"fetchTileData",value:function(e,t){var i=this;return this._getRefKeys(e,t).then((function(e){var r=i._layer.sourceNameToSource,n=[];for(var s in r)n.push(s);return i._getSourcesData(n,e,t)}))}},{key:"parseTileData",value:function(e,t){var i=this,r=e&&e.data;if(!r)return Promise.resolve(null);var n=r.sourceName2DataAndRefKey,s=r.transferList;return 0===Object.keys(n).length?Promise.resolve(null):this._broadcastPromise.then((function(){return i._connection.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:n,styleLayerUIDs:e.styleLayerUIDs},(0,l.Z)((0,l.Z)({},t),{},{transferList:s}))}))}},{key:"getSprites",value:function(){var e=(0,h.Z)((0,o.Z)().mark((function e(t){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._spriteSourcePromise;case 2:return e.abrupt("return",this._spriteMosaic.getSpriteItems(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGlyphs",value:function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}},{key:"_getTilePayload",value:function(){var e=(0,h.Z)((0,o.Z)().mark((function e(t,i,r){var n,s,a,l,h;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=x.e.pool.acquire(t.id),s=this._layer.sourceNameToSource[i],a=n.level,l=n.row,h=n.col,x.e.pool.release(n),e.prev=2,e.next=5,s.requestTile(a,l,h,r);case 5:return e.t0=e.sent,e.t1=i,e.abrupt("return",{protobuff:e.t0,sourceName:e.t1});case 10:if(e.prev=10,e.t2=e.catch(2),!(0,v.j)(e.t2)){e.next=14;break}throw e.t2;case 14:return e.abrupt("return",{protobuff:null,sourceName:i});case 15:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t,i,r){return e.apply(this,arguments)}}()},{key:"_getRefKeys",value:function(e,t){var i=this._layer.sourceNameToSource,r=new Array;for(var n in i){var s=i[n].getRefKey(e,t);r.push(s)}return(0,v.E)(r)}},{key:"_getSourcesData",value:function(e,t,i){for(var r=[],n=0;n<t.length;n++)if(null==t[n].value||null==e[n])r.push(null);else{var s=this._getTilePayload(t[n].value,e[n],i);r.push(s)}return(0,v.E)(r).then((function(e){for(var i={},r=[],n=0;n<e.length;n++)if(e[n].value&&e[n].value&&e[n].value.protobuff&&e[n].value.protobuff.byteLength>0){var s=t[n].value.id;i[e[n].value.sourceName]={refKey:s,protobuff:e[n].value.protobuff},r.push(e[n].value.protobuff)}return{sourceName2DataAndRefKey:i,transferList:r}}))}}]),e}();function J(e,t,i,r,n,s){var a,o=r.iconRotationAlignment,l=r.textRotationAlignment,h=r.iconTranslate,y=r.iconTranslateAnchor,f=r.textTranslate,v=r.textTranslateAnchor,d=0,g=(0,c.Z)(e.colliders);try{for(g.s();!(a=g.n()).done;){var _=a.value,p=0===_.partIndex?h:f,m=(0,u.Z)(p,2),w=m[0],b=m[1],x=0===_.partIndex?y:v,S=_.minLod<=s&&s<=_.maxLod;d+=S?0:1,_.enabled=S,_.xScreen=_.xTile*n[0]+_.yTile*n[3]+n[6],_.yScreen=_.xTile*n[1]+_.yTile*n[4]+n[7],x===P.r.MAP?(_.xScreen+=i*w-t*b,_.yScreen+=t*w+i*b):(_.xScreen+=w,_.yScreen+=b),P.l.VIEWPORT===(0===_.partIndex?o:l)?(_.dxScreen=_.dxPixels,_.dyScreen=_.dyPixels):(_.dxScreen=i*(_.dxPixels+_.width/2)-t*(_.dyPixels+_.height/2)-_.width/2,_.dyScreen=t*(_.dxPixels+_.width/2)+i*(_.dyPixels+_.height/2)-_.height/2)}}catch(k){g.e(k)}finally{g.f()}e.colliders.length>0&&d===e.colliders.length&&(e.unique.show=!1)}var O=function(){function e(t,i,r,n,s,a){(0,y.Z)(this,e),this._symbols=t,this._styleRepository=n,this._zoom=s,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new Z.i(i,r,k.t),this._si=Math.sin(Math.PI*a/180),this._co=Math.cos(Math.PI*a/180);var o,l=(0,c.Z)(t);try{for(l.s();!(o=l.n()).done;){var h,u=o.value,f=(0,c.Z)(u.symbols);try{for(f.s();!(h=f.n()).done;){var v=h.value;this._allNeededMatrices.has(v.tile)||this._allNeededMatrices.set(v.tile,(0,S.r)(v.tile.transforms.tileUnitsToPixels))}}catch(d){f.e(d)}finally{f.f()}}}catch(d){l.e(d)}finally{l.f()}}return(0,f.Z)(e,[{key:"work",value:function(e){var t=this._gridIndex;function i(e){for(var i=e.xScreen+e.dxScreen,r=e.yScreen+e.dyScreen,n=i+e.width,s=r+e.height,a=t.getCellSpan(i,r,n,s),o=(0,u.Z)(a,4),l=o[0],h=o[1],y=o[2],f=o[3],v=h;v<=f;v++)for(var d=l;d<=y;d++){var g,_=t.cells[v][d],p=(0,c.Z)(_);try{for(p.s();!(g=p.n()).done;){var m=g.value,w=m.xScreen+m.dxScreen,b=m.yScreen+m.dyScreen,x=w+m.width,S=b+m.height;if(!(n<w||i>x||s<b||r>S))return!0}}catch(k){p.e(k)}finally{p.f()}}return!1}for(var r=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0)for(var n=this._symbols[this._currentLayerCursor],s=this._getProperties(n.styleLayerUID);this._currentSymbolCursor<n.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-r>e)return!1;var a=n.symbols[this._currentSymbolCursor];if(a.unique.show){J(a,this._si,this._co,s,this._allNeededMatrices.get(a.tile),this._zoom);var o=a.unique;if(o.show){var l,h=s.iconAllowOverlap,y=s.iconIgnorePlacement,f=s.textAllowOverlap,v=s.textIgnorePlacement,d=(0,c.Z)(a.colliders);try{for(d.s();!(l=d.n()).done;){var g=l.value;if(g.enabled){var _=o.parts[g.partIndex];_.show&&!(g.partIndex?f:h)&&i(g)&&(g.hard?o.show=!1:_.show=!1)}}}catch(L){d.e(L)}finally{d.f()}if(o.show){var p,m=(0,c.Z)(a.colliders);try{for(m.s();!(p=m.n()).done;){var w=p.value;if(w.enabled&&(!(w.partIndex?v:y)&&o.parts[w.partIndex].show))for(var b=w.xScreen+w.dxScreen,x=w.yScreen+w.dyScreen,S=b+w.width,k=x+w.height,Z=this._gridIndex.getCellSpan(b,x,S,k),P=(0,u.Z)(Z,4),I=P[0],T=P[1],M=P[2],R=P[3],C=T;C<=R;C++)for(var D=I;D<=M;D++)this._gridIndex.cells[C][D].push(w)}}catch(L){m.e(L)}finally{m.f()}}}}}return!0}},{key:"_getProperties",value:function(e){var t=this._styleProps.get(e);if(t)return t;var i=this._zoom,r=this._styleRepository.getStyleLayerByUID(e),n=r.getLayoutValue("symbol-placement",i)!==P.n.POINT,s=r.getLayoutValue("icon-rotation-alignment",i);s===P.l.AUTO&&(s=n?P.l.MAP:P.l.VIEWPORT);var a=r.getLayoutValue("text-rotation-alignment",i);a===P.l.AUTO&&(a=n?P.l.MAP:P.l.VIEWPORT);var o=r.getPaintValue("icon-translate",i),l=r.getPaintValue("icon-translate-anchor",i),h=r.getPaintValue("text-translate",i),u=r.getPaintValue("text-translate-anchor",i),c={iconAllowOverlap:r.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:r.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:r.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:r.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:s,textRotationAlignment:a,iconTranslateAnchor:l,iconTranslate:o,textTranslateAnchor:u,textTranslate:h};return this._styleProps.set(e,c),c}}]),e}();function F(e,t){if(e.priority-t.priority)return e.priority-t.priority;var i=e.tile.key,r=t.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}var N=function(){function e(t,i,r,n,s,a){(0,y.Z)(this,e),this._visibleTiles=t,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=n,this._symbolLayerSorter=s,this._isLayerVisible=a,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}return(0,f.Z)(e,[{key:"running",get:function(){return this._running}},{key:"setScreenSize",value:function(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}},{key:"restart",value:function(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}},{key:"continue",value:function(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){var t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){var i=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-i))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){var r=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-r))))return!1}return this._running=!1,!0}},{key:"_createSelectionJob",value:function(){for(var e=this._symbolRepository.uniqueSymbols,t=0;t<e.length;t++)for(var i=e[t],r=0;r<i.uniqueSymbols.length;r++){var n,s=i.uniqueSymbols[r],a=(0,c.Z)(s.tileSymbols);try{for(a.s();!(n=a.n()).done;){n.value.selectedForRendering=!1}}catch(f){a.e(f)}finally{a.f()}}var o=[],l=0,h=0,u=this._isLayerVisible;var y=this._symbolLayerSorter;return{work:function(t){for(var i,r=performance.now();h<e.length;h++,l=0){var n=e[h],s=n.styleLayerUID;if(u(s)){o[h]=o[h]||{styleLayerUID:s,symbols:[]};for(var a=o[h];l<n.uniqueSymbols.length;l++){if(i=n.uniqueSymbols[l],l%100==99&&performance.now()-r>t)return!1;var y,v=null,d=!1,g=!1,_=(0,c.Z)(i.tileSymbols);try{for(_.s();!(y=_.n()).done;){var p=y.value;if(!g||!d){var m=p.tile;(!v||m.isCoverage||m.neededForCoverage&&!d)&&(v=p,(m.neededForCoverage||m.isCoverage)&&(g=!0),m.isCoverage&&(d=!0))}}}catch(f){_.e(f)}finally{_.f()}if(v.selectedForRendering=!0,g){a.symbols.push(v),i.show=!0;var w,b=(0,c.Z)(i.parts);try{for(b.s();!(w=b.n()).done;){w.value.show=!0}}catch(f){b.e(f)}finally{b.f()}}else i.show=!1}}else o[h]||(o[h]={styleLayerUID:s,symbols:[]})}var x,S=(0,c.Z)(o);try{for(S.s();!(x=S.n()).done;){x.value.symbols.sort(F)}}catch(f){S.e(f)}finally{S.f()}return!0},get sortedSymbols(){return o.sort(y)}}}},{key:"_createOpacityJob",value:function(){var e=this._assignTileSymbolsOpacity,t=this._visibleTiles,i=0;function r(t,i){var n,s=t.symbols,a=(0,c.Z)(s);try{for(a.s();!(n=a.n()).done;){var o=(0,u.Z)(n.value,2);o[0];E(o[1],i)}}catch(y){a.e(y)}finally{a.f()}e(t,i);var l,h=(0,c.Z)(t.childrenTiles);try{for(h.s();!(l=h.n()).done;){r(l.value,i)}}catch(y){h.e(y)}finally{h.f()}}return{work:function(e){for(var n=performance.now();i<t.length;i++){if(performance.now()-n>e)return!1;var s=t[i];(0,I.r)(s.parentTile)||r(s,performance.now())}return!0}}}}]),e}();function E(e,t){var i,r=(0,c.Z)(e);try{for(r.s();!(i=r.n()).done;){var n,s=i.value.unique,a=(0,c.Z)(s.parts);try{for(a.s();!(n=a.n()).done;){var o=n.value,l=o.targetOpacity>.5?1:-1;o.startOpacity+=l*((t-o.startTime)/k.e),o.startOpacity=Math.min(Math.max(o.startOpacity,0),1),o.startTime=t,o.targetOpacity=s.show&&o.show?1:0}}catch(h){a.e(h)}finally{a.f()}}}catch(h){r.e(h)}finally{r.f()}}var V=function(){function e(t,i,r){(0,y.Z)(this,e),this.tileCoordRange=t,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}return(0,f.Z)(e,[{key:"uniqueSymbols",get:function(){return(0,I.t)(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}},{key:"add",value:function(e,t){this._uniqueSymbolLayerArray=null;var i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));var r=new Map;if(t){var n,s=(0,c.Z)(t);try{for(s.s();!(n=s.n()).done;){var a=n.value;i.symbols.has(a)&&(r.set(a,i.symbols.get(a)),i.symbols.delete(a))}}catch(I){s.e(I)}finally{s.f()}}else{var o,l=(0,c.Z)(e.layerData);try{for(l.s();!(o=l.n()).done;){var h=(0,u.Z)(o.value,2),y=h[0];h[1];i.symbols.has(y)&&(r.set(y,i.symbols.get(y)),i.symbols.delete(y))}}catch(I){l.e(I)}finally{l.f()}}this._removeSymbols(r);var f,v=e.symbols,d=new Map,g=(0,c.Z)(v);try{for(g.s();!(f=g.n()).done;){var _=(0,u.Z)(f.value,2),p=_[0],m=_[1],w=m.length;if(w>=32){var b=this.tileCoordRange;do{b/=2,w/=4}while(w>8&&b>64);var x=new Z.i(this.tileCoordRange,this.tileCoordRange,b);d.set(p,{flat:m,index:x}),i.symbols.set(p,{flat:m,index:x});var S,k=(0,c.Z)(m);try{for(k.s();!(S=k.n()).done;){var P=S.value;x.getCell(P.xTile,P.yTile).push(P)}}catch(I){k.e(I)}finally{k.f()}}else d.set(p,{flat:m}),i.symbols.set(p,{flat:m})}}catch(I){g.e(I)}finally{g.f()}this._addSymbols(e.key,v)}},{key:"deleteStyleLayers",value:function(e){this._uniqueSymbolLayerArray=null;var t,i=(0,c.Z)(this._tiles);try{for(i.s();!(t=i.n()).done;){var r,n=(0,u.Z)(t.value,2),s=n[0],a=n[1],o=new Map,l=(0,c.Z)(e);try{for(l.s();!(r=l.n()).done;){var h=r.value;a.symbols.has(h)&&(o.set(h,a.symbols.get(h)),a.symbols.delete(h))}}catch(y){l.e(y)}finally{l.f()}this._removeSymbols(o),0===a.symbols.size&&this._tiles.delete(s)}}catch(y){i.e(y)}finally{i.f()}}},{key:"removeTile",value:function(e){this._uniqueSymbolLayerArray=null;var t=this._tiles.get(e.id);if(t){var i,r=new Map,n=(0,c.Z)(e.symbols);try{for(n.s();!(i=n.n()).done;){var s=(0,u.Z)(i.value,2),a=s[0];s[1];t.symbols.has(a)&&(r.set(a,t.symbols.get(a)),t.symbols.delete(a))}}catch(o){n.e(o)}finally{n.f()}this._removeSymbols(r),0===t.symbols.size&&this._tiles.delete(e.id)}}},{key:"_removeSymbols",value:function(e){var t,i=(0,c.Z)(e);try{for(i.s();!(t=i.n()).done;){var r,n=(0,u.Z)(t.value,2),s=n[0],a=n[1].flat,o=(0,c.Z)(a);try{for(o.s();!(r=o.n()).done;){for(var l=r.value,h=l.unique,y=h.tileSymbols,f=y.length-1,v=0;v<f;v++)if(y[v]===l){y[v]=y[f];break}if(y.length=f,0===f){var d=this._uniqueSymbolsReferences.get(s);d.delete(h),0===d.size&&this._uniqueSymbolsReferences.delete(s)}l.unique=null}}catch(g){o.e(g)}finally{o.f()}}}catch(g){i.e(g)}finally{i.f()}}},{key:"_addSymbols",value:function(e,t){if(0!==t.size){var i,r=this._visibleTiles,n=(0,c.Z)(r);try{for(n.s();!(i=n.n()).done;){var s=i.value;s.parentTile||s.key.world!==e.world||s.key.level===e.level&&!s.key.equals(e)||this._matchSymbols(s,e,t)}}catch(p){n.e(p)}finally{n.f()}var a,o=(0,c.Z)(t);try{for(o.s();!(a=o.n()).done;){var l,h=(0,u.Z)(a.value,2),y=h[0],f=h[1],v=(0,c.Z)(f);try{for(v.s();!(l=v.n()).done;){var d=l.value;if((0,I.t)(d.unique)){var g=this._createUnique();d.unique=g,g.tileSymbols.push(d);var _=this._uniqueSymbolsReferences.get(y);_||(_=new Set,this._uniqueSymbolsReferences.set(y,_)),_.add(g)}}}catch(p){v.e(p)}finally{v.f()}}}catch(p){o.e(p)}finally{o.f()}}}},{key:"_matchSymbols",value:function(e,t,i){if(e.key.level>t.level){var r=e.key.level-t.level;if(e.key.row>>r!==t.row||e.key.col>>r!==t.col)return}if(t.level>e.key.level){var n=t.level-e.key.level;if(t.row>>n!==e.key.row||t.col>>n!==e.key.col)return}if(t.equals(e.key)){var s,a=(0,c.Z)(e.childrenTiles);try{for(a.s();!(s=a.n()).done;){var o=s.value;this._matchSymbols(o,t,i)}}catch(W){a.e(W)}finally{a.f()}}else{var l,h=new Map,y=(0,c.Z)(i);try{for(y.s();!(l=y.n()).done;){var f,v=(0,u.Z)(l.value,2),d=v[0],g=v[1],_=[],p=(0,c.Z)(g);try{for(p.s();!(f=p.n()).done;){var m=f.value,w=(0,Z.l)(this.tileCoordRange,m.xTile,t.level,t.col,e.key.level,e.key.col),b=(0,Z.l)(this.tileCoordRange,m.yTile,t.level,t.row,e.key.level,e.key.row);w>=0&&w<this.tileCoordRange&&b>=0&&b<this.tileCoordRange&&_.push({symbol:m,xTransformed:w,yTransformed:b})}}catch(W){p.e(W)}finally{p.f()}var x=[],S=e.key.level<t.level?1:1<<e.key.level-t.level,k=this._tiles.get(e.id).symbols.get(d);if(k){var P,T=k.flat,M=(0,c.Z)(_);try{for(M.s();!(P=M.n()).done;){var R,C=P.value,D=!1,L=C.xTransformed,A=C.yTransformed;R=(0,I.r)(k.index)?k.index.getCell(L,A):T;var U,q=C.symbol,z=q.hash,J=(0,c.Z)(R);try{for(J.s();!(U=J.n()).done;){var O=U.value;if(z===O.hash&&Math.abs(L-O.xTile)<=S&&Math.abs(A-O.yTile)<=S){var F=O.unique;q.unique=F,F.tileSymbols.push(q),D=!0;break}}}catch(W){J.e(W)}finally{J.f()}D||x.push(q)}}catch(W){M.e(W)}finally{M.f()}}x.length>0&&h.set(d,x)}}catch(W){y.e(W)}finally{y.f()}var N,E=(0,c.Z)(e.childrenTiles);try{for(E.s();!(N=E.n()).done;){var V=N.value;this._matchSymbols(V,t,h)}}catch(W){E.e(W)}finally{E.f()}}}},{key:"_createUniqueSymbolLayerArray",value:function(){var e,t,i=this._uniqueSymbolsReferences,r=new Array(i.size),n=0,s=(0,c.Z)(i);try{for(s.s();!(t=s.n()).done;){var a=(0,u.Z)(t.value,2),o=a[0],l=a[1],h=new Array(l.size);e=0;var y,f=(0,c.Z)(l);try{for(f.s();!(y=f.n()).done;){var v=y.value;h[e++]=v}}catch(d){f.e(d)}finally{f.f()}r[n]={styleLayerUID:o,uniqueSymbols:h},n++}}catch(d){s.e(d)}finally{s.f()}return r}}]),e}(),W=function(e){(0,s.Z)(i,e);var t=(0,a.Z)(i);function i(){var e;return(0,y.Z)(this,i),(e=t.apply(this,arguments))._fullCacheLodInfos=null,e._levelByScale={},e}return(0,f.Z)(i,[{key:"getTileParentId",value:function(e){var t=x.e.pool.acquire(e),i=0===t.level?null:x.e.getId(t.level-1,t.row>>1,t.col>>1,t.world);return x.e.pool.release(t),i}},{key:"getTileCoverage",value:function(e,t,s){var a=(0,r.Z)((0,n.Z)(i.prototype),"getTileCoverage",this).call(this,e,t,s);if(!a)return a;var o=1<<a.lodInfo.level;return a.spans=a.spans.filter((function(e){return e.row>=0&&e.row<o})),a}},{key:"scaleToLevel",value:function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t,i,r=this._fullCacheLodInfos;if(e>r[0].scale)return r[0].level;for(var n=0;n<r.length-1;n++)if(e>(i=r[n+1]).scale)return(t=r[n]).level+(t.scale-e)/(t.scale-i.scale);return r[r.length-1].level}},{key:"_initializeFullCacheLODs",value:function(e){var t;if(0===e[0].level)t=e.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}));else{var i=this.tileInfo.size[0],r=this.tileInfo.spatialReference;t=T.j.create({size:i,spatialReference:r}).lods.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}))}for(var n=0;n<t.length;n++)this._levelByScale[t[n].scale]=t[n].level;this._fullCacheLodInfos=t}}]),i}(M.h)},72448:function(e,t,i){i.d(t,{e:function(){return l},r:function(){return o}});var r=i(37762),n=i(93433),s=i(25217),a=i(71802);function o(e,t,i){var r=(0,a.al)(Math.ceil(i)),n=function(e){return"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e}(t)?8*r:16*r,s=2*r;e.width=n,e.height=n;var o=e.getContext("2d");o.strokeStyle="#FFFFFF",o.lineWidth=r,o.beginPath(),"vertical"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSVertical"!==t||(o.moveTo(n/2,-s),o.lineTo(n/2,n+s)),"horizontal"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSHorizontal"!==t||(o.moveTo(-s,n/2),o.lineTo(n+s,n/2)),"forward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSDiagonalCross"!==t&&"esriSFSForwardDiagonal"!==t||(o.moveTo(-s,-s),o.lineTo(n+s,n+s),o.moveTo(n-s,-s),o.lineTo(n+s,s),o.moveTo(-s,n-s),o.lineTo(s,n+s)),"backward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSBackwardDiagonal"!==t&&"esriSFSDiagonalCross"!==t||(o.moveTo(n+s,-s),o.lineTo(-s,n+s),o.moveTo(s,-s),o.lineTo(-s,s),o.moveTo(n+s,n-s),o.lineTo(n-s,n+s)),o.stroke();for(var l,h=o.getImageData(0,0,e.width,e.height),u=new Uint8Array(h.data),c=0;c<u.length;c+=4)l=u[c+3]/255,u[c]=u[c]*l,u[c+1]=u[c+1]*l,u[c+2]=u[c+2]*l;return[u,e.width,e.height]}function l(e,t){var i="Butt"===t,a="Square"===t,o=!i&&!a;e.length%2==1&&(e=[].concat((0,n.Z)(e),(0,n.Z)(e)));var l,h=15.5,u=0,c=(0,r.Z)(e);try{for(c.s();!(l=c.n()).done;){u+=l.value}}catch(M){c.e(M)}finally{c.f()}var y,f=Math.round(u*h),v=new Float32Array(31*f),d=7.75,g=0,_=0,p=.5,m=!0,w=(0,r.Z)(e);try{for(w.s();!(y=w.n()).done;){var b=y.value;for(g=_,_+=b*h;p<=_;){for(var x=.5;x<31;){var S=(x-.5)*f+p-.5,k=o?(x-h)*(x-h):Math.abs(x-h);v[S]=m?i?Math.max(Math.max(g+d-p,k),Math.max(p-_+d,k)):k:o?Math.min((p-g)*(p-g)+k,(p-_)*(p-_)+k):a?Math.min(Math.max(p-g,k),Math.max(_-p,k)):Math.min(Math.max(p-g+d,k),Math.max(_+d-p,k)),x++}p++}m=!m}}catch(M){w.e(M)}finally{w.f()}for(var Z=v.length,P=new Uint8Array(4*Z),I=0;I<Z;++I){var T=(o?Math.sqrt(v[I]):v[I])/h;(0,s.o)(T,P,4*I)}return[P,f,31]}}}]);
//# sourceMappingURL=7340.b4966701.chunk.js.map