"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[6032],{18030:function(e,t,n){n.d(t,{a:function(){return d}});var r=n(93433),i=n(15671),a=n(43144),l=n(60136),s=n(29388),o=n(48848),u=n(93661),c=n(33795),f=-1,d=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e))._from=null,r._to=null,r._final=null,r._current=[],r._time=0,r.duration=(0,u.h)("mapview-transitions-duration"),r.effects=[],r}return(0,a.Z)(n,[{key:"effect",set:function(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(y(e))}catch(t){this._transitionTo([]),o.a.getLogger(this.declaredClass).warn("Invalid Effect",{effect:e,error:t})}}}},{key:"hasEffects",get:function(){return this.transitioning||!!this.effects.length}},{key:"scale",set:function(e){this._updateForScale(e)}},{key:"transitioning",get:function(){return null!==this._to}},{key:"canTransitionTo",value:function(e){try{return this.scale>0&&h(this._current,y(e),this.scale)}catch(t){return!1}}},{key:"transitionStep",value:function(e,t){this._applyTimeTransition(e),this._updateForScale(t)}},{key:"endTransitions",value:function(){this._applyTimeTransition(this.duration)}},{key:"_transitionTo",value:function(e){this.scale>0&&h(this._current,e,this.scale)?(this._final=e,this._to=(0,u.y)(e),function(e,t,n){for(var i,a,l=e.length>t.length?e:t,s=e.length>t.length?t:e,o=s[s.length-1],u=null!==(i=null===o||void 0===o?void 0:o.scale)&&void 0!==i?i:n,d=null!==(a=null===o||void 0===o?void 0:o.effects)&&void 0!==a?a:[],y=s.length;y<l.length;y++)s.push({scale:u,effects:(0,r.Z)(d)});for(var h=0;h<l.length;h++)s[h].scale=s[h].scale===f?n:s[h].scale,l[h].scale=l[h].scale===f?n:l[h].scale,(0,c.c)(s[h].effects,l[h].effects)}(this._current,this._to,this.scale),this._from=(0,u.y)(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?(0,u.y)(this._current[0].effects):[])}},{key:"_applyTimeTransition",value:function(e){if(this._to&&this._from&&this._current&&this._final){this._time+=e;for(var t=Math.min(1,this._time/this.duration),n=0;n<this._current.length;n++){var r=this._current[n],i=this._from[n],a=this._to[n];r.scale=p(i.scale,a.scale,t);for(var l=0;l<r.effects.length;l++){var s=r.effects[l],o=i.effects[l],c=a.effects[l];s.interpolate(o,c,t)}}1===t&&(this._current=this._final,this._set("effects",this._current[0]?(0,u.y)(this._current[0].effects):[]),this._from=this._to=this._final=null)}}},{key:"_updateForScale",value:function(e){if(this._set("scale",e),0!==this._current.length){var t,n,r=this._current,i=this._current.length-1,a=1;if(1===r.length||e>=r[0].scale)n=t=r[0].effects;else if(e<=r[i].scale)n=t=r[i].effects;else for(var l=0;l<i;l++){var s=r[l],o=r[l+1];if(s.scale>=e&&o.scale<=e){a=(e-s.scale)/(o.scale-s.scale),t=s.effects,n=o.effects;break}}for(var u=0;u<this.effects.length;u++)this.effects[u].interpolate(t[u],n[u],a)}}}]),n}(o.m);function y(e){var t=(0,c.d)(e)||[];return function(e){var t=e[0];return!!t&&"type"in t}(t)?[{scale:f,effects:t}]:t}function h(e,t,n){var r,i,a,l;return null===(r=e[0])||void 0===r||!r.effects||null===(i=t[0])||void 0===i||!i.effects||!(((null===(a=e[0])||void 0===a?void 0:a.scale)===f||(null===(l=t[0])||void 0===l?void 0:l.scale)===f)&&(e.length>1||t.length>1)&&n<=0)&&(0,c.b)(e[0].effects,t[0].effects)}function p(e,t,n){return e+(t-e)*n}(0,o.e)([(0,o.y)()],d.prototype,"_to",void 0),(0,o.e)([(0,o.y)()],d.prototype,"duration",void 0),(0,o.e)([(0,o.y)({value:""})],d.prototype,"effect",null),(0,o.e)([(0,o.y)({readOnly:!0})],d.prototype,"effects",void 0),(0,o.e)([(0,o.y)({readOnly:!0})],d.prototype,"hasEffects",null),(0,o.e)([(0,o.y)({value:0})],d.prototype,"scale",null),(0,o.e)([(0,o.y)({readOnly:!0})],d.prototype,"transitioning",null),d=(0,o.e)([(0,o.n)("esri.layers.effects.EffectView")],d)},15529:function(e,t,n){n.d(t,{m:function(){return b},n:function(){return L},r:function(){return k},x:function(){return M}});var r,i=n(11752),a=n(61120),l=n(74165),s=n(15861),o=n(15671),u=n(43144),c=n(60136),f=n(29388),d=n(48848),y=n(40558),h=n(40114),p=n(93661),v=n(82474),m=n(59984),g=n(47855),b={inches:(0,g.a)(1,"meters","inches"),feet:(0,g.a)(1,"meters","feet"),"us-feet":(0,g.a)(1,"meters","us-feet"),yards:(0,g.a)(1,"meters","yards"),miles:(0,g.a)(1,"meters","miles"),"nautical-miles":(0,g.a)(1,"meters","nautical-miles"),millimeters:(0,g.a)(1,"meters","millimeters"),centimeters:(0,g.a)(1,"meters","centimeters"),decimeters:(0,g.a)(1,"meters","decimeters"),meters:(0,g.a)(1,"meters","meters"),kilometers:(0,g.a)(1,"meters","kilometers"),"decimal-degrees":1/(0,g.Y)(1,"meters",v.s.radius)},_=r=function(e){(0,c.Z)(n,e);var t=(0,f.Z)(n);function n(e){return(0,o.Z)(this,n),t.call(this,e)}return(0,u.Z)(n,[{key:"collectRequiredFields",value:function(){var e=(0,s.Z)((0,l.Z)().mark((function e(t,n){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,m.S)(t,n,this.expression));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clone",value:function(){return new r({expression:this.expression,title:this.title})}},{key:"equals",value:function(e){return this.expression===e.expression&&this.title===e.title}}]),n}(h.l);(0,d.e)([(0,d.y)({type:String,json:{write:!0}})],_.prototype,"expression",void 0),(0,d.e)([(0,d.y)({type:String,json:{write:!0}})],_.prototype,"title",void 0);var w=_=r=(0,d.e)([(0,d.n)("esri.layers.support.FeatureExpressionInfo")],_);function L(e){return null!=b[e]}function k(e){return 1/(b[e]||1)}var x,S=function(){var e=Object.keys(b);return e.sort(),e}(),I=(0,y.o)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),E=new y.s({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"}),C=x=function(e){(0,c.Z)(n,e);var t=(0,f.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).offset=null,r}return(0,u.Z)(n,[{key:"readFeatureExpressionInfo",value:function(e,t){return null!=e?e:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}},{key:"writeFeatureExpressionInfo",value:function(e,t,n,r){t[n]=e.write({},r),"0"===e.expression&&(t.featureExpression={value:0})}},{key:"mode",get:function(){var e=this.offset,t=this.featureExpressionInfo;return this._isOverridden("mode")?this._get("mode"):(0,p.r)(e)||t?"relative-to-ground":"on-the-ground"},set:function(e){this._override("mode",e)}},{key:"unit",set:function(e){this._set("unit",e)}},{key:"write",value:function(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?(0,i.Z)((0,a.Z)(n.prototype),"write",this).call(this,e,t):null}},{key:"clone",value:function(){return new x({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}},{key:"equals",value:function(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&(0,p.B)(this.featureExpressionInfo,e.featureExpressionInfo)}}]),n}(h.l);(0,d.e)([(0,d.y)({type:w,json:{write:!0}})],C.prototype,"featureExpressionInfo",void 0),(0,d.e)([(0,v.o)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],C.prototype,"readFeatureExpressionInfo",null),(0,d.e)([(0,v.r)("featureExpressionInfo",{featureExpressionInfo:{type:w},"featureExpression.value":{type:[0]}})],C.prototype,"writeFeatureExpressionInfo",null),(0,d.e)([(0,d.y)({type:I.apiValues,nonNullable:!0,json:{type:I.jsonValues,read:I.read,write:{writer:I.write,isRequired:!0}}})],C.prototype,"mode",null),(0,d.e)([(0,d.y)({type:Number,json:{write:!0}})],C.prototype,"offset",void 0),(0,d.e)([(0,d.y)({type:S,json:{type:String,read:E.read,write:E.write}})],C.prototype,"unit",null);var M=C=x=(0,d.e)([(0,d.n)("esri.layers.support.ElevationInfo")],C)},64139:function(e,t,n){n.d(t,{c:function(){return v}});var r=n(1413),i=n(15671),a=n(43144),l=n(60136),s=n(29388),o=n(48848),u=n(630),c=n(93661),f=n(87753),d=n(12953),y=n(17562),h=n(78666),p={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"},v=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e){var r;return(0,i.Z)(this,n),(r=t.call(this,e)).floors=null,r.scale=0,r}return(0,a.Z)(n,[{key:"destroy",value:function(){this.layer=null}},{key:"dynamicLayers",get:function(){var e=this;if(!this.hasDynamicLayers)return null;var t=this.visibleSublayers.map((function(t){var n=(0,y.n)(e.floors,t);return t.toExportImageJSON(n)}));return t.length?JSON.stringify(t):null}},{key:"hasDynamicLayers",get:function(){return this.layer&&(0,h.i)(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}},{key:"layer",set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.allSublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("sublayer-update",(function(e){return t.notifyChange(p[e.propertyName])}))],"layer"))}},{key:"layers",get:function(){var e=this.visibleSublayers;return e?e.length?"show:"+e.map((function(e){return e.id})).join(","):"show:-1":null}},{key:"layerDefs",get:function(){var e,t=this,n=!(null===(e=this.floors)||void 0===e||!e.length),r=this.visibleSublayers.filter((function(e){return null!=e.definitionExpression||n&&null!=e.floorInfo}));return r.length?JSON.stringify(r.reduce((function(e,n){var r=(0,y.n)(t.floors,n),i=(0,f.t)(r,n.definitionExpression);return(0,c.r)(i)&&(e[n.id]=i),e}),{})):null}},{key:"version",get:function(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers"),this.commitProperty("timeExtent");var e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){var e=this,t=[];if(!this.layer)return t;var n=this.layer.sublayers;n&&n.forEach((function n(r){var i=e.scale,a=0===i,l=0===r.minScale||i<=r.minScale,s=0===r.maxScale||i>=r.maxScale;r.visible&&(a||l&&s)&&(r.sublayers?r.sublayers.forEach(n):t.unshift(r))}));var r=this._get("visibleSublayers");return!r||r.length!==t.length||r.some((function(e,n){return t[n]!==e}))?t:r}},{key:"toJSON",value:function(){var e=this.layer,t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t=(0,r.Z)((0,r.Z)({},t),{},{layers:this.layers,layerDefs:this.layerDefs}),t}}]),n}((0,u.a)(o.m));(0,o.e)([(0,o.y)({readOnly:!0})],v.prototype,"dynamicLayers",null),(0,o.e)([(0,o.y)()],v.prototype,"floors",void 0),(0,o.e)([(0,o.y)({readOnly:!0})],v.prototype,"hasDynamicLayers",null),(0,o.e)([(0,o.y)()],v.prototype,"layer",null),(0,o.e)([(0,o.y)({readOnly:!0})],v.prototype,"layers",null),(0,o.e)([(0,o.y)({readOnly:!0})],v.prototype,"layerDefs",null),(0,o.e)([(0,o.y)({type:Number})],v.prototype,"scale",void 0),(0,o.e)([(0,o.y)(d.g)],v.prototype,"timeExtent",void 0),(0,o.e)([(0,o.y)({readOnly:!0})],v.prototype,"version",null),(0,o.e)([(0,o.y)({readOnly:!0})],v.prototype,"visibleSublayers",null),v=(0,o.e)([(0,o.n)("esri.layers.mixins.ExportImageParameters")],v)},56032:function(e,t,n){n.r(t);var r=n(29439),i=n(4942),a=n(1413),l=n(37762),s=n(74165),o=n(93433),u=n(15671),c=n(43144),f=n(60136),d=n(29388),y=n(15861),h=n(48848),p=n(93661),v=n(50690),m=n(42467),g=n(46737),b=n(93314),_=n(89794),w=n(40558),L=n(37944),k=n(77956),x=n(18030),S=n(33795),I=n(64139),E=n(59984),C=n(2959),M=n(25874),Z=n(2821),V=n(95643),R=n(39769),F=n(51219),z=n(86910),T=n(53586),A=n(65094),D=n(3719);n(37856),n(42667),n(75255),n(61118),n(52113),n(15751),n(48200),n(71802),n(86086),n(20302),n(82474),n(40114),n(21385),n(85253),n(93209),n(46817),n(25456),n(46337),n(81556),n(93116),n(62610),n(79557),n(630),n(87753),n(12953),n(89181),n(15529),n(47855),n(78666),n(74384),n(56546),n(39926),n(6762),n(8141),n(26151),n(91681),n(70449),n(66577),n(33794),n(71147),n(84186),n(64998),n(25577),n(60369),n(92072),n(56162),n(22603),n(59389),n(43976),n(70607),n(88623),n(20675);var N={HH:315,HL:45,LL:135,LH:225},O={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function P(e){if(e){var t=e.type;if(t.includes("3d"))return(0,z.getSymbolLayerFill)(e.symbolLayers.getItemAt(0));if("simple-line"===t){var n=(0,V.y)(e);return n&&n.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){var r=(0,V.y)(e);return r&&r.color}return(0,V.f)(e)}}function B(e,t){var n=t.HH.label,r=t.LL.label,i=t.HL.label,a=t.LH.label;switch(e){case"HH":default:return{top:n,bottom:r,left:i,right:a};case"HL":return{top:i,bottom:a,left:r,right:n};case"LL":return{top:r,bottom:n,left:a,right:i};case"LH":return{top:a,bottom:i,left:n,right:r}}}function q(e){var t=e.focus,n=e.infos,r=e.numClasses,i=O[r],a={};n.forEach((function(e){a[e.value]={label:e.label,fill:P(e.symbol)}}));for(var l=[],s=0;s<r;s++){for(var o=[],u=0;u<r;u++){var c=a[i[s][u]];o.push(c.fill)}l.push(o)}return{type:"relationship-ramp",numClasses:r,focus:t,colors:l,labels:B(t,a),rotation:H(t)}}function H(e){var t=N[e];return e&&null==t&&(t=N.HH),t||0}var j=[255,255,255],U=[200,200,200],W=[128,128,128];function G(e,t){var n=e.length-1;return e.map((function(e,r){return(0,F.o)(e,r,n,t)}))}function J(e,t,n,r,i,a,l){return X.apply(this,arguments)}function X(){return X=(0,y.Z)((0,s.Z)().mark((function e(t,n,r,i,a,l,o){var u,c,f,d,h,p,v,m,g,b,_,w,L,k,x,S,I,E,C,M;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=n.legendOptions,d=f&&f.customValues,e.t0=o,e.t0){e.next=7;break}return e.next=6,$(t,r);case 6:e.t0=e.sent;case 7:if(h=e.t0,p=!!h,v=!!d,m=null!=n.minSize&&null!=n.maxSize,g=n.stops&&n.stops.length>1,b=!!n.target,p&&(v||m||g&&!b)){e.next=15;break}return e.abrupt("return");case 15:if(_=(0,V.d)(h),w=null,L=null,k=null,!_||g){e.next=21;break}e.t1=(0,F.u)([n.minDataValue,n.maxDataValue]),e.next=27;break;case 21:if(e.t2=d,e.t2){e.next=26;break}return e.next=25,re(n,h,i,a);case 25:e.t2=e.sent;case 26:e.t1=e.t2;case 27:if(L=e.t1,x=null===t||void 0===t?void 0:t.authoringInfo,S="univariate-color-size"===(null===x||void 0===x?void 0:x.type),I=S&&"above-and-below"===(null===x||void 0===x?void 0:x.univariateTheme),!L&&g&&(L=n.stops.map((function(e){return e.value})),w=n.stops.some((function(e){return!!e.label})),"flow"===t.type&&(L=(0,F.u)(L)),w&&(k=n.stops.map((function(e){return e.label})))),_&&(null===(u=L)||void 0===u?void 0:u.length)>2&&!I&&(L=[L[0],L[L.length-1]]),L){e.next=31;break}return e.abrupt("return",null);case 31:return S&&5!==(null===(c=L)||void 0===c?void 0:c.length)&&(L=ae({minSize:L[0],maxSize:L[L.length-1]})),E=_?Y(t,L):null,C=(0,V.w)(h),M=w?null:G(L,l),e.next=35,Promise.all(L.map(function(){var e=(0,y.Z)((0,s.Z)().mark((function e(r,l){var o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_){e.next=4;break}e.t0=E[l],e.next=7;break;case 4:return e.next=6,ue(n,h,r,i,a);case 6:e.t0=e.sent;case 7:return o=e.t0,e.abrupt("return",{value:r,symbol:fe(I&&"class-breaks"===t.type?Q(t,l):h,o),label:w?k[l]:M[l],size:o,outlineSize:C});case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 35:return e.abrupt("return",e.sent.reverse());case 36:case"end":return e.stop()}}),e)}))),X.apply(this,arguments)}function Y(e,t){var n=null===e||void 0===e?void 0:e.authoringInfo,r="univariate-color-size"===(null===n||void 0===n?void 0:n.type),i=[12,30];if(r){var a=t[0],l=t[t.length-1];i=t.map((function(e){return 12+(e-a)/(l-a)*18}))}return r&&"below"===(null===n||void 0===n?void 0:n.univariateTheme)&&i.reverse(),i}function Q(e,t){var n=e.classBreakInfos,r=n.length,i=r<2||!(t>=2)?n[0].symbol.clone():n[r-1].symbol.clone();return e.visualVariables.some((function(e){return"color"===e.type}))&&(i.type.includes("3d")?te(i):ne(i)),i}function $(e,t){return K.apply(this,arguments)}function K(){return K=(0,y.Z)((0,s.Z)().mark((function e(t,n){var r,i,a,l,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("flow"!==t.type){e.next=2;break}return e.abrupt("return",(0,F.c)(t,n));case 2:if("pie-chart"!==t.type){e.next=4;break}return e.abrupt("return",new L.y({color:null,outline:null!==(r=t.outline)&&void 0!==r&&r.width?t.outline:new L.m}));case 4:return i=null,a=null,"simple"===t.type?i=t.symbol:"class-breaks"===t.type?(l=t.classBreakInfos,i=l&&l[0]&&l[0].symbol,a=l.length>1):"unique-value"===t.type&&(o=t.uniqueValueInfos,i=o&&o[0]&&o[0].symbol,a=o.length>1),e.abrupt("return",!i||ee(i)?null:(i=i.clone(),(n||a)&&(i.type.includes("3d")?te(i):ne(i)),i));case 7:case"end":return e.stop()}}),e)}))),K.apply(this,arguments)}function ee(e){return!!e&&((0,L.c)(e)?!!e.symbolLayers&&e.symbolLayers.some((function(e){return e&&"fill"===e.type})):e.type.includes("fill"))}function te(e){"line-3d"===e.type?e.symbolLayers.forEach((function(e){e.material={color:W}})):e.symbolLayers.forEach((function(e){"icon"!==e.type||e.resource&&e.resource.href?e.material={color:U}:(e.material={color:j},e.outline={color:W,size:1.5})}))}function ne(e){var t=(0,F.r)();if("cim"===e.type)(0,V.I)(e,new _.l(U));else if(e.type.includes("line"))e.color=W;else if(e.color=t?W:j,"simple-marker"===e.type)if(e.outline){var n,r;"#ffffff"===(null===(n=e.outline)||void 0===n||null===(r=n.color)||void 0===r?void 0:r.toHex())&&(e.outline.color=W)}else e.outline={color:W,width:1.5}}function re(e,t,n,r){return ie.apply(this,arguments)}function ie(){return ie=(0,y.Z)((0,s.Z)().mark((function e(t,r,i,a){var l,o,u,c,f;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(n,2821)).then((function(e){return e.v}));case 2:if(l=e.sent.getSizeRangeAtScale(t,i,a),o=l&&ae(l),l||o){e.next=6;break}return e.abrupt("return");case 6:u=o.map((function(e){return le(e,t,l)})),u=(0,F.u)(u),c=1;case 9:if(!(c<u.length-1)){e.next=17;break}return e.next=12,se(t,r,u[c],u[c-1],i,a);case 12:(f=e.sent)&&(u[c]=f[0],o[c]=f[1]);case 14:c++,e.next=9;break;case 17:return e.abrupt("return",u);case 18:case"end":return e.stop()}}),e)}))),ie.apply(this,arguments)}function ae(e){for(var t=e.minSize,n=(e.maxSize-t)/4,r=[],i=0;i<5;i++)r.push(t+n*i);return r}function le(e,t,n){var r=n.minSize,i=n.maxSize,a=t.minDataValue,l=t.maxDataValue;return e<=r?a:e>=i?l:(e-r)/(i-r)*(l-a)+a}function se(e,t,n,r,i,a){return oe.apply(this,arguments)}function oe(){return oe=(0,y.Z)((0,s.Z)().mark((function e(t,n,i,a,l,o){var u,c,f,d,y,h,p,v,m,g,b,_,w,L,k,x,S,I,E,C,M,Z,V;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue(t,n,i,l,o);case 2:return u=e.sent,e.next=5,ue(t,n,a,l,o);case 5:c=e.sent,f=(0,F.i)(i),d=f.fractional,y=20,h=f.integer,p=null,v=null,i>0&&i<1&&(p=Math.pow(10,d),h=(0,F.i)(i*=p).integer),m=h-1;case 12:if(!(m>=0)){e.next=38;break}return g=Math.pow(10,m),b=Math.floor(i/g)*g,_=Math.ceil(i/g)*g,null!=p&&(b/=p,_/=p),w=(b+_)/2,L=(0,F.u)([b,w,_],{indexes:[1]}),k=(0,r.Z)(L,2),w=k[1],e.next=22,ue(t,n,b,l,o);case 22:return x=e.sent,e.next=25,ue(t,n,_,l,o);case 25:return S=e.sent,e.next=28,ue(t,n,w,l,o);case 28:if(I=e.sent,E=(0,F.l)(u,x,c,null),C=(0,F.l)(u,S,c,null),M=(0,F.l)(u,I,c,null),Z=E.previous<=y,V=C.previous<=y,Z&&V&&(E.previous<=C.previous?(Z=!0,V=!1):(V=!0,Z=!1)),Z?v=[b,x]:V?v=[_,S]:M.previous<=y&&(v=[w,I]),!v){e.next=35;break}return e.abrupt("break",38);case 35:m--,e.next=12;break;case 38:return e.abrupt("return",v);case 39:case"end":return e.stop()}}),e)}))),oe.apply(this,arguments)}function ue(e,t,n,r,i){return ce.apply(this,arguments)}function ce(){return ce=(0,y.Z)((0,s.Z)().mark((function e(t,r,i,a,l){var o,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(n.bind(n,2821)).then((function(e){return e.v}));case 2:return o=e.sent,u=o.getSize,e.abrupt("return",u(t,i,{scale:a,view:l,shape:"simple-marker"===r.type?r.style:null}));case 5:case"end":return e.stop()}}),e)}))),ce.apply(this,arguments)}function fe(e,t){var n=e.clone();if((0,L.c)(n))(0,V.d)(n)||n.symbolLayers.forEach((function(e){"fill"!==e.type&&(e.size=t)}));else if(function(e){return"esri.symbols.SimpleMarkerSymbol"===e.declaredClass}(n))n.size=t;else if(function(e){return"esri.symbols.PictureMarkerSymbol"===e.declaredClass}(n)){var r=n.width,i=n.height;n.height=t,n.width=t*(r/i)}else!function(e){return"esri.symbols.SimpleLineSymbol"===e.declaredClass}(n)?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(n)&&n.font&&(n.font.size=t):n.width=t;return n}function de(e){var t=Math.floor(Math.log10(Math.abs(e)))+1,n=t<4||t>6?4:t,r=Math.abs(e)>=1e6?"compact":"standard";return(0,T.m)(e,{notation:r,minimumSignificantDigits:2,maximumSignificantDigits:n})}var ye=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,he=new w.s({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),pe={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34e38,34e38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},ve=new L.y({size:6,outline:{color:[128,128,128,.5],width:.5}}),me=new L.a({style:"solid"});function ge(e){return"flow"===e.type}function be(e){return"vector-field"===e.type}function _e(e){return"raster-colormap"===e.type}function we(e){return"raster-stretch"===e.type}function Le(e){return"raster-shaded-relief"===e.type}function ke(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function xe(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function Se(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function Ie(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function Ee(e){return Ce(e)||Me(e)||Ze(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}function Ce(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function Me(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function Ze(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function Ve(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function Re(e){return"esri.renderers.PieChartRenderer"===e.declaredClass}function Fe(e,t){return ke(e)||xe(e)||Se(e)||Ie(e)||Ve(e)||Re(e)?"2d"===t.type||(0,M.s)(e):we(e)||_e(e)||Le(e)||Ce(e)||Me(e)||Ze(e)||be(e)||ge(e)}function ze(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}function Te(e){return"esri.layers.SubtypeGroupLayer"===e.declaredClass}function Ae(e){return"esri.layers.VoxelLayer"===e.declaredClass}function De(e){return"esri.layers.WMSLayer"===e.declaredClass}function Ne(e){return"esri.layers.WMTSLayer"===e.declaredClass}function Oe(e){return"esri.layers.MapImageLayer"===e.declaredClass}function Pe(e){return"esri.layers.TileLayer"===e.declaredClass}function Be(e){return"esri.layers.FeatureLayer"===e.declaredClass}function qe(e){return"esri.layers.ImageryLayer"===e.declaredClass}function He(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}function je(e){return"esri.layers.WCSLayer"===e.declaredClass}function Ue(e){return"stretch-ramp"===e.type}function We(e){var t;return"univariate-color-size"===(null===(t="authoringInfo"in e&&(null===e||void 0===e?void 0:e.authoringInfo))||void 0===t?void 0:t.type)}function Ge(e){var t="authoringInfo"in e&&(null===e||void 0===e?void 0:e.authoringInfo);return"univariate-color-size"===(null===t||void 0===t?void 0:t.type)&&"above-and-below"===(null===t||void 0===t?void 0:t.univariateTheme)}var Je=new L.y({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}}),Xe={},Ye=function(e){(0,f.Z)(r,e);var t=(0,d.Z)(r);function r(e){var n;return(0,u.Z)(this,r),(n=t.call(this,e))._handles=new h.X,n._hasColorRamp=!1,n._hasOpacityRamp=!1,n._hasSizeRamp=!1,n._webStyleSymbolCache=new Map,n._dotDensityUrlCache=new Map,n._scaleDrivenSizeVariable=null,n._hasClusterSizeVariable=!1,n.children=new b.j,n.layerView=null,n.layer=null,n.legendElements=[],n.parent=null,n.hideLayersNotInCurrentView=!1,n.keepCacheOnDestroy=!1,n.respectLayerVisibility=!0,n.sublayerIds=[],n.title=null,n.view=null,n}return(0,c.Z)(r,[{key:"initialize",value:function(){var e=this,t=function(){return e.notifyChange("ready")};this._handles.add([(0,v.a)((function(){return e.children}),"change",(function(n){var r=n.added,i=n.removed,a=e._handles;r.forEach((function(e){var n="activeLayerInfo-ready-watcher-".concat(e.layer.uid);a.add((0,v.l)((function(){return e.ready}),t,v.h),n)})),i.forEach((function(e){return a.remove(e.layer.uid)})),t()}))]),this.keepCacheOnDestroy||(Xe={})}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(Xe=null)}},{key:"effectList",get:function(){var e=this.layer,t=null;return"effect"in e&&e.effect&&((t=new x.a).effect=e.effect,t.endTransitions(),t.scale=this.scale),t}},{key:"opacity",get:function(){var e,t=this.layer.opacity,n=null===(e=this.parent)||void 0===e?void 0:e.opacity,r=this.layer.parent,i=r&&"uid"in r?this._getParentLayerOpacity(r):null;return null!=n?n*t:null!=i?i*t:t}},{key:"ready",get:function(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}},{key:"scale",get:function(){return this.view&&this.view.scale}},{key:"isScaleDriven",get:function(){var e=this.layer;if(null===e)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if("cluster"===e.featureReduction.type)return!0;if("binning"===e.featureReduction.type&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}},{key:"version",get:function(){return this._get("version")+1}},{key:"buildLegendElementsForFeatureCollections",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t){var n,r,i=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=5;break}return e.next=4,this._isLayerInCurrentView();case 4:e.t0=e.sent;case 5:if(e.t0){e.next=7;break}return e.abrupt("return",(this.legendElements=[],void this.notifyChange("ready")));case 7:return n=Array.from(t,(function(e){if(Be(e))return i._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet&&e.featureSet.features.length){var t=e.layerDefinition,n=t&&t.drawingInfo,r=n&&(0,C.t)(n.renderer),a=he.read(t.geometryType);return r?i._getRendererLegendElements(r,{title:e.name,geometryType:a}):(h.a.getLogger(i.declaredClass).warn("drawingInfo not available!"),null)}return null})),e.prev=8,r=[],e.next=12,(0,h.E)(n).then((function(e){e.forEach((function(e){var t=e.value;return t&&r.push.apply(r,(0,o.Z)(t))}))}));case 12:this.legendElements=r,this.notifyChange("ready"),e.next=19;break;case 16:e.prev=16,e.t1=e.catch(8),h.a.getLogger(this.declaredClass).warn("error while building legend for layer!",e.t1);case 19:case"end":return e.stop()}}),e,this,[[8,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForRenderer",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=6;break}return e.next=5,this._isLayerInCurrentView();case 5:e.t0=e.sent;case 6:if(!e.t0){e.next=13;break}return e.next=10,this._getRendererLegendElements(t);case 10:e.t1=e.sent,e.next=14;break;case 13:e.t1=[];case 14:this.legendElements=e.t1,this.notifyChange("ready"),e.next=21;break;case 18:e.prev=18,e.t2=e.catch(0),h.a.getLogger(this.declaredClass).warn("error while building legend for layer!",e.t2);case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForFeatureReduction",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,e.t0=!this.hideLayersNotInCurrentView,e.t0){e.next=6;break}return e.next=5,this._isLayerInCurrentView();case 5:e.t0=e.sent;case 6:if(!e.t0){e.next=13;break}return e.next=10,this._getLegendElementsForFeatureReduction(t);case 10:e.t1=e.sent,e.next=14;break;case 13:e.t1=[];case 14:this.legendElements=e.t1,this.notifyChange("ready"),e.next=21;break;case 18:e.prev=18,e.t2=e.catch(0),h.a.getLogger(this.declaredClass).warn("error while building legend for layer!",e.t2);case 21:case"end":return e.stop()}}),e,this,[[0,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"buildLegendElementsForTools",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(){var t,n,r,i,a=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ae(t=this.layer)){e.next=5;break}this._constructLegendElementsForVoxellayer(),e.next=29;break;case 5:if(!Ne(t)){e.next=9;break}this._constructLegendElementsForWMTSlayer(),e.next=29;break;case 9:if(!De(t)){e.next=14;break}return e.next=12,this._constructLegendElementsForWMSSublayers();case 12:case 17:case 22:e.next=29;break;case 14:if(!ze(t)){e.next=19;break}return e.next=17,this._constructLegendElementsForBuildingSceneLayer();case 19:if(!(Oe(t)||Pe(t)||Te(t))){e.next=24;break}return e.next=22,this._constructLegendElementsForSublayers();case 24:return this._handles.remove("imageryLayers-watcher"),n="default",qe(t)&&(n=((null===t||void 0===t||null===(r=t.renderingRule)||void 0===r?void 0:r.functionName)||"default")+"_"+(null!==(i=t.bandIds)&&void 0!==i&&i.length?t.bandIds.join(""):"###")),e.next=29,this._getLegendLayers("".concat(t.uid,"-").concat(n)).then(function(){var e=(0,y.Z)((0,s.Z)().mark((function e(n){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.legendElements=[],a.notifyChange("ready"),r=n.map(function(){var e=(0,y.Z)((0,s.Z)().mark((function e(n){var r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(qe(t)||He(t))&&(r=(0,v.l)((function(){return["renderingRule"in t&&t.renderingRule,t.bandIds]}),(function(){return(0,h.a1)((0,y.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Xe.default=null,!t.renderer){e.next=6;break}return e.next=4,a.buildLegendElementsForRenderer(t.renderer);case 4:e.next=8;break;case 6:return e.next=8,a.buildLegendElementsForTools();case 8:case"end":return e.stop()}}),e)}))))()})),a._handles.add(r,"imageryLayers-watcher")),(i=a._generateSymbolTableElementForLegendLayer(n))&&i.infos.length&&(qe(t)&&(i.title=t.title),a.legendElements.push(i)),a.notifyChange("ready");case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,(0,h.E)(r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){h.a.getLogger(a.declaredClass).warn("Request to server for legend has failed!",e)}));case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_isLayerInCurrentView",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(){var t,n,r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer,n=this.layerView,(r=n&&"createQuery"in n&&"queryFeatureCount"in n)||n&&"createQuery"in t&&"queryFeatureCount"in t){e.next=3;break}return e.abrupt("return",!0);case 3:return e.next=5,(0,v.j)((function(){return!n.updating}));case 5:if((i=r?"createQuery"in n&&n.createQuery():"createQuery"in t&&t.createQuery()).geometry=this.view.extent,!r){e.next=16;break}if(e.t1="queryFeatureCount"in n,!e.t1){e.next=13;break}return e.next=12,n.queryFeatureCount(i);case 12:e.t1=e.sent;case 13:e.t0=e.t1,e.next=22;break;case 16:if(e.t2="queryFeatureCount"in t,!e.t2){e.next=21;break}return e.next=20,t.queryFeatureCount(i);case 20:e.t2=e.sent;case 21:e.t0=e.t2;case 22:return e.t3=e.t0,e.abrupt("return",0!==e.t3);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getParentLayerOpacity",value:function(e){var t=1,n=e.parent;return n&&"uid"in n&&(t=this._getParentLayerOpacity(n)),e.opacity*t}},{key:"_isGroupActive",value:function(){var e=this.children;return!!e.length&&e.some((function(e){return e.ready}))}},{key:"_isRendererScaleDriven",value:function(e){var t=this;if("dot-density"===e.type)return!0;var n="valueExpression"in e&&e.valueExpression;if(ye.test(n))return!0;var r="visualVariables"in e&&e.visualVariables;return!!r&&r.some((function(e){return t._isScaleDrivenSizeVariable(e)}))}},{key:"_isScaleDrivenSizeVariable",value:function(e){if(e&&"size"!==e.type)return!1;var t=e,n=t.minSize,r=t.maxSize;return"object"==typeof n&&n?this._isScaleDrivenSizeVariable(n):"object"==typeof r&&r?this._isScaleDrivenSizeVariable(r):!!t.expression||ye.test(t.valueExpression)}},{key:"_isLayerScaleDriven",value:function(e){var t=this;if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some((function(e){return t._isLayerScaleDriven(e)}));var n=e.parent;if(!1===e.loaded&&n&&Oe(n)&&"source"in e&&e.source&&"map-layer"===e.source.type){var r,i=(0,l.Z)(n.sourceJSON.layers);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.id===e.source.mapLayerId&&(a.minScale>0||a.maxScale>0))return!0}}catch(s){i.e(s)}finally{i.f()}}return!1}},{key:"_constructLegendElementsForVoxellayer",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(){var t,n,r,i,a,l,o,u,c,f,d,y,m,g=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("voxel-style-watcher"),this._handles.remove("voxel-current-variable"),n=this.layer,this._handles.add((0,v.l)((function(){return n.currentVariableId}),(function(){return g._constructLegendElementsForVoxellayer()})),"voxel-current-variable"),this._handles.add((0,v.l)((function(){return n.getVariableStyles()}),(function(){return g._constructLegendElementsForVoxellayer()})),"voxel-style-watcher"),r=(0,p.e)(n.getVariableStyle(null)),i=[],r&&(null!==(t=r.uniqueValues)&&void 0!==t&&t.length?(a=[],r.uniqueValues.forEach((function(e){e.enabled&&a.push({label:e.label||"".concat(e.value),value:e.value,symbol:new L.a({color:e.color,outline:null})})})),a.length&&i.push({type:"symbol-table",title:r.label,infos:a})):r.transferFunction&&(l=r.transferFunction,o=l.colorStops,u=l.stretchRange,c=o.toArray().reverse(),f=u.map((function(e,t){return"".concat(0===t?F.s:F.d," ").concat(de(e))})).reverse(),d=c.map((function(e){return{color:e.color,value:null,label:null}})),d[0].label=f[0],d[d.length-1].label=f[1],i.push({type:"color-ramp",title:r.label,infos:d,preview:(0,R.g)(c.map((function(e){return e.color})))}))),y=n.opacity,m=i.reduce((function(e,t){return e.concat(g._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)})).map((function(e){return g._getSymbolPreview(e,y)})),e.next=8,(0,h.E)(m);case 8:this.legendElements=i,this.notifyChange("ready");case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_constructLegendElementsForWMTSlayer",value:function(){var e=this;this.legendElements=[],this._handles.remove("wmts-activeLayer-watcher");var t=this.layer.activeLayer;if(this._handles.add((0,v.l)((function(){var t=e.layer;return t&&"activeLayer"in t&&t.activeLayer}),(function(){return e._constructLegendElementsForWMTSlayer()})),"wmts-activeLayer-watcher"),t.styleId&&t.styles){var n=null;t.styles.some((function(e){return t.styleId===e.id&&(n=e.legendUrl,!0)})),n&&(this.legendElements=[{type:"symbol-table",title:t.title,infos:[{src:n,opacity:this.opacity}]}])}this.notifyChange("ready")}},{key:"_constructLegendElementsForWMSSublayers",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(){var t,n,r=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("wms-sublayers-watcher"),t=this.layer,n=null,(t.customParameters||t.customLayerParameters)&&(n=(0,a.Z)((0,a.Z)({},t.customParameters),t.customLayerParameters)),this._handles.add((0,v.l)((function(){var e=r.layer;return e&&"sublayers"in e&&e.sublayers}),(function(){return r._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),e.next=7,this._generateLegendElementsForWMSSublayers(t.sublayers,n);case 7:this.legendElements=e.sent,this.notifyChange("ready");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForWMSSublayers",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t,n){var r,i,a,o,u,c=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],this._handles.add(t.on("change",(function(){return c._constructLegendElementsForWMSSublayers()})),"wms-sublayers-watcher"),i=t.toArray(),a=(0,l.Z)(i),e.prev=4,u=(0,s.Z)().mark((function e(){var t,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.value,i=(0,v.l)((function(){return[t.title,t.visible,t.legendEnabled]}),(function(){return c._constructLegendElementsForWMSSublayers()})),c._handles.add(i,"wms-sublayers-watcher"),!(!c.respectLayerVisibility||t.visible&&t.legendEnabled)){e.next=7;break}return e.next=5,c._generateSymbolTableElementForWMSSublayer(t,n);case 5:(a=e.sent)&&a.infos.length&&r.unshift(a);case 7:case"end":return e.stop()}}),e)})),a.s();case 7:if((o=a.n()).done){e.next=11;break}return e.delegateYield(u(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),a.e(e.t1);case 16:return e.prev=16,a.f(),e.finish(16);case 19:return e.abrupt("return",r);case 20:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForWMSSublayer",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t,n){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.legendUrl||!t.sublayers){e.next=5;break}return e.next=3,this._generateLegendElementsForWMSSublayers(t.sublayers,n);case 3:return r=e.sent.filter((function(e){return e})),e.abrupt("return",{type:"symbol-table",title:t.title,infos:r});case 5:return e.abrupt("return",this._generateSymbolTableElementForLegendUrl(t,n));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendUrl",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t,n){var r,i,a,l,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.legendUrl){e.next=3;break}return e.abrupt("return");case 3:return a={type:"symbol-table",title:t.title||t.name||t.id&&t.id+"",infos:[]},n&&(i=(0,w.B)(i,n)),l=null,o=null===(r=t.layer)||void 0===r?void 0:r.opacity,e.prev=7,e.next=10,(0,w.U)(i,{responseType:"image"});case 10:(l=e.sent.data)&&(l.style.opacity=o),e.next=16;break;case 14:e.prev=14,e.t0=e.catch(7);case 16:return e.abrupt("return",(a.infos.push({src:i,preview:l,opacity:o}),a));case 17:case"end":return e.stop()}}),e,null,[[7,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getLegendLayers",value:function(e,t){var n=Xe&&Xe[e];return n?Promise.resolve(n):this._legendRequest(t).then((function(t){var n=t.layers;return Xe[e]=n,n}))}},{key:"_legendRequest",value:function(e){var t=this.layer,n={f:"json",dynamicLayers:e};if(qe(t)){var r=t.exportImageServiceParameters.renderingRule;if(r&&(n.renderingRule=JSON.stringify(r.rasterFunctionDefinition||r.toJSON())),t.bandIds&&(n.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){var i=t.raster,l=t.viewId,s=t.customParameters;n=(0,a.Z)((0,a.Z)({raster:i,viewId:l},n),s)}}var o=t.url.replace(/(\/)+$/,"");if("version"in t&&t.version>=10.01){var u=o.indexOf("?");u>-1?o=o.substring(0,u)+"/legend"+o.substring(u):o+="/legend"}else{var c=o.toLowerCase().indexOf("/rest/"),f=o.substring(0,c)+o.substring(c+5,o.length);o="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(f)+"&returnbytes=true"}return(0,w.U)(o,{query:n}).then((function(e){return e.data}))}},{key:"_constructLegendElementsForBuildingSceneLayer",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(){var t,n=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add((0,v.l)((function(){return t.sublayers}),(function(){return n._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForBuildingSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),h.a.getLogger(this.declaredClass).warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForBuildingSublayers",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t,n){var r,i,a,u,c,f=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],this._handles.add(t.on("change",(function(){return f._constructLegendElementsForBuildingSceneLayer()})),"sublayers-watcher"),i=t.toArray(),a=(0,l.Z)(i),e.prev=4,c=(0,s.Z)().mark((function e(){var t,i,a,l,c,d,y;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.value,i=(0,v.l)((function(){return["renderer"in t&&t.renderer,t.opacity,t.title,t.visible]}),(function(){return f._constructLegendElementsForBuildingSceneLayer()})),f._handles.add(i,"sublayers-watcher"),f.respectLayerVisibility&&!t.visible){e.next=21;break}if(a=t&&null!=t.opacity?t.opacity:null,l=null!=a?a*n:n,"building-group"!==t.type){e.next=12;break}return d={type:"symbol-table",title:t.title,infos:[]},e.next=8,f._generateLegendElementsForBuildingSublayers(t.sublayers,l);case 8:y=e.sent,(c=d.infos).push.apply(c,(0,o.Z)(y)),r=[d].concat((0,o.Z)(r)),e.next=21;break;case 12:if(!t.renderer){e.next=21;break}return e.t0=[],e.t1=o.Z,e.next=17,f._getRendererLegendElements(t.renderer,{title:t.title,opacity:l,sublayer:t});case 17:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=(0,o.Z)(r),r=e.t0.concat.call(e.t0,e.t3,e.t4);case 21:case"end":return e.stop()}}),e)})),a.s();case 7:if((u=a.n()).done){e.next=11;break}return e.delegateYield(c(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),a.e(e.t1);case 16:return e.prev=16,a.f(),e.finish(16);case 19:return e.abrupt("return",r.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 20:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_constructLegendElementsForSublayers",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(){var t,n=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.legendElements=[],this._handles.remove("sublayers-watcher"),t=this.layer,this._handles.add((0,v.l)((function(){return t.sublayers}),(function(){return n._constructLegendElementsForSublayers})),"sublayers-watcher"),e.prev=3,e.next=6,this._generateLegendElementsForSublayers(t.sublayers,this.opacity);case 6:this.legendElements=e.sent,this.notifyChange("ready"),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),h.a.getLogger(this.declaredClass).warn("Request to server for legend has failed!",e.t0);case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"_generateLegendElementsForSublayers",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t,n,r){var i,a,u,c,f,d,y=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.layer,a=[],this._handles.add(t.on("change",(function(){return y._constructLegendElementsForSublayers()})),"sublayers-watcher"),u=t.toArray(),!r&&this.sublayerIds&&this.sublayerIds.length&&(u=this.sublayerIds.map((function(e){return i.findSublayerById(e)})).filter(Boolean)),c=(0,l.Z)(u),e.prev=6,d=(0,s.Z)().mark((function e(){var t,l,u,c,d,p;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,l=(0,v.l)((function(){return[t.renderer,t.opacity,t.title,t.visible,t.legendEnabled]}),(function(){return y._constructLegendElementsForSublayers()})),y._handles.add(l,"sublayers-watcher"),y.respectLayerVisibility&&!(t.visible&&t.legendEnabled&&y._isSublayerInScale(t))){e.next=21;break}if(u=t&&null!=t.opacity?t.opacity:null,c=null!=u?u*n:n,d=!!Te(i)||t.originIdOf("renderer")>h.r.SERVICE,!t.renderer||t.sublayers||!d){e.next=17;break}return e.next=7,t.load();case 7:return e.t0=[],e.t1=o.Z,e.next=11,y._getRendererLegendElements(t.renderer,{title:t.title,opacity:c,sublayer:t});case 11:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=(0,o.Z)(a),a=e.t0.concat.call(e.t0,e.t3,e.t4),e.next=21;break;case 17:return e.next=19,y._generateSymbolTableElementForSublayer(t,c,r);case 19:(p=e.sent)&&a.unshift(p);case 21:case"end":return e.stop()}}),e)})),c.s();case 9:if((f=c.n()).done){e.next=13;break}return e.delegateYield(d(),"t0",11);case 11:e.next=9;break;case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(6),c.e(e.t1);case 18:return e.prev=18,c.f(),e.finish(18);case 21:return e.abrupt("return",a.filter((function(e){return!!e&&(!("infos"in e)||e.infos.length>0)})));case 22:case"end":return e.stop()}}),e,this,[[6,15,18,21]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForSublayer",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t,n,r){var i,a,l,o,u,c,f;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=9;break}return r=new Map,i=this.layer,a=t.source,l=null,(a&&("map-layer"!==a.type||a.mapLayerId!==t.id||a.gdbVersion&&a.gdbVersion!==("gdbVersion"in i&&i.gdbVersion))||t.originIdOf("renderer")>h.r.SERVICE||t.originIdOf("labelingInfo")>h.r.SERVICE||t.originIdOf("labelsVisible")>h.r.SERVICE)&&(o=new I.c({layer:this.layer}),l=o.hasDynamicLayers?o.dynamicLayers:null,o.destroy()),u=l||"".concat(i.uid,"-default"),e.next=8,this._getLegendLayers(u,l);case 8:e.sent.forEach((function(e){return r.set(e.layerId,e)}));case 9:if(!(!(c=r.get(t.id))||null!==c&&void 0!==c&&c.subLayerIds&&c.defaultVisibility)||!t.sublayers){e.next=15;break}return e.next=13,this._generateLegendElementsForSublayers(t.sublayers,n,r);case 13:return f=e.sent,e.abrupt("return",{type:"symbol-table",title:t.title,infos:f});case 15:return e.abrupt("return",this._generateSymbolTableElementForLegendLayer(c,t,n));case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_generateSymbolTableElementForLegendLayer",value:function(e,t,n){var r,i=this;if(!e||!e.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;var a=null===t||void 0===t?void 0:t.renderer,l=(null===t||void 0===t?void 0:t.title)||e.layerName;if(a&&(!t||(null===t||void 0===t?void 0:t.originIdOf("renderer"))>h.r.SERVICE)){var s=(null===t||void 0===t?void 0:t.title)||this._getRendererTitle(a,t);s&&(l&&"string"!=typeof s&&"title"in s&&(s.title=l),l=s)}var o={type:"symbol-table",title:l,legendType:e.legendType?e.legendType:null,infos:[]},u=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return(null===(r=e.legendGroups)||void 0===r?void 0:r.length)>0?e.legendGroups.forEach((function(t){var r,a={type:"symbol-table",title:t.heading,legendType:e.legendType?e.legendType:null,infos:i._generateSymbolTableElementInfosForLegendLayer(u.filter((function(e){return e.groupId===t.id})),e.layerId,n)};(null===(r=a.infos)||void 0===r?void 0:r.length)>0&&o.infos.push(a)})):o.infos=this._generateSymbolTableElementInfosForLegendLayer(u,e.layerId,n),o.infos.length>0?o:null}},{key:"_generateSymbolTableElementInfosForLegendLayer",value:function(e,t,n){var r=this;return e.map((function(e){var i=e.url;if(e.imageData&&e.imageData.length>0)i="data:image/png;base64,".concat(e.imageData);else{if(0===i.indexOf("http"))return null;i=(0,w.h)("".concat(r.layer.url,"/").concat(t,"/images/").concat(i))}return{label:e.label,src:i,opacity:null!==n&&void 0!==n?n:r.opacity,width:e.width,height:e.height}})).filter((function(e){return!!e}))}},{key:"_isSublayerInScale",value:function(e){var t=e.minScale||0,n=e.maxScale||0;return!(t>0&&t<this.scale||n>this.scale)}},{key:"_isLegendLayerInScale",value:function(e,t){var n=t||this.layer,r=null,i=null,a=!0;return!n.minScale&&0!==n.minScale||!n.maxScale&&0!==n.maxScale?(0===e.minScale&&n.tileInfo&&(r=n.tileInfo.lods[0].scale),0===e.maxScale&&n.tileInfo&&(i=n.tileInfo.lods[n.tileInfo.lods.length-1].scale)):(r=Math.min(n.minScale,e.minScale)||n.minScale||e.minScale,i=Math.max(n.maxScale,e.maxScale)),(r>0&&r<this.scale||i>this.scale)&&(a=!1),a}},{key:"_sanitizeLegendForSublayer",value:function(e,t){if("version"in this.layer&&this.layer.version<10.1||0===e.length)return e;var n=t.renderer,r=e.some((function(e){return e.values})),i=null,a=null;return r&&e.some((function(e,t){return e.values||(i=t,(a=e).label||(a.label="others")),null!=a})),n?"unique-value"===n.type?a&&(e.splice(i,1),e.push(a)):"class-breaks"===n.type&&(a&&e.splice(i,1),e.reverse(),a&&e.push(a)):a&&(e.splice(i,1),e.push(a)),e}},{key:"_getRendererLegendElements",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t){var n,r,i=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},Fe(t,this.view)){e.next=3;break}return e.abrupt("return",(h.a.getLogger(this.declaredClass).warn("Renderer of type '".concat(t.type,"' not supported!")),[]));case 3:if(!Ee(t)){e.next=5;break}return e.abrupt("return",this._constructPointCloudRendererLegendElements(t,n));case 5:if(!Ve(t)){e.next=7;break}return e.abrupt("return",this._constructDotDensityRendererLegendElements(t));case 7:return e.next=9,this._loadRenderer(t);case 9:return r=e.sent,e.abrupt("return",Re(r)?this._constructPieChartRendererLegendElements(r):this._constructRendererLegendElements(r,n));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getLegendElementsForFeatureReduction",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.abrupt("return",("binning"===t.type?n=t.renderer:"cluster"===t.type&&(n=this._getClusterRenderer(t)),n?this._getRendererLegendElements(n):[]));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getPointCloudRendererTitle",value:function(e){return e.legendOptions&&e.legendOptions.title||e.field}},{key:"_constructPointCloudRendererLegendElements",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.title,i=[],a=null,l=null;if(Ce(e))a={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach((function(e){a.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:t._getAppliedCloneSymbol(ve,e.color)})}));else if(Me(e)){var s=e.stops,o=null;if(s.length&&(1===s.length&&(o=s[0].color),!o)){var u=s[0].value,c=s[s.length-1].value;null!=u&&null!=c&&(o=(0,F.e)(u+(c-u)/2,s))}a={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(ve,o||ve.color)}]};var f=(0,F.f)(e.stops);l={type:"color-ramp",title:r||this._getPointCloudRendererTitle(e),infos:f,preview:(0,R.g)(f.map((function(e){return e.color})))}}else Ze(e)&&(a={type:"symbol-table",title:r||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos.forEach((function(e){a.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:t._getAppliedCloneSymbol(ve,e.color)})})));a&&a.infos.length&&i.push(a),l&&l.infos.length&&i.push(l);var d=i.reduce((function(e,t){return e.concat(t.infos)}),[]).filter((function(e){return!!e.symbol})).map((function(n){return t._getSymbolPreview(n,t.opacity,{symbolConfig:{applyColorModulation:!!e.colorModulation}})}));return(0,h.E)(d).then((function(){return i}))}},{key:"_getElementInfoForDotDensity",value:function(e,t){var n,r=e.backgroundColor,i=e.outline,a=e.dotSize,l=null===(n=this.effectList)||void 0===n?void 0:n.effects.map((function(e){return e.toJSON()})),s=(0,S.i)(l),o=a+"-"+t+"-"+r+"-"+(i&&JSON.stringify(i.toJSON()))+"-"+s,u=this._dotDensityUrlCache,c=u.has(o)?u.get(o):(0,R.m)(e,t);u.set(o,c);var f={shape:{type:"image",x:0,y:0,width:c.width,height:c.height,src:c.src},fill:null,stroke:null,offset:[0,0]},d=(0,R.h)([[f]],[c.width,c.height],{effectView:this.effectList});return{opacity:1,src:c.src,preview:d,width:c.width,height:c.height}}},{key:"_constructDotDensityRendererLegendElements",value:function(e){var t=this,n=e.calculateDotValue(this.view.scale),r=e.legendOptions&&e.legendOptions.unit,i={type:"symbol-table",title:{value:n&&Math.round(n),unit:r||""},infos:[]};return e.attributes.forEach((function(n){var r=t._getElementInfoForDotDensity(e,n.color);r.label=n.label||n.valueExpressionTitle||n.field,i.infos.push(r)})),Promise.resolve([i])}},{key:"_constructPieChartRendererLegendElements",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t){var n,r,i,a,l,o,u,c,f,d,y,p,v,m,g,b=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.layer.opacity,l=[],o="Others",u=t.outline,t.attributes.forEach((function(e){var t=new L.y({color:e.color,outline:u}),n=e.label||e.valueExpressionTitle||e.field;l.push({label:n,symbol:t})})),c=l.length?[].concat(l):[],null!==(n=t.othersCategory)&&void 0!==n&&n.color&&0!==(null===(r=t.othersCategory)||void 0===r?void 0:r.threshold)&&(f=new L.y({color:t.othersCategory.color,outline:u}),l.push({label:t.othersCategory.label||o,symbol:f})),null!==(i=t.defaultColor)&&void 0!==i&&i.a&&(d=new L.y({color:t.defaultColor,outline:u}),l.push({label:t.defaultLabel,symbol:d})),e.next=7,this._getVisualVariableLegendElements(t,this.layer);case 7:if(e.t0=e.sent,e.t0){e.next=10;break}e.t0=[];case 10:return y=e.t0,l.length&&(y.unshift({type:"symbol-table",title:null,infos:l}),v=c.filter((function(e){return e.label!==o})).map((function(e){return e.symbol.color})).filter(Boolean),m=(0,R.b)(v,{holePercentage:t.holePercentage,backgroundColor:null===(p=t.backgroundFillSymbol)||void 0===p?void 0:p.color,effectList:this.effectList,outline:u}),y.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(t,this.layer),infos:l,preview:m})),g=y.reduce((function(e,t){return e.concat(b._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)&&!(null!==e&&void 0!==e&&e.preview)})).map((function(e){return b._getSymbolPreview(e,a,{effectList:b.effectList})})),e.next=15,(0,h.E)(g);case 15:return e.abrupt("return",y);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_constructRendererLegendElements",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t){var n,r,i,a,u,c,f,d,y,v,m,g,b,_,w,L,k,x,S,I,E,C,M,Z,V,z,T,A,D,N,O,P,B,j,U,W,G,J,X,Y,Q,$,K,ee,te,ne,re,ie,ae,le,se,oe,ue,ce,fe,de,ye,he,ve,Ee,Ce,Me=this,Ze=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ze.length>1&&void 0!==Ze[1]?Ze[1]:{},r=n.title,i=n.sublayer,a=i||this.layer,this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null,e.next=5,this._getVisualVariableLegendElements(t,a);case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0=[];case 8:if(u=e.t0,c={type:"symbol-table",title:r||this._getRendererTitle(t,a),infos:[]},f=null,d=!1,y=new Set,!ge(t)||this._hasSizeRamp){e.next=19;break}return e.next=15,(0,F.c)(t);case 15:v=e.sent,c.infos.push({label:null,symbol:v}),e.next=84;break;case 19:if(!We(t)){e.next=25;break}m=r,g=Ge(t)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",b=u.findIndex((function(e){return"color-ramp"===e.type})),_=-1!==b?u.splice(b,1)[0]:null,w=u.findIndex((function(e){return"size-ramp"===e.type})),L=-1!==w?u.splice(w,1)[0]:null,k=[],_&&(m=_.title,k.push(_)),L&&(m=L.title,k.push(L)),k.length>0&&u.push({type:g,title:m,infos:k}),e.next=84;break;case 25:if(!Ie(t)){e.next=30;break}x=(0,F.g)(t),u.push({type:"heatmap-ramp",title:r||this._getRendererTitle(t,a),infos:x,preview:(0,R.g)(x.map((function(e){return e.color})),{effectList:this.effectList})}),e.next=84;break;case 30:if(!Se(t)){e.next=36;break}if((S=t&&t.authoringInfo)&&"relationship"===S.type){if(I=S.focus,E=S.numClasses,C=S.field1,M=S.field2,E&&C&&M){for(Z=[C,M],V=H(I)||0,z=0,T=Z;z<T.length;z++)A=T[z],D=A.field,N=A.normalizationField,O=A.label,P=O||{field:this._getFieldAlias(D,a),normField:N&&this._getFieldAlias(N,a)},(B=Je.clone()).angle=V,c.infos.push({label:P,symbol:B}),y.add(B),V+=90;j=q({focus:I,numClasses:E,infos:t.uniqueValueInfos}),u.unshift(j)}}else qe(this.layer)||He(this.layer)?t.uniqueValueInfos.forEach((function(e){e.symbol&&c.infos.push({label:e.label||e.value,value:e.value,symbol:e.symbol})})):(W=(U=t).field,G=U.field2,J=U.field3,X=U.fieldDelimiter,Y=U.valueExpression,Q=!(!W&&!Y||!G&&!J),$=[],t.uniqueValueGroups.forEach((function(e){var t={type:"symbol-table",title:e.heading,infos:[]};e.classes.forEach((function(e){var n=e.symbol,r=e.values;if(n){var i,s=[],o=[],u=(0,l.Z)(r);try{for(u.s();!(i=u.n()).done;){var c=i.value,f=c.value,d=c.value2,y=c.value3,h=[],p=[];(W||Y)&&(h.push(f),p.push(Me._getDomainName(W,f,a))),G&&(h.push(d),p.push(Me._getDomainName(G,d,a))),J&&(h.push(y),p.push(Me._getDomainName(J,y,a))),s.push(Q?h.join(X||""):h[0]),o.push(p.join(" - "))}}catch(b){u.e(b)}finally{u.f()}var v=s.join(", "),m=e.label;if(!m){var g=o.filter(Boolean);m=g.length?g.join(", "):v}t.infos.push({label:m,value:v,symbol:n})}})),t.infos.length&&$.push(t)})),$.length&&(te=$[0],1===$.length&&"title"in te&&!te.title?(K=c.infos).push.apply(K,(0,o.Z)(te.infos)):(ee=c.infos).push.apply(ee,$)));t.defaultSymbol&&(c.infos.push({label:t.defaultLabel||"others",symbol:t.defaultSymbol}),d=!0),e.next=84;break;case 36:if(!xe(t)){e.next=41;break}(!(f=this._isUnclassedRenderer(t))||!this._hasSizeRamp)&&(t.classBreakInfos.forEach((function(e){e.symbol&&c.infos.unshift({label:e.label||(f?null:e.minValue+" - "+e.maxValue),value:[e.minValue,e.maxValue],symbol:e.symbol})})),f&&(c.title=null),this._updateInfosforClassedSizeRenderer(t,c.infos)),t.defaultSymbol&&!f&&(c.infos.push({label:t.defaultLabel||"others",symbol:t.defaultSymbol}),d=!0),e.next=84;break;case 41:if(!we(t)){e.next=65;break}if(!He(this.layer)&&!je(this.layer)){e.next=47;break}Ue(ne=this._constructTileImageryStretchRendererElements(t))?u.push(ne):c.infos=ne,e.next=63;break;case 47:if(re=this.layer,t.statistics&&t.statistics.length&&(ie=null!=t.statistics[0].min?t.statistics[0].min:t.statistics[0][0],ae=null!=t.statistics[0].max?t.statistics[0].max:t.statistics[0][1]),le=[],e.t1=p.e,!re.renderingRule){e.next=57;break}return e.next=54,re.generateRasterInfo(re.renderingRule);case 54:e.t2=e.sent,e.next=58;break;case 57:e.t2=re.serviceRasterInfo;case 58:e.t3=e.t2,se=(0,e.t1)(e.t3),oe=se.keyProperties.BandProperties,ue=pe[re.rasterInfo.pixelType.toLowerCase()],1===se.bandCount||re.bandIds&&1===re.bandIds.length?(ie=null!=ie?ie:se.statistics?se.statistics[re.bandIds[0]].min:ue[0],ae=null!=ae?ae:se.statistics?se.statistics[re.bandIds[0]].max:ue[1],ie||ae?u.push(this._getStretchLegendElements(t,{min:ie,max:ae})):this._getServerSideLegend()):se.bandCount>=3?oe&&oe.length>=se.bandCount?re.bandIds&&3===re.bandIds.length?(le=re.bandIds.map((function(e){return oe[e].BandName})),c.infos=this._createSymbolTableElementMultiBand(le)):"lerc"===re.format?(le=[0,1,2].map((function(e){return oe[e].BandName})),c.infos=this._createSymbolTableElementMultiBand(le)):this._getServerSideLegend():"lerc"===re.format?(le=["band1","band2","band3"],c.infos=this._createSymbolTableElementMultiBand(le)):this._getServerSideLegend():this._getServerSideLegend();case 63:e.next=84;break;case 65:if(!_e(t)){e.next=69;break}t.colormapInfos.forEach((function(e){c.infos.push({label:e.label,value:e.value,symbol:Me._getAppliedCloneSymbol(me,e.color)})})),e.next=84;break;case 69:if(!ke(t)){e.next=83;break}ce=t.symbol,e.t4=n.geometryType,e.next="point"===e.t4?74:"polyline"===e.t4?76:"polygon"===e.t4?78:79;break;case 74:return ce="pointSymbol"in a&&a.pointSymbol,e.abrupt("break",79);case 76:return ce="lineSymbol"in a&&a.lineSymbol,e.abrupt("break",79);case 78:ce="polygonSymbol"in a&&a.polygonSymbol;case 79:fe=this._hasClusterSizeVariable&&this._getClusterSymbol()||!this._hasSizeRamp,t.symbol&&fe&&c.infos.push({label:t.label,symbol:ce}),e.next=84;break;case 83:be(t)?(t.outputUnit&&(this.title="("+t.toJSON().outputUnit+")"),c.title=t.attributeField,null!==(de=t.getClassBreakInfos())&&void 0!==de&&de.length?de.forEach((function(e){c.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})})):c.infos.push({label:t.attributeField,symbol:t.getDefaultSymbol()})):Le(t)&&u.push(this._getStretchLegendElements(t,{min:0,max:255}));case 84:return!(ye=t.defaultSymbol)||d||ke(t)||f&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||u.push({type:"symbol-table",infos:[{label:t.defaultLabel||"others",symbol:ye}]}),c.infos.length&&u.unshift(c),he=null==n.opacity?this.opacity:n.opacity,ve=this._isTallSymbol("visualVariables"in t&&t.visualVariables),Ee=qe(this.layer)||He(this.layer),Ce=u.reduce((function(e,t){return e.concat(Me._getAllInfos(t))}),[]).filter((function(e){return!(null===e||void 0===e||!e.symbol)})).map((function(e){return Me._getSymbolPreview(e,he,{isDefault:e.symbol===ye,applyScaleDrivenSize:!y.has(e.symbol),symbolConfig:{isTall:ve,isSquareFill:Ee},effectList:y.has(e.symbol)?null:Me.effectList})})),t=null,e.next=90,(0,h.E)(Ce);case 90:return e.abrupt("return",u);case 91:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getServerSideLegend",value:function(){var e=this;setTimeout((function(){return e.buildLegendElementsForTools()}),0)}},{key:"_getAllInfos",value:function(e){var t=this,n=null===e||void 0===e?void 0:e.infos;return n?n.reduce((function(e,n){return e.concat(t._getAllInfos(n))}),[]):[e]}},{key:"_constructTileImageryStretchRendererElements",value:function(e){var t,n,r,i,a,l=this.layer,s=l.rasterInfo,o=s.bandCount||e.statistics.length,u=s.keyProperties&&s.keyProperties.BandProperties,c=null!==e&&void 0!==e&&null!==(t=e.statistics)&&void 0!==t&&t.length?e.statistics:null===s||void 0===s?void 0:s.statistics;if(c)r=void 0!==c[0].min?c[0].min:c[0][0],i=c[0].max||c[0][1];else{var f=pe[l.rasterInfo.pixelType.toLowerCase()];r=f[0],i=f[1]}if(l.hasStandardTime()&&(r=l.getStandardTimeValue(r),i=l.getStandardTimeValue(i)),1===s.bandCount||1===(null===(n=l.bandIds)||void 0===n?void 0:n.length))return this._getStretchLegendElements(e,{min:r,max:i});function d(e){var t,n=(null!==l&&void 0!==l&&null!==(t=l.bandIds)&&void 0!==t&&t.length?l.bandIds:Array.from(Array(Math.min(s.bandCount,3)).keys())).map((function(t){return e&&e[t]&&e[t].BandName||"band"+(t+1)}));return n.length<3?n.push(n[1]):n.length>3&&n.splice(3),n}return a=u&&u.length>=o?d(u):d(),this._createSymbolTableElementMultiBand(a)}},{key:"_getStretchLegendElements",value:function(e,t){var n=e.colorRamp,r=(0,F.h)(n,t);return{type:"stretch-ramp",title:"",infos:r,preview:(0,R.g)(r.map((function(e){return e.color})))}}},{key:"_getClusterSymbol",value:function(){var e,t=this.layer,n="featureReduction"in t&&t.featureReduction,r=n&&"symbol"in n&&n.renderer;return r&&!0!==(null===r||void 0===r||null===(e=r.authoringInfo)||void 0===e?void 0:e.isAutoGenerated)?null:n&&"symbol"in n&&n.symbol}},{key:"_getSizeLegendElement",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t,n,r,i){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this._hasClusterSizeVariable?this._getClusterTitle(n):t,e.t1=J,e.t2=r,e.t3=n,e.next=6,(0,F.j)(r);case 6:return e.t4=e.sent,e.t5=this.scale,e.t6=this.view.type,e.t7=i,e.t8=this._hasClusterSizeVariable?this._getClusterSymbol():null,e.next=13,(0,e.t1)(e.t2,e.t3,e.t4,e.t5,e.t6,e.t7,e.t8);case 13:return e.t9=e.sent,e.abrupt("return",{type:"size-ramp",title:e.t0,infos:e.t9});case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_createSymbolTableElementMultiBand",value:function(e){var t=this,n=[],r=["red","green","blue"];return e.forEach((function(e,i){var a;n.push({label:{colorName:r[i],bandName:e},src:F.m[i],opacity:null!==(a=t.opacity)&&void 0!==a?a:1})})),n}},{key:"_updateInfosforClassedSizeRenderer",value:function(e,t){var n=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,r=e.classBreakInfos.some((function(e){return(0,V.d)(e.symbol)}));if(n&&r){var i=e.classBreakInfos.length,a=18/(i>1?i-1:i);t.forEach((function(e,t){e.size=30-a*t}))}}},{key:"_isTallSymbol",value:function(e){var t=!1,n=!1;if(e)for(var r=0;r<e.length&&(!t||!n);r++){var i=e[r];"size"===i.type&&("height"===i.axis&&(t=!0),"width-and-depth"===i.axis&&(n=!0))}return t&&n}},{key:"_getSymbolPreview",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t,r,i){var a,l,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!==i&&void 0!==i&&i.isDefault||null!=t.size||!this._hasSizeRamp?t.size:(0,k.e)(R.t.size),!this._scaleDrivenSizeVariable||null===i||void 0===i||!i.applyScaleDrivenSize){e.next=7;break}return e.next=4,Promise.resolve().then(n.bind(n,2821)).then((function(e){return e.v}));case 4:l=e.sent,o=l.getSize,a=o(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===t.symbol.type?t.symbol.style:null});case 7:return e.abrupt("return",(0,R.S)(t.symbol,{size:a,opacity:r,scale:!1,symbolConfig:null===i||void 0===i?void 0:i.symbolConfig,effectView:null===i||void 0===i?void 0:i.effectList}).then((function(e){return t.preview=e,t})).catch((function(){return t.preview=null,t})));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"_getClusterRenderer",value:function(e){var t;this._hasClusterSizeVariable=!1;var n="renderer"in this.layer&&this.layer.renderer,r=(null===(t=e.renderer)||void 0===t?void 0:t.clone())||(null===n||void 0===n?void 0:n.clone()),i=(0,p.e)(function(e,t){if(!e||!("visualVariables"in e)||!e.visualVariables)return null;var n=e.visualVariables.find((function(e){return"size"===e.type})),r=function(e,t){var n=e.featuresTilingScheme.getClosestInfoForScale(e.scale).level;return null!==t&&void 0!==t&&t.levels?t.levels[n]:null}(t,n);return r?new Z.a({field:n.field,minSize:r[2].size,minDataValue:r[2].value,maxSize:r[3].size,maxDataValue:r[3].value}):null}(this.layerView._effectiveRenderer,this.view));if(i&&"visualVariables"in r){var a,l=null===(a=r.visualVariables)||void 0===a?void 0:a.some((function(e){return"size"===e.type&&"outline"!==e.target&&!ye.test(e.valueExpression)}));if(!l){if("clusterMinSize"in e&&"clusterMaxSize"in e){var s=e.clusterMinSize,o=e.clusterMaxSize;i.legendOptions=new Z.c({showLegend:s!==o})}var u=r.visualVariables||[];r.visualVariables=u.concat([i]),this._hasClusterSizeVariable=!0}}return r}},{key:"_loadRenderer",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t){var n,r,i,a,l=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],r=t.clone(),e.next=4,(0,F.j)(r);case 4:return i=e.sent,(xe(r)||Se(r))&&(a=(r.classBreakInfos||r.uniqueValueInfos).map((function(e){return l._fetchSymbol(e.symbol,i).then((function(t){e.symbol=t})).catch((function(){e.symbol=null}))})),Array.prototype.push.apply(n,a)),e.abrupt("return",(n.push(this._fetchSymbol(r.symbol||r.defaultSymbol,r.defaultSymbol?null:i).then((function(e){l._applySymbolToRenderer(r,e,ke(r))})).catch((function(){l._applySymbolToRenderer(r,null,ke(r))}))),(0,h.E)(n).then((function(){return r}))));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_applySymbolToRenderer",value:function(e,t,n){n?e.symbol=t:e.defaultSymbol=t}},{key:"_fetchSymbol",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t,n){var r,i;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error;case 2:if("web-style"!==t.type){e.next=14;break}return r=this._webStyleSymbolCache,e.prev=4,e.next=7,"2d"===this.view.type?t.fetchCIMSymbol({cache:r}):t.fetchSymbol({cache:r});case 7:return i=e.sent,e.abrupt("return",this._getAppliedCloneSymbol(i,n));case 11:throw e.prev=11,e.t0=e.catch(4),h.a.getLogger(this.declaredClass).warn("Fetching web-style failed!"),new Error;case 14:return e.abrupt("return",this._getAppliedCloneSymbol(t,n));case 15:case"end":return e.stop()}}),e,this,[[4,11]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getAppliedCloneSymbol",value:function(e,t){if(!e||!t)return e;var n=e.clone(),r=t&&t.toRgba();return n.type.includes("3d")?this._applyColorTo3dSymbol(n,r):"cim"===n.type?(0,V.I)(n,t):n.color&&(n.color=new _.l(r||n.color)),n}},{key:"_applyColorTo3dSymbol",value:function(e,t){t&&e.symbolLayers.forEach((function(e){e&&(e.material||(e.material={}),e.material.color=new _.l(t))}))}},{key:"_getVisualVariableLegendElements",value:function(){var e=(0,y.Z)((0,s.Z)().mark((function e(t,n){var r,i,a,o,u,c,f,d,h,v,m,g,b,_=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("visualVariables"in t&&t.visualVariables&&"vector-field"!==t.type){e.next=2;break}return e.abrupt("return",null);case 2:r=t.visualVariables,i=[],a=[],o=[],u=(0,l.Z)(r);try{for(u.s();!(c=u.n()).done;)"color"===(f=c.value).type?i.push(f):"size"===f.type?a.push(f):"opacity"===f.type&&o.push(f)}catch(w){u.e(w)}finally{u.f()}return d=[].concat(i,a,o),0===i.length&&xe(t)&&t.classBreakInfos&&1===t.classBreakInfos.length&&(m=t.classBreakInfos[0],h=m&&m.symbol),0===i.length&&ke(t)&&(h=t.symbol),h&&(h.type.includes("3d")?"water"===(g=h.symbolLayers.getItemAt(0)).type?(0,p.r)(g.color)&&(v=g.color):(0,p.r)(g.material)&&(0,p.r)(g.material.color)&&(v=g.material.color):h.url||(v=h.color)),b=this.effectList,e.next=11,Promise.all(d.map(function(){var e=(0,y.Z)((0,s.Z)().mark((function e(r){var i,a,l,o,u,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.legendOptions&&!1===r.legendOptions.showLegend){e.next=28;break}if(i=ge(t)?r.field:_._getRampTitle(r,n),a=null,l="getField"in n&&n.getField&&n.getField(r.field),o=l&&(0,E.r)(l),"color"!==r.type){e.next=11;break}return e.next=7,(0,F.k)(r,null,o);case 7:u=e.sent,a={type:"color-ramp",title:i,infos:u,preview:(0,R.g)(u.map((function(e){return e.color})),{effectList:b})},_._hasColorRamp||(_._hasColorRamp=!(null==a.infos||!a.infos.length)),e.next=27;break;case 11:if("size"!==r.type||"outline"===r.target){e.next=22;break}if(!ye.test(r.valueExpression)){e.next=16;break}_._hasClusterSizeVariable||(_._scaleDrivenSizeVariable=r),e.next=20;break;case 16:return e.next=18,_._getSizeLegendElement(i,r,t,o);case 18:a=e.sent,_._hasSizeRamp||(_._hasSizeRamp=!(null==a.infos||!a.infos.length));case 20:e.next=27;break;case 22:if("opacity"!==r.type){e.next=27;break}return e.next=25,(0,F.k)(r,v,o);case 25:c=e.sent,a={type:"opacity-ramp",title:i,infos:c,preview:(0,R.g)(c.map((function(e){return e.color})),{effectList:b})},_._hasOpacityRamp||(_._hasOpacityRamp=!(null==a.infos||!a.infos.length));case 27:return e.abrupt("return",a&&a.infos?a:null);case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return e.abrupt("return",e.sent.filter((function(e){return!!e})));case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getDomainName",value:function(e,t,n){if(e&&"function"!=typeof e){var r="getField"in n&&n.getField&&n.getField(e),i=r&&"getFieldDomain"in n&&n.getFieldDomain?n.getFieldDomain(r.name):null;return i&&"coded-value"===i.type?i.getName(t):null}return null}},{key:"_getClusterTitle",value:function(e){var t=this.layer,n=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){var r=t.featureReduction,i="popupTemplate"in r&&r.popupTemplate,a=i&&i.fieldInfos;if(a){var s,o=(0,l.Z)(a);try{for(o.s();!(s=o.n()).done;){var u=s.value;if(u.fieldName===n)return"cluster_count"===n?u.label||{showCount:!0}:u.label}}catch(c){o.e(c)}finally{o.f()}}}return{showCount:!0}}},{key:"_getRampTitle",value:function(e,t){var n=e.field,r=e.normalizationField,i=!1,a=!1,l=!1,s=null;n="function"==typeof n?null:n,r="function"==typeof r?null:r;var o=e.legendOptions&&e.legendOptions.title;if(null!=o)s=o;else if(e.valueExpressionTitle)s=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo&&t.renderer.authoringInfo.visualVariables)for(var u=t.renderer.authoringInfo.visualVariables,c=0;c<u.length;c++){var f=u[c];if("color"===f.type){if("ratio"===f.style){i=!0;break}if("percent"===f.style){a=!0;break}if("percent-of-total"===f.style){l=!0;break}}}s={field:n&&this._getFieldAlias(n,t),normField:r&&this._getFieldAlias(r,t),ratio:i,ratioPercent:a,ratioPercentTotal:l}}return s}},{key:"_getRendererTitle",value:function(e,t){var n=e;if(n.legendOptions&&n.legendOptions.title)return n.legendOptions.title;if(n.valueExpressionTitle)return n.valueExpressionTitle;var r=n.field,i=null,a=null;if(xe(n)&&(i=n.normalizationField,a="percent-of-total"===n.normalizationType),r="function"==typeof r?null:r,i="function"==typeof i?null:i,Se(n)){var l=n.field2,s=n.field3,o=n.fieldDelimiter,u=r&&this._getFieldAlias(r,t);return l&&(u="<".concat(u,">").concat(o,"<").concat(this._getFieldAlias(l,t),">"),s&&(u="".concat(u).concat(o,"<").concat(this._getFieldAlias(s,t),">"))),u}var c=null;return(r||i)&&(c={field:r&&this._getFieldAlias(r,t),normField:i&&this._getFieldAlias(i,t),normByPct:a}),c}},{key:"_getFieldAlias",value:function(e,t){var n,r,i,a="popupTemplate"in t&&t.popupTemplate,l=a&&a.fieldInfos,s=null;l&&l.some((function(t){return e===t.fieldName&&(s=t,!0)}));var o=null;"getField"in t&&t.getField?o=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(o=t.fieldsIndex.get(e));var u=null,c="featureReduction"in t&&t.featureReduction;c&&(!s&&"popupTemplate"in c&&c.popupTemplate&&c.popupTemplate.fieldInfos&&c.popupTemplate.fieldInfos.some((function(t){var n;return(null===e||void 0===e?void 0:e.toLowerCase())===(null===(n=t.fieldName)||void 0===n?void 0:n.toLowerCase())&&(s=t,!0)})),"fields"in c&&c.fields&&(u=c.fields.find((function(t){var n;return(null===(n=t.name)||void 0===n?void 0:n.toLowerCase())===(null===e||void 0===e?void 0:e.toLowerCase())}))));var f=s||o||u,d=null;return f&&(d=(null===(n=s)||void 0===n?void 0:n.label)||(null===(r=o)||void 0===r?void 0:r.alias)||(null===(i=u)||void 0===i?void 0:i.alias)||"name"in f&&f.name||"fieldName"in f&&f.fieldName),d}},{key:"_isUnclassedRenderer",value:function(e){var t=e.visualVariables,n=!1;return xe(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(n=e.field?t.some((function(t){return!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField)})):!!t.length),n}}]),r}(h.m);(0,h.e)([(0,h.y)()],Ye.prototype,"children",void 0),(0,h.e)([(0,h.y)({readOnly:!0})],Ye.prototype,"effectList",null),(0,h.e)([(0,h.y)()],Ye.prototype,"layerView",void 0),(0,h.e)([(0,h.y)()],Ye.prototype,"layer",void 0),(0,h.e)([(0,h.y)()],Ye.prototype,"legendElements",void 0),(0,h.e)([(0,h.y)({readOnly:!0})],Ye.prototype,"opacity",null),(0,h.e)([(0,h.y)()],Ye.prototype,"parent",void 0),(0,h.e)([(0,h.y)({readOnly:!0,dependsOn:[]})],Ye.prototype,"ready",null),(0,h.e)([(0,h.y)()],Ye.prototype,"hideLayersNotInCurrentView",void 0),(0,h.e)([(0,h.y)()],Ye.prototype,"keepCacheOnDestroy",void 0),(0,h.e)([(0,h.y)()],Ye.prototype,"respectLayerVisibility",void 0),(0,h.e)([(0,h.y)({readOnly:!0})],Ye.prototype,"scale",null),(0,h.e)([(0,h.y)()],Ye.prototype,"sublayerIds",void 0),(0,h.e)([(0,h.y)({readOnly:!0})],Ye.prototype,"isScaleDriven",null),(0,h.e)([(0,h.y)()],Ye.prototype,"title",void 0),(0,h.e)([(0,h.y)({readOnly:!0,dependsOn:["ready"],value:0})],Ye.prototype,"version",null),(0,h.e)([(0,h.y)()],Ye.prototype,"view",void 0);var Qe=Ye=(0,h.e)([(0,h.n)("esri.widgets.Legend.support.ActiveLayerInfo")],Ye),$e="state",Ke="view",et="all-layer-views",tt="legend-properties",nt=b.j.ofType(Qe),rt=["esri.layers.BuildingSceneLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.SubtypeGroupLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer"],it="view.basemapView.baseLayerViews",at="view.groundView.layerViews",lt="view.basemapView.referenceLayerViews",st=[it,at,"view.layerViews",lt],ot=function(e){(0,f.Z)(n,e);var t=(0,d.Z)(n);function n(e){var r;return(0,u.Z)(this,n),(r=t.call(this,e))._handles=new h.X,r._layerViewByLayerId={},r._layerInfosByLayerViewId={},r._activeLayerInfosByLayerViewId={},r._activeLayerInfosWithNoParent=new b.j,r.activeLayerInfos=new nt,r.basemapLegendVisible=!1,r.groundLegendVisible=!1,r.hideLayersNotInCurrentView=!1,r.keepCacheOnDestroy=!1,r.respectLayerVisibility=!0,r.layerInfos=[],r.view=null,r}return(0,c.Z)(n,[{key:"initialize",value:function(){var e=this;this._handles.add((0,v.l)((function(){return e.view}),(function(){return e._viewHandles()}),v.h),Ke),this._handles.add((0,A.s)((function(){return e._refresh()})))}},{key:"destroy",value:function(){this._destroyViewActiveLayerInfos(),this._handles.destroy(),this._handles=null,this.view=null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"_viewHandles",value:function(){var e=this;this._handles.remove($e),this.view&&this._handles.add((0,v.l)((function(){return e.state}),(function(){return e._stateHandles()}),v.h),$e)}},{key:"_stateHandles",value:function(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}},{key:"_resetAll",value:function(){this._handles.remove([et,tt]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}},{key:"_destroyViewActiveLayerInfos",value:function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}},{key:"_destroyViewActiveLayerInfo",value:function(e){this._handles.remove(e);var t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t&&t.parent&&t.parent.children.remove(t)}},{key:"_watchPropertiesAndAllLayerViews",value:function(){var e=this,t=this.view.allLayerViews;t.length&&this._refresh(),this._handles.add(t.on("change",(function(t){return e._allLayerViewsChangeHandle(t)})),et),this._handles.add((0,v.l)((function(){return[e.layerInfos,e.basemapLegendVisible,e.groundLegendVisible]}),(function(){return e._propertiesChangeHandle()})),tt)}},{key:"_allLayerViewsChangeHandle",value:function(e){var t=this;e.removed.forEach((function(e){return t._destroyViewActiveLayerInfo(e.uid)})),this._refresh()}},{key:"_propertiesChangeHandle",value:function(){this._destroyViewActiveLayerInfos(),this._refresh()}},{key:"_refresh",value:function(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}},{key:"_sortActiveLayerInfos",value:function(e){var t=this;if(!(e.length<2)){var n=[];e.forEach((function(r){if(!r.parent){var i=r.layer.parent,a=i&&"uid"in i&&t._layerViewByLayerId[i.uid],l=a&&t._activeLayerInfosByLayerViewId[a.uid];l&&e.includes(l)&&(n.push(r),r.parent=l,l.children.add(r),t._sortActiveLayerInfos(l.children))}})),e.removeMany(n);var r={};this.view.allLayerViews.forEach((function(e,t){return r[e.layer.uid]=t})),e.sort((function(e,t){var n=r[e.layer.uid]||0;return(r[t.layer.uid]||0)-n}))}}},{key:"_generateLayerViews",value:function(){var e=[];return st.filter(this._filterLayerViews,this).map(this.get,this).filter((function(e){return null!=e})).forEach(this._collectLayerViews("layerViews",e)),e}},{key:"_filterLayerViews",value:function(e){var t=!this.basemapLegendVisible&&(e===it||e===lt),n=!this.groundLegendVisible&&e===at;return!t&&!n}},{key:"_collectLayerViews",value:function(e,t){return function n(r){return r&&r.forEach((function(r){t.push(r),n(r[e])})),t}}},{key:"_filterLayerViewsByLayerInfos",value:function(e){var t=this,n=this.layerInfos;return!n||!n.length||n.some((function(n){return t._hasLayerInfo(n,e)}))}},{key:"_hasLayerInfo",value:function(e,t){var n=this._isLayerUIDMatching(e.layer,t.layer.uid);return n&&(this._layerInfosByLayerViewId[t.uid]=e),n}},{key:"_isLayerUIDMatching",value:function(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}},{key:"_hasLayerUID",value:function(e,t){var n=this;return e&&e.some((function(e){return n._isLayerUIDMatching(e,t)}))}},{key:"_isLayerViewSupported",value:function(e){return!!rt.includes(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}},{key:"_generateActiveLayerInfo",value:function(e){var t=this;this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add((0,v.l)((function(){var t;return[e.legendEnabled,null===(t=e.layer)||void 0===t?void 0:t.legendEnabled]}),(function(){return t._layerActiveHandle(e)})),e.uid))}},{key:"_layerActiveHandle",value:function(e){this._isLayerActive(e)&&(this._handles.remove(e.uid),this._buildActiveLayerInfo(e))}},{key:"_isLayerActive",value:function(e){return!this.respectLayerVisibility||e.legendEnabled&&e.get("layer.legendEnabled")}},{key:"_buildActiveLayerInfo",value:function(e){var t,n=this,r=e.layer,i=e.uid,a=this._layerInfosByLayerViewId[i],l=this._activeLayerInfosByLayerViewId[i];if(!l){var s=a&&void 0!==a.title&&a.layer.uid===r.uid;l=new Qe({layer:r,layerView:e,title:s?a.title:r.title,view:this.view,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:a&&a.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[i]=l}var o=r.parent&&"uid"in r.parent&&this._layerViewByLayerId[null===(t=r.parent)||void 0===t?void 0:t.uid];if(l.parent=this._activeLayerInfosByLayerViewId[null===o||void 0===o?void 0:o.uid],!this._handles.has(i)){var u=[(0,v.l)((function(){return r.title}),(function(e){return n._titleHandle(e,l)})),(0,v.l)((function(){return[r.opacity,"renderer"in r&&r.renderer,"pointSymbol"in r&&r.pointSymbol,"lineSymbol"in r&&r.lineSymbol,"polygonSymbol"in r&&r.polygonSymbol]}),(function(){return n._constructLegendElements(l)})),(0,v.f)((function(){var e;return!0===(null===(e=n.view)||void 0===e?void 0:e.stationary)}),(function(){return n._scaleHandle(l)}),v.h),(0,v.l)((function(){return e._effectiveRenderer}),(function(){return n._constructLegendElements(l)})),(0,v.l)((function(){return"effect"in r&&r.effect}),(function(){return n._constructLegendElements(l)}))];if(this.respectLayerVisibility){var c=(0,v.l)((function(){return e.legendEnabled}),(function(e){return n._legendEnabledHandle(e,l)})),f=(0,v.l)((function(){return r.legendEnabled}),(function(e){return n._legendEnabledHandle(e,l)}));u.push(c,f)}this._handles.add(u,i)}l.isScaleDriven||this._constructLegendElements(l),this._addActiveLayerInfo(l)}},{key:"_titleHandle",value:function(e,t){t.title=e,this._constructLegendElements(t)}},{key:"_legendEnabledHandle",value:function(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}},{key:"_scaleHandle",value:function(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}},{key:"_addActiveLayerInfo",value:function(e){var t=this,n=e.layerView,r=e.layer;if(this._isLayerActive(n)&&!this.activeLayerInfos.includes(e)){var i=e.parent;if(i)i.children.includes(e)||i.children.push(e),this._sortActiveLayerInfos(i.children);else{var a,l=null===(a=this.layerInfos)||void 0===a?void 0:a.some((function(e){return e.layer.uid===r.uid}));r.parent&&"uid"in r.parent&&!l?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){var s=[];this._activeLayerInfosWithNoParent.forEach((function(e){var n=e.layer.parent,r=n&&"uid"in n&&t._layerViewByLayerId[null===n||void 0===n?void 0:n.uid],i=t._activeLayerInfosByLayerViewId[null===r||void 0===r?void 0:r.uid];i&&(s.push(e),e.parent=i)})),s.length&&(this._activeLayerInfosWithNoParent.removeMany(s),s.forEach((function(e){return t._addActiveLayerInfo(e)})))}}}},{key:"_removeActiveLayerInfo",value:function(e){var t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}},{key:"_constructLegendElements",value:function(e){var t=this,n=e.layer;"featureCollections"in n&&n.featureCollections?e.buildLegendElementsForFeatureCollections(n.featureCollections):"featureReduction"in n&&n.featureReduction&&"renderer"in n.featureReduction&&("binning"===n.featureReduction.type||"cluster"===n.featureReduction.type)?e.buildLegendElementsForFeatureReduction(n.featureReduction):"renderer"in n&&n.renderer&&!("sublayers"in n)?e.buildLegendElementsForRenderer(n.renderer):"url"in n&&n.url?e.buildLegendElementsForTools():e.children.forEach((function(e){return t._constructLegendElements(e)}))}}]),n}(h.m);(0,h.e)([(0,h.y)({type:nt})],ot.prototype,"activeLayerInfos",void 0),(0,h.e)([(0,h.y)()],ot.prototype,"basemapLegendVisible",void 0),(0,h.e)([(0,h.y)()],ot.prototype,"groundLegendVisible",void 0),(0,h.e)([(0,h.y)()],ot.prototype,"hideLayersNotInCurrentView",void 0),(0,h.e)([(0,h.y)()],ot.prototype,"keepCacheOnDestroy",void 0),(0,h.e)([(0,h.y)()],ot.prototype,"respectLayerVisibility",void 0),(0,h.e)([(0,h.y)()],ot.prototype,"layerInfos",void 0),(0,h.e)([(0,h.y)({readOnly:!0})],ot.prototype,"state",null),(0,h.e)([(0,h.y)()],ot.prototype,"view",void 0);var ut=ot=(0,h.e)([(0,h.n)("esri.widgets.Legend.LegendViewModel")],ot),ct="http://www.w3.org/2000/svg",ft="esri-relationship-ramp--diamond__container",dt="esri-relationship-ramp--diamond__left-column",yt="esri-relationship-ramp--diamond__right-column",ht="esri-relationship-ramp--diamond__middle-column",pt="esri-relationship-ramp--diamond__middle-column--label",vt="esri-relationship-ramp--diamond__middle-column--ramp",mt="esri-relationship-ramp--square__table",gt="esri-relationship-ramp--square__table-row",bt="esri-relationship-ramp--square__table-cell",_t="esri-relationship-ramp--square__table-label",wt="esri-relationship-ramp--square__table-label--left-bottom",Lt="esri-relationship-ramp--square__table-label--right-bottom",kt="esri-relationship-ramp--square__table-label--left-top",xt="esri-relationship-ramp--square__table-label--right-top";function St(e,t,n,r){var i=e.focus,a=e.labels,l=!!i,s=function(e,t,n,r){for(var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:60,a=e.focus,l=e.numClasses,s=e.colors,o=e.rotation,u=!!a,c=Math.sqrt(Math.pow(i,2)+Math.pow(i,2))+(u?0:5),f=[],d=[],y=[],h=(i||75)/l,p=0;p<l;p++)for(var v=p*h,g=0;g<l;g++){var b=g*h,_=(0,R.A)(s[p][g]),w=(0,R.a)(null),L={type:"rect",x:b,y:v,width:h,height:h};f.push((0,R.N)(_)),d.push((0,R.M)(L,_.fill,w,null)),y.push((0,R.E)(L))}var k=10,x=15,S=15,I=10,E=null;u||(E="margin: -15px -15px -18px -15px");var C=It("left",a,t),M=It("right",a,t),Z=(0,R.V)(y),F=(0,R.C)(Z,c,c,0,!1,o,!1),z=(0,R.C)(Z,c,c,0,!1,u?-45:null,!1),T={filter:(0,V.q)(r),opacity:null==n?null:"".concat(n)};return(0,m.n)("div",{styles:T,class:u?vt:bt},(0,m.n)("svg",{xmlns:ct,width:c,height:c,style:E},(0,m.n)("defs",null,(0,m.n)("marker",{id:"".concat(t,"_arrowStart"),markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,m.n)("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),(0,m.n)("marker",{id:"".concat(t,"_arrowEnd"),markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},(0,m.n)("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555","stroke-width":"1"})),f),(0,m.n)("g",{transform:F},d),(0,m.n)("g",{transform:z},(0,m.n)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":C.markerStart,"marker-end":C.markerEnd,x1:-k,y1:i-x,x2:-k,y2:x}),(0,m.n)("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":M.markerStart,"marker-end":M.markerEnd,x1:S,y1:i+I,x2:i-S,y2:i+I}))))}(e,t,n,r),o=(0,m.f)();return l?(0,m.n)("div",{class:ft,styles:{justifyContent:"center"}},(0,m.n)("div",{class:dt},o?a.right:a.left),(0,m.n)("div",{class:ht},(0,m.n)("div",{class:pt},a.top),s,(0,m.n)("div",{class:pt},a.bottom)),(0,m.n)("div",{class:yt},o?a.left:a.right)):(0,m.n)("div",{class:mt},(0,m.n)("div",{class:gt},(0,m.n)("div",{class:(0,m.p)(bt,_t,Lt)},o?a.top:a.left),(0,m.n)("div",{class:bt}),(0,m.n)("div",{class:(0,m.p)(bt,_t,wt)},o?a.left:a.top)),(0,m.n)("div",{class:gt},(0,m.n)("div",{class:bt}),s,(0,m.n)("div",{class:bt})),(0,m.n)("div",{class:gt},(0,m.n)("div",{class:(0,m.p)(bt,_t,xt)},o?a.right:a.bottom),(0,m.n)("div",{class:bt}),(0,m.n)("div",{class:(0,m.p)(bt,_t,kt)},o?a.bottom:a.right)))}function It(e,t,n){var r="".concat(n,"_arrowStart"),i="".concat(n,"_arrowEnd"),a="left"===e,l={markerStart:null,markerEnd:null};switch(t){case"HL":a?l.markerStart="url(#".concat(i,")"):l.markerEnd="url(#".concat(r,")");break;case"LL":l.markerStart="url(#".concat(i,")");break;case"LH":a?l.markerEnd="url(#".concat(r,")"):l.markerStart="url(#".concat(i,")");break;default:l.markerEnd="url(#".concat(r,")")}return l}var Et=(0,m.i)(),Ct=20,Mt=10,Zt=20,Vt="esri-univariate-above-and-below-ramp__symbol",Rt="esri-legend__color-ramp";function Ft(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertical",t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?(0,m.n)("svg",{height:"4",width:"10"},(0,m.n)("line",{x1:"0",y1:"2",x2:"10",y2:"2",style:t})):(0,m.n)("svg",{height:"10",width:"10"},(0,m.n)("line",{x1:"5",y1:"0",x2:"5",y2:"10",style:t}))}function zt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",n=document.createElement("div");return n.style.height="".concat(Ct,"px"),n.className=Vt,null!=e&&(n.style.opacity=e.toString()),Et.append(n,Ft.bind(null,t)),n}function Tt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",r=arguments.length>3?arguments[3]:void 0;e.infos.forEach((function(e,i){if(r&&2===i)e.preview=zt(t,n);else{var a=(0,k.u)(e.size)+("horizontal"===n?Zt:Mt),l="div"===e.preview.tagName.toLowerCase(),s=l?e.preview:document.createElement("div");s.className=Vt,"horizontal"===n?s.style.width="".concat(a,"px"):s.style.height="".concat(a,"px"),l||s.appendChild(e.preview),e.preview=s}}))}function At(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"classic",n=e.infos;return"classic"===t?((0,k.u)(n[0].size)+Mt)/2:((0,k.u)(n[0].size)-(0,k.u)(n[n.length-1].size))/2}function Dt(e,t){if(!e)return null;var n=e.infos.map((function(e){return e.color})),r=(0,R.g)("full"===t.type?n:"above"===t.type?n.slice(0,3):n.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList});return r.className=Rt,null!=t.opacity&&(r.style.opacity=t.opacity.toString()),r}function Nt(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",i=0,a=e.infos,l=Math.floor(a.length/2),s="full"===t||"above"===t?0:l,o="full"===t||"below"===t?a.length-1:l,u=s;u<=o;u++)i+=n&&u===l?"horizontal"===r?10:Ct:(0,k.u)(a[u].size)+("horizontal"===r?Zt:Mt);return Math.round(i)}function Ot(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",i=Nt(e,t,n,r),a=e.infos,l=Math.floor(a.length/2),s="full"===t||"above"===t?0:l,o="full"===t||"below"===t?a.length-1:l,u="full"===t?a[s].size+a[o].size:"above"===t?a[s].size:a[o].size,c=n?"vertical"===r?Ct:10:0,f="vertical"===r?Mt*("full"===t?2:1):Zt*("full"===t?2:1);return Math.round(i-((0,k.u)(u)/2+c/2+f/2))}function Pt(e,t){var n,r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vertical",l=e.infos,s=l.find((function(e){return"size-ramp"===e.type})),u=l.find((function(e){return"color-ramp"===e.type}));return s&&((s=(0,a.Z)({},s)).infos=(0,o.Z)(s.infos),Tt(s,t,i,!0)),u&&((u=(0,a.Z)({},u)).infos=(0,o.Z)(u.infos)),"horizontal"===i&&(null!==(n=s)&&void 0!==n&&n.infos.reverse(),null!==(r=u)&&void 0!==r&&r.infos.reverse()),{sizeRampElement:s,colorRampElement:u}}function Bt(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",i=e.infos,l=i.find((function(e){return"size-ramp"===e.type})),s=i.find((function(e){return"color-ramp"===e.type}));return l&&((l=(0,a.Z)({},l)).infos=(0,o.Z)(l.infos),Tt(l,null,r,!1)),s&&((s=(0,a.Z)({},s)).infos=(0,o.Z)(s.infos)),"horizontal"===r&&(null!==(t=l)&&void 0!==t&&t.infos.reverse(),null!==(n=s)&&void 0!==n&&n.infos.reverse()),{sizeRampElement:l,colorRampElement:s}}function qt(e){e.appendChild(this)}function Ht(e,t,n){if(t){if("string"==typeof t||"number"==typeof t)return t;if("value"in t||"unit"in t)return(0,g.s)(e.dotValue,t);if("colorName"in t||"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:null;var r=null;return function(e,t){return t}(0,n)?r=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:jt(t,n)&&(r=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),r?(0,g.s)("showField"===r?"{field}":e[r],{field:t.field,normField:t.normField}):null}}function jt(e,t){return!t}function Ut(e,t){return!!(t&&"Stretched"===t&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)}var Wt,Gt,Jt="esri-legend--card__carousel-indicator--activated",Xt="esri-legend--card",Yt="esri-legend--stacked",Qt="esri-legend--card__carousel-title",$t="esri-legend--card__carousel-indicator",Kt="esri-legend--card__interval-separator",en="esri-legend--card__imagery-layer-image--stretched",tn="esri-legend--card__image-label",nn="esri-legend--card__layer-caption",rn="esri-legend--card__label-element",an="esri-legend--card__layer-row",ln="esri-legend--card__label-cell",sn="esri-legend--card__message",on="esri-legend--card__ramp-label",un="esri-legend--card__section",cn="esri-legend--card__service-caption-text",fn="esri-legend--card__service-content",dn="esri-legend--card__service",yn="esri-legend--card__group-layer",hn="esri-legend--card__group-layer-child",pn="esri-legend--card__symbol",vn="esri-legend--card__size-ramp-row",mn="esri-legend--card__symbol-row",gn="esri-legend--card__symbol-cell",bn="esri-legend--card__carousel-indicator-container",_n="esri-legend--card__interval-separators-container",wn="esri-legend--card__relationship-label-container",Ln="esri-legend--card__label-container",kn="esri-legend--card__service-caption-container",xn="esri-legend--card__symbol-container",Sn="esri-legend--card__size-ramp-container",In="esri-legend--card__size-ramp-preview",En="esri-legend--card__pie-chart-ramp-preview",Cn="esri-legend__size-ramp--horizontal",Mn="esri-legend__ramp-labels",Zn="esri-legend__layer-cell esri-legend__layer-cell--info",Vn="esri-univariate-above-and-below-ramp__color--card";(Gt=Wt||(Wt={})).Auto="auto",Gt.Stack="stack",Gt.SideBySide="side-by-side";var Rn=window.devicePixelRatio;var Fn=function(e){(0,f.Z)(n,e);var t=(0,d.Z)(n);function n(e,r){var i;return(0,u.Z)(this,n),(i=t.call(this,e,r))._handles=new h.X,i._hasIndicators=!1,i._selectedSectionName=null,i._sectionNames=[],i._sectionMap=new Map,i.activeLayerInfos=null,i.headingLevel=3,i.layout=Wt.Stack,i.messages=null,i.messagesCommon=null,i.type="card",i.view=null,i}return(0,c.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,v.l)((function(){return e.activeLayerInfos}),(function(t){e._handles.removeAll(),e._watchForSectionChanges(t)})))}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null}},{key:"render",value:function(){var e=this;this._hasIndicators=this.layout===Wt.Auto&&this.view.container.clientWidth<=768||this.layout===Wt.Stack;var t=this.activeLayerInfos,n=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));this._hasIndicators?this._selectedSectionName&&this._sectionNames.includes(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;var r=this._sectionNames.length,a=this._sectionNames.map((function(t,n){var a=(0,g.s)(e.messagesCommon.pagination.pageText,{index:n+1,total:r});return(0,m.n)("div",{key:t,role:"tab",id:t,"aria-label":a,"aria-controls":"".concat(t,"-panel"),"aria-selected":(e._selectedSectionName===t).toString(),tabIndex:e._selectedSectionName===t?0:-1,title:a,onclick:e._selectSection,onkeydown:e._focusSection,bind:e,class:e.classes($t,(0,i.Z)({},Jt,e._selectedSectionName===t)),"data-section-name":t})})),l=this._hasIndicators&&r>1?(0,m.n)("div",{class:bn,key:"carousel-navigation",role:"tablist"},a):null,s=this._hasIndicators?this._sectionMap.get(this._selectedSectionName):n&&n.length?n:null,o=(0,i.Z)({},Yt,this._hasIndicators);return(0,m.n)("div",{class:this.classes(Xt,o)},s||(0,m.n)("div",{class:sn},this.messages.noLegend),l)}},{key:"_selectSection",value:function(e){var t=e.target.getAttribute("data-section-name");t&&(this._selectedSectionName=t)}},{key:"_focusSection",value:function(e){switch(e.key){case"ArrowLeft":case"ArrowRight":this._switchSectionOnArrowPress(e);break;case"Enter":case" ":this._selectSection(e)}}},{key:"_switchSectionOnArrowPress",value:function(e){var t=e.key,n="ArrowLeft"===t?-1:1,r=e.target.getAttribute("data-section-name"),i=this._sectionNames.indexOf(r),a=this._sectionNames,l=null;-1!==i&&(a[i+n]?l=document.getElementById(a[i+n]):"ArrowLeft"===t?l=document.getElementById(a[a.length-1]):"ArrowRight"===t&&(l=document.getElementById(a[0])),l&&l.focus())}},{key:"_watchForSectionChanges",value:function(e){var t=this;if(this._generateSectionNames(),e){e.forEach((function(e){var n="activeLayerInfo-".concat(e.layer.uid,"-version-change");t._handles.remove(n),t._watchForSectionChanges(e.children),t._handles.add((0,v.l)((function(){return e.version}),(function(){return t._generateSectionNames()})),n)}));var n="activeLayerInfos-collection-change";this._handles.remove(n),this._handles.add(e.on("change",(function(){return t._watchForSectionChanges(e)})),n)}}},{key:"_generateSectionNames",value:function(){this._sectionNames.length=0,this._selectedSectionName=null,this.activeLayerInfos&&this.activeLayerInfos.forEach(this._generateSectionNamesForActiveLayerInfo,this)}},{key:"_getSectionName",value:function(e,t,n){return"".concat(this.id).concat(e.uid,"-type-").concat(t.type,"-").concat(n)}},{key:"_generateSectionNamesForActiveLayerInfo",value:function(e){var t=this;e.children.forEach(this._generateSectionNamesForActiveLayerInfo,this),e.legendElements&&e.legendElements.forEach((function(n,r){t._sectionNames.push(t._getSectionName(e.layer,n,r))}))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;if(e.children.length){var n=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return(0,m.n)("div",{key:e.layer.uid,class:this.classes(dn,yn)},(0,m.n)("div",{class:kn},e.title),n)}var r=e.legendElements;if(r&&!r.length)return null;var a=r.some((function(e){return"relationship-ramp"===e.type})),l=r.map((function(n,r){return t._renderLegendForElement(n,e,r,a)})).filter((function(e){return!!e}));if(!l.length)return null;var s=(0,i.Z)({},hn,!!e.parent);return(0,m.n)("div",{key:e.layer.uid,class:this.classes(dn,s)},(0,m.n)("div",{class:kn},(0,m.n)("div",{class:cn},e.title)),(0,m.n)("div",{class:fn},l))}},{key:"_renderLegendForElement",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s="color-ramp"===e.type,o="opacity-ramp"===e.type,u="size-ramp"===e.type,c=t.layer,f=null;if("string"==typeof e.title)f=e.title;else if(e.title){var d=e.title,y=Ht(this.messages,d,s||o);f=d.title?"".concat(d.title," (").concat(y,")"):y}var h=this._getSectionName(c,e,n),p=this._hasIndicators&&!l?(0,m.n)("div",null,(0,m.n)(F.n,{level:this.headingLevel,class:Qt},t.title),(0,m.n)(F.n,{level:(0,F.p)(this.headingLevel),class:nn},f)):f?(0,m.n)(F.n,{level:this.headingLevel,class:nn},f):null,v=t.effectList,g=null;if("symbol-table"===e.type){var b=e.infos.map((function(n,i){return r._renderLegendForElementInfo(n,t,e.legendType,i)})).filter((function(e){return!!e}));if(b.length){var _,w=b[0].properties.classes&&b[0].properties.classes[mn],L=(_={},(0,i.Z)(_,Ln,!w&&!a),(0,i.Z)(_,wn,a),_);g=(0,m.n)("div",{class:this.classes(L)},b)}}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type?g=this._renderLegendForRamp(e,c.opacity,v):u?g=this._renderSizeRamp(e,c.opacity):"pie-chart-ramp"===e.type?g=this._renderPieChartRamp(e):"relationship-ramp"===e.type?g=St(e,this.id,c.opacity,v):"univariate-above-and-below-ramp"===e.type?g=this._renderUnivariateAboveAndBelowRamp(e,c.opacity,v):"univariate-color-size-ramp"===e.type&&(g=this._renderUnivariateColorSizeRamp(e,c.opacity,v));if(!g)return null;var k=(0,m.n)("div",{key:h,class:un,id:"".concat(h,"-panel"),role:"tabpanel","aria-labelledby":h,tabIndex:0},[p,g]);return l||this._sectionMap.set(h,k),k}},{key:"_renderPieChartRamp",value:function(e){return(0,m.n)("div",{class:En,bind:e.preview,afterCreate:qt})}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t,n){var r=Pt(e,t,"horizontal"),i=r.sizeRampElement,a=r.colorRampElement;if(!i)return null;var l=Nt(i,"full",!0,"horizontal"),s=Ot(i,"above",!0,"horizontal"),o=Ot(i,"below",!0,"horizontal"),u=Dt(a,{width:s,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:n}),c=Dt(a,{width:o,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:n}),f=At(i,"card"),d=i.infos.map((function(e){return e.label})),y=d.length-1,h=d.map((function(e,t){return 0===t||t===y?(0,m.n)("div",{key:t},e):null})),p={marginTop:"3px",display:"flex"};(0,m.f)(this.container)?p.marginRight="".concat(f,"px"):p.marginLeft="".concat(f,"px");var v={width:"".concat(l,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,m.n)("div",{class:an,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,m.n)("div",{class:this.classes(xn,Cn),styles:{display:"flex",flexDirection:"row"}},i.infos.map((function(e,t){return(0,m.n)("div",{key:t,class:pn,bind:e.preview,afterCreate:qt})}))),u?(0,m.n)("div",{class:Vn,styles:p,key:"color-ramp-preview"},(0,m.n)("div",{bind:u,afterCreate:qt}),(0,m.n)("div",{bind:c,afterCreate:qt})):null,(0,m.n)("div",{class:Zn},(0,m.n)("div",{class:Mn,styles:v},h)))}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t,n){var r=Bt(e,"horizontal"),i=r.sizeRampElement,a=r.colorRampElement;if(!i)return null;var l=Nt(i,"full",!1,"horizontal"),s=Dt(a,{width:Ot(i,"full",!1,"horizontal"),height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:n}),o=At(i,"card"),u=i.infos.length-1,c=i.infos.map((function(e,t){return 0===t||t===u?(0,m.n)("div",{key:t},e.label):null})),f={marginTop:"3px",display:"flex"};(0,m.f)(this.container)?f.marginRight="".concat(o,"px"):f.marginLeft="".concat(o,"px");var d={width:"".concat(l,"px"),display:"flex",flexDirection:"row",justifyContent:"space-between"};return(0,m.n)("div",{class:an,key:"size-ramp-preview",styles:{display:"flex",flexDirection:"column"}},(0,m.n)("div",{class:this.classes(xn,Cn),styles:{display:"flex",flexDirection:"row"}},i.infos.map((function(e,t){return(0,m.n)("div",{key:t,class:pn,bind:e.preview,afterCreate:qt})}))),(0,m.n)("div",{class:Vn,styles:f,key:"color-ramp-preview"},(0,m.n)("div",{bind:s,afterCreate:qt})),(0,m.n)("div",{class:Zn},(0,m.n)("div",{class:Mn,styles:d},c)))}},{key:"_renderLegendForElementInfo",value:function(e,t,n,r){var a=t.layer;if(e.type)return this._renderLegendForElement(e,t,r,!1,!0);var l=Ut(a,n);if(e.preview){var s,o;if(!e.symbol||!e.symbol.type.includes("simple-fill")){if(!e.label)return(0,m.n)("div",{key:r,bind:e.preview,afterCreate:qt});var u=(0,i.Z)({},gn,this._hasIndicators);return(0,m.n)("div",{key:r,class:this.classes(an,(0,i.Z)({},mn,this._hasIndicators))},(0,m.n)("div",{class:this.classes(u),bind:e.preview,afterCreate:qt}),(0,m.n)("div",{class:this.classes(tn,(0,i.Z)({},ln,this._hasIndicators))},Ht(this.messages,e.label,!1)||""))}var c=255,f=255,d=255,y=0,h=255,p=255,v=255,g=0,b=e.symbol.color&&e.symbol.color.a,_=e.symbol.outline&&e.symbol.outline.color&&e.symbol.outline.color.a;b&&(c=e.symbol.color.r,f=e.symbol.color.g,d=e.symbol.color.b,y=e.symbol.color.a*a.opacity),_&&(h=e.symbol.outline.color.r,p=e.symbol.outline.color.g,v=e.symbol.outline.color.b,g=e.symbol.outline.color.a*a.opacity);var w=null===(s=null===(o=e.symbol.color)||void 0===o?void 0:o.isBright)||void 0===s||s,L=w?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)",k={background:b?"rgba(".concat(c,", ").concat(f,", ").concat(d,", ").concat(y,")"):"none",color:w?"black":"white",textShadow:"-1px -1px 0 ".concat(L,",\n                                              1px -1px 0 ").concat(L,",\n                                              -1px 1px 0 ").concat(L,",\n                                              1px 1px 0 ").concat(L),border:_?"1px solid rgba(".concat(h,", ").concat(p,", ").concat(v,", ").concat(g,")"):"none",filter:(0,V.q)(t.effectList)};return(0,m.n)("div",{key:r,class:an},(0,m.n)("div",{class:rn,styles:k}," ",e.label," "))}if(e.src){var x=this._renderImage(e,a,l);return(0,m.n)("div",{key:r,class:an},x,(0,m.n)("div",{class:tn},e.label||""))}}},{key:"_renderImage",value:function(e,t,n){var r,a=e.label,l=e.src,s=e.opacity,o=(r={},(0,i.Z)(r,en,n),(0,i.Z)(r,pn,!n),r),u={opacity:"".concat(null!=s?s:t.opacity)};return(0,m.n)("img",{alt:Ht(this.messages,a,!1),src:l,border:0,width:e.width,height:e.height,class:this.classes(o),styles:u})}},{key:"_renderSizeRampLines",value:function(e){var t=e.infos,n=t[0],r=t[t.length-1],i=n.symbol,a=this._hasIndicators,l=(0,k.u)(n.size+n.outlineSize)*Rn,s=(0,k.u)(r.size+r.outlineSize)*Rn,o=a?l:l+50*Rn,u=a?l/2+50*Rn:l,c=function(e){if(e){if(e.type.includes("3d")){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var n=e.symbolLayers.getItemAt(t-1).get("resource.primitive");return"triangle"===n||"cone"===n||"tetrahedron"===n}return"triangle"===e.style}}(i),f=function(e){if(e){if(e.type.includes("3d")){var t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;var n=e.symbolLayers.getItemAt(t-1),r=n.resource&&n.resource.primitive;return"circle"===r||"cross"===r||"kite"===r||"sphere"===r||"cube"===r||"diamond"===r}var i=e.style;return"circle"===i||"diamond"===i||"cross"===i}}(i),d=document.createElement("canvas");d.width=o,d.height=u,d.style.width=d.width/Rn+"px",d.style.height=d.height/Rn+"px";var y=d.getContext("2d");if(a){y.beginPath();var h=o/2-s/2,p=u;y.moveTo(0,0),y.lineTo(h,p);var v=o,g=o/2+s/2,b=u;y.moveTo(v,0),y.lineTo(g,b)}else{y.beginPath();var _=u/2-s/2,w=o;y.moveTo(0,_),y.lineTo(w,0);var L=u/2+s/2,x=o,S=u;y.moveTo(0,L),y.lineTo(x,S)}return y.strokeStyle="#ddd",y.stroke(),(0,m.n)("div",{bind:d,afterCreate:qt,styles:a?{display:"flex",marginTop:"-".concat(c?0:f?l/2:0,"px"),marginBottom:"-".concat(c?s:f?s/2:0,"px")}:{display:"flex",marginRight:"-".concat(c?0:f?l/2:0,"px"),marginLeft:"-".concat(c?0:f?s/2:0,"px")}})}},{key:"_renderSizeRamp",value:function(e,t){var n=e.infos,r=n[0].label,a=n[n.length-1].label,l=n[0].preview,s=n[n.length-1].preview,o=this._hasIndicators,u={"flex-direction":o?"column":"row-reverse"};l&&((l=l.cloneNode(!0)).style.display="flex"),s&&((s=s.cloneNode(!0)).style.display="flex");var c={opacity:null!=t?"".concat(t):""};return(0,m.n)("div",{class:this.classes(an,(0,i.Z)({},vn,o))},(0,m.n)("div",{class:on},o?r:a),(0,m.n)("div",{class:Sn,styles:u},(0,m.n)("div",{bind:l,afterCreate:qt,class:In,styles:c}),this._renderSizeRampLines(e),(0,m.n)("div",{bind:s,afterCreate:qt,class:Sn,styles:c})),(0,m.n)("div",{class:on},o?a:r))}},{key:"_renderLegendForRamp",value:function(e,t,n){var r=e.infos,i="heatmap-ramp"===e.type,a=r.length-1,l=25,s=a>2&&!i?25*a:100,o=s+20,u=10,c=r.slice(0).reverse();c.forEach((function(e,t){e.offset=i?e.ratio:t/a}));var f=c.length-1,d=c.length%2!=0&&c[c.length/2|0],y=d&&(0,m.n)("div",{class:_n},(0,m.n)("div",{class:Kt},"|"),(0,m.n)("div",{class:on},d.label)),h=r[r.length-1].label,p=r[0].label,v=[[{shape:{type:"path",path:"M0 ".concat(l/2," L").concat(u," 0 L").concat(u," ").concat(l," Z")},fill:c[0].color,stroke:{width:0}},{shape:{type:"rect",x:u,y:0,width:s,height:l},fill:{type:"linear",x1:u,y1:0,x2:s+u,y2:0,colors:c},stroke:{width:0}},{shape:{type:"path",path:"M".concat(s+u," 0 L").concat(o," ").concat(l/2," L").concat(s+u," ").concat(l," Z")},fill:c[f].color,stroke:{width:0}}]],g=(0,R.R)(v,o,l),b=this.messages,_={filter:(0,V.q)(n),opacity:null==t?null:"".concat(t)};return(0,m.n)("div",{class:an,styles:{justifyContent:"center"}},(0,m.n)("div",{class:on},i?b[h]:h),(0,m.n)("div",{class:xn},(0,m.n)("div",{styles:_},g),y),(0,m.n)("div",{class:on},i?b[p]:p))}}]),n}(m.M);(0,h.e)([(0,h.y)()],Fn.prototype,"activeLayerInfos",void 0),(0,h.e)([(0,h.y)()],Fn.prototype,"headingLevel",void 0),(0,h.e)([(0,h.y)()],Fn.prototype,"layout",void 0),(0,h.e)([(0,h.y)(),(0,m.e)("esri/widgets/Legend/t9n/Legend")],Fn.prototype,"messages",void 0),(0,h.e)([(0,h.y)(),(0,m.e)("esri/t9n/common")],Fn.prototype,"messagesCommon",void 0),(0,h.e)([(0,h.y)({readOnly:!0})],Fn.prototype,"type",void 0),(0,h.e)([(0,h.y)()],Fn.prototype,"view",void 0),(0,h.e)([(0,D.t)()],Fn.prototype,"_selectSection",null);var zn=Fn=(0,h.e)([(0,h.n)("esri.widgets.Legend.styles.Card")],Fn),Tn="esri-legend__service",An="esri-legend__service-label",Dn="esri-legend__layer",Nn="esri-legend__group-layer",On="esri-legend__group-layer-child",Pn="esri-legend__layer-table",Bn="esri-legend__layer-table--size-ramp",qn="esri-legend__layer-child-table",Hn="esri-legend__layer-caption",jn="esri-legend__layer-body",Un="esri-legend__layer-row",Wn="esri-legend__layer-cell esri-legend__layer-cell--info",Gn="esri-legend__imagery-layer-image--stretched",Jn="esri-legend__imagery-layer-info--stretched",Xn="esri-legend__layer-cell esri-legend__layer-cell--symbols",Yn="esri-legend__symbol",Qn="esri-legend__ramps",$n="esri-legend__size-ramp",Kn="esri-legend__color-ramp",er="esri-legend__opacity-ramp",tr="esri-legend__ramp-labels",nr="esri-legend__ramp-label",rr="esri-univariate-above-and-below-ramp__label",ir="esri-legend__message",ar="esri-widget__heading",lr={display:"flex",alignItems:"flex-start"},sr={marginLeft:"3px"},or={display:"table-cell",verticalAlign:"middle"},ur=function(e){(0,f.Z)(n,e);var t=(0,d.Z)(n);function n(e,r){var i;return(0,u.Z)(this,n),(i=t.call(this,e,r)).activeLayerInfos=null,i.headingLevel=3,i.messages=null,i.type="classic",i}return(0,c.Z)(n,[{key:"render",value:function(){var e=this,t=this.activeLayerInfos,n=t&&t.toArray().map((function(t){return e._renderLegendForLayer(t)})).filter((function(e){return!!e}));return(0,m.n)("div",null,n&&n.length?n:(0,m.n)("div",{class:ir},this.messages.noLegend))}},{key:"_renderLegendForLayer",value:function(e){var t=this;if(!e.ready)return null;var n=!!e.children.length,r="".concat("esri-legend__").concat(e.layer.uid,"-version-").concat(e.version),a=e.title?(0,F.n)({level:this.headingLevel,class:this.classes(ar,An)},e.title):null;if(n){var l=e.children.map((function(e){return t._renderLegendForLayer(e)})).toArray();return(0,m.n)("div",{key:r,class:this.classes(Tn,Nn)},a,l)}var s=e.legendElements;if(s&&!s.length)return null;var o=s.map((function(n){return t._renderLegendForElement(n,e.layer,e.effectList)})).filter((function(e){return!!e}));if(!o.length)return null;var u=(0,i.Z)({},On,!!e.parent);return(0,m.n)("div",{key:r,class:this.classes(Tn,u),tabIndex:0},a,(0,m.n)("div",{class:Dn},o))}},{key:"_renderLegendForElement",value:function(e,t,n,r){var a=this,l="color-ramp"===e.type,s="opacity-ramp"===e.type,o="size-ramp"===e.type,u=null;if("symbol-table"===e.type||o){var c=e.infos.map((function(r){return a._renderLegendForElementInfo(r,t,n,o,e.legendType)})).filter((function(e){return!!e}));c.length&&(u=(0,m.n)("div",{class:jn},c))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?u=this._renderLegendForRamp(e,t.opacity):"relationship-ramp"===e.type?u=St(e,this.id,t.opacity,n):"pie-chart-ramp"===e.type?u=this._renderPieChartRamp(e):"univariate-above-and-below-ramp"===e.type?u=this._renderUnivariateAboveAndBelowRamp(e,t.opacity,n):"univariate-color-size-ramp"===e.type&&(u=this._renderUnivariateColorSizeRamp(e,t.opacity,n));if(!u)return null;var f=e.title,d=null;if("string"==typeof f)d=f;else if(f){var y=Ht(this.messages,f,l||s);d=jt(0,l||s)&&f.title?"".concat(f.title," (").concat(y,")"):y}var h=r?qn:Pn,p=d?(0,m.n)("div",{class:Hn},d):null,v=(0,i.Z)({},Bn,o||!r);return(0,m.n)("div",{class:this.classes(h,v)},p,u)}},{key:"_renderPieChartRamp",value:function(e){return(0,m.n)("div",{bind:e.preview,afterCreate:qt})}},{key:"_renderUnivariateAboveAndBelowRamp",value:function(e,t,n){var r=this,i=Pt(e,t),a=i.sizeRampElement,l=i.colorRampElement;if(!a)return null;var s=Ot(a,"above",!0),o=Ot(a,"below",!0),u=Dt(l,{width:12,height:s,rampAlignment:"vertical",opacity:t,type:"above",effectList:n}),c=Dt(l,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"below",effectList:n}),f=At(a),d=a.infos.map((function(e){return e.label})),y=d.map((function(e,t){var n=2===t;return 0===t?(0,m.n)("div",{key:t,class:e?u?rr:nr:null},e):n?(0,m.n)("div",null):null})),h=d.length-1,p=Math.floor(d.length/2),v=d.map((function(e,t){return t===p||t===h?(0,m.n)("div",{key:t,class:e?u?rr:nr:null},e):null})),g={display:"table-cell",verticalAlign:"middle"},b={marginTop:"".concat(f,"px")},_={height:"".concat(s,"px")},w={height:"".concat(o,"px")};return(0,m.n)("div",{key:"univariate-above-and-below-ramp-preview",styles:lr},(0,m.n)("div",{class:jn},a.infos.map((function(e,t){return(0,m.n)("div",{class:r.classes(Un,$n)},(0,m.n)("div",{class:Yn,styles:g,bind:e.preview,afterCreate:qt}),u||t%2!=0?null:(0,m.n)("div",{class:Wn},d[t]))}))),u?(0,m.n)("div",{styles:b,key:"color-ramp-preview"},(0,m.n)("div",{styles:sr},(0,m.n)("div",{styles:or},(0,m.n)("div",{class:Qn,bind:u,afterCreate:qt})),(0,m.n)("div",{styles:or},(0,m.n)("div",{class:tr,styles:_},y))),(0,m.n)("div",{styles:sr},(0,m.n)("div",{styles:or},(0,m.n)("div",{class:Qn,bind:c,afterCreate:qt})),(0,m.n)("div",{styles:or},(0,m.n)("div",{class:tr,styles:w},v)))):null)}},{key:"_renderUnivariateColorSizeRamp",value:function(e,t,n){var r=this,i=Bt(e),a=i.sizeRampElement,l=i.colorRampElement;if(!a)return null;var s=At(a),o=Ot(a,"full",!1),u=Dt(l,{width:12,height:o,rampAlignment:"vertical",opacity:t,type:"full",effectList:n}),c=a.infos.length-1,f=a.infos.map((function(e,t){return 0===t||t===c?(0,m.n)("div",{key:t,class:e.label?l?rr:nr:null},e.label):null})),d={display:"table-cell",verticalAlign:"middle"},y={marginTop:"".concat(s,"px")},h={height:"".concat(o,"px")};return(0,m.n)("div",{key:"univariate-above-and-below-ramp-preview",styles:lr},(0,m.n)("div",{class:jn},a.infos.map((function(e){return(0,m.n)("div",{class:r.classes(Un,$n)},(0,m.n)("div",{class:Yn,styles:d,bind:e.preview,afterCreate:qt}))}))),(0,m.n)("div",{styles:y,key:"color-ramp-preview"},(0,m.n)("div",{styles:sr},(0,m.n)("div",{styles:or},(0,m.n)("div",{class:Qn,bind:u,afterCreate:qt})),(0,m.n)("div",{styles:or},(0,m.n)("div",{class:tr,styles:h},f)))))}},{key:"_renderLegendForRamp",value:function(e,t){var n=this,r=e.infos,i="opacity-ramp"===e.type,a="heatmap-ramp"===e.type,l="stretch-ramp"===e.type,s=e.preview,o=i?er:"";s.className="".concat(Kn," ").concat(o),null!=t&&(s.style.opacity=t.toString());var u=r.map((function(e){return(0,m.n)("div",{class:e.label?nr:null},a?n.messages[e.label]||e.label:l?n._getStretchStopLabel(e):e.label)})),c={width:"".concat(24,"px")},f={height:s.style.height};return(0,m.n)("div",{class:Un},(0,m.n)("div",{class:Xn,styles:c},(0,m.n)("div",{class:Qn,bind:s,afterCreate:qt})),(0,m.n)("div",{class:Wn},(0,m.n)("div",{class:tr,styles:f},u)))}},{key:"_getStretchStopLabel",value:function(e){return e.label?this.messages[e.label]+": "+("string"==typeof e.value?e.value:(0,T.m)(e.value,{style:"decimal",notation:e.value.toString().includes("e")?"scientific":"standard"})):""}},{key:"_renderLegendForElementInfo",value:function(e,t,n,r,a){var l;if(e.type)return this._renderLegendForElement(e,t,n,!0);var s=null,o=Ut(t,a);if(e.preview?s=(0,m.n)("div",{class:Yn,bind:e.preview,afterCreate:qt}):e.src&&(s=this._renderImage(e,t,o)),!s)return null;var u=(0,i.Z)({},Jn,o),c=(l={},(0,i.Z)(l,Jn,o),(0,i.Z)(l,$n,!o&&r),l);return(0,m.n)("div",{class:Un},(0,m.n)("div",{class:this.classes(Xn,c)},s),(0,m.n)("div",{class:this.classes(Wn,u)},Ht(this.messages,e.label,!1)||""))}},{key:"_renderImage",value:function(e,t,n){var r,a=e.label,l=e.src,s=e.opacity,o=(r={},(0,i.Z)(r,Gn,n),(0,i.Z)(r,Yn,!n),r),u={opacity:"".concat(null!=s?s:t.opacity)};return(0,m.n)("img",{alt:Ht(this.messages,a,!1),src:l,border:0,width:e.width,height:e.height,class:this.classes(o),styles:u})}}]),n}(m.M);(0,h.e)([(0,h.y)()],ur.prototype,"activeLayerInfos",void 0),(0,h.e)([(0,h.y)()],ur.prototype,"headingLevel",void 0),(0,h.e)([(0,h.y)(),(0,m.e)("esri/widgets/Legend/t9n/Legend")],ur.prototype,"messages",void 0),(0,h.e)([(0,h.y)({readOnly:!0})],ur.prototype,"type",void 0);var cr=ur=(0,h.e)([(0,h.n)("esri.widgets.Legend.styles.Classic")],ur),fr="esri-legend",dr="esri-widget",yr="esri-widget--panel",hr="esri-icon-layer-list",pr=function(e){(0,f.Z)(n,e);var t=(0,d.Z)(n);function n(e,r){var i;return(0,u.Z)(this,n),(i=t.call(this,e,r))._handles=new h.X,i.headingLevel=3,i.iconClass=hr,i.messages=null,i.style=new cr,i.viewModel=new ut,i}return(0,c.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles([(0,v.a)((function(){return e.view}),"resize",(function(){return e.scheduleRender()})),(0,v.a)((function(){return e.activeLayerInfos}),"change",(function(){return e._refreshActiveLayerInfos(e.activeLayerInfos)})),(0,v.l)((function(){return e.headingLevel}),(function(t){var n=e.style;n&&(n.headingLevel=t)})),(0,v.l)((function(){return e.style}),(function(t,n){n&&t!==n&&n.destroy(),t&&(t.activeLayerInfos=e.activeLayerInfos,"card"===t.type&&(t.view=e.view),t.headingLevel=e.headingLevel)}),v.h)])}},{key:"destroy",value:function(){this._handles=(0,p.g)(this._handles)}},{key:"activeLayerInfos",get:function(){return this.viewModel.activeLayerInfos},set:function(e){this.viewModel.activeLayerInfos=e}},{key:"basemapLegendVisible",get:function(){return this.viewModel.basemapLegendVisible},set:function(e){this.viewModel.basemapLegendVisible=e}},{key:"groundLegendVisible",get:function(){return this.viewModel.groundLegendVisible},set:function(e){this.viewModel.groundLegendVisible=e}},{key:"hideLayersNotInCurrentView",get:function(){return this.viewModel.hideLayersNotInCurrentView},set:function(e){this.viewModel.hideLayersNotInCurrentView=e}},{key:"keepCacheOnDestroy",get:function(){return this.viewModel.keepCacheOnDestroy},set:function(e){this.viewModel.keepCacheOnDestroy=e}},{key:"respectLayerVisibility",get:function(){return this.viewModel.respectLayerVisibility},set:function(e){this.viewModel.respectLayerVisibility=e}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"layerInfos",get:function(){return this.viewModel.layerInfos},set:function(e){this.viewModel.layerInfos=e}},{key:"castStyle",value:function(e){if(e instanceof zn||e instanceof cr)return e;if("string"==typeof e)return"card"===e?new zn:new cr;if(e&&"string"==typeof e.type){var t=(0,a.Z)({},e);return delete t.type,new("card"===e.type?zn:cr)(t)}return new cr}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"render",value:function(){return(0,m.n)("div",{class:this.classes(fr,dr,this.style instanceof cr?yr:null)},this.style.render())}},{key:"_refreshActiveLayerInfos",value:function(e){var t=this;this._handles.removeAll(),e.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)})),this.scheduleRender()}},{key:"_renderOnActiveLayerInfoChange",value:function(e){var t=this,n=(0,v.l)((function(){return e.version}),(function(){return t.scheduleRender()}));this._handles.add(n,"version_".concat(e.layer.uid));var r=(0,v.a)((function(){return e.children}),"change",(function(){return e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}),v.h);this._handles.add(r,"children_".concat(e.layer.uid)),e.children.forEach((function(e){return t._renderOnActiveLayerInfoChange(e)}))}}]),n}(m.M);(0,h.e)([(0,h.y)()],pr.prototype,"activeLayerInfos",null),(0,h.e)([(0,h.y)()],pr.prototype,"basemapLegendVisible",null),(0,h.e)([(0,h.y)()],pr.prototype,"groundLegendVisible",null),(0,h.e)([(0,h.y)()],pr.prototype,"headingLevel",void 0),(0,h.e)([(0,h.y)()],pr.prototype,"hideLayersNotInCurrentView",null),(0,h.e)([(0,h.y)()],pr.prototype,"keepCacheOnDestroy",null),(0,h.e)([(0,h.y)()],pr.prototype,"respectLayerVisibility",null),(0,h.e)([(0,h.y)()],pr.prototype,"iconClass",void 0),(0,h.e)([(0,h.y)()],pr.prototype,"label",null),(0,h.e)([(0,h.y)()],pr.prototype,"layerInfos",null),(0,h.e)([(0,h.y)(),(0,m.e)("esri/widgets/Legend/t9n/Legend")],pr.prototype,"messages",void 0),(0,h.e)([(0,h.y)()],pr.prototype,"style",void 0),(0,h.e)([(0,h.c)("style")],pr.prototype,"castStyle",null),(0,h.e)([(0,h.y)()],pr.prototype,"view",null),(0,h.e)([(0,h.y)()],pr.prototype,"viewModel",void 0);var vr=pr=(0,h.e)([(0,h.n)("esri.widgets.Legend")],pr);t.default=vr},59389:function(e,t,n){n.d(t,{b:function(){return v},c:function(){return f},d:function(){return g},h:function(){return d},j:function(){return w},v:function(){return _}});var r=n(74165),i=n(15671),a=n(43144),l=n(60136),s=n(29388),o=n(15861),u=n(48848),c=n(93661);function f(e,t,n){return(0,u.E)(e.map((function(e,r){return t.apply(n,[e,r])})))}function d(e,t,n){return y.apply(this,arguments)}function y(){return(y=(0,o.Z)((0,r.Z)().mark((function e(t,n,i){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.E)(t.map((function(e,t){return n.apply(i,[e,t])})));case 2:return e.abrupt("return",e.sent.map((function(e){return e.value})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return{ok:!0,value:e}}function p(e){return{ok:!1,error:e}}function v(e){return m.apply(this,arguments)}function m(){return(m=(0,o.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,c.t)(t)){e.next=2;break}return e.abrupt("return",{ok:!1,error:new Error("no promise provided")});case 2:return e.prev=2,e.t0=h,e.next=6,t;case 6:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 10:return e.prev=10,e.t2=e.catch(2),e.abrupt("return",p(e.t2));case 13:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function g(e){return b.apply(this,arguments)}function b(){return(b=(0,o.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=h,e.next=4,t;case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 8:return e.prev=8,e.t2=e.catch(0),e.abrupt("return",((0,u.w)(e.t2),p(e.t2)));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function _(e){if(!0===e.ok)return e.value;throw e.error}function w(e,t){return new L(e,t)}var L=function(e){(0,l.Z)(n,e);var t=(0,s.Z)(n);function n(e,r){var a;(0,i.Z)(this,n),(a=t.call(this,{}))._result=null,a._abortHandle=null,a.abort=function(){a._abortController=(0,c.l)(a._abortController)},a.remove=a.abort,a._abortController=new AbortController;var l=a._abortController.signal;return a.promise=e(l),a.promise.then((function(e){a._result=h(e),a._cleanup()}),(function(e){a._result=p(e),a._cleanup()})),a._abortHandle=(0,u.v)(r,a.abort),a}return(0,a.Z)(n,[{key:"value",get:function(){return e=this._result,(0,c.r)(e)&&!0===e.ok?e.value:null;var e}},{key:"error",get:function(){return e=this._result,(0,c.r)(e)&&!1===e.ok?e.error:null;var e}},{key:"finished",get:function(){return(0,c.r)(this._result)}},{key:"normalizeCtorArgs",value:function(){return{}}},{key:"destroy",value:function(){this.abort()}},{key:"_cleanup",value:function(){this._abortHandle=(0,c.f)(this._abortHandle),this._abortController=null}}]),n}(u.m);(0,u.e)([(0,u.y)()],L.prototype,"value",null),(0,u.e)([(0,u.y)()],L.prototype,"error",null),(0,u.e)([(0,u.y)()],L.prototype,"finished",null),(0,u.e)([(0,u.y)()],L.prototype,"promise",void 0),(0,u.e)([(0,u.y)()],L.prototype,"_result",void 0),L=(0,u.e)([(0,u.n)("esri.core.asyncUtils.ReactiveTask")],L)},12953:function(e,t,n){n.d(t,{D:function(){return S},I:function(){return x},b:function(){return w},c:function(){return p},d:function(){return v},f:function(){return h},g:function(){return _},j:function(){return L},l:function(){return f},m:function(){return y},p:function(){return d},u:function(){return b},v:function(){return k},w:function(){return g},y:function(){return m}});var r=n(1413),i=n(89181),a=n(46817),l=n(82474),s=n(46337),o=n(93661),u=(n(48848),n(15529)),c=n(85253);var f={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},d={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:function(e,t){return!t.disablePopup}},write:{enabled:!0,writer:function(e,t,n){t[n]=!e}}}},y={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},h={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:s.f}}},p={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},v={value:null,type:u.x,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function m(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}var g={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},b=(0,r.Z)((0,r.Z)({},g),{},{json:(0,r.Z)((0,r.Z)({},g.json),{},{origins:{"web-document":(0,r.Z)((0,r.Z)({},g.json.origins["web-document"]),{},{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:function(e,t,n){return n&&"service"!==n.origin||!t.drawingInfo||void 0===t.drawingInfo.transparency?t.layerDefinition&&t.layerDefinition.drawingInfo&&void 0!==t.layerDefinition.drawingInfo.transparency?(0,c.r)(t.layerDefinition.drawingInfo.transparency):void 0:(0,c.r)(t.drawingInfo.transparency)}}})}),_={type:i.T,readOnly:!0,get:function(){var e,t;if(null===(e=this.layer)||void 0===e||!e.timeInfo)return null;var n=this.layer,r=n.datesInUnknownTimezone,a=n.timeOffset,l=n.useViewTime,s=null===(t=this.view)||void 0===t?void 0:t.timeExtent,u=this.layer.timeExtent;r&&(u=function(e){if(!e)return e;var t=e.start,n=e.end;return new i.T({start:(0,o.r)(t)?(0,i.n)(t,t.getTimezoneOffset(),"minutes"):t,end:(0,o.r)(n)?(0,i.n)(n,n.getTimezoneOffset(),"minutes"):n})}(u));var c=l?s&&u?s.intersection(u):s||u:u;if(!c||c.isEmpty||c.isAllTime)return c;a&&(c=c.offset(-a.value,a.unit)),r&&(c=function(e){if(!e)return e;var t=e.start,n=e.end;return new i.T({start:(0,o.r)(t)?(0,i.n)(t,-t.getTimezoneOffset(),"minutes"):t,end:(0,o.r)(n)?(0,i.n)(n,-n.getTimezoneOffset(),"minutes"):n})}(c));var f=this._get("timeExtent");return c.equals(f)?f:c}},w={type:a.w,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:function(e,t){var n=a.w.fromJSON(e);return null!=t.spatialReference&&"object"==typeof t.spatialReference&&(n.spatialReference=l.k.fromJSON(t.spatialReference)),n}}}},read:!1}},L={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},k={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},x={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},S={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}}},17562:function(e,t,n){function r(e){var t,n=e.layer;return"floorInfo"in n&&null!==(t=n.floorInfo)&&void 0!==t&&t.floorField&&"floors"in e.view?a(e.view.floors,n.floorInfo.floorField):null}function i(e,t){var n;return"floorInfo"in t&&null!==(n=t.floorInfo)&&void 0!==n&&n.floorField?a(e,t.floorInfo.floorField):null}function a(e,t){if(null===e||void 0===e||!e.length)return null;var n=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return n.push("''"),"".concat(t," IN (").concat(n.join(","),") OR ").concat(t," IS NULL")}n.d(t,{n:function(){return i},o:function(){return r}})},71802:function(e,t,n){function r(){return[0,0,0]}function i(e){return[e[0],e[1],e[2]]}function a(e,t,n){return[e,t,n]}function l(e){for(var t=[0,0,0],n=Math.min(3,e.length),r=0;r<n;++r)t[r]=e[r];return t}function s(e,t){return new Float64Array(e,t,3)}function o(){return[0,0,0]}function u(){return a(1,1,1)}function c(){return a(1,0,0)}function f(){return a(0,1,0)}function d(){return a(0,0,1)}n.d(t,{$:function(){return $e},A:function(){return U},B:function(){return ue},C:function(){return ce},D:function(){return fe},E:function(){return J},F:function(){return $},G:function(){return pe},H:function(){return ee},I:function(){return we},J:function(){return ge},K:function(){return be},L:function(){return Ke},M:function(){return _e},N:function(){return Ue},O:function(){return W},P:function(){return H},Q:function(){return xe},R:function(){return Se},S:function(){return G},T:function(){return We},U:function(){return ie},V:function(){return Xe},W:function(){return Ye},X:function(){return nt},Y:function(){return le},Z:function(){return Pe},_:function(){return j},a:function(){return Ae},a0:function(){return te},a1:function(){return R},a2:function(){return K},a3:function(){return ae},a4:function(){return me},a5:function(){return se},a6:function(){return l},a7:function(){return y},a8:function(){return Te},a9:function(){return Z},aa:function(){return He},ab:function(){return D},ac:function(){return d},ad:function(){return De},ae:function(){return oe},af:function(){return Fe},ag:function(){return V},ah:function(){return X},ai:function(){return F},aj:function(){return T},ak:function(){return z},al:function(){return Ne},am:function(){return Oe},an:function(){return et},ao:function(){return x},ap:function(){return tt},b:function(){return qe},c:function(){return a},d:function(){return b},e:function(){return M},f:function(){return k},g:function(){return A},h:function(){return _},i:function(){return je},j:function(){return Le},k:function(){return m},l:function(){return h},m:function(){return Be},n:function(){return r},o:function(){return E},p:function(){return O},q:function(){return B},r:function(){return I},s:function(){return S},t:function(){return i},u:function(){return C},v:function(){return P},w:function(){return ke},x:function(){return N},y:function(){return s},z:function(){return q}});var y=[0,0,0],h=u(),p=c(),v=f(),m=d();Object.freeze(Object.defineProperty({__proto__:null,create:r,clone:i,fromValues:a,fromArray:l,createView:s,zeros:o,ones:u,unitX:c,unitY:f,unitZ:d,ZEROS:y,ONES:h,UNIT_X:p,UNIT_Y:v,UNIT_Z:m},Symbol.toStringTag,{value:"Module"}));var g=1e-6;function b(){return g}var _=Math.random,w=Math.PI/180,L=180/Math.PI;function k(e){return e*w}function x(e){return e*L}function S(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function I(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function E(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function C(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function M(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function Z(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function V(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function R(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function F(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function z(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function T(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function A(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function D(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function N(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(n*n+r*r+i*i)}function O(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function P(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function B(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function q(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function H(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function j(e,t,n){var r=t[0],i=t[1],a=t[2],l=n[0],s=n[1],o=n[2];return e[0]=i*o-a*s,e[1]=a*l-r*o,e[2]=r*s-i*l,e}function U(e,t,n,r){var i=t[0],a=t[1],l=t[2];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=l+r*(n[2]-l),e}function W(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12],e[1]=n[1]*r+n[5]*i+n[9]*a+n[13],e[2]=n[2]*r+n[6]*i+n[10]*a+n[14],e}function G(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e}function J(e,t,n){var r=n[0],i=n[1],a=n[2],l=n[3],s=t[0],o=t[1],u=t[2],c=i*u-a*o,f=a*s-r*u,d=r*o-i*s,y=i*d-a*f,h=a*c-r*d,p=r*f-i*c,v=2*l;return c*=v,f*=v,d*=v,y*=2,h*=2,p*=2,e[0]=s+c+y,e[1]=o+f+h,e[2]=u+d+p,e}function X(e,t){I(Y,e),I(Q,t),q(Y,Y),q(Q,Q);var n=H(Y,Q);return n>1?0:n<-1?Math.PI:Math.acos(n)}Object.freeze(Object.defineProperty({__proto__:null,getEpsilon:b,setEpsilon:function(e){g=e},RANDOM:_,toRadian:k,toDegree:x,equals:function(e,t){return Math.abs(e-t)<=g*Math.max(1,Math.abs(e),Math.abs(t))}},Symbol.toStringTag,{value:"Module"}));var Y=[0,0,0],Q=[0,0,0];function $(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function K(e,t){if(e===t)return!0;var n=e[0],r=e[1],i=e[2],a=t[0],l=t[1],s=t[2],o=b();return Math.abs(n-a)<=o*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-l)<=o*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))}function ee(e,t,n){var r=n[0]-t[0],i=n[1]-t[1],a=n[2]-t[2],l=r*r+i*i+a*a;return l>0?(l=1/Math.sqrt(l),e[0]=r*l,e[1]=i*l,e[2]=a*l,e):(e[0]=0,e[1]=0,e[2]=0,e)}var te=M,ne=Z,re=V,ie=N,ae=O,le=S,se=P,oe=Object.freeze(Object.defineProperty({__proto__:null,length:S,copy:I,set:E,add:C,subtract:M,multiply:Z,divide:V,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:R,abs:F,sign:z,min:T,max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:A,scaleAndAdd:D,distance:N,squaredDistance:O,squaredLength:P,negate:B,inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:q,dot:H,cross:j,lerp:U,hermite:function(e,t,n,r,i,a){var l=a*a,s=l*(2*a-3)+1,o=l*(a-2)+a,u=l*(a-1),c=l*(3-2*a);return e[0]=t[0]*s+n[0]*o+r[0]*u+i[0]*c,e[1]=t[1]*s+n[1]*o+r[1]*u+i[1]*c,e[2]=t[2]*s+n[2]*o+r[2]*u+i[2]*c,e},bezier:function(e,t,n,r,i,a){var l=1-a,s=l*l,o=a*a,u=s*l,c=3*a*s,f=3*o*l,d=o*a;return e[0]=t[0]*u+n[0]*c+r[0]*f+i[0]*d,e[1]=t[1]*u+n[1]*c+r[1]*f+i[1]*d,e[2]=t[2]*u+n[2]*c+r[2]*f+i[2]*d,e},random:function(e,t){t=t||1;var n=_,r=2*n()*Math.PI,i=2*n()-1,a=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*a,e[1]=Math.sin(r)*a,e[2]=i*t,e},transformMat4:W,transformMat3:G,transformQuat:J,rotateX:function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},rotateY:function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},rotateZ:function(e,t,n,r){var i=[],a=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},angle:X,str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:$,equals:K,direction:ee,sub:te,mul:ne,div:re,dist:ie,sqrDist:ae,len:le,sqrLen:se},Symbol.toStringTag,{value:"Module"}));function ue(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ce(e,t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e}function fe(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function de(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function ye(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function he(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function pe(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function ve(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(n*n+r*r+i*i+a*a)}function me(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return n*n+r*r+i*i+a*a}function ge(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.sqrt(t*t+n*n+r*r+i*i)}function be(e){var t=e[0],n=e[1],r=e[2],i=e[3];return t*t+n*n+r*r+i*i}function _e(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],l=n*n+r*r+i*i+a*a;return l>0&&(l=1/Math.sqrt(l),e[0]=n*l,e[1]=r*l,e[2]=i*l,e[3]=a*l),e}function we(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Le(e,t,n,r){var i=t[0],a=t[1],l=t[2],s=t[3];return e[0]=i+r*(n[0]-i),e[1]=a+r*(n[1]-a),e[2]=l+r*(n[2]-l),e[3]=s+r*(n[3]-s),e}function ke(e,t,n){var r=t[0],i=t[1],a=t[2],l=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*l,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*l,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*l,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*l,e}function xe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Se(e,t){var n=e[0],r=e[1],i=e[2],a=e[3],l=t[0],s=t[1],o=t[2],u=t[3],c=b();return Math.abs(n-l)<=c*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-s)<=c*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=c*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(a-u)<=c*Math.max(1,Math.abs(a),Math.abs(u))}var Ie=de,Ee=ye,Ce=he,Me=ve,Ze=me,Ve=ge,Re=be,Fe=Object.freeze(Object.defineProperty({__proto__:null,copy:ue,set:ce,add:fe,subtract:de,multiply:ye,divide:he,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:pe,scaleAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},distance:ve,squaredDistance:me,length:ge,squaredLength:be,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:_e,dot:we,lerp:Le,random:function(e,t){var n,r,i,a,l,s,o=_;t=t||1;do{l=(n=2*o()-1)*n+(r=2*o()-1)*r}while(l>=1);do{s=(i=2*o()-1)*i+(a=2*o()-1)*a}while(s>=1);var u=Math.sqrt((1-l)/s);return e[0]=t*n,e[1]=t*r,e[2]=t*i*u,e[3]=t*a*u,e},transformMat4:ke,transformQuat:function(e,t,n){var r=t[0],i=t[1],a=t[2],l=n[0],s=n[1],o=n[2],u=n[3],c=u*r+s*a-o*i,f=u*i+o*r-l*a,d=u*a+l*i-s*r,y=-l*r-s*i-o*a;return e[0]=c*u+y*-l+f*-o-d*-s,e[1]=f*u+y*-s+d*-l-c*-o,e[2]=d*u+y*-o+c*-s-f*-l,e[3]=t[3],e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:xe,equals:Se,sub:Ie,mul:Ee,div:Ce,dist:Me,sqrDist:Ze,len:Ve,sqrLen:Re},Symbol.toStringTag,{value:"Module"})),ze=new Float32Array(1);function Te(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1}function Ae(e,t,n){return Math.min(Math.max(e,t),n)}function De(e){return 0==(e&e-1)}function Ne(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function Oe(e){return Math.pow(10,Math.ceil(Math.LOG10E*Math.log(e)))}function Pe(e,t,n){return e+(t-e)*n}function Be(e){return e*Math.PI/180}function qe(e){return 180*e/Math.PI}function He(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e-6;return(e<0?-1:1)/Math.max(Math.abs(e),t)}function je(e){return Math.acos(Ae(e,-1,1))}function Ue(e){return Math.asin(Ae(e,-1,1))}function We(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6;return e===t||!(!Number.isFinite(e)||!Number.isFinite(t))&&(e>t?e-t:t-e)<=n}var Ge=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));var Je=BigInt("1000000");function Xe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-6;if(e===t)return!0;if(!Number.isFinite(e)||!Number.isFinite(t))return!1;var r=Math.abs(e-t),i=Math.abs(e),a=Math.abs(t);if(0===e||0===t||i<1e-12&&a<1e-12){if(r>.01*n)return!1}else if(r/(i+a)>n)return!1;return!0}function Ye(e){return Qe(Math.max(-nt,Math.min(e,nt)))}function Qe(e){return ze[0]=e,ze[0]}function $e(e,t,n){var r=Ae((n-e)/(t-e),0,1);return r*r*(3-2*r)}function Ke(e,t){var n=S(e);return E(t,n,Ue(e[2]/n),Math.atan2(e[1]/n,e[0]/n)),t}function et(e,t,n){return ce(e,t[0],t[1],t[2],t[3]*n)}function tt(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(We(t,1)&&We(n,1)&&We(r,1))}!function(e){var t=function(e){return Ge.setFloat64(0,e),Ge.getBigInt64(0)}(e=Math.abs(e)),n=function(e){return Ge.setBigInt64(0,e),Ge.getFloat64(0)}(t<=Je?Je:t-Je);Math.abs(e-n)}(1);var nt=Qe(34028234663852886e22)},25874:function(e,t,n){n.d(t,{s:function(){return s},u:function(){return o}});var r=n(1413),i=n(93661),a=n(48848),l=n(70449);function s(e){return(0,i.t)(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function o(e,t){if((0,i.t)(e))return null;if(!s(e))return new a.s("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '".concat(e.type||e.declaredClass,"'"),{renderer:e});switch(e.type){case"simple":return u(n=e,(0,l.S)(n.symbol).error);case"unique-value":return function(e,t){var n,a=(0,r.Z)((0,r.Z)({},l.a),t),s=null===(n=e.uniqueValueInfos)||void 0===n?void 0:n.map((function(e){return(0,l.S)(e.symbol,a).error})).filter(i.r),o=(0,l.S)(e.defaultSymbol,a);return o.error&&null!==s&&void 0!==s&&s.unshift(o.error),u(e,s)}(e,t);case"class-breaks":return function(e){var t=e.classBreakInfos.map((function(e){return(0,l.S)(e.symbol).error})).filter(i.r),n=(0,l.S)(e.defaultSymbol);return n.error&&t.unshift(n.error),u(e,t)}(e);case"dictionary":case"heatmap":return null}var n;return null}function u(e,t){if(!t)return null;var n;if((n=Array.isArray(t)?t:[t]).length>0){var r=n.map((function(e){return e.details.symbol.type||e.details.symbol.declaredClass})).filter((function(e){return!!e}));r.sort();var i=[];return r.forEach((function(e,t){0!==t&&e===r[t-1]||i.push(e)})),new a.s("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols (".concat(i.join(", "),") which are not supported in 3D"),{renderer:e,symbolErrors:n})}return null}},78666:function(e,t,n){n.d(t,{i:function(){return s},n:function(){return l},t:function(){return u}});var r=n(37762),i=n(93661),a=n(48848);function l(e,t,n){return t.flatten((function(e){return e.sublayers})).length!==e.length||(!!e.some((function(e){return e.originIdOf("minScale")>n||e.originIdOf("maxScale")>n||e.originIdOf("renderer")>n||e.originIdOf("labelingInfo")>n||e.originIdOf("opacity")>n||e.originIdOf("labelsVisible")>n||e.originIdOf("source")>n}))||!o(e,t))}function s(e,t,n){return!!e.some((function(e){var t=e.source;return!(!t||"map-layer"===t.type&&t.mapLayerId===e.id&&((0,i.t)(t.gdbVersion)||t.gdbVersion===n))||e.originIdOf("renderer")>a.r.SERVICE||e.originIdOf("labelingInfo")>a.r.SERVICE||e.originIdOf("opacity")>a.r.SERVICE||e.originIdOf("labelsVisible")>a.r.SERVICE}))||!o(e,t)}function o(e,t){if(!e||!e.length||(0,i.t)(t))return!0;var n=t.slice().reverse().flatten((function(e){var t=e.sublayers;return t&&t.toArray().reverse()})).map((function(e){return e.id})).toArray();if(e.length>n.length)return!1;var a,l=0,s=n.length,o=(0,r.Z)(e);try{for(o.s();!(a=o.n()).done;){for(var u=a.value.id;l<s&&n[l]!==u;)l++;if(l>=s)return!1}}catch(c){o.e(c)}finally{o.f()}return!0}function u(e){return!!e&&e.some((function(e){return null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale}))}}}]);
//# sourceMappingURL=6032.7b8018c9.chunk.js.map