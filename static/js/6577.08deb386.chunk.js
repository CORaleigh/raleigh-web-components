"use strict";(self.webpackChunkraleighnc_web_component=self.webpackChunkraleighnc_web_component||[]).push([[6577,5612],{15612:function(e,t,r){r.r(t);var n,i=r(29439),a=r(37762),s=r(15671),o=r(43144),l=r(60136),u=r(29388),c=r(23132),f=r(91204),p=r(83822),h=r(57714),d=r(70441),m=r(75610),v=r(30709),y=r(30604),x=r(43124),g=(r(80262),r(36460),r(51451),r(80175),r(50526),r(50448),r(41742),r(43920),r(1773),r(77196),r(24980),r(3114),r(22144),r(78674),r(66307),r(2760),r(88370),r(72820),r(78311),r(96349),r(9055),r(79611),r(2157),r(21583),r(69797),new h.s({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null})),b=n=function(e){(0,l.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e)).displayFieldName=null,n.exceededTransferLimit=!1,n.features=[],n.fields=null,n.geometryType=null,n.hasM=!1,n.hasZ=!1,n.queryGeometry=null,n.spatialReference=null,n}return(0,o.Z)(r,[{key:"readFeatures",value:function(e,t){for(var r=v.k.fromJSON(t.spatialReference),n=[],i=0;i<e.length;i++){var a=e[i],s=p.g.fromJSON(a),o=a.geometry&&a.geometry.spatialReference;(0,m.r)(s.geometry)&&!o&&(s.geometry.spatialReference=r);var l=a.aggregateGeometries,u=s.aggregateGeometries;if(l&&(0,m.r)(u))for(var c in u){var f,h=u[c],d=null===(f=l[c])||void 0===f?void 0:f.spatialReference;(0,m.r)(h)&&!d&&(h.spatialReference=r)}n.push(s)}return n}},{key:"writeGeometryType",value:function(e,t,r,n){if(e)g.write(e,t,r,n);else{var i=this.features;if(i){var s,o=(0,a.Z)(i);try{for(o.s();!(s=o.n()).done;){var l=s.value;if(l&&(0,m.r)(l.geometry))return void g.write(l.geometry.type,t,r,n)}}catch(u){o.e(u)}finally{o.f()}}}}},{key:"readQueryGeometry",value:function(e,t){if(!e)return null;var r=!!e.spatialReference,n=(0,y.d)(e);return!r&&t.spatialReference&&(n.spatialReference=v.k.fromJSON(t.spatialReference)),n}},{key:"writeSpatialReference",value:function(e,t){if(e)t.spatialReference=e.toJSON();else{var r=this.features;if(r){var n,i=(0,a.Z)(r);try{for(i.s();!(n=i.n()).done;){var s=n.value;if(s&&(0,m.r)(s.geometry)&&s.geometry.spatialReference)return void(t.spatialReference=s.geometry.spatialReference.toJSON())}}catch(o){i.e(o)}finally{i.f()}}}}},{key:"clone",value:function(){return new n(this.cloneProperties())}},{key:"cloneProperties",value:function(){return(0,m.m)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}},{key:"toJSON",value:function(e){var t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(var r=0;r<t.features.length;r++){var n=t.features[r];if(n.geometry){var i=e&&e[r];n.geometry=i&&i.toJSON()||n.geometry}}return t}},{key:"quantize",value:function(e){for(var t=(0,i.Z)(e.scale,2),r=t[0],n=t[1],a=(0,i.Z)(e.translate,2),s=a[0],o=a[1],l=this.features,u=this._getQuantizationFunction(this.geometryType,(function(e){return Math.round((e-s)/r)}),(function(e){return Math.round((o-e)/n)})),c=0,f=l.length;c<f;c++)u((0,m.e)(l[c].geometry))||(l.splice(c,1),c--,f--);return this.transform=e,this}},{key:"unquantize",value:function(){var e=this.geometryType,t=this.features,r=this.transform;if(!r)return this;var n,s=(0,i.Z)(r.translate,2),o=s[0],l=s[1],u=(0,i.Z)(r.scale,2),c=u[0],f=u[1],p=this._getHydrationFunction(e,(function(e){return e*c+o}),(function(e){return l-e*f})),h=(0,a.Z)(t);try{for(h.s();!(n=h.n()).done;){var d=n.value.geometry;(0,m.r)(d)&&p(d)}}catch(v){h.e(v)}finally{h.f()}return this.transform=null,this}},{key:"_quantizePoints",value:function(e,t,r){for(var n,i,a=[],s=0,o=e.length;s<o;s++){var l=e[s];if(s>0){var u=t(l[0]),c=r(l[1]);u===n&&c===i||(a.push([u-n,c-i]),n=u,i=c)}else n=t(l[0]),i=r(l[1]),a.push([n,i])}return a.length>0?a:null}},{key:"_getQuantizationFunction",value:function(e,t,r){var n=this;return"point"===e?function(e){return e.x=t(e.x),e.y=r(e.y),e}:"polyline"===e||"polygon"===e?function(e){for(var i=(0,y.c)(e)?e.rings:e.paths,a=[],s=0,o=i.length;s<o;s++){var l=i[s],u=n._quantizePoints(l,t,r);u&&a.push(u)}return a.length>0?((0,y.c)(e)?e.rings=a:e.paths=a,e):null}:"multipoint"===e?function(e){var i=n._quantizePoints(e.points,t,r);return i.length>0?(e.points=i,e):null}:"extent"===e?function(e){return e}:null}},{key:"_getHydrationFunction",value:function(e,t,r){return"point"===e?function(e){e.x=t(e.x),e.y=r(e.y)}:"polyline"===e||"polygon"===e?function(e){for(var n,i,a=(0,y.c)(e)?e.rings:e.paths,s=0,o=a.length;s<o;s++)for(var l=a[s],u=0,c=l.length;u<c;u++){var f=l[u];u>0?(n+=f[0],i+=f[1]):(n=f[0],i=f[1]),f[0]=t(n),f[1]=r(i)}}:"extent"===e?function(e){e.xmin=t(e.xmin),e.ymin=r(e.ymin),e.xmax=t(e.xmax),e.ymax=r(e.ymax)}:"multipoint"===e?function(e){for(var n,i,a=e.points,s=0,o=a.length;s<o;s++){var l=a[s];s>0?(n+=l[0],i+=l[1]):(n=l[0],i=l[1]),l[0]=t(n),l[1]=r(i)}}:void 0}}]),r}(d.l);(0,c.e)([(0,c.d)({type:String,json:{write:!0}})],b.prototype,"displayFieldName",void 0),(0,c.e)([(0,c.d)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],b.prototype,"exceededTransferLimit",void 0),(0,c.e)([(0,c.d)({type:[p.g],json:{write:!0}})],b.prototype,"features",void 0),(0,c.e)([(0,v.o)("features")],b.prototype,"readFeatures",null),(0,c.e)([(0,c.d)({type:[x.y],json:{write:!0}})],b.prototype,"fields",void 0),(0,c.e)([(0,c.d)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:g.read}}})],b.prototype,"geometryType",void 0),(0,c.e)([(0,v.r)("geometryType")],b.prototype,"writeGeometryType",null),(0,c.e)([(0,c.d)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],b.prototype,"hasM",void 0),(0,c.e)([(0,c.d)({type:Boolean,json:{write:{overridePolicy:function(e){return{enabled:e}}}}})],b.prototype,"hasZ",void 0),(0,c.e)([(0,c.d)({types:f.i,json:{write:!0}})],b.prototype,"queryGeometry",void 0),(0,c.e)([(0,v.o)("queryGeometry")],b.prototype,"readQueryGeometry",null),(0,c.e)([(0,c.d)({type:v.k,json:{write:!0}})],b.prototype,"spatialReference",void 0),(0,c.e)([(0,v.r)("spatialReference")],b.prototype,"writeSpatialReference",null),(0,c.e)([(0,c.d)({json:{write:!0}})],b.prototype,"transform",void 0),(b=n=(0,c.e)([(0,c.n)("esri.rest.support.FeatureSet")],b)).prototype.toJSON.isDefaultToJSON=!0;var k=b;t.default=k},6577:function(e,t,r){r.r(t);var n=r(11752),i=r(61120),a=r(93433),s=r(29439),o=r(1413),l=r(74165),u=r(15861),c=r(15671),f=r(43144),p=r(60136),h=r(29388),d=r(23132),m=r(51451),v=r(86644),y=r(75610),x=r(9575),g=r(36551),b=r(50448),k=r(30709),w=r(72763),I=r(68890),S=r(31513),R=(r(91204),r(57714)),T=r(77389),Z=r(97866),_=r(18411),C=r(4720),M=r(40881),P=r(22951),F=r(80262),O=r(28623),B=r(95254),D=r(12158),z=r(93874),E=r(62446),N=r(43124),L=r(70441),A=r(43920),H=r(81183),J=r(93669),j=r(75105),W=r(30936),G=r(15612),U=r(11670),q=r(40452),V=(r(80175),r(50526),r(41742),r(1773),r(77196),r(6794),r(33703),r(49580),r(54841),r(78674),r(66307),r(2760),r(67154),r(24980),r(3114),r(22144),r(88370),r(72820),r(78311),r(96349),r(9055),r(79611),r(2157),r(96636),r(79054),r(29709),r(47642),r(83822),r(30604),r(36460),r(43782),r(33976),r(1241),r(30664),r(38304),r(83024),r(61340),r(47626),r(25316),r(44455),r(61212),r(69202),r(21583),r(36638),r(61099),r(27264),r(69797),r(63022),r(69953),r(48561),r(97033),r(77470),r(17436),d.s.getLogger("esri.layers.mixins.ImageryTileMixin")),X=function(e){(0,p.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,c.Z)(this,r),(e=t.apply(this,arguments)).rasterJobHandler=null,e.datasetName=null,e.datasetFormat=null,e.rasterInfo=null,e.ioConfig={sampling:"closest"},e}return(0,f.Z)(r,[{key:"init",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,j.k)(),this.addResolvingPromise(t),e.next=4,this.when();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"normalizeCtorArgs",value:function(e){return e&&e.ioConfig&&(e=(0,o.Z)((0,o.Z)({},e),{},{ioConfig:(0,o.Z)({resolution:null,bandIds:null,sampling:"closest",tileInfo:C.S.create()},e.ioConfig)})),e}},{key:"_isGlobalWrappableSource",get:function(){var e=this.rasterInfo,t=(0,j.X)(e.spatialReference);return(0,y.r)(t)&&e.extent.width>=t/2}},{key:"url",set:function(e){this._set("url",(0,Z.S)(e,d.s.getLogger(this.declaredClass)))}},{key:"open",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new d.a("BaseRaster:open-not-implemented","open() is not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchTile",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n){var i,a,s,o=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=o.length>3&&void 0!==o[3]?o[3]:{},a=i.tileInfo||this.rasterInfo.storageInfo.tileInfo,s=this.getTileExtentFromTileInfo(t,r,n,a),e.abrupt("return",this.fetchPixels(s,a.size[0],a.size[1],i));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"identify",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n,i,a,s,u,c,f,p,h,d,m,x,g,b,k,w,I,S,R,T,Z,_,C,M,P,F,O,B,D,z,E=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=E.length>1&&void 0!==E[1]?E[1]:{},s=(a=i).multidimensionalDefinition,u=a.timeExtent,c=this.rasterInfo,f=c.hasMultidimensionalTranspose,p=c.multidimensionalInfo,h=i.transposedVariableName,(d=(0,y.r)(p)&&f&&(null!=u||(0,v.d)(s)))&&!h&&(h=(0,y.r)(s)&&s.length>0?s[0].variableName:p.variables[0].name,i=(0,o.Z)((0,o.Z)({},i),{},{transposedVariableName:h})),i=this._getRequestOptionsWithSliceId(i),m=this.rasterInfo,x=m.spatialReference,g=m.extent,b=i.datumTransformation,k=(0,j._)(t,x,b),g.intersects(k)){e.next=10;break}return e.abrupt("return",{location:k,value:null});case 10:if(!(0,y.r)(this.rasterInfo.transform)){e.next=15;break}if(w=this.rasterInfo.transform.inverseTransform(k),this.rasterInfo.nativeExtent.intersects(w)){e.next=14;break}return e.abrupt("return",{location:w,value:null});case 14:k=w;case 15:if(I=0,S=h&&(0,y.r)(p)&&this.rasterInfo.hasMultidimensionalTranspose){e.next=27;break}if(!i.srcResolution){e.next=22;break}I=(0,j.t)(i.srcResolution,this.rasterInfo,this.ioConfig.sampling).pyramidLevel,e.next=27;break;case 22:return e.next=24,this.computeBestPyramidLevelForLocation(t,i);case 24:if(null!=(I=e.sent)){e.next=27;break}return e.abrupt("return",{location:k,value:null});case 27:if(null!==(R=this.identifyPixelLocation(k,I,null,S))){e.next=30;break}return e.abrupt("return",{location:k,value:null});case 30:return T=R.row,Z=R.col,_=R.rowOffset,C=R.colOffset,M=R.blockWidth,P=null!==(r=h)&&void 0!==r?r:(0,y.e)(i.sliceId),F=(0,H.i)(this.url,P),O="".concat(I,"/").concat(T,"/").concat(Z),B=(0,H.m)(F,null,O),(0,y.t)(B)&&(B=this.fetchRawTile(I,T,Z,i),(0,H.x)(F,null,O,B)),e.next=35,B;case 35:if(D=e.sent,!(0,y.t)(D)&&null!==(n=D.pixels)&&void 0!==n&&n.length){e.next=38;break}return e.abrupt("return",{location:k,value:null});case 38:return z=_*M+C,e.abrupt("return",this._processIdentifyResult(D,{srcLocation:k,position:z,pyramidLevel:I,useTransposedTile:S,requestSomeSlices:d,identifyOptions:i}));case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchPixels",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n){var i,a,s,o,u,c,f,p,h,d,m,v,x,g,b,k,w,I,S=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=S.length>3&&void 0!==S[3]?S[3]:{},t=(0,j.e)(t),!(i=this._getRequestOptionsWithSliceId(i)).requestRawData){e.next=3;break}return e.abrupt("return",this._fetchPixels(t,r,n,i));case 3:if(a=(0,j.X)(t.spatialReference),s=(0,j.D)(t),!((0,y.t)(a)||0===s||1===s&&this._isGlobalWrappableSource)){e.next=6;break}return e.abrupt("return",this._fetchPixels(t,r,n,i));case 6:if(!(s>=3)){e.next=8;break}return e.abrupt("return",{extent:t,pixelBlock:null});case 8:for(o=[],c=(u=t).xmin,f=u.xmax,p=Math.round(a/(f-c)*r),h=p-Math.round((a/2-c)/(f-c)*r),d=0,m=[],v=0;v<=s;v++)x=new F.M({xmin:0===v?c:-a/2,xmax:v===s?f-a*v:a/2,ymin:t.ymin,ymax:t.ymax,spatialReference:t.spatialReference}),d+=g=0===v?p-h:v===s?r-d:p,m.push(g),b=i.disableWrapAround&&v>0?null:this._fetchPixels(x,g,n,i),o.push(b);return e.next=14,Promise.all(o);case 14:if(k=e.sent.map((function(e){return null===e||void 0===e?void 0:e.pixelBlock})),w=null,I={width:r,height:n},!this.rasterJobHandler){e.next=23;break}return e.next=20,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:k,srcMosaicSize:I,destDimension:null,coefs:null,sampleSpacing:null,interpolation:"nearest",alignmentInfo:null,blockWidths:m},i);case 20:w=e.sent.pixelBlock,e.next=24;break;case 23:w=(0,J.a)(k,I,{blockWidths:m});case 24:return e.abrupt("return",{extent:t,srcExtent:(0,j.F)(t,this.rasterInfo.spatialReference,i.datumTransformation),pixelBlock:w});case 25:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"fetchRawPixels",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n){var i,a,s,o,u,c,f,p,h,d,m,v,x,g,b,k,w=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=w.length>3&&void 0!==w[3]?w[3]:{},r={x:Math.floor(r.x),y:Math.floor(r.y)},e.next=4,this._fetchRawTiles(t,r,n,i);case 4:if(a=e.sent,s=this.rasterInfo,o=s.nativeExtent,u=s.nativePixelSize,c=s.storageInfo,f=Math.pow(2,t),p=u.x*f,h=u.y*f,d=new F.M({xmin:o.xmin+p*r.x,xmax:o.xmin+p*(r.x+n.width-1),ymin:o.ymax-h*(r.y+n.height-1),ymax:o.ymax-h*r.y,spatialReference:o.spatialReference}),a){e.next=15;break}return e.abrupt("return",{extent:d,srcExtent:d,pixelBlock:null});case 15:if(m=a.pixelBlocks,v=a.mosaicSize,1!==m.length||!(0,y.r)(m[0])||m[0].width!==n.width||m[0].height!==n.height){e.next=18;break}return e.abrupt("return",{extent:d,srcExtent:d,pixelBlock:a.pixelBlocks[0]});case 18:if(x=t>0?c.pyramidBlockWidth:c.blockWidth,g=t>0?c.pyramidBlockHeight:c.blockHeight,b={x:r.x%x,y:r.y%g},!this.rasterJobHandler){e.next=25;break}return e.next=22,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:m,srcMosaicSize:v,destDimension:n,clipOffset:b,clipSize:n,coefs:null,sampleSpacing:null,interpolation:i.interpolation,alignmentInfo:null,blockWidths:null},i);case 22:k=e.sent.pixelBlock,e.next=26;break;case 25:k=(0,J.a)(m,v,{clipOffset:b,clipSize:n});case 26:return e.abrupt("return",{extent:d,srcExtent:d,pixelBlock:k});case 27:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(e,t,r,n){throw new d.a("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")}},{key:"computeExtent",value:function(e){return(0,j.F)(this.rasterInfo.extent,e)}},{key:"decodePixelBlock",value:function(e,t){return!this.rasterJobHandler||t.useCanvas?(0,P.S)(e,t):this.rasterJobHandler.decode({data:e,options:t})}},{key:"request",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n){var i,a,s,u,c,f,p;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.ioConfig.customFetchParameters,u=r.range,c=r.query,f=r.headers,n=null!==(i=null!==(a=n)&&void 0!==a?a:r.retryCount)&&void 0!==i?i:this.ioConfig.retryCount,p=u?{Range:"bytes=".concat(u.from,"-").concat(u.to)}:null,e.prev=3,e.next=6,(0,R.U)(t,(0,o.Z)((0,o.Z)({},r),{},{query:(0,o.Z)((0,o.Z)({},c),s),headers:(0,o.Z)((0,o.Z)({},f),p)}));case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!(n>0)){e.next=13;break}return e.abrupt("return",(n--,this.request(t,r,n)));case 13:throw e.t0;case 14:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getSliceIndex",value:function(e){var t=this.rasterInfo.multidimensionalInfo;return(0,y.t)(t)||(0,y.t)(e)||0===e.length?null:(0,v.e)(e,t)}},{key:"getTileExtentFromTileInfo",value:function(e,t,r,n){var i=n.lodAt(e);return this.getTileExtent({x:i.resolution,y:i.resolution},t,r,n.origin,n.spatialReference,n.size)}},{key:"updateTileInfo",value:function(){var e=this.rasterInfo,t=e.storageInfo,r=e.spatialReference,n=e.extent,i=e.pixelSize;if(!t.tileInfo){for(var a=[],s=t.maximumPyramidLevel||0,o=Math.max(i.x,i.y),l=1/.0254*96*o,u=0;u<=s;u++)a.push({level:s-u,resolution:o,scale:l}),o*=2,l*=2;var c=new k.j({x:n.xmin,y:n.ymax,spatialReference:r});t.tileInfo=new C.S({origin:c,size:[t.blockWidth,t.blockHeight],spatialReference:r,lods:a}),t.isVirtualTileInfo=!0}}},{key:"createRemoteDatasetStorageInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,n=arguments.length>3?arguments[3]:void 0,i=e.width,a=e.height,s=e.nativeExtent,o=e.pixelSize,l=e.spatialReference,u=new k.j({x:s.xmin,y:s.ymax,spatialReference:l});null==n&&(n=Math.max(0,Math.round(Math.log(Math.max(i,a))/Math.LN2-8)));var c=this.computeBlockBoundary(s,512,512,{x:s.xmin,y:s.ymax},[o],n);e.storageInfo=new P.p({blockWidth:t,blockHeight:r,pyramidBlockWidth:t,pyramidBlockHeight:r,origin:u,firstPyramidLevel:1,maximumPyramidLevel:n,blockBoundary:c})}},{key:"computeBestPyramidLevelForLocation",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",0);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"computeBlockBoundary",value:function(e,t,r,n,i){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2;if(1===i.length&&s>0)for(var l=(i=(0,a.Z)(i))[0],u=l.x,c=l.y,f=0;f<s;f++)u*=o,c*=o,i.push({x:u,y:c});for(var p=[],h=n.x,d=n.y,m=0;m<i.length;m++){var v=i[m],y=v.x,x=v.y;p.push({minCol:Math.floor((e.xmin-h+.1*y)/t/y),maxCol:Math.floor((e.xmax-h-.1*y)/t/y),minRow:Math.floor((d-e.ymax+.1*x)/r/x),maxRow:Math.floor((d-e.ymin-.1*x)/r/x)})}return p}},{key:"getPyramidPixelSize",value:function(e){var t=this.rasterInfo.nativePixelSize,r=this.rasterInfo.storageInfo,n=r.pyramidResolutions,i=r.pyramidScalingFactor;if(0===e)return t;if((0,y.r)(n)&&n.length)return n[e-1];var a=Math.pow(i,e);return{x:t.x*a,y:t.y*a}}},{key:"identifyPixelLocation",value:function(e,t,r,n){var i=this.rasterInfo,a=i.spatialReference,s=i.nativeExtent,o=i.storageInfo,l=o.maximumPyramidLevel,u=o.origin,c=o.transposeInfo,f=n&&(0,y.r)(c)?c.tileSize[0]:o.blockWidth,p=n&&(0,y.r)(c)?c.tileSize[1]:o.blockHeight,h=(0,j._)(e,a,r);if(!s.intersects(h))return null;if(t<0||t>l)return null;var d=this.getPyramidPixelSize(t),m=d.x,v=d.y,x=(u.y-h.y)/v/p,g=(h.x-u.x)/m/f,b=Math.min(p-1,Math.floor((x-Math.floor(x))*p)),k=Math.min(f-1,Math.floor((g-Math.floor(g))*f));return{pyramidLevel:t,row:Math.floor(x),col:Math.floor(g),rowOffset:b,colOffset:k,blockWidth:f,srcLocation:h}}},{key:"getTileExtent",value:function(e,t,r,n,i,a){var o=(0,s.Z)(a,2),l=o[0],u=o[1],c=n.x+r*l*e.x,f=c+l*e.x,p=n.y-t*u*e.y,h=p-u*e.y;return new F.M({xmin:c,xmax:f,ymin:h,ymax:p,spatialReference:i})}},{key:"getBlockWidthHeight",value:function(e){return{blockWidth:e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,blockHeight:e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight}}},{key:"isBlockOutside",value:function(e,t,r){var n=this.rasterInfo.storageInfo.blockBoundary[e];return!n||n.maxRow<t||n.maxCol<r||n.minRow>t||n.minCol>r}},{key:"_fetchPixels",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n){var i,a,s,o,u,c,f,p,h,d,m,v,x,g,b,w,I,S,R,T,Z,_,C,P,F,O,B,D,z,E,N,L,A,H,W=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=W.length>3&&void 0!==W[3]?W[3]:{},!((a=(0,j.D)(t))>=2)){e.next=4;break}return e.abrupt("return",{extent:t,pixelBlock:null});case 4:if(s=this._getSourceDataInfo(t,r,n,i),o=s.pyramidLevel,u=s.pyramidResolution,c=s.srcResolution,f=s.srcExtent,p=s.srcWidth,h=s.srcHeight,0!==p&&0!==h){e.next=7;break}return e.abrupt("return",{extent:t,srcExtent:f,pixelBlock:null});case 7:return d=(0,y.e)(this.rasterInfo.transform),m="gcs-shift"===(null===d||void 0===d?void 0:d.type),v=(0,y.r)((0,j.X)(t.spatialReference)),!m&&v||(a=(0,j.D)(s.srcExtent,m)),x=this.rasterInfo.storageInfo,g={x:Math.floor((f.xmin-x.origin.x)/u.x+.1),y:Math.floor((x.origin.y-f.ymax)/u.y+.1)},e.next=13,this._fetchRawTiles(o,g,{width:p,height:h,wrapCount:a},i);case 13:if(b=e.sent){e.next=16;break}return e.abrupt("return",{extent:t,srcExtent:f,pixelBlock:null});case 16:if(w=o>0?x.pyramidBlockWidth:x.blockWidth,I=o>0?x.pyramidBlockHeight:x.blockHeight,S=w===p&&I===h&&g.x%w==0&&g.y%I==0,R=new k.j({x:(t.xmax-t.xmin)/r,y:(t.ymax-t.ymin)/n,spatialReference:t.spatialReference}),T=!t.spatialReference.equals(this.rasterInfo.spatialReference),Z=i.datumTransformation,T||!S||1!==b.pixelBlocks.length||w!==r||I!==n||c.x!==R.x||c.y!==R.y){e.next=19;break}return e.abrupt("return",{extent:t,srcExtent:f,pixelBlock:b.pixelBlocks[0]});case 19:if(_=v&&(0,y.r)((0,j.X)(f.spatialReference)),C=i.requestProjectedLocalDirections&&this.rasterInfo.dataType.startsWith("vector"),e.t0=C&&!this.rasterJobHandler,!e.t0){e.next=24;break}return e.next=24,(0,j.k)();case 24:if(!this.rasterJobHandler){e.next=30;break}return e.next=27,this.rasterJobHandler.getProjectionOffsetGrid({projectedExtent:t,srcBufferExtent:b.extent,pixelSize:R.toJSON(),datumTransformation:Z,rasterTransform:d,hasWrapAround:a>0||_,isAdaptive:!1!==this.ioConfig.optimizeProjectionAccuracy,includeGCSGrid:C},i);case 27:e.t1=e.sent,e.next=31;break;case 30:e.t1=(0,j.V)({projectedExtent:t,srcBufferExtent:b.extent,pixelSize:R,datumTransformation:Z,rasterTransform:d,hasWrapAround:a>0||_,isAdaptive:!1,includeGCSGrid:C});case 31:if(P=e.t1,O=!i.requestRawData,B={rows:P.spacing[0],cols:P.spacing[1]},D=(0,y.e)(this._getRasterTileAlignmentInfo(o,b.extent.xmin)),z=b.pixelBlocks,E=b.mosaicSize,N=b.isPartiallyFilled,L=null,!this.rasterJobHandler){e.next=42;break}return e.next=37,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:z,srcMosaicSize:E,destDimension:O?{width:r,height:n}:null,coefs:O?P.coefficients:null,sampleSpacing:O?B:null,projectDirections:C,gcsGrid:C?P.gcsGrid:null,isUV:"vector-uv"===this.rasterInfo.dataType,interpolation:i.interpolation,alignmentInfo:D,blockWidths:null},i);case 37:A=e.sent,F=A.pixelBlock,L=A.localNorthDirections,e.next=44;break;case 42:H=(0,J.a)(z,E,{alignmentInfo:D}),F=O?(0,J.C)(H,{width:r,height:n},P.coefficients,B,i.interpolation):H,C&&P.gcsGrid&&(L=(0,J.U)({width:r,height:n},P.gcsGrid),F=(0,M.p)(F,this.rasterInfo.dataType,L));case 44:return e.abrupt("return",i.requestRawData||C?{srcExtent:f,pixelBlock:F,transformGrid:P,localNorthDirections:L,extent:t,isPartiallyFilled:N}:{srcExtent:f,extent:t,pixelBlock:F});case 45:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_fetchRawTiles",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n,i){var a,s,o,u,c,f,p,h,d,m,v,x,g,b,k,w,I,S,R,T,Z,_,C,M,P,O,B,D,z,E,N,L,A,H,J,j,W=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.rasterInfo.storageInfo,s=a.origin,o=a.blockBoundary,u=this.getBlockWidthHeight(t),c=u.blockWidth,f=u.blockHeight,p=r.x,h=r.y,d=n.width,m=n.height,v=n.wrapCount,x=this._getRasterTileAlignmentInfo(t,0),i.buffer&&(p-=i.buffer.cols,h-=i.buffer.rows,d+=2*i.buffer.cols,m+=2*i.buffer.rows),g=0,b=0,k=0,v&&(0,y.r)(x)&&(b=x.worldColumnCountFromOrigin,k=x.originColumnOffset,g=x.rightPadding,b*x.blockWidth-g>=p+d&&(g=0)),w=Math.floor(p/c),I=Math.floor(h/f),S=Math.floor((p+d+g-1)/c),R=Math.floor((h+m+g-1)/f),T=o[t]){e.next=9;break}return e.abrupt("return",null);case 9:if(Z=T.minRow,_=T.minCol,C=T.maxCol,M=T.maxRow,0!==v||!(R<Z||S<_||I>M||w>C)){e.next=12;break}return e.abrupt("return",null);case 12:for(P=new Array,O=!1,B=null==this.ioConfig.allowPartialFill?i.allowPartialFill:this.ioConfig.allowPartialFill,D=I;D<=R;D++)for(z=w;z<=S;z++)E=z,!i.disableWrapAround&&v&&(0,y.r)(x)&&b<=z&&(E=z-b-k),D>=Z&&E>=_&&M>=D&&C>=E?function(){var e=W._fetchRawTile(t,D,E,i);B?P.push(new Promise((function(t){e.then((function(e){return t(e)})).catch((function(){O=!0,t(null)}))}))):P.push(e)}():P.push(null);if(0!==P.length){e.next=18;break}return e.abrupt("return",null);case 18:return e.next=20,Promise.all(P);case 20:return N=e.sent,L={height:(R-I+1)*f,width:(S-w+1)*c},A=this.rasterInfo.spatialReference,H=this.getPyramidPixelSize(t),J=H.x,j=H.y,e.abrupt("return",{extent:new F.M({xmin:s.x+w*c*J,xmax:s.x+(S+1)*c*J,ymin:s.y-(R+1)*f*j,ymax:s.y-I*f*j,spatialReference:A}),pixelBlocks:N,mosaicSize:L,isPartiallyFilled:O});case 27:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_fetchRawTile",value:function(e,t,r,n){var i=this.rasterInfo.storageInfo.blockBoundary[e];if(!i)return Promise.resolve(null);var a=i.minRow,s=i.minCol,l=i.maxCol,u=i.maxRow;if(t<a||r<s||t>u||r>l)return Promise.resolve(null);var c=(0,H.i)(this.url,n.sliceId),f="".concat(e,"/").concat(t,"/").concat(r),p=(0,H.m)(c,n.registryId,f);if((0,y.t)(p)){var h=new AbortController;p=this.fetchRawTile(e,t,r,(0,o.Z)((0,o.Z)({},n),{},{signal:h.signal})),(0,H.x)(c,n.registryId,f,p,h),p.catch((function(){return(0,H.d)(c,n.registryId,f)}))}return n.signal&&(0,d.v)(n,(function(){(0,H.h)(c,n.registryId,f)})),p}},{key:"_computeMagDirValues",value:function(e){var t,r=this.rasterInfo,n=r.bandCount,i=r.dataType;if((2!==n||"vector-magdir"!==i)&&"vector-uv"!==i||2!==(null===e||void 0===e?void 0:e.length)||null===(t=e[0])||void 0===t||!t.length)return null;var a=e[0].length;if("vector-magdir"===i){var o=e[1].map((function(e){return(e+360)%360}));return[e[0],o]}for(var l=(0,s.Z)(e,2),u=l[0],c=l[1],f=[],p=[],h=0;h<a;h++){var d=(0,M.b)([u[h],c[h]]),m=(0,s.Z)(d,2),v=m[0],y=m[1];f.push(v),p.push(y)}return[f,p]}},{key:"_getRasterTileAlignmentInfo",value:function(e,t){return null==this._rasterTileAlighmentInfo&&(this._rasterTileAlighmentInfo=(0,j.H)(this.rasterInfo)),(0,y.t)(this._rasterTileAlighmentInfo.pyramidsInfo)?null:(0,o.Z)({startX:t,halfWorldWidth:this._rasterTileAlighmentInfo.halfWorldWidth,hasGCSSShiftTransform:this._rasterTileAlighmentInfo.hasGCSSShiftTransform},this._rasterTileAlighmentInfo.pyramidsInfo[e])}},{key:"_getSourceDataInfo",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i={datumTransformation:n.datumTransformation,pyramidLevel:0,pyramidResolution:null,srcExtent:null,srcHeight:0,srcResolution:null,srcWidth:0};n.srcResolution&&(i.srcResolution=n.srcResolution,this._updateSourceDataInfo(e,i));var a=this.rasterInfo.storageInfo.maximumPyramidLevel||0,s=i.srcWidth,o=i.srcHeight,l=i.pyramidLevel,u=s/t,c=o/r,f=l<a&&u*c>=16;if(f||l===a&&(u>8||c>8)||0===s||0===o){var p=new k.j({x:(e.xmax-e.xmin)/t,y:(e.ymax-e.ymin)/r,spatialReference:e.spatialReference}),h=(0,j.v)(p,this.rasterInfo.spatialReference,e,i.datumTransformation),d=!h||n.srcResolution&&h.x+h.y<n.srcResolution.x+n.srcResolution.y;if(f&&n.srcResolution&&d){var m=Math.round(Math.log(Math.max(u,c))/Math.LN2)-1;if(a-l+3>=m){var v=Math.pow(2,m);h={x:n.srcResolution.x*v,y:n.srcResolution.y*v}}}h&&(i.srcResolution=h,this._updateSourceDataInfo(e,i))}return(i.srcWidth/t>8||i.srcHeight/r>8)&&(i.srcWidth=0,i.srcHeight=0),i}},{key:"_updateSourceDataInfo",value:function(e,t){t.srcWidth=0,t.srcHeight=0;var r=this.rasterInfo.spatialReference,n=t.srcResolution,i=t.datumTransformation,a=(0,j.t)(n,this.rasterInfo,this.ioConfig.sampling),s=a.pyramidLevel,o=a.pyramidResolution;if(!a.excessiveReading){var l=t.srcExtent||(0,j.F)(e,r,i);if(null!=l){var u=(0,y.e)(this.rasterInfo.transform);u&&(l=u.inverseTransform(l)),t.srcExtent=l;var c=Math.ceil((l.xmax-l.xmin)/o.x-.1),f=Math.ceil((l.ymax-l.ymin)/o.y-.1);t.pyramidLevel=s,t.pyramidResolution=o,t.srcWidth=c,t.srcHeight=f}}}},{key:"_getRequestOptionsWithSliceId",value:function(e){return(0,y.r)(this.rasterInfo.multidimensionalInfo)&&null==e.sliceId&&(e=(0,o.Z)((0,o.Z)({},e),{},{sliceId:this.getSliceIndex(e.multidimensionalDefinition)})),e}},{key:"_processIdentifyResult",value:function(e,t){var r=t.srcLocation,n=t.position,i=t.pyramidLevel,a=t.useTransposedTile,s=e.pixels[0].length/e.width/e.height;if(e.mask&&!e.mask[n])return{location:r,value:null};var o=this.rasterInfo.multidimensionalInfo;if((0,y.t)(o)||!a){var l=e.pixels.map((function(e){return e[n]})),u={location:r,value:l,pyramidLevel:i},c=this._computeMagDirValues(l.map((function(e){return[e]})));return null!==c&&void 0!==c&&c.length&&(u.magdirValue=c.map((function(e){return e[0]}))),u}var f=e.pixels.map((function(e){return Array.prototype.slice.call(e,n*s,n*s+s)})),p=this._computeMagDirValues(f),h=t.requestSomeSlices,d=t.identifyOptions,m=(0,v.r)(o,d.transposedVariableName);if(h){var x,g=(0,v.s)(m,(0,y.e)(d.multidimensionalDefinition),(0,y.e)(d.timeExtent));f=f.map((function(e){return g.map((function(t){return e[t]}))})),p=null===(x=p)||void 0===x?void 0:x.map((function(e){return g.map((function(t){return e[t]}))})),m=g.map((function(e){return m[e]}))}return{location:r,value:null,dataSeries:m.map((function(e,t){var r,n={value:f.map((function(e){return e[t]})),multidimensionalDefinition:e.multidimensionalDefinition,variableName:e.multidimensionalDefinition[0].variableName,dimensionValues:{}};return null!==(r=p)&&void 0!==r&&r.length&&(n.magdirValue=[p[0][t],p[1][t]]),e.multidimensionalDefinition.forEach((function(e){return n.dimensionValues[e.dimensionName]=e.values[0]})),n})),pyramidLevel:i}}}]),r}((0,A.m)(L.l));(0,d.e)([(0,d.d)()],X.prototype,"_rasterTileAlighmentInfo",void 0),(0,d.e)([(0,d.d)({readOnly:!0})],X.prototype,"_isGlobalWrappableSource",null),(0,d.e)([(0,d.d)(_.f)],X.prototype,"url",null),(0,d.e)([(0,d.d)({type:String,json:{write:!0}})],X.prototype,"datasetName",void 0),(0,d.e)([(0,d.d)({type:String,json:{write:!0}})],X.prototype,"datasetFormat",void 0),(0,d.e)([(0,d.d)()],X.prototype,"rasterInfo",void 0),(0,d.e)([(0,d.d)()],X.prototype,"ioConfig",void 0),(0,d.e)([(0,d.d)()],X.prototype,"sourceJSON",void 0);var Y=X=(0,d.e)([(0,d.n)("esri.layers.support.rasterDatasets.BaseRaster")],X);function K(e){var t=e.fields,r=e.records,n=t.some((function(e){return"oid"===e.name.toLowerCase()}))?"OBJECTID":"OID",i=[{name:n,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map((function(e){return{name:e.name,type:"esriFieldType"+e.typeName,alias:e.name}}))),a=i.map((function(e){return e.name})),s=[],o=0,l=0;return r.forEach((function(e){var t={};for(t[n]=o++,l=1;l<a.length;l++)t[a[l]]=e[l-1];s.push({attributes:t})})),{displayFieldName:"",fields:i,features:s}}var Q=function(){function e(){(0,c.Z)(this,e)}return(0,f.Z)(e,null,[{key:"supportedVersions",get:function(){return[5]}},{key:"parse",value:function(e){var t=new DataView(e),r=3&t.getUint8(0);if(3!==r)return{header:{version:r},recordSet:null};var n,i=t.getUint32(4,!0),a=t.getUint16(8,!0),s=t.getUint16(10,!0),o={version:r,recordCount:i,headerByteCount:a,recordByteCount:s},l=32,u=[],c=[];if(3===r){for(;13!==t.getUint8(l);)n=String.fromCharCode(t.getUint8(l+11)).trim(),u.push({name:(0,P.r)(new Uint8Array(e,l,11)),type:n,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(n)],length:t.getUint8(l+16)}),l+=32;if(l+=1,u.length>0)for(var f=function(){var r=[];32===t.getUint8(l)?(l+=1,u.forEach((function(t){if("C"===t.type)r.push((0,P.r)(new Uint8Array(e,l,t.length)).trim());else if("N"===t.type)r.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,l,t.length)).trim(),10));else if("F"===t.type)r.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,l,t.length)).trim()));else if("D"===t.type){var n=String.fromCharCode.apply(null,new Uint8Array(e,l,t.length)).trim();r.push(new Date(parseInt(n.substring(0,4),10),parseInt(n.substring(4,6),10)-1,parseInt(n.substring(6,8),10)))}l+=t.length})),c.push(r)):l+=s};c.length<i&&e.byteLength-l>s;)f()}return{header:o,fields:u,records:c,recordSet:K({fields:u,records:c})}}}]),e}(),$=new Map;$.set("int16","esriFieldTypeSmallInteger"),$.set("int32","esriFieldTypeInteger"),$.set("int64","esriFieldTypeInteger"),$.set("float32","esriFieldTypeSingle"),$.set("float64","esriFieldTypeDouble"),$.set("text","esriFieldTypeString");var ee=function(e){(0,p.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,c.Z)(this,r),(e=t.apply(this,arguments)).storageInfo=null,e.datasetFormat="CRF",e}return(0,f.Z)(r,[{key:"open",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n,i,a,s,o;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return e.next=4,this.request(this.url+"/conf.json",{signal:null===t||void 0===t?void 0:t.signal});case 4:if(r=e.sent,n=r.data,this._validateHeader(n)){e.next=8;break}throw new d.a("cloudraster:open","Invalid or unsupported conf.json.");case 8:if(this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),i=this._parseHeader(n),a=i.storageInfo,"thematic"!==(s=i.rasterInfo).dataType){e.next=15;break}return e.next=13,this._fetchAuxiliaryInformation();case 13:o=e.sent,s.attributeTable=o;case 15:this._set("storageInfo",a),this._set("rasterInfo",s),this.ioConfig.retryCount=this.ioConfig.retryCount||0;case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n){var i,a,o,u,c,f,p,h,d,m,v,y,x,g,b,k=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=k.length>3&&void 0!==k[3]?k[3]:{},a=this.rasterInfo.storageInfo.transposeInfo,o=i.transposedVariableName,!((c=(u=!(!a||!o))?0:this.rasterInfo.storageInfo.maximumPyramidLevel-t)<0)){e.next=4;break}return e.abrupt("return",null);case 4:return f=this._buildCacheFilePath(c,r,n,i.multidimensionalDefinition,o),p=this._getIndexRecordFromBundle(r,n,u),e.next=8,this.request(f,{range:{from:0,to:this.storageInfo.headerSize-1},responseType:"array-buffer",signal:i.signal});case 8:if(h=e.sent){e.next=11;break}return e.abrupt("return",null);case 11:if(d=new Uint8Array(h.data),0!==(m=this._getTileEndAndContentType(d,p)).recordSize){e.next=14;break}return e.abrupt("return",null);case 14:return e.next=16,this.request(f,{range:{from:m.position,to:m.position+m.recordSize},responseType:"array-buffer",signal:i.signal});case 16:if(v=e.sent){e.next=19;break}return e.abrupt("return",null);case 19:return y=this._getTileSize(u),x=(0,s.Z)(y,2),g=x[0],b=x[1],e.abrupt("return",this.decodePixelBlock(v.data,{width:g,height:b,planes:null,pixelType:null,returnPixelInterleavedDims:u}));case 21:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_validateHeader",value:function(e){return e&&"RasterInfo"===e.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some((function(t){return!e[t]}))}},{key:"_parseHeader",value:function(e){var t,r,n=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][e.pixelType],i=e.bandCount,a=e.histograms,s=e.colormap,o=e.blockWidth,l=e.blockHeight,u=e.firstPyramidLevel,c=e.maximumPyramidLevel,f=e.statistics&&e.statistics.map((function(e){return{min:e.min,max:e.max,avg:e.mean,stddev:e.standardDeviation,median:e.median,mode:e.mode}})),p=e.extent.spatialReference,h=null===(t=e.geodataXform)||void 0===t?void 0:t.spatialReference,d=new k.k(null!==p&&void 0!==p&&p.wkid||null!==p&&void 0!==p&&p.wkt?p:h),m=new F.M({xmin:e.extent.xmin,ymin:e.extent.ymin,xmax:e.extent.xmax,ymax:e.extent.ymax,spatialReference:d}),v=new k.j({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:d}),y=Math.round((m.xmax-m.xmin)/v.x),x=Math.round((m.ymax-m.ymin)/v.y),g=this._parseTransform(e.geodataXform),b=g?m:null;g&&(m=g.forwardTransform(m),v.x=(m.xmax-m.xmin)/y,v.y=(m.ymax-m.ymin)/x);var w,I,S,R,T=null!==(r=e.properties)&&void 0!==r?r:{},Z=e.format.toLowerCase().replace("cache/",""),_=new k.j(e.origin.x,e.origin.y,d);if(s&&s.colors)for(w=[],I=0;I<s.colors.length;I++)S=s.colors[I],R=s.values?s.values[I]:I,w.push([R,255&S,S<<16>>>24,S<<8>>>24,S>>>24]);var M=e.LODInfos,O=[];for(I=0;I<M.levels.length;I++)O.push({level:M.levels[I],resolution:M.resolutions[I],scale:96/.0254*M.resolutions[I]});var B=new C.S({dpi:96,lods:O,format:Z,origin:_,size:[o,l],spatialReference:d}),D={recordSize:8,packetSize:e.packetSize,headerSize:e.packetSize*e.packetSize*8+64},z=[{maxCol:Math.ceil(y/o)-1,maxRow:Math.ceil(x/l)-1,minCol:0,minRow:0}],E=2;if(c>0)for(I=0;I<c;I++)z.push({maxCol:Math.ceil(y/E/o)-1,maxRow:Math.ceil(x/E/l)-1,minCol:0,minRow:0}),E*=2;var N=e.mdInfo,L=null;if(N&&T._yxs){var A=T._yxs;L={packetSize:A.PacketSize,tileSize:[A.TileXSize,A.TileYSize]}}return{storageInfo:D,rasterInfo:new P.l({width:y,height:x,pixelType:n,bandCount:i,extent:m,nativeExtent:b,transform:g,spatialReference:d,pixelSize:v,keyProperties:T,statistics:f,histograms:a,multidimensionalInfo:N,colormap:w,storageInfo:new P.p({blockWidth:o,blockHeight:l,pyramidBlockWidth:o,pyramidBlockHeight:l,origin:_,tileInfo:B,transposeInfo:L,firstPyramidLevel:u,maximumPyramidLevel:c,blockBoundary:z})})}}},{key:"_parseTransform",value:function(e){var t,r;if(!(0,W.f)(e))throw new d.a("cloudraster:open","the data contains unsupported geodata transform types");var n=(0,W.i)(e);if("identity"===n.type)return null;if("polynomial"!==n.type||null===(t=n.forwardCoefficients)||void 0===t||!t.length||null===(r=n.inverseCoefficients)||void 0===r||!r.length)throw new d.a("cloudraster:open","the data contains unsupported geodata transforms - both forward and inverse coefficients are required currently");return n}},{key:"_fetchAuxiliaryInformation",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n,i,a,s,o,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.request(this.url+"/conf.vat.json",{signal:t}).then((function(e){return e.data})).catch((function(){return null})),n=this.request(this.url+"/conf.vat.dbf",{responseType:"array-buffer",signal:t}).then((function(e){return e.data})).catch((function(){return null})),e.next=4,Promise.all([r,n]);case 4:return(i=e.sent)[0]&&(s=i[0].fields,o=i[0].values,s&&o&&(s=s.map((function(e){return{type:"OID"===e.name?"esriFieldTypeOID":$.get(e.type),name:e.name,alias:e.alias||e.name}})),u=o.map((function(e){return{attributes:e}})),s&&o&&(a={fields:s,features:u}))),!a&&i[1]&&(a=Q.parse(i[1]).recordSet),e.abrupt("return",G.default.fromJSON(a));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_buildCacheFilePath",value:function(e,t,r,n,i){var a=this._getPackageSize(!!i),s=Math.floor(t/a)*a,o=Math.floor(r/a)*a,l="R"+this._toHexString4(s)+"C"+this._toHexString4(o),u="L";u+=e>=10?e.toString():"0"+e.toString();var c=this.rasterInfo.multidimensionalInfo,f=null===n||void 0===n?void 0:n[0];if((0,y.t)(c)||!f)return"".concat(this.url,"/_alllayers/").concat(u,"/").concat(l,".bundle");var p="_yxs";if(!i){p=c.variables.find((function(e){return e.name===f.variableName})).dimensions[0].values.indexOf(f.values[0]).toString(16);for(var h=4-p.length,d=0;d<h;d++)p="0"+p;p="S"+p}var m=this._getVariableFolderName(i||f.variableName);return"".concat(this.url,"/_alllayers/").concat(m,"/").concat(p,"/").concat(u,"/").concat(l,".bundle")}},{key:"_getPackageSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.rasterInfo.storageInfo.transposeInfo;return e&&(0,y.r)(t)?t.packetSize:this.storageInfo.packetSize}},{key:"_getTileSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.rasterInfo.storageInfo,r=t.transposeInfo;return e&&(0,y.r)(r)?r.tileSize:t.tileInfo.size}},{key:"_getVariableFolderName",value:function(e){return""===(e=e.trim())?"_v":e.replace(/[\{|\}\-]/g,"_").replace("\\*","_v")}},{key:"_getIndexRecordFromBundle",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this._getPackageSize(r),i=n*(e%n)+t%n;if(i<0)throw"Invalid level / row / col";return 20+i*this.storageInfo.recordSize+44}},{key:"_getTileEndAndContentType",value:function(e,t){var r,n=e.subarray(t,t+8),i=0;for(r=0;r<5;r++)i|=(255&n[r])<<8*r;var a=0xffffffffff&i;for(i=0,r=5;r<8;r++)i|=(255&n[r])<<8*(r-5);return{position:a,recordSize:0xffffffffff&i}}},{key:"_toHexString4",value:function(e){var t=e.toString(16);if(4!==t.length)for(var r=4-t.length;r-- >0;)t="0"+t;return t}}]),r}(Y);(0,d.e)([(0,d.d)({readOnly:!0})],ee.prototype,"storageInfo",void 0),(0,d.e)([(0,d.d)({type:String,json:{write:!0}})],ee.prototype,"datasetFormat",void 0);var te=ee=(0,d.e)([(0,d.n)("esri.layers.support.rasterDatasets.CloudRaster")],ee),re=function(e){(0,p.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,c.Z)(this,r),(e=t.apply(this,arguments)).datasetFormat="MEMORY",e}return(0,f.Z)(r,[{key:"open",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n,i,a,s,o,u,c,f,p,h,d,m,v,y,x;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return n=this.data,i=n.pixelBlock,a=n.statistics,s=n.histograms,o=n.name,u=n.keyProperties,c=n.nativeExtent,f=n.transform,p=i.width,h=i.height,d=i.pixelType,m=this.data.extent||new F.M({xmin:-.5,ymin:.5,xmax:p-.5,ymax:h-.5,spatialReference:new k.k({wkid:3857})}),v=null!==(r=this.data.isPseudoSpatialReference)&&void 0!==r?r:!this.data.extent,y={x:m.width/p,y:m.height/h},x=new P.l({width:p,height:h,pixelType:d,extent:m,nativeExtent:c,transform:f,pixelSize:y,spatialReference:m.spatialReference,bandCount:3,keyProperties:u||{},statistics:a,isPseudoSpatialReference:v,histograms:s}),this.createRemoteDatasetStorageInfo(x,512,512),this._set("rasterInfo",x),this.updateTileInfo(),e.next=8,this._buildInMemoryRaster(i,{width:512,height:512},t);case 8:this.datasetName=o,this.url="/InMemory/"+o;case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(e,t,r){var n=this._pixelBlockTiles.get("".concat(e,"/").concat(t,"/").concat(r));return Promise.resolve(n)}},{key:"_buildInMemoryRaster",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n){var i,a,s,o,u,c,f,p;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.rasterInfo.storageInfo.maximumPyramidLevel,o=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:t,tileSize:r,maximumPyramidLevel:s},n):Promise.resolve((0,J.M)(t,r,s)),u=(0,y.r)(this.rasterInfo.statistics),c=(0,y.r)(this.rasterInfo.histograms),f=u?Promise.resolve({statistics:null,histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:t},n):Promise.resolve((0,P.m)(t)),e.next=7,(0,d.E)([o,f]);case 7:if((p=e.sent)[0].value||!p[1].value){e.next=10;break}throw new d.a("inmemory-raster:open","failed to build in memory raster");case 10:this._pixelBlockTiles=p[0].value,u||(this.rasterInfo.statistics=null===(i=p[1].value)||void 0===i?void 0:i.statistics),c||(this.rasterInfo.histograms=null===(a=p[1].value)||void 0===a?void 0:a.histograms);case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),r}(Y);(0,d.e)([(0,d.d)({type:String,json:{write:!0}})],re.prototype,"datasetFormat",void 0),(0,d.e)([(0,d.d)()],re.prototype,"data",void 0);var ne=re=(0,d.e)([(0,d.n)("esri.layers.support.rasterDatasets.InMemoryRaster")],re);function ie(e,t){if(!e||!t)return[];var r=t;t.includes("/")?(r=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var n=[];if(t){for(var i=ie(e,r),a=0;a<i.length;a++)ie(i[a],t).forEach((function(e){return n.push(e)}));return n}var s=e.getElementsByTagNameNS("*",r);if(!s||0===s.length)return[];for(var o=0;o<s.length;o++)n.push(s[o]||s.item[o]);return n}function ae(e,t){if(!e||!t)return null;var r=t;t.includes("/")?(r=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var n=ie(e,r);return n.length>0?t?ae(n[0],t):n[0]:null}function se(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=r?ae(e,r):e;return n?(t=n.textContent||n.nodeValue)?t.trim():null:null}function oe(e,t){return function(e,t){for(var r,n=ie(e,t),i=[],a=0;a<n.length;a++)(r=n[a].textContent||n[a].nodeValue)&&""!==(r=r.trim())&&i.push(r);return i}(e,t).map((function(e){return Number(e)}))}function le(e,t){var r=se(e,t);return Number(r)}function ue(e,t){var r,n=null===e||void 0===e||null===(r=e.nodeName)||void 0===r?void 0:r.toLowerCase(),i=t.toLowerCase();return n.slice(n.lastIndexOf(":")+1)===i}function ce(e,t){if(!e||!t)return null;for(var r=[],n=0;n<e.length;n++)r.push(e[n]),r.push(t[n]);return r}function fe(e){if(!e)return null;var t=Number(e);if(!isNaN(t)&&0!==t)return new k.k({wkid:t});if((e=String(e)).startsWith("COMPD_CS")){if(!e.includes("VERTCS")||!e.includes("GEOGCS")&&!e.startsWith("PROJCS"))return null;var r=e.indexOf("VERTCS"),n=e.indexOf("PROJCS"),i=n>-1?n:e.indexOf("GEOGCS");if(-1===i)return null;var a=e.slice(i,e.lastIndexOf("]",r)+1).trim(),s=e.slice(r,e.lastIndexOf("]")).trim();t=pe(a);var o=new k.k(t?{wkid:t}:{wkt:a}),l=pe(s);return l&&(o.vcsWkid=l),o}return e.startsWith("GEOGCS")||e.startsWith("PROJCS")?(t=pe(e),new k.k(0!==t?{wkid:t}:{wkt:e})):null}function pe(e){var t,r=e.replace(/\]/g,"[").replace(/\"/g,"").split("[").map((function(e){return e.trim()})).filter((function(e){return""!==e})),n=r[r.length-1].split(","),i=null===(t=n[0])||void 0===t?void 0:t.toLowerCase();if(("epsg"===i||"esri"===i)&&e.endsWith('"]]')){var a=Number(n[1]);if(!isNaN(a)&&0!==a)return a}return 0}function he(e){var t;if("pamdataset"!==(null===e||void 0===e||null===(t=e.documentElement.tagName)||void 0===t?void 0:t.toLowerCase()))return{};var r={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};e.documentElement.childNodes.forEach((function(e){if(1===e.nodeType)if(ue(e,"SRS")){if(!r.spatialReference){var t=se(e);r.spatialReference=fe(t)}}else if(ue(e,"Metadata"))if("xml:ESRI"===e.getAttribute("domain")){var n=function(e){var t,r=ae(e,"GeodataXform"),n=fe(le(r,"SpatialReference/WKID")||se(r,"SpatialReference/WKT"));if("typens:PolynomialXform"!==r.getAttribute("xsi:type"))return{spatialReference:n,transform:null};var i=null!==(t=le(r,"PolynomialOrder"))&&void 0!==t?t:1,a=oe(r,"CoeffX/Double"),s=oe(r,"CoeffY/Double"),o=oe(r,"InverseCoeffX/Double"),l=oe(r,"InverseCoeffY/Double"),u=ce(a,s),c=ce(o,l);return{spatialReference:n,transform:new W.m({spatialReference:n,polynomialOrder:i,forwardCoefficients:u,inverseCoefficients:c})}}(e),i=n.spatialReference,a=n.transform;r.transform=a,r.spatialReference||(r.spatialReference=i)}else ie(e,"MDI").forEach((function(e){return r.metadata[e.getAttribute("key")]=se(e)}));else if(ue(e,"PAMRasterBand")){var s=function(e){var t,r,n,i,a,s=le(e,"NoDataValue"),o=ae(e,"Histograms/HistItem"),l=le(o,"HistMin"),u=le(o,"HistMax"),c=le(o,"BucketCount"),f=null===(t=se(o,"HistCounts"))||void 0===t?void 0:t.split("|").map((function(e){return Number(e)}));ie(e,"Metadata/MDI").forEach((function(e){var t,s=Number(null!==(t=e.textContent)&&void 0!==t?t:e.nodeValue);switch(e.getAttribute("key").toUpperCase()){case"STATISTICS_MINIMUM":r=s;break;case"STATISTICS_MAXIMUM":n=s;break;case"STATISTICS_MEAN":i=s;break;case"STATISTICS_STDDEV":a=s}}));var p=le(e,"Metadata/SourceBandIndex");return{noDataValue:s,histogram:null!==f&&void 0!==f&&f.length&&null!=r&&null!=n?{min:l,max:u,size:c||f.length,counts:f}:null,sourceBandIndex:p,statistics:null!=r&&null!=n?{min:r,max:n,avg:i,stddev:a}:null}}(e);null!=s.sourceBandIndex&&null==r.rasterBands[s.sourceBandIndex]?r.rasterBands[s.sourceBandIndex]=s:r.rasterBands.push(s)}}));var n=r.rasterBands;if(n){var i=!!n[0].statistics;r.statistics=i?n.map((function(e){return e.statistics})):null;var a=!!n[0].histogram;r.histograms=a?n.map((function(e){return e.histogram})):null}return r}var de=function(e){(0,p.Z)(r,e);var t=(0,h.Z)(r);function r(){return(0,c.Z)(this,r),t.apply(this,arguments)}return(0,f.Z)(r,[{key:"open",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n,i,a,s,o,u,c,f,p,h,d,m;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return e.next=4,this._fetchData(t);case 4:return r=e.sent,e.next=7,this._fetchAuxiliaryData(t);case 7:return n=e.sent,i=n.spatialReference,a=n.statistics,s=n.histograms,o=n.transform,(u=!i)&&(i=new k.k({wkid:3857})),(null===s||void 0===s?void 0:s.length)&&null==a&&(a=(0,P.c)(s)),c=r.width,f=r.height,p=new F.M({xmin:-.5,ymin:.5-f,xmax:c-.5,ymax:.5,spatialReference:i}),h=o?o.forwardTransform(p):p,!0,o&&(d=o.forwardCoefficients,d&&0===d[1]&&0===d[2]&&(o=null,p=h)),m=new ne({data:{extent:h,nativeExtent:p,transform:o,pixelBlock:r,statistics:a,histograms:s,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:u}}),e.next=22,m.open();case 22:m.data=null,this._set("rasterInfo",m.rasterInfo),this._inMemoryRaster=m;case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._inMemoryRaster.fetchRawTile(e,t,r,n)}},{key:"_fetchData",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n,i,a,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request(this.url,{responseType:"array-buffer",signal:null===t||void 0===t?void 0:t.signal});case 2:if(r=e.sent,n=r.data,"JPG"===(i=(0,P.P)(n).toUpperCase())||"PNG"===i||"GIF"===i||"BMP"===i){e.next=7;break}throw new d.a("image-aux-raster:open","the data is not a supported format");case 7:return this._set("datasetFormat",i),a=i.toLowerCase(),s="gif"===a||"bmp"===a||!(0,y.a)("ios"),e.next=11,this.decodePixelBlock(n,{format:a,useCanvas:s,hasNoZlibMask:!0});case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchAuxiliaryData",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n,i,a,s,o,u,c,f,p,h;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,y.e)(null===t||void 0===t?void 0:t.signal),a=null!==(r=this.ioConfig.skipExtensions)&&void 0!==r?r:[],s=a.includes("aux.xml")?null:this.request(this.url+".aux.xml",{responseType:"xml",signal:i}),o=this.datasetFormat,u="JPG"===o?"jgw":"PNG"===o?"pgw":"BMP"===o?"bpw":null,c=a.includes(u)?null:this.request(this.url.slice(0,this.url.lastIndexOf("."))+"."+u,{responseType:"text",signal:i}),e.next=8,(0,d.E)([s,c]);case 8:if(f=e.sent,null===i||void 0===i||!i.aborted){e.next=11;break}throw(0,d.m)();case 11:return(p=he(null===(n=f[0].value)||void 0===n?void 0:n.data)).transform||(h=f[1].value?f[1].value.data.split("\n").slice(0,6).map((function(e){return Number(e)})):null,p.transform=6===(null===h||void 0===h?void 0:h.length)?new W.m({forwardCoefficients:[h[4],h[5],h[0],-h[1],h[2],-h[3]]}):null),e.abrupt("return",p);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(Y);(0,d.e)([(0,d.d)({type:String,json:{write:!0}})],de.prototype,"datasetFormat",void 0);var me=de=(0,d.e)([(0,d.n)("esri.layers.support.rasterDatasets.ImageAuxRaster")],de),ve=function(e){(0,p.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,c.Z)(this,r),(e=t.apply(this,arguments))._levelOffset=0,e._tilemapCache=null,e._slices=null,e.datasetFormat="RasterTileServer",e}return(0,f.Z)(r,[{key:"open",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n,i,a,o,u,c,f,p,h,m,v,x,g,b,k,w,I,S,T,Z,_,M,F,O;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:if(r=t&&t.signal,!this.sourceJSON){e.next=7;break}e.t0={data:this.sourceJSON},e.next=10;break;case 7:return e.next=9,this.request(this.url,{query:{f:"json"},signal:r});case 9:e.t0=e.sent;case 10:if((n=e.t0).ssl&&(this.url=this.url.replace(/^http:/i,"https:")),i=n.data,this.sourceJSON=i,i){e.next=15;break}throw new d.a("imageserverraster:open","cannot initialize tiled image service, missing service info");case 15:if(i.tileInfo){e.next=17;break}throw new d.a("imageserverraster:open","use ImageryLayer to open non-tiled image services");case 17:return this._fixScaleInServiceInfo(),a=["jpg","jpeg","png","png8","png24","png32","mixed"],this.tileType=i.cacheType,null==this.tileType&&(a.includes(i.tileInfo.format.toLowerCase())?this.tileType="Map":"lerc"===i.tileInfo.format.toLowerCase()?this.tileType="Elevation":this.tileType="Raster"),this.datasetName=i.name.slice(i.name.indexOf("/")+1),e.next=22,this._fetchRasterInfo({signal:r});case 22:if(o=e.sent,(0,y.r)(o)){e.next=25;break}throw new d.a("image-server-raster:open","cannot initialize image service");case 25:f="Map"===this.tileType?(0,U.n)(i.tileInfo,i):C.S.fromJSON(i.tileInfo),p=o.extent,h=o.pixelSize,m=.5/o.width*h.x,g=f.lodAt(Math.max.apply(null,f.lods.map((function(e){return e.level})))),"Map"!==this.tileType&&0!==i.maxScale&&("Raster"===this.tileType?(v=f.lods.find((function(e){return e.resolution===h.x})),v||(v=f.lods[f.lods.length-1])):(v=f.lods.find((function(e){return Math.abs(e.scale-i.maxScale)<m})),v||(v=f.lods.filter((function(e){return e.scale>i.maxScale})).sort((function(e,t){return e.scale>t.scale?1:-1}))[0])),h.x=h.y=v.resolution,o.width=Math.ceil((p.xmax-p.xmin)/h.x-.1),o.height=Math.ceil((p.ymax-p.ymin)/h.y-.1)),v||(v=g),b=f.lodAt(Math.min.apply(null,f.lods.map((function(e){return e.level})))),"Map"===this.tileType?this._levelOffset=f.lods[0].level:0!==i.minScale&&"Elevation"===this.tileType&&(x=f.lods.find((function(e){return Math.abs(e.scale-i.minScale)<m})),this._levelOffset=x.level-b.level),x||(x=b),k=Math.max(h.x,h.y),(Math.abs(h.x-h.y)>m||!f.lods.some((function(e){return Math.abs(e.resolution-k)<m})))&&(h.x=h.y=v.resolution,o.width=Math.ceil((p.xmax-p.xmin)/h.x-.1),o.height=Math.ceil((p.ymax-p.ymin)/h.y-.1)),w=v.level-x.level,I=(0,s.Z)(f.size,2),S=I[0],T=I[1],Z=[],f.lods.forEach((function(e){e.level>=x.level&&e.level<=v.level&&Z.push({x:e.resolution,y:e.resolution})})),Z.sort((function(e,t){return e.x-t.x})),_=this.computeBlockBoundary(p,S,T,f.origin,Z,w),M=Z.length>1?Z.slice(1):null,i.transposeInfo&&(F={tileSize:[i.transposeInfo.rows,i.transposeInfo.cols],packetSize:null!==(u=null===(c=o.keyProperties)||void 0===c?void 0:c._yxs.PacketSize)&&void 0!==u?u:0}),o.storageInfo=new P.p({blockWidth:f.size[0],blockHeight:f.size[1],pyramidBlockWidth:f.size[0],pyramidBlockHeight:f.size[1],pyramidResolutions:M,compression:f.format,origin:f.origin,firstPyramidLevel:1,maximumPyramidLevel:w,tileInfo:f,transposeInfo:F,blockBoundary:_}),this._fixGCSShift(o),this._set("rasterInfo",o),i.capabilities.toLowerCase().includes("tilemap")&&(O={tileInfo:o.storageInfo.tileInfo,parsedUrl:(0,R.j)(this.url),url:this.url,tileServers:[],type:"tile"},this._tilemapCache=new U.z({layer:O}));case 37:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n){var i,a,s,o,u,c,f,p,h,d,m,v,x,g,b,k,w,I,S,R,T,Z,_,C,M,P,F,O,B=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=B.length>3&&void 0!==B[3]?B[3]:{},a=this.rasterInfo,s=a.storageInfo,o=a.extent,u=s.transposeInfo,c=(0,y.r)(u)&&!!i.transposedVariableName,!this._slices||c||null!=i.sliceId){e.next=4;break}return e.abrupt("return",null);case 4:return f=c?0:s.maximumPyramidLevel-t+this._levelOffset,p="".concat(this.url,"/tile/").concat(f,"/").concat(r,"/").concat(n),h=this._slices?c?{variable:i.transposedVariableName}:{sliceId:i.sliceId||0}:null,e.next=9,this.request(p,{query:h,responseType:"array-buffer",signal:i.signal});case 9:if(d=e.sent,m=d.data){e.next=13;break}return e.abrupt("return",null);case 13:return v=c?u.tileSize:s.tileInfo.size,e.next=16,this.decodePixelBlock(m,{width:v[0],height:v[1],planes:null,pixelType:null,isPoint:"Elevation"===this.tileType,returnPixelInterleavedDims:c});case 16:if(x=e.sent,g=s.blockBoundary[t],!("jpg"!==s.compression||n>g.minCol&&n<g.maxCol&&r>g.minRow&&r<g.maxRow)){e.next=20;break}return e.abrupt("return",x);case 20:return b=s.origin,k=s.blockWidth,w=s.blockHeight,I=this.getPyramidPixelSize(t),S=I.x,R=I.y,T=Math.round((o.xmin-b.x)/S)%k,Z=Math.round((o.xmax-b.x)/S)%k||k,_=Math.round((b.y-o.ymax)/R)%w,C=Math.round((b.y-o.ymin)/R)%w||w,M=n===g.minCol?T:0,P=r===g.minRow?_:0,F=n===g.maxCol?Z:k,O=r===g.maxRow?C:w,e.abrupt("return",((0,J.x)(x,{x:M,y:P},{width:F-M,height:O-P}),x));case 22:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getSliceIndex",value:function(e){if(!this._slices||(0,y.t)(e)||0===e.length)return null;for(var t=e,r=0;r<this._slices.length;r++){var n=this._slices[r].multidimensionalDefinition;if(n.length===t.length&&!n.some((function(e){var r=t.find((function(t){return e.variableName===t.variableName&&t.dimensionName===e.dimensionName}));return!r||(Array.isArray(e.values[0])?"".concat(e.values[0][0],"-").concat(e.values[0][1]):e.values[0])!==(Array.isArray(r.values[0])?"".concat(r.values[0][0],"-").concat(r.values[0][1]):r.values[0])})))return r}return null}},{key:"fetchVariableStatisticsHistograms",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r){var n,i,a;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.request(this.url+"/statistics",{query:{variable:t,f:"json"},signal:r}).then((function(e){var t;return null===(t=e.data)||void 0===t?void 0:t.statistics})),i=this.request(this.url+"/histograms",{query:{variable:t,f:"json"},signal:r}).then((function(e){var t;return null===(t=e.data)||void 0===t?void 0:t.histograms})),e.next=4,Promise.all([n,i]);case 4:return a=e.sent,e.abrupt("return",(a[0]&&a[0].forEach((function(e){e.avg=e.mean,e.stddev=e.standardDeviation})),{statistics:a[0]||null,histograms:a[1]||null}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"computeBestPyramidLevelForLocation",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n,i,a,s,o,u=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=u.length>1&&void 0!==u[1]?u[1]:{},this._tilemapCache){e.next=3;break}return e.abrupt("return",0);case 3:if(null!==(n=this.identifyPixelLocation(t,0,(0,y.e)(r.datumTransformation)))){e.next=6;break}return e.abrupt("return",null);case 6:i=0,a=this.rasterInfo.storageInfo.maximumPyramidLevel,s=a-i+this._levelOffset,o=n.srcLocation;case 10:if(!(s>=0)){e.next=25;break}return e.prev=11,e.next=14,this._tilemapCache.fetchAvailability(s,n.row,n.col,r);case 14:if(e.t0=e.sent,"available"!==e.t0){e.next=17;break}return e.abrupt("break",25);case 17:e.next=21;break;case 19:e.prev=19,e.t1=e.catch(11);case 21:if(s--,i++,null!==(n=this.identifyPixelLocation(o,i,(0,y.e)(r.datumTransformation)))){e.next=23;break}return e.abrupt("return",null);case 23:e.next=10;break;case 25:return e.abrupt("return",-1===s||null==n?null:i);case 26:case"end":return e.stop()}}),e,this,[[11,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchRasterInfo",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n,i,a,s,o,u,c,f;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.sourceJSON,"Map"!==this.tileType){e.next=4;break}return n=Math.ceil((r.extent.xmax-r.extent.xmin)/r.pixelSizeX-.1),i=Math.ceil((r.extent.ymax-r.extent.ymin)/r.pixelSizeY-.1),a=k.k.fromJSON(r.spatialReference||r.extent.spatialReference),s=new k.j({x:r.pixelSizeX,y:r.pixelSizeY,spatialReference:a}),e.abrupt("return",new P.l({width:n,height:i,bandCount:3,extent:F.M.fromJSON(r.extent),spatialReference:a,pixelSize:s,pixelType:"u8",statistics:null,keyProperties:{DataType:"processed"}}));case 4:return o=t.signal,u=(0,v.m)(this.url,this.sourceJSON,{signal:o,query:this.ioConfig.customFetchParameters}),c=r.hasMultidimensions?this.request("".concat(this.url,"/slices"),{query:{f:"json"},signal:o}).then((function(e){return e.data&&e.data.slices})).catch((function(){return null})):null,e.next=9,Promise.all([u,c]);case 9:return f=e.sent,e.abrupt("return",(this._slices=f[1],f[0]));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fixScaleInServiceInfo",value:function(){var e=this.sourceJSON;e.minScale&&e.minScale<0&&(e.minScale=0),e.maxScale&&e.maxScale<0&&(e.maxScale=0)}},{key:"_fixGCSShift",value:function(e){var t=e.extent,r=e.spatialReference;0===t.xmin&&360===t.xmax&&r.wkid&&r.isGeographic&&(e.nativeExtent=e.extent,e.transform=new W.c,e.extent=e.transform.forwardTransform(t))}}]),r}(Y);(0,d.e)([(0,d.d)({type:String,json:{write:!0}})],ve.prototype,"datasetFormat",void 0),(0,d.e)([(0,d.d)()],ve.prototype,"tileType",void 0);var ye=ve=(0,d.e)([(0,d.n)("esri.layers.support.rasterDatasets.ImageServerRaster")],ve),xe=new Map;xe.set("Int8","s8"),xe.set("UInt8","u8"),xe.set("Int16","s16"),xe.set("UInt16","u16"),xe.set("Int32","s32"),xe.set("UInt32","u32"),xe.set("Float32","f32"),xe.set("Float64","f32"),xe.set("Double64","f32");var ge=new Map;ge.set("none",{blobExtension:".til",isOneSegment:!0,decoderFormat:"bip"}),ge.set("lerc",{blobExtension:".lrc",isOneSegment:!1,decoderFormat:"lerc"}),ge.set("deflate",{blobExtension:".pzp",isOneSegment:!0,decoderFormat:"deflate"}),ge.set("jpeg",{blobExtension:".pjg",isOneSegment:!0,decoderFormat:"jpg"});var be=function(e){(0,p.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,c.Z)(this,r),(e=t.apply(this,arguments))._files=null,e._storageIndex=null,e.datasetFormat="MRF",e}return(0,f.Z)(r,[{key:"open",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n,i,a,s,o,u,c,f,p,h,d,m,v,x,g,b,k,w,I,S,R;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),n=t?(0,y.e)(t.signal):null,e.next=6,this.request(this.url,{responseType:"xml",signal:n});case 6:if(i=e.sent,a=this._parseHeader(i.data),s=a.rasterInfo,o=a.files,-1!==(null===(r=this.ioConfig.skipExtensions)||void 0===r?void 0:r.indexOf("aux.xml"))){e.next=15;break}return e.next=13,this._fetchAuxiliaryData(t);case 13:null!=(c=e.sent)&&(s.statistics=null!==(u=c.statistics)&&void 0!==u?u:s.statistics,s.histograms=c.histograms,c.histograms&&(0,y.t)(s.statistics)&&(s.statistics=(0,P.c)(c.histograms)));case 15:return this._set("rasterInfo",s),this._files=o,e.next=18,this.request(o.index,{responseType:"array-buffer",signal:n});case 18:for(f=e.sent,this._storageIndex=this._parseIndex(f.data),p=this.rasterInfo.storageInfo,h=p.blockWidth,d=p.blockHeight,m=this.rasterInfo.storageInfo.pyramidScalingFactor,v=this.rasterInfo,x=v.width,g=v.height,b=[],k=this._getBandSegmentCount(),w=0,I=-1;w<this._storageIndex.length;)I++,S=Math.ceil(x/h/Math.pow(m,I))-1,R=Math.ceil(g/d/Math.pow(m,I))-1,w+=(S+1)*(R+1)*k*4,b.push({maxRow:R,maxCol:S,minCol:0,minRow:0});this.rasterInfo.storageInfo.blockBoundary=b,I>0&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=I),this.updateTileInfo();case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n){var i,a,s,o,u,c,f,p,h,d,m,v,x,g,b,k,w,I,S,R,T,Z,_,C,M,P,F,O,B,D,z=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=z.length>3&&void 0!==z[3]?z[3]:{},a=this.rasterInfo.storageInfo,s=a.blockWidth,o=a.blockHeight,u=a.blockBoundary,!(!(c=u[t])||c.maxRow<r||c.maxCol<n||c.minRow>r||c.minCol>n)){e.next=4;break}return e.abrupt("return",null);case 4:if(f=this.rasterInfo,p=f.bandCount,h=f.pixelType,d=this._getTileLocation(t,r,n),m=d.ranges,v=d.actualTileWidth,x=d.actualTileHeight,m&&0!==m.length){e.next=7;break}return e.abrupt("return",null);case 7:if(0!==m[0].from||0!==m[0].to){e.next=10;break}return g=new Uint8Array(s*o),e.abrupt("return",new J.u({width:s,height:o,pixels:null,mask:g,validPixelCount:0}));case 10:for(b=this.ioConfig.bandIds,k=this._getBandSegmentCount(),w=[],I=0,I=0;I<k;I++)(!b||b.indexOf[I]>-1)&&w.push(this.request(this._files.data,{range:{from:m[I].from,to:m[I].to},responseType:"array-buffer",signal:i.signal}));return e.next=15,Promise.all(w);case 15:for(S=e.sent,R=S.map((function(e){return e.data.byteLength})).reduce((function(e,t){return e+t})),T=new Uint8Array(R),Z=0,I=0;I<k;I++)T.set(new Uint8Array(S[I].data),Z),Z+=S[I].data.byteLength;return _=ge.get(this.rasterInfo.storageInfo.compression).decoderFormat,e.next=23,this.decodePixelBlock(T.buffer,{width:s,height:o,format:_,planes:(null===b||void 0===b?void 0:b.length)||p,pixelType:h});case 23:if(C=e.sent,(0,y.r)(this.rasterInfo.noDataValue)&&"lerc"!==_&&!C.mask&&null!=(M=this.rasterInfo.noDataValue[0])){if(P=C.width*C.height,F=new Uint8Array(P),Math.abs(M)>1e24)for(I=0;I<P;I++)Math.abs((C.pixels[0][I]-M)/M)>1e-6&&(F[I]=1);else for(I=0;I<P;I++)C.pixels[0][I]!==M&&(F[I]=1);C.mask=F}if(O=0,B=0,v!==s||x!==o)if(D=C.mask)for(I=0;I<o;I++)if(B=I*s,I<x)for(O=v;O<s;O++)D[B+O]=0;else for(O=0;O<s;O++)D[B+O]=0;else for(D=new Uint8Array(s*o),C.mask=D,I=0;I<x;I++)for(B=I*s,O=0;O<v;O++)D[B+O]=1;return e.abrupt("return",C);case 28:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_parseIndex",value:function(e){if(e.byteLength%16>0)throw"invalid array buffer must be multiples of 16";var t,r,n,i,a,s;if(P.a){for(r=new Uint8Array(e),i=new ArrayBuffer(e.byteLength),n=new Uint8Array(i),a=0;a<e.byteLength/4;a++)for(s=0;s<4;s++)n[4*a+s]=r[4*a+3-s];t=new Uint32Array(i)}else t=new Uint32Array(e);return t}},{key:"_getBandSegmentCount",value:function(){return ge.get(this.rasterInfo.storageInfo.compression).isOneSegment?1:this.rasterInfo.bandCount}},{key:"_getTileLocation",value:function(e,t,r){var n,i,a,s=this.rasterInfo.storageInfo,o=s.blockWidth,l=s.blockHeight,u=s.pyramidScalingFactor,c=this.rasterInfo,f=c.width,p=c.height,h=this._getBandSegmentCount(),d=0,m=0;for(a=0;a<e;a++)m=Math.pow(u,a),d+=(n=Math.ceil(f/o/m))*(i=Math.ceil(p/l/m));m=Math.pow(u,e),n=Math.ceil(f/o/m),i=Math.ceil(p/l/m),d+=t*n+r,d*=4*h;for(var v=this._storageIndex.subarray(d,d+4*h),y=0,x=0,g=[],b=0;b<h;b++)x=(y=v[4*b+0]*Math.pow(2,32)+v[4*b+1])+v[4*b+2]*Math.pow(2,32)+v[4*b+3],g.push({from:y,to:x});return{ranges:g,actualTileWidth:r<n-1?o:Math.ceil(f/m)-o*(n-1),actualTileHeight:t<i-1?l:Math.ceil(p/m)-l*(i-1)}}},{key:"_parseHeader",value:function(e){var t=ae(e,"MRF_META/Raster");if(!t)throw new d.a("mrf:open","not a valid MRF format");var r=ae(t,"Size"),n=parseInt(r.getAttribute("x"),10),i=parseInt(r.getAttribute("y"),10),a=parseInt(r.getAttribute("c"),10),s=(se(t,"Compression")||"none").toLowerCase();if(!ge.has(s))throw new d.a("mrf:open","currently does not support compression "+s);var o=se(t,"DataType")||"UInt8",l=xe.get(o);if(null==l)throw new d.a("mrf:open","currently does not support pixel type "+o);var u,c,f=ae(t,"PageSize"),p=parseInt(f.getAttribute("x"),10),h=parseInt(f.getAttribute("y"),10),m=ae(t,"DataValues");if(m&&(null!=(c=m.getAttribute("NoData"))&&(u=c.trim().split(" ").map((function(e){return parseFloat(e)})))),ae(e,"MRF_META/CachedSource"))throw new d.a("mrf:open","currently does not support MRF referencing other data files");var v,y=ae(e,"MRF_META/GeoTags"),x=ae(y,"BoundingBox"),g=!1;if(null!=x){var b,w=parseFloat(x.getAttribute("minx")),I=parseFloat(x.getAttribute("miny")),S=parseFloat(x.getAttribute("maxx")),R=parseFloat(x.getAttribute("maxy")),T=se(y,"Projection")||"";if("LOCAL_CS[]"!==T)if(T.toLowerCase().startsWith("epsg:")){var Z=Number(T.slice(5));isNaN(Z)||0===Z||(b=new k.k({wkid:Z}))}else b=fe(T);else g=!0,b=new k.k({wkid:3857});(v=new F.M(w,I,S,R)).spatialReference=b}else g=!0,v=new F.M({xmin:-.5,ymin:.5-i,xmax:n-.5,ymax:.5,spatialReference:new k.k({wkid:3857})});var _=ae(e,"MRF_META/Rsets"),C=parseInt(_&&_.getAttribute("scale")||"2",10),M=v.spatialReference,O=new P.p({origin:new k.j({x:v.xmin,y:v.ymax,spatialReference:M}),blockWidth:p,blockHeight:h,pyramidBlockWidth:p,pyramidBlockHeight:h,compression:s,pyramidScalingFactor:C}),B=new k.j({x:v.width/n,y:v.height/i,spatialReference:M}),D=new P.l({width:n,height:i,extent:v,isPseudoSpatialReference:g,spatialReference:M,bandCount:a,pixelType:l,pixelSize:B,noDataValue:u,storageInfo:O}),z=se(e,"datafile"),E=se(e,"IndexFile");return{rasterInfo:D,files:{mrf:this.url,index:E||this.url.replace(".mrf",".idx"),data:z||this.url.replace(".mrf",ge.get(s).blobExtension)}}}},{key:"_fetchAuxiliaryData",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request(this.url+".aux.xml",{responseType:"xml",signal:null===t||void 0===t?void 0:t.signal});case 3:return r=e.sent,n=r.data,e.abrupt("return",he(n));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(Y);(0,d.e)([(0,d.d)()],be.prototype,"_files",void 0),(0,d.e)([(0,d.d)()],be.prototype,"_storageIndex",void 0),(0,d.e)([(0,d.d)({type:String,json:{write:!0}})],be.prototype,"datasetFormat",void 0);var ke=be=(0,d.e)([(0,d.n)("esri.layers.support.rasterIO.MRFRaster")],be),we=function(e,t){var r=e.get(t);return r&&r.values},Ie=function(e,t){var r=e.get(t);return r&&r.values[0]},Se=function(e){(0,p.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,c.Z)(this,r),(e=t.apply(this,arguments))._files=null,e._headerInfo=null,e._bufferSize=1048576,e.datasetFormat="TIFF",e}return(0,f.Z)(r,[{key:"open",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n,i,a,s,u,c,f,p,h,m,v,x,g,b,w,I,S,R,T,Z,_,C,M,O,B,D,z,E,N,L,A,H,J,j,G,U,q;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return a=t?(0,y.e)(t.signal):null,e.next=5,this.request(this.url,{range:{from:0,to:this._bufferSize},responseType:"array-buffer",signal:a});case 5:if(s=e.sent,u=s.data){e.next=9;break}throw new d.a("tiffraster:open","failed to open url "+this.url);case 9:return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),c=(0,P.N)(u),f=c.littleEndian,p=c.firstIFD,h=c.isBigTiff,m=[],e.next=13,this._readIFDs(m,u,f,p,0,h?8:4,a);case 13:if(v=(0,P.b)(m),x=v.width,g=v.height,b=v.tileWidth,w=v.tileHeight,I=v.planes,S=v.pixelType,R=v.compression,T=v.firstPyramidLevel,Z=v.maximumPyramidLevel,_=v.pyramidBlockWidth,C=v.pyramidBlockHeight,M=v.tileBoundary,O=v.affine,B=v.metadata,D=(null===(r=v.extent.spatialReference)||void 0===r?void 0:r.wkt)||(null===(n=v.extent.spatialReference)||void 0===n?void 0:n.wkid),z=fe(D),E=!1,null==z&&(E=!0,z=new k.k({wkid:3857})),N=new F.M((0,o.Z)((0,o.Z)({},v.extent),{},{spatialReference:z})),L=new k.j(N?{x:N.xmin,y:N.ymax,spatialReference:z}:{x:0,y:0}),A=new P.p({blockWidth:b,blockHeight:w,pyramidBlockWidth:_,pyramidBlockHeight:C,compression:R,origin:L,firstPyramidLevel:T,maximumPyramidLevel:Z,blockBoundary:M}),H=new k.j({x:(N.xmax-N.xmin)/x,y:(N.ymax-N.ymin)/g,spatialReference:z}),J=B?{BandProperties:B.bandProperties,DataType:B.dataType}:{},j=new P.l({width:x,height:g,bandCount:I,pixelType:S,compression:R,pixelSize:H,storageInfo:A,spatialReference:z,isPseudoSpatialReference:E,keyProperties:J,extent:N,statistics:B?B.statistics:null}),null!==O&&void 0!==O&&O.length&&(j.nativeExtent=new F.M({xmin:-.5,ymin:.5-g,xmax:x-.5,ymax:.5,spatialReference:z}),j.transform=new W.m({polynomialOrder:1,forwardCoefficients:[O[2]+O[0]/2,O[5]-O[3]/2,O[0],O[3],-O[1],-O[4]]}),j.extent=j.transform.forwardTransform(j.nativeExtent),j.pixelSize=new k.j({x:(N.xmax-N.xmin)/x,y:(N.ymax-N.ymin)/g,spatialReference:z}),A.origin.x=-.5,A.origin.y=.5),null!==(i=this.ioConfig.skipExtensions)&&void 0!==i&&i.includes("aux.xml")){e.next=22;break}return e.next=20,this._fetchAuxiliaryData(t);case 20:null!=(G=e.sent)&&(j.statistics=null!==(U=G.statistics)&&void 0!==U?U:j.statistics,j.histograms=G.histograms,G.histograms&&(0,y.t)(j.statistics)&&(j.statistics=(0,P.c)(G.histograms)),G.transform&&!O&&(j.transform=G.transform,j.nativeExtent=j.extent,q=j.transform.forwardTransform(j.nativeExtent),j.pixelSize=new k.j({x:(q.xmax-q.xmin)/x,y:(q.ymax-q.ymin)/g,spatialReference:z}),j.extent=q),j.spatialReference||(j.spatialReference=G.spatialReference));case 22:if(this._set("rasterInfo",j),this._headerInfo=(0,o.Z)({littleEndian:f,isBigTiff:h,ifds:m},v),this._headerInfo.isSupported){e.next=24;break}throw new d.a("tiffraster:open","this tiff is not supported: "+this._headerInfo.message);case 24:this.updateTileInfo();case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n){var i,a,s,o,u,c,f,p,h,d,m,v,y,x,g,b,k,w,I,S,R,T,Z,_,C,M=this,P=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=P.length>3&&void 0!==P[3]?P[3]:{},null!==(i=this._headerInfo)&&void 0!==i&&i.isSupported&&!this.isBlockOutside(t,r,n)){e.next=3;break}return e.abrupt("return",null);case 3:if(s=this._getTileLocation(t,r,n)){e.next=6;break}return e.abrupt("return",null);case 6:return o=s.ranges,u=s.actualTileWidth,c=s.actualTileHeight,f=s.ifd,p=o.map((function(e){return M.request(M.url,{range:e,responseType:"array-buffer",signal:a.signal})})),e.next=13,Promise.all(p);case 13:if(h=e.sent,d=h.map((function(e){return e.data.byteLength})).reduce((function(e,t){return e+t})),m=1===h.length?h[0].data:new ArrayBuffer(d),v=[0],y=[0],h.length>1)for(x=new Uint8Array(m),g=0,b=0;g<h.length;g++)k=h[g].data,x.set(new Uint8Array(k),b),v[g]=b,b+=k.byteLength,y[g]=k.byteLength;return w=this.getBlockWidthHeight(t),I=w.blockWidth,S=w.blockHeight,e.next=24,this.decodePixelBlock(m,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:f,offsets:v,sizes:y},width:I,height:S,planes:null,pixelType:null});case 24:if(R=e.sent,u!==I||c!==S)if(C=R.mask)for(T=0;T<S;T++)if(_=T*I,T<c)for(Z=u;Z<I;Z++)C[_+Z]=0;else for(Z=0;Z<I;Z++)C[_+Z]=0;else for(C=new Uint8Array(I*S),R.mask=C,T=0;T<c;T++)for(_=T*I,Z=0;Z<u;Z++)C[_+Z]=1;return e.abrupt("return",R);case 27:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_readIFDs",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n,i,a){var s,o,u,c=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=c.length>5&&void 0!==c[5]?c[5]:4,o=c.length>6?c[6]:void 0,i){e.next=4;break}return e.abrupt("return",null);case 4:if(!(i>=r.byteLength||i<0)){e.next=10;break}return e.next=7,this.request(this.url,{range:{from:i+a,to:i+a+this._bufferSize},responseType:"array-buffer",signal:o});case 7:r=e.sent.data,a=i+a,i=0;case 10:return e.next=12,this._readIFD(r,n,i,a,P.n.TIFF_TAGS,s,o);case 12:if(u=e.sent,t.push(u.ifd),u.nextIFD){e.next=15;break}return e.abrupt("return",null);case 15:return e.next=17,this._readIFDs(t,r,n,u.nextIFD-a,a,s,o);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"_readIFD",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n,i){var a,s,o,u,c,f,p,h,d,m,v,y,x,g,b=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=b.length>4&&void 0!==b[4]?b[4]:P.n.TIFF_TAGS,s=b.length>5&&void 0!==b[5]?b[5]:4,o=b.length>6?b[6]:void 0,t){e.next=5;break}return e.abrupt("return",null);case 5:if(!(u=(0,P.k)(t,r,n,i,a,s)).success){e.next=25;break}if(c=[],u.ifd.forEach((function(e){e.values||c.push(e)})),!(c.length>0)){e.next=16;break}if(f=c.map((function(e){return e.offlineOffsetSize})),p=Math.min.apply(null,f.map((function(e){return e[0]}))),!(Math.min.apply(null,f.map((function(e){return e[0]+e[1]})))-p<=this._bufferSize)){e.next=16;break}return e.next=13,this.request(this.url,{range:{from:p,to:p+this._bufferSize},responseType:"array-buffer",signal:o});case 13:h=e.sent,d=h.data,t=d,i=p,c.forEach((function(e){return(0,P.x)(t,r,e,i)}));case 16:if(!u.ifd.has("GEOKEYDIRECTORY")){e.next=24;break}if(m=u.ifd.get("GEOKEYDIRECTORY"),!((v=m.values)&&v.length>4)){e.next=24;break}return y=v[0]+"."+v[1]+"."+v[2],e.next=22,this._readIFD(t,r,m.valueOffset+6-i,i,P.n.GEO_KEYS,2,o);case 22:x=e.sent,m.data=x.ifd,m.data&&m.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[y]});case 24:return e.abrupt("return",u);case 25:if(!u.requiredBufferSize||u.requiredBufferSize===t.byteLength){e.next=30;break}return e.next=28,this.request(this.url,{range:{from:i,to:i+u.requiredBufferSize+4},responseType:"array-buffer",signal:o});case 28:return g=e.sent,e.abrupt("return",(t=g.data).byteLength<u.requiredBufferSize?null:this._readIFD(t,r,0,i,P.n.TIFF_TAGS,4,o));case 30:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_getTileLocation",value:function(e,t,r){var n=this.rasterInfo.storageInfo,i=n.firstPyramidLevel,a=n.blockBoundary,s=0===e?0:e-(i-1),o=this._headerInfo.ifds[s];if(!o)return null;var l=(0,P.D)(o,this._headerInfo),u=we(o,"TILEOFFSETS");if(void 0===u)return null;var c=we(o,"TILEBYTECOUNTS"),f=a[s],p=f.minRow,h=f.minCol,d=f.maxRow,m=f.maxCol;if(t>d||r>m||t<p||r<h)return null;var v=Ie(o,"IMAGEWIDTH"),y=Ie(o,"IMAGELENGTH"),x=Ie(o,"TILEWIDTH"),g=Ie(o,"TILELENGTH"),b=l?this.rasterInfo.bandCount:1,k=b*t*(m+1)+r,w=[{from:u[k],to:u[k+b-1]+c[k+b-1]-1}];if(l){for(var I=!0,S=0;S<b;S++)if(u[k+S]+c[k+S]!==u[k+S+1]){I=!1;break}if(!I)for(var R=0;R<b;R++)w[R]={from:u[k+R],to:u[k+R]+c[k+R]-1}}var T=u[k],Z=c[k];return null==T||null==Z?null:{ranges:w,ifd:o,actualTileWidth:r===m?v%x:x,actualTileHeight:t===d?y%g:g}}},{key:"_fetchAuxiliaryData",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request(this.url+".aux.xml",{responseType:"xml",signal:null===t||void 0===t?void 0:t.signal});case 3:return r=e.sent,n=r.data,e.abrupt("return",he(n));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(Y);(0,d.e)([(0,d.d)()],Se.prototype,"_files",void 0),(0,d.e)([(0,d.d)()],Se.prototype,"_headerInfo",void 0),(0,d.e)([(0,d.d)()],Se.prototype,"_bufferSize",void 0),(0,d.e)([(0,d.d)({type:String,json:{write:!0}})],Se.prototype,"datasetFormat",void 0);var Re=Se=(0,d.e)([(0,d.n)("esri.layers.support.rasterDatasets.TIFFRaster")],Se),Te=new Map;Te.set("CRF",{desc:"Cloud Raster Format",constructor:te}),Te.set("MRF",{desc:"Meta Raster Format",constructor:ke}),Te.set("TIFF",{desc:"GeoTIFF",constructor:Re}),Te.set("RasterTileServer",{desc:"Raster Tile Server",constructor:ye}),Te.set("JPG",{desc:"JPG Raster Format",constructor:me}),Te.set("PNG",{desc:"PNG Raster Format",constructor:me}),Te.set("GIF",{desc:"GIF Raster Format",constructor:me}),Te.set("BMP",{desc:"BMP Raster Format",constructor:me});var Ze=function(){function e(){(0,c.Z)(this,e)}return(0,f.Z)(e,null,[{key:"supportedFormats",get:function(){var e=new Set;return Te.forEach((function(t,r){return e.add(r)})),e}},{key:"open",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n,i,a,s,o,u,c,f,p;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.url,n=t.ioConfig,i=t.sourceJSON,null==(a=t.datasetFormat)&&r.lastIndexOf(".")&&(a=r.slice(r.lastIndexOf(".")+1).toUpperCase()),"OVR"===a||"TIF"===a?a="TIFF":"JPG"!==a&&"JPEG"!==a&&"JFIF"!==a||(a="JPG"),r.toLowerCase().includes("/imageserver")&&!r.toLowerCase().includes("/wcsserver")&&(a="RasterTileServer"),s={url:r,sourceJSON:i,datasetFormat:a,ioConfig:n||{bandIds:null,sampling:null}},!this.supportedFormats.has(a)){e.next=12;break}if("CRF"!==a||n.enableCRF){e.next=7;break}throw new d.a("rasterfactory:open","cannot open raster: ".concat(r));case 7:return o=Te.get(a).constructor,u=new o(s),e.next=11,u.open({signal:t.signal});case 11:return e.abrupt("return",u);case 12:if(!a){e.next=14;break}throw new d.a("rasterfactory:open","not a supported format "+a);case 14:return c=Array.from(Te.keys()),f=0,p=function e(){return(a=c[f++])&&("CRF"!==a||n.enableCRF)?(o=Te.get(a).constructor,(u=new o(s)).open({signal:t.signal}).then((function(){return u})).catch((function(){return e()}))):null},e.abrupt("return",p());case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"register",value:function(e,t,r){Te.has(e.toUpperCase())||Te.set(e.toUpperCase(),{desc:t,constructor:r})}}]),e}(),_e=function(e){(0,p.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;(0,c.Z)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).bandIds=null,e.interpolation=null,e.legendEnabled=!0,e.isReference=null,e.listMode="show",e.sourceJSON=null,e.version=null,e.title=null,e.type="imagery-tile",e.operationalLayerType="ArcGISTiledImageServiceLayer",e.popupEnabled=!0,e.popupTemplate=null,e.fields=null,e}return(0,f.Z)(r,[{key:"normalizeCtorArgs",value:function(e,t){return"string"==typeof e?(0,o.Z)({url:e},t):e}},{key:"load",value:function(e){var t=this,r=(0,y.r)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},e).catch(d.M).then((function(){return t._openRaster(r)}))),Promise.resolve(this)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"rasterFields",get:function(){var e,t,r=[new N.y({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})],n=null===(e=this.rasterInfo)||void 0===e||null===(t=e.attributeTable)||void 0===t?void 0:t.fields;if(n){var i=n.filter((function(e){return"oid"!==e.type&&"value"!==e.name.toLowerCase()})).map((function(e){var t=e.clone();return t.name="Raster."+e.name,t}));r=r.concat(i)}var a=this.rasterInfo.dataType;if(("vector-magdir"===a||"vector-uv"===a)&&(0,y.r)(this.rasterInfo.multidimensionalInfo)){var s,o=null===(s=this.rasterInfo.multidimensionalInfo.variables[0].unit)||void 0===s?void 0:s.trim(),l="Magnitude"+(o?" (".concat(o,")"):"");r.push(new N.y({name:"Raster.Magnitude",alias:l,domain:null,editable:!1,type:"double"})),r.push(new N.y({name:"Raster.Direction",alias:"Direction (\xb0)",domain:null,editable:!1,type:"double"}))}return r}},{key:"renderer",set:function(e){this._set("renderer",e),this.updateRenderer()}},{key:"readRenderer",value:function(e,t,r){var n=t&&t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.renderer,i=(0,v.u)(n,r)||void 0;if(null!=i)return i}},{key:"createPopupTemplate",value:function(e){return(0,q.d)({fields:this.rasterFields,title:this.title},e)}},{key:"write",value:function(e,t){var a=this.raster;if(this.loaded?"RasterTileServer"===a.datasetFormat&&("Raster"===a.tileType||"Map"===a.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))return(0,n.Z)((0,i.Z)(r.prototype),"write",this).call(this,e,t);if(t&&t.messages){var s="".concat(t.origin,"/").concat(t.layerContainerType||"operational-layers");t.messages.push(new d.a("layer:unsupported","Layers (".concat(this.title,", ").concat(this.id,") of type '").concat(this.declaredClass,"' are not supported in the context of '").concat(s,"'"),{layer:this}))}return null}},{key:"_openRaster",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n=this;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.raster){e.next=8;break}if(e.t0=this.raster.rasterInfo,e.t0){e.next=5;break}return e.next=5,this.raster.open();case 5:this.url=this.raster.url,e.next=11;break;case 8:return e.next=10,Ze.open({url:this.url,sourceJSON:this.sourceJSON,ioConfig:(0,o.Z)((0,o.Z)({sampling:"closest"},this.ioConfig),{},{customFetchParameters:this.customParameters}),signal:t});case 10:this.raster=e.sent;case 11:if(this.raster.rasterInfo){e.next=14;break}throw new d.a("imagery-tile-layer:load","cannot load resources on "+this.url);case 14:this.sourceJSON=this.sourceJSON||this.raster.sourceJSON,null!=this.sourceJSON&&(r="Map"===this.raster.tileType&&null!=this.sourceJSON.minLOD&&null!=this.sourceJSON.maxLOD?this.sourceJSON:(0,o.Z)((0,o.Z)({},this.sourceJSON),{},{minScale:0,maxScale:0}),this.read(r,{origin:"service"})),null==this.title&&(this.title=this.raster.datasetName),"Map"===this.raster.tileType&&(this.popupEnabled=!1),this._configDefaultSettings(),this.own((0,g.l)((function(){return n.customParameters}),(function(e){n.raster.ioConfig.customFetchParameters=e})));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}((0,I.a)((0,z.t)((0,O.c)((0,B.v)((0,S.o)(function(e){var t=function(e){(0,p.Z)(r,e);var t=(0,h.Z)(r);function r(){var e;return(0,c.Z)(this,r),(e=t.apply(this,arguments))._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},e.bandIds=null,e.copyright=null,e.fullExtent=null,e.interpolation="nearest",e.multidimensionalDefinition=null,e.raster=null,e.rasterInfo=null,e.sourceJSON=null,e.spatialReference=null,e.tileInfo=null,e.symbolizer=null,e}return(0,f.Z)(r,[{key:"url",set:function(e){this._set("url",(0,Z.S)(e,V))}},{key:"renderer",set:function(e){this._set("renderer",e),this.updateRenderer()}},{key:"convertVectorFieldData",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r){var n,i;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,y.t)(t)){e.next=2;break}return e.abrupt("return",null);case 2:return n=this._rasterJobHandler.instance,i=this.rasterInfo.dataType,e.abrupt("return",n?n.convertVectorFieldData({pixelBlock:t,dataType:i},r):(0,M.m)(t,i));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"createFlowMesh",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r){var n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._rasterJobHandler.instance,e.abrupt("return",n?n.createFlowMesh(t,r):(0,M.u)(t.meshType,t.simulationSettings,t.flowData,(0,y.r)(r.signal)?r.signal:(new AbortController).signal));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"normalizeRasterFetchOptions",value:function(e){var t=this.rasterInfo.multidimensionalInfo;if((0,y.t)(t))return e;var r=e.multidimensionalDefinition||this.multidimensionalDefinition;!(0,y.t)(r)&&r.length||(r=(0,v.b)(this.raster.rasterInfo));var n=e.timeExtent||this.timeExtent;if((0,y.r)(r)&&(0,y.r)(n)&&((0,y.r)(n.start)||(0,y.r)(n.end))){var i,a;r=r.map((function(e){return e.clone()}));var l=null===(i=t.variables.find((function(e){return e.name===r[0].variableName})))||void 0===i||null===(a=i.dimensions)||void 0===a?void 0:a.find((function(e){return"StdTime"===e.name})),u=r.find((function(e){return"StdTime"===e.dimensionName}));if(!l||!u)return(0,o.Z)((0,o.Z)({},e),{},{multidimensionalDefinition:null});var c=n.start,f=n.end,p=(0,y.t)(c)?null:c.getTime(),h=(0,y.t)(f)?null:f.getTime(),d=null!==p&&void 0!==p?p:h,m=null!==h&&void 0!==h?h:p;if((0,y.r)(l.values)){var x=l.values.filter((function(e){if(Array.isArray(e)){if(d===m)return e[0]<=d&&e[1]>=d;var t=e[0]<=d&&e[1]>d||e[0]<m&&e[1]>=m,r=e[0]>=d&&e[1]<=m||e[0]<d&&e[1]>m;return t||r}return d===m?e===d:e>=d&&e<=m}));if(x.length){var g=x.sort((function(e,t){var r,n,i,a;return d===m?(null!==(r=e[0])&&void 0!==r?r:e)-(null!==(n=t[0])&&void 0!==n?n:t):Math.abs((null!==(i=e[1])&&void 0!==i?i:e)-m)-Math.abs((null!==(a=t[1])&&void 0!==a?a:t)-m)}))[0];u.values=[g]}else r=null}else if(l.hasRegularIntervals&&l.extent){var b=(0,s.Z)(l.extent,2),k=b[0],w=b[1];d>w||m<k?r=null:u.values=d===m?[d]:[Math.max(k,d),Math.min(w,m)]}}return(0,o.Z)((0,o.Z)({},e),{},{multidimensionalDefinition:r})}},{key:"updateRenderer",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(){var t;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loaded){e.next=2;break}return e.abrupt("return");case 2:if(JSON.stringify(this._cachedRendererJson)!==JSON.stringify(this.renderer)){e.next=4;break}return e.abrupt("return");case 4:if(t=this._rasterJobHandler.instance,e.t0=t,!e.t0){e.next=12;break}return this.symbolizer.rendererJSON=(0,v.t)(this.renderer.toJSON()),this.symbolizer.bind(),e.next=11,t.updateSymbolizer(this.symbolizer);case 11:this._cachedRendererJson=this.renderer.toJSON();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"applyRenderer",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r){var n,i,a,s;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t&&t.pixelBlock,(0,y.r)(n)&&n.pixels&&n.pixels.length>0){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,this.updateRenderer();case 5:if(a=this._rasterJobHandler.instance,s=this.bandIds,!a){e.next=12;break}return e.next=9,a.symbolize((0,o.Z)((0,o.Z)({},t),{},{simpleStretchParams:r,bandIds:s}));case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=this.symbolizer.symbolize((0,o.Z)((0,o.Z)({},t),{},{simpleStretchParams:r,bandIds:s}));case 13:return i=e.t0,e.abrupt("return",i);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getTileUrl",value:function(e,t,r){return"RasterTileServer"===this.raster.datasetFormat?"".concat(this.url,"/tile/").concat(e,"/").concat(t,"/").concat(r):""}},{key:"getCompatibleTileInfo",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.loaded||(0,y.t)(t))return null;if(r&&e.equals(this.spatialReference))return this.tileInfo;var n=(0,k.b)(e);return C.S.create({size:256,spatialReference:e,origin:n?{x:n.origin[0],y:n.origin[1]}:{x:t.xmin,y:t.ymax}})}},{key:"getCompatibleFullExtent",value:function(e){return this.loaded?(this._compatibleFullExtent&&this._compatibleFullExtent.spatialReference.equals(e)||(this._compatibleFullExtent=this.raster.computeExtent(e)),this._compatibleFullExtent):null}},{key:"fetchTile",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n){var i,a,s,u=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=u.length>3&&void 0!==u[3]?u[3]:{}).requestAsImageElement){e.next=4;break}return a=this.getTileUrl(t,r,n),e.abrupt("return",(0,R.U)(a,{responseType:"image",query:(0,o.Z)((0,o.Z)({},this.refreshParameters),this.raster.ioConfig.customFetchParameters),signal:i.signal}).then((function(e){return e.data})));case 4:if(!(0,y.r)(this.rasterInfo.multidimensionalInfo)||(i=this.normalizeRasterFetchOptions(i),!(0,y.t)(i.multidimensionalDefinition))){e.next=7;break}return s=i.tileInfo||this.rasterInfo.storageInfo.tileInfo,e.abrupt("return",{extent:this.raster.getTileExtentFromTileInfo(t,r,n,s),pixelBlock:null});case 7:return e.next=9,this._initJobHandler();case 9:return"raster-shaded-relief"===this.renderer.type&&(i=(0,o.Z)((0,o.Z)({},i),{},{buffer:{cols:1,rows:1}})),e.abrupt("return",this.raster.fetchTile(t,r,n,i));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"fetchPixels",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t,r,n){var i,a=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=a.length>3&&void 0!==a[3]?a[3]:{},!(0,y.r)(this.rasterInfo.multidimensionalInfo)||(i=this.normalizeRasterFetchOptions(i),!(0,y.t)(i.multidimensionalDefinition))){e.next=5;break}e.t0={extent:t,pixelBlock:null},e.next=8;break;case 5:return e.next=7,this._initJobHandler();case 7:e.t0=this.raster.fetchPixels(t,r,n,i);case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"identify",value:function(){var e=(0,u.Z)((0,l.Z)().mark((function e(t){var r,n=arguments;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]?n[1]:{},!(0,y.r)(this.rasterInfo.multidimensionalInfo)){e.next=4;break}if(this.rasterInfo.hasMultidimensionalTranspose&&((0,v.d)(r.multidimensionalDefinition)||r.transposedVariableName||r.timeExtent)||(r=this.normalizeRasterFetchOptions(r),!(0,y.t)(r.multidimensionalDefinition))){e.next=4;break}return e.abrupt("return",{location:t,value:null});case 4:return e.abrupt("return",this.raster.identify(t,r));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"increaseRasterJobHandlerUsage",value:function(){this._rasterJobHandler.refCount++}},{key:"decreaseRasterJobHandlerUsage",value:function(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()}},{key:"hasStandardTime",value:function(){var e,t=this.rasterInfo.multidimensionalInfo;if((0,y.t)(t)||"standard-time"!==this.rasterInfo.dataType)return!1;var r=null===(e=this.multidimensionalDefinition[0])||void 0===e?void 0:e.variableName;return t.variables.some((function(e){return e.name===r&&e.dimensions.some((function(e){return"StdTime"===e.name}))}))}},{key:"getStandardTimeValue",value:function(e){return new Date(24*(e-25569)*3600*1e3).toString()}},{key:"_configDefaultSettings",value:function(){this._configDefaultInterpolation(),this.multidimensionalDefinition||(this.multidimensionalDefinition=(0,v.b)(this.raster.rasterInfo)),this._configDefaultRenderer()}},{key:"_initJobHandler",value:function(){var e=this;if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;var t=new v.c;return this._rasterJobHandler.connectionPromise=t.initialize().then((function(){e._rasterJobHandler.instance=t,e.raster.rasterJobHandler=t,e.renderer&&e.updateRenderer()})).catch((function(){return null})),this._rasterJobHandler.connectionPromise}},{key:"_shutdownJobHandler",value:function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null,this._cachedRendererJson=null}},{key:"_configDefaultInterpolation",value:function(){if(null==this.interpolation){var e,t=(0,v.I)(this.rasterInfo,this.raster.tileType,null===(e=this.sourceJSON)||void 0===e?void 0:e.defaultResamplingMethod);this._set("interpolation",t)}}},{key:"_configDefaultRenderer",value:function(){var e=this.raster.rasterInfo;if(this.bandIds||(this.bandIds=(0,v.B)(e)),!this.renderer){var t,r,n,i=(0,v.k)(e,{bandIds:this.bandIds,variableName:(0,y.r)(this.multidimensionalDefinition)?null===(t=this.multidimensionalDefinition[0])||void 0===t?void 0:t.variableName:null});"WCSServer"===this.raster.datasetFormat&&"raster-stretch"===i.type&&((null===(r=e.statistics)||void 0===r?void 0:r[0].max)>1e24||(null===(n=e.statistics)||void 0===n?void 0:n[0].min)<-1e24)&&(i.dynamicRangeAdjustment=!0,i.statistics=null,"none"===i.stretchType&&(i.stretchType="min-max")),this.renderer=i}this.symbolizer?(this.symbolizer.rendererJSON=(0,v.t)(this.renderer.toJSON()),this.symbolizer.rasterInfo=e):this.symbolizer=new P.U({rendererJSON:this.renderer.toJSON(),rasterInfo:e});var a=this.symbolizer.bind();a.success||V.warn("imagery-tile-mixin",a.error||"The given renderer is not supported by the layer.")}}]),r}(e);return(0,d.e)([(0,d.d)()],t.prototype,"_cachedRendererJson",void 0),(0,d.e)([(0,d.d)()],t.prototype,"_compatibleFullExtent",void 0),(0,d.e)([(0,d.d)()],t.prototype,"_rasterJobHandler",void 0),(0,d.e)([(0,d.d)()],t.prototype,"bandIds",void 0),(0,d.e)([(0,d.d)({json:{origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),(0,d.e)([(0,d.d)({type:F.M,json:{read:!1}}),(0,T.o)("rasterInfo.extent")],t.prototype,"fullExtent",void 0),(0,d.e)([(0,d.d)()],t.prototype,"interpolation",void 0),(0,d.e)([(0,d.d)()],t.prototype,"ioConfig",void 0),(0,d.e)([(0,d.d)({type:[v.p]})],t.prototype,"multidimensionalDefinition",void 0),(0,d.e)([(0,d.d)()],t.prototype,"raster",void 0),(0,d.e)([(0,d.d)({readOnly:!0}),(0,T.o)("raster.rasterInfo")],t.prototype,"rasterInfo",void 0),(0,d.e)([(0,d.d)()],t.prototype,"sourceJSON",void 0),(0,d.e)([(0,d.d)({type:k.k,json:{read:!1}}),(0,T.o)("rasterInfo.spatialReference")],t.prototype,"spatialReference",void 0),(0,d.e)([(0,d.d)({type:C.S,json:{read:!1}}),(0,T.o)("rasterInfo.storageInfo.tileInfo")],t.prototype,"tileInfo",void 0),(0,d.e)([(0,d.d)(_.f)],t.prototype,"url",null),(0,d.e)([(0,d.d)({types:v.l})],t.prototype,"renderer",null),(0,d.e)([(0,d.d)()],t.prototype,"symbolizer",void 0),t=(0,d.e)([(0,d.n)("esri.layers.ImageryTileMixin")],t),t}((0,E.a)((0,D.n)((0,x.O)(w.b))))))))));(0,d.e)([(0,d.d)({type:[d.S],json:{write:{overridePolicy:function(){var e;return{enabled:!this.loaded||"Raster"===this.raster.tileType||"0,1,2"!==(null===(e=this.bandIds)||void 0===e?void 0:e.join(","))}}}}})],_e.prototype,"bandIds",void 0),(0,d.e)([(0,d.d)({json:{write:{overridePolicy:function(){return{enabled:!this.loaded||"Raster"===this.raster.tileType||"bilinear"!==this.interpolation}}}}}),(0,b.r)(v.o)],_e.prototype,"interpolation",void 0),(0,d.e)([(0,d.d)({json:{write:!0}})],_e.prototype,"multidimensionalDefinition",void 0),(0,d.e)([(0,d.d)(_.c)],_e.prototype,"legendEnabled",void 0),(0,d.e)([(0,d.d)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],_e.prototype,"isReference",void 0),(0,d.e)([(0,d.d)({type:["show","hide"]})],_e.prototype,"listMode",void 0),(0,d.e)([(0,d.d)({json:{read:!0,write:!0}})],_e.prototype,"blendMode",void 0),(0,d.e)([(0,d.d)()],_e.prototype,"sourceJSON",void 0),(0,d.e)([(0,d.d)({readOnly:!0,json:{origins:{service:{read:{source:"currentVersion"}}}}})],_e.prototype,"version",void 0),(0,d.e)([(0,d.d)()],_e.prototype,"title",void 0),(0,d.e)([(0,d.d)({readOnly:!0,json:{read:!1}})],_e.prototype,"type",void 0),(0,d.e)([(0,d.d)({type:["ArcGISTiledImageServiceLayer"]})],_e.prototype,"operationalLayerType",void 0),(0,d.e)([(0,d.d)({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",overridePolicy:function(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}},writer:function(e,t,r){t[r]=!e}}}})],_e.prototype,"popupEnabled",void 0),(0,d.e)([(0,d.d)({type:m.B,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:function(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}}}}})],_e.prototype,"popupTemplate",void 0),(0,d.e)([(0,d.d)({readOnly:!0})],_e.prototype,"defaultPopupTemplate",null),(0,d.e)([(0,d.d)({readOnly:!0,type:[N.y]})],_e.prototype,"fields",void 0),(0,d.e)([(0,d.d)({readOnly:!0,type:[N.y]})],_e.prototype,"rasterFields",null),(0,d.e)([(0,d.d)({types:v.l,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:function(){var e,t="raster-stretch"===(null===(e=this.renderer)||void 0===e?void 0:e.type)&&"none"===this.renderer.stretchType&&!this.renderer.useGamma;return{enabled:!this.loaded||"Raster"===this.raster.tileType||!t}}},origins:{"web-scene":{types:v.a,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:function(e){return{enabled:e&&"vector-field"!==e.type&&"flow"!==e.type}}}}}}})],_e.prototype,"renderer",null),(0,d.e)([(0,k.o)("renderer")],_e.prototype,"readRenderer",null);var Ce=_e=(0,d.e)([(0,d.n)("esri.layers.ImageryTileLayer")],_e);t.default=Ce},17436:function(e,t,r){r.d(t,{e:function(){return s}});var n=r(15671),i=r(43144),a=r(25316),s=function(){function e(t,r){(0,n.Z)(this,e),this._storage=new a.h,this._storage.maxSize=t,r&&this._storage.registerRemoveFunc("",r)}return(0,i.Z)(e,[{key:"put",value:function(e,t,r){this._storage.put(e,t,r,1)}},{key:"pop",value:function(e){return this._storage.pop(e)}},{key:"get",value:function(e){return this._storage.get(e)}},{key:"clear",value:function(){this._storage.clearAll()}},{key:"destroy",value:function(){this._storage.destroy()}},{key:"maxSize",get:function(){return this._storage.maxSize},set:function(e){this._storage.maxSize=e}}]),e}()},72763:function(e,t,r){r.d(t,{b:function(){return k}});var n=r(74165),i=r(15671),a=r(43144),s=r(60136),o=r(29388),l=r(15861),u=r(23132),c=(r(91204),r(57714)),f=r(80175),p=r(77196),h=r(79611),d=r(75610),m=r(80262),v=r(30709),y=u.s.getLogger("esri.layers.support.fromPortalItem");function x(){return x=(0,l.Z)((0,n.Z)().mark((function e(t){var i,a,s,o,l;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="portalItem"in t?t:{portalItem:t},e.next=3,Promise.all([r.e(1340),r.e(3022),r.e(8854),r.e(6498),r.e(9737)]).then(r.bind(r,76498));case 3:return a=e.sent,e.prev=4,e.next=7,a.fromItem(i);case 7:return e.abrupt("return",e.sent);case 10:throw e.prev=10,e.t0=e.catch(4),s=i&&i.portalItem,o=s&&s.id||"unset",l=s&&s.portal&&s.portal.url||d.b.portalUrl,y.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+l+"', id: '"+o+"')",e.t0),e.t0;case 14:case"end":return e.stop()}}),e,null,[[4,10]])}))),x.apply(this,arguments)}var g=0,b=function(e){(0,s.Z)(f,e);var t=(0,o.Z)(f);function f(){var e;return(0,i.Z)(this,f),(e=t.apply(this,arguments)).attributionDataUrl=null,e.fullExtent=new m.M(-180,-90,180,90,v.k.WGS84),e.id=Date.now().toString(16)+"-layer-"+g++,e.legendEnabled=!0,e.listMode="show",e.opacity=1,e.parent=null,e.popupEnabled=!0,e.attributionVisible=!0,e.spatialReference=v.k.WGS84,e.title=null,e.type=null,e.url=null,e.visible=!0,e}return(0,a.Z)(f,[{key:"initialize",value:function(){var e=this;this.when().catch((function(t){var r,n;(0,u.u)(t)||u.s.getLogger(e.declaredClass).error("#load()","Failed to load layer (title: '".concat(null!==(r=e.title)&&void 0!==r?r:"no title","', id: '").concat(null!==(n=e.id)&&void 0!==n?n:"no id","')"),{error:t})}))}},{key:"destroy",value:function(){if(this.parent){var e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}},{key:"hasAttributionData",get:function(){return null!=this.attributionDataUrl}},{key:"parsedUrl",get:function(){var e=this.url;return e?(0,c.j)(e):null}},{key:"fetchAttributionData",value:function(){var e=(0,l.Z)((0,n.Z)().mark((function e(){var t;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.attributionDataUrl,!this.hasAttributionData||!t){e.next=5;break}return e.next=4,(0,c.U)(t,{query:{f:"json"},responseType:"json"});case 4:return e.abrupt("return",e.sent.data);case 5:throw new u.a("layer:no-attribution-data","Layer does not have attribution data");case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"fromArcGISServerUrl",value:function(){var e=(0,l.Z)((0,n.Z)().mark((function e(t){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="string"==typeof t?{url:t}:t,e.next=3,Promise.all([r.e(8854),r.e(8201)]).then(r.bind(r,38201));case 3:return e.abrupt("return",e.sent.fromUrl(i));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fromPortalItem",value:function(e){return function(e){return x.apply(this,arguments)}(e)}}]),f}(f.n.EventedMixin((0,p.s)(h.m)));(0,u.e)([(0,u.d)({type:String})],b.prototype,"attributionDataUrl",void 0),(0,u.e)([(0,u.d)({type:m.M})],b.prototype,"fullExtent",void 0),(0,u.e)([(0,u.d)({readOnly:!0})],b.prototype,"hasAttributionData",null),(0,u.e)([(0,u.d)({type:String,clonable:!1})],b.prototype,"id",void 0),(0,u.e)([(0,u.d)({type:Boolean,nonNullable:!0})],b.prototype,"legendEnabled",void 0),(0,u.e)([(0,u.d)({type:["show","hide","hide-children"]})],b.prototype,"listMode",void 0),(0,u.e)([(0,u.d)({type:Number,range:{min:0,max:1},nonNullable:!0})],b.prototype,"opacity",void 0),(0,u.e)([(0,u.d)({clonable:!1})],b.prototype,"parent",void 0),(0,u.e)([(0,u.d)({readOnly:!0})],b.prototype,"parsedUrl",null),(0,u.e)([(0,u.d)({type:Boolean})],b.prototype,"popupEnabled",void 0),(0,u.e)([(0,u.d)({type:Boolean})],b.prototype,"attributionVisible",void 0),(0,u.e)([(0,u.d)({type:v.k})],b.prototype,"spatialReference",void 0),(0,u.e)([(0,u.d)({type:String})],b.prototype,"title",void 0),(0,u.e)([(0,u.d)({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0),(0,u.e)([(0,u.d)()],b.prototype,"url",void 0),(0,u.e)([(0,u.d)({type:Boolean,nonNullable:!0})],b.prototype,"visible",void 0);var k=b=(0,u.e)([(0,u.n)("esri.layers.Layer")],b)},95254:function(e,t,r){r.d(t,{v:function(){return b}});var n=r(1413),i=r(74165),a=r(15861),s=r(15671),o=r(43144),l=r(11752),u=r(61120),c=r(60136),f=r(29388),p=r(23132),h=r(57714),d=r(38304),m=r(75610),v=r(30709),y=r(79611),x=r(61099),g=p.s.getLogger("esri.layers.mixins.PortalLayer"),b=function(e){var t=function(e){(0,c.Z)(v,e);var t=(0,f.Z)(v);function v(){var e;return(0,s.Z)(this,v),(e=t.apply(this,arguments)).resourceReferences={portalItem:null,paths:[]},e.userHasEditingPrivileges=!0,e}return(0,o.Z)(v,[{key:"destroy",value:function(){var e;null!==(e=this.portalItem)&&void 0!==e&&e.destroy(),this.portalItem=null}},{key:"portalItem",set:function(e){e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",e))}},{key:"readPortalItem",value:function(e,t,r){if(t.itemId)return new x.default({id:t.itemId,portal:r&&r.portal})}},{key:"writePortalItem",value:function(e,t){e&&e.id&&(t.itemId=e.id)}},{key:"loadFromPortal",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,n){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.portalItem||!this.portalItem.id){e.next=14;break}return e.prev=1,e.next=4,Promise.all([r.e(8854),r.e(277)]).then(r.bind(r,50277)).then((function(e){return e.l}));case 4:return a=e.sent,(0,p.H)(n),e.next=8,a.load({instance:this,supportedTypes:t.supportedTypes,validateItem:t.validateItem,supportsData:t.supportsData},n);case 8:return e.abrupt("return",e.sent);case 11:throw e.prev=11,e.t0=e.catch(1),(0,p.u)(e.t0)||g.warn("Failed to load layer (".concat(this.title,", ").concat(this.id,") portal item (").concat(this.portalItem.id,")\n  ").concat(e.t0)),e.t0;case 14:case"end":return e.stop()}}),e,this,[[1,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"finishLoadEditablePortalLayer",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._fetchUserHasEditingPrivileges(t).catch((function(e){return(0,p.M)(e),!0}));case 3:e.t1=e.sent,e.t0._set.call(e.t0,"userHasEditingPrivileges",e.t1);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchUserHasEditingPrivileges",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.url?null===h.a||void 0===h.a?void 0:h.a.findCredential(this.url):null){e.next=3;break}return e.abrupt("return",!0);case 3:if(k.credential!==r){e.next=7;break}e.t0=k.user,e.next=10;break;case 7:return e.next=9,this._fetchEditingUser(t);case 9:e.t0=e.sent;case 10:return n=e.t0,e.abrupt("return",(k.credential=r,k.user=n,(0,m.t)(n)||null==n.privileges||n.privileges.includes("features:user:edit")));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchEditingUser",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var r,n,a,s,o,l,u,c,f;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=null===(r=this.portalItem)||void 0===r||null===(n=r.portal)||void 0===n?void 0:n.user)){e.next=3;break}return e.abrupt("return",a);case 3:if(null!==(s=h.a.findServerInfo(this.url))&&void 0!==s&&s.owningSystemUrl){e.next=6;break}return e.abrupt("return",null);case 6:if(o="".concat(s.owningSystemUrl,"/sharing/rest"),!(l=y.B.getDefault())||!l.loaded||(0,h.F)(l.restUrl)!==(0,h.F)(o)){e.next=9;break}return e.abrupt("return",l.user);case 9:return u="".concat(o,"/community/self"),c=(0,m.r)(t)?t.signal:null,e.next=13,(0,d.a)((0,h.U)(u,{authMode:"no-prompt",query:{f:"json"},signal:c}));case 13:return f=e.sent,e.abrupt("return",f.ok?y.p.fromJSON(f.value.data):null);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"read",value:function(e,t){t&&(t.layer=this),(0,l.Z)((0,u.Z)(v.prototype),"read",this).call(this,e,t)}},{key:"write",value:function(e,t){var r=t&&t.portal,i=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||y.B.getDefault());return r&&i&&!(0,h.N)(i.restUrl,r.restUrl)?(t.messages&&t.messages.push(new p.a("layer:cross-portal","The layer '".concat(this.title," (").concat(this.id,")' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer"),{layer:this})),null):(0,l.Z)((0,u.Z)(v.prototype),"write",this).call(this,e,(0,n.Z)((0,n.Z)({},t),{},{layer:this}))}}]),v}(e);return(0,p.e)([(0,p.d)({type:x.default})],t.prototype,"portalItem",null),(0,p.e)([(0,v.o)("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),(0,p.e)([(0,v.r)("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),(0,p.e)([(0,p.d)({clonable:!1})],t.prototype,"resourceReferences",void 0),(0,p.e)([(0,p.d)({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=(0,p.e)([(0,p.n)("esri.layers.mixins.PortalLayer")],t),t},k={credential:null,user:null}},81183:function(e,t,r){r.d(t,{d:function(){return y},g:function(){return g},h:function(){return d},i:function(){return f},m:function(){return m},s:function(){return p},u:function(){return h},x:function(){return v}});var n=r(15671),i=r(43144),a=(r(91204),r(75610)),s=r(75105),o=r(30709),l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;(0,n.Z)(this,e),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,r)}return(0,i.Z)(e,[{key:"decreaseRefCount",value:function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.refCount--,i.refCount<=0&&(n.delete(r),i.controller&&i.controller.abort()),i.refCount}return 0}},{key:"getBlock",value:function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.ts=Date.now(),i.refCount++,n.delete(r),n.set(r,i),i.block}return null}},{key:"putBlock",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=this._cachedBlocks,a=e+"/"+t;if(i.has(a)){var s=i.get(a);s.ts=Date.now(),s.refCount++}else i.set(a,{block:r,ts:Date.now(),refCount:1,controller:n});this._trim(),this._updateTimer()}},{key:"deleteBlock",value:function(e,t){var r=this._cachedBlocks,n=e+"/"+t;r.has(n)&&r.delete(n)}},{key:"updateMaxSize",value:function(e){this._size=e,this._trim()}},{key:"empty",value:function(){this._cachedBlocks.clear(),this._clearTimer()}},{key:"getCurrentSize",value:function(){return this._cachedBlocks.size}},{key:"_updateTimer",value:function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var r=Array.from(t),n=Date.now(),i=0;i<r.length&&r[i][1].ts<=n-e._duration;i++)t.delete(r[i][0]);0===t.size&&e._clearTimer()}),this._interval)}}},{key:"_trim",value:function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=Array.from(e),r=0;r<t.length-this._size;r++)e.delete(t[r][0])}},{key:"_clearTimer",value:function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}]),e}(),u=new Map,c=new l;function f(e,t){return null==t?e:"".concat(e,"?sliceId=").concat(t)}function p(e,t){var r={extent:null,rasterInfo:t,cache:new Map};if(u.has(e)){var n=u.get(e);return n.push(r),n.length-1}return u.set(e,[r]),0}function h(e,t){if(u.has(e)){var r=u.get(e);r[t]=null,r.some((function(e){return null!=e}))||u.delete(e)}}function d(e,t,r){if(!u.has(e))return null==t?c.decreaseRefCount(e,r):0;var n=u.get(e);if(null==n[t])return c.decreaseRefCount(e,r);var i=n[t].cache;if(i.has(r)){var a=i.get(r);if(a.refCount--,0===a.refCount){i.delete(r);for(var s=0;s<n.length;s++)n[s]&&n[s].cache.has(r)&&n[s].cache.delete(r);a.controller&&a.controller.abort()}return a.refCount}return 0}function m(e,t,r){if(!u.has(e))return null==t?c.getBlock(e,r):null;var n=u.get(e);if(null==n[t]){for(var i=0;i<n.length;i++)if(n[i]&&n[i].cache.has(r)){var a=n[i].cache.get(r);return a.refCount++,a.block}return c.getBlock(e,r)}var s=n[t].cache;if(s.has(r)){var o=s.get(r);return o.refCount++,o.block}for(var l=0;l<n.length;l++)if(l!==t&&n[l]&&n[l]&&n[l].cache.has(r)){var f=n[l].cache.get(r);return f.refCount++,s.set(r,f),f.block}return null}function v(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(u.has(e)){var a=u.get(e);if(null!=a[t]){var s={refCount:1,block:n,isResolved:!1,isRejected:!1,controller:i};n.then((function(){return s.isResolved=!0})).catch((function(){return s.isRejected=!0})),a[t].cache.set(r,s)}else c.putBlock(e,r,n,i)}else null==t&&c.putBlock(e,r,n,i)}function y(e,t,r){if(u.has(e)){var n=u.get(e);null!=n[t]?n[t].cache.delete(r):c.deleteBlock(e,r)}else null==t&&c.deleteBlock(e,r)}function x(e,t){if(!u.has(e))return null;var r=u.get(e);return null==r[t]?null:r[t]}function g(e,t,r,n,i,l){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=x(e,t),f=c.extent,p=c.cache,h=c.rasterInfo;if(!f||f.xmin!==r.xmin||f.xmax!==r.xmax||f.ymin!==r.ymin||f.ymax!==r.ymax){for(var d=r.clone().normalize(),m=h.spatialReference,v=h.transform,y=new Set,g=0;g<d.length;g++){var b=d[g];if(!(b.xmax-b.xmin<=n||b.ymax-b.ymin<=n)){var k=(0,s.F)(b,m,u);(0,a.r)(v)&&(k=v.inverseTransform(k));var w=new o.j({x:n,y:n,spatialReference:b.spatialReference});if(null==i&&!(i=(0,s.v)(w,m,b,u)))return;var I=(0,s.t)(i,h,l||"closest"),S=I.pyramidLevel,R=I.pyramidResolution,T=I.excessiveReading;if(T)return;for(var Z=h.storageInfo,_=Z.origin,C={x:Math.max(0,Math.floor((k.xmin-_.x)/R.x)),y:Math.max(0,Math.floor((_.y-k.ymax)/R.y))},M=Math.ceil((k.xmax-k.xmin)/R.x-.1),P=Math.ceil((k.ymax-k.ymin)/R.y-.1),F=S>0?Z.pyramidBlockWidth:Z.blockWidth,O=S>0?Z.pyramidBlockHeight:Z.blockHeight,B=1,D=Math.max(0,Math.floor(C.x/F)-B),z=Math.max(0,Math.floor(C.y/O)-B),E=Math.floor((C.x+M-1)/F)+B,N=Math.floor((C.y+P-1)/O)+B,L=z;L<=N;L++)for(var A=D;A<=E;A++)y.add("".concat(S,"/").concat(L,"/").concat(A))}}p.forEach((function(e,t){if(!y.has(t)){var r=p.get(t);(null==r||r.isResolved||r.isRejected)&&p.delete(t)}})),c.extent={xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}}}},1241:function(e,t,r){r.d(t,{L:function(){return _},i:function(){return m},r:function(){return d},s:function(){return v},z:function(){return M}});var n=r(74165),i=r(1413),a=r(29439),s=r(15861),o=r(37762),l=r(75610),u=r(23132),c=r(36460),f=r(30709),p=r(30604),h=(r(91204),r(57714)),d={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new c.m({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:f.k.WebMercator}),minus180Line:new c.m({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:f.k.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new c.m({paths:[[[180,-180],[180,180]]],spatialReference:f.k.WGS84}),minus180Line:new c.m({paths:[[[-180,-180],[-180,180]]],spatialReference:f.k.WGS84})}};function m(e,t){return Math.ceil((e-t)/(2*t))}function v(e,t){var r,n=y(e),i=(0,o.Z)(n);try{for(i.s();!(r=i.n()).done;){var a,s=r.value,l=(0,o.Z)(s);try{for(l.s();!(a=l.n()).done;){a.value[0]+=t}}catch(u){l.e(u)}finally{l.f()}}}catch(u){i.e(u)}finally{i.f()}return e}function y(e){return(0,p.c)(e)?e.rings:e.paths}function x(e,t,r,n){return g.apply(this,arguments)}function g(){return g=(0,s.Z)((0,n.Z)().mark((function e(t,r,a,s){var o,l,u,c,f,d,m,v;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="string"==typeof t?(0,h.j)(t):t,l=r[0].spatialReference,u=(0,i.Z)((0,i.Z)({},s),{},{query:(0,i.Z)((0,i.Z)({},o.query),{},{f:"json",sr:JSON.stringify(l),target:JSON.stringify({geometryType:(0,p.v)(r[0]),geometries:r}),cutter:JSON.stringify(a)})}),e.next=5,(0,h.U)(o.path+"/cut",u);case 5:return c=e.sent,f=c.data,d=f.cutIndexes,m=f.geometries,v=void 0===m?[]:m,e.abrupt("return",{cutIndexes:d,geometries:v.map((function(e){var t=(0,p.d)(e);return t.spatialReference=l,t}))});case 11:case"end":return e.stop()}}),e)}))),g.apply(this,arguments)}function b(e,t,r){return k.apply(this,arguments)}function k(){return k=(0,s.Z)((0,n.Z)().mark((function e(t,r,a){var s,o,l,u;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s="string"==typeof t?(0,h.j)(t):t,o=r[0].spatialReference,l=(0,p.v)(r[0]),u=(0,i.Z)((0,i.Z)({},a),{},{query:(0,i.Z)((0,i.Z)({},s.query),{},{f:"json",sr:o.wkid?o.wkid:JSON.stringify(o),geometries:JSON.stringify(w(r))})}),e.t0=I,e.next=4,(0,h.U)(s.path+"/simplify",u);case 4:return e.t1=e.sent.data,e.t2=l,e.t3=o,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 8:case"end":return e.stop()}}),e)}))),k.apply(this,arguments)}function w(e){return{geometryType:(0,p.v)(e[0]),geometries:e.map((function(e){return e.toJSON()}))}}function I(e,t,r){var n=(0,p.a)(t);return e.map((function(e){var t=n.fromJSON(e);return t.spatialReference=r,t}))}var S=u.s.getLogger("esri.geometry.support.normalizeUtils");function R(e,t,r){if(t){var n=function(e,t){if(!(e instanceof c.m||e instanceof c.v)){var r="straightLineDensify: the input geometry is neither polyline nor polygon";throw S.error(r),new u.a(r)}var n,i=y(e),a=[],s=(0,o.Z)(i);try{for(s.s();!(n=s.n()).done;){var l=n.value,f=[];a.push(f),f.push([l[0][0],l[0][1]]);for(var p=0;p<l.length-1;p++){var h=l[p][0],d=l[p][1],m=l[p+1][0],v=l[p+1][1],x=Math.sqrt((m-h)*(m-h)+(v-d)*(v-d)),g=(v-d)/x,b=(m-h)/x,k=x/t;if(k>1){for(var w=1;w<=k-1;w++){var I=w*t,R=b*I+h,T=g*I+d;f.push([R,T])}var Z=(x+Math.floor(k-1)*t)/2,_=b*Z+h,C=g*Z+d;f.push([_,C])}f.push([m,v])}}}catch(M){s.e(M)}finally{s.f()}return function(e){return"polygon"===e.type}(e)?new c.v({rings:a,spatialReference:e.spatialReference}):new c.m({paths:a,spatialReference:e.spatialReference})}(e,1e6);e=(0,f.a)(n,!0)}return r&&(e=v(e,r)),e}function T(e,t,r){if(Array.isArray(e)){var n=e[0];if(n>t){var i=m(n,t);e[0]=n+i*(-2*t)}else if(n<r){var a=m(n,r);e[0]=n+a*(-2*r)}}else{var s=e.x;if(s>t){var o=m(s,t);e=e.clone().offset(o*(-2*t),0)}else if(s<r){var l=m(s,r);e=e.clone().offset(l*(-2*r),0)}}return e}function Z(e,t){for(var r=-1,n=function(n){for(var i=t.cutIndexes[n],a=t.geometries[n],s=y(a),l=function(e){var t=s[e];t.some((function(r){if(r[0]<180)return!0;for(var n=0,i=0;i<t.length;i++){var s=t[i][0];n=s>n?s:n}for(var o=-360*m(n=Number(n.toFixed(9)),180),l=0;l<t.length;l++){var u=a.getPoint(e,l);a.setPoint(e,l,u.clone().offset(o,0))}return!0}))},u=0;u<s.length;u++)l(u);if(i===r){if(function(e){return"polygon"===e[0].type}(e)){var c,f=(0,o.Z)(y(a));try{for(f.s();!(c=f.n()).done;){var p=c.value;e[i]=e[i].addRing(p)}}catch(x){f.e(x)}finally{f.f()}}else if(function(e){return"polyline"===e[0].type}(e)){var h,d=(0,o.Z)(y(a));try{for(d.s();!(h=d.n()).done;){var v=h.value;e[i]=e[i].addPath(v)}}catch(x){d.e(x)}finally{d.f()}}}else r=i,e[i]=a},i=0;i<t.cutIndexes.length;i++)n(i);return e}function _(e,t,r){return C.apply(this,arguments)}function C(){return C=(0,s.Z)((0,n.Z)().mark((function e(t,r,i){var a,s,u,p,h,y,g,k,w,I,C,M,P,F,O,B,D,z,E,N,L,A,H,J,j,W,G,U,q,V,X,Y,K,Q,$,ee,te,re,ne,ie,ae;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)){e.next=2;break}return e.abrupt("return",_([t],r));case 2:r&&"string"!=typeof r&&S.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead"),s="string"==typeof r?r:null!==(a=null===r||void 0===r?void 0:r.url)&&void 0!==a?a:l.b.geometryServiceUrl,C=0,M=[],P=[],F=(0,o.Z)(t);try{for(F.s();!(O=F.n()).done;)B=O.value,(0,l.t)(B)?P.push(B):(u||(u=B.spatialReference,p=(0,f.b)(u),h=u.isWebMercator,y=d[k=h?102100:4326].maxX,g=d[k].minX,w=d[k].plus180Line,I=d[k].minus180Line),p?"mesh"===B.type?P.push(B):"point"===B.type?P.push(T(B.clone(),y,g)):"multipoint"===B.type?((D=B.clone()).points=D.points.map((function(e){return T(e,y,g)})),P.push(D)):"extent"===B.type?(z=B.clone()._normalize(!1,!1,p),P.push(z.rings?new c.v(z):z)):B.extent?(E=B.extent,N=m(E.xmin,g)*(2*y),L=0===N?B.clone():v(B.clone(),N),E.offset(N,0),E.intersects(w)&&E.xmax!==y?(C=E.xmax>C?E.xmax:C,L=R(L,h),M.push(L),P.push("cut")):E.intersects(I)&&E.xmin!==g?(C=E.xmax*(2*y)>C?E.xmax*(2*y):C,L=R(L,h,360),M.push(L),P.push("cut")):P.push(L)):P.push(B.clone()):P.push(B))}catch(n){F.e(n)}finally{F.f()}for(A=m(C,y),H=-90,J=A,j=new c.m;A>0;)W=360*A-180,j.addPath([[W,H],[W,-1*H]]),H*=-1,A--;if(!(M.length>0&&J>0)){e.next=29;break}return e.t0=Z,e.t1=M,e.next=16,x(s,M,j,i);case 16:for(e.t2=e.sent,G=(0,e.t0)(e.t1,e.t2),U=[],q=[],V=0;V<P.length;V++)"cut"!==(X=P[V])?q.push(X):(Y=G.shift(),K=t[V],(0,l.r)(K)&&"polygon"===K.type&&K.rings&&K.rings.length>1&&Y.rings.length>=K.rings.length?(U.push(Y),q.push("simplify")):q.push(h?(0,f.R)(Y):Y));if(U.length){e.next=23;break}return e.abrupt("return",q);case 23:return e.next=25,b(s,U,i);case 25:for(Q=e.sent,$=[],ee=0;ee<q.length;ee++)"simplify"!==(te=q[ee])?$.push(te):$.push(h?(0,f.R)(Q.shift()):Q.shift());return e.abrupt("return",$);case 29:for(re=[],ne=0;ne<P.length;ne++)"cut"!==(ie=P[ne])?re.push(ie):(ae=M.shift(),re.push(!0===h?(0,f.R)(ae):ae));return e.abrupt("return",re);case 32:case"end":return e.stop()}}),e)}))),C.apply(this,arguments)}function M(e,t){var r=(0,f.b)(t);if(r){var n=(0,a.Z)(r.valid,2),i=n[0],s=n[1],o=s-i;if(e<i)for(;e<i;)e+=o;if(e>s)for(;e>s;)e-=o}return e}},30936:function(e,t,r){r.d(t,{c:function(){return v},f:function(){return R},i:function(){return T},m:function(){return w}});var n=r(29439),i=r(15671),a=r(43144),s=r(60136),o=r(29388),l=r(23132),u=(r(75610),r(50448)),c=r(70441),f=(r(91204),r(30709)),p=r(80262),h=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){return(0,i.Z)(this,r),t.apply(this,arguments)}return(0,a.Z)(r,[{key:"affectsPixelSize",get:function(){return!1}},{key:"forwardTransform",value:function(e){return e}},{key:"inverseTransform",value:function(e){return e}}]),r}(c.l);(0,l.e)([(0,l.d)()],h.prototype,"affectsPixelSize",null),(0,l.e)([(0,l.d)({json:{write:!0}})],h.prototype,"spatialReference",void 0);var d=h=(0,l.e)([(0,l.n)("esri.layers.support.rasterTransforms.BaseRasterTransform")],h),m=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments)).type="gcs-shift",e.tolerance=1e-8,e}return(0,a.Z)(r,[{key:"forwardTransform",value:function(e){return"point"===(e=e.clone()).type?(e.x>180+this.tolerance&&(e.x-=360),e):(e.xmin>=180-this.tolerance?(e.xmax-=360,e.xmin-=360):e.xmax>180+this.tolerance&&(e.xmin=-180,e.xmax=180),e)}},{key:"inverseTransform",value:function(e){return"point"===(e=e.clone()).type?(e.x<-this.tolerance&&(e.x+=360),e):(e.xmin<-this.tolerance&&(e.xmin+=360,e.xmax+=360),e)}}]),r}(d);(0,l.e)([(0,u.r)({GCSShiftXform:"gcs-shift"})],m.prototype,"type",void 0),(0,l.e)([(0,l.d)()],m.prototype,"tolerance",void 0);var v=m=(0,l.e)([(0,l.n)("esri.layers.support.rasterTransforms.GCSShiftTransform")],m),y=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments)).type="identity",e}return(0,a.Z)(r)}(d);(0,l.e)([(0,u.r)({IdentityXform:"identity"})],y.prototype,"type",void 0);var x=y=(0,l.e)([(0,l.n)("esri.layers.support.rasterTransforms.IdentityTransform")],y);function g(e,t,r){var n=t.x,i=t.y;if(r<2)return{x:e[0]+n*e[2]+i*e[4],y:e[1]+n*e[3]+i*e[5]};if(2===r){var a=n*n,s=i*i,o=n*i;return{x:e[0]+n*e[2]+i*e[4]+a*e[6]+o*e[8]+s*e[10],y:e[1]+n*e[3]+i*e[5]+a*e[7]+o*e[9]+s*e[11]}}var l=n*n,u=i*i,c=n*i,f=l*n,p=l*i,h=n*u,d=i*u;return{x:e[0]+n*e[2]+i*e[4]+l*e[6]+c*e[8]+u*e[10]+f*e[12]+p*e[14]+h*e[16]+d*e[18],y:e[1]+n*e[3]+i*e[5]+l*e[7]+c*e[9]+u*e[11]+f*e[13]+p*e[15]+h*e[17]+d*e[19]}}function b(e,t,r){var n=t.xmin,i=t.ymin,a=t.xmax,s=t.ymax,o=t.spatialReference,l=[];if(r<2)l.push({x:n,y:s}),l.push({x:a,y:s}),l.push({x:n,y:i}),l.push({x:a,y:i});else{for(var u=10,c=0;c<u;c++)l.push({x:n,y:i+(s-i)*c/(u-1)}),l.push({x:a,y:i+(s-i)*c/(u-1)});u=8;for(var f=1;f<=u;f++)l.push({x:n+(a-n)*f/u,y:i}),l.push({x:n+(a-n)*f/u,y:s})}l=l.map((function(t){return g(e,t,r)}));var h=l.map((function(e){return e.x})),d=l.map((function(e){return e.y}));return new p.M({xmin:Math.min.apply(null,h),xmax:Math.max.apply(null,h),ymin:Math.min.apply(null,d),ymax:Math.max.apply(null,d),spatialReference:o})}var k=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=t.apply(this,arguments)).polynomialOrder=1,e.type="polynomial",e}return(0,a.Z)(r,[{key:"readForwardCoefficients",value:function(e,t){var r=t.coeffX,n=t.coeffY;if(null===r||void 0===r||!r.length||null===n||void 0===n||!n.length||r.length!==n.length)return null;for(var i=[],a=0;a<r.length;a++)i.push(r[a]),i.push(n[a]);return i}},{key:"writeForwardCoefficients",value:function(e,t,r){for(var n=[],i=[],a=0;a<(null===e||void 0===e?void 0:e.length);a++)a%2==0?n.push(e[a]):i.push(e[a]);t.coeffX=n,t.coeffY=i}},{key:"inverseCoefficients",get:function(){var e=this._get("inverseCoefficients"),t=this._get("forwardCoefficients");return!e&&t&&this.polynomialOrder<2&&(e=function(e){var t=(0,n.Z)(e,6),r=t[0],i=t[1],a=t[2],s=t[3],o=t[4],l=t[5],u=a*l-o*s,c=o*s-a*l;return[(o*i-r*l)/u,(a*i-r*s)/c,l/u,s/c,-o/u,-a/c]}(t)),e},set:function(e){this._set("inverseCoefficients",e)}},{key:"readInverseCoefficients",value:function(e,t){var r=t.inverseCoeffX,n=t.inverseCoeffY;if(null===r||void 0===r||!r.length||null===n||void 0===n||!n.length||r.length!==n.length)return null;for(var i=[],a=0;a<r.length;a++)i.push(r[a]),i.push(n[a]);return i}},{key:"writeInverseCoefficients",value:function(e,t,r){for(var n=[],i=[],a=0;a<(null===e||void 0===e?void 0:e.length);a++)a%2==0?n.push(e[a]):i.push(e[a]);t.inverseCoeffX=n,t.inverseCoeffY=i}},{key:"affectsPixelSize",get:function(){return this.polynomialOrder>0}},{key:"forwardTransform",value:function(e){if("point"===e.type){var t=g(this.forwardCoefficients,e,this.polynomialOrder);return new f.j({x:t.x,y:t.y,spatialReference:e.spatialReference})}return b(this.forwardCoefficients,e,this.polynomialOrder)}},{key:"inverseTransform",value:function(e){if("point"===e.type){var t=g(this.inverseCoefficients,e,this.polynomialOrder);return new f.j({x:t.x,y:t.y,spatialReference:e.spatialReference})}return b(this.inverseCoefficients,e,this.polynomialOrder)}}]),r}(d);(0,l.e)([(0,l.d)({json:{write:!0}})],k.prototype,"polynomialOrder",void 0),(0,l.e)([(0,l.d)()],k.prototype,"forwardCoefficients",void 0),(0,l.e)([(0,f.o)("forwardCoefficients",["coeffX","coeffY"])],k.prototype,"readForwardCoefficients",null),(0,l.e)([(0,f.r)("forwardCoefficients")],k.prototype,"writeForwardCoefficients",null),(0,l.e)([(0,l.d)({json:{write:!0}})],k.prototype,"inverseCoefficients",null),(0,l.e)([(0,f.o)("inverseCoefficients",["inverseCoeffX","inverseCoeffY"])],k.prototype,"readInverseCoefficients",null),(0,l.e)([(0,f.r)("inverseCoefficients")],k.prototype,"writeInverseCoefficients",null),(0,l.e)([(0,l.d)()],k.prototype,"affectsPixelSize",null),(0,l.e)([(0,u.r)({PolynomialXform:"polynomial"})],k.prototype,"type",void 0);var w=k=(0,l.e)([(0,l.n)("esri.layers.support.rasterTransforms.PolynomialTransform")],k),I={GCSShiftXform:v,IdentityXform:x,PolynomialXform:w},S=Object.keys(I);function R(e){var t=null===e||void 0===e?void 0:e.type;return!e||S.includes(t)}function T(e){if(!(null===e||void 0===e?void 0:e.type))return null;var t=I[null===e||void 0===e?void 0:e.type];if(t){var r=new t;return r.read(e),r}return null}}}]);
//# sourceMappingURL=6577.08deb386.chunk.js.map